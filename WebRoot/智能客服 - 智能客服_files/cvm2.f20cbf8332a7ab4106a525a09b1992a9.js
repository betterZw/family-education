"use strict";function _asyncToGenerator(a){return function(){var b=a.apply(this,arguments);return new Promise(function(a,c){function d(e,f){try{var g=b[e](f),h=g.value}catch(i){return void c(i)}return g.done?void a(h):Promise.resolve(h).then(function(a){d("next",a)},function(a){d("throw",a)})}return d("next")})}}function _toConsumableArray(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}return Array.from(a)}function _defineProperty(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}function _objectWithoutProperties(a,b){var c={};for(var d in a)b.indexOf(d)>=0||Object.prototype.hasOwnProperty.call(a,d)&&(c[d]=a[d]);return c}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_slicedToArray=function(){function a(a,b){var c=[],d=!0,e=!1,f=void 0;try{for(var g,h=a[Symbol.iterator]();!(d=(g=h.next()).done)&&(c.push(g.value),!b||c.length!==b);d=!0);}catch(i){e=!0,f=i}finally{try{!d&&h["return"]&&h["return"]()}finally{if(e)throw f}}return c}return function(b,c){if(Array.isArray(b))return b;if(Symbol.iterator in Object(b))return a(b,c);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();define("cvm/cbs2/cbsdetail",function(a,b,c){var d,e,f,g,h,i=a("$"),j=a("router"),k=a("pageManager"),l=a("cvm/cbs2/data"),m=a("models/iaas"),n=a("cvm/cbs2/event/attach"),o=a("cvm/cbs2/event/modifyalias"),p=a("cvm/cbs2/event/createsnapshot"),q=a("cvm/cbs2/event/cancelattach"),r=a("cvm/cbs2/event/renew"),s=a("cvm/cbs2/event/upgradedisk"),t=a("util"),u=a("appUtil"),v=a("dialog"),w=a("widget/copy/copy"),x=a("qccomponent"),y=(x.getComponent("grid-view"),a("cvm/cbs2/cbsutil")),z=a("./monitor"),A=a("cvm/snapshot2/data"),B=a("cvm/cvm/data"),C=a("cvm/cbs2/event/tag/tag"),D=a("cvm/cbs2/snapshotChain"),E=(a("cvm/common/components/columsWidth/ColumsWidth"),{main:'  <div class="manage-area">    <div class="manage-area-title secondary-title">      <a href="javascript:void(0);" class="back-link">        <i class="btn-back-icon"></i>返回</a>      <span class="line-icon">|</span>      <h2>{{item.diskId}}详情</h2>    </div>    <div class="manage-area-main secondary-main">      <!-- tab -->      <div class="tc-15-tab tc-15-tab-alt tc-special-tab">        <ul role="tablist" class="tc-15-tablist" id="cbsList">          <li class="tc-cur" b-attr="tab_detail" b-on-click="tab(\'detail\')">            <a href="javascript:void(0);" role="tab">参数</a>          </li>          <li b-attr="tab_optlog" b-on-click="tab(\'optlog\')">            <a href="javascript:void(0);" role="tab">操作日志</a>          </li>          <li b-attr="tab_snapshotChain" b-on-click="tab(\'snapshotChain\')">            <a href="javascript:void(0);" role="tab">快照链</a>          </li>          <li b-attr="tab_monitor" b-on-click="tab(\'monitor\')">            <a href="javascript:void(0);" role="tab">硬盘监控</a>          </li>        </ul>        <!-- 参数 -->        <div class="tab-panel param-panel" b-if="isShowInfo">          <div class="manage-area-full-inner">            <!-- 参数列表 开始 -->            <div class="param-box">              <div class="param-hd">                <h3>云硬盘信息</h3>              </div>              <div class="param-bd">                <ul class="item-descr-list">                  <li>                    <span class="item-descr-tit">名称</span>                    <span class="item-descr-txt">{{item.diskName}}                      <a b-if="item.isAlias" class="edit" href="javascript:void(0);" data-event="modifyalias">改名</a>                    </span>                  </li>                  <li>                    <span class="item-descr-tit">资源ID</span>                    <span class="item-descr-txt viewIpCopyWrap">{{item.diskId}}                      <a href="javascript:;" data-clipboard-text={{item.diskId}} style="display:none;">复制</a>                    </span>                  </li>                  <li>                    <span class="item-descr-tit">状态</span>                    <span class="text-success">{{item.statusDesc}}</span>                  </li>                  <li b-if="!item.proejctNull">                    <span class="item-descr-tit">所属项目</span>                    <span class="item-descr-txt">{{item.projectName}}</span>                  </li>                  <li>                    <span class="item-descr-tit">地域</span>                    <span class="item-descr-txt">{{item.regionName}}</span>                  </li>                  <li>                    <span class="item-descr-tit">可用区</span>                    <span class="item-descr-txt">{{item.zoneName}}</span>                  </li>                  <li>                    <span class="item-descr-tit">硬盘类型</span>                    <span class="item-descr-txt">{{item.storageTypeDesc}}</span>                  </li>                  <li>                    <span class="item-descr-tit">硬盘属性</span>                    <span class="item-descr-txt">{{item.diskTypeDesc}}</span>                  </li>                  <li>                    <span class="item-descr-tit">云硬盘容量</span>                    <span class="item-descr-txt">                      {{item.storageSizeDesc}}                      <a b-if="item.isUpgrade" class="edit" href="javascript:void(0);" data-event="upgradedisk">扩容</a>                    </span>                  </li>                  <li>                    <span class="item-descr-tit">已挂载实例</span>                    <span b-if="item.instanceId" class="item-descr-txt viewIpCopyWrap">                      <a data-event="nav" href="/cvm/detail/{{item.regionId}}/{{item.instanceId}}">{{item.instanceId}}</a>                      <span b-if="item.instanceName">（{{item.instanceName}}）</span>                      <a b-if="item.isCancelAttach" class="edit" href="javascript:void(0);" data-event="cancelattach">卸载</a>                    </span>                    <span b-if="!item.instanceId && item.isAttach" class="item-descr-txt">                      未挂载                      <a class="edit" href="javascript:void(0);" data-event="cbsattach">挂载</a>                    </span>                  </li>                  <li>                    <span class="item-descr-tit">是否随实例销毁</span>                    <span b-if="item.deleteWithInstance" class="item-descr-txt">是</span>                    <span b-if="!item.deleteWithInstance" class="item-descr-txt">否</span>                  </li>                  <li>                    <span class="item-descr-tit">是否加密</span>                    <span b-if="item.encrypt" class="item-descr-txt">是</span>                    <span b-if="!item.encrypt" class="item-descr-txt">否</span>                  </li>                  <li>                    <span class="item-descr-tit">可卸载</span>                    <span class="item-descr-txt">{{item.attachedDesc}}</span>                  </li>                  <li>                    <span class="item-descr-tit">计费模式</span>                    <span class="item-descr-txt">{{item.payModeDesc}}                      <a b-if="item.isRenew" class="edit" href="javascript:void(0);" data-event="renew">续费</a>                    </span>                  </li>                  <li>                    <span class="item-descr-tit">定期快照策略</span>                    <span b-if="item.aspId" class="item-descr-txt viewIpCopyWrap">                      <a data-event="nav" href="/cvm/snapshot/asp_detail/{{item.aspId}}">{{item.aspId}}</a>                      ({{item.aspPolicy}})                    </span>                    <span b-if="!item.aspId" class="item-descr-txt">                      未关联                      <a class="edit" target="_blank"  href="//console.cloud.tencent.com/cvm/snapshot/asp">前往关联策略</a>                    </span>                  </li>                  <li>                    <span class="item-descr-tit">创建时间</span>                    <span class="item-descr-txt">{{item.createTime}}</span>                  </li>                  <li b-if="item.diskChargeType == \'PREPAID\'">                    <span class="item-descr-tit">到期时间</span>                    <span class="item-descr-txt">{{item.deadlineTimeDesc}}</span>                  </li>                  <li>                    <span class="item-descr-tit">本硬盘快照</span>                    <span class="item-descr-txt">                      {{{ item.snashotsTxt }}}                      <a b-if="item.isSnapAbility" class="edit" href="javascript:void(0);" data-event="createsnapshot"> 创建快照</a>                    </span>                  </li>                  <li b-if="isTagWhite">                    <span class="item-descr-tit">标签</span>                    <span class="item-descr-txt">                      <div b-if="item.tags && item.tags.length" class="tc-tag-cont">                        <span class="tc-tag-txt" title="{{tag.key + \':\' + tag.value}}" b-repeat="tag in item.tags">                          <span>                            {{tag.key + \':\' + tag.value}}                          </span>                          <a href="javascript:;" class="pencil-icon" data-name="tag" data-action="tag"></a>                      </div>                      <div b-if="!(item.tags && item.tags.length)">                        <span class="tc-tag-cont">-</span>                        <a href="javascript:;" class="pencil-icon" data-name="tag" data-action="tag"></a>                      </div>                      </span>                  </li>                </ul>              </div>            </div>            <!-- 参数列表  -->          </div>        </div>        <!-- 操作日志 -->        <div class="tab-panel log-panel" b-if="isShowLog">          <div class="manage-area-full-inner">            <logs-grid b-ref="grid" data="{{item}}"></logs-grid>          </div>        </div>        <!-- 快照链 -->        <div class="tab-panel snapshotChain-panel" id="snapshotChain" b-if="isShowSnapshotChain">        </div>        <!-- 硬盘监控 -->        <div class="tab-panel monitor-panel" b-if="isShowMonitor">          <div class="manage-area-full-inner">            <div class="tc-15-data-graph" id="monitorRender">            </div>          </div>        </div>      </div>    </div>  </div>',cbs_null:'  <div class="ui-popmsg">    <div class="info">      <p>该云硬盘已退订或删除，请返回重新操作 </p>    </div>  </div>',logsGrid:'  <div class="log-param snap-log-param">    <div class="justify-grid">      <div class="col">        <!-- TODO: 如何处理? -->        <!--<a class="link" href="javascript:void(0);" id="exportLogBtn">导出列表</a>-->        <qc-date-picker b-ref="datePicker">          <script type="text/json" data>            {              "showCalendar": true,              "tabs": [                { "label": "今天", "from": "%TODAY", "to": "%TODAY"},                { "label": "近7天", "from": "%TODAY-6", "to": "%TODAY"},                { "label": "近15天", "from": "%TODAY-14", "to": "%TODAY"},                { "label": "近30天", "from": "%TODAY-29", "to": "%TODAY"}              ],              "selected": {                "from": "%TODAY-29",                "to": "%TODAY"              },              "range": {                "min": null,                "max": "%TODAY",                "maxLength": 29              }            }          </script>        </qc-date-picker>      </div>    </div>    <div data-role="grid-view">      <div class="tc-15-table-panel">        <div class="tc-15-table-fixed-head">          <table class="tc-15-table-box">            <colgroup>              <col style="width: 15%" />              <col />              <col style="width: 20%" />              <col style="width: 20%" />              <col style="width: 15%" />              <col style="width: 10%" />            </colgroup>            <thead>              <tr>                <th>                  <div><span class="text-overflow">操作时间</span></div>                </th>                <th>                  <div><span class="text-overflow">操作名称</span></div>                </th>                <th>                  <div><span class="text-overflow">Action</span></div>                </th>                <th>                  <div><span class="text-overflow">操作者</span></div>                </th>                <th>                  <div><span class="text-overflow">操作结果</span></div>                </th>                <th>                  <div><span class="text-overflow">详情</span></div>                </th>              </tr>            </thead>          </table>        </div>        <div class="tc-15-table-fixed-body">          <table class="tc-15-table-box tc-15-table-rowhover">            <colgroup>              <col style="width: 15%" />              <col />              <col style="width: 20%" />              <col style="width: 20%" />              <col style="width: 15%" />              <col style="width: 10%" />            </colgroup>            <tbody>              <tr b-repeat="event in events">                <td>                  <div>                    <span class="text-overflow">                      {{event[\'EventTime\']}}                    </span>                  </div>                </td>                <td>                  <div>                    <span class="text-overflow">                      {{event[\'EventNameCn\']}}                    </span>                  </div>                </td>                <td>                  <div>                    <span class="text-overflow">                      {{event[\'EventName\']}}                    </span>                  </div>                </td>                <td>                  <div>                    <span class="text-overflow">                      {{event[\'Username\']}}                    </span>                  </div>                </td>                <td>                  <div>                    <span class="text-overflow">                      <span class="text-success" b-if="event.success">成功</span>                      <span class="text-danger" b-if="!event.success">失败</span>                    </span>                  </div>                </td>                <td>                  <div>                    <a data-event="nav" href="{{event.detailsUrl}}">详情</a>                  </div>                </td>              </tr>              <tr b-if="loading" tabindex="0">                <td class="text-center" colspan="6">                  <div style="padding: 20px 0;">                    <i class="n-loading-icon"></i> <span>加载中...</span>                  </div>                </td>              </tr>              <tr b-if="!loading && pageToken" tabindex="0">                <td class="text-center" colspan="6">                  <div style="padding: 20px 0;">                    <a href="javascript:void(0);" b-on-click="loadMore()">点击加载更多</a>                  </div>                </td>              </tr>              <tr b-if="!loading && !pageToken && !events.length" tabindex="0">                <td class="text-center" colspan="6">                  <div style="padding: 20px 0;">                    <span class="text">抱歉，暂无相关日志！</span>                  </div>                </td>              </tr>            </tbody>          </table>        </div>      </div>    </div>  </div>'}),F=null,G=function(){F=null},H=x.extend({$tpl:E.logsGrid,$afterInit:function(){var a=this;a.initDatePicker(),a.refresh()},initDatePicker:function(){var a=this,b=a.$refs.datePicker;b.setAllowRange("%TODAY-29","%TODAY",29),b.$on("datepick",function(){a.dateChange()})},dateChange:function(){var a=this;a.refresh()},refresh:function(){var a=this,b=a.$refs.datePicker;a.$set({loading:!0,events:[],pageToken:null}),a.getData({diskId:a.$data.data.diskId,startTime:u.getDate(b.selected.from+" 00:00:00"),endTime:u.getDate(u.getDate(b.selected.to+" 00:00:00").getTime()+864e5)}).then(function(b){a.$set({loading:!1,events:b.events,pageToken:b.pageToken})})},loadMore:function(){var a=this,b=a.$refs.datePicker;a.$set({loading:!0}),a.getData({diskId:a.$data.data.diskId,startTime:u.getDate(b.selected.from+" 00:00:00"),endTime:u.getDate(u.getDate(b.selected.to+" 00:00:00").getTime()+864e5)},a.pageToken).then(function(b){a.$set({loading:!1,events:a.events.concat(b.events),pageToken:b.pageToken})})},getData:function(a,b){return m.apiRequest({serviceType:"cloudaudit",action:"LookUpEvents",regionId:1,data:{Version:"2019-03-19",StartTime:Math.floor(a.startTime.getTime()/1e3),EndTime:Math.floor(a.endTime.getTime()/1e3),LookupAttributes:[{AttributeKey:"ReadOnly",AttributeValue:"false"},{AttributeKey:"ResourceType",AttributeValue:"cvm"},{AttributeKey:"ResourceName",AttributeValue:"volume/"+a.diskId}],NextToken:b}}).then(function(b){return{events:(b.Response&&b.Response.Events?b.Response.Events:[]).map(function(b){var c=null;try{c=JSON.parse(b.CloudAuditEvent)}catch(d){}return b.success=Boolean(c&&!c.apiErrcode),b.detailsUrl="https://console.cloud.tencent.com/cloudaudit?"+["attributeKey=EventId","attributeValue="+b.EventId,"startTime="+a.startTime.getTime(),"endTime="+a.endTime.getTime(),"from=cvm"].join("&"),b}),pageToken:b.Response&&b.Response.NextToken&&!b.Response.ListOver?b.Response.NextToken:null}})}},{defaults:{}});x.tag("logs-grid",H);var I=x.extend({$tpl:E.main,tab:function(a){J.tab(a)}}),J={init:function(a,b){G(),F&&F.hottag("renderCbsData","beforeRender"),this.opts={count:20,page:1,order:1,orderField:""};var c=this;this.diskId=a.diskId,this.regionId=a.regionId,this.projectId=a.projectId,Promise.all([l.queryDisks({regionId:c.regionId,diskIds:[this.diskId]}),B.queryZone(c.regionId),B.getProjects(),B.queryRegion(),A.querySnapshots({regionId:c.regionId,data:{filters:[{name:"disk-id",values:[this.diskId]}]}}),A.describeDiskAssociatedAutoSnapshotPolicy({regionId:c.regionId,diskId:this.diskId}),l.queryWhiteList()]).then(function(a){var e=a[0],f=a[1],g=a[2],h=a[3],k=a[4],m=a[5]&&a[5].response;d=a[6],k=k&&k.response;var n=e&&e.response&&e.response.diskSet;if(n&&0==n.length)return void v.create(E.cbs_null,"550","",{title:"云硬盘",preventResubmit:!1,defaultCancelBtn:!1,button:{" 确定 ":function(a){j.navigate("/cvm/cbs")}}});var o=b.formatData(n,f),p=[];if(i(k.snapshotSet).each(function(a,b){p.push("<a href='/cvm/snapshot/detail/"+b.snapshotId+"'><font>"+b.snapshotId+"</font>")}),g&&g.length>0?(o[0].proejctNull=!1,i(g).each(function(a,b){b.projectId==o[0].placement.projectId&&(o[0].projectName=b.name)})):o[0].proejctNull=!0,o[0].regionName=h[c.regionId],o[0].snashotsTxt=p.join("&nbsp;&nbsp;")||"无快照",m&&m.autoSnapshotPolicySet&&m.autoSnapshotPolicySet.length>0){var q=m.autoSnapshotPolicySet[0];o[0].aspId=q.autoSnapshotPolicyId,o[0].aspPolicy=y.parseAspPolicy(q)}!o[0].instanceId||o[0].instanceName?c.renderDetail(b,o):l.getCvmList({filters:[{name:"instance-id",values:[o[0].instanceId]}]}).then(function(a){var d=a.instances.deviceList;o[0].instanceName=d&&d.length?d[0].alias:"",c.renderDetail(b,o)},function(){o[0].instanceName="-",c.renderDetail(b,o)})})},jump:function(a,b){b&&(a+=a.indexOf("?")>-1?"&":"?",a+="backfrom="+b),j.navigate(a)},renderDetail:function(a,b){var c=this;c.storageSet=b;var j=b[0],l=c.bee=new I({item:j,isShowInfo:!0,isTagWhite:!!d.CBS_TAG_WL}),m=location.search.match(/backfrom=(\w+)/),u=(m&&m[1],c.jump);e=j.instanceId,f=j.portable,g=j.diskType,h=j,k.appArea.html(l.$el),F&&F.hottag("renderCbsData","gotCbsData");var v=t.paramsToObject(c.parseSearch());v.monitor&&(i("#cbsList li").eq(0).removeClass("tc-cur"),i("#cbsList li").eq(2).addClass("tc-cur"),c.tab("monitor")),c.initCopy(),i(".back-link").click(function(){u("/cvm/cbs")}),i("[data-event=modifyalias]").click(function(){o.init(b,{callback:function(){u("/cvm/cbs/detail?diskId="+j.diskId+"&rid="+j.regionId)}})}),i("[data-event=upgradedisk]").click(function(){s.init(j,{projectId:j.placement.projectId,regionId:j.regionId})}),i("[data-event=cbsattach]").click(function(){n.init(b,{projectId:j.placement.projectId,regionId:j.regionId,callback:function(){u("/cvm/cbs/detail?diskId="+j.diskId+"&rid="+j.regionId)}})}),i("[data-event=cancelattach]").click(function(){q.init(b,{projectId:j.placement.projectId,regionId:j.regionId,callback:function(){u("/cvm/cbs/detail?diskId="+j.diskId+"&rid="+j.regionId)}})}),i("[data-event=renew]").click(function(){r.init(b,{projectId:j.placement.projectId,regionId:j.regionId})}),i("[data-event=createsnapshot]").click(function(){p.init(b,{projectId:j.placement.projectId,regionId:j.regionId,callback:function(){u("/cvm/cbs/detail?diskId="+j.diskId+"&rid="+j.regionId)}})}),i('[data-action="tag"]').click(function(){C.init(b,{regionId:j.regionId,callback:function(){u("/cvm/cbs/detail?diskId="+j.diskId+"&rid="+j.regionId)}})})},initCopy:function(){var a=i(".viewIpCopyWrap"),b=a.find("[data-clipboard-text]");new w({handle:b,container:a})},tab:function(a){this.bee.$set({tab_detail:{"class":""},tab_snapshotChain:{"class":""},tab_optlog:{"class":""},tab_monitor:{"class":""}}),this.bee.$set("tab_"+a,{"class":"tc-cur"}),this.bee.$set({isShowInfo:"detail"===a,isShowSnapshotChain:"snapshotChain"===a,isShowLog:"optlog"===a,isShowMonitor:"monitor"===a}),"monitor"===a&&this.initMonitor(),"snapshotChain"==a&&D.init({diskId:this.diskId},i("#snapshotChain"),J)},initMonitor:function(){z.showDetail(h,document.getElementById("monitorRender"))},parseSearch:function(){var a=location.search||location.href.split("?")[1];return a}};c.exports=J}),define("modules/cvm/cbs/cbs",function(a,b,c){function d(){return g.extend({},!0)}function e(a){var b="";return"POSTPAID_BY_HOUR"==a.diskChargeType||"CDCPAID"==a.diskChargeType?b=a.createTime+" 创建":(a.autoRenewFlag?b=a.deadlineTime+" 到期":a.differDaysOfDeadline>14||"undefined"==typeof a.differDaysOfDeadline?b=a.deadlineTime+" 到期":a.differDaysOfDeadline>7?b=a.differDaysOfDeadline+" 天后过期":a.differDaysOfDeadline>0&&a.differDaysOfDeadline<=7?b=a.differDaysOfDeadline+" 天后回收":a.differDaysOfDeadline<0&&a.differDaysOfDeadline>-7?b=a.differDaysOfDeadline+7+" 天后销毁":a.differDaysOfDeadline<=-7?b="即将销毁":0===a.differDaysOfDeadline&&(b="小于1天到期"),!a.portable&&"SYSTEM_DISK"==a.diskUsage&&a.deadlineTime&&(b=f(a))),b}function f(a){var b="",c=864e5,d=7*c,e=new Date(a.deadlineTime.replace(/-/g,"/")),f=j.getSystemTime(),g=f-e.getTime(),h=void 0;if("TORECYCLE"==a.diskState){var i=7,k=d;if(k>g){g=g.toFixed(2)-0;var l=(i-g/c).toFixed(2).split("."),m="";if(l[1]){var m=(l[1]/100*24).toFixed(0)-0;m=m>0?m+"小时":""}b=0==l[0]&&0==m?"小于1小时释放</span>":(l[0]>0?l[0]+"天":"")+m+"后释放"}else b="即将释放"}else g>0?(h=Math.floor(g/c),b=1>h?"小于1天到期":"已过期"+h+"天"):-d>g?b=a.deadlineTime+" 到期":(h=Math.floor(Math.abs(g/c)),b=1>h?"小于1天到期":h+"天后到期");return b}var g=a("$"),h=a("pageManager"),i=(a("manager"),a("util")),j=a("appUtil"),k=(a("event"),a("projectsSelector"),a("cvm/common/components/columsWidth/ColFieldsManager")),l=a("cvm/snapshot2/constants"),m=a("cvm/cbs2/data"),n=a("tips"),o=a("cvm/cbs2/cbsdetail"),p=a("nmcConfig"),q=a("cvm/cbs2/event/attach"),r=a("cvm/cbs2/event/modifyalias"),s=a("cvm/cbs2/event/createsnapshot"),t=a("cvm/cbs2/event/cancelattach"),u=a("cvm/cbs2/event/buy"),v=a("cvm/cbs2/event/renew"),w=a("cvm/cbs2/event/upgradedisk"),x=a("cvm/cbs2/event/export"),y=a("cvm/cbs2/event/changeproject"),z=a("cvm/cbs2/event/modifyprops"),A=a("cvm/cbs2/event/modifyDiskType"),B=a("cvm/cbs2/event/bindAutoSnapshotPolicy"),C=(a("models/api"),a("search"),a("router")),D=a("qccomponent"),E=(a("contextmenu"),a("cvm/cbs2/operate_auth")),F=a("widget/grid/Action"),G=a("cvm/cbs2/constants"),H=a("cvm/common/constants"),I=a("cvm/cvm/cvmutil"),J=a("cvm/cbs2/cbsutil"),K=a("./monitor"),L=a("widget/errorTips/errorTips"),M=a("cvm/common/components/SmartHelper"),N=a("cvm/cbs2/event/destroycbs"),O=a("widget/i18n"),P=a("cvm/cbs2/search_box"),Q=a("widget/pills/pills"),R=a("cvm/cvm/data"),S=D.getComponent("grid-view").extend(O.getBeeConfig()),T=a("cvm/cbs2/event/tag/tag"),U=a("constants"),V=null,W=null,X=function(){V=null};S.tag("action",D.extend({$tpl:'  <a href="javascript:void(0);" data-event?="!disabled && act" class="{{disabled ? \'disable\' : \'\'}}"    data-title?="disabled && title">{{>$content}}</a>'}));var Y,Z,$,_,aa,ba=!1,ca=!1,da=!1,ea=!1,fa=!1,ga=!1,ha=!1,ia=!1,ja=20,ka=["renew","createsnapshot","upgradedisk","changeproject","attach","modifyalias","cancelattach","exports","refund","editTag"],la=i.tmpl('  <div>    <div class="til">      <p>        <% if(item.diskState == "TORECYCLE"){ %>        <span>          <%=item.diskId%>        </span>        <%}else{%>        <a href="javascript:void(0)" data-event="cbsdetail">          <%=item.diskId%>        </a>        <% if (item.autoRenewFlag)  {%>        <span class="icon-renewal-mark" data-title="该云硬盘已设置为自动续费"></span>        <% } %>        <% } %>      </p>      <% if(item.rollbacking){ %>      <div class="tc-15-bubble-icon tc-15-triangle-align-start" style="z-index:99">        <i class="tc-icon plaint-icon"></i>        <div class="tc-15-bubble tc-15-bubble-top">          <div class="tc-15-bubble-inner">            <p>云硬盘回滚成功，可正常使用。部分数据正在搬迁中，已完成              <%=item.rollbackPercent%>%，搬迁过程中硬盘性能可能会下降15%。            </p>          </div>        </div>      </div>      <% } %>      <% if(item.migrating){ %>      <div class="tc-15-bubble-icon tc-15-triangle-align-start" style="z-index:99">        <i class="tc-icon plaint-icon"></i>        <div class="tc-15-bubble tc-15-bubble-top">          <div class="tc-15-bubble-inner">            <p>云硬盘类型调整中，进度:<%=item.migratePercent%>%</p>          </div>        </div>      </div>      <% } %>    </div>    <p>      <p>        <span class="text-overflow" title="<%=item.diskName%>">          <%=item.diskName%>        </span>        <a href="javascript:void(0)">          <i class="pencil-icon" data-title="改名" data-event="modifyalias" style="visibility: hidden"></i>        </a>      </p>    </p>  </div>',null),ma=20,na=20,oa=P.filterOptions,pa={1:"云盘已经退还过",2:"云盘已过期",3:"包年包月云硬盘已购买超过5天不支持退还",4:"非预付费云盘不支持退还",8:"超过可退还的数量限制",9:"通过活动购买的云盘不能退",10:"非弹性云盘、系统盘、已挂载盘不支持退还"},qa=["DUMPING"],ra={param:{},title:"云硬盘-控制台",pageClass:"",render:function(){X(),V&&V.hottag("renderCbsList","beforeRender"),h.setTitle({title:this.title}),nmc.render(i.tmpl('  <div class="manage-area">    <div class="manage-area-title">      <h2>云硬盘</h2>      <div class="manage-area-title-right">        <a href="//cloud.tencent.com/document/product/362" target="_blank" class="guide-link">云硬盘使用指南          <b class="external-link-icon"></b>        </a>      </div>    </div>    <div class="manage-area-main">      <div class="mb-15" role="radiogroup" id="regionGroup"></div>      <div class="tc-15-msg">        <div class="tip-info">          云硬盘快照可以应对误操作、病毒等导致的数据丢失风险，也可将在重大操作过程中出现问题的业务恢复至历史正常状态，点击          <a href="//cloud.tencent.com/document/product/362/5754" target="_blank" rel="">快照概述</a>          了解更多。</br>          目前对于符合条件的部分地域，腾讯云将赠送该地域下一定量的          <span class="text-warning">免费快照额度</span>          ，点击          <a href="//cloud.tencent.com/document/product/362/32361#.E8.B5.A0.E9.80.81.E9.A2.9D.E5.BA.A6" target="_blank">快照计费概述-赠送额度</a>          查看详情。        </div>      </div>      <div class="manage-area-full-inner">        <div class="cvm-snap-list">          <div class="tc-action-grid">            <div class="justify-grid" id="operArea">              <div class="col">                <button b-if="!isI18nUser||isCbsPostpaidWhite" type="button" class="tc-15-btn m btn-add"                  data-event="buystorage">                  <b class="icon-add"></b> 新建</button>                <button type="button" class="tc-15-btn m weak disabled" data-event="cbsattach">挂载</button>                <button type="button" class="tc-15-btn m weak disabled" data-event="cancelattach">卸载</button>                <button type="button" class="tc-15-btn m weak disabled" data-event="refund">销毁/退还</button>                  <div class="tc-15-dropdown tc-15-dropdown-btn-style" id="cbs-list-more-action-button">                    <a href="javascript:void(0);" class="tc-15-dropdown-link">更多操作 <i class="caret"></i>                    </a>                    <ul class="tc-15-dropdown-menu">                      <li b-if="isTagWhite" role="presentation" class="disabled" data-event="editTag">                        <a role="menuitem" href="javascript:;">编辑标签</a>                      </li>                      <li role="presentation" class="disabled" data-event="BindAutoSnapshotPolicy">                        <a role="menuitem" href="javascript:;">设置定时快照策略</a>                      </li>                    </ul>                  </div>              </div>              <div class="col">                <div id="searchArea"></div>                <button type="button" class="tc-15-btn m weak refresh" data-event="refresh" qc-popover="刷新">刷新</button>                <button type="button" class="tc-15-btn m weak setting" data-event="set_Fields" qc-popover="设置"                        data-hot="yunzhuji.setfields" data-grid-setting="true">设置</button>                <button type="button" class="tc-15-btn m weak download" data-event="exports" qc-popover="导出实例列表">导出实例列表</button>              </div>            </div>          </div>          <div id="cbsList" class=""></div>        </div>      </div>    </div>  </div>',{isI18n:j.isI18n()}),"cvm"),ea&&(ja=50),ra.param=g.extend(d(),this.param,!0),this.bee=D.mount(h.appArea.children(".manage-area")[0],O.getBeeConfig()),this.bee.$set("isI18nUser",ba),this.bee.$set("isCbsPostpaidWhite",fa),this.bee.$set("isTagWhite",ga),this.cbsListEl=g("#cbsList"),this.searchAreaEl=g("#searchArea"),this.operAreaEl=g("#operArea"),ba||M.show(),this.renderBtnGroup(),this.initGridView(),this.initSearchBox(),this.bindEvent()},destroy:function(){ba||M.destroy()},initSearchBox:function(){var a=this;if(/backfrom=cbsdetai/.test(location.search)){var b=localStorage.getItem("CBS_QUERY_CONDITION");a.param=b&&JSON.parse(b)||a.param}P.setDefaultData(a.param),P.init({searchValue:a.param,callback:function(b){var c=(b.Filters||[]).reduce(function(a,b){return a[b.Name]=b.Values,a},{});aa=b,a.gridView.zoneNameFilter&&a.gridView.zoneNameFilter.setFilterResult(c.zone?c.zone:null),a.gridView.portableFilter&&a.gridView.portableFilter.setFilterResult(c.portable?c.portable:null),a.gridView.storageTypeFilter&&a.gridView.storageTypeFilter.setFilterResult(c["disk-type"]?c["disk-type"]:null),a.gridView.diskTypeFilter&&a.gridView.diskTypeFilter.setFilterResult(c["disk-usage"]?c["disk-usage"]:null),a.gridView.storageStatusFilter&&a.gridView.storageStatusFilter.setFilterResult(c["disk-state"]?c["disk-state"]:null),a.gridView.payModeDescFilter&&a.gridView.payModeDescFilter.setFilterResult(c["disk-charge-type"]?c["disk-charge-type"]:null),a.param=b,a.diffData(a.searchData&&a.searchData.Filters,b&&b.Filters)||(a.searchData=g.extend(!0,{},b),a.renderList(g.extend(!0,{page:1},b)))}}),a.renderList(a.param)},renderBtnGroup:function(){var a=this;this.regionWrapperEl=g("#regionWrapper"),aa={Filters:[{Name:"project-id",Values:[-1]}]},R.getValidRegions().then(function(b){var c=b.regionList;a.regionList=c,a.regionPills=new Q({renderTo:g("#regionGroup"),data:c,newMode:!0,change:function(b){var c=a.regionPills.val();j.setRegionId(c),a.gridView.page=1,a.gridView.count=ja,a.getList(),a.checkEvent([])}}),a.regionPills.val(a.getRegionId({})),a.renderRegionNumber()})},renderRegionNumber:function(){var a=this.regionPills,b=this.regionList;m.queryUserDiskResources().then(function(c){var d=a.val(),e=c&&c.response.resourcesDetailSet;e&&e.length&&(b.forEach(function(a){var b=e.find(function(b){for(var c in U.REGIONIDMAP)if(U.REGIONIDMAP[c]==b.region){b.regionId=c;break}return a.value==b.regionId});b&&(b.diskNumber||0==b.diskNumber)&&(a.name=a.regionName+"("+b.diskNumber+")"),a.active=a.value==d?1:void 0}),a.setData(b),j.setRegionId(d))})},renderList:function(a){var b=[].slice.call(arguments);this.getList.apply(this,b)},bindEvent:function(){var a=this,b=(this.bee,this.cbsListEl),c={buystorage:function(b){u.init({projectId:a.getProjectId(),
regionId:a.getRegionId(),zoneList:Z,projectList:$,whiteListMap:_,isI18n:ba,callback:function(){setTimeout(function(){a.renderRegionNumber.call(a)},2e3),a.refresh.call(a)}})},set_Fields:function(){a.gridView.showFieldsManager()},cancelattach:function(){if(!g(this).is(".disabled")){var b=a.gridView.getSelected();b.length>0&&a.exec("cancelattach",b)}},cbsattach:function(){if(!g(this).is(".disabled")){var b=a.gridView.getSelected();b.length>0&&a.exec("attach",b)}},exports:function(){a.queryInstanceParams=a.getFilter(a.param),a.isAsyncExport=ca;var b=new x({listIns:a});b.exec()},refund:function(){if(!g(this).is(".disabled")){var b=a.gridView.getSelected();b.length>0&&a.exec("refund",b)}},modifyprops:function(){},editTag:function(){if(!g(this).is(".disabled")){var b=a.gridView.getSelected();b.length>0&&a.exec("editTag",b)}},BindAutoSnapshotPolicy:function(){if(!g(this).is(".disabled")){var b=a.gridView.getSelected();b.length>0&&a.exec("BindAutoSnapshotPolicy",b)}},refresh:a.refresh.bind(a)};g("#operArea").on("click","[data-event]",function(a){var b=g(a.currentTarget),d=b.attr("data-event");d in c&&c[d].apply(this,arguments)}),g("#operArea").on("click","#cbs-list-more-action-button",function(a){g(a.currentTarget).removeClass("tc-15-menu-active").addClass("tc-15-menu-active"),a.stopPropagation()}),b.on("mouseenter",".item-row",function(a){g(this).find(".pencil-icon").css("visibility","visible")}).on("mouseleave",".item-row",function(a){g(this).find(".pencil-icon").css("visibility","hidden")}),g(document).on("click",function(){b.find("tr[data-diskId] .tc-15-menu-active").hide(),b.find("tr[data-diskId] .tc-15-menu-disabled").show(),g("#operArea").find("#cbs-list-more-action-button").removeClass("tc-15-menu-active")})},exec:function(a,b){var c=this;switch(b||(b=c.gridView.getSelected()),a){case"attach":q.init(b,{projectId:c.getProjectId(),regionId:c.getRegionId(),callback:c.refresh.bind(c)});break;case"modifyalias":r.init(b,{callback:c.refresh.bind(c)});break;case"createsnapshot":s.init(b,{projectId:c.getProjectId(),regionId:c.getRegionId(),isI18n:ba,callback:c.refresh.bind(c)});break;case"cancelattach":t.init(b,{projectId:c.getProjectId(),regionId:c.getRegionId(),callback:c.refresh.bind(c)});break;case"renew":v.init(b,{projectId:c.getProjectId(),regionId:c.getRegionId()});break;case"upgradedisk":w.init(b[0],{projectId:c.getProjectId(),regionId:c.getRegionId(),callback:c.refresh.bind(c),isI18n:c.isI18n});break;case"changeproject":y.init(b,{projectId:c.getProjectId(),regionId:c.getRegionId(),callback:c.refresh.bind(c)});break;case"exports":c.queryInstanceParams=c.getFilter(c.param),c.isAsyncExport=ca;var d=new x({listIns:c});d.exec();break;case"refund":N.init(b,{callback:function(){setTimeout(function(){c.renderRegionNumber.call(c)},2e3),c.refresh.call(c)}});break;case"editTag":T.init(b,{regionId:c.getRegionId(),callback:c.refresh.bind(c)});break;case"modifyprops":z.init(b,{projectId:c.getProjectId(),regionId:c.getRegionId(),callback:c.refresh.bind(c)});break;case"BindAutoSnapshotPolicy":B.init(b,{projectId:c.getProjectId(),regionId:c.getRegionId(),callback:c.refresh.bind(c)})}},initGridView:function(){ia||(oa.payModeDescFilterOptions=oa.payModeDescFilterOptions.filter(function(a){return"CDCPAID"!=a.value}));var a=this,b={$data:{whiteListMap:_||{},hasFirst:!0,firstColWith:"36px",order:1,initGetData:!1,canResizeColum:!1,selectedHighlight:!1,gridWidth:g("#cbsList").width()-68,colums:a.getColumns(),list:[],canSelectTotal:!1,autoMaxHeight:!0,maxHeightOffset:10,autoCheckWidth:!1,showState:!0,showPagination:!0,totalNum:0,trackKey:"uuid",searchItemName:"实例"},$mixins:[k("cbs_fields")],getHeadContent:function(a){return"zoneName"===a.key?'<grid-view-header-filter b-ref="zoneNameFilter" b-with="{ ready: zoneNameFilterReady.bind(this.$root), filterOptions: zoneNameFilterOptions, col: col, change: filterchange(\'zone\').bind(this.$root) }"></grid-view-header-filter>':"diskState"===a.key?'<grid-view-header-filter b-ref="storageStatusFilter" b-with="{ ready: storageStatusFilterReady.bind(this.$root) ,filterOptions: storageStatusFilterOptions, col: col, change: filterchange(\'disk-state\').bind(this.$root) }"></grid-view-header-filter>':"diskTypeDesc"===a.key?'<grid-view-header-filter b-ref="diskTypeFilter" b-with="{ ready: diskTypeFilterReady.bind(this.$root),filterOptions: diskTypeFilterOptions, col: col, change: filterchange(\'disk-usage\').bind(this.$root) }"></grid-view-header-filter>':"storageTypeDesc"===a.key?'<grid-view-header-filter b-ref="storageTypeFilter" b-with="{ ready: storageTypeFilterReady.bind(this.$root),filterOptions: storageTypeFilterOptions, col: col, change: filterchange(\'disk-type\').bind(this.$root) }"></grid-view-header-filter>':"payModeDesc"===a.key?'<grid-view-header-filter b-ref="payModeDescFilter" b-with="{ ready: payModeDescFilterReady.bind(this.$root),filterOptions: payModeDescFilterOptions, col: col, change: filterchange(\'disk-charge-type\').bind(this.$root) }"></grid-view-header-filter>':"attachedDesc"===a.key?'<grid-view-header-filter b-ref="portableFilter" b-with="{ ready: portableFilterReady.bind(this.$root),filterOptions: portableFilterOptions, col: col, change: filterchange(\'portable\').bind(this.$root) }"></grid-view-header-filter>':void 0},getCellContent:function(b,c,d){return a.getCellContent(b,c,d)},renderRenewTip:function(a){var b={PREPAID:"与CVM一同购买的云硬盘，在CVM续费时，将一并续费",POSTPAID_BY_HOUR:"按量计费的云硬盘，无需续费，请保持账户余额充足",CDCPAID:"不计费的云硬盘，无需续费，请保持账户余额充足"};return b[a]||""},renderUpgradeTip:function(a){return"SYSTEM_DISK"==a.diskUsage?"扩容系统盘需要前往实例控制台进行重装系统操作，建议您挂载新的数据盘或扩容原有数据盘":1!=a.portable?"非弹性数据盘扩容需要在实例控制台进行调整硬盘操作":""},storageStatusFilterOptions:oa.storageStatusFilterOptions,diskTypeFilterOptions:oa.diskTypeFilterOptions,storageTypeFilterOptions:oa.storageTypeFilterOptions,payModeDescFilterOptions:oa.payModeDescFilterOptions,portableFilterOptions:oa.portableFilterOptions,zoneNameFilterReady:function(a){this.zoneNameFilter=a},portableFilterReady:function(a){this.portableFilter=a},storageTypeFilterReady:function(a){this.storageTypeFilter=a},diskTypeFilterReady:function(a){this.diskTypeFilter=a},storageStatusFilterReady:function(a){this.storageStatusFilter=a},payModeDescFilterReady:function(a){this.payModeDescFilter=a},filterchange:function(a){return function(b){b&&!aa.Filters&&(aa.Filters=[]);for(var c=!1,d=aa.Filters||[],e=0;e<d.length;e++)if(d[e].Name===a){d[e].Values=b?b:void 0,c=!0;break}!c&&b&&aa.Filters.push({Name:a,Values:b}),aa.Filters=d.filter(function(a){return a.Values=a.Values&&a.Values.filter(function(a){return void 0!=a}),a.Values&&0!==a.Values.length}),d.length||delete aa.Filters;var f=aa.Filters&&aa.Filters.some(function(a){return"project-id"===a.Name});f||aa.Filters.unshift({Name:"project-id",Values:[-1]}),P.setSearchValue(aa.Filters);var g=P.boxContainer.tagSearchRef;g.notify(g.state.tags)}},setTrAttr:function(a,b){return a={"data-diskId":b.diskId},b.$loading&&(a["data-isLoading"]=!0),a},getSlectItem:function(b){var c=[];return g(a.gridView.list).each(function(a,d){g(b).each(function(a,b){var e=g(b).closest("tr").data("diskid");d.diskId==e&&c.push(d)})}),c},events:{"click tr .tc-15-dropdown":function(b){b.stopPropagation(),g(b.currentTarget).find("a.tc-15-dropdown-link").hasClass("disable")||(a.cbsListEl.find("tr[data-diskId] .tc-15-menu-active").hide(),a.cbsListEl.find("tr[data-diskId] .tc-15-menu-disabled").show(),g(b.currentTarget).hasClass("tc-15-menu-active")?(g(b.target).closest("td").find(".tc-15-menu-active").hide(),g(b.target).closest("td").find(".tc-15-menu-disabled").show()):(g(b.target).closest("td").find(".tc-15-menu-active").show(),g(b.target).closest("td").find(".tc-15-menu-disabled").hide()))},"click tr [data-event=cbsdetail]":function(b){var c=a.gridView.getSlectItem(b.target),d=a.param||{};if(d.innerSearch||d.Filters&&d.Filters.length){try{localStorage.setItem("CBS_QUERY_CONDITION",JSON.stringify(d))}catch(e){console.warn(e)}C.navigate("/cvm/cbs/detail?backfrom=cbsdetail&diskId="+c[0].diskId)}else C.navigate("/cvm/cbs/detail?diskId="+c[0].diskId)},"click tr [data-event=cbs_view]":function(b){var c=g(b.target).closest("tr").data("index"),d=function(a){var b=g("#cbsList"),c=b.find('tr[data-diskId="'+a+'"]');c.length&&(b.find("input:checkbox").removeProp("checked"),c.find("input:checkbox").prop("checked","true"))};K.showList(a.gridView.list,c,d)},"click tr [data-event=cbsattach]":function(b){var c=a.gridView.getSlectItem(b.target);a.gridView.updateselect(c),q.init(c,{projectId:a.getProjectId(),regionId:a.getRegionId(),callback:a.refresh.bind(a)})},"click tr [data-event=cancelattach]":function(b){var c=a.gridView.getSlectItem(b.target);a.gridView.updateselect(c),t.init(c,{projectId:a.getProjectId(),regionId:a.getRegionId(),callback:a.refresh.bind(a)})},"click tr [data-event=modifyalias]":function(b){var c=a.gridView.getSlectItem(b.target);a.gridView.updateselect(c),r.init(c,{callback:a.refresh.bind(a)})},"click tr [data-event=createsnapshot]":function(b){var c=a.gridView.getSlectItem(b.target);a.gridView.updateselect(c),s.init(c,{projectId:a.getProjectId(),regionId:a.getRegionId(),isI18n:ba,callback:a.refresh.bind(a)})},"click tr [data-event=renew]":function(b){var c=a.gridView.getSlectItem(b.target);v.init(c,{projectId:a.getProjectId(),regionId:a.getRegionId()}),a.gridView.updateselect(c)},"click tr [data-event=upgradedisk]":function(b){var c=a.gridView.getSlectItem(b.target);a.gridView.updateselect(c),w.init(c[0],{projectId:a.getProjectId(),regionId:a.getRegionId(),callback:a.refresh.bind(a),isI18n:a.isI18n})},"click tr [data-event=changeproject]":function(b){var c=a.gridView.getSlectItem(b.target);a.gridView.updateselect(c),y.init(c,{projectId:a.getProjectId(),regionId:a.getRegionId(),callback:a.refresh.bind(a)})},"click tr [data-event=modifyprops]":function(b){var c=a.gridView.getSlectItem(b.target);a.gridView.updateselect(c),z.init(c,{projectId:a.getProjectId(),regionId:a.getRegionId(),callback:a.refresh.bind(a)})},"click tr [data-event=exports]":function(b){a.queryInstanceParams=a.getFilter(a.param),a.isAsyncExport=ca;var c=new x({listIns:a});c.exec()},"click tr [data-event=refund]":function(b){var c=a.gridView.getSlectItem(b.target);a.gridView.updateselect(c),N.init(c,{callback:function(){setTimeout(function(){a.renderRegionNumber.call(a)},2e3),a.refresh.call(a)}})},"click tr[data-diskId] input[type=checkbox]":function(b){var c=a.gridView.getSlectItem(g("tr[data-diskId] input[type=checkbox]:checked"));a.checkEvent(c)},"click tr :checkbox:eq(0)":function(b){a.checkEvent(a.gridView.list)},"click tr [data-event=setAutoRenew]":function(b){var c=a.gridView.getSlectItem(b.target);v.setAutoRenew(c,{projectId:a.getProjectId(),regionId:a.getRegionId(),callback:a.refresh.bind(a)}),a.gridView.updateselect(c)},"click tr [data-event=editTag]":function(b){var c=a.gridView.getSlectItem(b.target);a.gridView.updateselect(c),T.init(c,{regionId:a.getRegionId(),callback:a.refresh.bind(a)})},"click tr [data-event=modifyDiskType]":function(b){var c=a.gridView.getSlectItem(b.target);a.gridView.updateselect(c),A.init(c,{regionId:a.getRegionId(),callback:a.refresh.bind(a)})},"click tr [data-event=bindASP]":function(b){var c=a.gridView.getSlectItem(b.target);a.gridView.updateselect(c),B.init(c,{regionId:a.getRegionId(),callback:a.refresh.bind(a)})}},updateselect:function(b){var c={};g(a.gridView.list).each(function(b,d){c[d.diskId]=b,a.gridView.updateItem(b,{$selected:!1})}),g(b).each(function(b,d){a.gridView.updateItem(c[d.diskId],{$selected:!0})})},getData:function(b,c){this.order=b.order,this.orderField=b.orderField,this.page=b.page,this.count=b.count,a.getList(),a.checkEvent([])}};O.syncThen(function(c){if(c){a.isI18n=c;var d=b.$data,e=d.colums=d.colums.filter(function(a){return a.i18n!==!1});a.gridView&&a.gridView.setColums(e)}}),a.gridView=new S(b),a.cbsListEl.append(a.gridView.$el),a.gridView.count=ja,this.gridLoaded=!1},updateListHeadZone:function(a){var b=this.gridView.zoneNameFilter.$data.filterOptions;b&&b.splice.apply(b,[0,b.length].concat(a.map(function(a){return{label:a.zoneName,value:H.ZONEIDMAP[a.zoneId]}})))},goDetail:function(a){var b=this,c=a.diskId||a.storageId,d=a.rid||b.getRegionId();o.init({diskId:c,regionId:d,projectId:b.getProjectId()},{formatData:b.formatData,callback:function(){C.navigate("/cvm/cbs")}})},execContextMenu:function(a,b){ra.execRowMenuItem(a,b)},execRowMenuItem:function(a,b){for(var c=g(a).attr("data-index"),d=this.gridView,e=0,f=d.list.length;f>e;e++)d.$refs.list[e].$set({$selected:!1});d.$refs.list[c].$set({$selected:!0}),this.selectedChange(),this.exec(b.attr("data-name"))},getProjectId:function(a){return j.getProjectId()},getRegionId:function(a){return j.getRegionId()},getFilter:function(a){a=a||{};for(var b in a)a[b]||delete a[b];var c=this.gridView.page;a&&a.page>0&&(c=a.page,delete a.page);var d=this.gridView.count;a&&a.count>0&&(d=a.count,delete a.count);var e=g.extend(!0,{offset:(c-1)*d,limit:d,regionId:this.getRegionId()},a);return-1==e.projectId&&delete e.projectId,e&&(e.Filters=e.Filters&&e.Filters.filter(function(a){return!("project-id"===a.Name&&-1===a.Values[0])})),e},getList:function(a){var b=this,c=(this.operAreaEl,this.gridView.zoneNameFilter.$data.filterOptions);a=g.extend(!0,{},a||this.param),a=this.getFilter(a),Promise.all([m.queryDisks(a,{camTips:!1}),new Promise(function(a,c){m.queryZone(b.getRegionId({})).then(function(b){a(b)},function(){a([])})}),m.getProjects()]).then(function(d){var e=d[0],f=d[1],g=$=d[2];Z=f.slice(),(W!==j.getRegionId()||0===c.length)&&(b.updateListHeadZone(f),W=b.getRegionId()),P.setData({zoneList:f,projectList:g});var h=e.response.diskSet,i=e.response.totalCount,k=[];b.gridLoaded=!0;for(var l=0,n=h.length,o=0;n>l;l++)""!=h[l].instanceId&&-1==k.indexOf(h[l].instanceId)&&(k[o++]=h[l].instanceId),h[l].autoRenewFlag="NOTIFY_AND_AUTO_RENEW"==h[l].renewFlag;var p={};if(g.forEach(function(a){p[a.projectId]=a.name}),h.map(function(a){a.projectName=p[a.placement.projectId]||"-",a.encryptDesc=a.encrypt?"加密":"非加密"}),k.length){var q=b.getRegionId();J.getRegion(q);m.getCvmListWithStatus({regionId:q,limit:k.length,offset:0,filters:[{name:"instance-id",values:k}]}).then(function(c){var d=c&&c.instances&&c.instances.deviceList,e=b.formatData(h,f,d);if(ea){var g=b.gridView.$refs.pager;g.maxCount=100,g.minCount=50,g.countInterval=50}b.gridView.setData({list:e,totalNum:i,page:Math.floor(a.offset/a.limit)+1,count:a.limit}),V&&V.hottag("renderCbsList","gotCbsList"),b.checkTask(),e&&e.length>0||b.gridView.showTips('<span class="text"></span>您查看的对象已不存在或没有权限查看')},function(){b.gridView.setData({list:[],totalNum:0,page:a.page,count:a.count}),b.gridView.checkCellWidth(),b.gridView.showTips("系统繁忙，请稍后重试。")})}else{var r=b.formatData(h,f);b.gridView.checkCellWidth(),b.gridView.setData({list:r,totalNum:i,page:Math.floor(a.offset/a.limit)+1,count:a.limit,orderField:a.orderField,order:a.order}),V&&V.hottag("renderCbsList","gotCbsList"),b.checkTask(),r&&r.length>0||b.gridView.showTips('<span class="text"></span>您查看的对象已不存在或没有权限查看')}},function(c){if(b.gridView.setData({list:[],totalNum:0,page:a.page,count:a.count}),b.gridView.checkCellWidth(),L.isCamRefused(c))b.gridView.showTips("<cam-tips>"+c.message+"</cam-tips>");else{var d=c&&c.message||p.defaultReqErr;n.error(d)}})},statusDescMapTxt:{ATTACHED:["已挂载","success"],UNATTACHED:["待挂载","warning"],ATTACHING:["挂载中",""],DETACHING:["卸载中",""],EXPANDING:["扩容中",""],TORECYCLE:["待回收","danger"],CREATESNAPSHOT:["创建快照中",""],ROLLBACKING:["回滚中",""],DUMPING:["拷贝磁盘中",""]},statusDesc:function(a){var b=this.statusDescMapTxt[a.diskState],c=["ATTACHING","DETACHING","EXPANDING","CREATESNAPSHOT","ROLLBACKING","DUMPING"];a.statusDesc=b?b[0]:"未知状态",a.statusDesClass=b?b[1]:"success",a.$loading=!1,g.inArray(a.diskState,c)>=0&&(a.$loading=!0)},formatTag:function(a){var b="";return b+=a.map(function(a){return a.key+":"+a.value}).join(",")},formatData:function(a,b,c){var c;void 0!=c&&(c=c);var d=ra;return g(a).each(function(f,g){if(g.diskTypeDesc=G.DISK_USAGE_MAP[g.diskUsage],g.deleteWithInstanceDesc=g.deleteWithInstance?"随实例释放":"不随实例释放",g.storageTypeDesc=G.DISK_TYPE_MAP[g.diskType],g.payModeDesc=G.DISK_CHARGE_TYPE_MAP[g.diskChargeType],g.instanceName="",c&&c.length)for(var h=0,i=c.length;i>h;h++)g.instanceId==c[h].uInstanceId&&(g.instanceState=c[h].instanceState,g.instanceExpiredTime=c[h].expiredTime,g.instanceName=c[h].alias,g.instanceIsAutoRenew="NOTIFY_AND_AUTO_RENEW"==c[h].renewFlag,g.instanceIsPrepay="PREPAID"==c[h].instanceChargeType,g.instanceFamily=c[h].instanceFamily,g.instanceCPU=c[h].cpu,g.instanceMemory=c[h].mem);""===g.deadlineTime&&(g.deadlineTime=null),g.isBannedAll=qa.indexOf(g.diskState)>-1,g.isModifyProps="SYSTEM_DISK"!==g.diskUsage&&"PREPAID"!==g.diskChargeType,g.isAttach=!1,g.isUpgrade=!1,g.isCancelAttach=!1,g.isAlias=!1,g.isRenew=!1,g.isSnapAbility=!1,g.isChangeProject=!1,g.isExports=!0,g.isRefund=!1,g.isEditTag=!0,g.isTagWhite=ga,g.isCBSOnlineResize=ha,g.isUp=function(){var b=a.length,c=!1;return b>=5&&f>b-5&&(c=!0),6>=b&&3>f&&(c=!1),c}(),g.snapshotAbility&&l.SNAPSHOT_REGION_LIST.indexOf(j.getRegionId()+"")>-1&&(g.isSnapAbility=!0),g.rollbacking&&(g.isSnapAbility=!1),g.portable&&"PREPAID"==g.diskChargeType&&(g.isRenew=!0);var k=b.find(function(a){return a.zone==g.placement.zone});g.storageSizeDesc=g.diskSize+"G",g.zone=g.placement.zone,g.zoneId=H.ZONEV3TOZONEIDMAP[g.placement.zone]||k&&k.zoneId,g.zoneName=H.ZONEIDV3TONAMEMAP[g.placement.zone]||k&&k.zoneName||g.placement.zone,g.regionId=d.getRegionId(),g.deadlineTimeDesc=e(g),g.isModifyDiskType=!g.migrating&&"DATA_DISK"==g.diskUsage&&g.portable&&"ap-guangzhou-1"!=g.zone&&"TORECYCLE"!=g.diskState,g.tagStr=g.tags&&d.formatTag(g.tags),d.statusDesc(g),["ATTACHED","UNATTACHED"].indexOf(g.diskState)>-1&&(g.isAlias=!0,g.attached?g.portable&&(g.isCancelAttach=!0):g.portable&&(g.isAttach=!0),"DATA_DISK"==g.diskUsage?g.isChangeProject=!0:"SYSTEM_DISK"==g.diskUsage&&(g.usagereason="系统盘项目跟随挂载的实例，不支持独立调整")),"TORECYCLE"==g.diskState&&g.attached&&(g.isCancelAttach=!0),d.canDiskUpgrade(g)&&(g.isUpgrade=!0),g.attachedDesc=g.portable?"支持":"不支持",g.attached?g.reason="已挂载云硬盘不支持退还":("POSTPAID_BY_HOUR"==g.diskChargeType||"CDCPAID"==g.diskChargeType)&&g.portable||g.isReturnable?g.isRefund=!0:g.reason=pa[g.returnFailCode],g.migrating&&(g.isAttach=!1,g.isCancelAttach=!1,g.isRefund=!1,g.isUpgrade=!1,g.isSnapAbility=!1)}),a},diffData:function(a,b){try{if(!a&&b)return!1;if(a.length!==b.length)return!1;for(var c=0;c<a.length;c++){if(a[c].Name!==b[c].Name)return!1;if(a[c].Values.length!==b[c].Values.length)return!1;for(var d=0;d<a[c].Values.length;d++)if(a[c].Values[d]!==b[c].Values[d])return!1}return!0}catch(e){return!1}},canDiskUpgrade:function(a){var b=ra,c=!1;return["ATTACHED","UNATTACHED"].indexOf(a.diskState)>-1&&b.isexpired(a.deadlineTime)&&(a.portable?a.attached?(ha&&I.isRunning(a.instanceState)||I.isStopped(a.instanceState))&&(c=!0):c=!0:"DATA_DISK"==a.diskUsage&&I.isStopped(a.instanceState)&&(c=!0)),c},isexpired:function(a){var b=!1;if(a&&"0000-00-00 00:00:00"!=a){var c=new Date(a.replace(/\-/g,"/"));(new Date).getTime()<c.getTime()&&(b=!0)}else b=!0;return b},getCellContent:function(a,b,c){if("diskId"==c.key)return la({item:b});if("diskState"==c.key){var d="";if("POSTPAID_BY_HOUR"==b.diskChargeType||"CDCPAID"==b.diskChargeType||b.autoRenewFlag||!b.portable||"TORECYCLE"==b.diskState);else{var f=[],g="";if(0==b.differDaysOfDeadline)var g="该云硬盘将于今天回收，到时将不可用，请尽快续费";else if(b.differDaysOfDeadline>0&&b.differDaysOfDeadline<=7)var g="该云硬盘将于 "+b.differDaysOfDeadline+" 天后到期，请尽快续费";else if(b.differDaysOfDeadline<0&&b.differDaysOfDeadline>=-7)var g="该云硬盘将于 "+(b.differDaysOfDeadline+7)+" 天后回收，到时将不可用，请尽快续费";g&&f.push(g),b.instanceId&&"PREPAID"==b.diskChargeType&&b.instanceIsPrepay&&!b.autoRenewFlag&&(b.deadlineError&&f.push("当前云硬盘到期时间早于挂载的实例"),b.instanceIsAutoRenew&&f.push("检测到云硬盘当前挂载了自动续费的实例，但该云硬盘未设置为自动续费")),f.forEach(function(a,b){d+=b+1+". "+a+"<br>",b==f.length-1&&(d+="<br>")}),f.length&&(d+="请及时续费或者<a href='javascript:;' data-event=setAutoRenew>设置自动续费</a>，避免业务中断")}var h="";return d&&(h='<span class="text-overflow m-width"><i class="plaint-icon" qc-popover="'+d+'"></i></span>'),'<div>\n							<div class="text-'+b.statusDesClass+'">'+b.statusDesc+h+"</div>\n						</div>"}if("instanceId"==c.key){if(b.instanceId){"TORECYCLE"==b.diskState?'<span data-title="进入待销毁状态前挂载的实例，当前已卸载" class="new-mark-icon"></span>':"";return 0==b.attached?i.tmpl('<div><p><a class="text-warning" data-event="nav" data-title="该虚拟机为弹性云盘欠费前关联的实例，您重新挂载后可使用"             href="/cvm/detail/<%=regionId%>/<%=instanceId%>"><%=instanceId%></a></p> <p><span class="text-overflow" title="<%=instanceName%>">            <%=instanceName%></span></p></div>',b):i.tmpl('<div><p><a data-event="nav" href="/cvm/detail/<%=regionId%>/<%=instanceId%>"><%=instanceId%></a></p>               <p><span class="text-overflow" title="<%=instanceName%>"><%=instanceName%></span></p></div>',b)}return"<div>-</div>"}if("dedicatedCluster"==c.key)return i.tmpl('  <div>    <% if(item.placement.cdcId) { %>    <div class="til">      <p><span><%=item.placement.cdcId %> </span></p>    </div>    <p>      <span class="text-overflow" title="<%=item.placement.cdcName %>">        <%= item.placement.cdcName %>      </span>    </p>    <% } else { %>    -    <% }  %>  </div>',{item:b});if("_operCol"==c.key)return void 0;if("_monitor"==c.key)return i.tmpl('  <div data-event="cbs_view">    <a href="javascript:void(0)">      <i class="dosage-icon"></i>    </a>  </div>',{});if("storageTypeDesc"==c.key)return'<div><p class="text-overflow">'+a+'</p> <p class="text-overflow">'+b.diskSize+"GB</p></div>";if("payModeDesc"==c.key){var j=e(b);return'<div><p class="text-overflow">'+b.payModeDesc+'</p> <span class="'+("PREPAID"==b.diskChargeType&&b.differDaysOfDeadline<=14?"text-danger":"")+'">'+j+"</span></div>"}return"tagStr"==c.key?'<div><p><span class="text-overflow" title="'+b.tagStr+'">'+b.tagStr+"</span></p></div>":"<div>"+(a||"")+"</div>"},getColumns:function(){var a=[{key:"diskId",name:"ID/名称",_minWidth:84,_maxWidth:132,priority:1,required:!0,orderField:"alias"},{key:"_monitor",name:"监控",_minWidth:24,_maxWidth:72,priority:2,required:!0},{key:"diskState",name:"状态",_minWidth:48,_maxWidth:120,priority:3,required:!0},{key:"zoneName",name:"可用区",_minWidth:72,_maxWidth:120,priority:4,required:!0},{key:"diskTypeDesc",name:"属性",_minWidth:48,_maxWidth:84,priority:5},{key:"storageTypeDesc",name:"配置",_minWidth:60,_maxWidth:120,priority:6},{key:"instanceId",name:"关联实例",_minWidth:72,_maxWidth:360,priority:7},{key:"payModeDesc",name:"计费方式",i18n:!1,_minWidth:78,_maxWidth:198,priority:8},{key:"deleteWithInstanceDesc",name:"随实例释放",_minWidth:72,_maxWidth:96,priority:9},{key:"attachedDesc",name:"	可卸载",_minWidth:72,_maxWidth:84,priority:10,i18n:!1,hide:!0},{key:"dedicatedCluster",name:"	独享集群",_minWidth:84,_maxWidth:96,priority:11,hide:!0},{key:"encryptDesc",name:"加密",_minWidth:36,_maxWidth:84,priority:12,hide:!0},{key:"projectName",name:"项目",_minWidth:60,_maxWidth:192,priority:13,hide:!0},{key:"tagStr",name:"标签",_minWidth:96,_maxWidth:192,priority:14,hide:!0},{key:"_operCol",name:"操作",required:!0,_minWidth:152,_maxWidth:160,priority:15,tdTpl:'  <action b-if="notI18n()" act="renew" disabled="{{!item.isRenew  || item.isBannedAll}}"    title="{{ renderRenewTip(item.diskChargeType) }}">    续费</action>  <action act="createsnapshot" disabled="{{!item.isSnapAbility || item.isBannedAll}}">创建快照</action>  <div class="tc-15-dropdown tc-15-menu-disabled">    <a href="javascript:;"      class="tc-15-dropdown-link tc-15-dropdown-link-special {{ item.storageStatus == \'toRecycle\'? \'disable\' : \'\'}}">更多      <i class="caret"></i>    </a>  </div>  <div class="tc-15-dropdown tc-15-menu-active {{item.isUp ? \'tc-15-dropup\' : \'\'}}" style="display: none;">    <a href="javascript:" class="tc-15-dropdown-link ">更多      <i class="caret"></i>    </a>    <div class="tc-15-dropdown-menu-box">      <ul class="tc-15-dropdown-menu" role="menu">        <li b-if="notI18n()" class="{{(!item.isUpgrade || item.isBannedAll) ? \'disabled\' :\'\'}}">          <action act="upgradedisk" disabled="{{!item.isUpgrade || item.isBannedAll}}" title="{{renderUpgradeTip(item)}}">            扩容          </action>        </li>        <li b-if="notI18n()" class="{{(!item.isAttach || item.isBannedAll) ? \'disabled\' :\'\'}}">          <action act="cbsattach" disabled="{{!item.isAttach || item.isBannedAll}}">挂载</action>        </li>        <li b-if="notI18n()" class="{{(!item.isCancelAttach || item.isBannedAll) ? \'disabled\' :\'\'}}">          <action act="cancelattach" disabled="{{!item.isCancelAttach || item.isBannedAll}}">卸载</action>        </li>        <li>          <action act="bindASP">设置定期备份策略</action>        </li>        <li b-if="whiteListMap.cbs_type_transfer"          class="{{(!item.isModifyDiskType || item.isBannedAll) ? \'disabled\' :\'\'}}">          <action act="modifyDiskType" disabled="{{!item.isModifyDiskType || item.isBannedAll}}">调整云硬盘类型</action>        </li>        <li b-if="!item.autoRenewFlag" class="{{(!item.isRenew || item.isBannedAll) ? \'disabled\' :\'\'}}">          <action act="setAutoRenew" disabled="{{!item.isRenew || item.isBannedAll}}">设置自动续费</action>        </li>        <li b-if="item.autoRenewFlag" class="{{(!item.isRenew || item.isBannedAll) ? \'disabled\' :\'\'}}">          <action act="setAutoRenew" disabled="{{!item.isRenew || item.isBannedAll}}">取消自动续费</action>        </li>        <li class="{{(!item.isChangeProject || item.isBannedAll) ? \'disabled\' :\'\'}}">          <action act="changeproject" title={{item.usagereason}}            disabled="{{!item.isChangeProject || item.isBannedAll}}">分配至项目</action>        </li>        <li class="{{(!item.isRefund || item.isBannedAll) ? \'disabled\' :\'\'}}">          <action act="refund" title={{item.reason}} disabled="{{!item.isRefund || item.isBannedAll}}">销毁/退还</action>        </li>        <li class="{{(!item.isModifyProps||item.isBannedAll) ? \'disabled\' :\'\'}}">          <action act="modifyprops" title="系统盘、包年包月数据盘不支持修改属性" disabled="{{!item.isModifyProps||item.isBannedAll}}">修改属性          </action>        </li>        <li b-if="item.isTagWhite" class="{{!item.isEditTag ? \'disabled\' :\'\'}}">          <action act="editTag" title={{item.reason}} disabled="{{!item.isEditTag}}">编辑标签</action>        </li>      </ul>    </div>  </div>'}];return a.forEach(function(b,c){(!da&&"encryptDesc"==b.key||!ia&&"dedicatedCluster"==b.key)&&a.splice(c,1)}),a},selectedChange:function(){var a=this.gridView.getSelected();this.toggleBtnStatus(a,g("#operArea"))},toggleBtnStatus:function(a,b){var c=new E({dataItems:a,operAction:ka}),d=c.getAuth();ka.forEach(function(a){var c=b.find('[data-name="'+a+'"]');0==d[a].code?j.enableBtn(c):j.disableBtn(c,d[a].tip)})},checkEvent:function(a){var b=[],c=[],d=[],e=!0,f="",h=[],i=[];g(a).each(function(a,g){g&&g.isAttach&&b.push(g),g&&g.isCancelAttach&&c.push(g),g&&g.isEditTag&&d.push(g),-1==i.indexOf(g.diskChargeType)&&i.push(g.diskChargeType),e&&(g.isRefund?h.push(g.diskId):(e=!1,f=g.reason))});var j=g("#operArea").find("[data-event=cancelattach]"),k=g("#operArea").find("[data-event=cbsattach]"),l=g("#operArea").find("[data-event=editTag]");0===b.length&&0===c.length&&0==a.length?(k.addClass("disabled").attr("data-title","请选择需要挂载的云硬盘"),j.addClass("disabled").attr("data-title","请选择需要卸载的云硬盘"),l.addClass("disabled").attr("data-title","请选择需要编辑标签的云硬盘")):(b.length==a.length?b.length>ma?k.addClass("disabled").attr("data-title","批量挂载数量不可大于10"):k.removeClass("disabled").attr("data-title",""):k.addClass("disabled").attr("data-title","待挂载且未做任务的弹性云硬盘才可以挂载"),c.length==a.length?c.length>ma?j.addClass("disabled").attr("data-title","批量卸载数量不可大于10"):j.removeClass("disabled").attr("data-title",""):j.addClass("disabled").attr("data-title","已挂载且未做任务的弹性云硬盘才可以卸载"),d.length==a.length&&(d.length>na?l.addClass("disabled").attr("data-title","批量编辑标签的磁盘数量不可大于20"):l.removeClass("disabled").attr("data-title","")));var m=g("#operArea").find("[data-event=BindAutoSnapshotPolicy]");0==a.length?m.removeClass("disabled").addClass("disabled").attr("data-title","请选择云硬盘"):m.removeClass("disabled").attr("data-title","");var n=g("#operArea").find("[data-event=refund]");0==a.length?n.addClass("disabled").attr("data-title","请选择需要销毁的云硬盘"):a.length>50?n.addClass("disabled").attr("data-title","单次退还云硬盘的数量上限为 50"):(i.length>1&&(e=!1,f="不支持同时销毁包年包月和按量计费云硬盘"),e&&h.length?n.removeClass("disabled").attr("data-title",""):n.addClass("disabled").attr("data-title",f))},refresh:function(){this.renderList(),this.checkEvent([])},checkTask:function(){var a=this,b=this.cbsListEl.find("[data-grid-body] tr");this.isWating=!1,b.each(function(b,c){var d=g(c);return d.attr("data-isLoading")?(a.isWating=!0,!1):void 0}),this.clearCheckTask(),this.isWating?this.watingTime=setTimeout(function(){b.find(":checkbox:checked").length||j.isContextMenuShow()||F.isMenuActivated(b)?a.checkTask():Y&&(a.refresh(),Y--)},5e3):this.setmaxReqNum()},setmaxReqNum:function(){Y=100},clearCheckTask:function(){clearTimeout(this.watingTime)}};c.exports={render:function(b,c){var d=arguments&&arguments.length;2==d||(1==d?(c=b,b=""):(c=b,b={})),j.getRegionId()>0?"":j.setRegionId(1),c&&c.storageIds&&(c.storageIds=c.storageIds.split(",")),ra.param=c,Promise.all([m.queryWhiteList(),O.isI18n()]).then(function(d){var e=d[0];_=e,ba=d[1],fa=!!e.cbs_postpay,ga=!!e.CBS_TAG_WL,ha=!!e.MC_CBS_online_resize,da=e.cbs_encryption&&e.cbs_encryption.length>0,ea=e.CVM_LARGERLIST&&e.CVM_LARGERLIST.length>0,ca=e.ASYNC_EXPORT_CBS&&e.ASYNC_EXPORT_CBS.length>0,ia=e.CBS_dedicated_cluster&&e.CBS_dedicated_cluster.length>0;var f=!!e.cbs_console_new;f?a.async("modules/cvm/cbs_new/cbs_new",function(a){a&&a.render(b,c)}):"detail"==b?("string"==typeof c&&(c={diskId:c}),ra.goDetail(c)):ra.render()},function(){ra.render()})},destroy:function(){ba||M.destroy()},formatData:ra.formatData}}),define("cvm/cbs2/cbsutil",function(a,b,c){var d=a("cvm/common/constants"),e=a("cvm/cbs2/constants");c.exports={getDiskTypeNameByDiskType:function(a){return e.DISKTYPE[a]},getDiskTypeNameByStorageType:function(a){return e.STORAGETYPE[a]},getTypeByDiskType:function(a){return e.DISKTYPE_TYPE_MAP[a]},getTypeByStorageType:function(a){return e.STORAGETYPE_TYPE_MAP[a]},isPrepaidPayMode:function(a){return"prepay"===a},isSecondPayMode:function(a){return"postPay"==a},isLocalDiskType:function(a){return e.DISKCATEGORY.LOCAL.filter(function(b){return b==a}).length},isCloudDiskType:function(a){return a=e.STORAGETYPE_DISKTYPE_MAP[a]||a,e.DISKCATEGORY.CLOUD.filter(function(b){return b==a}).length},isLocalBasicDiskType:function(a){return"LOCAL_BASIC"==a},isLocalSSDDiskType:function(a){return"LOCAL_SSD"==a},isCloudBasicDiskType:function(a){return"CLOUD_BASIC"==a},isCloudSSDDiskType:function(a){return"CLOUD_SSD"==a},isCloudPremiumDiskType:function(a){return"CLOUD_PREMIUM"==a},isCloudBasicStorageType:function(a){return"cloudBasic"==a},isCloudSSDStorageType:function(a){return"cloudSSD"==a},isCloudPremiumStorageType:function(a){return"cloudPremium"==a},storageTypeToDiskType:function(a){return e.STORAGETYPE_DISKTYPE_MAP[a]},parseAspPolicy:function(a){var b={1:"一",2:"二",3:"三",4:"四",5:"五",6:"六",0:"日"};if(!a.policy||a.policy.length<1)return"";var c=a.policy[0],d=[];return d.push("每周"),c.dayOfWeek.forEach(function(a,e){d.push(b[a]),e==c.dayOfWeek.length-1?d.push("，"):d.push("、")}),c.hour.forEach(function(a,b){d.push(a>10?a:"0"+a),d.push(":00"),b==c.hour.length-1?d.push("，"):d.push("、")}),d.push("自动创建快照，"),a.isPermanent?d.push("永久保留"):d.push("保留"+a.retentionDays+"天后自动删除"),d.join("")},getRegion:function(a){return d.REGIONIDMAP[a]},getZone:function(a){return d.ZONEIDMAP[a]}}}),define("cvm/cbs2/constants",function(a,b,c){var d={DISKTYPE:{LOCAL_BASIC:"本地硬盘",CLOUD_BASIC:"普通云硬盘",LOCAL_SSD:"本地SSD硬盘",CLOUD_SSD:"SSD云硬盘",CLOUD_PREMIUM:"高性能云硬盘",CLOUD_ENHANCEDSSD:"增强型SSD云硬盘",LOCAL_PRO:"本地SATA硬盘",LOCAL_NVME:"本地NVMe SSD盘"},DISKTYPE_TYPE_MAP:{LOCAL_BASIC:1,CLOUD_BASIC:2,LOCAL_SSD:3,CLOUD_SSD:5,CLOUD_PREMIUM:6,LOCAL_PRO:7,LOCAL_NVME:8,CLOUD_ENHANCEDSSD:9},DISKCATEGORY:{LOCAL:["LOCAL_BASIC","LOCAL_SSD","LOCAL_PRO"],
CLOUD:["CLOUD_BASIC","CLOUD_SSD","CLOUD_PREMIUM","CLOUD_ENHANCEDSSD"]},STORAGETYPE:{cloudBasic:"普通云硬盘",cloudSSD:"SSD云硬盘",cloudPremium:"高性能云硬盘",cloudESSD:"增强型SSD云硬盘"},STORAGETYPE_TYPE_MAP:{cloudBasic:2,cloudSSD:5,cloudPremium:6,cloudESSD:9},STORAGETYPE_DISKTYPE_MAP:{cloudBasic:"CLOUD_BASIC",cloudSSD:"CLOUD_SSD",cloudPremium:"CLOUD_PREMIUM",cloudESSD:"CLOUD_ENHANCEDSSD"},DISKTYPE_DISKUSAGE_MAP:{data:"DATA_DISK",root:"SYSTEM_DISK"},DISKUSAGE_DISKTYPE_MAP:{DATA_DISK:"data",SYSTEM_DISK:"root"},DISKTYPE_STORAGETYPE_MAP:{CLOUD_BASIC:"cloudBasic",CLOUD_SSD:"cloudSSD",CLOUD_PREMIUM:"cloudPremium",CLOUD_ENHANCEDSSD:"cloudESSD "},DISK_USAGE_MAP:{SYSTEM_DISK:"系统盘",DATA_DISK:"数据盘"},DISK_TYPE_MAP:{CLOUD_BASIC:"普通云硬盘",CLOUD_PREMIUM:"高性能云硬盘",CLOUD_SSD:"SSD云硬盘",CLOUD_ENHANCEDSSD:"增强型SSD云硬盘"},DISK_CHARGE_TYPE_MAP:{PREPAID:"包年包月",POSTPAID_BY_HOUR:"按量计费",CDCPAID:"不计费"},DISK_CHARGE_TYPE_PAYMODE_MAP:{PREPAID:"prePay",POSTPAID_BY_HOUR:"postPay"},DISK_STATE_DESC_MAP:{ATTACHED:"已挂载",UNATTACHED:"待挂载",ATTACHING:"挂载中",DETACHING:"卸载中",EXPANDING:"扩容中",TORECYCLE:"待回收",CREATESNAPSHOT:"创建快照中",ROLLBACKING:"回滚中",DUMPING:"拷贝磁盘中"},DISK_ERROR_TIP:{"InvalidDiskId.NotFound":"硬盘不存在","InternalError.ResourceOpFailed":"正在执行任务中","InvalidDisk.TypeError":"硬盘类型错误",InvalidParameterValue:"参数无效","InvalidParameterValue.LimitExceeded":"参数值数量超过限制","InvalidDisk.NotPortable":"此硬盘不是弹性云硬盘",MissingParameter:"参数缺失","InvalidDisk.Attached":"云硬盘已挂载","InvalidDisk.NotSupported":"云硬盘不支持该操作","InvalidInstance.NotSupported":"实例不支持挂载云盘","InvalidInstanceId.NotFound":"输入实例的InstanceId不存在"}};c.exports=d}),define("cvm/cbs2/data",function(a,b,c){var d=a("$"),e=a("manager"),f=a("appUtil"),g=a("cvm/common/model"),h=a("cvm/cvm/data"),i=a("models/iaas");c.exports={setCbsAutoRenewFlag:function(a,b){var c=a.regionId,d=_objectWithoutProperties(a,["regionId"]);return g.apiRequest({regionId:c,serviceType:"cbs",action:"ModifyDisksRenewFlag",data:d},b)},getRole:function(a,b){return new Promise(function(c,d){i.apiRequest({serviceType:"cam",action:"GetRole",regionId:b||f.getRegionId(),data:a},{tipErr:!1}).then(function(a){var b=a&&a.data&&a.data.roleName;c(!!b)},function(a){c(!1)})})},queryDiskStoragePool:function(a,b,c){return g.apiRequest({regionId:b||f.getRegionId(),serviceType:"cbs",action:"DescribeDiskStoragePool",data:a},c)},queryUserDiskResources:function(a,b){return g.apiRequest({action:"DescribeUserDiskResources",serviceType:"cbs",regionId:1},b)},ModifyAddressesAttribute:function(a,b){return a.Version="2018-04-19",i.apiRequest({regionId:b||f.getRegionId(),action:"ModifyAddressesAttribute",serviceType:"vpc",data:a})},detachCbsStoragesCgi:function(a,b){var c=a.regionId,d=_objectWithoutProperties(a,["regionId"]);return g.apiRequest({regionId:c,serviceType:"cbs",action:"DetachDisks",data:d},b)},getCVmCbsNum:function(a,b){var c=a.regionId,d=_objectWithoutProperties(a,["regionId"]);return g.apiRequest({regionId:c,serviceType:"cbs",action:"DescribeInstancesDiskNum",data:d})},queryDiskConfigQuota:function(a){var b=a.regionId,c=_objectWithoutProperties(a,["regionId"]);return g.apiRequest({regionId:b,cmd:"DescribeDiskConfigQuota",serviceType:"cbs",data:c})},attachDisks:function(a,b){var c=a.regionId,d=_objectWithoutProperties(a,["regionId"]);return g.apiRequest({regionId:c,action:"AttachDisks",serviceType:"cbs",data:d})},getCvmList:function(a){return new Promise(function(b,c){var d="query instances ($filters: [Filter], $limit: Int, $offset: Int, $ipAddresses: [String], $innerSubnetIds: [String], $innerVpcIds: [String], $vagueIpAddress: String, $vagueInstanceName: String){\n					instances(filters: $filters, limit: $limit, offset: $offset, ipAddresses: $ipAddresses, vagueIpAddress: $vagueIpAddress, innerSubnetIds: $innerSubnetIds, innerVpcIds: $innerVpcIds, vagueInstanceName: $vagueInstanceName) {\n						totalNum: totalCount\n						deviceList: nodes{\n							uInstanceId:id\n							alias:name\n						}\n					}\n				}";a=a||{},a.query=a.query||d,a.filters=a.filters||[],h.queryCvmList(a).then(function(a){b(a)})})},getCvmListWithStatus:function(a,b){var c="query instances ($filters: [Filter], $limit: Int, $offset: Int, $ipAddresses: [String], $innerSubnetIds: [String], $innerVpcIds: [String], $vagueIpAddress: String, $vagueInstanceName: String){\n                instances(filters: $filters, limit: $limit, offset: $offset, ipAddresses: $ipAddresses, vagueIpAddress: $vagueIpAddress, innerSubnetIds: $innerSubnetIds, innerVpcIds: $innerVpcIds, vagueInstanceName: $vagueInstanceName) {\n                    totalNum: totalCount\n                    deviceList: nodes{\n                        uInstanceId:id\n                        alias:name\n						uuid\n						deviceId\n						placement {\n							zone\n							zoneId\n							zoneName\n							projectId\n							hostId\n						}\n						instanceType\n            instanceFamily\n            instanceState\n						instanceTypeDesc\n						instanceChargeType\n						cpu\n						mem:memory\n						systemDisk {\n							diskId\n							diskType\n							diskSize\n						}\n						dataDisks {\n                            diskId\n                            diskType\n                            diskSize\n                    	}\n\n						createdTime\n						expiredTime\n						privateIpAddresses\n						publicIpAddresses\n						internetAccessible {\n                            internetChargeType\n                            internetMaxBandwidthOut\n                            publicIpAssigned\n                        }\n                        errorCode\n						errorKey\n						renewFlag\n                    }\n                }\n            }",d=a;return d.filters=d.filters||[],d.limit=d.limit||20,d.offset=d.offset||0,g.graphql({query:c,variables:d,regionId:a.regionId},b)},queryDisks:function(a,b){var c=a.regionId,d=_objectWithoutProperties(a,["regionId"]);return g.apiRequest({regionId:c,action:"DescribeDisks",serviceType:"cbs",data:d},b)},modifyStorageAttr:function(a,b){var c=a.regionId,d=_objectWithoutProperties(a,["regionId"]);return g.apiRequest({regionId:c,action:"ModifyDiskAttributes",serviceType:"cbs",data:d})},queryRenewDiskPrice:function(a,b){var c=a.regionId,d=_objectWithoutProperties(a,["regionId"]);return g.apiRequest({action:"InquiryPriceRenewDisks",serviceType:"cbs",data:d,regionId:c},b)},getRenewDiskOrderParams:function(a,b){var c=a.regionId,d=_objectWithoutProperties(a,["regionId"]);return g.apiRequest({action:"SwitchParameterRenewDisks",serviceType:"cbs",data:d,regionId:c},b)},queryRenewDIskGeneral:function(a,b){return Promise.all([this.queryRenewDiskPrice(a,b),this.getRenewDiskOrderParams(a,b)])},createSnapshot:function(a,b){var c=a.regionId,d=_objectWithoutProperties(a,["regionId"]);return g.apiRequest({regionId:c,action:"CreateSnapshot",serviceType:"cbs",data:d})},querySnapshotPrice:function(a){var b=a.regionId,c=_objectWithoutProperties(a,["regionId"]);return g.apiRequest({cmd:"InquiryPriceCreateSnapshots",serviceType:"cbs",data:c,regionId:b},{camTipsType:"dialog"})},toPay2:function(a){var b="https://"+QCBUY_HOST+"/order/check";"[object Array]"!==Object.prototype.toString.call(a)&&(a=[a]);var c={itemDetails:{raw_goodsData:a}};f.submitForm(b,c)},queryWhiteList:function(){var a=["CVM_SSD_CBS_WHITELIST","CVM_SSD_CBS_SH_1_WHITELIST","premium_cbs","CVM_Premium_CBS_SH_1_WHITELIST","cbs_16TB","cbs_encryption","CBS_REFUND","cbs_encryption","CVM_LARGERLIST","cbs_postpay","CBS_snapshorts_WHITELIST","cbs_auto_snap","ASYNC_EXPORT_CBS","CBS_SS_REGIONCOPY_WL","CBS_TAG_WL","MC_CBS_online_resize","instance_image","cbs_type_transfer","CBS_dedicated_cluster","cbs_console_new"];return new Promise(function(b,c){e.queryWhiteList({whiteKey:a},function(a){b(a)},function(a){c(a)})})},getProjects:function(){return new Promise(function(a,b){e.getProjects(function(b){setTimeout(function(){a(b.data)},0)},b)})},queryZone:function(a){return h.queryZone(a)},getAccounts:function(a){var b=d.Deferred();return e.getAccounts(a,function(a){b.resolve(a)},function(a){b.reject(a)}),b},getOperatelogList:function(a){var b=d.Deferred();return e.getOperatelogList(a,function(a){b.resolve(a)},function(a){b.reject(a)},!0),b},resizePostpaidDiskPortable:function(a,b){var c=a.regionId,d=_objectWithoutProperties(a,["regionId"]);return g.apiRequest({regionId:c,action:"ResizeDisk",serviceType:"cbs",data:d})},resizePostpaidDiskUnportable:function(a,b){var c=a.regionId,d=_objectWithoutProperties(a,["regionId"]);return g.apiRequest({regionId:c,action:"ResizeInstanceDisks",serviceType:"cvm",data:d},b)},queryResizeDiskPrice:function(a){return g.apiRequest({cmd:"InquiryPriceResizeDisk",serviceType:"cbs",data:{DiskSize:a.diskSize,DiskId:a.diskId,ProjectId:a.projectId},regionId:a.regionId})},getResizeDiskOrderParams:function(a,b){var c=a.regionId,d=_objectWithoutProperties(a,["regionId"]);return g.apiRequest({action:"SwitchParameterResizeDisk",serviceType:"cbs",data:d,regionId:c})},createDisk:function(a){return g.apiRequest({cmd:"CreateDisks",serviceType:"cbs",data:a.data,regionId:a.regionId})},queryCreateDiskPrice:function(a){return g.apiRequest({cmd:"InquiryPriceCreateDisks",serviceType:"cbs",data:a.data,regionId:a.regionId})},queryResizeInstanceDiskPrice:function(a){var b=a.regionId,c=_objectWithoutProperties(a,["regionId"]);return g.apiRequest({cmd:"InquiryPriceResizeInstanceDisks",serviceType:"cvm",data:c,regionId:b})},getTagKeyList:function(){return g.apiDelegate({action:"GetTagKeys",serviceType:"tag",regionId:1,data:{page:1,rp:1e3}},{classicResponse:!1,camTips:!1})},getTagValueList:function(a){return g.apiDelegate({action:"GetTagValues",serviceType:"tag",regionId:1,data:{page:1,rp:1e3,tagKeys:a.tagKeys}},{classicResponse:!1,camTips:!1})}}}),define("cvm/cbs2/event/attach",function(a,b,c){function d(b,c,d,A,B){var C=[],D=[],E=[];i(b).each(function(a,b){C.push(b.diskId),"PREPAID"==b.diskChargeType?D.push(b.diskId):E.push(b.diskId)}),j.create(l.tmpl(u.attach,{diskIds:C.join(";"),showReleaseFlag:c.showReleaseFlag,hasPrepaidFlag:c.hasPrepaidFlag}),"600","",{title:"挂载到实例",preventResubmit:!1,button:{" 确定 ":function(a){var b=(n.DISK_ERROR_TIP,i(g.$el).find(":radio:checked"));if(0===b.length)return void m.error("请选择实例");if(!h||!D.length||null!==z){var d=b.closest("tr").data("instanceid"),e=M.$get("optVal"),f=(M.$get("payAmount"),{diskIds:C,instanceId:d,regionId:c.regionId,deleteWithInstance:i("#delete-on-termination").prop("checked")});2==e&&(f.alignType="AUTO_RENEW"),o.attachDisks(f).then(function(a){1==e&&z?o.toPay2(z):(j.hide(),m.loading("挂载中"),setTimeout(function(){c&&c.callback&&c.callback()},250))})}}}});var F=function(){var a=[{key:"radio",name:" ",_minWidth:16,_maxWidth:16,required:!0},{key:"uInstanceId",name:"ID/名称",required:!0},{key:"attachedNum",name:"已挂载/总可挂载",required:!0},{key:"deadline",name:"实例到期时间",required:!0}],b=i("#dialog_cvmList").width()-v;return a=t(a,null,b)},G={$data:{hasFirst:!1,initGetData:!1,canResizeColum:!1,selectedHighlight:!1,maxHeight:290,minHeight:"auto",autoMaxHeight:!1,maxHeightOffset:10,count:5,colums:F(),list:[],showState:!1,showPagination:!0,searchItemName:"实例"},getCellContent:function(a,b,c){if("radio"==c.key)return'<div class="tc-15-first-radio"><input type="radio" class="tc-15-radio" '+(g.sUInstanceId==b.instanceId?"checked   ":"")+(b.maxAttachNum-b.attachedNum>0&&"BMS4"!==b.instanceFamily?"":"disabled")+"></div>";if("uInstanceId"==c.key)return'<div><p><a href="/cvm/detail/'+b.regionId+"/"+b.instanceId+'">'+b.instanceId+'</a></p><p><span class="text-overflow">'+b.instanceName+"</span></p></div>";if("attachedNum"==c.key&&void 0!==b.maxAttachNum)return'<div class="text-center"><span class="text-overflow">'+b.attachedNum+"/"+b.maxAttachNum+"</span></div>";if("deadline"==c.key){var d=b.expiredTime;return d=b.instanceChargeType==q.INSTANCEPAYMODE.PREPAID?"<div><p>包年包月</p><p>"+p.formatDate(new Date(b.expiredTime),"yyyy-MM-dd hh:mm:ss")+" 到期</p></div>":"<div><p>"+(q.INSTANCEPAYMODETITLE[b.instanceChargeType]||"-")+"</p><p>"+p.formatDate(new Date(b.createdTime),"yyyy-MM-dd hh:mm:ss")+" 创建</p></div>"}},getHeadContent:function(a){return"attachedNum"===a.key?'<div class="text-center"><span class="text-overflow">已挂载/总可挂载</span></div>':void 0},setTrAttr:function(a,b){return{"data-instanceid":b.instanceId,"data-deadline":b.expiredTime,"data-cvmpaymode":b.instanceChargeType}},events:{"click tr":function(a){z=null;var b=i(a.target).closest("tr").find(":radio").prop("disabled");if(!b){i(this.$el).find(":radio").prop("checked",!1),i(a.target).closest("tr").find(":radio").prop("checked",!0),M.$set({confirmOption3:!1}),i("#delete-on-termination").prop("checked",!1),i("#delete-on-termination").prop("disabled",!1);var d=i(a.target).closest("tr").data("cvmpaymode"),e=p.formatDate(new Date(i(a.target).closest("tr").data("deadline")),"yyyy-MM-dd hh:mm:ss");if(h=d==q.INSTANCEPAYMODE.PREPAID){var f=[];i(D).each(function(a,b){f.push({curInstanceDeadline:e})}),f.length&&o.queryRenewDIskGeneral({regionId:c.regionId,diskIds:D,diskChargePrepaids:f},{tipErr:!1}).then(function(a){var b=a[0]&&a[0].response||{},c=b&&b.diskPrice&&b.diskPrice.discountPrice;M.$set("deadLine",e),M.$set("payAmount",c),b=a[1]&&a[1].response||{};var d=b&&b.needAlignWithInstance;M.$set({optVal:d?1:2,optionList:d?w:w.slice(-2),optionTips:d?x[0]:x[1],warnTips:h?y[0]:y[1]}),i(M.$el).show(),z=b.DiskOrder})["catch"](function(a){M.$set("deadLine",e),M.$set("payAmount",0),M.$set({optVal:2,optionList:w.slice(-2),optionTips:x[0]}),i(M.$el).show(),z=[]})}else M.$set("payAmount",0),i(M.$el).hide();j&&j.center()}}},getData:function(a){var d=a.count,h=d*(a.page-1),i=a.keyword||L.getKeyword(),j=f(i,b[0].placement.zone)||{};s.queryCvmList2(Object.assign({},j,{limit:d,offset:h,regionId:c.regionId})).then(function(b){e(b.response,a.page,d,g)},function(){g.showTips("系统繁忙，请稍后重试。"),e({},a.page,d,g)})}},H=k.getComponent("grid-view");g=new H(G),r.render({hasPermItems:b,actionName:"挂载",renderTo:"#selectedshow"}),i("#dialog_cvmList").append(g.$el);var I=i("#cbsCheckBox").find('input[type="checkbox"]').eq(0);I.prop("checked",!0),I.click(function(){I.prop("checked")?i("#cbsCheckBox .text-danger").css("display","none"):i("#cbsCheckBox .text-danger").css("display","block")});var J=j.el.find("#searchArea"),K=k.components["qc-search"],L=new K({$data:{keyword:"",searchEmpty:!0,multiple:!0,placeholder:"请输入实例ID、实例名或实例IP（换行分隔）"},search:function(a){g.getData({keyword:a,page:1,count:g.count})}});J.html("").append(L.$el),J.on("keydown",function(a){window.event?window.event.cancelBubble=!0:evt.stopPropagation()});var M=new k(u.option,{$data:{showOPtion:!1,toI18nMoney:a("widget/i18n").toI18nMoney},$afterInit:function(){var a=this;this.$watch("optVal",function(b){3==b?(a.$set("confirmOption3",!1),j.toggleBtnDisable(!0)):j.toggleBtnDisable(!1)}),this.$watch("confirmOption3",function(b){3==a.$get("optVal")&&j.toggleBtnDisable(!b)})}});j.el.find(".renew-form").append(M.$el),g.regionId=c.regionId,e(d,1,5,g,A),g.checkCellWidth(),j&&j.center()}function e(a,b,c,d,e){if(1===e)return void d.showTips("<cam-tips>"+a.message+"</cam-tips>");if(2===e)return void d.showTips("<error-tips>"+a.message+"</error-tips>");var f=i(d.$el).find(":radio:checked");if(f.length>0&&(d.sUInstanceId=f.eq(0).closest("tr").data("instanceid")),a&&a.instanceSet&&a.instanceSet.length>0){var g=[];if(i(a.instanceSet).each(function(a,b){b.regionId=d.regionId,g.push(b.instanceId)}),0==g.length)return;o.getCVmCbsNum({instanceIds:g}).then(function(e){var f=e.response.attachDetail.reduce(function(a,b){return a[b.instanceId]={attachedDiskCount:b.attachedDiskCount,maxAttachCount:b.maxAttachCount},a},{});i(a.instanceSet).each(function(a,b){var c=f[b.instanceId];c||(c={maxAttachNum:0,attachedDiskCount:0,count:0}),b.attachedNum=c.attachedDiskCount,b.maxAttachNum=c.maxAttachCount,b.attachDetail=c}),d.setData({list:a.instanceSet,totalNum:a.totalCount,page:b,count:c})})}else d.showTips('<span class="text"></span>您查看的对象已不存在或没有权限查看')}function f(a,b){var c=/^(?:(?:[1-9]?[0-9]|1[0-9]{2}|2(?:[0-4][0-9]|5[0-5]))\.){3}(?:[1-9]?[0-9]|1[0-9]{2}|2(?:[0-4][0-9]|5[0-5]))$/,d=/^\d{1,3}((\.(\d{1,3})?)?){0,3}$/,e=/\n/,f={},g=[{name:"zone",values:[b]},{name:"instance-state",values:["RUNNING","STOPPED"]}];if(a)if(e.test(a)){for(var h,i=a.replace(/\s+/,"\n").split("\n"),j=[],k=!1,l=0;h=i[l];l++){if(!c.test(h))return m.error("暂不支持批量模糊搜索,请检查输入");if(0==l&&(k=!0),!k)return m.error("暂不支持批量模糊搜索,请检查输入");j.push(h)}j&&j.length>0&&(f.ipAddresses=j)}else/^ins-\w{8}$/.test(a)?g.push({name:"instance-id",values:[a]}):d.test(a)?f.vagueIpAddress=a:f.vagueInstanceName=a;return f.filters=g,f}var g,h,i=a("$"),j=a("dialog"),k=a("qccomponent"),l=a("util"),m=a("tips"),n=a("cvm/cbs2/constants"),o=a("cvm/cbs2/data"),p=a("appUtil"),q=a("cvm/common/constants"),r=a("cvm/cbs2/event/selectedShow"),s=a("cvm/cvm/data"),t=a("cvm/common/components/columsWidth/ColumsWidth"),u={attach:'  <div id="selectedshow"> </div>  <div class="tc-15-msg">    手动挂载云硬盘后，云硬盘作为云服务器的数据盘使用，默认为脱机状态。您需要对数据盘进行格式化、分区及创建文件系统等初始化操作。详情可见    <a href="https://cloud.tencent.com/document/product/362/5745" target="_blank">      挂载云硬盘    </a>  </div>  <div class="renew-form old-hang">    <div class="tc-15-option-hd">      <h4>请选择实例</h4>    </div>    <div class="tc-15-table-panel">      <div class="search-wrap" id="searchArea"></div>      <div id="dialog_cvmList"></div>      <% if (showReleaseFlag) { %>      <label class="form-ctrl-label" id="delete-on-termination-container" style="margin-left: 10px">释放行为：        <input type="checkbox" class="tc-15-checkbox" id="delete-on-termination" disabled>随实例释放</label>      <% if (hasPrepaidFlag) { %>      <p class="text-danger" style="margin-left: 10px">释放行为仅在按量计费数据盘上生效，包年包月数据盘暂不支持设置</p>      <% } %>      <% } %>    </div>    <!--<div id="cbsCheckBox" style="margin-top: 15px;">          <label class="form-ctrl-label"><input type="checkbox" class="tc-15-checkbox">自动续费</label>          <p class="text-weak text-danger" style="display:none">            由于虚拟机与弹性云硬盘的到期回收时间不一致，如欠费时会被隔离，中断业务，建议您开启该云硬盘的自动续费功能          </p>        </div> -->  </div>',cvmListNull:'  <div class="ui-popmsg">    <div class="info">      <span class="tit">没有可用的实例</span>      <% if (hasEncryptCbs) {%>      <p>加密云硬盘暂时不支持挂载至系统盘为本地盘的实例上</p>      <% } else {%>      <p>您在        <%=zoneName || ""%>没有实例，挂载云硬盘只能挂载到同一可用区下的实例      </p>      <% } %>    </div>  </div>',option:'  <div class="param-box" style="display: none;">    <div class="param-bd">      <ul class="form-list">        <li>          <div class="form-label">            <label for="">挂载选项              <i class="plaint-icon" data-title="{{optionTips}}"></i>            </label>          </div>          <div class="form-input">            <div class="form-unit is-success" b-on="events" style="padding-top:6px">              <label b-repeat="item in optionList" class="form-ctrl-label-stacked">                <input type="radio" name="attachOption" class="tc-15-radio" b-model="optVal"                  value="{{item.val}}">{{item.name}} {{ item.val == \'1\' && deadLine ? deadLine : ""}}              </label>              <!-- <p class="form-input-help text-weak text-danger" b-if="warnTips && optVal==3">{{warnTips}}</p> -->              <!-- <p class="form-input-help" b-if="deadLine && optVal==1">对齐实例的到期时间，到期时间将延长至 {{deadLine}}</p> -->            </div>          </div>        </li>        <li class="vm-text-row" b-if="payAmount>0 && optVal==1">          <div class="form-label">            <label for="">补齐费用</label>          </div>          <div class="form-input">            <span class="cost">              <strong>{{toI18nMoney(payAmount, \'words\')}}</strong>            </span>          </div>        </li>      </ul>      <p b-if="optVal==3">        <label class="form-ctrl-label-stacked">          <input type="checkbox" class="tc-15-checkbox"            b-model="confirmOption3">您需了解：选择当前挂载选项，云硬盘可能在实例到期前被隔离，导致业务中断。建议您挂载前对齐实例到期时间补齐费用，或开启该云硬盘的自动续费功能。</label>      </p>    </div>  </div>',diffZone:'  <div class="ui-popmsg">    <div class="info">      <span class="tit"></span>      <p>仅支持批量挂载在同一可用区的CBS云硬盘</p>    </div>  </div>'},v=36,w=[{val:"1",name:"对齐实例到期时间，到期时间将延长至"},{val:"2",name:"硬盘到期后按月自动续费"},{val:"3",name:"直接挂载，不做续费处理（不推荐）"}],x=["为避免预付费（包年包月）的实例与云硬盘到期时间不一致，导致欠费隔离时影响实例运行，建议您启用云硬盘自动续费，或将云硬盘资源的到期时间与实例补齐","为避免后付费（按小时计费）的实例与云硬盘到期时间不一致，导致欠费隔离时影响实例运行，建议您启用云硬盘自动续费"],y=["当实例与云硬盘的到期回收时间不一致，欠费时云硬盘会被隔离，中断业务，建议您挂载前自动补齐费用，或开启该云硬盘的自动续费功能","当实例与云硬盘的到期回收时间不一致，欠费时云硬盘会被隔离，中断业务，建议您挂载前启该云硬盘的自动续费功能"],z=null;c.exports={init:function(a,b,c){var e=null,f=!0,g=!1,h=!1;if(a.forEach(function(a){null==e?e=a.placement.zone:a.placement.zone!=e&&(f=!1),"POSTPAID_BY_HOUR"===a.diskChargeType||"CDCPAID"===a.diskChargeType?g=!0:h=!0}),!f)return void j.create(l.tmpl(u.diffZone),"550","",{title:"挂载到实例",button:{" 确定 ":function(a){j.hide()}}});var k=[{name:"zone",values:[a[0].placement.zone]},{name:"instance-state",values:["RUNNING","STOPPED"]}],m=a.some(function(a){return a.encrypt});m&&k.push({name:"system-disk.disk-type",values:["CLOUD_BASIC","CLOUD_SSD","CLOUD_PREMIUM"]}),s.queryCvmList2({filters:k,limit:5,offset:0,regionId:b.regionId}).then(function(c){c.response&&c.response.instanceSet&&c.response.instanceSet.length?d(a,i.extend({},b,{showReleaseFlag:g,hasPrepaidFlag:h}),c.response):j.create(l.tmpl(u.cvmListNull,i.extend({},{hasEncryptCbs:m},a[0])),"550","",{title:"挂载到实例",preventResubmit:!1,button:{" 去购买 ":function(a){window.open("//buy.qcloud.com/cvm?regionId="+b.regionId)}}})})}}}),define("cvm/cbs2/event/bindAutoSnapshotPolicy",function(a,b,c){var d=a("dialog"),e=a("cvm/cbs2/event/selectedShow"),f=a("tips"),g=a("qccomponent"),h=a("cvm/snapshot2/autoPolicy/event/create/create"),i=a("cvm/snapshot2/data");c.exports={init:function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],b=arguments[1],c=b.regionId,j=b.callback,k=new g({$tpl:'    <div>        <div class="tc-15-msg msg-dot">            <div class="tip-info">                <ul>                    <li class="dot-item">                        请注意，仅支持选中实例的云硬盘支持定期数据备份，不支持本地盘数据备份。                    </li>                    <li class="dot-item">定期数据备份将对云硬盘定期创建快照，<span                            class="text-danger">快照已正式商业化，请您关注因此产生的费用</span>。有关快照的更多的信息，请参考<a class="guide-link"                            target="_blank" href="//cloud.tencent.com/document/product/362/5754">快照简介<i                                class="external-link-icon"></i> </a>。</li>                </ul>            </div>        </div>        <ul class="form-list">            <li class="pure-text-row">                <div class="form-label">                    <label for="">定期备份策略</label>                </div>                <div class="form-input">                    <div class="form-unit">                        <div class="tc-15-select-wrap m">                            <select b-if="autoSnapshotPolicyList.length" class="tc-15-select"                                b-model="autoSnapshotPolicyId">                                <option b-repeat="item in autoSnapshotPolicyList" value="{{item.autoSnapshotPolicyId}}"                                    title="{{item.tip}}" selected?="item.autoSnapshotPolicyId == autoSnapshotPolicyId">                                    {{item.label}}</option>                            </select>                            <select b-if="!autoSnapshotPolicyList.length" class="tc-15-select">                                <option selected disabled>无</option>                            </select>                            <span b-if="autoSnapshotPolicy" class="inline-help-text" qc-popover="<ul>                                    <li>                                      <h3>ID/名称</h3>                                    </li>                                    <li>{{autoSnapshotPolicy.autoSnapshotPolicyId}}({{autoSnapshotPolicy.autoSnapshotPolicyName}})</li>                                    <li>                                      <h3>日期</h3>                                    </li>                                    <li>{{autoSnapshotPolicy.dayOfWeekDesc}}</li>                                    <li>                                      <h3>时间</h3>                                    </li>                                    <li>{{autoSnapshotPolicy.hourDesc}}</li>                                    <li>                                        <h3>保留时间</h3>                                    </li>                                    <li>{{autoSnapshotPolicy.retentionDaysDesc}}</li>                                  </ul>">策略详情<i class="plaint-icon"></i></span>                            <span><a href="javascript:;" class="inline-help-text"                                    b-on-click="createASP()">新建定期备份策略</a></span>                        </div>                        <p class="form-input-help ">设置定期备份可有效保护数据安全，备份数据将产生额外费用，请见<a                                href="//cloud.tencent.com/document/product/362/5754" target="_blank"                                rel="noopener noreferrer">价格总览</a></p>                    </div>                </div>            </li>        </ul>    </div>',$data:{autoSnapshotPolicyList:[],autoSnapshotPolicyId:""},$afterInit:function(){var a=this;i.queryAutoSnapshotPolicies({data:{filters:[{name:"auto-snapshot-policy-state",values:["NORMAL"]}],TryCreateDefaultAutoSnapshotPolicy:!0,offset:0,limit:100},regionId:c}).then(function(b){var c=b.response.autoSnapshotPolicySet,d=void 0===c?[]:c;a.$set({autoSnapshotPolicyList:i.formatAspList(d),autoSnapshotPolicyId:d.length?d[0].autoSnapshotPolicyId:""})}),this.$watch("[autoSnapshotPolicyId, autoSnapshotPolicyList]",function(){var a=this;this.autoSnapshotPolicyId&&this.autoSnapshotPolicyList&&this.autoSnapshotPolicyList.length?(d.toggleBtnDisable(!1),this.$set("autoSnapshotPolicy",this.autoSnapshotPolicyList.find(function(b){return b.autoSnapshotPolicyId===a.autoSnapshotPolicyId}))):(d.toggleBtnDisable(!0),this.$set("autoSnapshotPolicy",null))},!0)},bindASP:function(){i.bindAutoSnapshotPolicy({regionId:c,aspId:this.autoSnapshotPolicyId,diskIds:a.map(function(a){var b=a.diskId;return b})}).then(function(){f.success("绑定成功"),d.hide(),setTimeout(function(){j&&j()},250)})},createASP:function(){d.hide(),h.exec([],{regionId:c})}});d.create(k.$el,"610","",{title:"设置数据定期备份策略",preventResubmit:!0,hideIcon:!0,isMaskClickHide:!1,button:{" 确定 ":function(){k.bindASP()}}}),e.render({hasPermItems:a,actionName:"设置数据定期备份策略"})}}}),define("cvm/cbs2/event/buy",function(a,b,c){var d=a("$"),e=a("dialog"),f=a("cvm/cbs2/data"),g=a("cvm/cvm/data"),h=a("cvm/snapshot2/data"),i=a("cvm/common/model"),j=window.appUtil=a("appUtil"),k=a("widget/range/range"),l=a("widget/pills/pills"),m=a("widget/form/NumberStepInput"),n=a("qccomponent"),o=a("cvm/cbs2/event/SnapshotListSelector/snapshotListSelector"),p=a("cvm/cbs2/event/TagListSelector/tagListSelector"),q=a("cvm/cbs2/constants"),r=a("cvm/common/constants"),s=a("cvm/snapshot2/constants"),t=a("cvm/common/components/TimePill/timePill"),u=n.getComponent("qc-popover"),v=a("tips"),w=a("cvm/common/common"),x={main:'  <div>    <div class="tc-15-msg">      <ul>        <li>1、仅支持同可用区挂载：弹性云盘可在同可用区的实例之间自由挂载、卸载，不支持跨可用区操作</li>        <li>2、挂载后需初始化：购买后需要在控制台挂载到实例，并登录到实例进行初始化方可使用，          <a target="_blank" href="//cloud.tencent.com/document/product/362/6735">查看详情            <i class="external-link-icon"></i>          </a>        </li>      </ul>    </div>    <div class="new-disk">      <ul class="form-list">        <li class="pure-text-row">          <div class="form-label">            <label>可用区</label>          </div>          <div class="form-input">            <div class="form-unit">              <div class="tc-15-rich-radio num-disk-tab" id="zone" role="radiogroup">              </div>              <p b-if="isShowZoneInsatnceCountTip" class="form-input-help mt-5 text-danger">                提示：您在当前可用区下没有实例，云硬盘不支持跨可用区挂载，且不支持更改可用区</p>              <p b-if="!isShowZoneInsatnceCountTip" class="form-input-help mt-5 text-danger">提示：云硬盘不支持跨可用区挂载，且不支持更改可用区              </p>            </div>          </div>        </li>        <li class="pure-text-row">          <div class="form-label">            <label>云硬盘类型</label>          </div>          <div class="form-input">            <div class="tc-15-rich-radio num-disk-tab" id="diskType" role="radiogroup">            </div>          </div>        </li>        <li class="pure-text-row">          <div class="form-label">            <label>容量</label>          </div>          <div class="form-input">            <div id="diskSizeRange">            </div>            <p b-if="diskTypeList&&diskTypeList.length&&!diskType">当前可用区云硬盘已售罄</p>            <p b-if="!!diskType" class="form-input-help text mt-15">              <span b-if="(diskType == \'CLOUD_SSD\' || diskType == \'CLOUD_PREMIUM\')">峰值性能：随机IO {{io}} IOPS &nbsp 吞吐量                {{throughput}} MB/s</span>              <span b-if="diskType ==\'CLOUD_BASIC\'">性能参考：随机IO 数百-1000 IOPS 吞吐量 40-100 MB/s</span>              <i class="plaint-icon" qc-popover="{{performanceTip}}"></i>            </p>          </div>        </li>        <li b-if="showSnapshot" class="pure-text-row">          <div class="form-label">            <label>快照              <i class="plaint-icon"                data-title="快照是腾讯云提供的一种数据备份方式，通过对指定云硬盘进行完全可用的拷贝，使该备份独立于云硬盘的生命周期。基于快照可以创建新的云硬盘，这样云硬盘在初始状态就具有快照中的数据。"></i>            </label>          </div>          <div class="form-input" id="snapshotWarper">            <div class="form-unit">              <p>                <label class="form-ctrl-label">                  <input b-model="showSnapshotList" type="checkbox" class="tc-15-checkbox">使用快照创建云硬盘                </label>              </p>              <div class="tc-15-autocomplete" style="width: 300px; display:none" id="snapshotList" b-ref="snapshotList">              </div>            </div>          </div>        </li>        <li b-if="showEntrypt" class="pure-text-row">          <div class="form-label">            <label for="">加密              <i class="plaint-icon"                data-title="云硬盘加密能力能够最大限度保护您的数据安全，同时业务和应用程序无需做任何额外改动。当前硬盘加密为免费功能，云硬盘的读写操作和数据存储均不会产生额外的费用"></i>            </label>          </div>          <div class="form-input">            <div class="form-unit">              <p>                <label class="form-ctrl-label">                  <input b-ref="encrypt" b-model="encrypt" type="checkbox" class="tc-15-checkbox" />启用硬盘加密                </label>                <span b-if="snapshot">                  <span b-if="!snapshot.encrypt" class="form-input-help">非加密快照仅支持创建非加密云硬盘</span>                  <span b-if="snapshot.encrypt" class="form-input-help">加密快照仅支持创建加密云硬盘</span>                </span>                <span b-if="showRoleTips">                  <span class="form-input-help text-danger">                    <i class="n-error-icon"></i>                    加密能力依赖密钥管理服务（KMS），需要您前往                    <a target="_blank"                      href="//console.cloud.tencent.com/cam/role/grant?roleName=CVM_QcsRole&policyName=QcloudKMSAccessForCVMRole&principal=eyJzZXJ2aWNlIjoiY3ZtLnFjbG91ZC5jb20ifQ%3D%3D&roleDesc=云服务器(CVM)操作权限含查询密钥管理(KMS)服务，创建密钥，使用密钥加解密数据等。&serviceType=云服务器&s_url=https://console.cloud.tencent.com/cvm/cbs">[访问管理]</a>                    授权使用                  </span>                </span>              </p>            </div>          </div>        </li>        <li class="pure-text-row">          <div class="form-label">            <label for="">硬盘名称</label>          </div>          <div class="form-input">            <div class="form-unit">              <input b-model="diskName" class="tc-15-input-text m" style="width:140px" type="text" data-lenLimit="20"                maxlength="20" relTipId="cbsNameTip" placeholder="选填">            </div>          </div>          <!-- <p class="tip" id="cbsNameTip" style="color: #a2a2a2; padding:5px 0;font-size:12px; display:none"></p> -->        </li>        <li class="pure-text-row">          <div class="form-label">            <label for="">所属项目</label>          </div>          <div class="form-input">            <p b-if="projectList.length == 1">{{projectList[0].name}}</p>            <div b-if="projectList.length > 1" class="tc-15-select-wrap m">              <select b-if="projectList.length > 1" class="tc-15-select" b-model="projectId">                <option b-repeat="item in projectList" value="{{item.projectId}}"                  selected?="item.projectId == projectId">{{item.name}}</option>              </select>            </div>          </div>        </li>        <li class="tag pure-text-row" b-if="showTag">          <div class="form-label">            <label for="">标签</label>            <i b-if="!tagRWAuth" class="plaint-icon" qc-popover="您使用的子账号没有标签指定接口授权（tag::GetTagKeys），请联系您的主账号开发商。"></i>          </div>          <style>            .rowContainer {              display: inline-block;            }            #tagList {              overflow: visible !important;            }            #tagList .tc-15-table-fixed-body {              overflow: visible !important;            }            #tagList ul {              position: absolute !important;            }          </style>          <div id="tagList" class="form-input">          </div>        </li>        <li class="pure-text-row">          <div class="form-label">            <label>计费模式</label>          </div>          <div class="form-input">            <div class="tc-15-rich-radio num-disk-tab" id="payMode" role="radiogroup">            </div>          </div>        </li>        <li class="pure-text-row" b-if="payMode===\'CDCPAID\'">          <div class="form-label">            <label for="">独享集群</label>          </div>          <div class="form-input">            <p b-if="diskStoragePoolList.length == 0">当前可用区无指定类型独享集群</p>            <div b-if="diskStoragePoolList.length > 0" class="tc-15-select-wrap m">              <select class="tc-15-select" b-model="cdcId">                <option b-repeat="item in diskStoragePoolList" value="{{item.cdcId}}" selected?="item.cdcId == cdcId">                  {{item.cdcName ? item.cdcName + \'|\' : \'\'}}{{item.cdcId}}</option>              </select>            </div>          </div>        </li>        <li class="pure-text-row">          <div class="form-label">            <label>定期备份</label>          </div>          <div class="form-input" id="autoSnapshotPolicyWarper">            <div class="form-unit">              <p>                <label class="form-ctrl-label">                  <input b-model="showAutoSnapshotPolicyList" type="checkbox" class="tc-15-checkbox">设置定期备份                </label>              </p>              <div b-if="showAutoSnapshotPolicyList" class="tc-15-select-wrap m">                <select b-if="autoSnapshotPolicyList" class="tc-15-select" b-model="autoSnapshotPolicyId">                  <option b-repeat="item in autoSnapshotPolicyList" value="{{item.autoSnapshotPolicyId}}"                    selected?="item.autoSnapshotPolicyId == autoSnapshotPolicyId">{{item.label}}</option>                </select>                <span b-if="showAutoSnapshotPolicyList && autoSnapshotPolicy" class="inline-help-text">策略详情<i                    class="plaint-icon" qc-popover="<ul>                    <li>                      <h3>ID/名称</h3>                    </li>                    <li>{{autoSnapshotPolicy.autoSnapshotPolicyId}}({{autoSnapshotPolicy.autoSnapshotPolicyName}})</li>                    <li>                      <h3>日期</h3>                    </li>                    <li>{{autoSnapshotPolicy.dayOfWeekDesc}}</li>                    <li>                      <h3>时间</h3>                    </li>                    <li>{{autoSnapshotPolicy.hourDesc}}</li>                    <li>                        <h3>保留时间</h3>                    </li>                    <li>{{autoSnapshotPolicy.retentionDaysDesc}}</li>                  </ul>"></i></span>              </div>              <p class="form-input-help ">设置定期备份可有效保护数据安全，备份数据将产生额外费用，请见<a                  href="//cloud.tencent.com/document/product/362/5754" target="_blank"                  rel="noopener noreferrer">价格总览</a></p>            </div>          </div>        </li>        <li class="pure-text-row">          <div class="form-label">            <label for="">购买数量</label>          </div>          <div class="form-input" id="number">          </div>        </li>        <li b-if="payMode == \'PREPAID\'" class="pure-text-row">          <div class="form-label">            <label for="">购买时长</label>          </div>          <div class="form-input">            <div class="" id="timePills" role="radiogroup">            </div>          </div>        </li>        <li b-if="payMode == \'PREPAID\'" class="pure-text-row">          <div class="form-label">            <label for="">自动续费</label>          </div>          <div class="form-input">            <div class="form-unit">              <p>                <label class="form-ctrl-label">                  <input b-model="autoRenewFlag" type="checkbox" class="tc-15-checkbox" />账户余额足够时，设备到期后按月自动续费                </label>              </p>            </div>          </div>        </li>        <li class="pure-text-row">          <div class="form-label">            <label for="">费用</label>          </div>          <div class="form-input">            <div b-if="queryPriceLoading">              <i class="n-loading-icon"></i>            </div>            <div b-if="!queryPriceLoading && !queryPriceFail">              <p b-if="payMode == \'PREPAID\'">                <span class="price">                  <span data-field="cost">{{finalPrice}}</span>                  <em> {{unit}}</em>                </span>                <span b-if="originalPrice > finalPrice" class="original-cost">{{originalPrice}} {{unit}}</span>              </p>              <p b-if="payMode == \'POSTPAID_BY_HOUR\' || payMode == \'CDCPAID\' ">                <span class="price">                  <span data-field="cost">{{finalPrice}}</span>                  <em> {{unit}}/小时</em>                </span>                <span b-if="originalPrice > finalPrice" class="original-cost">{{originalPrice}} {{unit}}/小时</span>              </p>            </div>            <span b-if="queryPriceFail" class="cost">              <strong>查询失败</strong>            </span>          </div>        </li>      </ul>    </div>  </div>',
tip:'  <ul>    <li>      <h3>普通云硬盘</h3>    </li>    <li>随机IOPS：数百</li>    <li>吞吐量：50 MB/s</li>    <li>      <h3>高性能云硬盘</h3>    </li>    <li>IOPS随容量变化公式：min{1800+容量(GB)×8，6000} </li>    <li>吞吐量随容量变化公式：min{100+容量(GB)×0.15，150}</li>    <li>      <h3>SSD云硬盘</h3>    </li>    <li>IOPS随容量变化公式：min{1800+容量(GB)×30，26000}</li>    <li>吞吐量随容量变化公式：min{120+容量(GB)×0.2，260}</li>    <li>      更多有关云硬盘类型的适用场景请参考 <a href="https://cloud.tencent.com/document/product/362/2353" target="_blank">云硬盘类型        <i class="external-link-icon"></i>      </a> <br /> 如何测试云硬盘性能，请参考      <a href="https://cloud.tencent.com/document/product/362/6741" target="_blank">如何衡量云硬盘的性能        <i class="external-link-icon"></i>      </a>    </li>  </ul>',tag:'  <div class="tc-15-table-fixed-body">    <table class="tc-15-table-box tc-15-table-rowhover">      <colgroup>        <col span="2">        <col style="width:120px">      </colgroup>      <tbody>        <tr class="keyItem">        </tr>      </tbody>      <tfoot>        <tr class="" b-if="dataReady">          <td colspan="3">            <div class="">              <a href="#" b-on-click="addKeyValues()">添加</a>            </div>          </td>        </tr>      </tfoot>    </table>  </div>'};c.exports={init:function(a){var b=this;b.getInitParams(a).then(function(){b.cbsBuyBee=new n({$tpl:x.main,$afterInit:function(){this.$watch("zoneId",function(a){this.$set("zone",r.ZONEIDMAP[a]),b.toggleCurrentZoneInstanceCountTip(a),b.updateDiskTypeList()}),f.getRole({roleName:"CVM_QcsRole"}).then(function(a){a||b.cbsBuyBee.$watch("encrypt",function(a){var c=a&&!b.cbsBuyBee.snapshot;b.cbsBuyBee.$set("showRoleTips",c),e.toggleBtnDisable({disable:c})})}),this.$watch("diskTypeList",function(a){b.renderDiskTypeList(a)}),this.$watch("payMode",function(a){"CDCPAID"==a&&b.updateDiskStoragePool(),e.toggleBtnDisable(!1)}),this.$watch("diskType",function(a){b.updateDiskSizeRangeOption(),b.updateIOPeakPerformance(),b.queryCreateDiskPrice()}),this.$watch("[zone,diskType]",function(a){b.updateDiskSizeRangeOption()}),this.$watch("snapshot",function(a){b.updateDiskSizeRangeOption(),b.checkDiskEncrypt(a)}),this.$watch("diskSizeRangeOption",function(a){b.renderDiskSizeRange(a)}),this.$watch("diskSize",function(a){b.updateIOPeakPerformance(),b.queryCreateDiskPrice()}),this.$watch("showSnapshotList",function(a){a?(d(this.$refs.snapshotList).show(),b.renderSnapshotSelector()):(b.snapshot=null,this.$set("snapshot",null),b.snapshotListSelector.clearSelectedItem(),d(this.$refs.snapshotList).hide())}),this.$watch("showAutoSnapshotPolicyList",function(a){a&&b.showAutoSnapshotPolicySelector()}),this.$watch("autoSnapshotPolicyId",function(a){this.$set("autoSnapshotPolicy",this.autoSnapshotPolicyList.find(function(b){return b.autoSnapshotPolicyId==a}))}),this.$watch("payMode",function(a){b.updateDiskTypeList(),b.queryCreateDiskPrice()}),this.$watch("diskNumber",function(a){b.queryCreateDiskPrice()}),this.$watch("period",function(a){b.queryCreateDiskPrice()})},$data:{performanceTip:x.tip,maxCreateNumber:50,showEntrypt:["1","4","5","8"].indexOf(b.regionId)>=0&&!!b.whiteListMap.cbs_encryption,showSnapshot:s.SNAPSHOT_REGION_LIST.indexOf(b.regionId)>=0,showTag:!!b.whiteListMap.CBS_TAG_WL,projectList:b.projectList,projectId:-1==b.projectId?b.projectList&&b.projectList[0]&&b.projectList[0].projectId:b.projectId,payMode:b.isI18n?"POSTPAID_BY_HOUR":"PREPAID",isShowZoneInsatnceCountTip:!1,diskNumber:1,finalPrice:"-",unit:b.isI18n?"美元":"元",tagRWAuth:!0,autoRenewFlag:!1}}),b.whiteListMap.CBS_TAG_WL&&(b.tagBee=new p({$data:{tagList:[],dataReady:!1,buyCbsRef:b.cbsBuyBee}})),e.create(b.cbsBuyBee.$el,720,"",{title:"购买数据盘",preventResubmit:!1,isMaskClickHide:!1,button:{" 确定 ":function(){b.createDisk()}},defaultCancelCb:function(){b.payModeZoneIdDiskTypeListMap={},b.snapshot=null}}),b.whiteListMap.CBS_TAG_WL&&(d("#tagList").append(b.tagBee.$el),d("#tagList").on("click","tr",function(a){if("deleteTag"===a.target.className&&b.cbsBuyBee.$get("tagRWAuth")){a.currentTarget.style.display="none";var c=b.tagBee.$get("tagList"),e=a.target.dataset.index;c[e]=null,c.find(function(a){return null!=a})||(d(".tag-table").hide(),d(".show-tad-table-btn").show())}})),b.$diskType=e.el.find("#diskType"),b.$diskSizeRange=e.el.find("#diskSizeRange"),b.renderZoneList(b.zoneList),b.snapshot&&b.renderSnapshotSelector(),b.renderPayMode(),b.renderNumberInput(),b.renderTimePills()})},getInitParams:function(a){var b=this;return Object.assign(b,{isSnapshotSelectorInit:!1,regionId:j.getRegionId(),projectId:j.getProjectId()},a),new Promise(function(c,d){a.zoneList&&a.zoneList.length&&a.projectList&&a.projectList.length&&a.whiteListMap?c():Promise.all([f.queryZone(b.regionId),f.getProjects(),f.queryWhiteList()]).then(function(a){b.zoneList=a[0]||[],b.projectList=a[1]||[],b.whiteListMap=a[2]||{},c()},function(a){c()})})},renderZoneList:function(a){var b=this;a=a.filter(function(a){return a.name=a.zoneName,a.value=a.zoneId,a.active=b.snapshot&&a.value==b.snapshot.zoneId||b.zoneId&&b.zoneId==a.value,"AVAILABLE"==a.zoneState}),b.zonePills=new l({renderTo:e.el.find("#zone"),data:a,newMode:!0,change:function(a){var c=b.zonePills.val();b.cbsBuyBee.$set("zoneId",c)}});var c=a[0].value;a.forEach(function(a){a.active&&(c=a.value)}),b.zonePills.val(c),b.cbsBuyBee.$set("zoneId",c)},toggleCurrentZoneInstanceCountTip:function(a){var b=this,c=!1;g.queryCvmList2({filters:[{name:"zone",values:[r.ZONEIDMAP[a]]}],regionId:b.regionId}).then(function(a){if(a.response&&a.response.instanceSet){a.response.totalCount;c=0==a.response.totalCount}b.cbsBuyBee.$set("isShowZoneInsatnceCountTip",c)},function(a){b.cbsBuyBee.$set("isShowZoneInsatnceCountTip",c)})},getTagKeyList:function(){var a=this;f.getTagKeyList().then(function(b){a.keyList=b.data.data.rows})},updateDiskTypeList:function(){var a=this;a.cbsBuyBee.$set("diskTypeList",[]),a.getDiskTypeList().then(function(b){a.cbsBuyBee.$set("diskTypeList",b)})},getDiskTypeList:function(){var a=this;return a.payModeZoneIdDiskTypeListMap=a.payModeZoneIdDiskTypeListMap||{},new Promise(function(b,c){var d=(a.snapshotListSelector&&a.snapshotListSelector.$get("snapshotSize")||0,a.cbsBuyBee.$get("zone")),e=a.cbsBuyBee.$get("payMode"),g=a.payModeZoneIdDiskTypeListMap[e+d]||[];g.length?b(g):f.queryDiskConfigQuota({regionId:a.regionId,diskChargeType:e,zones:[d],inquiryType:"INQUIRY_CBS_CONFIG"}).then(function(c){var f=c.response&&c.response.diskConfigSet||[];g=f.map(function(a){return a.name=q.DISKTYPE[a.diskType],a.value=a.diskType,a.available||(a.disabled=!0,a.tips="售卖火爆，已售罄，加紧补货中",a.ico='<i class="shop-over-icon"></i>'),a}),a.payModeZoneIdDiskTypeListMap[e+d]=g,b(g)})})},renderDiskTypeList:function(a){var b=this;if(a.length){var c=b.cbsBuyBee.$get("diskType"),d=a.map(function(a){return a.value});!c||d.indexOf(c)<0?(c=null,a.forEach(function(a){c||a.disabled?a.active=!1:(a.active=!0,c=a.value)})):a.forEach(function(a){a.active=a.value==c}),b.$diskType.empty(),b.diskTypePills=new l({renderTo:b.$diskType,data:a,newMode:!0,change:function(){var a=this.val();b.cbsBuyBee.$set("diskType",a),b.updateDiskStoragePool()}}),b.cbsBuyBee.$set("diskType",c),b.updateDiskStoragePool()}},updateDiskStoragePool:function(){var a=this,b=a.cbsBuyBee.diskType,c=a.cbsBuyBee.payMode,d=a.cbsBuyBee.zone,g=a.regionId;if("CDCPAID"===c&&d&&b){var h=[{name:"disk-type",values:[b]},{name:"zone",values:[d]}];f.queryDiskStoragePool({filters:h},g).then(function(b){var c=b&&b.response.cdcSet||[];a.cbsBuyBee.$set("diskStoragePoolList",c),c.length||e.toggleBtnDisable({disable:!0,errTips:"当前可用区无指定类型独享集群"})},function(a){e.toggleBtnDisable({disable:!0,errTips:a})})}},getDiskSizePointByMaxSize:function(a){var b=[];return 250==a?b=[50,100,250]:400==a?b=[100,200,400]:500==a?b=[100,300,500]:800==a?b=[160,480,800]:1e3==a?b=[200,500,1e3]:1200==a?b=[200,500,1200]:a>=1500&&(b=[200,500,1e3,a]),b},updateDiskSizeRangeOption:function(){var a=this,b=a.cbsBuyBee.$get("diskType"),c=a.cbsBuyBee.$get("snapshot"),d=a.cbsBuyBee.$get("diskSize"),e=c&&c.diskSize||0;if(!b)return void a.cbsBuyBee.$set("diskSizeRangeOption",null);var f=a.cbsBuyBee.$get("diskTypeList").find(function(a){return a.value==b}),g=f.maxDiskSize,h=f.minDiskSize;h=h>e?h:e,h=h>g?g:h;var i=d&&d>=h&&g>=d?d:h,j=a.getDiskSizePointByMaxSize(g)||[];j=j.map(function(a,b){return{value:a,width:300/j.length*(b+1)}});var k={min:h,max:g,value:i,section:j};a.cbsBuyBee.$set("diskSizeRangeOption",k)},renderDiskSizeRange:function(a){var b=this;b.$diskSizeRange.empty(),a&&(b.diskSizeRange=new k({renderTo:b.$diskSizeRange,unit:"GB",value:a.value,min:a.min,max:a.max,width:300,step:10,section:a.section,change:function(){var a=this.val();b.cbsBuyBee.$set("diskSize",a)}}),b.cbsBuyBee.$set("diskSize",a.value))},updateIOPeakPerformance:function(){var a,b,c,d,e=this,f=e.cbsBuyBee.$get("diskType"),g=e.cbsBuyBee.$get("diskSize"),h=null,i=null;"CLOUD_SSD"==f?(a=(1800+30*g).toFixed(1),b=26e3,h=Math.min(a,b),c=(120+.2*g).toFixed(1),d=260,i=Math.min(c,d)):"CLOUD_PREMIUM"==f&&(a=(1800+8*g).toFixed(1),b=6e3,h=Math.min(a,b),c=(100+.15*g).toFixed(1),d=150,i=Math.min(c,d)),e.cbsBuyBee.$set("io",h),e.cbsBuyBee.$set("throughput",i)},renderSnapshotSelector:function(){var a=this,b=a.regionId,c=a.cbsBuyBee.$get("zone"),d=e.el&&e.el.find("#snapshotList"),f=a.cbsBuyBee.$get("showSnapshotList");f?(d&&d.empty(),a.snapshotListSelector=new o({$data:{regionId:b,zone:c,selectedItem:a.snapshot,inputValue:a.snapshot&&a.snapshot.desc},inputBlur:function(b){var c=this,d=c.$get("isFail");d||a.showSnapshotPopover()}}),a.isSnapshotSelectorInit=!0,a.snapshotListSelector.$watch("selectedItem",function(b){a.cbsBuyBee.$set("snapshot",b)}),a.snapshotListSelector.$watch("keyword",function(b){var c=a.cbsBuyBee.$get("snapshot");c&&a.cbsBuyBee.$set("snapshot",null)}),d.html(a.snapshotListSelector.$el)):!a.isSnapshotSelectorInit&&a.snapshot&&(a.cbsBuyBee.$set("snapshot",a.snapshot),a.cbsBuyBee.$set("showSnapshotList",!0))},showSnapshotPopover:function(){var a=this,b=setTimeout(function(){clearTimeout(b);var c=a.cbsBuyBee.$get("snapshot");c||a.showPopover({content:'<span class="text-danger">未找到该快照，请重新选择</span>',hideDelay:3e3,handler:e.el.find("#snapshotList")})},250)},showAutoSnapshotPolicySelector:function(){var a=this,b=this.cbsBuyBee,c=b.regionId,d=b.autoSnapshotPolicyList;new Promise(function(a){d?a(d):h.queryAutoSnapshotPolicies({data:{filters:[{name:"auto-snapshot-policy-state",values:["NORMAL"]}],TryCreateDefaultAutoSnapshotPolicy:!0,offset:0,limit:100},regionId:c}).then(function(b){var c=b.response.autoSnapshotPolicySet,d=void 0===c?[]:c;a(h.formatAspList(d))},function(){a([])})}).then(function(b){a.cbsBuyBee.$set("autoSnapshotPolicyList",b),b.length&&a.cbsBuyBee.$set("autoSnapshotPolicy",b[0])})},checkDiskEncrypt:function(a){var b=this;b.cbsBuyBee.showEntrypt&&(a?(b.cbsBuyBee.$set("encrypt",a.encrypt),d(b.cbsBuyBee.$refs.encrypt).prop("disabled",!0)):d(b.cbsBuyBee.$refs.encrypt).prop("disabled",!1))},renderPayMode:function(){var a=this,b=[];a.isI18n||b.push({name:"包年包月",value:"PREPAID"}),a.whiteListMap.cbs_postpay&&b.push({name:"按量计费",value:"POSTPAID_BY_HOUR"}),a.whiteListMap.CBS_dedicated_cluster&&a.whiteListMap.CBS_dedicated_cluster.length&&b.push({name:"不计费",value:"CDCPAID"}),a.payModePills=new l({renderTo:e.el.find("#payMode"),data:b,newMode:!0,change:function(b){var c=a.payModePills.val();a.cbsBuyBee.$set("payMode",c)}}),a.cbsBuyBee.$set("payMode",b[0].value),a.payModePills.val(b[0].value)},renderNumberInput:function(){var a=this,b=a.cbsBuyBee.maxCreateNumber;a.numberInput=new m({$data:{min:1,max:b,initVal:1,limitMax:!0,unit:"块"},inputKeyup:function(b){var c=Math.round(b.target.value);b.target.value=c,c>this.max&&a.showMaxCreateDiskCountPopover(this.max),this.inputChange(b)}}),a.numberInput.$watch("val",function(b){a.cbsBuyBee.$set("diskNumber",b)}),e.el.find("#number").html(a.numberInput.$el)},showMaxCreateDiskCountPopover:function(a){var b=this;b.showPopover({content:'<span class="text-danger">单次最多可创建'+a+"块弹性云硬盘</span>",style:"width: 195px; right: 100%; top: 50%; left:0px;",hideDelay:3e3,handler:e.el.find("#number .num")})},showPopover:function(a){var b=this,c={content:"输入错误",position:"top",auto:!1,style:"",hideDelay:3e3,handler:null,hideDestroy:!0,trigger:"hover"},f=d.extend({},c,a);b.popover=new u({$data:{content:f.content,position:f.position,auto:f.auto,style:f.style,hideDelay:f.hideDelay},handler:f.handler,hideDestroy:f.hideDestroy,trigger:f.trigger}),b.popover.show(),setTimeout(function(){if(b.popover){b.popover.hide();var a=e.el.find("[data-role=qc-popover]");a&&a.remove(),b.popover=null}},f.hideDelay)},renderTimePills:function(){var a=this,b=a.regionId,c=w.showDiscountIcon(b);a.timePill=new t({renderTo:e.el.find("#timePills"),showDiscountIcon:c,defaultTriggerChange:!0,change:function(b){a.cbsBuyBee.$set("period",b)}})},getCreateDiskParamV3:function(a){var b=this,c=b.cbsBuyBee,d=c.$get("snapshot"),e={DiskChargePrepaid:{Period:c.$get("period"),RenewFlag:c.$get("autoRenewFlag")?"NOTIFY_AND_AUTO_RENEW":"NOTIFY_AND_MANUAL_RENEW"},DiskChargeType:c.$get("payMode"),DiskCount:c.$get("diskNumber"),DiskName:c.$get("diskName")||"未命名",DiskSize:c.$get("diskSize"),DiskType:c.$get("diskType"),Encrypt:c.$get("encrypt")?"ENCRYPT":void 0,Placement:{ProjectId:c.$get("projectId"),Zone:r.ZONEIDMAP[c.$get("zoneId")]},SnapshotId:d&&d.snapshotId||void 0,AutoSnapshotPolicyId:c.$get("showAutoSnapshotPolicyList")?c.$get("autoSnapshotPolicyId"):void 0};if(!a&&b.whiteListMap.CBS_TAG_WL){var f=b.tagBee.filterInvalidTag();e.Tags=f}if("CDCPAID"==e.DiskChargeType){var g=c.$get("cdcId"),h=c.diskStoragePoolList&&c.diskStoragePoolList.find(function(a){return a.cdcId==g});h&&(e.Placement.CdcId=g,h.cdcName&&(e.Placement.CdcName=h.cdcName),h.cageId&&(e.Placement.CageId=h.cageId))}return("POSTPAID_BY_HOUR"==e.DiskChargeType||"CDCPAID"==e.DiskChargeType)&&delete e.DiskChargePrepaid,e},queryCreateDiskPrice:function(){var a=this,b=a.getCreateDiskParamV3(!0);return delete b.DiskName,delete b.Placement,delete b.SnapshotId,delete b.Encrypt,delete b.AutoSnapshotPolicyId,b.DiskType&&b.DiskSize?(a.cbsBuyBee.$set("finalPrice",null),a.cbsBuyBee.$set("originalPrice",null),a.cbsBuyBee.$set("queryPriceFail",!1),a.cbsBuyBee.$set("queryPriceLoading",!0),void f.queryCreateDiskPrice({data:b,regionId:a.regionId},{camTipsType:"dialog"}).then(function(c){a.cbsBuyBee.$set("queryPriceLoading",!1);var d,e,f=c.response&&c.response.diskPrice,g=(a.cbsBuyBee.$get("period"),a.cbsBuyBee.$get("diskNumber")),h=a.cbsBuyBee.$get("payMode"),i=a.cbsBuyBee.$get("diskSize");g==b.DiskCount&&i==b.DiskSize&&h==b.DiskChargeType&&("PREPAID"==h?(e=f&&f.originalPrice,d=f&&f.discountPrice):(e=f&&f.unitPrice,d=f&&f.unitPriceDiscount),a.cbsBuyBee.$set("finalPrice",d),a.cbsBuyBee.$set("originalPrice",e))},function(b){a.cbsBuyBee.$set("queryPriceLoading",!1),a.cbsBuyBee.$set("queryPriceFail",!0)})):void a.cbsBuyBee.$set("finalPrice","-")},createDisk:function(){var a=this,b=a.getCreateDiskParamV3(!1);return b&&b.Placement&&b.Placement.ProjectId&&d.isArray(b.Placement.ProjectId)&&(b.Placement.ProjectId=b.Placement.ProjectId[0]),a.cbsBuyBee.showSnapshotList&&!b.SnapshotId?void a.showSnapshotPopover():void("PREPAID"==b.DiskChargeType?i.apiRequest({serviceType:"cbs",action:"SwitchParameterCreateDisks",data:b,regionId:a.regionId},{camTipsType:"dialog"}).then(function(a){var b=a.response&&a.response.diskOrder;b&&f.toPay2(b)})["catch"](function(a){console.warn(a)}):i.apiRequest({cmd:"CreateDisks",serviceType:"cbs",data:b,regionId:a.regionId},{camTipsType:"dialog"}).then(function(b){e.hide(),v.success("创建成功"),setTimeout(function(){a.callback&&a.callback()},250)})["catch"](function(a){console.warn(a)}))}}}),define("cvm/cbs2/event/cancelattach",function(a,b,c){var d=a("$"),e=a("dialog"),f=a("cvm/cbs2/constants"),g=a("cvm/cbs2/data"),h=a("appUtil"),i=a("util"),j=a("tips"),k=a("cvm/cbs2/event/selectedShow"),l=a("widget/mfa/mfa"),m={cancel:'  <div id="selectedshow"> </div>  <div class="ui-popmsg">    <div class="info">      <%if(itemList.length> 1){%>      <span class="tit">批量卸载云硬盘</span>      <%}else{%>      <span class="tit">卸载实例(        <%=itemList[0].instanceId%>)的云硬盘(        <%=itemList[0].diskId%>)</span>      <%}%>            <p>win实例：强烈建议您在卸载之前，对该硬盘执行脱机操作，              <a href="https://cloud.tencent.com/document/product/362/6740" target="_blank">查看详情</a>。</p>            <p>linux实例：建议您在卸载之前，确保该硬盘的所有分区处于非加载状态 (umounted)。部分linux操作系统可能不支持硬盘热拔插，              <a href="http://www.qcloud.com/doc/product/362/%E9%83%A8%E5%88%86%E5%AD%98%E9%87%8F%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%97%A0%E6%B3%95%E8%AF%86%E5%88%AB%E5%BC%B9%E6%80%A7%E4%BA%91%E7%9B%98%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95"                target="_blank">查看详情</a>。</p>    </div>  </div>'},n=function(a,b){l.verify({api:"cvm:DetachDisks"}).then(function(){var c=[];return d(a).each(function(a,b){c.push(b.diskId)}),0==c.length?void j.error("请选择云硬盘"):(e.create(i.tmpl(m.cancel,{itemList:a}),580,"",{title:"卸载云硬盘",preventResubmit:!1,button:{" 确定 ":function(){var a=f.DISK_ERROR_TIP;g.detachCbsStoragesCgi({regionId:h.getRegionId(),diskIds:c}).then(function(c){if(c=c.response,c.error){var d=c.error||{};a[d.code]?j.error(a[d.code]):j.error(d.message||"操作执行失败，请稍后重试")}else e.hide(),j.loading("卸载中"),setTimeout(function(){b&&b.callback&&b.callback()},250)})}}}),void k.render({hasPermItems:a,actionName:"卸载",renderTo:"#selectedshow"}))})};c.exports={init:function(a,b){n(a,b)}}}),define("cvm/cbs2/event/changeproject",function(a,b,c){function d(a,b,c){for(var d,h=[],j=0;d=a[j];j++)h.push(d.diskId);i.modifyStorageAttr({regionId:f.getRegionId(),diskIds:[h[0]],projectId:b}).then(function(a){e.hide(),g.success("修改成功"),c&&c.callback&&c.callback()})}var e=(a("$"),a("manager"),a("dialog")),f=a("appUtil"),g=(a("util"),a("tips")),h=a("cvm/cbs2/event/selectedShow"),i=a("cvm/cbs2/data"),j=a("cvm/cvm/data"),k=a("cvm/common/components/ProjectSelector"),l=a("qccomponent"),m={main:'  <div>    <div id="selectedshow"> </div>    <project-selector b-ref="projectSelector"></project-selector>  </div><!-- <div class="table-panel host-table-panel" style="position:static; height:200px"><div class="tc-table-fixed"><div class="tc-table-fixed-head"><table class="tc-table tc-table-headcolor"><colgroup><col class="tc-table-col1"><col class="tc-table-col2"><col class="tc-table-col3"></colgroup><thead><tr><th></th><th><span>项目名称</span></th><th><span>项目说明</span></th></tr></thead></table></div><div class="tc-table-fixed-body def-scroll"><table class="tc-table tc-table-rowhover"><colgroup><col class="tc-table-col1"><col class="tc-table-col2"><col class="tc-table-col3"></colgroup><tbody><% for (var i=0, item; item = projectList[i]; i++ ) { %><tr class="select_project_row"><td><input type="radio" name="change_project_radio" value="<%- item.projectId %>" /></td><td><span><%= item.name %></span></td><td><span><%= item.info %></span></td></tr><% } %></tbody></table></div></div></div> -->'};c.exports={init:function(a,b){a&&0!=a.length&&j.getProjects().then(function(c){if(c&&c.length>0){var f=l.extend({$tpl:m.main});f.tag("project-selector",k.extend({projectList:c,$checked:null}));var i=new f;e.create(i.$el,"540","",{title:"分配至项目",preventResubmit:!1,button:{"确定":function(){var c=i.$refs.projectSelector,f=c.$checked,h=c.list,j=h.find(function(a){return a.projectId==f});return j?void d(a,f,b):(g.error("请选择项目"),void e.toggleBtnDisable(!1))}}}),i.$refs.projectSelector.$watch("[list,$checked]",function(a){var b=_slicedToArray(a,2),c=b[0],d=b[1],f=c.find(function(a){return a.projectId==d});return void 0!=d&&null!=d&&""!=d&&f?void e.toggleBtnDisable(!1):void e.toggleBtnDisable({disable:!0,index:0,errTips:"请选择项目"})}),h.render({hasPermItems:a,actionName:"分配项目",renderTo:"#selectedshow"})}})}}}),define("cvm/cbs2/event/createsnapshot",function(a,b,c){var d=a("$"),e=(a("router"),a("pageManager"),a("manager"),a("models/api"),a("dialog")),f=a("qccomponent"),g=(a("models/snapshot"),a("reporter")),h=(a("util"),a("tips")),i=a("cvm/cbs2/data"),j=seajs.require("appUtil"),k={snapshot_dialog:'  <div>    <div class="tc-15-msg warning" style="margin:0px 0px 10px 0px">      <div class="tip-info">        为了保证快照能完整的捕获硬盘数据内容，建议制作快照前，进行以下操作：        <br>数据库业务：Flush &amp; Lock Table        <br>文件系统：Sync 操作，将内存数据强制刷入硬盘内        <p>           <span b-if="!isI18n">云硬盘快照已于2019年1月22日0点启动正式商业化，</span>          <span b-if="isI18n">云硬盘快照（国际站）将于2019年3月1日启动正式商业化，</span>          查看快照用量和预估费用请前往<a href="//console.cloud.tencent.com/cvm/snapshot/overview" target="_blank">快照概览</a>，详细请查看          <a          href="{{ isI18n ? \'//intl.cloud.tencent.com/document/product/213/30265\' : \'//cloud.tencent.com/document/product/362/17935\'}}"          target="_blank">商业化公告</a>          </p>        <p></p>      </div>    </div>    <ul class="form-list" id="create_snapshot_dialog">      <li class="pure-text-row">        <div class="form-label">          <label>云硬盘ID</label>        </div>        <div class="form-input">          <p>{{diskId}}</p>        </div>      </li>      <li class="pure-text-row">        <div class="form-label">          <label>云硬盘名称</label>        </div>        <div class="form-input">          <p>{{diskName}}</p>        </div>      </li>      <li class="pure-text-row">        <div class="form-label">          <label>硬盘容量</label>        </div>        <div class="form-input">          <p>{{diskSize}}GB</p>        </div>      </li>      <li class="pure-text-row">        <div class="form-label">          <label>硬盘类型</label>        </div>        <div class="form-input">          <p>{{storageTypeDesc}}</p>        </div>      </li>      <li>        <div class="form-label">          <label>快照名称</label>        </div>        <div class="form-input">          <div class="tc-15-input-text-wrap m" b-if="less>=0">            <input type="text" class="tc-15-input-text" b-model="snapshotAlias" maxlength="60" id="snapshotAlias">            <div class="tc-15-input-tips" b-if="isShowLess">你还可以输入{{less}}个字符</span>            </div>            <div class="tc-15-input-tips" b-if="isShowError">{{errorMsg}}</div>          </div>          <div class="tc-15-input-text-wrap m error" b-if="less<0">            <input type="text" class="tc-15-input-text" b-model="snapshotAlias" maxlength="60" id="snapshotAlias">            <div class="tc-15-input-tips" b-if="isShowLess">你已超出{{Math.abs(less)}}个字符</div>            <div class="tc-15-input-tips" b-if="isShowError">{{errorMsg}}</div>          </div>        </div>      </li>    </ul>  </div>',alert:'  <div class="confirm-text">    <strong>当前硬盘关联实例处于运行中，请注意以下几点：</strong>  </div>  <div class="tc-15-msg">    <ul>      <li>        <strong>1. 快照只会包含任务开始时刻已写入硬盘的数据，不包含缓存中的数据</strong>      </li>      <li>        <strong>2. 为保证快照数据的完整性，请在制作过程暂停所有硬盘写入操作。强烈建议您先关闭实例后制作快照</strong>      </li>    </ul>  </div>',othersalert:'  <div class="confirm-text">云硬盘关联的实例(    <a data-event="nav" href="/cvm/detail/<%=regionId%>/<%=instanceId%>">      <%=uInstanceId%>    </a>)正在执行任务（    <%=statusDesc%>），请稍候。</div>'},l={create:function(a,b){var c=this,e=new f({$tpl:k.snapshot_dialog,$data:d.extend(!0,{snapshotAlias:"",less:60,warp:{color:""},isShowError:!1,isShowLess:!0,errorMsg:"",isI18n:j.isI18n()},a)});e.$watch("snapshotAlias",function(a){e.$set("less",60-a.length),e.$set("isShowError",!1),e.$set("isShowLess",!0),e.$set("attr",{"class":"tc-15-input-text-wrap m"}),e.$set("errorMsg","")}),c.updateSnapshotDialog(e,a,b),g.click("yunzhuji.CBS.createSnapshot")},updateSnapshotDialog:function(a,b,c){e.create(a.$el,480,"",{title:"创建快照",preventResubmit:!0,button:{"确定":function(){return a.$data.snapshotAlias.length>60?(h.error("名称不能超过60个字符",3e3),void e.toggleBtnDisable()):(i.createSnapshot({diskId:b.diskId,snapshotName:a.$data.snapshotAlias?a.$data.snapshotAlias:void 0,regionId:b.regionId}).then(function(){e.hide(),c&&c.callback&&c.callback(),h.success("快照创建中！",3e3)}),void g.click("yunzhuji.CBS.createSnapshotBtn"))}}}),g.click("yunzhuji.CBS.createSnapshotDialog")}};c.exports={init:function(a,b){l.create(a[0],b)}}}),define("cvm/cbs2/event/destroycbs",function(a,b,c){var d=(a("$"),a("appUtil")),e=a("dialog"),f=a("cvm/cbs2/event/selectedShow"),g=a("cvm/common/model"),h=a("tips"),i=a("widget/mfa/mfa"),j=a("qccomponent"),k={main:'  <div>    <style type="text/css">      .swapnotes li {        padding: 4px 0;        list-style-type: disc;        margin-left: 20px      }    </style>    <div class="tc-15-option-hd">      <h3>销毁选中的云硬盘？</h3>    </div>    <div b-if="!isFromRecycle">      <div class="tip_box" style="margin-top:10px;">        <ul b-if="isPrepaid" class="swapnotes">          <li>销毁后云硬盘将在<span class="text-danger">回收站保留7天</span>，请提前备份数据。</li>          <li>资源删除后，五天无理由退款的金额退还至原支付账户；普通退款的金额将按购买支付使用的现金和赠送金比例退还至您的账户。</li>        </ul>        <ul class="swapnotes" b-if="!isPrepaid">          <li>销毁后所有数据将被清除且不可恢复，请提前备份数据。</li>        </ul>      </div>      <div b-if="isPrepaid">        <label class="form-ctrl-label">          <input type="checkbox" b-model="agreeReturn" class="tc-15-checkbox"> 已阅读并同意          <a href="https://cloud.tencent.com/document/product/362/18072" target="_blank">退费规则            <i class="external-link-icon"></i>          </a>        </label>      </div>    </div>    <div b-if="isFromRecycle" class="tip_box" style="margin-top:10px;">      <ul class="swapnotes">        <li>销毁后所有数据将被清除且不可恢复，请提前备份数据。</li>      </ul>    </div>  </div>'};c.exports={init:function(a,b,c){var l=[];a.forEach(function(a){l.push(a.diskId)}),i.verify({api:"cvm:TerminateDisks"}).then(function(){var i=a[0].regionId,m=a[0].diskChargeType,n="PREPAID"==m,o=new j({$tpl:k.main,$afterInit:function(){this.$watch("confirmSave",function(a){e.toggleBtnDisable(!a)}),this.$watch("confirmDelete",function(a){e.toggleBtnDisable(!a)}),this.$watch("agreeReturn",function(a){e.toggleBtnDisable(!a)})},$data:{isPrepaid:n,isFromRecycle:c}}),p=n&&!c?[1]:[0];e.create(o.$el,"610","",{title:"销毁云硬盘",preventResubmit:!0,buttonDisable:p,hideIcon:!0,defaultCancelCb:function(){o.$destroy()},button:{" 确定 ":function(){if(l.length>0)if(n&&!c){var a=document.domain.indexOf("tencent.com")>-1?"https://buy.cloud.tencent.com/refund/check":"https://buy.qcloud.com/refund/check",f={cbs:{regionId:i,resourceIdList:l}};d.submitForm(a,{rawRefundsInfo:f})}else g.apiRequest({regionId:i,serviceType:"cbs",action:"TerminateDisks",data:{DiskIds:l}}).then(function(a){e.hide(),h.success("销毁成功"),b&&b.callback&&setTimeout(function(){b.callback()},250)})["catch"](function(a){console.warn(a)})}}}),f.render({hasPermItems:a,actionName:"销毁"})})}}}),define("cvm/cbs2/event/export",function(a,b,c){function d(a,b){function c(b){if(!(Date.now()-d>12e4)){var f="//"+k+"/cgi/cbs?action=exportPoll&regionId="+a.regionId+"&t"+Date.now();i.request(f,{data:e.extend(a,{Version:"2017-03-12"})}).then(function(a){"DONE"==a.status?b&&b():setTimeout(function(){c(b)},5e3)})["catch"](function(){setTimeout(function(){c(b)},5e3)})}}var d=Date.now();a.rk=[f.getUin(),(new Date).getTime(),Math.round(1e4*Math.random())].join("-");var g,h=f.objectToParams(a);b?c(function(){g="//"+k+"/cgi/cbs?action=downloadCbs&"+h,location.href=g}):(g="//"+k+"/cgi/cbs?action=exportCbs&"+h,location.href=g)}var e=a("$"),f=a("util"),g=a("appUtil"),h=a("dialog"),i=a("models/iaas"),j=a("tips"),k=location.hostname.indexOf("cloud.tencent.com")>-1?"iaas.cloud.tencent.com":"iaas.qcloud.com",l=function(a){this.expired=a&&a.isFromRecycle||"",this.listIns=a&&a.listIns||null};l.prototype.exec=function(){this.showDialog()},l.prototype["export"]=function(a){var b=this.listIns.isAsyncExport,c=void 0;switch(a){case"filter":c=Object.assign({},this.listIns.queryInstanceParams);break;case"selected":var e=this.listIns.gridView&&this.listIns.gridView.getSelected();if(!e.length)return j.error("未选中实例"),!0;c=Object.assign({},this.listIns.queryInstanceParams,{Filters:[{Name:"disk-id",Values:e.map(function(a){return a.diskId})}]});break;default:c=Object.assign({},this.listIns.queryInstanceParams,{Filters:[]})}var h={t:(new Date).getTime(),uin:f.getUin(),csrfCode:f.getACSRFToken(),projectId:g.getProjectId(),regionId:c.regionId||g.getRegionId(),qip:JSON.stringify(c),expired:this.expired};d(h,b)},l.prototype.showDialog=function(){var a=this;h.create(f.tmpl('  <ul class="form-list">    <li class="pure-text-row">      <div class="form-label">        <label>导出范围</label>      </div>      <div class="form-input">        <div class="form-unit">          <label class="form-ctrl-label-stacked">            <input type="radio" class="tc-15-radio" name="exportType" value="all" checked>            导出全部实例          </label>          <label class="form-ctrl-label-stacked">            <input type="radio" class="tc-15-radio" name="exportType" value="filter">            仅导出搜索结果          </label>          <label class="form-ctrl-label-stacked">            <input type="radio" class="tc-15-radio" name="exportType" value="selected">            仅导出选中实例          </label>        </div>      </div>    </li>  </ul>'),540,null,{title:"导出实例",preventResubmit:!0,button:{"确定":function(){var b=h.el.find('input[type="radio"]:checked'),c=b.val()||"all",d=a["export"](c);d?h.toggleBtnDisable(!1,0):h.hide()}}})},c.exports=l}),define("cvm/cbs2/event/modifyalias",function(a,b,c){var d=a("$"),e=(a("router"),a("pageManager"),a("reporter")),f=(a("manager"),a("models/api"),a("dialog")),g=a("lengthlimiter"),h=a("util"),i=a("tips"),j=a("cvm/cbs2/data"),k={rename:'    <div class="edit_form_wrap">        <ul class="edit_psword">            <li>                <label class="txt" for="">新云硬盘名称:</label>                <input class="tc-15-input-text m" type="text" data-lenLimit="20" maxlength="20" relTipId="cbsNameTip" placeholder="请输入新名称">                <p class="tip" id="cbsNameTip"></p>            </li>        </ul>    </div>'},l=function(a,b){var c=f.el.find('input[type="text"]').eq(0);return d.trim(c.val())?c.val().length>20?i.error("名称不能超过20个字符"):void j.modifyStorageAttr({regionId:appUtil.getRegionId(),diskIds:[a[0]],diskName:c.val()}).then(function(a){f.hide(),i.success("更改名称成功"),b&&b.callback&&b.callback()}):i.error("请输入新名称")},m=function(a,b){var c=[];return d(a).each(function(a,b){c.push(b.diskId)}),0==c.length?(i.error("请选择一个云硬盘"),!1):(f.create(h.tmpl(k.rename,{itemList:a}),480,"",{title:"改名",preventResubmit:!1,button:{"确定":function(){l(c,b)}}}),e.click("yunzhuji.CBS.rename"),void g.trigger())};c.exports={init:function(a,b){m(a,b)}}}),define("cvm/cbs2/event/modifyDiskType",function(a,b,c){function d(a){var b=a.data,c=a.regionId;return q.apiRequest({serviceType:"cbs",action:"InquiryPriceModifyDiskAttributes",data:b,regionId:c})}function e(a){var b=a.data,c=a.regionId;return q.apiRequest({serviceType:"cbs",action:"SwitchParameterModifyDiskAttributes",data:b,regionId:c})}function f(a){return p.modifyStorageAttr(a)}function g(a){return p.queryDiskConfigQuota(a).then(function(a){var b=a.response.diskConfigSet,c=void 0===b?[]:b;return c})}function h(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],b=arguments[1],c=b.diskSize;return a.map(function(a){var b=c<a.minDiskSize||c>a.maxDiskSize,d=!a.available;return{name:o.getDiskTypeNameByDiskType(a.diskType),value:a.diskType,max:a.maxDiskSize,min:a.minDiskSize,disabled:b||d,title:b?"当前硬盘容量大小不满足目标类型大小范围["+a.minDiskSize+","+a.maxDiskSize+"]":d?"售卖火爆，已售罄，加紧补货中":void 0}})}function i(a,b){var c=b.find(function(a){return!a.disabled}),d=c&&c.value||"";if(o.isCloudBasicDiskType(a)){var e=b.find(function(a){return o.isCloudPremiumDiskType(a.value)&&!a.disabled});e&&(d=e.value)}if(o.isCloudPremiumDiskType(a)){var f=b.find(function(a){return o.isCloudSSDDiskType(a.value)&&!a.disabled});f&&(d=f.value)}return d}function j(a){return"undefined"==typeof a||null===a}var k=a("dialog"),l=a("qccomponent"),m=a("appUtil"),n=a("cvm/cvm/cvmutil"),o=a("cvm/cbs2/cbsutil"),p=a("cvm/cbs2/data"),q=a("cvm/common/model"),r=a("cvm/cbs2/event/selectedShow");c.exports={init:function(a,b){var c=_slicedToArray(a,1),o=c[0],q=b.callback,s=new l({$tpl:'    <div>      <div id="selectedshow"></div>      <div class="tip_box">        <p>          调整硬盘介质操作通过数据拷贝的方式进行，受数据量及网络传输影响操作将持续一定时间，请您耐心等待。同时，强烈建议您在转换完成后登录实例确认数据。        </p>        <p>调整硬盘介质操作不会退还差价费用，关于操作计费的更多规则，请参考<a          href="//cloud.tencent.com/document/product/213/31977"          target="_blank"          >《硬盘介质调整费用说明》 <i class="external-link-icon"></i>        </a>。</p>      </div>      <div class="param-box">        <div class="param-bd">          <ul class="form-list">            <li class="pure-text-row">              <div class="form-label"><label for="">目标硬盘类型</label></div>              <div class="form-input" b-if="!!diskConfigList">                <p b-if="diskConfigList.length">                  <label                    class="form-ctrl-label"                    b-repeat="diskConfigItem in diskConfigList"                    data-title="{{diskConfigItem.title}}"                     ><input                      type="radio"                      name="targetDiskType"                      value="{{diskConfigItem.value}}"                      checked?="targetDiskType == diskConfigItem.value"                      disabled?="diskConfigItem.disabled"                      b-model="targetDiskType"                      class="tc-15-radio"                    />{{ diskConfigItem.name }}</label                  >                </p>                <p b-if="!diskConfigList.length">无可用云硬盘类型</span>              </div>            </li>            <li class="pure-text-row">              <div class="form-label"><label for="">费用</label></div>              <div class="form-input">                <p b-if="showNoTargetCloudDiskConfigTips">                    <span class="text-warning">没有可以选择的目标云硬盘配置</span>                </p>                <p b-if="queryPriceState == \'loading\'">                    <i class="n-loading-icon"></i>                </p>                <p b-if="queryPriceState == \'success\'">                  <span b-if="finalPriceDesc" class="cost">                    <strong>{{ finalPriceDesc }}</strong>                  </span>                  <span b-if="originalPriceDesc" class="original-cost"> {{originalPriceDesc}}</span>                </p>                <p b-if="queryPriceState == \'failed\'">                  <span class="cost">                      <strong>查询失败</strong>                    </span>                </p>                <p b-if="queryPriceState == \'waiting\'">                  <span b-if="errorTips" class="text-warning">{{errorTips}}</span>                </p>              </div>            </li>          </ul>          <div class="mt-5">            <label class="form-ctrl-label">              <input                type="checkbox"                b-model="agreeChangeRule"                class="tc-15-checkbox"              />已阅读并同意              <a                href="//cloud.tencent.com/document/product/213/31978"                target="_blank"                >《调整硬盘介质规则说明》 <i class="external-link-icon"></i>              </a>            </label>          </div>        </div>      </div>    </div>  ',
$data:{disk:o,diskConfigList:null,showNoTargetCloudDiskConfigTips:!1,targetDiskType:"",queryPriceState:""},$afterInit:function(){this.queryDiskConfig(),this.$watch("diskConfigList",function(){this.showNoTargetDiskConfig(),this.setDefaultSelectedTargetDiskType()}),this.$watch("[targetDiskType,  queryPriceState, agreeChangeRule]",function(a){var b=_slicedToArray(a,3),c=b[0],d=b[1],e=b[2],f=c,g="success"==d;f&&g&&e?k.toggleBtnDisable(!1):k.toggleBtnDisable(!0)}),this.$watch("[targetDiskType]",function(){var a=this.diskConfigList&&this.diskConfigList.length,b=!!this.targetDiskType;a&&b&&this.queryPrice()})},queryDiskConfig:function(){var a=this,b=this.disk,c=b.attached,d=b.regionId,e=b.zone,f=b.diskType,i=b.diskChargeType,j=b.instanceFamily,k=b.diskSize,l=b.diskUsage,m=b.instanceCPU,n=b.instanceMemory,o={regionId:d,Zones:[e],DiskTypes:[f],DiskUsage:l,DiskChargeType:i,InquiryType:"INQUIRY_CBS_CONFIG",InnerInquiryType:"INQUIRY_MODIFY_TYPE"};c&&Object.assign(o,{InquiryType:"INQUIRY_CVM_CONFIG",InstanceFamilies:[j],CPU:m,Memory:n}),g(o).then(function(a){return h(a,{diskSize:k})}).then(function(b){a.$set({diskConfigList:b})})},showNoTargetDiskConfig:function(){var a=this.diskConfigList,b=a&&!a.length||a&&a.every(function(a){return a.disabled});this.$set("showNoTargetCloudDiskConfigTips",b)},setDefaultSelectedTargetDiskType:function(){var a=this.disk.diskType,b=this.diskConfigList,c=b&&b.length?i(a,b):"";this.$set({targetDiskType:c})},queryPrice:function(){var a=this,b=this.disk,c=b.diskId,e=b.regionId,f=this.targetDiskType,g=m.isI18n(),h=g?"美元":"元",i=g?"美元/小时":"元/小时";a.$set({queryPriceState:"loading",finalPriceDesc:"",originalPriceDesc:""}),d({data:{DiskIds:[c],DiskType:f},regionId:e}).then(function(b){var c=b.response.diskPrice,d=c.discountPrice,e=c.originalPrice,f=c.unitPrice,g=c.unitPriceDiscount;j(d)||j(e)?j(f)||j(g)?a.$set("queryPriceState","failed"):a.$set({queryPriceState:"success",finalPriceDesc:g+" "+i,originalPriceDesc:f>g?f+" "+i:""}):a.$set({queryPriceState:"success",finalPriceDesc:d+" "+h,originalPriceDesc:e>d?e+" "+h:""})},function(b){var c=b.code;b.message;"ResourceInsufficient"==c?a.$set({queryPriceState:"waiting",errorTips:"当前目标类型云硬盘暂不可用，请更换目标类型"}):a.$set("queryPriceState","failed")})},modifyPrepaidDiskType:function(){var a=this.disk,b=a.diskId,c=a.regionId,d=this.targetDiskType;e({data:{DiskIds:[b],DiskType:d},regionId:c}).then(function(a){var b=a.response.diskOrder;p.toPay2(b)})},modifyPostpaidDiskType:function(){var a=this.disk,b=a.diskId,c=a.regionId,d=this.targetDiskType;f({DiskIds:[b],DiskType:d,regionId:c}).then(function(){k.hide(),q&&q()})}});k.create(s.$el,"620","",{title:"调整云硬盘类型",preventResubmit:!0,buttonDisable:[1],button:{" 立即转换 ":function(){n.isPrepaidPayMode(s.disk.diskChargeType)?s.modifyPrepaidDiskType():s.modifyPostpaidDiskType()}}}),r.render({hasPermItems:[o],renderTo:"#selectedshow"})}}}),define("cvm/cbs2/event/modifyprops",function(a,b,c){var d=a("qccomponent"),e=a("cvm/cbs2/event/selectedShow"),f=a("dialog"),g=a("cvm/cbs2/data"),h=a("tips"),i=(a("widget/mfa/mfa"),{main:'  <div>    <div id="selectedshow"> </div>    <label class="form-ctrl-label">释放行为：      <input type="checkbox" class="tc-15-checkbox" b-model="isDeleteWithInstance">数据盘随实例一起释放</label>  </div>'});c.exports={init:function(a,b){if(a&&0!=a.length){var c=a[0].diskId,j=a[0].regionId,k=new d({$tpl:i.main,$afterInit:function(){},$data:{isDeleteWithInstance:a[0].deleteWithInstance}});f.create(k.$el,"610","",{title:"修改云硬盘属性",preventResubmit:!0,hideIcon:!0,defaultCancelCb:function(){k.$destroy()},button:{" 确定 ":function(){var a=k.$get("isDeleteWithInstance");g.modifyStorageAttr({regionId:j,diskIds:[c],DeleteWithInstance:a}).then(function(a){f.hide(),h.success("修改云硬盘属性成功"),b&&b.callback&&b.callback()})}}}),e.render({hasPermItems:a,actionName:"修改属性"})}}}}),define("cvm/cbs2/event/renew",function(a,b,c){function d(a){q=null;var b=a||"12",c=r.item.deadlineTime,d=(j.date.str2Date(c),r.item.uInstanceExpiredTime||"");if(1==r.item.portable&&d){var f=j.date.str2Date(d);g.el.find(".insExpired").text(j.date.date2Str(f,"%Y-%M-%d"))}var i=g.el.find("#payCbsDiff input").is(":checked"),n={period:b};d&&i&&(n.curInstanceDeadline=d),h.queryRenewDIskGeneral({regionId:e,diskIds:[r.item.diskId],diskChargePrepaids:[n]},{tipErr:!1}).then(function(a){var b=a[0]&&a[0].response||{},c=b&&b.diskPrice&&b.diskPrice,d=g.el.find('[data-field="cost"]'),e=g.el.find("[data-discount]");d.html(c.discountPrice),c.originalPrice&&c.originalPrice!==c.discountPrice?(g.el.find('[data-field="origin-cost"]').html(c.originalPrice+" 元 "),g.el.find("[data-field=pricetitle]").text("优惠价:"),e.show()):(g.el.find("[data-field=pricetitle]").text("费用:"),e.hide()),b=a[1]&&a[1].response||{};var f=b&&b.needAlignWithInstance;f?g.el.find("#payCbsDiff").show():g.el.find("#payCbsDiff").hide(),q=b.diskOrder;var h=b.newDeadlineSet&&b.newDeadlineSet[0];g.el.find(".deadlinetime").html(h.slice(0,11))},function(a){if(a&&a.data&&m.isCamRefused(a.data)){var b=new Bee("<span><cam-help-tips>"+a.data.message+"</cam-help-tips></span>");g.el.find("[data-field=cost]").html(b.$el)}else{var c=a&&a.data&&a.data.message||l.defaultReqErr;k.error(c)}})}var e,f=a("$"),g=a("dialog"),h=a("cvm/cbs2/data"),i=a("cvm/common/components/TimePill/timePill"),j=a("util"),k=a("tips"),l=a("nmcConfig"),m=a("widget/errorTips/errorTips"),n=a("widget/mfa/mfa"),o=a("cvm/common/constants"),p={renew:'    <div class="dialog_layer_cont renew-form">    <ul class="form-list">        <li>            <div class="form-label">                <label for="">续费时长</label>            </div>            <div class="form-input">            <div class=" timetype" role="radiogroup"></div>            </div>        </li>         <li>            <div class="form-label">                <label for="">新到期时间</label>            </div>            <div class="form-input deadlinetime" >            </div>        </li>        <li id="payCbsDiff" style="display: none;">            <div class="form-label">                <label for="">续费选项</label>            </div>            <div class="form-input">                <label class="form-ctrl-label" style="margin-right: 0px;"><input type="checkbox" class="tc-15-checkbox" checked>对齐到期时间</label>                <span class="inline-help-text text-weak">（和绑定实例的到期时间对齐，云硬盘到期时间将延长至 <span class="insExpired"></span>）</span>                <p id="payCbsDiffWarn" class="text-weak text-danger" style="display: ;">当实例与云硬盘的到期回收时间不一致时，云硬盘欠费时会被隔离，中断业务。</p>            </div>        </li>        <li>            <div class="form-label pt20">                <label for="" data-field="pricetitle">费用</label>            </div>            <div class="form-input pt20">                <span class="price"><span data-field="cost"></span><em>元</em></span>                <span data-discount style="display: none;">                    <span data-field="origin-cost" class="original-cost"></span>                </span>            </div>        </li>    </ul></div> '},q=null,r={},s=function(a,b){e=b.regionId,r.item=a=a[0],g.create(j.tmpl(p.renew,b),790,"",{title:"云硬盘续费",preventResubmit:!1,button:{"确定":function(){null!==q&&(h.toPay2(q),g.hide(),b&&b.callback&&b.callback())}}});var c=o.HIDE_DISCOUNT_REGIONS,k=-1==c.indexOf(e);r.timeTypePills=new i({renderTo:g.el.find(".timetype"),showDiscountIcon:k,defaultTriggerChange:!0,showOtherTime:!0,change:function(a){d(a)}}),d(),g.el.find("#payCbsDiff input").click(function(){var a=f(this).is(":checked");g.el.find("#payCbsDiffWarn")[a?"hide":"show"](),d()})};c.exports={init:function(a,b){r={},s(a,b)},setAutoRenew:function(a,b){a=a[0],n.verify({api:"cvm:ModifyDisksRenewFlag"}).then(function(){var c=a.autoRenewFlag?'确定<em class="text-danger">取消</em> '+a.diskId+"（"+a.diskName+"）的自动续费？":"确定将 "+a.diskId+"（"+a.diskName+"）设为自动续费？",d=a.autoRenewFlag?'自动续费可以有效避免因为忘记续费而导致的云硬盘被<em class="text-danger">停用、回收</em>，<em class="text-danger">强烈建议</em>您保留自动续费配置。':"设置自动续费后，在账户余额充足的情况下，云硬盘到期后将按月自动续费，避免忘记续费导致云硬盘被回收。";g.create(d,720,"",{title:c,preventResubmit:!1,button:{" 确定 ":function(){h.setCbsAutoRenewFlag({regionId:b.regionId,diskIds:[a.diskId],renewFlag:a.autoRenewFlag?"NOTIFY_AND_MANUAL_RENEW":"NOTIFY_AND_AUTO_RENEW"}).then(function(){var c=a.autoRenewFlag?"自动续费已取消":"自动续费成功";k.success(c),b&&b.callback&&b.callback()}),g.hide()}}})})}}}),define("cvm/cbs2/event/selectedShow",function(a,b,c){var d=a("$"),e=a("util"),f=a("event"),g=a("dialog"),h={main:'  <div class="act-outline" id="selectedShowWrap">    <div class="act-summary">您已选      <strong>        <%-hasPermItems.length%>台        <%=insName%>      </strong>      <a href="javascript:;" data-event="s_show_detail">查看详情        <i id="selectedShowIconArr" class="icon-arrow-down"></i>      </a>    </div>    <div class="act-details" id="selectedShowDetail">      <style>        #selectedShowDetail td {          padding: 0 10px;        }      </style>      <table class="act-details-tb">        <tbody>          <tr>            <td style="padding:0px">No.</td>            <td style="width:100px">              <span class="">云硬盘名称</span>            </td>            <td style="width:100px">              <span class="">云硬盘ID</span>            </td>            <td style="width:60px">              <span class="">计费模式</span>            </td>            <td>              <span class="entity-name dev-bold">到期/创建时间</span>            </td>          </tr>        </tbody>      </table>      <table class="act-details-tb">        <tbody>          <% for (var i = 0, item; item = hasPermItems[i]; i++) { %>          <tr>            <td style="padding:0px">              <%=i+1%>            </td>            <td style="width:100px">              <span class="entity-name" data-title="<%=item.diskName%>">                <%=item.diskName%>              </span>            </td>            <td style="width:100px">              <span class="entity-name" data-title="<%=item.diskId%>">                <a href="/cvm/cbs/detail?diskId=<%=item.diskId%>" data-event="nav">                  <%=item.diskId%>                </a>              </span>            </td>            <td style="width:60px">              <span class="" data-title="<%=item.payModeDesc%>">                <%=item.payModeDesc%>              </span>            </td>            <td>              <span class="entity-name">                <%=item.deadlineTimeDesc%>              </span>            </td>          </tr>          <% } %>        </tbody>      </table>    </div>  </div>'},i={render:function(a){var b=a.hasPermItems||[],c=e.tmpl(h.main,{actionName:a.actionName||"",hasPermItems:b,insName:a.insName||"云硬盘"});return b.length||g.toggleBtnDisable(1),a.renderTo?d(a.renderTo).html(c):g.el.find(".dialog_layer_cont").prepend(c),g.center(),this.bindEvt(),this},bindEvt:function(){var a=this;f.addCommonEvent("click",{s_show_detail:function(){a._toggleBox()}})},_toggleBox:function(){var a=d("#selectedShowDetail"),b=d("#selectedShowIconArr");a.toggle(),a.is(":visible")?b.removeClass("icon-arrow-down").addClass("icon-arrow-up"):b.removeClass("icon-arrow-up").addClass("icon-arrow-down"),g.center()}};c.exports=i}),define("cvm/cbs2/event/SnapshotListSelector/snapshotListSelector",function(a,b,c){var d=a("$"),e=a("qccomponent"),f=a("cvm/common/model"),g=a("appUtil"),h=e.getComponent("qc-popover"),i=e.extend({$tpl:'  <div class="tc-15-autocomplete open" style="width: 300px;">    <div class="tc-15-autocomplete-inner">      <div class="tc-15-autocomplete-input-wrap">        <input class="tc-15-input-text" type="text" maxLength="{{maxInputLength}}" placeholder="{{placeholder}}"          b-model="keyword" b-ref="input" b-on="{focus: inputFocus.bind(this), blur: inputBlur.bind(this)}" value="{{inputValue}}">      </div>      <button class="tc-15-dropdown-icon" b-on="{click: toggleList.bind(this)}">        <i class="dropdown-icon"></i>      </button>    </div>    <ul class="tc-15-autocomplete-menu" role="menu" b-ref="ul" b-if="showUl" b-on="{scroll:ulScroll.bind(this)}">      <li role="presentation" b-repeat="item in list" data-index="{{$index}}">        <a b-if="item.disabled" class="text-truncate disabled" role="menuitem" href="javascript:;" data-title="{{item.desc}}">          {{>item.hightlightDesc}}        </a>        <a b-if="!item.disabled" class="text-truncate" role="menuitem" href="javascript:;" data-title="{{item.desc}}"          b-on-click="selectItem(item)">          {{>item.hightlightDesc}}        </a>      </li>      <li b-if="isEmpty" role="presentation">        <a class="autocomplete-empty" role="menuitem" href="javascript:;">          {{emptyTips}}        </a>      </li>      <li b-if="isLoading" role="presentation">        <a class="autocomplete-empty" role="menuitem" href="javascript:;">          <i class="n-loading-icon"></i>{{loadingTips}}        </a>      </li>      <li b-if="isFail" role="presentation">        <a class="autocomplete-empty" role="menuitem" href="javascript:;" b-on-click="reload()">          {{>failTips}}        </a>      </li>      <li b-if="isAll" role="presentation">        <a class="autocomplete-empty" role="menuitem" href="javascript:;">          以上共 <strong>{{totalCount}} </strong> 条搜索结果</span>        </a>      </li>    </ul>  </div>',$beforeInit:function(){this.$set("showUl",!1),this.$set("isInited",!1)},$afterInit:function(){var a=this;a.$watch("keyword",function(b,c){var d=a.isInited?a.searchDelay:0;b=b.trim(),c=c&&c.trim(),a.$set("inputValue",b),b!=c&&(clearTimeout(a.timer),a.timer=setTimeout(function(){a.clearResult(),a.inited(),a.updateQueryParam({page:a.defaultPage,count:a.defaultCount,keyword:b},{replace:!0})},d))}),a.$watch("queryParam",function(b){a.renderList()})},updateQueryParam:function(a,b){var c=this;c.page=a.page,c.count=a.count,c.keyword=a.keyword;var d={};d.offset=(a.page-1)*a.count,d.limit=a.count;var e=[];e.push({name:"snapshot-state",values:["NORMAL"]}),e.push({name:"disk-usage",values:["DATA_DISK"]}),/^snap-\w{8}$/.test(a.keyword)?e.push({name:"snapshot-id",values:[a.keyword]}):a.keyword&&e.push({name:"snapshot-name",values:[a.keyword]}),d.filters=e,c.$set("queryParam",d),c.$set("option",b)},queryList:function(a){var b=this;return new Promise(function(c,d){f.apiRequest({serviceType:"cbs",action:"DescribeSnapshots",data:a,regionId:b.regionId},{camTipsType:"dialog"}).then(function(a){a=a&&a.response||{},c(a)},function(a){d(a)})})},formatList:function(a){var b=this;return a=a||[],a.forEach(function(a){a.desc="["+a.diskSize+"GB] "+a.snapshotId+" | "+(a.snapshotName||"未命名"),a.hightlightDesc=b.keyword?"["+a.diskSize+"GB] "+a.snapshotId.replace(b.keyword,"<em>"+b.keyword+"</em>")+" | "+(a.snapshotName.replace(b.keyword,"<em>"+b.keyword+"</em>")||"未命名"):a.desc}),a},renderList:function(){var a=this,b=a.$get("queryParam");a.hideAllTips(),a.showDropdown(),a.showIsLoading(),a.queryList(b).then(function(b){a.hideAllTips();var c=a.formatList(b.snapshotSet),d=b.totalCount||0;0==d?(a.$set("isEmpty",!0),a.$set("selectedItem",null)):(a.$get("option").replace?a.$set("list",c):a.list.splice.apply(a.list,[a.list.length,0].concat(c)),a.$set("totalCount",d),a.list.length==a.totalCount?a.showIsAll():a.showIsMore())},function(b){a.hideAllTips(),a.showIsFail()})},inputFocus:function(a){this.isInited||this.$set("keyword","")},inputBlur:function(a){var b=this,c=setTimeout(function(){b.selectedItem||(clearTimeout(c),b.showPopover({content:'<span class="text-danger">未找到该快照，请重新选择</span>',hideDelay:3e3,handler:d(b.$refs.input)}))},250)},showPopover:function(a){var b=this,c={content:"输入错误",position:"top",auto:!1,style:"",hideDelay:3e3,handler:null,hideDestroy:!0,trigger:"hover"},e=d.extend({},c,a);b.popover=new h({$data:{content:e.content,position:e.position,auto:e.auto,style:e.style,hideDelay:e.hideDelay},handler:e.handler,hideDestroy:e.hideDestroy,trigger:e.trigger}),b.popover.show(),setTimeout(function(){if(b.popover){b.popover.hide();var a=d(b.$el).find("[data-role=qc-popover]");a&&a.remove(),b.popover=null}},e.hideDelay)},toggleList:function(a){this.isInited?this.$set("showUl",!this.$get("showUl")):this.inputFocus()},ulScroll:function(a){var b=this,c=d(b.$refs.ul),e=c[0].scrollHeight,f=c.height(),g=c[0].scrollTop;e-f==g&&!b.isLoading&&b.$get("isMore")&&b.updateQueryParam({page:b.page+1,count:b.defaultCount,keyword:b.keyword},{replace:!1})},selectItem:function(a){var b=this;b.hideAllTips(),b.hideDropdown(),b.$set("selectedItem",a),b.$set("inputValue",a.desc)},clearSelectedItem:function(){this.$set("selectedItem",null),this.$set("inputValue","")},reload:function(){var a=this;a.renderList()},hideAllTips:function(){this.$set("isAll",!1),this.$set("isFail",!1),this.$set("isLoading",!1),this.$set("isMore",!1),this.$set("isEmpty",!1)},showIsAll:function(){this.$set("isAll",!0)},showIsFail:function(){this.$set("isFail",!0)},showIsLoading:function(){this.$set("isLoading",!0)},showIsMore:function(){this.$set("isMore",!0)},showIsEmpty:function(){this.$set("isEmpty",!0)},showDropdown:function(){this.$set("showUl",!0)},hideDropdown:function(){this.$set("showUl",!1)},inited:function(){this.$set("isInited",!0)},clearResult:function(){this.$set("list",[]),this.$set("totalCount",0)}},{defaults:{inputValue:"",placeholder:"请选择快照，支持搜索ID和名称",emptyTips:"没有匹配的快照",loadingTips:" 正在加载",failTips:'加载失败，<span class="text-primary">重新加载</span>',searchDelay:500,maxInputLength:60,defaultCount:20,defaultPage:1,regionId:g.getRegionId(),zone:void 0}});c.exports=i}),define("cvm/cbs2/event/tag/tag",function(a,b,c){var d=a("cvm/cvm/cvmutil"),e=a("lib/tag-sdk-importer"),f=function(a,b){var c=b.regionId,f=d.getRegion(c);e.ready().then(function(c){c.batchEditTag({resourceIds:a.map(function(a){return a.diskId}),resourcePrefix:"volume",serviceType:"cvm",region:f,callback:function(a,c){"complete"===a&&b.callback()}})})};c.exports={init:function(a,b){f(a,b)}}}),define("cvm/cbs2/event/TagListSelector/tagListSelector",function(a,b,c){var d=a("$"),e=a("qccomponent"),f=(a("cvm/common/model"),a("appUtil"),a("cvm/cbs2/data")),g=a("config/reactSupport"),h=e.extend({$tpl:'  <div class = "form-unit">    <div class="form-text show-tad-table-btn"><a href="#" b-on-click="showTagTable()">添加</a></div>    <div class="tc-15-table-panel tag-table" style ="display: none">      <div class="tc-15-table-fixed-head">        <table class="tc-15-table-box">          <colgroup>            <col>            <col>            <col style="width:120px">          </colgroup>          <thead>            <tr>              <th>                <div>                  <span class="text-overflow">标签键</span>                </div>              </th>              <th>                <div>                  <span class="text-overflow">标签值</span>                </div>              </th>              <th>                <div>                  <span class="text-overflow">操作</span>                </div>              </th>            </tr>          </thead>        </table>      </div>      <div class="tc-15-table-fixed-body">        <table class="tc-15-table-box tc-15-table-rowhover">          <colgroup>            <col span="2">            <col style="width:120px">          </colgroup>          <tbody>            <tr class = "keyItem"></tr>          </tbody>          <tfoot>            <tr class="" b-if="dataReady">            <td colspan="3">            <div class="">             <a href="#" b-on-click="addKeyValues()">添加</a>            </div>            </td>            </tr>         </tfoot>        </table>      </div>    </div>  </div>',$afterInit:function(){var a=this;f.getTagKeyList().then(function(b){var c=b.data.rows;a.$set("keyList",c),a.$set("dataReady",!0),a.$set("tagDisabled",!1),c.length&&f.getTagValueList({tagKeys:c}).then(function(b){a.$set("allKeyValueMap",b.data.rows);var c={};a.$get("allKeyValueMap").forEach(function(a){void 0!==c[a.tagKey]?c[a.tagKey]+=1:c[a.tagKey]=1}),a.$set("keyToValueLen",c)})},function(b){console.log("err:",b),a.$set("keyList",[]),a.$get("buyCbsRef").$set("tagRWAuth",!1),a.$set("tagDisabled",!0),a.addSelectorToTag(0)})},findValueByKey:function(a){return this.$get("allKeyValueMap").filter(function(b){return b.tagKey==a}).map(function(a){return a.tagValue})},showTagTable:function(){d(".tag-table").show(),d(".show-tad-table-btn").hide(),this.addKeyValues()},addKeyValues:function(){var a=this.$get("tagList");a.push({key:"",value:""}),this.$set("tagList",a),d("#tagList").find("tbody").append('<tr class="keyItem"></tr>'),this.addSelectorToTag(this.$get("tagList").length-1)},deleteKeyValues:function(a){var b=this.$get("tagList");b[trIndex]=null},addSelectorToTag:function(a){var b=d("#tagList").find("tbody > tr.keyItem")[a];this.addTagKeySelector(b,a)},formatArr:function(a){return a.map(function(a,b){return{id:b,label:a}})},filterInvalidTag:function(){return this.$get("tagList").filter(function(a){return a&&""!==a.key}).map(function(a){return"（空值）"===a.value?{key:a.key,value:""}:a})},addTagKeySelector:function(a,b){var c=this,d="",e=Object.assign([],c.$get("keyList")),f="",h=[],i=[{id:0,label:"无",disabled:!0}],j=[{id:0,label:"无相关搜索内容",disabled:!0}],k=this.formatArr(e),l=this.formatArr(h);g.useTea(function(){var g=React.__SECRET_DOM_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,h=window.tea.component.AutocompleteSelector,m=React.createClass({displayName:"AutocompleteSelector",getInitialState:function(){return{keylist:k,key:d,valuelist:l,value:f}},render:function(){var a=this;return React.createElement("td",{colSpan:"2"},[React.createElement("div",{style:{display:"inline"}},React.createElement(h,{list:a.state.keylist,value:a.state.key,disabled:c.$get("tagDisabled"),onChange:function(b){var c=k.filter(function(a){return new RegExp(b,"gi").test(a.label)});0==c.length&&(c=j),a.setState({key:b,keylist:c})},onFocus:function(b){var d=Object.assign({},c.$get("keyToValueLen"));c.filterInvalidTag().forEach(function(a){d[a.key]--});var f=c.formatArr(e.filter(function(a){return d[a]>-1}));f.length?a.setState({keylist:f}):a.setState({keylist:i})},onSelect:function(d){a.setState({key:d.label,value:""});var e=c.$get("tagList");e[b]=Object.assign({},e[b],{key:d.label})},width:"220",onBlur:function(d){var e=c.$get("tagList");a.setState({key:e[b].key})},placeholder:"请输入标签键"})),React.createElement("div",{style:{display:"inline"}},React.createElement(h,{list:a.state.valuelist,value:a.state.value,disabled:c.$get("tagDisabled"),width:"220",onChange:function(b){var c=l.filter(function(a){return new RegExp(b,"gi").test(a.label)});0==c.length&&(c=j),a.setState({value:b,valuelist:c})},onFocus:function(b){var d=a.state.key;if(d){var e=c.findValueByKey(d),e=e.map(function(a){return a||"（空值）"}),f=c.$get("tagList").filter(function(b,c){return b&&b.key==a.state.key&&""!==b.value&&b.value!==a.state.value}).map(function(a){return a.value}),g=e.filter(function(a,b){return f.indexOf(a)<=-1});l=g.length?c.formatArr(g):i,a.setState({valuelist:l})}else l=i,a.setState({valuelist:l})},onSelect:function(d){a.setState({value:d.label});var e=c.$get("tagList");e[b]=Object.assign({},e[b],{value:d.label})},onBlur:function(d){var e=c.$get("tagList");a.setState({value:e[b].value})},placeholder:"请输入标签值"})),React.createElement("td",null,React.createElement("div",null,React.createElement("a",{href:"javascript:;",className:"deleteTag","data-index":b},"删除")))])}});g.render(React.createElement(m,null),a)})}});c.exports=h}),define("cvm/cbs2/event/upgradedisk",function(a,b,c){function d(a){var b=[];return 250==a?b=[50,100,250]:400==a?b=[100,200,400]:500==a?b=[100,300,500]:800==a?b=[160,480,800]:1e3==a?b=[200,500,1e3]:1200==a?b=[200,500,1200]:a>=1500&&(b=[200,500,1e3,a]),b}var e,f=a("$"),g=(a("router"),a("pageManager"),a("util")),h=(a("tips"),a("reporter"),a("manager"),a("models/api"),a("dialog")),i=a("cvm/cbs2/data"),j=a("cvm/cvm/data"),k=(a("appUtil"),a("widget/range/range")),l=(a("cvm/cbs2/cbsutil"),a("nmcConfig"),a("widget/errorTips/errorTips"),a("cvm/cbs2/constants"),a("cvm/common/model")),m={main:'  <div id="upgradeConfigWrap">    <div class="tc-15-msg" style="margin-bottom:20px">      <div style="color:#f00">重要提示：</div>      <ul>        <li style="color:#f00">          强烈建议您在执行扩容操作前对云硬盘制作快照，防止因误操作造成文件系统损坏        </li>        <li>为了防止数据丢失，硬盘只可扩容不可缩</li>        <li>          硬盘扩容后需要登录虚拟机手动修改文件系统配置，把新增部分容量使用起来，请见详细说明：          <a            href="https://www.qcloud.com/document/product/362/6737"            target="_blank"            class="guide-link"            >扩容Windows文件系统<b class="external-link-icon"></b>          </a>          和          <a            href="https://www.qcloud.com/document/product/362/6738"            target="_blank"            class="guide-link"            >扩容Linux文件系统<b class="external-link-icon"></b          ></a>        </li>      </ul>    </div>    <ul class="form-list">      <li>        <div class="form-label"><label>当前容量</label></div>        <div class="form-input">          <p class="normal-txt">            <span> <%-cbsSize%>GB</span>          </p>        </div>      </li>      <li>        <div class="form-label"><label>目标容量</label></div>        <div class="form-input">          <div id="storagesizerange" style="width:450px"></div>        </div>      </li>      <% if ( !isCdcPay) { %>      <li>        <div class="form-label">          <label data-field="pricetitle">            需支付费用          </label>        </div>        <div class="form-input">          <span class="cost"><strong data-field="cost"></strong><%-unit%></span>        </div>      </li>      <% } %>    </ul>  </div>'},n=function(a,b){this.item=a,this.param=b};n.prototype={exec:function(){var a=this,b=this.item,c={regionId:b.regionId,diskChargeType:b.diskChargeType,zones:[b.placement.zone],inquiryType:"INQUIRY_CBS_CONFIG",innerInquiryType:"INQUIRY_RESIZE"};this.isSecondPay="POSTPAID_BY_HOUR"==b.diskChargeType,Promise.all([this.getProjectName(),i.queryDiskConfigQuota(c)]).then(function(c){b.projectName=b.projectName||c&&c[0];var d=c&&c[1]&&c[1].response&&c[1].response.diskConfigSet||[],e=g.tmpl(m.main,{isSecondPay:a.isSecondPay,isCdcPay:"CDCPAID"==b.diskChargeType,cbsSize:b.diskSize,unit:(a.param.isI18n?"美元":"元")+(a.isSecondPay?"/小时":"")});h.create(e,"570","",{title:"调整硬盘",preventResubmit:!0,button:{" 确定 ":function(){a.toUpgrade(),h.hide()}}}),a.renderStorageSize(d)})},getProjectName:function(a){var b=f.Deferred(),c="*****";return e?b.resolve(e[a]||c):j.getProjects().then(function(d){var f=d;e={};for(var g,h=0;g=f[h];h++)e[g.projectId]=g.name;b.resolve(e[a]||c)}),b.promise()},renderStorageSize:function(a){var b=this,c=this.item,e=(c.diskType,c.diskSize),f=a.find(function(a){return a.available&&a.diskType==c.diskType&&a.diskUsage==c.diskUsage});if(!f)return void h.create(g.tmpl('  <div class="ui-popmsg">    <div class="info">      <span class="tit"></span>      <p>云硬盘售罄</p>    </div>  </div>'),"550","",{title:"调整硬盘",button:{" 确定 ":function(a){h.hide()}}});var i=f.maxDiskSize,j=f.minDiskSize;j=j>e+10?j:e+10,j=j>i?i:j;var l=d(i)||[];l=l.map(function(a,b){return{value:a,width:300/l.length*(b+1)}}),this.storageSizeRange=new k({renderTo:h.el.find("#storagesizerange"),unit:"GB",value:e,min:j,max:i,width:300,step:10,section:l,change:function(){b.setPrice()}}),this.setPrice()},toUpgrade:function(){var a=this,b=this.item,c=this.storageSizeRange.val();if("POSTPAID_BY_HOUR"==b.diskChargeType||"CDCPAID"==b.diskChargeType){if(c==b.diskSize)return this.tipsError("配置未变更!");b.portable?i.resizePostpaidDiskPortable({diskId:b.diskId,diskSize:c,regionId:b.regionId}).then(function(b){h.hide(),setTimeout(function(){a.param&&a.param.callback&&a.param.callback()},500)}):i.resizePostpaidDiskUnportable({instanceId:b.instanceId,dataDisks:[{diskSize:c}],regionId:b.regionId}).then(function(b){h.hide(),a.param&&a.param.callback&&a.param.callback()})}else this.collectData(function(a){i.toPay2(a)})},setPrice:function(){var a=this.isSecondPay,b=this.item,c=this.storageSizeRange.val();if(b.portable)i.queryResizeDiskPrice({diskId:b.diskId,diskSize:c,regionId:b.regionId}).then(function(b){var c=b.response&&b.response.diskPrice,d=a?c.unitPriceDiscount:c.discountPrice;d&&h.el.find("[data-field=cost]").text(d)});else if("PREPAID"==b.diskChargeType){var d={InstanceId:b.instanceId,DataDisks:[{DiskSize:c}]};i.queryResizeInstanceDiskPrice(d).then(function(a){var b=a&&a.response&&a.response.price&&a.response.price.instancePrice&&a.response.price.instancePrice.discountPrice||0;h.el.find('[data-field="cost"]').text(b)})}},collectData:function(a){var b=this.item,c=(b.diskSize,this.storageSizeRange.val());if(b.portable)i.getResizeDiskOrderParams({regionId:b.regionId,diskId:b.diskId,diskSize:c}).then(function(b){var c=b&&b.response&&b.response.diskOrder;c&&a&&a(c)});else{var d=[{InstanceId:b.instanceId,DataDisks:[{DiskSize:+c}]}];l.apiRequest({serviceType:"cvm",action:"SwitchParameterResizeInstanceDisks",data:d[0],regionId:b.regionId}).then(function(b){d=b&&b.response.instanceOrder.goods,a&&a(d)})["catch"](function(a){console.warn(a)})}}},c.exports={init:function(a,b){i.queryWhiteList().then(function(c){c=c;var d=new n(a,b);d.exec()})}}}),define("cvm/cbs2/monitor",function(a,b,c){var d=(a("manager"),a("appUtil"),a("cvm/cbs2/constants"),{namespace:"qce/cvm",policyViewName:"BS",metrics:[{metricCName:"硬盘读流量",metricName:"disk_read_traffic",namespace:"qce/block_storage",dimensions:["diskId"],unit:"KB/s"},{metricCName:"硬盘写流量",metricName:"disk_write_traffic",namespace:"qce/block_storage",dimensions:["diskId"],unit:"KB/s"},{metricCName:"硬盘读IOPS",metricName:"disk_read_iops",namespace:"qce/block_storage",dimensions:["diskId"],unit:"个"},{metricCName:"硬盘写IOPS",metricName:"disk_write_iops",namespace:"qce/block_storage",dimensions:["diskId"],unit:"个"},{metricCName:"IO Await",metricName:"disk_await",namespace:"qce/block_storage",dimensions:["diskId"],unit:"ms"},{metricCName:"IO Svctm",metricName:"disk_svctm",namespace:"qce/block_storage",dimensions:["diskId"],unit:"ms"},{metricCName:"IO %util",metricName:"disk_util",namespace:"qce/block_storage",dimensions:["diskId"],unit:"%"}]}),e=function(a){var b={diskId:a.diskId,storageName:a.diskName},c={title:b.diskId,subTitle:b.storageName,instance:b};return a.instanceId||(c.nodataMsg="该云硬盘未被挂载，暂无数据"),c};c.exports.showList=function(b,c,f){var g=a("lib/monitor-sdk-importer");g.ready().then(function(a){var g=$.extend({pagination:{range:{from:0,to:b.length},index:c},getData:function(a){return a=a||0,new Promise(function(c){var d=e(b[a]);f&&f(d.instance.storageId),c(d)})}},d);a.MonitorPanelBuilder.build(g)})},c.exports.showDetail=function(b,c){var f=a("lib/monitor-sdk-importer");f.ready().then(function(a){var f=$.extend({getData:function(){return new Promise(function(a){a(e(b))})}},d);a.MonitorDetailBuilder.build(f,c)})}}),define("cvm/cbs2/operate_auth",function(a,b,c){var d=function(a){this.options=a};d.prototype={getAuth:function(){var a=this.options,b=a.dataItems,c=a.operAction;c=c||[];for(var d,e={},f=0;d=c[f];f++){var g=this.judgment[d];g?e[d]=g.call(this,b):e[d]={code:0}}return e},judgment:{modifyDiskType:function(a){if(1==a.length){var b=a[0];return"SYSTEM_DISK"==b.diskUsage?this.disable("暂不支持调整系统盘介质"):"DATA_DISK"!=b.diskUsage||b.portable?this.enable():this.disable("暂不支持调整非弹性数据盘介质")}return this.disable()},renew:function(a){var b;return a.length>0?1==a.length?(b=a[0],b.isRenew?this.enable():"SYSTEM_DISK"==b.diskUsage&&"PREPAID"==b.diskChargeType?this.disable("CVM续费时，该实例CPU、内存，系统盘一并续费，请到CVM控制台进行续费"):"POSTPAID_BY_HOUR"==b.diskChargeType?this.disable("按量计费的云硬盘，无需续费，请保持账户余额充足"):"CDCPAID"==b.diskChargeType?this.disable("不计费的云硬盘，无需续费，请保持账户余额充足"):this.disable("")):this.disable("请选择续费的唯一云硬盘"):this.disable("请选择你需要续费的云硬盘")},createsnapshot:function(a){var b;return a.length>0?1==a.length?(b=a[0],b.isSnapAbility?this.enable():this.disable("无法创建快照，请重新选择")):this.disable("请选择创建快照的唯一云硬盘"):this.disable("请选择你需要创建快照的云硬盘")},upgradedisk:function(a){var b,c;return a.length>0?1==a.length?(b=a[0],b.isUpgrade?this.enable():(c="SYSTEM_DISK"==b.diskUsage?"扩容系统盘需要前往实例控制台进行重装系统操作，建议您挂载新的数据盘或扩容原有数据盘":1!=b.portable?"非弹性数据盘扩容需要在实例控制台进行调整硬盘操作":"",this.disable(c))):this.disable("请选择扩容的唯一云硬盘"):this.disable("请选择你需要扩容的云硬盘")},attach:function(a){var b=[];if(a.length>0){for(var c,d=0;c=a[d];d++)c.isAttach||b.push(c);
return b.length?this.disable("选择的云硬盘无法挂载，请重新选择"):this.enable()}return this.disable("请选择你需要挂载的云硬盘")},changeproject:function(a){var b;return a.length>0?1==a.length?(b=a[0],b.isChangeProject?this.enable():this.disable("无法分配至项目，请重新选择")):this.disable("请选择分配至项目的唯一云硬盘"):this.disable("请选择你需要分配至项目的云硬盘")},modifyalias:function(a){var b;return a.length>0?1==a.length?(b=a[0],b.isAlias?this.enable():this.disable("无法改名，请重新选择")):this.disable("请选择改名的唯一云硬盘"):this.disable("请选择你需要改名的云硬盘")},cancelattach:function(a){var b=[];if(a.length>0){for(var c,d=0;c=a[d];d++)c.isCancelAttach||b.push(c);return b.length?this.disable("选择的云硬盘无法卸载，请重新选择"):this.enable()}return this.disable("请选择你需要卸载的云硬盘")},exports:function(a){return a.length>0?this.enable():this.disable("请选择你需要导出信息的云硬盘")},refund:function(a){if(a.length>0){var b=[],c=!0,d="";return a.forEach(function(a){-1==b.indexOf(a.diskChargeType)&&b.push(a.diskChargeType),c&&!a.isRefund&&(c=!1,d=a.reason)}),b.length>1?this.disable("不支持同时销毁包年包月和按量计费云硬盘"):c?this.enable():this.disable(d)}return this.disable("请选择你需要销毁的云硬盘")},editTag:function(a){return a.length>0?this.enable():this.disable("请选择你需要编辑标签的云硬盘")}},enable:function(){return{code:0}},disable:function(a){return{code:a.code?a.code:1,tip:a.tip?a.tip:a}}},c.exports=d}),define("cvm/cbs2/search_box",function(a,b,c){function d(a){var b=a.zoneList,c=a.projectList||[];c=[{projectId:-1,name:"全部项目"}].concat(c),c.forEach(function(a){B[a.projectId]=a.name});var d=[];b&&b.forEach(function(a){d.push({value:k.ZONEIDMAP[a.zoneId],name:a.zoneName})}),d.length&&(s[y].values=d);var e=[];if(c&&c.forEach(function(a){e.push({value:a.projectId,name:a.name})}),e.length&&(s[x].values=e),w){for(var f in w){var g=w[f],h=s.find(function(a){return a.key==f});if(h){var i=[];g.forEach(function(a){var b=h.values.find(function(b){return b.value==a});b&&i.push({value:a,name:b.name})}),i.length&&A.push({values:i,attr:h})}}v&&v.setState({value:A}),w=null}}function e(a){a=a||[];for(var b={},c=0;c<a.length;c++){var d=a[c];if(null!=d.attr)d.attr=d.attr||{},"input"==d.attr.type?(b[d.attr.key]=b[d.attr.key]||[],b[d.attr.key]=b[d.attr.key].concat(d.values.map(function(a){return a.name}))):(b[d.attr.key]=b[d.attr.key]||[],b[d.attr.key]=b[d.attr.key].concat(d.values.map(function(a){return a.value})));else{var e="innerSearch";z.test(d.values[0].name)&&(e="disk-id"),b[e]=b[e]||[],b[e]=b[e].concat(d.values[0].name.split("|"))}}if(b.innerSearch){if(b.innerSearch.length>1)return j.error("暂不支持批量模糊搜索"),null;b.innerSearch=b.innerSearch[0]}b["project-id"]&&b["project-id"].length?i.setProjectId(b["project-id"][0]):"undefined"==typeof b["project-id"]&&-1!=i.getProjectId()&&i.setProjectId(-1);var f={},g=[];return Object.keys(b).forEach(function(a){if("innerSearch"==a)f.innerSearch=b[a];else{var c;if("tag"==a){var d=b[a];d=d.map(function(a){return a.indexOf(":")>-1?{key:a.split(":")[0],value:a.split(":")[1]}:{key:a}}),c={Name:"tag",Values:d}}else c={Name:a,Values:b[a]};g.push(c)}}),g.length&&(f.Filters=g),f}function f(){var a={};return a=n.reduce(function(a,b){return a[b.value]=b.name,a},a),a=m.reduce(function(a,b){return a[b.value]=b.name,a},a),a=p.reduce(function(a,b){return a[b.value]=b.name,a},a),a=o.reduce(function(a,b){return a[b.value]=b.name,a},a),a=r.reduce(function(a,b){return a[b.value]=b.name,a},a)}function g(a){var b=f(),c=(a||[]).map(function(a){var c=s.filter(function(b){return b.key===a.Name?{name:a.Name}:void 0})[0];return{attr:{key:a.Name,name:c.name},values:a.Values.map(function(a){return{name:b[a]||k.ZONEIDV3TONAMEMAP[a]||B[a]||a,value:a}})}});v.setState({value:c})}var h=a("config/reactSupport"),i=a("appUtil"),j=a("tips"),k=a("cvm/common/constants"),l=a("cvm/cbs2/constants"),m=[{name:"支持",value:"TRUE"},{name:"不支持",value:"FALSE"}],n=[{name:"系统盘",value:"SYSTEM_DISK"},{name:"数据盘",value:"DATA_DISK"}],o=[{name:"包年包月",value:"PREPAID"},{name:"按量计费",value:"POSTPAID_BY_HOUR"},{name:"不计费",value:"CDCPAID"}],p=function(){var a=[],b=l.DISK_TYPE_MAP;for(var c in b)b.hasOwnProperty(c)&&a.push({name:b[c],value:c});return a}(),q=[{name:"随实例释放",value:!0},{name:"不随实例释放",value:!1}],r=[{name:"已挂载",value:"ATTACHED"},{name:"待挂载",value:"UNATTACHED"},{name:"待回收",value:"TORECYCLE"}],s=[{key:"project-id",name:"所属项目",type:"single"},{key:"disk-name",name:"名称",type:"input"},{key:"disk-id",name:"ID",type:"input"},{key:"instance-name",name:"实例名",type:"input"},{key:"instance-id",name:"实例ID",type:"input"},{key:"instance-ip-address",name:"关联子机IP",type:"input"},{key:"disk-usage",name:"属性",type:"multiple",values:n},{key:"zone",name:"可用区",type:"multiple"},{key:"portable",name:"可卸载",type:"multiple",values:m},{key:"disk-type",name:"类型",type:"multiple",values:p},{key:"delete-with-instance",name:"随子机销毁云盘",type:"single",values:q},{key:"disk-charge-type",name:"计费模式",type:"multiple",values:o},{key:"disk-state",name:"状态",type:"multiple",values:r},{key:"tag",name:"标签",type:"input"}],t={zone:"可用区","disk-usage":"属性",portable:"可卸载","disk-type":"类型","disk-charge-type":"计费模式","disk-state":"状态"},u=function(a){return a.map(function(a){return{label:a.name,value:a.value}})};b.filterOptions={storageStatusFilterOptions:u(r),diskTypeFilterOptions:u(n),payModeDescFilterOptions:u(o),storageTypeFilterOptions:u(p),portableFilterOptions:u(m)};var v,w,x=0,y=7,z=/^disk-/,A=[];b.init=function(a){var b=a.callback,c=this,d=function(a){var c=e(a);c&&b&&b(c)},f=null;h.useTea(function(){var a=window.tea.component.TagSearchBox,b=React.__SECRET_DOM_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,e=300,g=React.createClass({displayName:"TSearchBox",getInitialState:function(){return{value:A}},onChange:d,render:function(){return React.createElement(a,{ref:function(a){return f=a},attributes:s,minWidth:e,value:this.state.value,onChange:d})}});null!=document.getElementById("searchArea")&&(v=b.render(React.createElement(g,null),document.getElementById("searchArea")),c.boxContainer=v,c.boxContainer.tagSearchRef=f)})};var B={};b.setData=d,b.attributesMap=t,b.setSearchValue=g,b.setDefaultData=function(a){A=[],a=a||{};var b=a.Filters||[],c=a.innerSearch;c&&A.push({values:[{name:c}],attr:null}),b.length?(b.forEach(function(a){if(-1==["project-id","zone"].indexOf(a.Name)){var b=[],c=s.find(function(b){return b.key==a.Name});a.Values.forEach(function(d){"input"==c.type?"tag"==a.Name?b.push({name:d.key+":"+d.value}):b.push({name:d}):c.values.forEach(function(a){a.value==d&&b.push({value:d,name:a.name})})}),A.push({values:b,attr:c})}else w=w||{},w[a.Name]=a.Values}),w&&w["project-id"]||A.unshift({attr:s[x],values:[{value:-1,name:"全部项目"}]})):A=[{attr:s[x],values:[{value:-1,name:"全部项目"}]}]}}),define("cvm/cbs2/snapshotChain",function(a,b,c){var d=a("$"),e=a("router"),f=a("reporter"),g=a("widget/i18n"),h=a("cvm/cbs2/data"),i=a("cvm/cbs2/event/createsnapshot"),j=a("appUtil"),k=a("contextmenu"),l=a("cvm/snapshot2/list/operate_auth"),m=a("widget/grid/Action"),n=a("qccomponent"),o=n.getComponent("grid-view"),p=a("cvm/snapshot2/data"),q=a("cvm/snapshot2/util"),r={createDisk:a("cvm/snapshot2/list/event/createDisk/createDisk"),"delete":a("cvm/snapshot2/list/event/delete/delete"),rename:a("cvm/snapshot2/list/event/rename/rename"),rollback:a("cvm/snapshot2/list/event/rollback/rollback"),crossRegionCopy:a("cvm/snapshot2/list/event/crossRegionCopy/crossRegionCopy")},s={main:'  <div class="manage-area-full-inner">    <div class="tc-panel snapshot-overview" b-if="snapshotTotalNum == 0">      <div class="snapshot-blank">        <p b-if="canCreateSnapshot" class="mb-20">当前云硬盘没有快照，          <a href="#" b-on-click="createsnapshotEvent()">开始创建</a>        </p>        <p>快照链就是多个快照组成的关系链，这些快照按照创建时间排成链，          <br>通过快照，我们可以帮您把云硬盘的数据恢复到以前某个时间点的状态</p>      </div>    </div>    <div class="tc-panel snapshot-overview" b-if="snapshotTotalNum > 0">      <div class="tc-g ">        <div class="tc-g-u-1-2">          <div class="text-weak">快照数量</div>          <div>            <span class="num">{{snapshotTotalNum}}</span>          </div>        </div>        <div class="tc-g-u-1-2">          <div class="text-weak">快照总大小</div>          <div>            <span class="num">{{snapshotTotalSize}}</span>GB</div>        </div>      </div>    </div>    <div class="tc-action-grid">      <div class="justify-grid" id="operArea" b-ref="operArea">        <div class="tc-15-action-panel col">          <button class="tc-15-btn m btn-add" b-on-click="createsnapshotEvent()" b-if="canCreateSnapshot">新建</button>          <button class="tc-15-btn m btn-add disabled" b-if="!canCreateSnapshot">新建</button>          <button type="button" class="tc-15-btn m weak disabled" b-ref="deleteButton" data-name="delete" data-title="请选择您要删除的快照"            b-on-click="batchDelete()">删除</button>          <!-- <button class="tc-15-btn weak m download" b-ref="exports"></button>            <button b-ref="setting" class="tc-15-btn weak m setting"></button>            <div id="searchArea" class="pull-right"></div> -->        </div>      </div>    </div>    <div id="snapshotList">      <snapshot-grid b-ref="snapshotGrid"></snapshot-grid>    </div>    <!-- <div class="tc-action-grid">        <div class="justify-grid">          <div class="col">            <button class="tc-15-btn m btn-add">新建</button>            <button class="tc-15-btn m weak">删除</button>          </div>        </div>      </div> -->  </div>',id:'  <p>    <a href="javascript:;" b-on-click="clickSnapshotId(item)">{{item.snapshotId}}</a>  </p>  <p>    <span class="text-overflow m-width" title="{{item.snapshotName}}">{{item.snapshotName}}</span>    <a b-if="item.snapshotState == \'NORMAL\'" href="javascript:;" role="button" b-on-click="rename([item])" class="pencil-icon hover-icon"      data-title="改名"></a>  </p>',status:'  <span title="{{item.snapshotState == \'CREATING\'? item.stateDesc + item.percent+ \'%\' : item.stateDesc}}" class="text-overflow m-width {{item.stateClass}}">    {{item.stateDesc}}    <i b-if="item.snapshotState == \'NORMAL\' && item.copyingToRegions.length" class="plaint-icon" data-title="{{item.crossRegionCopyTip}}"></i>    <span b-if="item.snapshotState == \'CREATING\'">{{item.percent}}%      <i class="plaint-icon" data-title="{{migratingTip}}"></i>    </span>    <!-- <span b-if="item.snapshotState == \'COPYING_TO_REMOTE\'">          <i class="plaint-icon" data-title="{{item.copytoremoteTip}}"></i>        </span> -->    <span b-if="item.snapshotState == \'COPYING_FROM_REMOTE\'">{{item.percent}}%      <!-- <i class="plaint-icon" data-title=""></i> -->    </span>    <span b-if="item.snapshotState == \'CHECKING_COPIED\'">{{item.percent}}%      <!-- <i class="plaint-icon" data-title=""></i> -->    </span>  </span>',size:"  <span class=\"text-overflow\">{{item.diskSizeDesc || '-'}}</span>",actions:'  <span style="white-space:nowrap">    <span>      <a href="javascript:;" class="snapshot-action" data-name="rollback" b-on-click="rollback([item])">回滚</a>      <i class="black-seperate-line-icon" role="separator"></i>    </span>    <span>      <a href="javascript:;" class="snapshot-action" data-name="delete" b-on-click="delete([item])">删除</a>      <i class="black-seperate-line-icon" role="separator"></i>    </span>    <span b-if="!isI18n">      <a href="javascript:;" class="snapshot-action" data-name="createDisk" b-on-click="createDisk([item])">新建云硬盘</a>    </span>    <span b-if="crossRegionCopyWhite">      <i class="black-seperate-line-icon" role="separator"></i>      <a href="javascript:;" class="snapshot-action" data-name="crossRegionCopy" b-on-click="crossRegionCopy([item])">跨地域复制</a>    </span>  </span>',disktype:'  <span class="text-overflow">{{item.diskUsageDesc}}</span>  <p>    <span class="text-overflow">      {{item.diskSizeDesc || \'-\'}}    </span>  </p>',disklink:'  <a b-if="item.diskId" href="javascript:;" b-on-click="clickSnapshotDiskId(item)">{{item.diskId}}</a>  <p b-if="item.diskName">    <span class="text-overflow m-width">{{item.diskName || \'未命名\'}}</span>  </p>  <span b-if="!item.diskId" class="text-overflow">-</span>',instancelink:'  <a b-if="item.instanceId" href="javascript:;" b-on-click="clickSnapshotInstanceId(item)">{{item.instanceId}}</a>  <p b-if="item.instanceId && item.instanceName" class="text-overflow m-width">{{item.instanceName}}</p>  <span b-if="!item.instanceId" class="text-overflow m-width">-</span>',encryptDesc:'  <span class="text-overflow">{{item.encryptDesc}}</span>',deadline:"  {{>item.deadlineDesc}}"},t=["COPYING_FROM_REMOTE","CHECKING_COPIED","CREATING"],u=[{name:"ID/名称",key:"snapshotId",required:!0,tdTpl:s.id},{name:"状态",key:"snapshotStatus",tdTpl:s.status},{name:"快照类型",key:"snapshotSize",tdTpl:s.disktype},{name:"创建时间",key:"createTime"},{name:"保留时间",key:"deadlineDesc",tdTpl:s.deadline},{name:"操作",key:"action",width:240,required:!0,tdTpl:s.actions}],v=n.extend({batchDelete:function(){var a=w.grid.getSelected();a.length&&w.exec("delete",a)},createsnapshotEvent:function(){var a=w.cbsDetail.storageSet;i.init(a,{projectId:a[0].placement.projectId,regionId:a[0].regionId,callback:function(){w.grid.refresh(),w.setSnapshotsTotalNumAndSize()}})}});v.tag("snapshot-grid",o.extend(g.getBeeConfig()).extend({events:{"change input[type=checkbox]":function(){w.selectedChange()}},clickSnapshotId:function(a){f.click("Snapshots.ListPage.Item.IDName"),e.navigate(a.snapshotDetailLink)},rename:function(a){w.exec("rename",a)},rollback:function(a){f.click("Snapshots.ListPage.ItemOp.Rollback"),w.exec("rollback",a)},"delete":function(a){f.click("Snapshots.ListPage.ItemOp.Del"),w.exec("delete",a)},crossRegionCopy:function(a){w.exec("crossRegionCopy",a)},createDisk:function(a){f.click("Snapshots.ListPage.ItemOp.CreateDisk"),w.exec("createDisk",a)},getData:function(a){w.querySnapshotList(a)},setTrAttr:function(a,b){return a={"data-snapshotId":b.snapshotId,"data-diskId":b.diskId}},getSelectItem:function(a){var b=[];return d(w.grid.list).each(function(c,e){d(a).each(function(a,c){var f=d(c).closest("tr").data("snapshotid");e.snapshotId==f&&b.push(e)})}),b}},{defaults:{initGetData:!1,canResizeColum:!1,colums:u,emptyTips:"当前过滤条件下没有相应的快照",searchItemName:"快照",migratingTip:["1、块存储的快照制作，是使用COW(copy on write)、ROW(Redirect-On-Write）的方式实现的，无需关闭实例","2、当快照状态处于“搬迁中”时，说明云硬盘的快照拍摄已完成（元数据捕获、原块设备block已作标记），进入搬迁阶段","3、快照搬迁过程中，不影响云硬盘的正常使用，实例可对硬盘正常使用，可正常覆盖，修改，删除硬盘内文件，不影响快照数据搬迁，不会导致快照文件丢失","4、某云硬盘第一次制作快照时，需要全量搬迁数据，耗时较长。后续的快照为增量备份、差异备份","5、搬迁中，硬盘的IO性能会下降15%"].join("<br>"),urlParams:"",page:1}}));var w={init:function(a,b,c){var d=this;d.cbsDetail=c,q.snapshotListIns=this;var f=a||{},i=this.listBee=new v({$tpl:s.main,$data:{canCreateSnapshot:c&&c.storageSet&&c.storageSet[0].isSnapAbility}});this.grid=i.$refs.snapshotGrid,this.loop=null,Promise.all([h.queryWhiteList(),g.isI18n()]).then(function(a){var c=d.whiteListMap=a[0],g=a[1];return d.grid.isI18n=d.isI18n=g,d.grid.crossRegionCopyWhite=!!d.whiteListMap.CBS_SS_REGIONCOPY_WL,c.CBS_snapshorts_WHITELIST?(d.setSnapshotsTotalNumAndSize(),b.html(i.$el),d.grid.resize(),d.querySnapshotList(f),void d.bindEvents()):void e.navigate("/cvm/cbs")})},setSnapshotsTotalNumAndSize:function(){var a=this.listBee,b=this.cbsDetail;p.querySnapshots({data:{filters:[{name:"disk-id",values:[b.diskId]}]},regionId:b.regionId}).then(function(b){var c=b.response.snapshotSet,d=b.response.totalCount||0,e=0;c.forEach(function(a){e+=a.diskSize}),a.$set("snapshotTotalNum",d),a.$set("snapshotTotalSize",e)})},renderListRightClickMenu:function(a){var b=this,c=[{rollback:{name:"回滚",callback:b.execContextMenu},"delete":{name:"删除",callback:b.execContextMenu},createDisk:{i18n:!1,name:"新建云硬盘",callback:b.execContextMenu}}];b.whiteListMap.CBS_SS_REGIONCOPY_WL&&(c[0].crossRegionCopy={name:"跨地域复制",callback:b.execContextMenu}),a&&c.forEach(function(a){Object.keys(a).forEach(function(b){a[b].i18n===!1&&delete a[b]})}),new k({object:d("#snapshotList"),selector:"tbody tr",data:c,onShow:function(a,c,e){m.hideMenu(d("#snapshotList")),b.displayOperMenu(c,e)}})},bindEvents:function(){d(this.listBee.$refs.deleteButton).click(function(){f.click("Snapshots.ListPage.MainOp.Del")})},getQueryParam:function(a){var b=this,c=b.cbsDetail;a=a||{};var d={},e=a.page>0?a.page:b.grid.page,f=c.regionId;d.limit=a.count>0?a.count:b.grid.count,d.offset=(e-1)*d.limit;var g=[];return g.push({name:"disk-id",values:[c.diskId]}),d.filters=g,{data:d,regionId:f,page:e,count:d.limit}},querySnapshotList:function(a){var b=this,c=a?b.getQueryParam(a):b.queryobj;q.regionId=c.regionId,Promise.all([p.querySnapshots({data:c.data,regionId:c.regionId}),h.queryZone(c.regionId)]).then(function(a){if(b.queryobj=c,b.zoneList=a[1]||[],a[0].response&&a[0].response.snapshotSet){var d=a[0].response.snapshotSet.some(function(a){return t.indexOf(a.snapshotState)>-1||a.copyingToRegions.length?!0:void 0});b.isDataLoading=d,b.checkCopyTask();var e=p.formatSnapshotList(a[0].response.snapshotSet),f=a[0].response.totalCount;if(e.length>0){b.renderListRightClickMenu(b.isI18n);var g=[];g.push(e[0].diskId),p.getSnapshotDisks(g,c.regionId).then(function(a){if(a.length){var d={};a.forEach(function(a){d[a.diskId]=a}),e.forEach(function(a){a.disk=d[a.diskId],a.diskName=a.disk&&a.disk.diskName}),b.updateSnapshotInstanceInfo(e,a)}b.grid.setData({list:e,totalNum:f,page:c.page,count:c.count,searchKey:c.searchKey}),b.checkSnapshotListOperAuth(e)})}else b.grid.setData({list:[],totalNum:0,page:1,count:c.count,searchKey:c.searchKey})}else if(b.grid.setData({list:[]}),a[0].errors&&a[0].errors.length)for(var h=0;h<a[0].errors.length;h++){var i=a[0].errors[h];q.showGridTips(i,b.grid);break}},function(a){b.grid.setData({list:[]}),q.showGridTips(a,b.grid)})},updateSnapshotInstanceInfo:function(a,b){var c=this,d=[];b.forEach(function(a){a.instanceId&&d.push(a.instanceId)}),d.length&&p.queryInstances({instanceIds:d,regionId:a[0].regionId}).then(function(b){var d=b.response.instanceSet,e={};d&&d.length&&(d.forEach(function(a){e[a.instanceId]=a}),a.forEach(function(a,b){var d=a.disk&&e[a.disk.instanceId];d&&(a.instance=d,a.instanceId=d.instanceId,a.instanceName=d.instanceName,c.grid.updateItem(b,a),c.checkSnapshotListOperAuth([a]))}))})},exec:function(a,b){var c=this;b=b||c.grid.getSelected();var d={projectId:c.projectId,regionId:c.regionId,zoneList:c.zoneList,projectList:c.projectList,whiteListMap:c.whiteListMap,callback:function(){setTimeout(function(){c.startLoop(!0),"delete"==a&&c.setSnapshotsTotalNumAndSize()},1e3)}};a&&r[a]&&(c.checkEventIsDisabled(a,b)||r[a].exec(b,d))},checkEventIsDisabled:function(a,b){var c=this,e=!1;return e=1==b.length?d(c.grid.$el).find("[data-snapshotid="+b[0].snapshotId+"]").find("[data-name="+a+"]").hasClass("disable"):d(c.listBee.$refs.operArea).find("[data-name="+a+"]").hasClass("disable"),!!e},selectedChange:function(){var a=this.grid.getSelected();this.toggleBtnStatus(a,d("#operArea"))},displayOperMenu:function(a,b){var c=this.grid.getSelectItem(b);this.toggleBtnStatus(c,a)},checkSnapshotListOperAuth:function(a){var b=this;a.forEach(function(a){b.toggleBtnStatus([a],d(b.grid.$el).find("tr[data-snapshotid="+a.snapshotId+"]"))})},toggleBtnStatus:function(a,b){var c=["rollback","delete","rename","createDisk"];this.whiteListMap.CBS_SS_REGIONCOPY_WL&&c.push("crossRegionCopy");var e=new l({dataItems:a,operAction:c}),f=e.getAuth();c.forEach(function(a){var c=b.find('[data-name="'+a+'"]');0==f[a].code?d(c).removeClass("disabled").removeClass("disable").attr("data-title",""):d(c).addClass("disable").addClass("disabled").attr("data-title",f[a].tip)})},execContextMenu:function(a,b){w.execRowMenuItem(a,b)},execRowMenuItem:function(a,b){for(var c=d(a).attr("data-index"),e=this.grid,f=0,g=e.list.length;g>f;f++)e.$refs.list[f].$set({$selected:!1});e.$refs.list[c].$set({$selected:!0}),this.selectedChange(),this.exec(b.attr("data-name"))},startLoop:function(a){var b=this,c=a?1:5e3;this.loop&&clearTimeout(this.loop),this.loop=setTimeout(function(){b.querySnapshotList()},c)},reportClick:function(a){a&&f.click(a)},stopLoop:function(){clearTimeout(this.loop)},destroy:function(){clearTimeout(this.loop),this.clearCheckTask()},checkCopyTask:function(){var a=this;this.clearCheckTask(),a.isDataLoading&&(a.watingTime=setTimeout(function(){var b=a.grid.getSelected().length;b||j.isContextMenuShow()||m.isMenuActivated(a.grid.list)?a.checkCopyTask():a.grid.refresh()},5e3))},clearCheckTask:function(){clearTimeout(this.watingTime)}};c.exports=w}),define("cvm/cdh/basechart",function(a,b,c){a("Highcharts");var d=a("$"),e=(a("pageManager"),a("appUtil")),f=a("qccomponent"),g={main:'    <div class="mb20 chart-grid">        <h4 class="chart-title">{{chartTitle}}<span class="text-unit">{{chartUnit ? \'(单位：\'+chartUnit+\')\' : \'\'}}</span></h4>        <div b-if="!noData" data-mod="chart" style="height: 250px;">        </div>        <div b-if="noData" style="height: 250px;">            <span>没有数据</span>        </div>    </div>',small:'<div class="chart-cell">    <h4 class="chart-title">{{chartTitle}}<span class="text-unit">{{chartUnit ? \'(单位：\'+chartUnit+\')\' : \'\'}}</span></h4>    <div b-if="!noData" data-mod="chart" style="height: 150px;width: 350px">    </div>    <div b-if="noData" style="height: 150px;width: 350px">        <span >{{loading ? \'加载中...\' : \'没有数据\'}}</span>    </div></div>'},h={loading:{style:{backgroundColor:"white"},labelStyle:{color:"silver"}},chart:{zoomType:"x"},title:{text:""},yAxis:[{title:{text:""},lineWidth:1,tickPixelInterval:45,min:0,labels:{style:{fontSize:"12px"}}}],plotOptions:{line:{marker:{enabled:!0,lineWidth:2,lineColor:"#ff7a22",fillColor:"#FFFFFF",radius:3,states:{hover:{enabled:!0}}},lineWidth:1,color:"#ff7a22"},spline:{marker:{enabled:!1,radius:3,states:{hover:{enabled:!0}}},lineWidth:1,color:"#ff7a22"}},credits:{enabled:!1},legend:{enabled:!1},tooltip:{shared:!0}};c.exports=f.extend({$tpl:g.small,$valuekey:"data",$afterInit:function(){var a=this;a.$chart=d(a.$el).find('[data-mod="chart"]');var b=function(){if(a.data)a.data.multi?a.showMultiChart():a.showChart();else{var b=a.$chart.highcharts();b||(a.$chart.highcharts(h),b=a.$chart.highcharts()),b.showLoading()}};a.$watch("data",b,!0)},showChart:function(){var a,b=this,c=b.data,f=c.dayView,g=!0,i=b.$chart,j={xAxis:{type:"datetime",dateTimeLabelFormats:{hour:"%H:%M"},tickPixelInterval:80,title:{text:""}}};if(c.y&&c.y.length){d.extend(j,h);var k=c.yUnit||"",l=c.unit||"";j.yAxis=[{title:{text:""},lineWidth:1,tickPixelInterval:45,min:0,labels:{format:"{value}"+k,style:{fontSize:"12px"}}}],a=e.cgwTimeParse(c.x[0]),j.series=[{pointStart:a.getTime()-6e4*a.getTimezoneOffset(),data:c.y}],f?(j.series[0].pointInterval=864e5,j.xAxis.dateTimeLabelFormats.day="%m-%d",j.xAxis.dateTimeLabelFormats.week="%m-%d",j.tooltip.formatter=function(){var a=new Date(this.x);return a=new Date(a.getTime()+6e4*a.getTimezoneOffset()),[e.formatDate(a,"MM-dd")," ","<b>",this.y,l,"</b>"].join("")}):(j.series[0].pointInterval=3e5,j.series[0].type="spline",j.xAxis.dateTimeLabelFormats.day="%H:%M",j.xAxis.maxZoom=36e5,j.tooltip.formatter=function(){var a=new Date(this.x);return a=new Date(a.getTime()+6e4*a.getTimezoneOffset()),[e.formatDate(a,"hh:mm")," ","<b>",this.y,l,"</b>"].join("")}),i.highcharts(j),g=!1}var m=b.data.loading;b.$set("loading",m),b.$set("noData",g),b.$chart.highcharts()&&!m&&b.$chart.highcharts().hideLoading()},showMultiChart:function(){var a,b=this,c=b.data,f=c.dayView,g=!0,i=b.$chart,j={xAxis:{type:"datetime",dateTimeLabelFormats:{hour:"%H:%M"},tickPixelInterval:80,title:{text:""}}};if(c.list&&c.list.length){d.extend(j,h),a=e.cgwTimeParse(c.x[0]);var k=a.getTime()-6e4*a.getTimezoneOffset(),l=c.yUnit||"";j.yAxis=[{title:{text:""},lineWidth:1,tickPixelInterval:45,min:0,labels:{format:"{value}"+l,style:{fontSize:"12px"}}}],j.legend={layout:"vertical",align:"left",x:120,verticalAlign:"top",y:100,floating:!0,backgroundColor:"#FFFFFF"},j.series=[],c.list.forEach(function(a,b){a.y&&a.y.length&&(j.series.push({pointStart:k,data:a.y}),f?(j.series[b].pointInterval=864e5,j.series[b].name=c.chartOpt.name[b],j.series[b].color=c.chartOpt.color[b],j.xAxis.dateTimeLabelFormats.day="%m-%d",j.xAxis.dateTimeLabelFormats.week="%m-%d",j.tooltip.formatter=function(){var a=new Date(this.x);a=new Date(a.getTime()+6e4*a.getTimezoneOffset());var b=[e.formatDate(a,"yyyy-MM-dd")," <br>",this.points[0].series.name,"  ","<b>",this.points[0].y,c.chartOpt.units[0],"</b>","<br>",this.points[1].series.name,"  ","<b>",this.points[1].y,c.chartOpt.units[1],"</b>"];return b.join("")}):(j.series[b].pointInterval=3e5,j.series[b].type="spline",j.series[b].name=c.chartOpt.name[b],j.series[b].color=c.chartOpt.color[b],j.xAxis.dateTimeLabelFormats.day="%H:%M",j.xAxis.maxZoom=36e5,j.tooltip.formatter=function(){var a=new Date(this.x);a=new Date(a.getTime()+6e4*a.getTimezoneOffset());var b=[e.formatDate(a,"yyyy-MM-dd")," <br>",this.points[0].series.name,"  ","<b>",this.points[0].y,c.chartOpt.units[0],"</b>","<br>",this.points[1].series.name,"  ","<b>",this.points[1].y,c.chartOpt.units[1],"</b>"];return b.join("")}),g=!1)}),i.highcharts(j)}b.$set("noData",g),b.$chart.highcharts()&&b.$chart.highcharts().hideLoading()}})}),define("modules/cvm/cdh/cdh",function(a,b,c){var d,e=a("$"),f=a("qccomponent"),g=a("panel"),h=a("dialog"),i=a("cvm/cdh/dialog/terminate"),j=a("cvm/cdh/dialog/modifyVCPU"),k=a("cvm/cdh/dialog/autoRenew"),l=a("cvm/cdh/dialog/rename"),m=a("cvm/cdh/dialog/renew"),n=a("cvm/cdh/dialog/export"),o=a("event"),p=a("widget/fieldsManager/gridView"),q=a("nmc/widget/dropdown"),r=a("cvm/cdh/detail/monitorpanel"),s=f.getComponent("grid-view"),t=(a("manager"),a("cvm/cdh/util")),u=a("widget/pubsubhub/pubsubhub"),v=a("appUtil"),w=a("cvm/cdh/detail/cdhdetail"),x=a("cvm/cdh/cdhconfig"),y=a("cvm/common/constants"),z=a("router"),A={},B=a("cvm/cdh/data"),C=a("cvm/cvm/data"),D=a("cvm/common/model"),E=a("widget/errorTips/errorTips"),F=(a("widget/mfa/mfa"),a("widget/i18n"),a("widget/grid/Action")),G=a("cvm/cdh/operate_auth");a("cvm/common/components/regionPills"),a("widget/projects/projectSelector");var H={main:'  <div class="manage-area">    <!-- 添加窗体模块 -->    <div class="manage-area-title">      <h2>专用宿主机</h2>      <project-selector b-ref="projectSelector" b-model="projectId"></project-selector>      <cvm-region-pill b-ref="regionPill" b-model="regionId" get-white-list="{{getRegionWhiteList}}"></cvm-region-pill>      <!--        等产品把wiki链接给到后  再开放         <div class="help-doc" style="float:right;padding-top:20px;font-size:14px;"><i class="links-icon"></i><a target="_blank" >如何管理宿主机</a></div>      -->    </div>    <div class="manage-area-main">      <div class="manage-area-full-inner">        <div class="cvm-snap-list">          <div class="tc-15-msg elastic-network-msg" style="margin-bottom: 15px;"            b-style="{display: supportCbs ? \'block\' : \'none\'}">            <p class="tip-info">              云硬盘采用按量计费的计费方式。当账户欠费时，若系统盘被隔离，子机不可用；若系统盘被清除，子机将一同被清除。如需屏蔽此逻辑，请联系大客户经理开通欠费不停服服务。            </p>          </div>          <div class="tc-action-grid" id="operArea">            <div class="justify-grid">              <div class="col">                <button type="button" class="tc-15-btn m " data-event="addCdhHost" data-title="">                  <b class="icon-add"></b>新建宿主机</button>                <button type="button" class="tc-15-btn m weak {{disabledAllocateCVM ? \' disabled\' : \'\' }}"                  data-event="addCdhCvm" data-title="{{disabledAllocateCVM}}">分配云主机</button>                <div class="tc-15-dropdown tc-15-dropdown-btn-style" id="more_oper">                  <a href="javascript:;" class="tc-15-dropdown-link">更多操作                    <i class="caret"></i>                  </a>                  <ul class="tc-15-dropdown-menu" style="min-width:fit-content">                    <li b-if="!isI18n" class=\'disabled\' data-event="oper_autoRenew" data-name="setAutoRenew"                      data-title="请先选择专用宿主机">                      <a href="javascript:;">设置自动续费</a>                    </li>                    <li b-if="!isI18n" class=\'disabled\' data-event="oper_renew" data-name="renew"                      data-title="请先选择专用宿主机">                      <a href="javascript:;">续费</a>                    </li>                    <li class=\'disabled\' data-event="oper_rename" data-name="rename" data-title="请先选择专用宿主机">                      <a href="javascript:;">改名</a>                    </li>                    <li b-if="isI18n" class="disabled" data-event="oper_terminate" data-name="terminate"                      data-title="请先选择专用宿主机">                      <a href="javascript:;">销毁</a>                    </li>                    <li class=\'disabled\' data-event="oper_manage" data-name="manage" data-title="请先选择专用宿主机">                      <a href="javascript:;">批量管理实例</a>                    </li>                    <li b-if="whiteListMap&&whiteListMap.CDH_SetvCPUQuantity" class=\'disabled\'                      data-event="oper_modifyVCPU" data-name="modifyVCPU" data-title="请先选择专用宿主机">                      <a href="javascript:;">设置vCPU数量</a>                    </li>                  </ul>                </div>              </div>              <div class="col">                <qc-search b-ref="search" placeholder="请输入宿主机名称/ID进行搜索"></qc-search>                <button class="tc-15-btn weak m refresh" title="刷新" data-event="refresh"></button>                <button b-ref="setting" class="tc-15-btn weak m setting" data-grid-setting title="设置列表显示字段"></button>                <button class="tc-15-btn weak m download" data-event="exportCdh" title="导出实例列表"></button>              </div>            </div>          </div>          <div class="tc-15-action-panel">            <div id="cdhList" class="tc-table-grid tc-table-grid-cvm"></div>          </div>        </div>      </div>    </div>  </div>',monitor:'  <div style="text-align:center;">    <a href="javascript:;" b-on-click="showMonitor(item)" title="查看监控概览" style="margin-left:0px">      <i class="dosage-icon"></i>    </a>    <p>      <span class="text-overflow {{item.statusClass}}">        {{ item.statusDesc }}      </span>    </p>  </div>',idName:'  <div class="id-name-cell">    <p>      <span b-if="item.$loading" class="text-overflow m-width">{{        item.uHostId      }}</span>      <a b-if="!item.$loading" href="javascript:;" b-on-click="navDetail(item)">{{ item.uHostId }}</a>    </p>    <div>      <span class="text-overflow m-width" title="{{item.hostAlias}}">        {{ item.hostAlias ? item.hostAlias : \'未命名\' }}      </span>      <i b-if="!item.$loading && !item.$disable" data-event="rename" title="编辑名称" class="pencil-icon hover-icon"        style="cursor:pointer"></i>    </div>  </div>',action:'  <div class="oper-cell" b-if="!item.$loading && !item.$disable">    <div b-template b-repeat="action in getActions(item, $parent.$index, $parent.$parent.list.length)">      <cell-action b-with="action"></cell-action>    </div>  </div>  <div b-if="item.$loading || item.$disable"><span>-</span></div>'},I=[{name:"ID/宿主机名",key:"idAndName",width:100,minWidth:100,required:!0},{name:"监控",key:"monitor"},{name:"可用区域",key:"zoneName",minWidth:100},{name:"机型",key:"externalHostType",minWidth:80},{cageIdOnly:!0,name:"围笼",key:"cageId",minWidth:100},{name:"实例(台)",key:"cvmNumber"},{name:"可用/总CPU(核)",key:"cpuInfo",minWidth:100},{name:"可用/总内存(GB)",key:"memInfo",minWidth:100},{name:"可用/总硬盘(GB)",key:"diskInfo",minWidth:100},{name:"到期时间",key:"deadline",minWidth:180},{name:"计费模式",key:"payModeDesc",minWidth:100},{name:"创建时间",key:"createdTimeDesc",hide:!0,selected:!1,minWidth:180},{name:"项目",key:"projectName",minWidth:100},{name:"操作",required:!0,key:"_action"}],J=f.extend({}),K={renderGrid:function(){var a=s.extend({$mixins:s.prototype.$mixins.concat([p("cdh_page_grid_fields-2018-11-18","#appArea [data-grid-setting]")]),events:{"click [data-grid-body] tr [data-role]":function(a){var b=e(a.currentTarget);if(!b.hasClass("disable")&&!b.hasClass("disabled")){var c=b.closest("tr").attr("data-index"),d=b.data("role"),f=this.list[c];this.handleAction(d,[f])}}},getQueryParam:function(a){var b=this,c=a.regionId||v.getRegionId(),d=a.projectId||v.getProjectId(),e=a.page>0?a.page:b.page,f=a.count>0?a.count:b.count,g=(e-1)*f,h=[{Name:"host-state",Values:["RUNNING","PENDING","LAUNCH_FAILURE"]}];return a.searchKey&&(0==a.searchKey.indexOf("host-")?h.push({
Name:"host-id",Values:[a.searchKey]}):h.push({Name:"host-name",Values:[a.searchKey]})),d>=0&&h.push({Name:"project-id",Values:[d]}),{limit:f,offset:g,Filters:h,page:e,count:f,regionId:c}},getData:function(a,b){var c=this;a=a||{},A=a,a.sliceRefresh||(c.setData({list:[],totalNum:0}),c.showLoading("加载中..."));var d=c.getQueryParam(a);c.queryInstanceParams=d,c.regionId=d.regionId,B.queryCdhList(d,{camTips:!1}).then(function(b){if(c.hideLoading(),b&&b.response&&b.response.hostSet){var e=B.formatList(b.response.hostSet,{regionId:c.regionId}),f=b.response.totalCount;c.setData({list:e,totalNum:f,searchKey:a.searchKey||!1,page:d.page||1,count:d.count||20})}else{if(b.errors&&b.errors.length){c.setData({list:[]});for(var g=0;g<b.errors.length;g++){var h=b.errors[g];E.isCamRefused(h)?c.showTips("<div><cam-tips>"+h.message+"</cam-tips></div>"):c.showTips("<div><error-tips>"+h.message+"</error-tips></div>");break}return}c.setData({list:[]})}},function(a){c.setData({list:[]}),E.isCamRefused(a)?c.showTips("<div><cam-tips>"+a.message+"</cam-tips></div>"):c.showTips("<div><error-tips>"+a.message+"</error-tips></div>")})},setTrAttr:function(a,b){return a={"data-uHostId":b.uHostId,"data-name":b.hostAlias}},navDetail:function(a,b){var c="/cvm/cdh/detail/"+a.regionId+"/"+a.uHostId;1==b&&(c+="/1"),z.navigate(c)},userIsDoing:function(){var a=this;return a.getSelected().length>0?!0:!1},clearCheckTask:function(){clearTimeout(this.watingTime)},checkTask:function(){var a=this;a.isWating=!1,a.list.forEach(function(b){b.$loading&&(a.isWating=!0)}),a.clearCheckTask(),a.isWating?this.watingTime=setTimeout(function(){a.userIsDoing()?a.checkTask():d&&(d--,K.refreshList(A,!0))},5e3):a.setmaxReqNum()},setmaxReqNum:function(){d=200},showMonitor:function(a){var b=this;if(!(b.showingHostId&&b.showingHostId==a.uHostId||a.$disable||a.$loading)){var c=e(b.$el).find('tr[data-uHostId="'+a.uHostId+'"]'),d=c.attr("data-index");b.$refs.list.forEach(function(a,c){b.$refs.list[c].$set({$selected:d==c})}),K.refreshMenu(),c.addClass("current"),b.showingHostId=a.uHostId,g.show({onAfterHide:function(){b.showingHostId=null},module:r,data:a})}},getHeadContent:function(a){return"monitor"===a.key?'<div class="text-center"><span class="text-overflow">监控/状态</span></div>':void 0},cageFilterReady:function(a){this.cageFilter=a},cageChange:function(a){var b;a&&a.length>0&&(b=a.join(",")),this.getData({cageId:b?encodeURIComponent(b):""})},getCellContent:function(a,b,c){var d;switch(c.key){case"idAndName":d=H.idName;break;case"cvmNumber":var e=!b.$loading&&a>=0?a:"-";d=!b.$loading&&a>0?'<a href="javascript:;" b-on-click="navDetail(item,1)">'+e+"</a>":'<span class="text-overflow">'+e+"</span>";break;case"monitor":d=H.monitor;break;case"cpuInfo":d='<span class="text-overflow">'+b.cpuAvailable+"/"+b.cpuTotal+"</span>";break;case"memInfo":d='<span class="text-overflow">'+b.memAvailable+"/"+b.memTotal+"</span>";break;case"diskInfo":d='<span class="text-overflow">'+b.diskAvailable+"/"+b.diskTotal+"</span>";break;case"deadline":return'<div title="'+(b.expiredTimeDesc||"")+'">'+(b.expiredTimeInfo||"-")+"</div>";case"_action":d=H.action;break;default:d='<span class="text-overflow">'+(a||"-")+"</span>"}return d},handleAction:function(a,c){b[a]&&b[a](c)},getActions:function(a,b,c){var d=G.getAuth([a]);return[{text:"续费",act:"renew",hidden:!a.isPrepaid},{text:"销毁",act:"terminate",hidden:!a.isPostpaid,disabled:d.terminate.disabled,title:d.terminate.tip}]}},{defaults:{emptyTips:'您选择的该地区的专用宿主机列表为空，您可以<a href="javascript:;" data-event="addCdhHost">新建一台专用宿主机</a>，或切换到其他地域',initGetData:!1,hasFirst:!0,colums:I}}),b=this;a.tag("cell-action",F),b.grid=new a,b.cdhListEl=e("#cdhList"),b.cdhListEl.html(b.grid.$el),b.grid.setmaxReqNum(),b.moreDropdown=new q(e("#operArea").find(".tc-15-dropdown"),{newMode:!0}),b.bindEvents()},setViewGrid:function(a){var b=I.filter(function(b){return!b.cageIdOnly||a});this.grid.setColums(b)},render:function(){var a=arguments,b=this;return"detail"==a[0]?w.render(a[1],a[2],a[3]):(b.$appArea=e("#appArea"),void B.queryCdhWhiteList().then(function(a){var c=b.bee=new J(H.main,{getRegionWhiteList:function(){var a=e.Deferred();return C.queryRegion().then(function(c){var d=[];for(var e in c)x.regionBlackList[e]||(x.cdhRegionWhiteMap[e]?b.whiteListMap[x.cdhRegionWhiteMap[e]]&&d.push(e):d.push(e));a.resolve(d)}),a.promise()},$data:{isI18nUser:v.isI18n(),whiteListMap:{},supportCbs:a.CDH_CBS_white&&a.CDH_CBS_white.length}});b.whiteListMap=a,b.bee.$set({whiteListMap:a}),b.isAsyncExport=a.ASYNC_EXPORT_CDH&&a.ASYNC_EXPORT_CDH.length>0,nmc.render(c.$el,"cvm"),b.renderGrid(),b.regionChanged(v.getRegionId())})["catch"](function(){}))},showModifyVCPUDia:function(a){var b=this,c=new j({selectedItems:a});h.create(c.$el,"800","",{title:"设置vCPU数量",preventResubmit:!0,button:{" 确定 ":function(){c.doAction().then(function(a){h.toggleBtnDisable(),a.response.error||(b.refreshList(A,!0),h.hide())})["catch"](function(){h.toggleBtnDisable()})}}})},showAutoRenewDia:function(a){var b=this,c=a.every(function(a){return t.isAutoRenewMode(a.renewFlag)}),d=new k({selectedItem:a,autoRenew:c?"0":"1"});h.create(d.$el,"800","",{title:"设置自动续费","class":"dialog_layer_v2 tc-15-rich-dialog new-gateway",preventResubmit:!0,button:{" 确定 ":function(){d.doAction().then(function(a){h.toggleBtnDisable(),a.response.error||(b.refreshList(A,!0),h.hide())})["catch"](function(){h.toggleBtnDisable()})}}})},renew:function L(a){var L=new m({selectedItem:a});h.create(L.$el,"700","",{title:"续费","class":"dialog_layer_v2 tc-15-rich-dialog new-gateway",preventResubmit:!0,button:{" 确定 ":function(a){L.doAction(h)}}})},terminate:function M(a){var M=new i({hostList:a});h.create(M.$el,"700","",{title:"销毁专用宿主机",preventResubmit:!0,button:{" 确定 ":function(a){M.doAction(function(){self.refreshList(A,!0)})}}})},refreshList:function(a,b){b?(A.sliceRefresh=!0,this.grid.getData(A)):this.grid.getData(a),this.refreshMenu()},rename:function(a){var b=this,c=new l({newName:a[0].hostAlias||"未命名",selectedItem:a});h.create(c.$el,"600","",{title:"改名","class":"dialog_layer_v2 tc-15-rich-dialog new-gateway",preventResubmit:!0,button:{" 确定 ":function(a){c.doAction(h,function(){b.refreshList(A,!0)})}}})},updateAddCvmBtn:function(a){var b={mixCage:!1};if(a&&a.length>0){var c=[],d=[],e=[],f=[];a.forEach(function(a){var b=a.cageId||"common";d.indexOf(b)<0&&d.push(b),c.indexOf(a.externalHostType)<0&&c.push(a.externalHostType),e.indexOf(a.zoneId)<0&&e.push(a.zoneId),f.indexOf(a.projectId)<0&&f.push(a.projectId)}),d.length>1?(this.bee.$set("disabledAllocateCVM","不支持不同围笼内的宿主机同时分配"),b.mixCage=!0):c.length>1?(b.mixHostType=!0,this.bee.$set("disabledAllocateCVM","不支持不同机型的宿主机同时分配")):e.length>1?(b.mixZone=!0,this.bee.$set("disabledAllocateCVM","不支持不同可用区内的宿主机同时分配")):f.length>1?(b.mixProject=!0,this.bee.$set("disabledAllocateCVM","不支持不同项目内的宿主机同时分配")):this.bee.$set("disabledAllocateCVM","")}else this.bee.$set("disabledAllocateCVM","");return b},refreshMenu:function(){var a=this,b=a.grid.getSelected();a.updateAddCvmBtn(b),a.updateMoreBatchAction(b)},updateMoreBatchAction:function(a){var b=G.getAuth(a);Object.keys(b).forEach(function(a){var c=e("#more_oper").find('[data-name="'+a+'"]'),d=b[a],f=d.disabled,g=d.tip,h=void 0===g?"":g;c.removeClass("disabled").attr("data-title",""),c&&(f?c.addClass("disabled").attr("data-title",h):c.removeClass("disabled").attr("data-title",""))})},regionChanged:function(a){var b=this;b.setViewGrid(!1),y.FINANCE_REGIONS.indexOf(a)>=0&&D.apiDelegate({cmd:"GetProductUsageInfo",serviceType:"cage",regionId:a,data:{}},{camTips:!1}).then(function(a){var c=a.data;b.setViewGrid(!(!c||!c.isOpen))})["catch"](function(){}),b.refreshList({regionId:a})},bindEvents:function(){var a=this;a.lockChange=!1;var b=e(a.grid.$el);b.on("click",'input[type="checkbox"]',function(b){setTimeout(function(){a.refreshMenu()},0)}),a.bee.$watch("regionId",function(b){a.regionChanged(String(b))}),a.bee.$watch("projectId",function(b){return a.inited?void a.refreshList({projectId:+b}):void(a.inited=!0)}),e(a.bee.$refs.setting).click(function(){a.grid.showFieldsManager()}),a.bee.$refs.search.$on("search",function(b){a.grid.getData({searchKey:b})}),u.off(".cdh").on("hostAliasChange.cdh",function(b,c){a.refreshList()}),o.bindCommonEvent(this.$appArea.children()[0],"click",{addCdhHost:function(a){var b=x.CDH_BUY_PAGE+"?regionId="+v.getRegionId();v.getProjectId()>=0&&(b+="&projectId="+v.getProjectId()),window.open(b)},exportCdh:function(b){var c=new n({listIns:a});a.gridView=a.grid,a.queryInstanceParams=a.grid.queryInstanceParams,c.exec()},refresh:function(){K.refreshList({},!0),K.refreshMenu()},addCdhCvm:function(b){if(!e(b.target).hasClass("disabled")){var c=v.getRegionId(),d="?regionId="+c,f=a.grid.getSelected();if(f&&f.length>0){var g=[];f.forEach(function(a){a.uHostId&&g.push(a.uHostId)});var h=f[0],i=g.join(",");d=d+"&zoneId="+h.zoneId+"&projectId="+h.projectId+"&hostType="+h.externalHostType+"&hostId="+encodeURIComponent(i)}window.open(x.CDH_CVM_CREATE_PAGE+d)}},rename:function(b){var c=e(b.target).closest("tr"),d=c.attr("data-index");a.grid.$refs.list[d].$set({$selected:!0});var f=a.grid.$refs.list[d].$data;a.rename([f])},terminate:function(b){var c=e(b.target).closest("tr"),d=c.attr("data-index");a.terminate([a.grid.list[d]])},oper_terminate:function(b){var c=e(this);if(!c.hasClass("disabled")){var d=a.grid.getSelected();a.terminate(d)}},oper_autoRenew:function(){var b=e(this);if(!b.hasClass("disabled")){var c=a.grid.getSelected();a.showAutoRenewDia(c)}},oper_renew:function(){var b=e(this);if(!b.hasClass("disabled")){var c=a.grid.getSelected();a.renew(c)}},oper_manage:function(){var b=e(this);if(!b.hasClass("disabled")){var c=a.grid.getSelected(),d=[];c.forEach(function(a){a.uHostId&&d.push(a.uHostId)}),z.navigate("/cvm?uHostIds="+encodeURIComponent(d.join(",")))}},oper_rename:function(){var b=e(this);b.hasClass("disabled")||a.rename(a.grid.getSelected())},oper_modifyVCPU:function(){var b=e(this);if(!b.hasClass("disabled")){var c=a.grid.getSelected();a.showModifyVCPUDia(c)}}})},destroy:function(){this.grid&&this.grid.clearCheckTask(),d=0,u.off(".cdh")}};c.exports=K}),define("cvm/cdh/cdhconfig",function(a,b,c){var d=window.location.host.indexOf("cloud.tencent.com")>=0?"https://buy.cloud.tencent.com":"https://buy.qcloud.com";c.exports={regionBlackList:{6:"多伦多",12:"广州open",19:"重庆",31:"济南",32:"杭州"},cdhRegionWhiteMap:{5:"CDH_HK"},CDH_BUY_PAGE:d+"/cdh",CDH_CVM_CREATE_PAGE:d+"/cdhcvm",NEW_PAY_URL:d+"/order/check",CVM_PAGE:"/cvm",CVM_DETAIL_PAGE:"/cvm/detail/"}}),define("cvm/cdh/data",function(a,b,c){var d=(a("$"),a("cvm/common/model")),e=a("models/iaas"),f=a("appUtil"),g=a("manager"),h=(a("cvm/cvm/data"),a("cvm/common/constants")),i=a("cvm/cvm/event/operate_base"),j=a("util"),k=new i;c.exports={queryCdhList:function(a,b){var c=a.Filters||[],e=a.limit||20,g=a.offset||0,h=a.regionId||f.getRegionId();return d.apiRequest({serviceType:"cvm",action:"DescribeHosts",data:{filters:c,offset:g,limit:e},regionId:h},b)},modifyCdh:function(a,b){return d.apiRequest({serviceType:"cvm",action:"ModifyHostsAttribute",data:{HostIds:a.hostIds,HostName:a.hostName,RenewFlag:a.renewFlag,PinType:a.pinType,VCPUMultiple:a.vCPUMultiple},regionId:a.regionId},b)},terminateCdh:function(a,b){return d.apiRequest({serviceType:"cvm",action:"TerminateHosts",data:a.data,regionId:a.regionId},b)},queryRenewCdhPrice:function(a,b){return d.apiRequest({serviceType:"cvm",action:"InquiryPriceRenewHosts",data:{HostIds:a.hostIds,HostChargePrepaid:{period:a.period}},regionId:a.regionId},b)},formatList:function(a,b){b=b||{};var c=function(a){var b={PENDING:{desc:"创建中","class":"text-weak"},RUNNING:{desc:"运行中","class":"text-success"},LAUNCH_FAILURE:{desc:"发货失败","class":"text-danger"},EXPIRED:{desc:"已过期","class":"text-warning"},TERMINATED:{desc:"已销毁","class":"text-warning"}},c={LAUNCH_FAILURE:!0,TERMINATED:!0},d={RUNNING:!0,LAUNCH_FAILURE:!0,EXPIRED:!0},e=b[a.hostState];return a.statusDesc=e&&e.desc,a.statusClass=e&&e["class"],a.$disable=c[a.hostState],a.$loading=!d[a.hostState],a},d=function(a){if(a.expiredTime){var b="",c=864e5,d=7*c,e=new Date(a.expiredTime),g=f.getSystemTime(),h=g-e.getTime(),i=-1;if(h>0){var k=Math.floor(h/c);b=1>k?'<span class="text-overflow status-recover error">已过期1天</span>':'<span class="text-overflow status-recover error">已过期'+k+"天</span>",i=1}else if(-d>h)b=j.date.date2Str(new Date(a.expiredTime),"%Y-%M-%d",!0),i=0;else{var k=Math.floor(Math.abs(h/c));b=1>k?'<span class="text-overflow warning">小于1天到期</span>':'<span class="text-overflow warning">'+k+"天后到期</span>",i=2}a.expiredTimeDesc=f.formatDate(new Date(a.expiredTime),"yyyy-MM-dd hh:mm:ss"),a.expiredTimeInfo="LAUNCH_FAILURE"==a.hostState?void 0:b}return a};return a.forEach(function(a,e){a.index=e,a.regionId=b.regionId||f.getRegionId(),a.hostName=a.hostName||"未命名",a.hostAlias=a.hostName,a.uHostId=a.hostId,a.externalHostType=a.hostType,a=c(a),a.cvmNumber=a.instanceIds.length,a.createdTimeDesc=a.createdTime?f.formatDate(new Date(a.createdTime),"yyyy-MM-dd hh:mm:ss"):"-",a=d(a),a.deadline=a.expiredTimeInfo,a.isPrepaid="PREPAID"==a.hostChargeType,a.isPostpaid="POSTPAID_BY_HOUR"==a.hostChargeType,a.payModeDesc=a.isPrepaid?"包年包月":a.isPostpaid?"按量计费":"-",a.placement&&(a.projectId=a.placement.projectId,a.projectName=a.placement.projectName,a.zoneId=h.ZONEV3TOZONEIDMAP[a.placement.zone],a.zoneName=h.ZONEIDV3TONAMEMAP[a.placement.zone]),a.hostResource&&(a.cpuTotal=a.hostResource.cpuTotal,a.cpuAvailable=a.hostResource.cpuAvailable,a.cpuOrigin=a.hostResource.cpuOrigin,a.memTotal=a.hostResource.memTotal,a.memAvailable=a.hostResource.memAvailable,a.diskTotal=a.hostResource.diskTotal,a.diskAvailable=a.hostResource.diskAvailable)}),a},switchRenewParam:function(a,b){return e.apiRequest({serviceType:"cvm",action:"SwitchParameterRenewHosts",data:{HostIds:a.hostIds,HostChargePrepaid:{Period:a.period},Version:"2017-03-12"},regionId:a.regionId},b)},queryCdhWhiteList:function(a){var b=["CDH_SetvCPUQuantity","ASYNC_EXPORT_CDH","CDH_HK","CDH_CBS_white"];return a&&a.length&&(b=b.concat(a)),new Promise(function(a,c){g.queryWhiteList({whiteKey:b},function(b){a(b)},function(a){c(a)})})},toPay2:function(a){k.toPay2(a)}}}),define("cvm/cdh/detail/cdhdetail",function(a,b,c){var d=a("pageManager"),e=a("$"),f=a("cvm/cdh/detail/configdetail"),g=a("cvm/cdh/detail/childlist"),h=a("cvm/cdh/detail/monitordetail"),i=a("cvm/common/constants"),j=a("manager"),k=a("tips"),l=a("cvm/cdh/data"),m=a("appUtil"),n=a("router"),o={main:'  <div class="cdh-panel">    <div class="manage-area">      <div class="manage-area-title secondary-title">        <a href="javascript:;" b-on-click="back()" class="back-link">返回</a>        <span class="line-icon">|</span>        <h2>{{hostData.uHostId}}（{{hostData.hostAlias}}）</h2>        <div class="cvm-more-opt manage-area-title-right"></div>      </div>      <div class="manage-area-main secondary-main keyboard-focus-obj" id="detailScrollWrap">        <!-- tab -->        <div class="tc-15-tab tc-15-tab-alt tc-special-tab">          <ul role="tablist" class="tc-15-tablist" id="cvmDetailNav" style="z-index:99">            <li class="{{0 == activeIndex ? \'tc-cur\': \'\'}}">              <a b-on-click="$set(\'activeIndex\', 0)" href="javascript:;" role="tab">配置详情</a>            </li>            <li class="{{1 == activeIndex ? \'tc-cur\': \'\'}}">              <a b-on-click="$set(\'activeIndex\', 1)" href="javascript:;" role="tab">实例列表</a>            </li>            <li class="{{2 == activeIndex ? \'tc-cur\': \'\'}}">              <a b-on-click="$set(\'activeIndex\', 2)" href="javascript:;" role="tab">监控指标</a>            </li>          </ul>          <div class="tab-panel">            <div class="manage-area-full-inner">              <!-- <div class="tc-panel"> -->              {{> contentHtml }}              <!-- </div> -->            </div>          </div>        </div>      </div>    </div>  </div>'},p={render:function(a,b,c){c=+c||0;var d=this;if(c>1||!a||!b)return c=0,void d.renderDetailNoData();var d=this;d.$appArea=e("#appArea"),Promise.all([l.queryCdhList({Filters:[{name:"host-id",values:[b]}],regionId:a}),new Promise(function(a,b){j.getAllWhiteList(function(b){a(b)})})]).then(function(e){var f=e[0].response.hostSet,g=e[1];if(d.whiteListMap=g,f&&f.length){f=l.formatList(f,{regionId:a});var h=f[0];d.renderPage(h,b,c)}else k.error("信息有误，没有该宿主机的信息！"),d.renderDetailNoData()})["catch"](function(a){k.error("信息有误，没有该宿主机的信息！"),d.renderDetailNoData()})},renderDetailNoData:function(){m.renderDetailNoData("专用宿主机","/cvm/cdh")},renderPage:function(a,b,c){var e=new q({$beforeInit:function(){},$afterDestroy:function(){},$data:{activeIndex:c,hostId:b,hostData:a}});d.appArea.html(e.$el)}},q=Bee.extend({$tpl:o.main,$beforeInit:function(){this._tabs=[]},$afterInit:function(){var a=this;a.contentArea=e("#detailContent"),this.$watch("activeIndex",function(b){a.loadTabs(b)},!0)},loadTabs:function(a){var b=this,c=this._tabs[a];if(!c){switch(a){case 0:c=new f({$data:{item:b.hostData,hostId:b.hostId,regionName:i.REGIONNAMES[m.getRegionId()]}});break;case 1:c=new g({$data:{item:b.hostData,hostId:b.hostId}});break;case 2:c=new h({$data:{item:b.hostData,hostId:b.hostId}})}this._tabs[a]||(this._tabs[a]=c)}this._tabs.length>1&&this._tabs[1]&&this._tabs[1].setCurentActive(a),this.$set("contentHtml",c.$el)},back:function(){this._tabs.length>1&&this._tabs[1]&&this._tabs[1].clearTask(),this.$destroy(),n.navigate("/cvm/cdh")}},{defaults:{}});c.exports=p}),define("cvm/cdh/detail/childlist",function(a,b,c){var d,e=a("$"),f=a("dialog"),g=(a("pageManager"),a("qccomponent")),h=a("util"),i=a("event"),j=(a("tips"),a("cvm/cdh/dialog/edit")),k=a("cvm/cdh/dialog/shutdown"),l=a("cvm/cdh/dialog/boot"),m=a("widget/fieldsManager/gridView"),n=a("cvm/cdh/dialog/reboot"),o=a("cvm/cdh/dialog/destroy"),p=a("nmc/widget/dropdown"),q=a("cvm/cdh/cdhconfig"),r=a("widget/pubsubhub/pubsubhub"),s=a("cvm/cdh/dialog/export"),t=g.getComponent("grid-view"),u=a("lengthlimiter"),v=(a("widget/cvmList/data_package"),a("appUtil")),w=(a("manager"),null),x={},y=(a("cvm/cdh/data"),a("cvm/cvm/data")),z=a("cvm/cvm/format"),A=a("widget/errorTips/errorTips"),B=a("widget/mfa/mfa"),C=a("cvm/cvm/cvmutil"),D={main:'  <div class="param-box">    <div class="manage-area">      <!-- 添加窗体模块 -->      <div class="tc-15-action-panel" id="zjOperArea">        <div class="tc-15-msg" style="margin-bottom: 15px;">          <p>            要对实例进行日常监控维护、配置升级、其他更多操作，请            <a href="/cvm?uHostIds={{hostId}}" data-event="nav"> 前往[实例]管理</a>          </p>          <p class="tip-info">            云硬盘采用按量计费的计费方式。当账户欠费时，若系统盘被隔离，子机不可用；若系统盘被清除，子机将一同被清除。如需屏蔽此逻辑，请联系大客户经理开通欠费不停服服务。          </p>        </div>        <button type="button" class="tc-15-btn m " data-event="oper_create" data-title="">          +分配实例        </button>        <div class="tc-15-dropdown tc-15-dropdown-btn-style" id="zjmore_oper">          <a href="javascript:;" class="tc-15-dropdown-link">更多操作 <i class="caret"></i>          </a>          <ul class="tc-15-dropdown-menu">            <li class="disabled" data-event="oper_reboot" data-name="reboot" data-title="请先选择实例">              <a href="javascript:;">重启</a>            </li>            <li class="disabled" data-event="oper_poweron" data-name="poweron" data-title="请先选择实例">              <a href="javascript:;">开机</a>            </li>            <li class="disabled" data-event="oper_poweroff" data-name="poweroff" data-title="请先选择实例">              <a href="javascript:;">关机</a>            </li>            <li class="disabled" data-event="oper_destroy" data-name="destroy" data-title="请先选择实例">              <a href="javascript:;">销毁</a>            </li>            <li class="disabled" data-event="oper_edit" data-name="edit" data-title="请先选择实例">              <a href="javascript:;">改名</a>            </li>          </ul>        </div>        <button class="tc-15-btn weak m download" data-event="oper_export" qc-popover="导出实例列表"          qc-popover-attach-el="#appArea"></button>        <button b-ref="setting" class="tc-15-btn weak m setting" data-grid-setting qc-popover="设置列表显示字段"          qc-popover-attach-el="#appArea"></button>        <qc-search b-ref="search" placeholder="请输入实例名/实例ID/IP进行搜索"></qc-search>      </div>      <div class="tc-15-action-panel" id="cdhCvmList">        <child-grid b-ref="grid"></child-grid>      </div>    </div>  </div>',name:'  <div class="id-name-cell">    <p>      <a href="javascript:;" b-on-click="showVpsDetail(item)">{{        item.uInstanceId || item.instanceId      }}</a>    </p>    <div>      <span class="m-width" title="">        {{ item.alias }}        <i b-if="!item.$disable || !item.$loading" b-on-click="operExec(\'edit\',item)" class="pencil-icon hover-icon"          style="cursor:pointer"></i>      </span>    </div>  </div>',opearTpl:"  <div class=\"cvm-oper-cell\">    <a b-if=\"item['opsAvailable']['BOOT']\" class=\"{{ item.$loading ? 'disable' : '' }}\" href=\"javascript:;\"      b-on-click=\"operExec('boot',item)\">开机</a>    <a b-if=\"item['opsAvailable']['SHUTDOWN']\" class=\"{{ item.$loading ? 'disable' : '' }}\" href=\"javascript:;\"      b-on-click=\"operExec('shutdown',item)\">关机</a>    <a b-if=\"item['opsAvailable']['REBOOT']\" class=\"{{ item.$loading ? 'disable' : '' }}\" href=\"javascript:;\"      b-on-click=\"operExec('reboot',item)\">重启</a>    <a href=\"javascript:;\" class=\"{{ item.$loading ? 'disable' : '' }}\" b-on-click=\"operExec('destroy',item)\">销毁</a>  </div>"},E=h.tmpl('  <div class="ip-cell">    <p>      <span class="text-overflow m-width" title="<%if(eipInfo){%>弹性<%}%>公网IP: <%= deviceWanIp %>">        <%= deviceWanIp %> <% if (deviceWanIp && deviceWanIp!="-") { %>        <i class="net-type">( <% if(eipInfo){ %>弹性 <% }else{ %>公 <% } %>)</i>        <% } %>      </span>      <!--        <i class="copy-icon" data-clipboard-text="<%=deviceWanIp%>" style="display:none; cursor:pointer;" title="复制<%if(eipInfo){%>弹性<%}%>公网IP"></i>      -->    </p>    <p>      <span class="text-overflow m-width" title="内网IP: <%= deviceLanIp %>">        <%= deviceLanIp %> <% if (deviceLanIp && deviceLanIp!="-") { %>        <i class="net-type">(内)</i> <% } %>      </span>      <!--        <i class="copy-icon" data-clipboard-text="<%=deviceLanIp%>" style="display:none; cursor:pointer;" title="复制内网IP"></i>      -->    </p>  </div>',null),F=g.extend({$tpl:D.main,$afterInit:function(){F.__super__.$afterInit.call(this);var a=this;F.hostItem=a.item,F.hostId=a.hostId,a.moreDropdown=new p(e(a.$el).find(".tc-15-dropdown"),{newMode:!0}),w=a,a.bindEvents(),a.grid.setmaxReqNum()},setCurentActive:function(a){1!=a?this.grid.userLeave=!0:this.grid.userLeave=!1},clearTask:function(){var a=this;a.grid&&a.grid.clearCheckTask(),d=0},$destroy:function(){var a=this;a.clearTask()},refresh:function(a){this.grid.getData(a),a&&a.refreshParent&&r.trigger("hostAliasChange","")},getSelectedItemData:function(a){a=parseInt(a);var b={},c=this.grid.list;return c&&(b=c[a]),b},editDialog:function(a){var b=this,c=a?[a]:b.grid.getSelected(),d=new j({selectedItems:c});f.create(d.$el,"600","",{title:"重启","class":"dialog_layer_v2 tc-15-rich-dialog",preventResubmit:!0,button:{" 确定 ":function(a){d.doAction(f,b)}}}),u.trigger(),e("#aliasIpt").focus().val(c[0].alias),u.trigger()},rebootDialog:function(a){var b=this;B.verify({api:"cvm:RebootInstances"}).then(function(){var c=new n({selectedItems:a?[a]:b.grid.getSelected()});f.create(c.$el,"600","",{title:"重启","class":"dialog_layer_v2 tc-15-rich-dialog",preventResubmit:!0,button:{" 确定 ":function(a){c.doAction(f,b)}}})})},bootDialog:function(a){var b=this,c=new l({selectedItems:a?[a]:b.grid.getSelected()});f.create(c.$el,"600","",{title:"开机","class":"dialog_layer_v2 tc-15-rich-dialog",preventResubmit:!0,button:{" 确定 ":function(a){c.doAction(f,b)}}})},destroyDialog:function(a){var b=this;B.verify({api:"cvm:TerminateInstances"}).then(function(){var c=new o({selectedItems:a?[a]:b.grid.getSelected()});f.create(c.$el,"600","",{title:"销毁","class":"dialog_layer_v2 tc-15-rich-dialog",preventResubmit:!0,button:{" 确定 ":function(){c.doAction(f,b)}}})})},shutdownDialog:function(a){var b=this;B.verify({api:"cvm:StopInstances"}).then(function(){var c=new k({selectedItems:a?[a]:b.grid.getSelected()});f.create(c.$el,"600","",{title:"关机","class":"dialog_layer_v2 tc-15-rich-dialog",preventResubmit:!0,button:{" 确定 ":function(a){c.doAction(f,b)}}})})},bindEvents:function(){var a=this;a.lockChange=!1;var b=["reboot","poweron","poweroff","destroy","edit"];a.grid=a.$refs.grid;var c=e(a.$refs.grid.$el);a.listEl=c,c.on("click",'input[type="checkbox"]',function(c){setTimeout(function(){var c=a.$refs.grid.getSelected().length;a.listEl=e("#cdhCvmList");var d=a.listEl.find('input[type="checkbox"]').not("[data-check-all]").not("[disabled]"),f=d.filter(":checked").closest("tr"),g=a.$refs.grid.getSelected();e(f).each(function(a){var b=e(this);g[a].el=b});var h={reboot:!1,poweron:!1,poweroff:!1,destroy:!1,edit:!1};g.forEach(function(a){var b=a.opsAvailable;b.REBOOT&&(h.reboot=!0),b.BOOT&&(h.poweron=!0),b.SHUTDOWN&&(h.poweroff=!0),b.RENAME&&(h.edit=!0),a.uHostId&&(h.destroy=!0)});var i={reboot:"运行中的实例才可以重启",poweron:"关机状态的实例才可以开机",poweroff:"运行中的实例才可以关机",destroy:"当前状态不允许进行该操作",edit:"当前状态不允许进行该操作"};b.forEach(function(b){var d=e(a.$el).find(".tc-15-dropdown").find('[data-name="'+b+'"]');0!=c&&h[b]?d.removeClass("disabled").attr("data-title",""):d.addClass("disabled").attr("data-title",0==c?"请先选择实例":i[b])})},0)}),a.$refs.search.$on("search",function(b){a.grid.getData({searchKey:b})}),e(a.$refs.setting).click(function(){a.grid.showFieldsManager()}),i.bindCommonEvent(a.$el,"click",{oper_export:function(){var b=a.grid.getSelected();a.gridView=a.grid,a.queryInstanceParams={filters:[]};var c=v.getProjectId();-1!=c&&a.queryInstanceParams.filters.push({name:"project-id",values:[c]});var d=a.gridView.searchKey;d&&(a.checkIfIp(a.gridView.searchKey)?a.queryInstanceParams.vagueIpAddress=d:0==d.indexOf("ins-")?a.queryInstanceParams.filters.push({name:"instance-id",values:[d]}):a.queryInstanceParams.vagueInstanceName=d);var e=new s;e.exportChildList(b,a)},oper_create:function(){var a=q.CDH_CVM_CREATE_PAGE+"?&regionId="+F.hostItem.regionId+"&zoneId="+F.hostItem.zoneId+"&projectId="+F.hostItem.projectId+"&hostType="+F.hostItem.externalHostType+"&hostId="+F.hostItem.hostId;window.open(a)},oper_reboot:function(){var b=e(this);b.hasClass("disabled")||a.rebootDialog()},oper_poweron:function(){var b=e(this);b.hasClass("disabled")||a.bootDialog()},oper_poweroff:function(){var b=e(this);b.hasClass("disabled")||a.shutdownDialog()},oper_destroy:function(){var b=e(this);b.hasClass("disabled")||a.destroyDialog()},oper_edit:function(){var b=e(this);b.hasClass("disabled")||a.editDialog()}})},checkIfIp:function(a){var b=/^\d{1,3}((\.(\d{1,3})?)?){0,3}$/;return b.test(a)}});F.tag("child-grid",t.extend({$mixins:t.prototype.$mixins.concat([m("cdh_subpage_grid_fields_201801231454","",5,10)]),getData:function(a,b){var c=this;a=a||{},x=a;var d=(a.page-1)*a.count||0,e=a.count||20,f=F.hostItem.uHostId||F.hostId,g=v.getProjectId(),h=v.getRegionId(),i={offset:d,limit:e,regionId:h},j=[{name:"host-id",values:[f]}];-1!=g&&j.push({name:"project-id",values:[g]}),a.searchKey&&(c.checkIfIp(a.searchKey)?i.vagueIpAddress=a.searchKey:0==a.searchKey.indexOf("ins-")?j.push({name:"instance-id",values:[a.searchKey]}):i.vagueInstanceName=a.searchKey),i.filters=j,y.queryCvmList2(i).then(function(b){if(b.errors&&b.errors.length){c.setData({list:[]});for(var d=0;d<b.errors.length;d++){var e=b.errors[d];A.isCamRefused(e)?c.showTips("<div><cam-tips>"+e.message+"</cam-tips></div>"):c.showTips("<div><error-tips>"+e.message+"</error-tips></div>");break}}else{var f=b.response&&b.response.instanceSet,g=b.response&&b.response.totalCount;f=z.get(f,{regionId:i.regionId}),f.forEach(function(a){a.$loading=C.isDuringExclusionOperation(a)}),c.setData({list:f,totalNum:g,searchKey:a.searchKey||!1,page:a.page||1,limit:a.limit||20}),c.checkTask()}},function(a){c.showTips("<div><error-tips>"+a.message+"</error-tips></div>")})},checkIfIp:function(a){var b=/^\d{1,3}((\.(\d{1,3})?)?){0,3}$/;return b.test(a)},setTrAttr:function(a,b){return a={"data-id":b.uInstanceId,"data-uuid":b.uuid}},userIsDoing:function(){var a=this;return a.getSelected().length>0||a.userLeave?!0:!1},clearCheckTask:function(){clearTimeout(this.watingTime)},checkTask:function(){var a=this;a.isWating=!1,a.list.forEach(function(b){b.$loading&&(a.isWating=!0)}),a.clearCheckTask(),a.isWating?this.watingTime=setTimeout(function(){a.userIsDoing()?a.checkTask():d&&(d--,x.sliceRefresh=!0,a.getData(x))},5e3):a.setmaxReqNum()},setmaxReqNum:function(){d=200},showVpsDetail:function(a){window.location.href=q.CVM_DETAIL_PAGE+a.regionId+"/"+a.uInstanceId},getCellContent:function(a,b,c){var d;switch(c.key){case"idAndName":d=D.name;break;case"statusDesc":return h.tmpl('<p><span class="dev-status text-overflow <%-statusColorClass%>">\n                <%if (statusClass) {%><i class="<%- statusClass%>">\n                </i><%}%><span class="status-col<%if (statusColorClass == "text-danger") {%> text-danger-und<%}%>"><%- statusTitle%></span></span>\n                </p>\n                <% if (operationTitle) {%>\n                <p><span class="dev-status text-overflow <%-operationColorClass%>" <%if (operationDesc) {%> <%- operationDesc%><%}%>>\n                <%if (operationClass) {%><i class="<%- operationClass%>">\n                  </i><%}%><span class="status-col<%if (operationColorClass == "text-danger") {%> text-danger-und<%}%>"><%- operationTitle%></span></span>\n                </p> <% } %>',b);case"deviceTypeName":d='<span class="text-overflow">'+b.instanceTypeDesc+'<i class="'+b.osIcon+'" data-title="'+b.osName+'"></i></span>';break;case"ipAddress":var e=b.deviceLanIp||"-",f=b.deviceWanIp||"-",g=b.eipInfo;return E({deviceLanIp:e,deviceWanIp:f,eipInfo:g});case"payModeDesc":d="<div><p>"+b.cvmPayModeDesc+"</p><p>"+b.cvmPayModeTimeDesc+"</p></div>";break;case"_action":d=D.opearTpl;break;default:d='<span class="text-overflow">'+(a||"-")+"</span>"}return d},operExec:function(a,b){if(!b.$loading)switch(b.el=e("#cdhCvmList").find('tr[data-uuid="'+b.uuid+'"]'),a){case"edit":w.editDialog(b);break;case"boot":w.bootDialog(b);break;case"shutdown":w.shutdownDialog(b);break;case"reboot":w.rebootDialog(b);break;case"destroy":w.destroyDialog(b)}}},{defaults:{hasFirst:!0,firstColWith:"26px",canResizeColum:!1,autoCheckWidth:!1,colums:[{name:"ID/实例名",key:"idAndName",minWidth:110,required:!0},{name:"状态",key:"statusDesc",minWidth:110},{name:"可用区",key:"zoneName"},{name:"实例类型",key:"deviceTypeName"},{key:"cvmConfig",name:"配置",minWidth:134},{name:"IP地址",key:"ipAddress",width:180},{name:"实例计费模式",key:"payModeDesc"},{name:"网络计费模式",key:"networkPayModeDesc"},{name:"所属项目",key:"projectName"},{name:"操作",required:!0,width:100,key:"_action"}]}})),c.exports=F}),define("cvm/cdh/detail/configdetail",function(a,b,c){var d=(a("$"),a("dialog")),e=a("cvm/cdh/dialog/renew"),f=a("cvm/cdh/dialog/rename"),g=a("widget/pubsubhub/pubsubhub"),h=a("qccomponent"),i={configDetail:'  <div class="tc-panel">    <div class="param-box">      <div class="param-hd"><h3>基本信息</h3></div>      <div class="param-bd">        <ul class="item-descr-list">          <li data-devicelanip="<%=deviceLanIp%>" data-uuid="<%=uuid%>">            <span class="item-descr-tit">宿主机名</span>            <span class="item-descr-txt hostname"              >{{ item.hostAlias ? item.hostAlias : \'未命名\' }}              <a                href="javascript:;"                class="pencil-icon"                b-on-click="rename()"              ></a>            </span>          </li>          <li>            <span class="item-descr-tit">宿主机ID</span>            <span class="item-descr-txt">{{ item.uHostId }}</span>          </li>          <li b-if="item.cageId">            <span class="item-descr-tit">所属围笼ID</span>            <span class="item-descr-txt">{{ item.cageId }}</span>          </li>          <li b-if="item.cageId">            <span class="item-descr-tit">所属围笼名称</span>            <span class="item-descr-txt">{{ item.cageAlias || \'未命名\' }}</span>          </li>          <li>            <span class="item-descr-tit">状态</span>            <span class="item-descr-txt {{item.statusClass}}">{{              item.statusDesc            }}</span>          </li>          <li>            <span class="item-descr-tit">机型</span>            <span class="item-descr-txt">{{ item.externalHostType }}</span>          </li>          <li>            <span class="item-descr-tit">CPU</span>            <span class="item-descr-txt">{{ item.cpuTotal }}核</span>          </li>          <li>            <span class="item-descr-tit">内存</span>            <span class="item-descr-txt">{{ item.memTotal }}G</span>          </li>          <li>            <span class="item-descr-tit">硬盘容量</span>            <span class="item-descr-txt">{{ item.diskTotal }}G</span>          </li>          <li>            <span class="item-descr-tit">地域</span>            <span class="item-descr-txt">{{ regionName }}</span>          </li>          <li>            <span class="item-descr-tit">可用区</span>            <span class="item-descr-txt">{{ item.zoneName }}</span>          </li>          <li>            <span class="item-descr-tit">宿主机计费模式</span>            <span class="item-descr-txt">{{ item.payModeDesc }}</span>          </li>          <li>            <span class="item-descr-tit">创建时间</span>            <span class="item-descr-txt">{{ item.createdTimeDesc }}</span>          </li>          <li b-if="item.expiredTimeDesc">            <span class="item-descr-tit">到期时间</span>            <span class="item-descr-txt">{{ item.expiredTimeDesc }} </span>            <a href="javascrpt:;" b-on-click="renew()"> 续费</a>          </li>        </ul>      </div>    </div>  </div>'
},j=h.extend({$tpl:i.configDetail,$afterInit:function(){j.__super__.$afterInit.call(this)},$beforeDestroy:function(){},setCurentActive:function(a){},rename:function k(){var a=this,k=new f({newName:a.item.hostAlias||"未命名",selectedItem:[a.item]});d.create(k.$el,"600","",{title:"改名","class":"dialog_layer_v2 tc-15-rich-dialog new-gateway",preventResubmit:!0,button:{"确定":function(b){k.doAction(d,function(b){a.item.hostAlias=b,a.$set("item",a.item),g.trigger("hostAliasChange",b)})}}})},renew:function l(){var a=this,l=new e({newName:"testNewName",selectedItem:[a.item]});d.create(l.$el,"700","",{title:"续费","class":"dialog_layer_v2 tc-15-rich-dialog new-gateway",preventResubmit:!0,button:{"确定":function(a){l.doAction(d)}}})}});c.exports=j}),define("cvm/cdh/detail/monitordetail",function(a,b,c){a("Highcharts");var d,e=(a("$"),a("dialog"),a("util"),a("appUtil")),f=a("qccomponent"),g=a("manager"),h=(f.getComponent("grid-view"),a("cvm/cdh/dialog/cdhchart")),i={cpu:[{viewName:"host_cpu",metricName:"logic_cpu_usage",statistics:"max",cpu_name:"cpu"}],mem:[{viewName:"host_detail",metricName:"mem_total",statistics:"max"},{viewName:"host_detail",metricName:"mem_available",statistics:"max"}],lan:[{viewName:"host_detail",metricName:"eth0_intraffic",statistics:"max"},{viewName:"host_detail",metricName:"eth0_outtraffic",statistics:"max"}],disk:[{viewName:"host_detail",metricName:"disk_read_traffic",statistics:"max"},{viewName:"host_detail",metricName:"disk_write_traffic",statistics:"max"},{viewName:"host_detail",metricName:"disk_await",statistics:"max"}]},j=[{name:["cpu利用率"],color:["#ff7a22"],units:["%"]},{name:["总内存","可用内存"],color:["#ff7a22","#1C86EE"],units:["GB","GB"],yUnit:"GB"},{name:["内网入带宽","内网出带宽"],color:["#ff7a22","#1C86EE"],units:["Mbps","Mbps"],yUnit:""},{name:["硬盘读流量","硬盘写流量"],color:["#ff7a22","#1C86EE"],units:["kb/s","kb/s"],yUnit:"kb/s"}],k=["cpu","mem","lan","disk"],l=function(a){if("REALTIME"==a)return new Date;var b=a.split("-"),c=new Date(0);return c.setFullYear(+b[0],+b[1]-1,+b[2]),c},m={main:'  <div class="tab-panel param-panel">    <!-- <div class="manage-area-full-inner"> -->    <div class="cdh-data-box monitor-list mb20">      <ul>        <li>          <p class="text">当前CPU使用率</p>          <h3>{{realTimeData.cpuUsage ? realTimeData.cpuUsage : \'-\' }}            <em class="percent-text">%</em>          </h3>        </li>        <li>          <p class="text">当前内存使用率</p>          <h3>{{realTimeData.memUsage ? realTimeData.memUsage : \'-\' }}            <em class="percent-text">%</em>          </h3>        </li>        <li>          <p class="text">可用硬盘空间</p>          <h3 class="warning-text">{{realTimeData.diskAvail ? realTimeData.diskAvail : \'-\' }}            <em class="percent-text">GB</em>          </h3>        </li>        <li>          <p class="text">当前带宽流量</p>          <h3 class="warning-text">{{realTimeData.outTraffic ? realTimeData.outTraffic : \'-\' }}            <em class="percent-text">Mbps</em>          </h3>        </li>      </ul>    </div>    <!-- 统计数据 E-->    <div class="monitor-data">      <!-- 统计数据头部 E-->      <div class="monitor-data-head">        <div class="tc-15-calendar-select-wrap tc-15-calendar2-hook mb20">          <qc-date-picker b-ref="datePicker" tabs="{{tabs}}" showCalendar="{{showCalendar}}" selected="{{selected}}" range="{{range}}"            id="logDatePicker"></qc-date-picker>        </div>        <!--                        <button type="button" class="tc-15-btn m weak ml10">添加时间对比</button>                        <div class="monitor-data-tool ml10">                            <ul class="monitor-data-toggle">                                <li class="data-check">                                    <i class="monitor-view-list" b-on-click="toggleChartMode(false)"></i>                                </li>                                <li>                                    <i class="monitor-view-img" b-on-click="toggleChartMode(true)"></i>                                </li>                            </ul>                            <button type="button" class="tc-15-btn weak m download">下载</button>                        </div>                        -->        <div class="monitor-data-tab" b-if="!fullChartMode">          <ul role="tablist" class="tc-15-tablist">            <li b-repeat="tab in tabsList" class="{{activeIndex == tab.index ? \'tc-cur\' : \'\'}}">              <a href="javascript:;" b-on-click="tabSelect(tab.index)" title="" role="tab">{{tab.title}}</a>            </li>            <!--                                <li><a href="#" title="" role="tab">CPU使用情况</a></li>                                <li><a href="#" title="" role="tab">内存监控</a></li>                                <li><a href="#" title="" role="tab">内网流量</a></li>                                <li><a href="#" title="" role="tab">公网流量</a></li>                                <li class="tc-cur"><a href="#" title="" role="tab">CPU硬盘监控</a></li>                                -->          </ul>        </div>      </div>      <!-- 统计数据头部 S-->      <!-- 统计数据内容 E-->      <div class="monitor-data-body" b-if="!fullChartMode">        <!-- 统计数据内容1 E-->        <div class="finance-chart-box">          <div b-tag="chart" b-ref="chart1"></div>          <div b-if="secondChart" b-tag="chart" b-ref="chart2"></div>          <!--                                                        <div b-if="thirdChart" b-tag="chart" b-ref="chart3"></div>                                                        <div ="fourthChart" b-tag="chart" b-ref="chart4"></div>                                                        <!--                                                        <h3 class="mb20">数据报表</h3>                                                        <monitor-data-grid b-ref="grid" ></monitor-data-grid>                                                         -->        </div>        <!-- 统计数据内容详情1 S-->      </div>      <div b-if="fullChartMode" id="monitorDetail">        <!--                        <div class="chart-row">                            <div b-tag="chart" b-ref="test1"></div>                            <div class="chart-cell gap-cell"></div>                            <div b-tag="chart" b-ref="test2"></div>                        </div> -->      </div>      <!-- 统计数据内容 S-->    </div>    <!-- 统计数据 S-->    <!-- </div> -->  </div>'},n=f.extend({$tpl:m.main,activeIndex:0,tabsList:[{index:0,title:"CPU使用情况"},{index:1,title:"内存监控"},{index:2,title:"内网流量"},{index:3,title:"硬盘监控"}],$afterInit:function(){n.__super__.$afterInit.call(this);var a=this;a.initDatePicker(),a.tabSelect(0),a.chartRefs=[a.$refs.chart1,a.$refs.chart2],setTimeout(function(){a.condChange()},200),a.refresh()},setCurentActive:function(a){},initDatePicker:function(){var a=this;d=a.$refs.datePicker,d.setAllowRange(null,"%TODAY"),d.$on("datepick",function(b){a.condChange()})},$beforeDestroy:function(){},refresh:function(a){this.refreshRealTimeData()},refreshRealTimeData:function(){var a=this;g.getRealTimeCdhData({regionId:e.getRegionId(),lanip:a.item.hostIp},function(b){a.$set("realTimeData",b)})},tabSelect:function(a){this.activeIndex!=a&&(this.$set("activeIndex",a),this.condChange())},toggleChartMode:function(a){this.$set("fullChartMode",a),this.condChange()},showIndexChart:function(a){var b=this;3==b.activeIndex?b.$set("secondChart",!0):b.$set("secondChart",!1),b.chartRefs=[b.$refs.chart1,b.$refs.chart2]},setChartTitles:function(){var a=this;a.chart1=a.$refs.chart1,0==a.activeIndex?(a.$refs.chart1.$set("chartTitle","CPU使用率"),a.$refs.chart1.$set("chartUnit","")):1==a.activeIndex?(a.$refs.chart1.$set("chartTitle","内存"),a.$refs.chart1.$set("chartUnit","GB")):2==a.activeIndex?(a.$refs.chart1.$set("chartTitle","内网带宽"),a.$refs.chart1.$set("chartUnit","Mbps")):3==a.activeIndex&&(a.$refs.chart1.$set("chartTitle","硬盘读写流量"),a.$refs.chart1.$set("chartUnit","kb/s"),a.$refs.chart2.$set("chartTitle","硬盘IO await"),a.$refs.chart2.$set("chartUnit","ms"))},condChange:function(){var a=this,b=d.selected;if(!a.fullChartMode){var c=i[k[a.activeIndex]];a.showIndexChart(c.length),a.setChartTitles();var f=l(b.from),h=l(b.to),m=[],n=j[a.activeIndex];c.forEach(function(a,b){m.push(a.metricName)});var o={chartOnly:!0,colums:m,startDate:Math.round(f.getTime()/1e3),endDate:Math.round(h.getTime()/1e3),lanip:a.item.hostIp,regionId:e.getRegionId()};a.chartRefs[0].$set("data",{loading:!0}),a.chartRefs[1]&&a.chartRefs[1].$set("data",{loading:!0}),g.getCdhMonitorChartData(o,function(b){if(1==m.length){var c=b[m[0]];"logic_cpu_usage"==m[0]&&(c.unit="%",c.yUnit="%"),a.chartRefs[0].$set("data",c)}else if(1!=a.activeIndex&&2!=a.activeIndex&&3!=a.activeIndex)m.forEach(function(c,d){var e=b[m[d]];"mem_total"==c&&(e.unit="%",e.yUnit="%"),"mem_available"==c&&(e.unit="GB",e.yUnit="GB"),a.chartRefs[d].$set("data",e)});else{var c={multi:!0,yUnit:n.yUnit,dayView:b[m[0]].dayView,x:b[m[0]].x,chartOpt:n},d=[];if(d.push(b[m[0]]),d.push(b[m[1]]),c.list=d,a.chartRefs[0].$set("data",c),3==a.activeIndex){var e=b[m[2]];e.unit="ms",e.yUnit="ms",a.chartRefs[1].$set("data",e)}}})}},loadCharts:function(){}},{defaults:{tabs:[{label:"近24h",from:"REALTIME",to:"REALTIME",display:"近24h"},{label:"近7天",from:"%TODAY-7",to:"%TODAY"},{label:"近14天",from:"%TODAY-14",to:"%TODAY"}],showCalendar:!0,selected:{from:"REALTIME",to:"REALTIME"},range:{min:"%TODAY-30",max:"%TODAY",maxLength:"30"}}});n.tag("chart",h.extend({})),c.exports=n}),define("cvm/cdh/detail/monitorflow",function(a,b,c){var d=(a("$"),a("manager")),e=(a("util"),a("appUtil")),f=a("qccomponent"),g=a("cvm/cdh/basechart"),h={main:'    <div class="chart-wrap">        <div class="chart-grid">            <div class="chart-row">                <div b-tag="chart" b-ref="cpuUsage"></div>                <div class="chart-cell gap-cell"></div>            </div>            <div class="chart-row">                <div b-tag="chart" b-ref="memAvail"></div>                <div class="chart-cell gap-cell"></div>                <div b-tag="chart" b-ref="memTotal"></div>            </div>            <div class="chart-row">                <div b-tag="chart" b-ref="inTraffic"></div>                <div class="chart-cell gap-cell"></div>                <div b-tag="chart" b-ref="outTraffic"></div>            </div>            <div class="chart-row">                <div b-tag="chart" b-ref="diskAvail"></div>                <div class="chart-cell gap-cell"></div>                <div b-tag="chart" b-ref="diskAwait"></div>            </div>            <div class="chart-row">                <div b-tag="chart" b-ref="diskRead"></div>                <div class="chart-cell gap-cell"></div>                <div b-tag="chart" b-ref="diskWrite"></div>            </div>            <!--            <div class="chart-row">                <chart-row b-ref="chart1"></chart-row>                <div class="chart-cell gap-cell"></div>                <chart-row2 b-ref="chart2"></chart-row2>            </div>            -->        </div>        <div style="height: 50px">        </div>    </div>'},i=[{chartName:"memAvail",viewName:"mem_available",chartTitle:"可用内存",chartUnit:"GB",yUnit:"G"},{chartName:"memTotal",viewName:"mem_total",chartTitle:"总内存",chartUnit:"GB",yUnit:"G"},{chartName:"inTraffic",viewName:"eth0_intraffic",chartTitle:"内网入带宽",chartUnit:"Mbps",yUnit:"Mbps"},{chartName:"outTraffic",viewName:"eth0_outtraffic",chartTitle:"内网出带宽",chartUnit:"Mbps",yUnit:"Mbps"},{chartName:"diskAvail",viewName:"disk_available",chartTitle:"可用硬盘空间",chartUnit:"GB",yUnit:"G"},{chartName:"diskAwait",viewName:"disk_await",chartTitle:"硬盘IO Await",chartUnit:"ms",yUnit:"ms"},{chartName:"diskRead",viewName:"disk_read_traffic",chartTitle:"硬盘读流量",chartUnit:"KB/s",yUnit:"KB/s"},{chartName:"diskWrite",viewName:"disk_write_traffic",chartTitle:"硬盘写流量",chartUnit:"KB/s",yUnit:"KB/s"}],j=f.extend({});j.tag("chart",g.extend({}));var k=function(a){if("REALTIME"==a)return new Date;var b=a.split("-"),c=new Date(0);return c.setFullYear(+b[0],+b[1]-1,+b[2]),c};c.exports={render:function(a,b){var c=this,d=c.bee=new j(h.main,{$data:{}});c.hostData=b,c.cpuUsage=d.$refs.cpuUsage,c.cpuUsage.$set("chartTitle","CPU使用率"),c.chartRefs=[],i.forEach(function(a){var b=d.$refs[a.chartName];b.$set("chartTitle",a.chartTitle),b.$set("chartUnit",a.chartUnit),c.chartRefs.push({yUnit:a.yUnit,unit:a.chartUnit,viewName:a.viewName,chartRef:b})}),a.html(d.$el)},dateSelected:function(a){this.loadChartData(a)},setChartDatas:function(a){a=a||{};var b=this,c={y:[]};b.chartRefs.forEach(function(b){a.empty?b.chartRef.$set("data",c):a.data?a.data[b.viewName]?b.chartRef.$set("data",a.data[b.viewName]):b.chartRef.$set("data",c):b.chartRef.$set("data",null)})},loadChartData:function(a){var b=this,c=k(a.from),f=k(a.to),g={statistics:"max",startDate:Math.round(c.getTime()/1e3),endDate:Math.round(f.getTime()/1e3),lanip:b.hostData.hostIp,regionId:e.getRegionId()};g.viewName="host_cpu",g.metricName="logic_cpu_usage",b.cpuUsage.$set("data",{loading:!0}),d.getCdhChartData(g,function(a){a.yUnit="%",a.unit="%",b.cpuUsage.$set("data",a)},function(){var a={y:[]};b.cpuUsage.$set("data",a)}),b.loadChartDatas(g)},loadChartDatas:function(a){var b=this;a.viewName="host_detail",b.chartRefs.forEach(function(b){a.metricName=b.viewName,b.chartRef.$set("data",{loading:!0}),d.getCdhChartData(a,function(a){a.yUnit=b.yUnit,a.unit=b.unit,b.chartRef.$set("data",a)},function(){var a={y:[]};b.chartRef.$set("data",a)})})},loadChartDataBatch:function(a){var b=this;b.setChartDatas(),b.cpuUsage.$set("data",null),d.getCdhChartDataBatch(a,function(a){a&&b.setChartDatas({data:a})},function(){b.setChartDatas({empty:!0})})}}}),define("cvm/cdh/detail/monitorpanel",function(a,b,c){var d,e=a("$"),f=a("manager"),g=(a("util"),a("appUtil")),h=a("qccomponent"),i=a("cvm/cdh/detail/monitorflow"),j=(a("reporter"),{main:'    <div class="sidebar-panel-container">        <div class="sidebar-panel-hd">            <h3>{{hostData.uHostId}}  监控</h3>            <span class="details-hd-meta">{{hostData.hostAlias}}</span>            <!--            <a href="#" class="details-hd-a">查看数据明细</a> -->        </div>    <div class="sidebar-panel-bd cdh-panel">        <div class="tc-15-rich-tab col4 cdh-data-panel">            <ul role="tablist">                <li class="tc-cur">                    <div role="tab" class="tab">                        <div class="tc-15-rich-tab-title">当前CPU使用率</div>                        <div class="tc-15-rich-tab-value">{{realTimeData.cpuUsage ? realTimeData.cpuUsage : \'--\' }}<span class="tc-15-rich-tab-unit">%</span></div>                    </div>                </li>                <li class="tc-cur">                    <div role="tab" class="tab">                        <div class="tc-15-rich-tab-title">                            当前内存使用率                        </div>                        <div class="tc-15-rich-tab-value">{{realTimeData.memUsage ? realTimeData.memUsage : \'--\' }}<span class="tc-15-rich-tab-unit">%</span></div>                    </div>                </li>                <li class="tc-cur">                    <div role="tab" class="tab">                        <div class="tc-15-rich-tab-title">可用硬盘空间</div>                        <div class="tc-15-rich-tab-value">{{realTimeData.diskAvail ? realTimeData.diskAvail : \'--\' }}<span class="tc-15-rich-tab-unit">GB</span></div>                    </div>                </li>                <li class="tc-cur">                    <div role="tab" class="tab" style="border-right: none;">                        <div class="tc-15-rich-tab-title">当前宽带流量</div>                        <div class="tc-15-rich-tab-value">{{realTimeData.outTraffic ? realTimeData.outTraffic : \'-\' }}<span class="tc-15-rich-tab-unit">Mbps</span></div>                    </div>                </li>            </ul>        </div>        <div class="charts-panel">                <qc-date-picker b-ref="datePicker" tabs="{{tabs}}" showCalendar="{{showCalendar}}" selected="{{selected}}" range="{{range}}" id="chartDatePicker"></qc-date-picker>            <div id="monitorFlowWrap"></div>        </div>    </div>    </div>'}),k=h.extend({$afterInit:function(){k.__super__.$afterInit.call(this);var a=this;a.initDatePicker(),a.refreshRealTimeData()},initDatePicker:function(){var a=this;d=a.$refs.datePicker,d.setAllowRange(null,"%TODAY"),d.$on("datepick",function(b){a.dateChange(b)}),setTimeout(function(){a.dateChange(d.selected)},500)},dateChange:function(a){i.dateSelected(a)},refreshRealTimeData:function(){var a=this;f.getRealTimeCdhData({regionId:g.getRegionId(),lanip:a.hostData.hostIp},function(b){a.$set("realTimeData",b)})}},{defaults:{tabs:[{label:"近24h",from:"REALTIME",to:"REALTIME",display:"近24h"},{label:"近7天",from:"%TODAY-7",to:"%TODAY"},{label:"近14天",from:"%TODAY-14",to:"%TODAY"}],showCalendar:!0,selected:{from:"REALTIME",to:"REALTIME"},range:{min:"%TODAY-30",max:"%TODAY",maxLength:"30"}}});c.exports={render:function(a,b){var c=new k(j.main,{hostData:b});a.html(c.$el),i.render(e("#monitorFlowWrap"),b)},destroy:function(){}}}),define("cvm/cdh/dialog/autoRenew",function(a,b,c){var d=(a("$"),a("qccomponent")),e=a("manager"),f=d.getComponent("grid-view"),g=a("appUtil"),h=a("cvm/cdh/data"),i=a("cvm/common/constants"),j=a("dialog"),k={main:'  <div class="cvm-ip-dialog">    <div class="tc-15-msg">      <div class="tip-info">· 设置自动续费后，将于到期当日，        <i class="text-warning">按月自动续费</i>，请确保余额充足</div>      <div class="tip-info">· 若续费时有可用代金券，系统将自动使用代金券续费，        <a href="https://cloud.tencent.com/document/product/555/7428" target="_blank">代金券说明</a>      </div>      <div class="tip-info">· 如果您的设备今天到期，请选择手动续费</div>      <div class="tip-info">· 如您在扣款日前人工续费，则系统按最新到期时间自动进行续费</div>    </div>    <div class="mb-10">      <strong>下列实例        <span class="text-warning">（共{{enableList.length}}项）</span>将        <span b-if="autoRenew != \'1\'">关闭</span>        <span b-if="autoRenew == \'1\'">开启</span>        自动续费        <a href="#" b-on-click="toggleShowList()">{{isShowList ? \'收起详情\' : \'查看详情\'}}          <i b-class="isShowList ? \'blue-up-icon\': \'blue-down-icon\'"></i>        </a>      </strong>    </div>    <div id="renewList" b-if="isShowList" class="mb-20">      <host-gridview b-ref="grid" list={{selectedItem}}></host-gridview>    </div>    <ul class="form-list">      <li class="pure-text-row">        <div class="form-label">          <label for="">主机自动续费</label>        </div>        <div class="form-input">          <div class="form-unit">            <label class="form-ctrl-label-stacked">              <input value="1" type="radio" name="renewItem" b-model="autoRenew" class="tc-15-radio">启用            </label>            <label class="form-ctrl-label-stacked">              <input value="0" type="radio" name="renewItem" b-model="autoRenew" class="tc-15-radio">关闭（到期后，实例将自动回收，请谨慎选择）            </label>          </div>        </div>      </li>      <li b-if="autoRenew == \'1\'">        <div class="form-label">          <label for="">每月费用：</label>        </div>        <div class="form-input">          <div class="form-unit">            <span class="cost">              {{toI18nMoney(price ? price.discountPrice : \'-\', \'symbol\')}}                        </span>            <span b-if="price && (price.discountPrice < price.originalPrice)" class="ml-10 original-cost">               {{toI18nMoney(price ? price.originalPrice : \'-\',  \'symbol\')}}              </span>          </div>        </div>      </li>    </ul>  </div>'},l=function(){return[{key:"alias",name:"自动续费项",minWidth:100,tdTpl:'<div><p> {{item.uHostId}}</p><div><span class="text-overflow m-width">{{item.hostAlias ? item.hostAlias : "未命名"}}</span></div></div>'},{key:"renewFlag",name:"当前自动续费状态",width:130,tdTpl:'<div>{{item.renewFlag === "NOTIFY_AND_AUTO_RENEW" ? "启用": "关闭"}}</div>'},{key:"hostType",name:"实例类型",width:100,tdTpl:"<div>{{item.hostType}}</div>"},{key:"expiredTime",name:"到期时间",width:100},{key:"nextLine",name:"自动续费",width:110}]},m=d.extend({$tpl:k.main,toI18nMoney:a("widget/i18n").toI18nMoney,$afterInit:function(){var a=this;this.queryPrice(),this.$watch("autoRenew",function(){var b=a.autoRenew,c=a.$refs.grid,d={1:i.INSTANCERENEWFLAG.NOTIFY_AND_MANUAL_RENEW,0:i.INSTANCERENEWFLAG.NOTIFY_AND_AUTO_RENEW},e=[];c.list.map(function(a,f){d[b]==a.renewFlag&&e.push(a),c.updateItem(f,{autoRenew:b})}),this.$set("enableList",e),j.toggleBtnDisable({disable:!e.length,errTips:e.length?void 0:"无满足条件实例"})},!0)},toggleShowList:function(){this.$set("isShowList",!this.$get("isShowList"))},queryPrice:function(){var a=this,b=[],c=a.selectedItem[0].regionId||g.getRegionId();a.selectedItem.forEach(function(a){b.push(a.uHostId)});var d={hostIds:b,period:1,regionId:c};h.queryRenewCdhPrice(d,{camTipsType:"dialog"}).then(function(b){if(b.response&&b.response.price){var c=b.response.price&&b.response.price.hostPrice;a.$set("price",{originalPrice:c.originalPrice,discountPrice:c.discountPrice})}})["catch"](function(){a.$set("price",null)})},doAction:function(){var a="1"==this.$get("autoRenew")?"NOTIFY_AND_AUTO_RENEW":"NOTIFY_AND_MANUAL_RENEW",b=this.selectedItem[0].regionId,c=this.selectedItem.map(function(a){return a.hostId});return h.modifyCdh({hostIds:c,regionId:b,renewFlag:a},{camTipsType:"dialog"})}},{defaults:{enableList:[],isShowList:!0}});m.tag("host-gridview",f.extend({},{defaults:{showPagination:!1,showState:!1,canSelectTotal:!1,hasFirst:!1,maxHeight:150,minHeight:"auto",autoMaxHeight:!1,maxHeightOffset:10,colums:l(),getCellContent:function(a,b,c){if("expiredTime"==c.key)return"<div>"+g.formatDate(new Date(b.expiredTime),"yyyy-MM-dd")+"</div>";if("nextLine"==c.key){var d="";return d="1"==b.autoRenew?'<div class="text-warning">'+e.getNextDate(b.expiredTime,1)+"</div>":'<div class="text-warning">到期不续费</div>'}}}})),c.exports=m}),define("cvm/cdh/dialog/boot",function(a,b,c){var d=a("$"),e=a("qccomponent"),f=(a("manager"),a("dialog"),a("cvm/cdh/taskchecker")),g=a("cvm/common/model"),h={main:'  <div>    <div class="act-outline" id="selectedShowWrap">      <div class="act-summary">您已选        <strong  >{{selectedItems.length}}台实例</strong>        <span b-if="unAbleNum">，其中          <strong  >{{unAbleNum}}台实例</strong>将不能</span>        执行开机操作，        <a href="javascript:;" b-on-click="toggleList()">{{toggleTip ? toggleTip : \'查看详情\'}}          <i id="selectedShowIconArr" class="blue-down-icon"></i>        </a>      </div>      <div class="act-details" style="display:block" id="listDetail">        <table class="act-details-tb">          <tbody>            <tr>              <td>No.</td>              <td>                <span class="entity-name dev-bold" title="实例名">实例名</span>              </td>              <td>                <span class="entity-name dev-bold" title="实例ID">实例ID</span>              </td>              <td>                <span class="entity-name dev-bold" title="当前带宽上限">当前带宽上限</span>              </td>              <td>                <span class="act-result dev-bold">操作</span>              </td>            </tr>          </tbody>        </table>        <table class="act-details-tb">          <tbody>                <tr b-repeat="item in selectedItems">                    <td> {{$index}} </td>                    <td>                        <span class="entity-name" title="{{item.uInstanceId}}">{{item.alias}}</span>                    </td>                    <td>                        <span class="entity-name" title="{{item.uInstanceId}}">                            <a data-event="nav" href="/cvm/detail/{{item.regionId}}/{{item.uInstanceId}}?backfrom=cvmdetail"> {{item.uInstanceId}} </a>                        </span>                    </td>                    <td>                        <span class="entity-name entity-name2" title="{{item.bandwidthInfo}}">{{item.bandwidthInfo}} </span>                    </td>                    <td>                        <span class="{{item[\'opsAvailable\'][\'BOOT\'] ? \'act-result\' : \'act-result cdh-color-org\'}}">{{item[\'opsAvailable\'][\'BOOT\'] ? \'可开机\' : \'关机状态的实例才可开机\'}}</span>                    </td>                </tr>            </tbody>        </table>      </div>    </div>    <div class="coin-alert">      <table class="ui-popmsg">        <tbody>          <tr>            <td height="72" class="t">              <span class="info">                <span class="tit">确定选中实例进行开机？</span>                <br>              </span>            </td>          </tr>        </tbody>      </table>    </div>  </div>'},i=e.extend({$tpl:h.main,$beforeInit:function(){var a=this,b="开机",c=[],d=[],e={actionName:b,hasPermItems:[],noPermItems:[]};a.selectedItems.forEach(function(a){a.opsAvailable.BOOT?(c.push(a),e.hasPermItems.push({name:a.alias})):(d.push(a),e.noPermItems.push({name:a.alias,reason:"关闭中的实例才可以执行开机操作"}))});var f={hasPermItems:c,noPermItems:d,selectedShowOptions:e};a.permResult=f,a.ableList=c;var g=a.selectedItems.length-c.length;g>0&&a.$set("unAbleNum",g)},$afterInit:function(){},doAction:function(a,b){for(var c,d=this,e=[],h=0;c=d.ableList[h];h++)e.push(c.uInstanceId);e.length&&g.apiRequest({regionId:d.ableList[0].regionId,serviceType:"cvm",action:"StartInstances",data:{InstanceIds:e}},{camTipsType:"dialog"}).then(function(a){var c={permResult:d.permResult,selectedItems:d.selectedItems,listIns:b,gridView:b.grid,cvmListEl:b.listEl};f.checkTask(a.response,"开机中",c)})["catch"](function(a){console.warn(a)}),a.hide()},toggleList:function(){var a=d("#listDetail"),b=d("#selectedShowIconArr");a.toggle(),a.is(":visible")?(b.removeClass("blue-down-icon").addClass("blue-up-icon"),this.$set("toggleTip","查看详情")):(b.removeClass("blue-up-icon").addClass("blue-down-icon"),this.$set("toggleTip","查看详情"))}});c.exports=i}),define("cvm/cdh/dialog/cdhchart",function(a,b,c){a("Highcharts");var d=a("$"),e=(a("pageManager"),a("appUtil")),f=a("qccomponent"),g={main:'    <div class="mb20 chart-grid">        <h4 class="chart-title">{{chartTitle}}<span class="text-unit">{{chartUnit ? \'(单位：\'+chartUnit+\')\' : \'\'}}</span></h4>        <div b-if="!noData" data-mod="chart" style="height: 250px">        </div>        <div class="mb20 chart-grid" b-if="noData" style="height: 250px;">            <span >{{loading ? \'加载中...\' : \'没有数据\'}}</span>        </div>    </div>'},h={loading:{style:{backgroundColor:"white"},labelStyle:{color:"silver"}},chart:{zoomType:"x"},title:{text:""},yAxis:[{title:{text:""},lineWidth:1,tickPixelInterval:45,min:0,labels:{style:{fontSize:"12px"}}}],plotOptions:{},credits:{enabled:!1},legend:{enabled:!1},tooltip:{shared:!0}};c.exports=f.extend({$tpl:g.main,$valuekey:"data",$afterInit:function(){var a=this;a.$chart=d(a.$el).find('[data-mod="chart"]');var b=function(){if(a.data)a.data.multi?a.showMultiChart():a.showChart();else{var b=a.$chart.highcharts();b||(a.$chart.highcharts(h),b=a.$chart.highcharts()),b.showLoading()}};a.$watch("data",b,!0)},showChart:function(){var a,b=this,c=b.data,f=c.dayView,g=!0,i=b.$chart,j={xAxis:{type:"datetime",dateTimeLabelFormats:{hour:"%H:%M"},tickPixelInterval:80,title:{text:""}}};if(c.y&&c.y.length){d.extend(j,h);var k=c.yUnit||"",l=c.unit||"";j.yAxis=[{title:{text:""},lineWidth:1,tickPixelInterval:45,min:0,labels:{format:"{value}"+k,style:{fontSize:"12px"}}}],a=e.cgwTimeParse(c.x[0]),j.series=[{pointStart:a.getTime()-6e4*a.getTimezoneOffset(),data:c.y}],f?(j.series[0].pointInterval=864e5,j.series[0].color="#ff7a22",j.xAxis.dateTimeLabelFormats.day="%m-%d",j.xAxis.dateTimeLabelFormats.week="%m-%d",j.tooltip.formatter=function(){var a=new Date(this.x);return a=new Date(a.getTime()+6e4*a.getTimezoneOffset()),[e.formatDate(a,"MM-dd")," ","<b>",this.y,l,"</b>"].join("")}):(j.series[0].pointInterval=3e5,j.series[0].type="spline",j.series[0].color="#ff7a22",j.xAxis.dateTimeLabelFormats.day="%H:%M",j.xAxis.maxZoom=36e5,j.tooltip.formatter=function(){var a=new Date(this.x);return a=new Date(a.getTime()+6e4*a.getTimezoneOffset()),[e.formatDate(a,"hh:mm")," ","<b>",this.y,l,"</b>"].join("")}),i.highcharts(j),g=!1}var m=b.data.loading;b.$set("loading",m),b.$set("noData",g),b.$chart.highcharts()&&!m&&b.$chart.highcharts().hideLoading(),d(window).resize()},showMultiChart:function(){var a,b=this,c=b.data,f=c.dayView,g=!0,i=b.$chart,j={xAxis:{type:"datetime",dateTimeLabelFormats:{hour:"%H:%M"},tickPixelInterval:80,title:{text:""}}};if(c.list&&c.list.length){d.extend(j,h),a=e.cgwTimeParse(c.x[0]);var k=a.getTime()-6e4*a.getTimezoneOffset(),l=c.yUnit||"";j.yAxis=[{title:{text:""},lineWidth:1,tickPixelInterval:45,min:0,labels:{format:"{value}"+l,style:{fontSize:"12px"}}}],j.legend={layout:"vertical",align:"left",x:100,verticalAlign:"top",y:20,floating:!0,backgroundColor:"#FFFFFF"},j.series=[],c.list.forEach(function(a,b){a.y&&a.y.length&&(j.series.push({pointStart:k,data:a.y}),f?(j.series[b].pointInterval=864e5,j.series[b].name=c.chartOpt.name[b],j.series[b].color=c.chartOpt.color[b],j.xAxis.dateTimeLabelFormats.day="%m-%d",j.xAxis.dateTimeLabelFormats.week="%m-%d",j.tooltip.formatter=function(){var a=new Date(this.x);a=new Date(a.getTime()+6e4*a.getTimezoneOffset());var b=[e.formatDate(a,"yyyy-MM-dd")," <br>",this.points[0].series.name,"  ","<b>",this.points[0].y,c.chartOpt.units[0],"</b>","<br>",this.points[1].series.name,"  ","<b>",this.points[1].y,c.chartOpt.units[1],"</b>"];return b.join("")}):(j.series[b].pointInterval=3e5,j.series[b].type="spline",j.series[b].name=c.chartOpt.name[b],j.series[b].color=c.chartOpt.color[b],j.xAxis.dateTimeLabelFormats.day="%H:%M",j.xAxis.maxZoom=36e5,j.tooltip.formatter=function(){var a=new Date(this.x);a=new Date(a.getTime()+6e4*a.getTimezoneOffset());var b=[e.formatDate(a,"hh:mm")," <br>",this.points[0].series.name,"  ","<b>",this.points[0].y,c.chartOpt.units[0],"</b>","<br>",this.points[1].series.name,"  ","<b>",this.points[1].y,c.chartOpt.units[1],"</b>"];return b.join("")}),g=!1)}),i.highcharts(j)}b.$set("noData",g),b.$chart.highcharts()&&b.$chart.highcharts().hideLoading(),d(window).resize()}})}),define("cvm/cdh/dialog/destroy",function(a,b,c){var d=a("$"),e=a("qccomponent"),f=(a("widget/pills/pills"),a("dialog")),g=a("cvm/cdh/taskchecker"),h=(a("appUtil"),a("cvm/common/model")),i={main:'  <div>    <div class="act-outline" id="selectedShowWrap">      <div class="act-summary">您已选        <strong>{{selectedItems.length}}台实例</strong>        <span b-if="unAbleNum">，其中          <strong>{{unAbleNum}}台实例</strong>将不能</span>        执行销毁操作，        <a href="javascript:;" b-on-click="toggleList()">{{toggleTip ? toggleTip : \'查看详情\'}}          <i id="selectedShowIconArr" class="blue-down-icon"></i>        </a>      </div>      <div class="act-details" style="display:block" id="listDetail">        <table class="act-details-tb">          <tbody>            <tr>              <td>No.</td>              <td>                <span class="entity-name dev-bold">实例名</span>              </td>              <td>                <span class="entity-name dev-bold">实例ID</span>              </td>              <td>                <span class="entity-name dev-bold">当前带宽上限</span>              </td>              <td>                <span class="act-result dev-bold">操作</span>              </td>            </tr>          </tbody>        </table>        <table class="act-details-tb">          <tbody>            <tr b-repeat="item in selectedItems">              <td> {{$index+1}} </td>              <td>                <span class="entity-name" title="{{item.uInstanceId}}">{{item.alias}}</span>              </td>              <td>                <span class="entity-name" title="{{item.uInstanceId}}">                  <a data-event="nav" href="/cvm/detail/{{item.regionId}}/{{item.uInstanceId}}?backfrom=cvmdetail">                    {{item.uInstanceId}} </a>                </span>              </td>              <td>                <span class="entity-name entity-name2" title="{{item.bandwidthInfo}}">{{item.bandwidthInfo}} </span>              </td>              <td>                <span class="{{item.uHostId ? \'act-result\' : \'act-result cdh-color-org\'}}">{{item.uHostId ? \'可销毁\' :                  \'独享型的机器才可以执行销毁操作\'}} </span>              </td>            </tr>          </tbody>        </table>      </div>    </div>    <div class="coin-alert">      <table class="ui-popmsg">        <tbody>          <tr>            <td height="72" class="t">              <span class="info">                <span class="tit">销毁选中的实例？</span>                <br>                <div class="tc-15-msg mt15">                  销毁后所有数据将被清除且不可恢复，请提前备份数据。                </div>              </span>            </td>          </tr>        </tbody>      </table>    </div>  </div>',
tips:'  <div>    <div class="coin-alert">      <table class="ui-popmsg">        <tbody>          <tr>            <td height="72" class="t">              <span class="info">                <span class="tit">无法销毁您选择的机器!</span>                <br>                <div class="tc-15-msg mt15">                  销毁前需要解绑该机器上的lb负载均衡，否则不能进行销毁。请解绑要销毁设备上的lb负载均衡再执行销毁操作。                </div>              </span>            </td>          </tr>        </tbody>      </table>    </div>  </div>',common:'  <div>    <div class="coin-alert">      <table class="ui-popmsg">        <tbody>          <tr>            <td height="72" class="t">              <span class="info">                <span class="tit">操作失败!</span>                <br>                <div class="tc-15-msg mt15">                  销毁实例失败，请稍后重试。                </div>              </span>            </td>          </tr>        </tbody>      </table>    </div>  </div>'},j=e.extend({$tpl:i.main,$afterInit:function(){var a=this,b="销毁",c=[],d=[],e={actionName:b,hasPermItems:[],noPermItems:[]};a.selectedItems.forEach(function(a){a.uHostId?(c.push(a),e.hasPermItems.push({name:a.alias})):(d.push(a),e.noPermItems.push({name:a.alias,reason:"独享型的实例才可以执行销毁操作"}))});var f={hasPermItems:c,noPermItems:d,selectedShowOptions:e};a.permResult=f,a.ableList=c;var g=a.selectedItems.length-c.length;g>0&&a.$set("unAbleNum",g)},doAction:function(a,b,c){for(var d,e=[],f=this,i=0;d=f.ableList[i];i++)e.push(d.uInstanceId);e.length>0&&h.apiRequest({regionId:f.ableList[0].regionId,serviceType:"cvm",action:"TerminateInstances",data:{InstanceIds:e,ReleaseAddress:!1}},{camTipsType:"dialog"}).then(function(a){if(b){var d={permResult:f.permResult,selectedItems:f.selectedItems,listIns:b,gridView:b.grid,cvmListEl:b.listEl,refreshParent:!0};g.checkTask({taskId:a.response.taskId},"销毁中",d)}else c&&c(a)})["catch"](function(a){console.warn(a)}),a.hide()},showIsolateLb:function(){f.create(i.tips,"600","",{title:"销毁实例失败","class":"dialog_layer_v2 tc-15-rich-dialog",preventResubmit:!0,button:{"确定":function(a){f.hide()}}})},showCommonError:function(){f.create(i.common,"600","",{title:"销毁实例失败","class":"dialog_layer_v2 tc-15-rich-dialog",preventResubmit:!0,button:{"确定":function(a){f.hide()}}})},toggleList:function(){var a=d("#listDetail"),b=d("#selectedShowIconArr");a.toggle(),a.is(":visible")?(b.removeClass("blue-down-icon").addClass("blue-up-icon"),this.$set("toggleTip","查看详情")):(b.removeClass("blue-up-icon").addClass("blue-down-icon"),this.$set("toggleTip","查看详情"))}});c.exports=j}),define("cvm/cdh/dialog/edit",function(a,b,c){var d=a("$"),e=a("qccomponent"),f=(a("manager"),a("dialog")),g=a("tips"),h=(a("cvm/cdh/taskchecker"),a("cvm/common/model")),i={main:'  <div>    <div class="act-outline" id="selectedShowWrap">      <div class="act-summary">您已选        <strong >{{selectedItems.length}}台实例</strong>        <span b-if="unAbleNum">，其中          <strong  >{{unAbleNum}}台实例</strong>将不能</span>        执行开机操作，        <a href="javascript:;" b-on-click="toggleList()">{{toggleTip ? toggleTip : \'查看详情\'}}          <i id="selectedShowIconArr" class="blue-down-icon"></i>        </a>      </div>      <div class="act-details" style="display:block" id="listDetail">        <table class="act-details-tb">          <tbody>            <tr>              <td>No.</td>              <td>                <span class="entity-name dev-bold">实例名</span>              </td>              <td>                <span class="entity-name dev-bold">实例ID</span>              </td>              <td>                <span class="entity-name dev-bold">当前带宽上限</span>              </td>              <td>                <span class="act-result dev-bold">操作</span>              </td>            </tr>          </tbody>        </table>        <table class="act-details-tb">          <tbody>            <tr b-repeat="item in selectedItems">              <td> {{$index}} </td>              <td>                <span class="entity-name" title="{{item.uInstanceId}}">{{item.alias}}</span>              </td>              <td>                <span class="entity-name" title="{{item.uInstanceId}}">                  <a data-event="nav" href="/cvm/detail/{{item.regionId}}/{{item.uInstanceId}}?backfrom=cvmdetail"> {{item.uInstanceId}} </a>                </span>              </td>              <td>                <span class="entity-name entity-name2" title="{{item.bandwidthInfo}}">{{item.bandwidthInfo}} </span>              </td>              <td>                <span class="{{item[\'opsAvailable\'][\'RENAME\'] ? \'act-result\' : \'act-result cdh-color-org\'}}">{{item[\'opsAvailable\'][\'RENAME\'] ? \'可改名\' : \'当前状态不可改名\'}}</span>              </td>            </tr>          </tbody>        </table>      </div>    </div>    <div class="edit_form_wrap">      <ul class="edit_psword">        <li>          <label class="txt">新实例名称:</label>          <input class="txt_input" style="width:260px" id="aliasIpt" data-lenLimit="60" maxlength="60" relTipId="nameTip" type="text"          />          <p class="tip" id="nameTip"></p>        </li>        <!--<li class="mod">                <input type="checkbox" class="tc-15-checkbox" checked />                <span class="msg">批量改名时，自动添加序号</span>            </li>-->      </ul>    </div>  </div>'},j=e.extend({$tpl:i.main,$beforeInit:function(){var a=this,b="改名",c=[],d=[],e={actionName:b,hasPermItems:[],noPermItems:[]};a.selectedItems.forEach(function(a){a.opsAvailable.RENAME&&(c.push(a),e.hasPermItems.push({name:a.alias}))});var f={hasPermItems:c,noPermItems:d,selectedShowOptions:e};a.permResult=f,a.ableList=c;var g=a.selectedItems.length-c.length;g>0&&a.$set("unAbleNum",g)},$afterInit:function(){},doAction:function(a,b){for(var c,e=this,i=[],j=0;c=e.ableList[j];j++)i.push(c.uInstanceId);var k=d.trim(f.el.find('input[type="text"]').val());i.length&&h.apiRequest({regionId:e.ableList[0].regionId,serviceType:"cvm",action:"ModifyInstancesAttribute",data:{InstanceIds:i,InstanceName:k}},{camTipsType:"dialog"}).then(function(c){a.hide(),b.refresh(),g.success("修改成功")})["catch"](function(a){console.warn(a)}),a.hide()},toggleList:function(){var a=d("#listDetail"),b=d("#selectedShowIconArr");a.toggle(),a.is(":visible")?(b.removeClass("blue-down-icon").addClass("blue-up-icon"),this.$set("toggleTip","查看详情")):(b.removeClass("blue-up-icon").addClass("blue-down-icon"),this.$set("toggleTip","查看详情"))}});c.exports=j}),define("cvm/cdh/dialog/export",function(a,b,c){function d(a,b){function c(b){if(!(Date.now()-d>12e4)){var f="//"+l+"/cgi/cdh?action=exportPoll&regionId="+a.regionId+"&t"+Date.now();j.request(f,{data:e.extend(a,{Version:"2017-03-12"})}).then(function(a){"DONE"==a.status?b&&b():setTimeout(function(){c(b)},5e3)})["catch"](function(){setTimeout(function(){c(b)},5e3)})}}var d=Date.now();a.rk=[f.getUin(),(new Date).getTime(),Math.round(1e4*Math.random())].join("-");var g,h=f.objectToParams(a);b?c(function(){g="//"+l+"/cgi/cdh?action=downloadCdh&"+h,location.href=g}):(g="//"+l+"/cgi/cdh?action=exportCdh&"+h,location.href=g)}var e=a("$"),f=a("util"),g=a("appUtil"),h=a("dialog"),i=a("cvm/cvm/event/export/export"),j=a("models/iaas"),k=a("tips"),l=location.hostname.indexOf("cloud.tencent.com")>-1?"iaas.cloud.tencent.com":"iaas.qcloud.com",m=function(a){this.expired=a&&a.isFromRecycle||"",this.listIns=a&&a.listIns||null};m.prototype.exportChildList=function(a,b){var c=new i({listIns:b,selectedItems:a,hostId:b.hostId});c.exec()},m.prototype.exec=function(){this.showDialog()},m.prototype["export"]=function(a){var b=this.listIns.isAsyncExport,c=void 0;switch(a){case"filter":c=Object.assign({},this.listIns.queryInstanceParams);break;case"selected":var e=this.listIns.gridView&&this.listIns.gridView.getSelected();if(!e.length)return k.error("未选中实例"),!0;c=Object.assign({},this.listIns.queryInstanceParams,{Filters:[{Name:"host-id",Values:e.map(function(a){return a.hostId})}]});break;default:c=Object.assign({},this.listIns.queryInstanceParams,{Filters:[]})}var h={t:(new Date).getTime(),uin:f.getUin(),csrfCode:f.getACSRFToken(),projectId:g.getProjectId(),regionId:c.regionId||g.getRegionId(),qip:JSON.stringify(c),expired:this.expired};d(h,b)},m.prototype.showDialog=function(){var a=this;h.create(f.tmpl('  <ul class="form-list">    <li class="pure-text-row">      <div class="form-label">        <label>导出范围</label>      </div>      <div class="form-input">        <div class="form-unit">          <label class="form-ctrl-label-stacked">            <input type="radio" class="tc-15-radio" name="exportType" value="all" checked>            导出全部实例          </label>          <label class="form-ctrl-label-stacked">            <input type="radio" class="tc-15-radio" name="exportType" value="filter">            仅导出搜索结果          </label>          <label class="form-ctrl-label-stacked">            <input type="radio" class="tc-15-radio" name="exportType" value="selected">            仅导出选中实例          </label>        </div>      </div>    </li>  </ul>'),540,null,{title:"导出实例",preventResubmit:!0,button:{"确定":function(){var b=h.el.find('input[type="radio"]:checked'),c=b.val()||"all",d=a["export"](c);d?h.toggleBtnDisable(!1,0):h.hide()}}})},c.exports=m}),define("cvm/cdh/dialog/modifyVCPU",function(a,b,c){function d(){return Promise.resolve([1,1.25,1.5,1.75,2,2.25,2.5,2.75,3])}var e=(a("$"),a("qccomponent")),f=(a("manager"),e.getComponent("grid-view"),a("appUtil"),a("cvm/cdh/data")),g=(a("cvm/common/constants"),a("dialog")),h={main:'  <div>    <div class="act-outline">      <p class="mb-10 mt-10">        已选<strong          ><span>{{ selectedItems.length }}</span          >台专用宿主机</strong        >,        <a href="javascript:;" b-on-click="toggleShowSelectedDetail()">          查看详情 <i b-if="!showSelectedDetail" class="blue-down-icon"></i>          <i b-if="showSelectedDetail" class="blue-up-icon"></i>        </a>      </p>      <div b-if="showSelectedDetail" class="mb-20">        <div class="tc-15-table-panel">          <div class="tc-15-table-fixed-head">            <table class="tc-15-table-box">              <colgroup>                <col style="width: 45px;" />                <col />                <col style="width: 120px;" />                <col />                <col />              </colgroup>              <thead>                <tr>                  <th>                    <div><span class="text-overflow">NO</span></div>                  </th>                  <th>                    <div><span class="text-overflow">宿主机名称</span></div>                  </th>                  <th>                    <div><span class="text-overflow">宿主机ID</span></div>                  </th>                  <th>                    <div><span class="text-overflow">当前vCPU数量</span></div>                  </th>                  <th>                    <div><span class="text-overflow">可用区</span></div>                  </th>                </tr>              </thead>            </table>          </div>          <div            class="tc-15-table-fixed-body tc-scroll"            style="max-height: 140px;"          >            <table class="tc-15-table-box tc-15-table-rowhover">              <colgroup>                <col style="width: 45px;" />                <col />                <col style="width: 120px;" />                <col />                <col />              </colgroup>              <tbody>                <tr b-repeat="selectedItem in selectedItems">                  <td>                    <span class="text">{{ $index + 1 }}</span>                  </td>                  <td>                    <div>                      <p>                        <span                          class="text-overflow"                          title="{{ selectedItem.hostName }}"                          >{{ selectedItem.hostName }}</span                        >                      </p>                    </div>                  </td>                  <td>                    <div>                      <span                        class="text-overflow"                        title="{{ selectedItem.hostId }}"                        >{{ selectedItem.hostId }}</span                      >                    </div>                  </td>                  <td>                    <div>                      <span class="text-overflow">{{                        selectedItem.cpuTotal                      }}</span>                    </div>                  </td>                  <td>                    <div>                      <span class="text-overflow">{{                        selectedItem.zoneName                      }}</span>                    </div>                  </td>                </tr>              </tbody>            </table>          </div>        </div>      </div>    </div>    <div class="form-wrap">      <ul class="form-list">        <li class="pure-text-row">          <div class="form-label"><label>该机型CPU数量</label></div>          <div class="form-input">            <div class="form-unit">              <p class="form-text">                {{                  selectedItems.length ? selectedItems[0].cpuOrigin : \'-\'                }}                核/台              </p>            </div>          </div>        </li>        <li>          <div class="form-label"><label>目标vCPU数量</label></div>          <div class="form-input">            <qc-segment              list="{{ targetVCPUNumberList }}"              b-model="selectedVCPUMultiple"            ></qc-segment>          </div>        </li>      </ul>      <p class="mt-20">        <label class="form-ctrl-label"          ><input            type="checkbox"            class="tc-15-checkbox"            b-model="agreeRule"          />已知悉调整vCPU数量将影响专用宿主机资源共享的粒度</label        >      </p>    </div>  </div>'},i=e.extend({$tpl:h.main,$afterInit:function(){this.setHostVCPUMultiples(),this.$watch("[selectedVCPUMultiple, agreeRule]",function(){this.selectedVCPUMultiple.length&&this.agreeRule?g.toggleBtnDisable(!1):g.toggleBtnDisable(!0)},!0)},toggleShowSelectedDetail:function(){this.$set("showSelectedDetail",!this.$get("showSelectedDetail"))},setHostVCPUMultiples:function(){var a=this,b=a.selectedItems;b.length&&d().then(function(){var c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],d=c.map(function(a,c){return{label:b[0].cpuOrigin*a,value:a,$checked:0==c}});a.$set({targetVCPUNumberList:d,selectedVCPUMultiple:d.filter(function(a){return a.$checked})})})},doAction:function(){var a=this.selectedItems,b=void 0===a?[]:a,c=this.selectedVCPUMultiple,d=void 0===c?[]:c;return b.length&&d.length?f.modifyCdh({hostIds:b.map(function(a){return a.hostId}),vCPUMultiple:d[0].value}):Promise.reject()}},{defaults:{showSelectedDetail:!0,targetVCPUNumberList:[],selectedVCPUMultiple:[],agreeRule:!1}});c.exports=i}),define("cvm/cdh/dialog/reboot",function(a,b,c){var d=a("$"),e=a("qccomponent"),f=(a("widget/pills/pills"),a("dialog"),a("manager"),a("cvm/cdh/taskchecker")),g=a("cvm/common/model"),h={main:'    <div>        <div class="act-outline" id="selectedShowWrap">            <div class="act-summary">您已选<strong  >{{selectedItems.length}}台实例</strong>                <span b-if="unAbleNum">，其中<strong  >{{unAbleNum}}台实例</strong>将不能</span>                执行重启操作，                <a href="javascript:;" b-on-click="toggleList()">{{toggleTip ? toggleTip : \'查看详情\'}}<i id="selectedShowIconArr" class="blue-down-icon"></i></a></div>            <div class="act-details" style="display:block" id="listDetail">                    <table class="act-details-tb">                      <tbody>                        <tr>                          <td>No.</td>                          <td>                            <span class="entity-name dev-bold">实例名</span>                          </td>                          <td>                            <span class="entity-name dev-bold">实例ID</span>                          </td>                          <td>                            <span class="entity-name dev-bold">当前带宽上限</span>                          </td>                          <td>                            <span class="act-result dev-bold">操作</span>                          </td>                        </tr>                      </tbody>                    </table>                    <table class="act-details-tb">                      <tbody>                        <tr b-repeat="item in selectedItems">                          <td> {{$index}} </td>                          <td>                            <span class="entity-name" title="{{item.uInstanceId}}">{{item.alias}}</span>                          </td>                          <td>                            <span class="entity-name" title="{{item.uInstanceId}}">                              <a data-event="nav" href="/cvm/detail/{{item.regionId}}/{{item.uInstanceId}}?backfrom=cvmdetail"> {{item.uInstanceId}} </a>                            </span>                          </td>                          <td>                            <span class="entity-name entity-name2" title="{{item.bandwidthInfo}}">{{item.bandwidthInfo}} </span>                          </td>                          <td>                                <span class="{{item[\'opsAvailable\'][\'REBOOT\'] ? \'act-result\' : \'act-result cdh-color-org\'}}">{{item[\'opsAvailable\'][\'REBOOT\'] ? \'可重启\' : \'运行中的实例才可重启\'}} </span>                          </td>                        </tr>                      </tbody>                    </table>                  </div>        </div>        <div class="coin-alert">            <table class="ui-popmsg">                <tbody>                <tr>                    <td height="72" class="t">                                    <span class="info">                                        <span class="tit">确定选中实例进行重启？</span><br>                                            <label>                                                重启期间，实例将无法正常提供服务，请您做好准备，以免造成影响                                            </label>                                            <label class="confirm-it">                                                <input type="checkbox" class="tc-15-checkbox" id="rebootConfirmCheck">强制重启</a>                                            </label>                                            <div class="tc-15-msg" style="margin:10px 10px 10px 0">强制重启的效果等同于关闭计算机的电源后再接入电源启动。强制重启可能会导致实例数据丢失或者文件系统损坏，请仅在实例无法正常重启的情况下使用。    </div>                                        </span>                    </td>                </tr>                </tbody>            </table>        </div>    </div>'},i=e.extend({$tpl:h.main,$beforeInit:function(){var a=this,b="重启",c=[],d=[],e={actionName:b,hasPermItems:[],noPermItems:[]};a.selectedItems.forEach(function(a){a.opsAvailable.REBOOT?(c.push(a),e.hasPermItems.push({name:a.alias})):(d.push(a),e.noPermItems.push({name:a.alias,reason:"运行中的主机才可以执行重启操作"}))});var f={hasPermItems:c,noPermItems:d,selectedShowOptions:e};a.permResult=f,a.ableList=c;var g=a.selectedItems.length-c.length;g>0&&a.$set("unAbleNum",g)},$afterInit:function(){},doAction:function(a,b){for(var c,e=this,h=d("#rebootConfirmCheck").prop("checked")?"HARD":"SOFT_FIRST",i=[],j=0;c=e.ableList[j];j++)i.push(c.uInstanceId);i.length&&g.apiRequest({regionId:e.ableList[0].regionId,serviceType:"cvm",action:"RebootInstances",data:{InstanceIds:i,StopType:h}},{camTipsType:"dialog"}).then(function(a){var c={permResult:e.permResult,selectedItems:e.selectedItems,listIns:b,gridView:b.grid,cvmListEl:b.listEl};f.checkTask(a.response,"重启中",c)})["catch"](function(a){console.warn(a)}),a.hide()},toggleList:function(){var a=d("#listDetail"),b=d("#selectedShowIconArr");a.toggle(),a.is(":visible")?(b.removeClass("blue-down-icon").addClass("blue-up-icon"),this.$set("toggleTip","查看详情")):(b.removeClass("blue-up-icon").addClass("blue-down-icon"),this.$set("toggleTip","查看详情"))}});c.exports=i}),define("cvm/cdh/dialog/rename",function(a,b,c){var d=a("$"),e=a("qccomponent"),f=(a("models/cdh"),a("dialog"),a("appUtil")),g=a("cvm/cdh/data"),h={main:'    <div>        <div class="act-outline" id="selectedShowWrap">            <div class="act-summary">下列实例<strong  >（共{{selectedItem.length}}台）</strong>将进行改名操作，<a href="javascript:;" b-on-click="toggleList()">{{toggleTip ? toggleTip : \'查看详情\'}}<i id="selectedShowIconArr" class="blue-down-icon"></i></a></div>            <div class="tc-15-table-panel mt15" style="display:block" id="listDetail">                <div class="tc-15-table-fixed-head">                    <table class="tc-15-table-box">                        <colgroup>                            <col>                            <col>                        </colgroup>                        <thead>                        <tr>                            <th>                                <div><span>ID</span></div>                            </th>                            <th>                                <div><span>宿主机名</span></div>                            </th>                        </tr>                        </thead>                    </table>                </div>                <div class="tc-15-table-fixed-body" style="min-width:inherit;max-height:225px;">                    <table class="tc-15-table-box tc-15-table-rowhover">                        <colgroup>                            <col>                            <col>                        </colgroup>                        <tbody>                        <tr b-repeat="item in selectedItem">                            <td><div>{{item.uHostId}}</div></td>                            <td><div>{{item.hostAlias ? item.hostAlias : \'未命名\'}}</div></td>                        </tr>                        </tbody>                    </table>                </div>            </div>        </div>        <div class="form-wrap">            <ul class="form-list">                <li>                    <div class="form-label"><label>新宿主机名称:</label></div>                    <div class="form-input">                        <div class="tc-15-input-text-wrap m">                            <input maxlength="60" type="text" class="tc-15-input-text" b-model="newName">                            <div class="tc-15-input-tips">你还可以输入{{60-newName.length}}个字符</div>                        </div>                    </div>                </li>            </ul>            <!--             <ul class="edit_psword">            <li>                <label class="txt">新母机名称:</label>                <input class="txt_input" style="width:260px" id="aliasIpt2" data-lenLimit="60" maxlength="60" relTipId="nameTip" type="text"/>                <p class="tip" id="nameTip2"></p>            </li>        </ul>             -->        </div>    </div>'},i=e.extend({$tpl:h.main,$afterInit:function(){},doAction:function(a,b){var c=this,d=[],e=this.selectedItem[0].regionId||f.getRegionId();if(this.selectedItem.forEach(function(a){c.newName!=a.hostAlias&&d.push(a.uHostId)}),!d||0==d.length)return void a.hide();var h=({alias:c.newName,uHostIdList:d,regionId:f.getRegionId()},{hostIds:d,hostName:c.newName,regionId:e});g.modifyCdh(h,{camTipsType:"dialog"}).then(function(d){d.errors||(b(c.newName),a.hide())})},toggleList:function(){var a=d("#listDetail"),b=d("#selectedShowIconArr");a.toggle(),a.is(":visible")?(b.removeClass("blue-down-icon").addClass("blue-up-icon"),this.$set("toggleTip","查看详情")):(b.removeClass("blue-up-icon").addClass("blue-down-icon"),this.$set("toggleTip","查看详情"))}});c.exports=i}),define("cvm/cdh/dialog/renew",function(a,b,c){var d=a("$"),e=a("qccomponent"),f=a("appUtil"),g=(a("cvm/cdh/cdhconfig"),a("cvm/cdh/data")),h={main:'    <div>        <div class="act-outline" id="selectedShowWrap">            <div class="act-summary">下列实例<strong  >（共{{selectedItem.length}}台）</strong>将进行续费操作，<a href="javascript:;" b-on-click="toggleList()">{{toggleTip ? toggleTip : \'查看详情\'}}<i id="selectedShowIconArr" class="blue-down-icon"></i></a></div>            <div class="tc-15-table-panel mt15" style="display:block" id="listDetail">                <div class="tc-15-table-fixed-head">                    <table class="tc-15-table-box">                        <colgroup>                            <col>                            <col>                            <col>                        </colgroup>                        <thead>                        <tr>                            <th>                                <div><span>ID/宿主名</span></div>                            </th>                            <th>                                <div><span>到期时间</span></div>                            </th>                            <th>                                <div><span>续费后到期时间</span></div>                            </th>                        </tr>                        </thead>                    </table>                </div>                <div class="tc-15-table-fixed-body" style="min-width:inherit;max-height:225px;">                    <table class="tc-15-table-box tc-15-table-rowhover">                        <colgroup>                            <col>                            <col>                            <col>                        </colgroup>                        <tbody>                        <tr b-repeat="item in selectedItem">                            <td class="text-left">                                <div>                                    <div class="id-name-cell">                                        <p> {{item.uHostId}}</p>                                        <div>                                                  <span class="text-overflow m-width" title="">                                                  {{item.hostAlias ? item.hostAlias : \'未命名\'}}                                                  </span>                                        </div>                                    </div>                                </div>                            </td>                            <td>                                <div b-if="item.expiredTimeDesc">{{item.expiredTimeDesc.substring(0, 10)}}</div>                            </td>                            <td>                                <div  >{{newDeadlines ? newDeadlines[selectedItem.indexOf(item)] : \'--\'}}</div>                            </td>                        </tr>                        </tbody>                    </table>                </div>            </div>        </div>        <div class="form-wrap">            <ul class="form-list">                <li>                    <div class="form-label"><label>续费时长</label></div>                    <div class="form-input">                                <span class="item-descr-txt">                                    <ul>                                        <li>                                            <div class="tc-15-rich-radio" role="radiogroup">                                                <button b-repeat="time in timeList" class="{{time.value == curSelected ?                                                       time.value == timeList[0].value ? \'tc-15-btn first checked m\' :                                                       time.value == timeList[timeList.length - 1].value ? \'tc-15-btn last checked m\' :                                                       \'tc-15-btn checked m\'                                                       :                                                       time.value == timeList[0].value ? \'tc-15-btn first m\' :                                                       time.value == timeList[timeList.length - 1].value ? \'tc-15-btn last m\' :                                                       \'tc-15-btn m\'}}" role="radio" b-on-click="setCurrent(time.value)">{{time.value == curSelected ? time.full : time.text}}                                                       <i b-if="time.ico" class="{{time.ico}}">{{time.iconVal}}</i>                                                </button>                                            </div>                                        </li>                                    </ul>                                </span>                    </div>                </li>                <li>                    <div class="form-label"><label>需支付费用</label></div>                    <div class="form-input">                        <span class="cost">  <strong>{{totalPrice > 0 ? totalPrice : \'-\'}}</strong> 元 </span>                        <span b-if="originalPrice" style="font-size: 1.2em;"> <span style="text-decoration: line-through; margin: 0 5px">{{originalPrice}}元 </span></span>                    </div>                </li>            </ul>        </div>    </div>'},i=[{text:"1",full:"1个月",value:"1"},{text:"2",full:"2个月",value:"2"},{text:"3",full:"3个月",value:"3"},{text:"半年",full:"6个月",value:"6"},{text:"1年",full:"1年",value:"12",ico:"ico icon-hui",iconVal:"83折"},{text:"2年",full:"2年",value:"24",ico:"ico icon-hui",iconVal:"83折"},{text:"3年",full:"3年",value:"36",ico:"ico icon-hui",iconVal:"83折"}],j=e.extend({$tpl:h.main,$beforeInit:function(){this.$set("timeList",i),this.$set("curSelected",i[3].value)},$afterInit:function(){var a=this;setTimeout(function(){a.queryPrice()},50)},setCurrent:function(a){var b=this;a!=b.curSelected&&(b.$set("curSelected",a),b.queryPrice())},queryPrice:function(){var a=this;a.changeNewDeadDate();var b=[],c=a.selectedItem[0].regionId||f.getRegionId();a.selectedItem.forEach(function(a){b.push(a.uHostId)});var d={uHostIdList:b,timeSpan:a.curSelected,regionId:f.getRegionId(),projectId:f.getProjectId()};"undefined"!=typeof a.recycleFlag&&(d.recycleFlag=a.recycleFlag),a.$set("totalPrice",0),a.$set("originalPrice",!1);var e={hostIds:b,period:a.curSelected,regionId:c};g.queryRenewCdhPrice(e,{camTipsType:"dialog"}).then(function(b){if(b.response&&b.response.price){var c=b.response.price&&b.response.price.hostPrice,d=c.discountPrice,e=c.originalPrice;e>d&&a.$set("originalPrice",e),a.$set("totalPrice",d)}})},changeNewDeadDate:function(){var a=this,b=[];a.selectedItem.forEach(function(c){b.push(a.getNewExpires(Number(a.curSelected),c.deadline))}),a.$set("newDeadlines",b)},getNewExpires:function(a,b){if(!b)return"";b=b.replace(/\-/g,"/");var c=isNaN(new Date(b))?new Date:new Date(b),d=c.getMonth();return c.setMonth(d+a),f.formatDate(c,"yyyy-MM-dd")},doAction:function(a){var b=this;a.hide();var c=[],d=Number(b.curSelected),e=b.selectedItem[0].regionId;b.selectedItem.forEach(function(a){c.push(a.hostId)}),g.switchRenewParam({hostIds:c,period:d,regionId:e},{camTipsType:"dialog"}).then(function(b){var c=b.Response&&b.Response.InstanceOrder;c&&c.goods&&c.goods.length&&(a.hide(),g.toPay2(c.goods))})},toggleList:function(){var a=d("#listDetail"),b=d("#selectedShowIconArr");a.toggle(),a.is(":visible")?(b.removeClass("blue-down-icon").addClass("blue-up-icon"),this.$set("toggleTip","查看详情")):(b.removeClass("blue-up-icon").addClass("blue-down-icon"),this.$set("toggleTip","查看详情"))}});c.exports=j}),define("cvm/cdh/dialog/shutdown",function(a,b,c){var d=a("$"),e=a("qccomponent"),f=a("cvm/cdh/taskchecker"),g=a("cvm/common/model"),h={main:'  <div>    <div class="act-outline" id="selectedShowWrap">      <div class="act-summary">您已选        <strong  >{{selectedItems.length}}台实例</strong>        <span b-if="unAbleNum">，其中          <strong  >{{unAbleNum}}台实例</strong>将不能</span>        执行关机操作，        <a href="javascript:;" b-on-click="toggleList()">{{toggleTip ? toggleTip : \'查看详情\'}}          <i id="selectedShowIconArr" class="blue-down-icon"></i>        </a>      </div>      <div class="act-details" style="display:block" id="listDetail">        <table class="act-details-tb">          <tbody>            <tr>              <td>No.</td>              <td>                <span class="entity-name dev-bold">实例名</span>              </td>              <td>                <span class="entity-name dev-bold">实例ID</span>              </td>              <td>                <span class="entity-name dev-bold">当前带宽上限</span>              </td>              <td>                <span class="act-result dev-bold">操作</span>              </td>            </tr>          </tbody>        </table>        <table class="act-details-tb">          <tbody>            <tr b-repeat="item in selectedItems">              <td> {{$index}} </td>              <td>                <span class="entity-name" title="{{item.uInstanceId}}">{{item.alias}}</span>              </td>              <td>                <span class="entity-name" title="{{item.uInstanceId}}">                  <a data-event="nav" href="/cvm/detail/{{item.regionId}}/{{item.uInstanceId}}?backfrom=cvmdetail"> {{item.uInstanceId}} </a>                </span>              </td>              <td>                <span class="entity-name entity-name2" title="{{item.bandwidthInfo}}">{{item.bandwidthInfo}} </span>              </td>              <td>                <span class="{{item[\'opsAvailable\'][\'SHUTDOWN\'] ? \'act-result\' : \'act-result cdh-color-org\'}}">{{item[\'opsAvailable\'][\'SHUTDOWN\'] ? \'可关机\' : \'运行中的实例才可关机\'}} </span>              </td>            </tr>          </tbody>        </table>      </div>    </div>    <div class="coin-alert">      <table class="ui-popmsg">        <tbody>          <tr>            <td height="72" class="t">              <span class="info">                <span class="tit">确定选中实例进行关机？</span>                <br>                <!--<label>                                                重启期间，实例将无法正常提供服务，请您做好准备，以免造成影响                                            </label> -->                <label class="confirm-it">                  <input type="checkbox" class="tc-15-checkbox" id="shutdownConfirmCheck">强制关机                </label>                <div class="tc-15-msg mt15">                    强制关机的效果等同于关闭计算机的电源。强制关机可能会导致实例数据丢失或者文件系统损坏，请仅在实例无法正常关机的情况下使用。                </div>              </span>            </td>          </tr>        </tbody>      </table>    </div>  </div>'
},i=e.extend({$tpl:h.main,$beforeInit:function(){var a=this,b="关机",c=[],d=[],e={actionName:b,hasPermItems:[],noPermItems:[]};a.selectedItems.forEach(function(a){a.opsAvailable.SHUTDOWN?(c.push(a),e.hasPermItems.push({name:a.alias})):(d.push(a),e.noPermItems.push({name:a.alias,reason:"运行中的实例才可以执行关机操作"}))});var f={hasPermItems:c,noPermItems:d,selectedShowOptions:e};a.permResult=f,a.ableList=c;var g=a.selectedItems.length-c.length;g>0&&a.$set("unAbleNum",g)},$afterInit:function(){},doAction:function(a,b){for(var c,e=this,h=[],i=0;c=e.ableList[i];i++)h.push(c.uInstanceId);var j=d("#shutdownConfirmCheck").prop("checked")?"HARD":"SOFT_FIRST";h.length&&g.apiRequest({regionId:e.ableList[0].regionId,serviceType:"cvm",action:"StopInstances",data:{InstanceIds:h,StopType:j}},{camTipsType:"dialog"}).then(function(a){var c={permResult:e.permResult,selectedItems:e.selectedItems,listIns:b,gridView:b.grid,cvmListEl:b.listEl};f.checkTask(a.response,"关机中",c)})["catch"](function(a){console.warn(a)}),a.hide()},checkTask:function(a,b){},toggleList:function(){var a=d("#listDetail"),b=d("#selectedShowIconArr");a.toggle(),a.is(":visible")?(b.removeClass("blue-down-icon").addClass("blue-up-icon"),this.$set("toggleTip","查看详情")):(b.removeClass("blue-up-icon").addClass("blue-down-icon"),this.$set("toggleTip","查看详情"))}});c.exports=i}),define("cvm/cdh/dialog/terminate",function(a,b,c){var d=a("qccomponent"),e=a("cvm/cdh/data"),f=a("dialog"),g=(a("cvm/cdh/selectedShow"),d.extend({$tpl:'  <div>    <cdh-selected-show      list="{{ hostList }}"      event-name="销毁"    ></cdh-selected-show>    <div class="mt-20">      <p class="mb-5">注意事项：</p>      <p>1.专用宿主机一旦销毁将无法恢复，请知悉。</p>      <p>        2.独享子机上挂载的本地盘和非弹性云盘都将同时被销毁，数据丢失，请提前备份。      </p>    </div>  </div>',doAction:function(a){var b=this.hostList.map(function(a){return a.hostId});e.terminateCdh({data:{hostIds:b},regionId:this.hostList[0].regionId}).then(function(b){f.hide(),a&&a()})}}));c.exports=g}),define("cvm/cdh/operate_auth",function(a,b,c){function d(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return a.length&&a.every(function(a){return a.instanceIds&&!a.instanceIds.length})}function e(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],b={};return a.forEach(function(a){b[a.hostType]||(b[a.hostType]=!0)}),1==Object.keys(b).length}function f(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return a.some(function(a){return a.hostResource&&"CPU_PIN_EACH"==a.hostResource.pinType})}var g=function(){return{disabled:!1}},h=function(a){return{disabled:!0,tip:a||"当前状态不可进行该操作"}},i={getAuth:function(a){for(var b,c={},d=Object.keys(this.judgment),e=0;b=d[e];e++){var f=this.judgment[b];f?c[b]=f.call(this,a):c[b]={disabled:!1}}return c},judgment:{setAutoRenew:function(a){var b=function(a){return"PREPAID"==a.hostChargeType};return a.length>0?a.every(function(a){return b(a)})?g():h():h("请先选择专用宿主机")},renew:function(a){var b=function(a){return"PREPAID"==a.hostChargeType&&("RUNNING"==a.hostState||"EXPIRED"==a.hostState)};return a.length>0?a.every(function(a){return b(a)})?g():h("选中的专用宿主机当前状态不支持续费"):h("请先选择专用宿主机")},terminate:function(a){var b=function(a){return"POSTPAID_BY_HOUR"==a.hostChargeType&&"RUNNING"==a.hostState&&!a.instanceIds.length};return a.length>0?a.every(function(a){return b(a)})?g():h(a.some(function(a){return a.instanceIds&&a.instanceIds.length})?"选中的专用宿主机上仍存在子机，不支持销毁":"选中的专用宿主机当前状态不支持销毁"):h("请先选择专用宿主机")},rename:function(a){var b=function(a){return"RUNNING"==a.hostState};return a.length>0?a.every(function(a){return b(a)})?g():h("选中的专用宿主机当前状态不支持改名"):h("请先选择专用宿主机")},manage:function(a){return a.length>0?g():h("请先选择专用宿主机")},modifyVCPU:function(a){return a.length>0?e(a)?d(a)?f(a)?h("绑核宿主机不允许设置vCPU数量"):g():h("宿主机非空，暂不支持调整vCPU数量"):h("不支持批量设置不同类型的专用宿主机的vCPU数量"):h("请先选择专用宿主机")}}};c.exports=i}),define("cvm/cdh/selectedShow",function(a,b,c){var d=a("qccomponent"),e=d.extend({$tpl:'  <div class="act-outline">    <div class="act-summary">      下列{{ list.length }}个实例将进行{{ eventName }}，<a        href="javascript:;"        b-on-click="toggleShowDetail()"        >查看详情 <i class="blue-down-icon" b-if="isShowDetail"></i>        <i class="blue-up-icon" b-if="!isShowDetail"></i>      </a>    </div>    <div class="tc-15-table-panel mt-10" b-if="isShowDetail">      <div class="tc-15-table-fixed-head">        <table class="tc-15-table-box">          <colgroup>            <col style="width:40px;" />            <col />            <col />            <col />            <col />            <col />            <col />          </colgroup>          <thead>            <tr>              <th>                <div><span>No</span></div>              </th>              <th>                <div><span>名称</span></div>              </th>              <th>                <div><span>ID</span></div>              </th>              <th>                <div><span class="text-overflow" title="计费模式">计费模式</span></div>              </th>              <th>                <div><span class="text-overflow" title="可用区">可用区</span></div>              </th>              <th>                <div><span class="text-overflow" title="子机数量">子机数量</span></div>              </th>            </tr>          </thead>        </table>      </div>      <div class="tc-15-table-fixed-body">        <table class="tc-15-table-box tc-15-table-rowhover">          <colgroup>            <col style="width:40px;" />            <col />            <col />            <col />            <col />            <col />            <col />          </colgroup>          <tbody>            <tr b-repeat="item in list">              <td>                <div>                  <span class="text-overflow">{{ $index + 1 }}</span>                </div>              </td>              <td>                <div>                  <span class="text-overflow">{{ item.hostName }}</span>                </div>              </td>              <td>                <div>                  <a                    href="//console.cloud.tencent.com/cvm/cdh/detail/{{                      item.regionId                    }}/{{ item.hostId }}"                    target="_blank"                    class="text-overflow"                    >{{ item.hostId }}</a                  >                </div>              </td>              <td>                <div>                  <span class="text-overflow">{{ item.payModeDesc }}</span>                </div>              </td>              <td>                <div>                  <span class="text-overflow">{{ item.zoneName }}</span>                </div>              </td>              <td>                <div>                  <a                    href="//console.cloud.tencent.com/cvm?rid={{                      item.regionId                    }}&uHostIds={{ item.hostId }}"                    target="_blank"                    class="text-overflow"                    >{{ item.instanceIds.length }}</a                  >                </div>              </td>            </tr>          </tbody>        </table>      </div>    </div>  </div>',$afterInit:function(){},toggleShowDetail:function(){this.$set("isShowDetail",!this.isShowDetail)}},{defaults:{list:[],eventName:"操作",isShowDetail:!0}});d.tag("cdh-selected-show",e),c.exports=e}),define("cvm/cdh/taskchecker",function(a,b,c){var d=a("$"),e=(a("manager"),a("tips"),a("util"),a("appUtil"),a("widget/msg/msg"),a("widget/operatelog/floattips")),f={checkTask:function(a,b,c){var f=a.taskId,g=c.listIns,h=c.gridView,i=c.cvmListEl,j=c.refreshParent;e.showNoticeTip({msg:b,business_id:1},2);var k=function(){setTimeout(function(){g.refresh({sliceRefresh:!0,refreshParent:j})},5e3)},l='<span class="text-overflow restart">'+b+"</span>";i.find("[data-check-all]").prop("checked",!1);for(var m,n=c.permResult,o=n?n.hasPermItems:c.selectedItems,p=n?n.noPermItems:[],q=0;m=o[q];q++){var r=m.el;if(r){var s=r.attr("data-index");h.$refs.list[s].$set({$loading:!0,$selected:!1});var t=r.find(".status-col");t.html(l),g.getSelectedItemData(s).statusDesc=l}else d(".status-tips").html(l);var u="正在执行任务";if(r){var v=i.find('tr[data-index="'+s+'"]').find(".cvm-oper-cell");v.find("> a").addClass("disable").attr("data-title",u)}}for(var w,x=0;w=p[x];x++){var r=w.el,s=r.attr("data-index");h.$refs.list[s].$set({$selected:!1})}k(f)}};c.exports=f}),define("cvm/cdh/util",function(a,b,c){var d=(a("manager"),a("util"),a("cvm/common/constants"));c.exports={updateCheckBox:function(a){if(a){var b=this,c=[],d={},e=a.getSelected();if(e&&e.length>0&&e.forEach(function(a){var b=a.cageId||"common";d[b]?d[b]=d[b]+1:(d[b]=1,c.push(b))}),c&&c.length>0){var f;c.forEach(function(a){(!f||d[a]>d[f])&&(f=a)}),f&&a&&a.$refs.list.forEach(function(c){c.$loading||"common"==f&&!c.cageId||c.cageId==f||(c.$set({$selected:!1,$disable:!0}),b.updateCheckBoxTitle(a,c.uHostId,"不能围笼内、围笼外跨类选择宿主机"))})}else a&&a.$refs.list.forEach(function(c){c.$loading||(c.$set({$disable:!1}),b.updateCheckBoxTitle(a,c.uHostId,""))})}},updateCheckBoxTitle:function(a,b,c){var d=$(a.$el).find('tr[data-uHostId="'+b+'"]').find(".tc-15-first-checkbox");d&&d.attr("title",c)},isAutoRenewMode:function(a){return a===d.INSTANCERENEWFLAG.NOTIFY_AND_AUTO_RENEW}}}),define("cvm/common/common",function(a,b,c){var d=a("cvm/common/constants"),e=seajs.require("appUtil"),f=seajs.require("models/iaas"),g=a("pageManager");c.exports={showDiscountIcon:function(a){return a=a||e.getRegionId(),-1===d.HIDE_DISCOUNT_REGIONS.indexOf(a)},queryAccountBalance:function(){return new Promise(function(a,b){f.apiRequest({serviceType:"billing",action:"DescribeAccountBalance",data:{Version:"2018-07-09"}},{tipErr:!1}).then(function(b){var c=b&&b.Response.Balance;a(c/100)},function(b){console.warn(b),a(null)})})},renderDetailNoData:function(a,b){var c='<div style="padding: 100px;text-align: center;">未查询到指定'+a+', <a href="'+b+'" data-event="nav">返回列表</a></div>';g.appArea.html(c)}}}),define("cvm/common/components/arrearsTip/arrearsTip",function(a,b,c){var d=a("cvm/common/common"),e=seajs.require("qccomponent"),f=e.extend({$tpl:'    <div class="tc-15-msg error" b-if="showTip">      <div class="tip-info">您当前账号余额小于零，影响您的后付费资源使用，请尽快        <a target="_blank" href="//console.cloud.tencent.com/account/recharge">充值</a>        或注意备份数据，以免资源被释放。        <a class="guide-link" href="//cloud.tencent.com/document/product/213/2181#.E6.8C.89.E9.87.8F.E8.AE.A1.E8.B4.B9.E4.BA.91.E6.9C.8D.E5.8A.A1.E5.99.A8"target="_blank">          欠费说明<i class="external-link-icon"></i></a>。        如您已开通<a class="guide-link" target="_blank" href="//cloud.tencent.com/document/product/555/11753">后付费不停服特权 <i class="external-link-icon"></i></a>，可忽略该提示。      </div>      <a href="javascript:;" class="tc-icon-btn" b-on-click="closeTip()"><i class="close-icon"></i></a>    </div>  ',$afterInit:function(){var a=this;d.queryAccountBalance().then(function(b){0>b&&a.$set("showTip",!0)})},closeTip:function(){this.$set("showTip",!1)}},{defaults:{showTip:!1}});c.exports=f}),define("cvm/common/components/BandwidthRangePopover",function(a,b,c){var d=a("$"),e=Bee.getComponent("qc-popover");c.exports={show:function(a,b){var c=this,f={targetVal:0,popoverTargetEl:'<a href="javascript:void(0);" class="my-range-thumb-tip" style="z-index:0;width: 17px;height: 27px;top: -10px;position: absolute;display: inline-block;visibility: hidden;margin-left: -6px;"></a>'};c.options=d.extend({},f,a);var g=c.options.range;if(g.val()==c.options.targetVal){var h=g.rangeTrack.find(".my-range-thumb-tip");h.length||g.rangeTrack.append(c.options.popoverTargetEl);var i={$data:{content:'带宽为0时，<span style="color:#ed711f">不支持与外网互联和公网远程登录</span>， 请慎重选择',position:"top",auto:!1,style:"width: 350px; right: 100%; top: 50%; left:0px;",hideDelay:3e3},handler:d(".my-range-thumb-tip"),hideDestroy:!1,trigger:"click"};c.popover||(c.popover=new e(i)),c.popover.show(),setTimeout(function(){if(c.popover){c.popover.hide();var a=g.rangeTrack.find("[data-role=qc-popover]");a&&a.remove(),c.popover=null}},3e3)}}}}),define("cvm/common/components/columsWidth/CalColums",function(a,b,c){var d=function(a){var b,c=window.innerWidth;switch(!0){case 768>=c:b=4;break;case 900>=c:b=5;break;case 1024>=c:b=7;break;case 1366>=c:b=9;break;case 1440>=c:b=10;break;case 1600>=c:b=11;break;case 1680>=c:b=12;break;default:b=12}return b=a&&b>a?a:b},e=function(a){a=a||[];var b=d(),c=Math.abs(b-a.length);return b<a.length&&a.forEach(function(d){d.priority=d.priority||a.length+1,c>0&&!d.required&&d.priority>b?(d.hide=!0,c--):d.hide=!1}),a};return{getMaxCols:d,initSelectedFields:e}}),define("cvm/common/components/columsWidth/ColumsWidth",function(a,b,c){function d(a,b,c,d){d=d||i,b=b||l(a);var h=b.fields.length;c=c||window.innerWidth-j;var m=0,n=0,o=0,p=a.map(function(a){return b.fields.indexOf(a.key)>-1?(m+=a._maxWidth-a._minWidth,n+=a._minWidth,o+=a._maxWidth+d,a.hide=!1,a=e(a)):a.hide=!0,a}),q=c-d*h-n-k;return p=q>0&&o>c?p.map(function(a){return a.hide||(a.key===b[h-1]?(a.minWidth=a._minWidth+d,a.width="auto"):(a.minWidth=a._minWidth+d,a.maxWidth=a._maxWidth+d,a.width=Number((a._minWidth+(a._maxWidth-a._minWidth)*q/m+d).toFixed()))),a}):0>q?f(p,d):g(p,b,d)}function e(a){return delete a.minWidth,delete a.maxWidth,delete a.width,a}function f(a,b){return a.map(function(a){return a.hide||(a.width=a._minWidth+b),a})}function g(a,b,c){return a.map(function(a){return a.hide||(a.key===b.fields[b.fields.length-1]?(a.minWidth=a._minWidth+c,a.width="auto"):(a.width=a._maxWidth+c,a.minWidth=a._minWidth+c)),a})}var h=a("cvm/common/components/columsWidth/CalColums"),i=20,j=250,k=10,l=function(a){var b={};return b.fields=[],a.forEach(function(a){a.hide||0==a.selected||(a.defaults=!0),b[a.key]=a,b.fields.push(a.key)}),b};c.exports=function(a,b,c,e,f){if(e){var g=h.getMaxCols();a=a.filter(function(a){return a.priority&&a.priority<=g})}return d(a,b,c,f)}}),define("cvm/common/components/columsWidth/ColFieldsManager",function(a,b,c){var d=a("widget/fieldsManager/fieldsManager"),e=a("$"),f=a("cvm/common/components/columsWidth/CalColums"),g=a("cvm/common/components/columsWidth/ColumsWidth"),h=function(a,b){b=b||this.colums;var c=g(b,a,this.gridWidth);this.setColums(c);var d=this.$el.querySelectorAll("col"),f=[].concat({width:parseInt(this.firstColWith)},c,{width:parseInt(this.firstColWith)},c);f=f.filter(function(a){return!a.hide});for(var h=0;h<d.length;h++){var i=d[h];e(i).css("width",f[h].width+"px").parents("table").css({width:this.gridWidth+"px","max-width":this.gridWidth+"px"})}},i=function(a){var b={};return a.forEach(function(a){a.hide||0==a.selected||(a.defaults=!0),b[a.key]=a}),b},j={1:"100%",2:"48%",3:"32%"};c.exports=function(a,b,c){var k=f.getMaxCols();return{$afterInit:function(){var a=this;a.$watch("colums.length",function(){a.buildFieldsManager()},!0),e(b).click(function(){a.showFieldsManager()})},buildFieldsManager:function(b){var e=this,g=e.$get("colums");k=f.getMaxCols(g.length);var j=i(g);e.fm=new d({data:j,cacheKey:b||a,eachColNum:c,maxLimit:k,callback:function(a){h.call(e,a,g)}}),h.call(e,e.fm.getDisplayFields(),g)},showFieldsManager:function(a){var b=this.fm.showDialog();!a&&e(b).find("ul.list-mod").width(j[Math.ceil(this.$get("colums").length/6)])},formatColums:function(b,e){var f=i(b);return this.fm=new d({data:f,cacheKey:a,eachColNum:c,maxLimit:k,callback:function(a){}}),g(b,this.fm.getDisplayFields(),e)}}}}),define("cvm/common/components/CvmSelector",function(a,b,c){var d=a("widget/selectors/ListSelector"),e=(a("models/iaas"),a("appUtil")),f=a("cvm/cvm/data"),g=a("cvm/cvm/dataformat"),h=d.extend({getData:function(a,b){a=a||{},b=b||{};var c=a.count||this.count,d=a.page||this.page,f=this,g=$.extend({},this.extraParam,{limit:c,offset:c*(d-1),projectId:this.projectId}),h=a.searchKey,i=a.filters||[];return h&&(/^ins-\w{8}$/.test(h)?i.push({name:"instance-id",values:[h]}):e.isValidIp(h)?g.vagueIpAddress=h:g.vagueInstanceName=h),g.filters=i,this.request(g,b).then(function(b){var c=f.parseData(b);return c&&c.then||(c=Promise.resolve(c)),c.then(function(b){return $.extend({},a,b)})})},request:function(a,b){return a.regionId=this.regionId||e.getRegionId(),a.query="query instances ($filters: [Filter], $limit: Int, $offset: Int, $ipAddresses: [String], $innerSubnetIds: [String], $innerVpcIds: [String], $vagueIpAddress: String, $vagueInstanceName: String){\n                instances(filters: $filters, limit: $limit, offset: $offset, ipAddresses: $ipAddresses, vagueIpAddress: $vagueIpAddress, innerSubnetIds: $innerSubnetIds, innerVpcIds: $innerVpcIds, vagueInstanceName: $vagueInstanceName) {\n                    totalNum: totalCount\n                    deviceList: nodes{\n                        uInstanceId:id\n                        alias:name\n						uuid\n            deviceId\n            placement {\n              zone\n            }\n						instanceType\n						instanceFamily\n						instanceStatus {\n							instanceState\n							operationMask\n							runFlag\n							hypervisor\n						}\n						instanceTypeDesc\n						instanceChargeType\n						vpc{\n							unVpcId: id\n							vpcName: name\n							cidrBlock: cidr\n						}\n						subnet{\n							subnetId: id\n							subnetName: name\n						}\n						eip{\n              id\n              addressType\n							name\n							ip:addressIp\n						}\n						privateIpAddresses\n						publicIpAddresses\n						internetAccessible {\n                            internetChargeType\n                            internetMaxBandwidthOut\n                            publicIpAssigned\n                        }\n                        errorCode\n                        errorKey\n                    }\n                }\n            }",Promise.all([f.queryCvmList(a,b),f.getCvmWhiteList(["PrepaidForCVM","CVM_bandwidtd"]),f.getProjects()]).then(function(b){var c=b&&b[0]&&b[0].instances||{},d=c.deviceList||[],e=b[1],f=b[2],h=e.PrepaidForCVM&&e.PrepaidForCVM.length>0,i=e.CVM_bandwidtd&&e.CVM_bandwidtd.length>0;return d.forEach(function(b){b.isBandwidthPackageUser=i,b.isPrepaidUser=h,b.regionId=a.regionId}),d=g.get(d,{projectData:f,regionId:a.regionId}),d=g.getMore(d,{cvmMore:d}),{regionId:a.regionId,list:d,totalNum:c.totalNum}})["catch"](function(a){throw a})},parseData:function(a){return a}},{defaults:{multipleSearch:!1,checkType:"radio",checkKey:"uInstanceId",colums:[{name:"实例ID/名称",key:"uInstanceId",tdTpl:'<p>{{item.uInstanceId}}</p><p class="text-overflow">{{item.alias}}</p>'},{name:"内网IP",key:"deviceLanIp"},{name:"公网IP",key:"deviceWanIp"}]}});c.exports=h}),define("cvm/common/components/ExGridview/ExGridview",function(a,b,c){var d=Bee.getComponent("grid-view");return d.extend({showTips:function(a){this.$set("_tips",a),this.autoMaxHeight&&this.setMaxHeight()},hideTips:function(){this.$set("_tips",""),this.autoMaxHeight&&this.setMaxHeight()},bindEvent:function(){var a=this;this.$watch("colums",function(){var a=this.colums.filter(function(a){return!a.hide});this.$set({shownColums:a,lockedColums:a.filter(function(a){return a.locked})}),this.$locked=this._$el.find("[data-locked]"),this.$lockedHead=this.$locked.find("[data-grid-head]"),this.$lockedBody=this.$locked.find("[data-grid-body]"),this._setLastCol(),this.autoMaxHeight&&this.setMaxHeight()},!0),this.$watch("list",function(){return this.autoMaxHeight&&this.setMaxHeight(),a.$checkAll()}),this.$watch("list.length",function(b){a.searchKey||(b?a._tips==a.emptyTips&&a.hideTips():a.showTips(a.emptyTips))}),this.$watch("getSelected(list).length",function(a){a=this.getSelectedLength?this.getSelectedLength():a,this.$set("selectedNum",a)}),this.$watch("ischeckAll",function(a){a||this.$set("isSelectTotal",!1)},!0),$(window).on("resize",function(){a.resize()}),this._$el.on("mouseenter mouseleave","[data-grid-body]>table>tbody>tr, [data-locked] [data-grid-body]>table>tbody>tr",function(b){if(a.lockedColums.length){var c=$(b.currentTarget),d=c.index(),e="mouseenter"===b.type?"addClass":"removeClass";a._$el.find("[data-grid-body]>table>tbody>tr").eq(d)[e]("tr-hover"),a._$el.find("[data-locked] [data-grid-body]>table>tbody>tr").eq(d)[e]("tr-hover")}})}})}),define("cvm/common/components/fieldsManager",function(a,b,c){var d=a("$"),e=a("util"),f=a("dialog"),g=a("tips"),h={main:'  <div class="customize-column">    <div class="tip_box">      <%=tipText%><span id="limitTip">，最多可勾选<%= maxLimit %>个字段，已勾选<%=defaultsNum %>个。</span>    </div>    <div class="list-wrap clearfix">      <div class="op-area">        <label class="form-ctrl-label"><input type="checkbox" id="checkAllFields" class="tc-15-checkbox">全选</label>      </div>      <div id="customizeColumn">        <% var field, i = -1; for (field in data) { i++; var required = data[field]["required"]; var isDefault =        data[field]["defaults"];        var eachColNum = eachColNum; %>        <% if (i % eachColNum === 0) { %>        <ul class="list-mod">          <% } %>          <li>            <input type="checkbox" class=\'tc-15-checkbox <%= required ? "required" : ""%>\'                   id="customize_field_<%- field %>" value="<%- field %>"            <% if (required) { %>            disabled checked            <% } else { %>            <% if (selectedFields && selectedFields.length > 0) { %>            <% if (selectedFields.indexOf(field) >= 0 && !required ) {            %>            checked            <% } %>            <% } else { %>            <% if (isDefault && !required ) {            %>            checked            <% } %>            <% } %>            <% } %>            >            <label for="customize_field_<%- field %>"><%= data[field]["name"] %></label>          </li>          <% if ((i+1) % eachColNum === 0) { %>        </ul>        <% } %>        <% } %>        <% if (showExportType) { %>        <ul class="form-list mt-10">          <li class="pure-text-row">            <div class="form-label">              <label>导出范围</label>            </div>            <div class="form-input">              <div class="form-unit">                <label class="form-ctrl-label-stacked">                  <input type="radio" class="tc-15-radio" name="exportType" value="all" checked>                  导出全部实例                </label>                <label class="form-ctrl-label-stacked">                  <input type="radio" class="tc-15-radio" name="exportType" value="filter">                  仅导出搜索结果                </label>                <label class="form-ctrl-label-stacked">                  <input type="radio" class="tc-15-radio" name="exportType" value="selected">                  仅导出选中实例                </label>              </div>            </div>          </li>        </ul>        <% } %>      </div>    </div>  </div>'},i=function(a){var b={eachColNum:6};this.options=d.extend({},b,a),this.options.data&&this.options.cacheKey&&this.bindEvent()};i.prototype={bindEvent:function(){var a=this.options.settingHandle,b=this;a&&a.off("click").on("click",function(){b.showDialog()})},getDisplayFields:function(){return this._getDisplayFieldsData()},showDialog:function(){var a=this,b=this.options,c=b.data,g=b.eachColNum,i=b.cacheKey,j=b.showExportType,k=localStorage[i]||"",l=this._countFields(),m=(l.requiredCount,l.defaultsCount),n=b.maxLimit||l.count,o=b.tipText||"请选择您想显示的列表详细信息，根据您的分辨率",p=e.tmpl(h.main,{data:c,tipText:o,eachColNum:g,defaultsNum:m,maxLimit:n,selectedFields:k?k.split(","):[],showExportType:j});f.create(p,"540","",{title:b.title||"自定义列表字段",preventResubmit:!0,button:{"确定":function(){a._setFields()}}}),d("#customizeColumn").off("click.fieldsLimit").on("click.fieldsLimit",'input[type="checkbox"]',this._initItemEvent.bind(this)),d("#checkAllFields").off("click").on("click",function(){this.checked?d("#customizeColumn :checkbox:enabled").prop("checked",!0):d("#customizeColumn :checkbox:enabled").prop("checked",!1),a._initItemEvent()}),this._initItemEvent()},_setFields:function(){var a,b,c=this.options,e=c.cacheKey,h=c.callback,i=d("#customizeColumn"),j=i.find('input[type="checkbox"]:checked'),k=[];c.showExportType&&(a=i.find('input[type="radio"]:checked'),b=a.val()||"all"),j.each(function(a,b){b=d(b),k.push(b.val())}),localStorage[e]=k.join(",");var l=h&&h(this._getDisplayFieldsData(),b);l?f.toggleBtnDisable(!1,0):(!c.withoutTips&&g.success("设置成功"),f.hide())},_getDisplayFieldsData:function(){var a=this.options,b=a.data,c=a.cacheKey,d=localStorage[c]&&localStorage[c].split(","),e={fields:[],data:{}};for(var f in b){var g=b[f].required,h=b[f].defaults;(g||d&&d.indexOf(f)>=0||!d&&h)&&(e.data[f]=b[f],e.fields.push(f))}return e},_countFields:function(){var a=this.options.data,b=0,c=0,d=0;for(var e in a)a.hasOwnProperty(e)&&(b++,a[e].required&&c++,a[e].defaults&&d++);return{count:b,requiredCount:c,defaultsCount:d}},_initItemEvent:function(){var a=this.options,b=this._countFields(),c=a.maxLimit||b.count,e=d('#customizeColumn input[type="checkbox"]:checked').length;c>e?d("#customizeColumn :checkbox").not(".required").attr("disabled",!1).siblings("label").removeAttr("data-title"):d("#customizeColumn :checkbox").not(":checked").attr("disabled",!0).siblings("label").attr("data-title","最多勾选"+c+"个字段，已勾选"+e+"个"),d("#limitTip").html("，最多勾选"+c+"个字段，已勾选"+e+"个。")}},c.exports=i}),define("cvm/common/components/ProjectSelector",function(a,b,c){var d=["\\","^","$","*","+",".","?","[","]","(",")","{","}","|","-"],e=a("widget/selectors/ListSelector"),f=a("cvm/common/components/columsWidth/ColumsWidth"),g=function(){var a=[{name:"项目名称",key:"name",_minWidth:40,_maxWidth:500},{name:"项目说明",key:"info",_minWidth:40,_maxWidth:500}],b=400;return a=f(a,null,b,!1)};c.exports=e.extend({projectList:[],getData:function(a){a=a||{};var b=a.count||this.count,c=a.page||this.page,e=a.searchKey||"";d.forEach(function(a){e=e.replace(a,"\\$&")});var f=new RegExp(e),g=this.projectList.filter(function(a){return f.test(a.name)||f.test(a.info||"")});return Promise.resolve({list:g.slice(b*(c-1),b*c),totalNum:g.length})}},{defaults:{multipleSearch:!1,checkType:"radio",checkKey:"projectId",tbodyStyle:{maxHeight:200},searchPlaceholder:"搜索项目名称/说明",colums:g()}})}),define("cvm/common/components/regionNumPills",function(a,b,c){var d=a("qccomponent"),e=a("appUtil"),f=a("cvm/cvm/data"),g=d.getComponent("qc-segment"),h=g.extend({$valuekey:"regionId",getData:function(){return f.queryConsoleRegion()},$afterInit:function(){var a=this,b=this;h.__super__.$afterInit.call(this),b.regionId=e.getRegionId(),this.$on("selected",function(a){a&&(e.setRegionId(a.regionId),this.$set("regionId",a.regionId))}),this.$watch("regionId",function(a){b.toggle({regionId:a})}),this.$watch("regionList",function(c){var d=c.map(function(a){return{label:a.regionName,regionId:a.regionId,regionName:a.regionName,$checked:a.regionId==b.regionId}});a.$set({list:d}),"function"==typeof a.getNumData&&a.getNumData().then(function(b){var c=a.$data.regionList,d=c.map(function(a){var c=a.regionName,d=b.find(function(b){return b.regionId==a.regionId});return d&&d.regionId&&(c+="("+d.value+")"),Object.assign({},a,{label:c})}),e=d.some(function(b){return b.regionId==a.regionId})?a.regionId:d[0].regionId;a.$set({list:d,regionId:e})},function(a){})}),Promise.all([this.getData(),function(){return"function"==typeof b.getWhiteList?b.getWhiteList():Promise.resolve(b.whiteList||[])}()]).then(function(a){var c=_slicedToArray(a,2),d=c[0],e=c[1],f=d.map(function(a){return{regionId:a.regionId,regionName:a.regionName,$checked:a.regionId==b.regionId}});e.length&&(f=f.filter(function(a){return e.find(function(b){return a.regionId==b})})),b.$set({regionList:f})})}},{defaults:{regionList:[],idKey:"regionId",regionId:e.getRegionId()}});d.tag("region-num-pill",h),c.exports=h}),define("cvm/common/components/regionPills",function(a,b,c){var d=a("qccomponent"),e=a("appUtil"),f=a("cvm/cvm/data"),g=d.getComponent("qc-segment"),h=g.extend({$valuekey:"regionId",getData:function(){return f.queryConsoleRegion()},$afterInit:function(){var a=this;h.__super__.$afterInit.call(this),a.regionId=e.getRegionId(),this.$on("selected",function(a){a&&(e.setRegionId(a.regionId),this.$set("regionId",a.regionId))}),this.$watch("regionId",function(b){a.toggle({regionId:b})}),Promise.all([this.getData(),function(){return"function"==typeof a.getWhiteList?a.getWhiteList():Promise.resolve(a.whiteList||[])}()]).then(function(b){var c=_slicedToArray(b,2),d=c[0],e=c[1],f=[],g=!1;d.forEach(function(b){var c={label:b.regionName,regionId:b.regionId,regionName:b.regionName,$checked:b.regionId==a.regionId};e.length?e.find(function(a){return b.regionId==a})?f.push(c):b.regionId==a.regionId&&(g=!0):f.push(c)}),a.$set({list:f,regionId:g?f[0].regionId:a.regionId})})}},{defaults:{idKey:"regionId",regionId:e.getRegionId()}});d.tag("cvm-region-pill",h),c.exports=h}),define("cvm/common/components/SmartHelper",function(a,b,c){var d=a("$"),e=a("reporter"),f={show:function(){var a=d(".dev-service-help");0===a.length&&(a=d(['<div class="service-help dev-service-help">','<i class="service-help-icon" style="z-inex: 999999;"></i>','<div class="tc-15-bubble tc-15-bubble-right" style="display:none;">','<div class="tc-15-bubble-inner">',"腾讯云智能客服","</div>","</div>","</div>"].join(""))),this.$el=a,a.off("mouseover").on("mouseover",function(b){a.find(".tc-15-bubble-right").show()}).off("mouseout").on("mouseout",function(b){a.find(".tc-15-bubble-right").hide()}).off("click").on("click",function(){e.click("yunzhuji.smartHelper"),window.open("/smarty?from=cvm-console","_blank")}),a.appendTo(document.body)},destroy:function(){this.$el&&this.$el.remove()}};c.exports=f}),define("cvm/common/components/SubnetSelector",function(a,b,c){var d=/^subnet-\w{8}$/,e=a("widget/selectors/ListSelector"),f=a("cvm/common/model"),g=a("appUtil");c.exports=e.extend({param:{},getData:function(a){a=a||{};var b=[],c=[],e=a.count||this.count,h=a.page||this.page,i=a.searchKey,j=this.param.vpcId||"",k=this.param.regionId||g.getRegionId(),l=this.param.zone;return j?(c.push({name:"vpc-id",values:[j]},{name:"zone",values:[l]}),i&&(d.test(i)?c.push({name:"subnet-id",values:[i]}):c.push({name:"subnet-name",values:[i]})),f.apiRequest({serviceType:"vpc",action:"DescribeSubnets",data:{filters:c,limit:e,offset:e*(h-1)},regionId:k},{camTipsType:"dialog"}).then(function(a){var c=a&&a.response&&a.response.subnetSet;b=c.sort(function(a,b){return a.availableIpAddressCount<b.availableIpAddressCount});var d=a.response.totalCount;return Promise.resolve({list:b,totalNum:d})})):Promise.resolve({list:[],totalNum:0})}},{defaults:{multipleSearch:!1,checkType:"radio",checkKey:"subnetId",tbodyStyle:{maxHeight:150},searchPlaceholder:"搜索子网名称/说明",colums:[{key:"subnetName",name:"名称",minWidth:100},{key:"subnetId",name:"ID",width:130},{key:"cidrBlock",name:"CIDR",width:100},{key:"availableIpAddressCount",name:"数量",width:100}]}})}),define("cvm/common/components/TimePill/timePill",function(a,b,c){var d=a("$"),e=a("util"),f=a("cvm/common/constants"),g=f.SPECIAL_DISCOUNT,h=f.RENEW_DISCOUNT,i=function(a){var b={renderTo:null,data:null,change:null,activeCls:"checked",tpl:'<div>        <div class="tc-15-rich-radio <%= className %>" role="radiogroup">                <% for (var i=0, item; item = list[i]; i++) { %>                    <% if (!item.hide) { %>                    <button type="button" data-value="<%- item.value %>" data-name="<%- item.name %>" <% if (item.label) { %>data-label="<%= item.label %>" <% } %>  class="tc-15-btn m <% if (item.active) { %> checked <% } %>  <% if (item.disabled) { %> disabled <% } %>" data-title="<%= item.tips %>">                        <span data-name="<%- item.name %>"><%= item.name %></span>                        <% if (showDiscountIcon && item.iconClass) { %> <i class="<%= item.iconClass %>"><%= item.iconText %></i> <% } %>                    </button>                    <% } %>                <% } %>            </div>            <% if (showOtherTime) { %>                <a href="javascript:;" data-event="otherTime">其他时长</a>            <% } %></div>',showOtherTime:!0,showDiscountIcon:!0,specialDiscount:g,defaultTriggerChange:!1};this.options=d.extend({},b,a),this.options.data=this.getData();var c=this.options.renderTo;if(c){c=d(c);var f=e.tmpl(this.options.tpl,{list:this.options.data,className:this.options.className,
showOtherTime:this.options.showOtherTime,showDiscountIcon:this.options.showDiscountIcon}),h=d(f);if(this.$el=h,c.append(h),this.bindEvent(),this.options.defaultTriggerChange){var i=this.getActiveObj();i.trigger("click")}return this}};i.prototype={bindEvent:function(){var a=this;a.$el.find("button:not(.disabled)").on("click",function(){a.select(this),a.change()}),a.$el.find("[data-event=otherTime]").on("click",function(){this.remove(),a.setData(a.getData(!0))})},select:function(a){var b=this.options.activeCls,c=this.$el.find("."+b),e=d(a),f=e.data("label")||"",g=c.data("name");c.removeClass(b).find("span").text(g),e.addClass(b),f&&e.find("span").text(f)},status:function(a){var b="disabled";for(var c in a.values)a.disabled?this.$el.find('[data-value="'+a.values[c]+'"]').addClass(b):this.$el.find('[data-value="'+a.values[c]+'"]').removeClass(b)},change:function j(){var j=this.options.change,a=this.val();j&&j.call(this,a)},getActiveObj:function(){return this.$el.find("."+this.options.activeCls)},val:function(a){var b=this.$el;if(void 0===a)return b.find("."+this.options.activeCls).attr("data-value");var c=b.find('[data-value="'+a+'"]');c.length&&this.select(c)},setData:function(a){if(a&&a.length){for(var b=this,c=b.$el,f=b.getCheckedData(),g=this.options.tpl,h="button:not([disabled])",i=!1,j=0;j<a.length;j++){var k=a[j];k.name==f.name&&k.value==f.value?(k.active=!0,i=!0):k.active=!1}var l=e.tmpl(g,{list:a,className:this.options.className,showOtherTime:!1,showDiscountIcon:this.options.showDiscountIcon});c.html(d(l)),b.options.data=a,b.bindEvent(),i||c.find(h).first().trigger("click")}},getCheckedData:function(){for(var a=this,b=a.options.data,c={value:a.getActiveObj().data("value")},d=0;d<b.length;d++)if(b[d].value==c.value){c.name=b[d].name;break}return c},getData:function(a){var b=a?h:h.filter(function(a){return!a.collapse}),c=this.options.discountHandler;if(c){var d=c.bind(this,b,this.dataHandler);b=d()}return b},dataHandler:function(a){var b=a.list,c=a.regionId,e=a.instanceFamilies,f=this.options.specialDiscount,g=null,h=e.every(function(a){return f.instanceFamily.some(function(b){var c=b.value;return c.indexOf(a)>-1})});try{Object.keys(f).forEach(function(a){var b=null;if(!g){if("regionId"==a)b=f[a].find(function(a){return a.value.indexOf(+c)>-1});else if(h&&"instanceFamily"==a){var d=e&&e[0];b=f[a].find(function(a){return a.value.indexOf(d)>-1})}g=b&&b.duration}})}catch(i){}return g&&g.length&&(b=b.map(function(a){var b=g.find(function(b){return b.value==a.value})||{};return d.extend({},a,b)})),b.map(function(a){return a.iconText?Object.assign({},a,{iconClass:"icon-hui"}):a})}},c.exports=i}),define("cvm/common/constants",function(a,b,c){var d=a("cvm/common/regionConfig"),e={REGIONMAP:d.getRegionCodeMap(),REGIONIDMAP:d.getRegionIdMap(),ZONEIDMAP:d.getZoneIdMap(),ZONENAMEMAP:d.getZoneNameMap(),REGIONNAMES:d.getRegionNameMap(),ZONETOREGIONMAP:d.getRegionIdByZoneId(),ZONETOREGIONMAPV3:d.getRegionIdByZoneIdV3(),ZONEIDV3TONAMEMAP:d.getZoneIdV3ToNameMap(),REGIONAREAMAP:d.getRegionAreaMap(),ZONEV3TOZONEIDMAP:d.getZoneIdByZoneV3(),OVERSEA_REGION_ID_LIST:d.getOverseaRegionIdList(),HYPERVISOR:{ENABLE:!0,ENABLE_WINDOWS:!1,ENABLE_CBS:!0},NOT_SUPPORT_HOURLY_REGION:["12"],FINANCE_REGIONS:["7","11","46"],HIDE_DISCOUNT_REGIONS:["7","11","46","6"],DEFAULT_PERIOD:"12",CVMPAYMODE:{PREPAID:1,POSTPAID_BY_HOUR:2,CDHPAID:3,SPOTPAID:5},NETWORKPAYMODE_OLD:{BANDWIDTH_POSTPAID_BY_MONTH:0,BANDWIDTH_PREPAID:1,TRAFFIC_POSTPAID_BY_HOUR:2,BANDWIDTH_POSTPAID_BY_HOUR:3},BAND_WIDTH_NOT_1000_ZONE:[100001,100002,200001,300001,400001,120001,130001],CVM_ROOT_SYSTEM_ICON:{centos:"icon-mainframe1",coreos:"icon-mainframe2",debian:"icon-mainframe3",freebsd:"icon-mainframe4","(sles|suse)":"icon-mainframe5",ubuntu:"icon-mainframe6","(xserver|windows)":"icon-mainframe7","(tlinux|Tencent Linux)":"icon-mainframe8"},INSTANCERENEWFLAG:{NOTIFY_AND_AUTO_RENEW:"NOTIFY_AND_AUTO_RENEW",NOTIFY_AND_MANUAL_RENEW:"NOTIFY_AND_MANUAL_RENEW",DISABLE_NOTIFY_AND_MANUAL_RENEW:"DISABLE_NOTIFY_AND_MANUAL_RENEW"},AUTORENEWSTATUS:{NOTIFY_AND_AUTO_RENEW:"启用",NOTIFY_AND_MANUAL_RENEW:"关闭",DISABLE_NOTIFY_AND_MANUAL_RENEW:"关闭"},INSTANCEPAYMODETITLE:{PREPAID:"预付费",POSTPAID_BY_HOUR:"按量计费",CDHPAID:"CDH付费"},INSTANCEPAYMODE:{PREPAID:"PREPAID",POSTPAID_BY_HOUR:"POSTPAID_BY_HOUR",CDHPAID:"CDHPAID",SPOTPAID:"SPOTPAID"},NETWORKPAYMODETITLE:{BANDWIDTH_PREPAID:"按带宽包年包月计费",TRAFFIC_POSTPAID_BY_HOUR:"按流量计费",BANDWIDTH_POSTPAID_BY_HOUR:"按带宽使用时长计费",BANDWIDTH_PACKAGE:"共享带宽包",BANDWIDTH_POSTPAID_BY_MONTH:"按带宽后付费月结"},NETWORKPAYMODE:{BANDWIDTH_PREPAID:"BANDWIDTH_PREPAID",TRAFFIC_POSTPAID_BY_HOUR:"TRAFFIC_POSTPAID_BY_HOUR",BANDWIDTH_POSTPAID_BY_HOUR:"BANDWIDTH_POSTPAID_BY_HOUR",BANDWIDTH_PACKAGE:"BANDWIDTH_PACKAGE",BANDWIDTH_POSTPAID_BY_MONTH:"BANDWIDTH_POSTPAID_BY_MONTH"},CVM_STATUS:{PENDING:"PENDING",LAUNCH_FAILED:"LAUNCH_FAILED",RUNNING:"RUNNING",STOPPED:"STOPPED",STARTING:"STARTING",STOPPING:"STOPPING",REBOOTING:"REBOOTING",SHUTDOWN:"SHUTDOWN",TERMINATING:"TERMINATING"},CVM_STATUS_TITLE:{PENDING:"创建中",LAUNCH_FAILED:"创建失败",RUNNING:"运行中",STOPPED:"已关机",STARTING:"开机中",STOPPING:"关机中",REBOOTING:"重启中",SHUTDOWN:"待回收",TERMINATING:"销毁中"},CVM_OPERATION:{ModifyInstanceInternetChargeType:"ModifyInstanceInternetChargeType",ModifyInstancesAttribute:"ModifyInstancesAttribute","ModifyInstancesAttribute.InstanceName":"ModifyInstancesAttribute.InstanceName","ModifyInstancesAttribute.UserData":"ModifyInstancesAttribute.UserData","ModifyInstancesAttribute.SecurityGroups":"ModifyInstancesAttribute.SecurityGroups",ModifyInstancesChargeType:"ModifyInstancesChargeType",ModifyInstancesProject:"ModifyInstancesProject",ModifyInstancesRenewFlag:"ModifyInstancesRenewFlag",RebootInstances:"RebootInstances",RenewInstances:"RenewInstances",ResetInstance:"ResetInstance",ResetInstancesInternetMaxBandwidth:"ResetInstancesInternetMaxBandwidth",ResetInstancesPassword:"ResetInstancesPassword",ResetInstancesType:"ResetInstancesType",ResizeInstanceDisks:"ResizeInstanceDisks",RunInstances:"RunInstances",StartInstances:"StartInstances",StopInstances:"StopInstances",TerminateInstances:"TerminateInstances",UpdateInstanceVpcConfig:"UpdateInstanceVpcConfig",CreateImage:"CreateImage",AssociateInstancesKeyPairs:"AssociateInstancesKeyPairs",DisassociateInstancesKeyPairs:"DisassociateInstancesKeyPairs",AssociateSecurityGroups:"AssociateSecurityGroups",DisassociateSecurityGroups:"DisassociateSecurityGroups",AssociateAddress:"AssociateAddress",DisassociateAddress:"DisassociateAddress",TransformAddress:"TransformAddress"},CVM_OPERATION_TITLE:{ModifyInstanceInternetChargeType:"网络调整",ModifyInstancesAttribute:"属性更新","ModifyInstancesAttribute.InstanceName":"名称更新","ModifyInstancesAttribute.UserData":"用户数据更新","ModifyInstancesAttribute.SecurityGroups":"安全组调整",ModifyInstancesChargeType:"实例收费类型更新",ModifyInstancesProject:"项目变更",ModifyInstancesRenewFlag:"调整续费设置",RebootInstances:"重启",RenewInstances:"实例续费",ResetInstance:"系统重装",ResetInstancesInternetMaxBandwidth:"网络带宽调整",ResetInstancesPassword:"密码重置",ResetInstancesType:"配置调整",ResizeInstanceDisks:"磁盘调整",RunInstances:"创建",StartInstances:"开机",StopInstances:"关机",TerminateInstances:"实例销毁",UpdateInstanceVpcConfig:"VPC网络调整",CreateImage:"镜像创建",AssociateInstancesKeyPairs:"密钥绑定",DisassociateInstancesKeyPairs:"密钥解绑",AssociateSecurityGroups:"安全组绑定",DisassociateSecurityGroups:"安全组解绑",AssociateAddress:"弹性IP绑定",DisassociateAddress:"弹性IP解绑",TransformAddress:"普通公网IP转弹性IP"},NETWORK_PAYMODE_VPC:{BANDWIDTH_PREPAID:"BANDWIDTH_PREPAID_BY_MONTH",TRAFFIC_POSTPAID_BY_HOUR:"TRAFFIC_POSTPAID_BY_HOUR",BANDWIDTH_POSTPAID_BY_HOUR:"BANDWIDTH_POSTPAID_BY_HOUR",BANDWIDTH_PACKAGE:"BANDWIDTH_PACKAGE",BANDWIDTH_POSTPAID_BY_MONTH:"BANDWIDTH_POSTPAID_BY_MONTH"},CVM_REMAIN_TIME:{PREPAID_DAY:7,SECOND_MANMADE_HOUR:2,SECOND_ISO_HOUR:24},RENEW_DISCOUNT:[{value:1,label:"1个月",name:"1",collapse:!1},{value:2,label:"2个月",name:"2",collapse:!1},{value:3,label:"3个月",name:"3",collapse:!1},{value:4,label:"4个月",name:"4",collapse:!0},{value:5,label:"5个月",name:"5",collapse:!0},{value:6,label:"6个月",name:"6",iconClass:"icon-hui",iconText:"88折",collapse:!0},{value:7,label:"7个月",name:"7",iconClass:"icon-hui",iconText:"88折",collapse:!0},{value:8,label:"8个月",name:"8",iconClass:"icon-hui",iconText:"88折",collapse:!0},{value:9,label:"9个月",name:"9",iconClass:"icon-hui",iconText:"88折",collapse:!0},{value:10,label:"10个月",name:"10",iconClass:"icon-hui",iconText:"88折",collapse:!0},{value:11,label:"11个月",name:"11",iconClass:"icon-hui",iconText:"88折",collapse:!0},{value:12,label:"1年",name:"1年",active:!0,iconClass:"icon-hui",iconText:"83折",collapse:!1},{value:24,label:"2年",name:"2年",iconClass:"icon-hui",iconText:"7折",collapse:!1},{value:36,label:"3年",name:"3年",iconClass:"icon-hui",iconText:"5折",collapse:!1},{value:48,label:"4年",name:"4年",iconClass:"icon-hui",iconText:"5折",collapse:!1},{value:60,label:"5年",name:"5年",iconClass:"icon-hui",iconText:"5折",collapse:!1}],SPECIAL_DISCOUNT:{instanceFamily:[{value:["GN2","GN6","GN6S","GN8","GN10","GN10S","GN10X","GA2","FX2"],duration:[{value:36,iconText:"7折"},{value:48,iconText:"7折"},{value:60,iconText:"7折"}]},{value:["S5"],duration:[{value:1,iconText:"8.7折"},{value:2,iconText:"8.7折"},{value:3,iconText:"7.8折"},{value:4,iconText:"7.8折"},{value:5,iconText:"7.8折"},{value:6,iconText:"7.3折"},{value:7,iconText:"7.3折"},{value:8,iconText:"7.3折"},{value:9,iconText:"7.3折"},{value:10,iconText:"7.3折"},{value:11,iconText:"7.3折"},{value:12,iconText:"6.9折"},{value:24,iconText:"5.5折"},{value:36,iconText:"4.1折"},{value:48,iconText:"3.3折"},{value:60,iconText:"2.7折"}]}]}};c.exports=e}),define("cvm/common/cookie",function(a,b,c){c.exports={get:function(a){var b=new RegExp("(?:^|;+|\\s+)"+a+"=([^;]*)"),c=document.cookie.match(b);return c?c[1]:""},set:function(a,b,c,d,e){if(e){var f=new Date;f.setTime(f.getTime()+36e5*e)}return document.cookie=a+"="+b+"; "+(e?"expires="+f.toGMTString()+"; ":"")+(d?"path="+d+"; ":"path=/; ")+(c?"domain="+c+";":"domain="+document.domain+";"),!0},del:function(a,b,c){document.cookie=a+"=; expires=Mon, 26 Jul 1997 05:00:00 GMT; "+(c?"path="+c+"; ":"path=/; ")+(b?"domain="+b+";":"domain="+document.domain+";")}}}),define("cvm/common/model",function(a,b){var c=a("qccomponent"),d=a("models/iaas"),e=a("$"),f=a("tips"),g=a("util"),h=a("nmcConfig"),i=a("cvm/cvm/cvmutil"),j=a("widget/errorTips/errorTips"),k=a("dialog"),l=a("sdk"),m=function(a){var b=a&&a.response&&a.response.error;j.isCamRefused(b)||f.error(a.response&&a.response.error.message||h.defaultReqErr)},n=function(a,b,d){if("string"==typeof a)d!==!1&&f.error(a);else{var e=a.message||h.defaultReqErr;if(j.isCamRefused(a)){if(b!==!1){var g=new c("<div><cam-tips>"+e+"</cam-tips></div>");k.create(g.$el,820,"",{title:"您没有权限执行此操作",defaultCancelBtn:!1,button:{"确定":function(){k.hide()}}})}}else d!==!1&&f.error(e)}},o=function(a,b){var c={operationName:null,query:a,variables:null};"string"==typeof a?c.query=a:c=e.extend({},c,a),"string"==typeof c.query&&(c.query=c.query.replace(/(([\t]){2,})/g,"$2").replace(/(([ ]){2,})/g,"$2").replace(/(([\n]){2,})/g,"$2")),b=b||{},b.v3=!0;var f="/cgi/graphql?",j=c.query.match(/query ([^\(\{]+)/i);if(j&&j.length>0){var k=j[1].replace(/^\s+|\s+$/g,"").replace(/\s+/g,"-");f+="query="+k+"&"}return f+="uin="+g.getUin()+"&t="+Date.now(),d.request(f,c,b).then(function(a){if(a.errors)for(var b=0;b<a.errors.length;b++){var c=a.errors[b];if(c.message){try{var d=i.toLowerCaseFL(JSON.parse(c.message)||{});c.code=d.data.response&&d.data.response.error.code||d.data.code,c.message=d.data.response&&d.data.response.error.message||d.data.message}catch(e){c.code="FRONT_DEFINITION",c.message=h.defaultReqErr}var f=c.path[c.path.length-1],g=a.data;(c.path||[]).forEach(function(a,b,c){b<c.length-1&&(g=g[a])}),g[f+"__graphql_error"]=c,a.errors[b]=c}}var j=a.data||{};return j.errors=a.errors,j})},p=function(a,b){return b=b||{},a&&a.data&&a.data.Version||(b.v3=!0),l.use("iaas-sdk").then(function(c){var d=c.iaas;return d.capiRequest(a,b)})},q=function(a,b){return d.apiRequest(a,b)};b.request=d.request,b.graphql=o,b.apiRequest=p,b.apiDelegate=q,b.showErrorTips=m,b.checkAndShowError=n}),define("cvm/common/regionConfig",function(a,b,c){var d=a("config_cvm"),e=function(){this.init()};e.prototype.init=function(){var a=d&&d.regionMap||[],b=d&&d.zoneList||{},c={};a.forEach(function(a){"undefined"!=typeof a.value&&(c[a.value]=$.extend({id:a.regionId,zone:b[a.value]},a))}),this.data=c},e.prototype.getData=function(){return this.data},e.prototype.getRegionCodeMap=function(){var a=this.data,b={};for(var c in a)b[c]=a[c].code;return b},e.prototype.getRegionIdMap=function(){var a=this.data,b={};for(var c in a)b[c]=a[c].regionId;return b},e.prototype.getRegionNameMap=function(){var a=this.data,b={};for(var c in a)b[c]=a[c].name;return b},e.prototype.getRegionOrder=function(){var a=d&&d.regionMap||[];return a.map(function(a){return a.value})},e.prototype.getZoneIdMap=function(){var a=this.data,b={};for(var c in a){var d=a[c].zone;for(var e in d)b[e]=d[e].zoneId}return b},e.prototype.getZoneNameMap=function(){var a=this.data,b={};for(var c in a){var d=a[c].zone;for(var e in d)b[e]=d[e].name}return b},e.prototype.getZoneIdV3ToNameMap=function(){var a=this.data,b={};for(var c in a){var d=a[c].zone;for(var e in d){var f=d[e];b[f.zoneId]=f.name}}return b},e.prototype.getZoneIdByZoneV3=function(){var a=this.data,b={};for(var c in a){var d=a[c].zone;for(var e in d){var f=d[e];b[f.zoneId]=e}}return b},e.prototype.getRegionIdByZoneId=function(){var a=this.data,b={};for(var c in a){var d=a[c].zone;for(var e in d)b[e]=c}return b},e.prototype.getRegionIdByZoneIdV3=function(){var a=this.data,b={};for(var c in a){var d=a[c].zone;for(var e in d)b[e]=a[c].regionId}return b},e.prototype.getRegionAreaMap=function(){var a=this.data,b={};for(var c in a)b[a[c].regionId]={area:a[c].area,name:a[c].name};return b},e.prototype.getMainlandRegionList=function(){return["1","4","7","8","11","16","19"]},e.prototype.getOverseaRegionIdList=function(){return Object.values(this.data).filter(function(a){var b=a.oversea;return b}).map(function(a){var b=a.value;return b})},c.exports=new e}),define("cvm/common/renderMonitor",function(a,b,c){function d(a){var b="";for(var c in a)b+=(b?"&":"")+c+"="+a[c];return b}function e(a){if("https:"==location.protocol){var b=new Image;b.src=a}}function f(a){a=a||{};var b=a.domain||"console.qcloud.com",c=a.appId||20158,d=encodeURIComponent(a.cgi),f="//report.huatuo.qq.com/code.cgi?appid="+c+"&platform=pc&domain="+b+"&cgi="+d+"&type=1&code=0&time="+a.time+"&apn=unknow";e(f)}function g(a,b){var c=location.protocol+"//report.huatuo.qq.com/report.cgi?",g={"console.cloud.tencent.com":21972,"buy.cloud.tencent.com":21980}[location.hostname]||21972;a.flag1=g,a.flag2=1,a.flag3=1;var h={appid:{"console.cloud.tencent.com":20375,"buy.cloud.tencent.com":21980}[location.hostname]||20375,platform:"pc",speedparams:encodeURIComponent(d(a)),_:Math.random()};c+=d(h),e(c),f({cgi:{28:"loadFirstScreen",29:"loadMoreInfo"}[b]+location.hostname.split(/\./)[0],time:a[b]})}function h(a){var b,c;return a&&"[object Object]"===k.call(a)?(b=Object.getPrototypeOf(a))?(c=l.call(b,"constructor")&&b.constructor,"function"==typeof c&&l.toString.call(c)===l.toString.call(Object)):!0:!1}function i(){var a,b,c,d,e,f,g=!1,j=arguments.length,k=1,l=arguments[0]||{};for("boolean"==typeof l&&(g=l,l=arguments[k]||{},k++),"object"!==("undefined"==typeof l?"undefined":_typeof(l))&&"function"!=typeof l&&(l={});j>k;k++)if(b=arguments[k],null!=b)for(a in b)c=l[a],d=b[a],l!==d&&(g&&d&&(h(d)||(f=Array.isArray(d)))?(f?(f=!1,e=c&&Array.isArray(c)?c:[]):e=c&&h(c)?c:{},l[a]=i(g,e,d)):void 0!==d&&(l[a]=d));return l}var j={},k=j.toString,l=j.hasOwnProperty;window.feMonitor={init:function(a){if(0!=location.pathname.indexOf("/debug")){if(!window.performance||"function"!=typeof window.performance.now)return void console.warn("FE-Monitor warning:","window.performance based is not surpported.");if(!a.business)return void console.error("FE-Monitor error:","init param business is required.");this.business=a.business,this.alarmFiles=a.alarmFiles,this.limitNum=a.limitNum||2,this.limitTime=a.limitTime||3e5,this.TIMEOUT=a.timeout||8e3}},localProcessStaticRes:function(a){var b=this,c="FEMONITOR_FAILED_STATIC_RES",d="FEMONITOR_FAILED_STATIC_RES_TIME",e=localStorage.getItem(c);e=e&&JSON.parse(e)||{};for(var f=localStorage.getItem(d)||0,g=0,h=a.length;h>g;g++){var i=a[g],j=i.seqId,k=i.requestPkg;-1==i.returnCode&&(e[j]=e[j]||[],-1==e[j].indexOf(k)&&e[j].push(k))}try{localStorage.setItem(c,JSON.stringify(e))}catch(l){}var m=performance.timing.requestStart-this.limitTime,n=0,o={},p=0,q=0;for(var c in e)if(c>m){p++;for(var r=!1,s=0,h=e[c].length;h>s;s++){var i=e[c][s];o[i]=o[i]?o[i]+1:1,b.alarmFiles&&b.alarmFiles.indexOf(i)>-1&&(r=!0)}r&&(n++,q+=e[c].length||0)}var t=performance.timing.requestStart+performance.now();if(n>=this.limitNum&&t-f>this.limitTime){try{localStorage.setItem(d,t)}catch(u){}a.push({type:"resource",failCount:n,failRes:o,count:p,pageName:location.pathname,limitTime:this.limitTime,failNum:q})}return a},initHottag:function(a){if(!window.performance||"function"!=typeof window.performance.now)return void console.warn("warning:","FE-Monitor based window.performance not surpported");this.business=this.business||a.business||"undefined";var b=new m(a);return b},report:function(a){var b={uin:this.getCookieUin("uin")||"",ownerUin:this.getCookieUin("ownerUin")||"",appId:this.getCookie("appid")||"",nick:decodeURIComponent(this.getCookie("nick")||"")};"//femonitor.qcloud.com/cgi/report?reportData="+JSON.stringify(a)+"&"+d(b)},reportOwnDB:function(a){var b={uin:this.getCookieUin("uin")||"999999",ownerUin:this.getCookieUin("ownerUin")||"",appId:this.getCookie("appid")||"",nick:decodeURIComponent(this.getCookie("nick")||"")},c=new Image,d="https://femonitor.qcloud.com/report?business="+a.business+"&seqId="+a.seqId+"&pointname="+a.pointname+"&uin="+b.uin+"&code="+a.code+"&path="+a.path+"&tag="+a.tag+"&timeCost="+a.timeCost;c.src=d},reportMonitor:function(a){a.timeCost>1e4&&(a.timeCost=1e4);var b='//tudg.qq.com/dataimport/ImportService?m=dataImport&p=["100301","'+encodeURIComponent(d(a))+'"]',c=new Image;c.src=b},reportCgi:function(a){var b=this,c=this.cgiArr||[];a?(this.reportCgiHandler&&clearTimeout(this.reportCgiHandler),c.push(a),this.cgiArr=c,c.length>=5?(b.sendCgis(c),this.cgiArr=[]):this.reportCgiHandler=setTimeout(function(){b.reportCgi()},5e3)):c.length&&(b.sendCgis(c),this.cgiArr=[])},sendCgis:function(a){a=a.map(function(a){return d(a)});var b=a.join("##");if(b=encodeURIComponent(b),1==a.length)var c='//tudg.qq.com/dataimport/ImportService?m=dataImport&p=["100301","'+b+'"]';else var c='//tudg.qq.com/dataimport/ImportService?m=multiDataImport&p=["100301","'+b+'"]';var e=new Image;e.src=c},getReportMonitorParams:function(a){var b={bid:"b_teg_rt_index",sysID:"9900446",timestamp:feMonitor.getTimeStamps(),logtime:feMonitor.getLogTime()};return i(!0,{},b,a||{})},getVersionName:function(a){return a?a.replace(/(https?:)?\/\//,"").split("?")[0]:null},getNoVersionName:function(a){var b=this.getVersionName(a);return b?b.replace(/\.\w+(.js)/,"$1"):null},getCookie:function(a){var b=new RegExp("(?:^|;+|\\s+)"+a+"=([^;]*)"),c=document.cookie.match(b);return c?c[1]:""},getCookieUin:function(a){return this.getCookie(a).replace(/^[oO]|G$/g,"")},getACSRFToken:function(a){if(!a)return"";for(var b=5381,c=0,d=a.length;d>c;++c)b+=(b<<5)+a.charCodeAt(c);return 2147483647&b},prefixDate:function(a,b){var c=b?100:10;return c>a?"0"+a:a+""},getTimeStamps:function(a){return a=a||new Date,this.prefixDate(a.getFullYear())+this.prefixDate(a.getMonth()+1)+this.prefixDate(a.getDate())+this.prefixDate(a.getHours())+this.prefixDate(a.getMinutes())+this.prefixDate(a.getSeconds())},getLogTime:function(){var a=new Date;return this.getTimeStamps(a)+this.prefixDate(a.getMilliseconds(),!0)},isPathsEqual:function(a,b){var c=!0;for(var d in a)if(a.hasOwnProperty(d)){var e=a[d]&&a[d].hottags||[],f=b[d]&&b[d].hottags||[];e.length!=f.length&&(c=!1)}return c},isPathsDone:function(a){var b=!0;for(var c in a)if(a.hasOwnProperty(c)){var d=a[c]&&a[c].hottags||[];d.length&&(b=!1)}return b},onlyOptionalPathLeft:function(a){var b=!0;for(var c in a)if(a.hasOwnProperty(c)){var d=a[c]&&a[c].hottags||[];d.length&&!a[c].optional&&(b=!1)}return b}};var m=function(a){var b=this;this.onduty=a.onduty,this.business=a.business||"console",this.pageName=a.page||location.pathname;for(var c in a)a.hasOwnProperty(c)&&(a[c].hottags||delete a[c]);this.paths=i(!0,{},a),this.orginPaths=i(!0,{},a),this.t0=performance.now(),this.seqId=Math.round(performance.timing.responseStart),this.TIMEOUT=a.timeout||8e3,this.LIMIT_TIME=a.limitTime||3e5,this.LIMIT_NUM=a.limitNum||2,this.checkTime=5e3,this.lastPaths=i(!0,{},a),this.checkHandler=setTimeout(this.checkPageRenderEnd.bind(this),this.checkTime);for(var d in this.paths)this.paths.hasOwnProperty(d)&&!function(a){var c=(b.seqId,b.pageName),d="FEMONITOR_FAILED_HOTTAG",e="FEMONITOR_HOTTAG_TIME_"+c+"_"+a,f=b.paths[a],g=f.timeout||b.TIMEOUT,h=f.limitTime||b.LIMIT_TIME,i=f.limitNum||b.LIMIT_NUM;setTimeout(function(){var j=f.hottags,k=localStorage.getItem(d)||"",l=localStorage.getItem(e)||0;k=k&&JSON.parse(k)||{};var m=b.seqId+b.t0;k[c]=k[c]||{},k[c][a]=k[c][a]||{},k[c][a][m]=j.length?-j.length:0;try{localStorage.setItem(d,JSON.stringify(k))}catch(n){}if(b.orginPaths[a].hottags.length==j.length)return b.orginPaths[a].hottags=[],void(b.paths[a].hottags=[]);b.hottagEnd(a,j.length?-j.length:0);var o=0,p=0,q=0,r={},s=performance.timing.requestStart-h,t=k[c][a];for(var u in t)u>s&&(o++,t[u]<0&&(p++,q+=Number(t[u])));var v={type:"hottag",failCount:p,failNum:q,failRes:r,count:o,pageName:c,pathKey:f.name||a,timeout:g,limitTime:h,limitNum:i,leftTags:j,allTags:b.orginPaths[a].hottags,onduty:b.onduty},w=performance.timing.requestStart+performance.now(),x=j.length&&p>=i&&w-l>h;if(x)try{localStorage.setItem(e,w),feMonitor.report([v])}catch(n){}},g)}(d)};m.prototype.hottag=function(a,b){if(0!=location.pathname.indexOf("/debug")){if(!window.performance||"function"!=typeof window.performance.now)return void console.warn("warning:","FE-Monitor based window.performance not surpported");var c=this,d=this.pageName,e=this.paths[a].hottags,f=this.orginPaths[a].hottags,h=this.orginPaths[a].speedConfig,i=feMonitor.business;if(-1!=e.indexOf(b)){var j=f.indexOf(b),k=feMonitor.getReportMonitorParams({intfID:"1",business:i,page:d,path:a});if(0==j)this.paths[a].t0=performance.now(),k.point="0",k.timeCost="0",feMonitor.reportMonitor(k);else if(j==f.length-1&&(k.point="1",k.timeCost=Math.round(performance.now()-this.paths[a].t0),feMonitor.reportMonitor(k),h)){var l=h.id,m={};m[l]=k.timeCost,g(m,l)}b&&e.splice(e.indexOf(b),1),this.checkHandler&&clearTimeout(this.checkHandler),this.checkPageRenderEnd(!0);var n=0==e.length?"1":"0",o=Math.round(performance.now()-this.t0),p={caller:i,reporter:"hottag",extra5:n,callee:"femonitor",returnCode:200,time:Math.round(performance.timing.responseStart+performance.now()),interfaceName:b,requestPkg:"",responsePkg:a,group:d,timeCost:o,seqId:this.seqId};if(feMonitor.report([p]),feMonitor.reportOwnDB({business:"hottag",seqId:this.seqId,pointname:b,path:a,tag:d,code:1,timeCost:o}),0==e.length){var q="FEMONITOR_FAILED_HOTTAG",r=localStorage.getItem(q);r=r&&JSON.parse(r)||{},r[d]=r[d]||{},r[d][a]=r[d][a]||{};var s=r[d][a],t=c.seqId+c.t0;s[t]=0;try{localStorage.setItem(q,JSON.stringify(r))}catch(u){}}}}},m.prototype.hottagEnd=function(a,b){var c=this,d=this.pageName,e=(this.paths[a].hottags,{caller:feMonitor.business,reporter:"hottagend",callee:"femonitor",returnCode:b,time:performance.timing.responseStart+performance.now(),interfaceName:"",requestPkg:"",responsePkg:a,group:d,timeCost:performance.now()-c.t0,seqId:c.seqId});feMonitor.report([e])},m.prototype.checkPageRenderEnd=function(a){if(feMonitor.isPathsDone(this.paths)){var b=feMonitor.getReportMonitorParams({intfID:"2",business:this.business,page:this.pageName,result:"1",timeCost:Math.round(performance.now()-this.t0)});return feMonitor.reportMonitor(b),void feMonitor.reportOwnDB({business:"hottagend",seqId:this.seqId,pointname:"xxx",path:"xxx",tag:this.pageName,code:b.result,timeCost:b.timeCost})}if(feMonitor.isPathsEqual(this.paths,this.lastPaths)){var b=feMonitor.getReportMonitorParams({intfID:"2",business:this.business,page:this.pageName,timeCost:Math.round(performance.now()-5e3-this.t0)});return feMonitor.onlyOptionalPathLeft(this.paths)?b.result=1:b.result=0,feMonitor.reportMonitor(b),void feMonitor.reportOwnDB({business:"hottagend",seqId:this.seqId,pointname:"xxx",path:"xxx",tag:this.pageName,code:b.result,timeCost:b.timeCost})}this.lastPaths=i(!0,{},this.paths),this.checkHandler=setTimeout(this.checkPageRenderEnd.bind(this),this.checkTime)},c.exports.init=function(a,b){if("undefined"==typeof feMonitor||!feMonitor)return null;var c=feMonitor.initHottag({onduty:b,page:a,renderDialog:{name:"渲染界面",hottags:["beforeRender","renderSuccess"],timeout:5e3}});return c.renderBefore=function(){c.hottag("renderDialog","beforeRender")},c.renderSuccess=function(){c.hottag("renderDialog","renderSuccess")},c}}),define("cvm/common/simpleMarked",function(a,b,c){var d=function(){var a={link:function(a,b,c){var d='<a target="_blank" href="'+a+'"';return b&&(d+=' title="'+b+'"'),d+=">"+c+"</a>"},image:function(a,b,c){var d='<img src="'+a+'" alt="'+c+'"';return b&&(d+=' title="'+b+'"'),d+="/>"}},b=function(b,c){var d=encodeURI(c.href),e=c.text?c.text:null,f=c.title?c.title:null;return"!"!==b.charAt(0)?a.link(d,f,e):a.image(d,f,e)},c=function(a){var c={link:/\[((?:\[[^\]]*\]|\\[\[\]]|[^\[\]]|\](?=[^\[]*\]))*)\]\(\s*<?([\s\S]*?)>?(?:\s+['"]([\s\S]*?)['"])?\s*\)/g},d=a,e=c.link.exec(a);return e&&(d=a.replace(c.link,function(a,c,d,e){return b(a,{text:c,href:d,title:e})})),d};return{parse:c}}();c.exports=d}),define("cvm/cvm/cvmlist",function(a,b,c){function d(a){x.delay(2e3).then(function(){w.queryPreferentialInstance().then(function(b){var c=b.region,d=b.totalCount,e=c.regionId,g=d>0,h=d||0;if(a.$set({enableMigrate:g,totalMigrateInstances:h}),g){var i=j.getUin(),k="Migrate_Confirm_Flag_"+e+"_"+i,l=window.localStorage.getItem(k);if("1"!=l){var m=f("#migrateWrap");n.create(j.tmpl('  <div>      <p class="">您有 <span class="text-warning"> <%=totalMigrateInstances%></span> 台云服务器可免费换代</p>    <p class="text-label mt-5">感谢您长时间对腾讯云的支持，为了回馈老客户，我们将对您正在使用的部分老机型做免费升级换代，并免费延期一年</p>    <div class="media mode-machine-update">      <div class="media-left">        <img src="https://imgcache.qq.com/open_proj/proj_qcloud_v2/mc_2014/server/css/img/cvm-update.png" alt="">      </div>      <div class="media-body">        <p class="sub-title">免费换代</p>        <p class="text-label">我们将对部分S1机型免费升级到S2</p>        <p class="sub-title mt-30">免费续费1年</p>        <p class="text-label">升级换代同时，免费为您延续1年</p>      </div>    </div>    </div>',{totalMigrateInstances:h}),600,"",{struct:"rich",animation:!1,leaveTransitionClass:"none",title:"回馈老客户",defaultCancelCb:function(){try{window.localStorage.setItem(k,"1")}catch(a){}},button:{" 立即查看 ":function(){n.hide(),m.click();try{window.localStorage.setItem(k,"1")}catch(a){}}}})}}})["catch"](function(a){console.warn(a)})})}function e(a){O="undefined"!=typeof feMonitor&&feMonitor&&feMonitor.initHottag({onduty:"kennyang",page:"/cvm/index",getSearchConfig:{name:"加载搜索条件",hottags:["beforeRequest","getResponse"]},getCvmListV2:{name:"加载cvm列表",hottags:["beforeRequest","getResponse"],speedConfig:{id:28}},renderCvmListV2:{name:"渲染cvm列表",hottags:["beforeRender","renderComplete"]},getCvmMoreInfoV2:{name:"加载cvm列表更多信息",hottags:["beforeRequest","getResponse"],optional:!0,speedConfig:{id:29}},renderCvmMoreInfoV2:{name:"渲染cvm更多信息",hottags:["beforeRender","renderComplete"],optional:!0,timeout:1e4},renderGroupBtn:{name:"加载顶部地域",hottags:["beforeRequest","gotRegion","gotOvm"]}}),a=a||{},null!=a.pid&&void 0!=a.pid?k.setProjectId(a.pid):null!=a.projectId&&void 0!=a.projectId&&k.setProjectId(a.projectId);var b=g.REGIONNAMES;a.rid>0&&b[a.rid]?k.setRegionId(a.rid):a.regionId>0&&b[a.regionId]&&k.setRegionId(a.regionId),a.alias&&(a.instanceName=a.alias,delete a.alias),a.instanceName&&(a.instanceName=decodeURIComponent(a.instanceName)),a.vagueIp&&(a.searchWord=a.vagueIp,delete a.vagueIp);var c=["uInstanceIds","uHostIds","ips","zoneIdList","deviceClassList","cvmPayModeList","subnetIds"];a.uInstanceIds&&(a.uInstanceIds=a.uInstanceIds.split("|")),a.instanceId&&(a.uInstanceIds=[a.instanceId]),f(c).each(function(b,c){var d=a[c];d&&(a[c]=decodeURIComponent(d).split(","))}),S.render(a)}var f=a("$"),g=a("cvm/common/constants"),h=a("pageManager"),i=a("dropdown"),j=a("util"),k=a("appUtil"),l=(a("projectsSelector"),a("regionSelector"),a("widget/copy/copy")),m=a("widget/pills/pills"),n=a("dialog"),o=a("widget/errorTips/errorTips"),p=a("clipboard"),q=a("cvm/cvm/event/addcvm"),r=a("cvm/cvm/event/dropdown"),s=a("cvm/cvm/event/operate_entry"),t=a("cvm/cvm/event/operate_auth"),u=a("cvm/cvm/format"),v=a("cvm/cvm/cvm_grid"),w=a("cvm/cvm/data"),x=a("cvm/cvm/cvmutil"),y=a("cvm/cvm/task"),z=a("cvm/cbs2/data"),A=a("cvm/common/components/columsWidth/ColumsWidth"),B=50,C=a("cvm/common/components/ExGridview/ExGridview"),D=a("tips"),E=(a("models/api"),a("manager"),a("search"),a("router")),F=a("reporter"),G=a("qccomponent"),H=a("widget/i18n"),I=a("cvm/cvm/search_box"),J=(a("config/reactSupport"),a("lib/TickQueue")),K="导出实例列表",L=a("cvm/common/components/arrearsTip/arrearsTip"),M=new J({interval:5e3});M.start();var N,O=null,P={},Q={},R=G.extend({$tpl:'  <div class="manage-area cvm">    <style>      /* .white-btn {          background-color: #fff;          color: #000;          border: 1px solid #ddd;        } */      .tc-15-filtrate-btn>span {        display: inline-block;        max-width: 100%;        overflow: hidden;        text-overflow: ellipsis;        white-space: nowrap;      }    </style>    <div class="manage-area-title">      <h2>实 例</h2>      <div id="projectsWrapper" class="tc-select-box"></div>      <div class="manage-area-title-right">        <a href="javascript:;" id="migrateWrap" b-if="enableMigrate" b-on-click="migrate()" class="mr-10 text"><i            class=" tc-badge warning-dark">回馈</i>免费换代(<em class="text-danger">{{totalMigrateInstances}}</em>)</a>        <a href="//www.qcloud.com/document/product/213/3687" target="_blank" class="guide-link">实例使用指南 <b            class="external-link-icon"></b>        </a>      </div>      <div id="listtips"></div>    </div>    <div class="manage-area-main">      <div class="manage-area-full-inner">        <arrears-tip></arrears-tip>        <div b-if="expiredInstanceCount" class="tc-15-msg warning" id="expiredTips">          <div class="tip-info">            <span>您在{{ regionZh }}有{{                expiredInstanceCount              }}台云服务器已移入回收站，数据将保留 7 天              <a data-event="nav" href="/cvm/recycle/cvm" class="guide-link">查看<i class="external-link-icon"></i></a>            </span>          </div>          <a href="javascript:;" class="tc-icon-btn" b-on-click="closeExpiredTips()"><i class="close-icon"></i></a>        </div>        <div class="cvm-area-wrap" role="radiogroup" id="regionGroup"></div>        <div id="showTip">          <div class="tc-15-msg">            <div class="tip-info">2019年9月18日及之后创建的机器，可绑定的公网IP的数量上限按新的规则执行，详见              <a                target="_blank"                href="//cloud.tencent.com/document/product/213/5733 "              >                产品文档              </a>            </div>          </div>        </div>        <div class="tc-action-grid cvm-oper-area" b-if="showOperArea">          <div class="justify-grid">            <div class="col">              <button class="tc-15-btn m btn-add" data-event="add_cvm" data-hot="yunzhuji.new">                <b class="icon-add"></b>新建              </button>              <button class="tc-15-btn m weak disabled" data-event="cvm_oper_action" data-name="StartInstances">                开机              </button>              <button class="tc-15-btn m weak disabled" data-event="cvm_oper_action" data-name="StopInstances">                关机              </button>              <button class="tc-15-btn m weak disabled" data-event="cvm_oper_action" data-name="RebootInstances">                重启              </button>              <button b-if="!isI18n" class="tc-15-btn m weak disabled" data-event="cvm_oper_action"                data-name="RenewInstances">                续费              </button>              <button class="tc-15-btn m weak disabled" data-event="cvm_oper_action" data-name="ResetInstancesPassword">                重置密码              </button>              <div class="tc-15-dropdown tc-15-dropdown-btn-style" data-name="moreBtn">                <a href="javascript:void(0);" class="tc-15-dropdown-link">更多操作 <i class="caret"></i>                </a>              </div>            </div>            <div class="col"></div>          </div>        </div>        <div class="tc-action-grid cvm-oper-area">          <div class="justify-grid">            <div class="col">              <div id="searchArea" class="mod-stretch-search-wrap"></div>              <label b-if="showOperArea" class="form-ctrl-label"><input type="checkbox"                  b-model="isOnlyShowShutdownState" class="tc-15-checkbox ml-10" />只查看待回收实例</label>            </div>            <div class="col">              <button type="button" class="tc-15-btn weak m refresh" qc-popover="刷新" data-position="top"                data-event="refresh">                刷新              </button>              <button class="tc-15-btn weak m setting" qc-popover="设置列表字段" data-position="top" data-event="set_Fields"                data-hot="yunzhuji.setfields" data-grid-setting="true"></button>              <button class="tc-15-btn weak m download" id="dowloadQc" qc-popover="{{ downloadTip }}"                data-position="top" data-hide-destroy="true" data-event="cvm_oper_action" data-name="export"></button>            </div>          </div>        </div>        <!-- 表格 结束 -->        <div id="cvmList" class="tc-table-grid tc-table-grid-cvm"></div>      </div>    </div>  </div>',
closeExpiredTips:function(){f("#expiredTips").hide()},migrate:function(){var a=s.getModuleMap(),b=a.Migrate,c=new b.module;c.exec&&c.exec()}});R.tag("arrears-tip",L);var S={param:{},title:"实例-控制台",pageClass:"",renderBtnGroup:function(a){var b=this;b.tickQueue=M,/backfrom=cvmdetai/.test(location.search)?(O&&O.hottag("getSearchConfig","beforeRequest"),I.init(function(a,c){O&&O.hottag("getSearchConfig","getResponse"),b.gridView.statusFilter&&b.gridView.statusFilter.setFilterResult(a.instanceState||null),b.gridView.zoneNameFilter&&b.gridView.zoneNameFilter.setFilterResult(a.zoneIdList?a.zoneIdList:null),b.gridView.deviceTypeFilter&&b.gridView.deviceTypeFilter.setFilterResult(a.deviceClassList?a.deviceClassList:null),b.gridView.cvmPayModeFilter&&b.gridView.cvmPayModeFilter.setFilterResult(a.cvmPayModeList?a.cvmPayModeList:null),b.gridView.projectFilter&&b.gridView.projectFilter.setFilterResult(a.projectId?a.projectId:null),b.searchData=a;var d=JSON.parse(localStorage.getItem("CVM_QUERY_HISTORY"))||{};a=d.res||[];var e=d.returnData||{};I.boxContainer.setState({value:a});var g=d.page||1;b.renderList(f.extend({page:g},e))})):(I.setDefaultData(a),O&&O.hottag("getSearchConfig","beforeRequest"),I.init(function(a,c){O&&O.hottag("getSearchConfig","getResponse"),b.gridView.statusFilter&&b.gridView.statusFilter.setFilterResult(a.instanceState?a.instanceState:null),b.gridView.zoneNameFilter&&b.gridView.zoneNameFilter.setFilterResult(a.zoneIdList?a.zoneIdList:null),b.gridView.deviceTypeFilter&&b.gridView.deviceTypeFilter.setFilterResult(a.deviceClassList?a.deviceClassList:null),b.gridView.cvmPayModeFilter&&b.gridView.cvmPayModeFilter.setFilterResult(a.cvmPayModeList?a.cvmPayModeList:null),b.gridView.projectFilter&&b.gridView.projectFilter.setFilterResult(a.projectId?a.projectId:null),b.diffData(b.searchData,a)||(b.searchData=a,b.renderList(f.extend({page:1},a)))})),O&&O.hottag("renderGroupBtn","beforeRequest"),w.getValidRegions().then(function(a){O&&O.hottag("renderGroupBtn","gotRegion"),b.regionIds=a.regionIds;var c=k.getRegionId();a.regionMap[c]||(c=a.regionList[0].value,k.setRegionId(c)),b.regionId=c,f("#regionGroup").empty(),b.regionPills=new m({renderTo:f("#regionGroup"),data:a.regionList,newMode:!0,change:function(c){var d=b.regionPills.val();return Q[d]?void E.navigate("/ovm?region="+Q[d].value):(a.regionMap[d]||(d=a.regionList[0].value,k.setRegionId(d)),k.setRegionId(d),b.regionId=d,b.gridView.page=1,b.gridView.count=B,void b.reload())}}),b.mainBee.$set("showOperArea",!0),b.regionPills.val(b.regionId),b.renderRegionOverview(a.regionList)})},updateDownloadPopTile:function(){var a=this;a.mainBee.$set("downloadTip",K),f("[data-name = export]").removeClass("disabled"),f(f("[data-name = export]")[0]).attr("data-title","")},diffData:function(a,b){try{if(!a&&b)return!1;var c=Object.getOwnPropertyNames(a),d=Object.getOwnPropertyNames(b);if(c.length!==d.length)return!1;for(var e=0,f=c.length;f>e;e++)if(a[c[e]]instanceof Array&&b[c[e]]instanceof Array){for(var g=[].concat(a[c[e]]),h=[].concat(b[c[e]]),i=0,j=g.length;j>i;i++){var k=g[i],l=h.indexOf(k);if(-1==l)return!1;h.splice(l,1)}if(h.length)return!1}else if(a[c[e]]!==b[c[e]])return!1;return!0}catch(m){return console.log(m),!1}},renderRegionOverview:function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],b=this;Promise.all([b.getInstanceStatistics(a.map(function(a){return a.value})),w.queryOvmRegion()]).then(function(c){O&&O.hottag("renderGroupBtn","gotOvm");var d=c&&c[0]&&c[0].response.instanceStatisticsSet||[],e=c[1],g=[],h=[];if(e.length){for(var i=0;i<e.length;i++){var j=e[i];Q[j.region_id]={value:j.value,name:j.name},j.vm_cnt>0&&(g.push({name:j.name,value:j.region_id}),h.push({regionId:j.region_id,validCvmNum:j.vm_cnt,name:j.name,isOvm:1,newFlag:0}))}b.regionPills&&b.regionPills.setData(a.concat(g))}h.length>0&&(d=d.concat(h)),f(d).each(function(a,c){b.setRegionNum(c,"overview"),c.regionId==b.regionId&&b.refreshExpiredTips(c,c.regionId)}),b.cvmRegionNums=d,b.updateDownloadPopTile()})},refreshRegionOverview:function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:k.getRegionId(),b=this;b.getInstanceStatistics([a]).then(function(a){var c=a.response&&a.response.instanceStatisticsSet&&a.response.instanceStatisticsSet[0];c&&(b.setRegionNum(c,"overview"),c.regionId==b.regionId&&b.refreshExpiredTips(c,c.regionId))})},refreshExpiredTips:function(a,b){this.mainBee.$set("regionZh",g.REGIONNAMES[b]),this.mainBee.$set("expiredInstanceCount",a.expiredInstanceCount)},getInstanceStatistics:function(a){var b=[];return a.forEach(function(a,c,d){var e=x.getRegion(a);e&&b.push(e)}),w.describeInstanceStatistics({filters:[{Name:"region",Values:b}],regionId:1},{camTips:!1})},filterOvmRegionList:function(a,b){for(var c=[],d=0;d<a.length;d++){var e=a[d];e.vm_cnt>0&&(c.push({name:e.name,value:e.region_id}),b.push({regionId:e.region_id,validCvmNum:e.vm_cnt,name:e.name,isOvm:1,newFlag:0}))}return c},updateUserCvmOverview:function(a){var b=this.regionPills&&this.regionPills.$el.find("button[data-value="+a.regionId+"]"),c=b.data("newFlag");if(0!=c){var d=g.REGIONNAMES,e=d[a.regionId];b.html(e+"("+b.data("validNum")+")");var f=[];f.push({regionId:a.regionId,newFlag:0}),w.updateUserCvmOverview({cvmOverviews:f}).then(function(a){})}},setRegionNum:function(a,b){a.regionId=x.getRegionNum(a.regionId||a.region),a.newFlag=a.newFlag||a.newInstanceCount>0?1:0,a.validCvmNum=a.validCvmNum||a.totalCount||0;var c=this.regionPills&&this.regionPills.$el.find("button[data-value="+a.regionId+"]");if(c&&("overview"!=b||0!=c.data("validflag"))){var d=g.REGIONNAMES,e=a.isOvm?a.name:d[a.regionId];1==a.newFlag?(c.html(e+"("+a.validCvmNum+")<span class='new-dot-mark'></span>"),c.attr("data-title","该地域有新购实例")):(c.html(e+"("+a.validCvmNum+")"),c.removeAttr("data-title")),c.data("validNum",a.validCvmNum),c.data("validflag",1),c.data("newFlag",a.newFlag)}},render:function(a){O&&O.hottag("renderCvmListV2","beforeRender"),O&&O.hottag("renderCvmMoreInfoV2","beforeRender");var b=this;a=a||{},b.mainBee=new R({$data:{migrateSupport:!1,isI18n:k.isI18n(),downloadTip:K,isOnlyShowShutdownState:!1,showOperArea:!1},$afterInit:function(){this.$watch("isOnlyShowShutdownState",function(){this.onekeySearch()})},onekeySearch:function(){if(b.gridView&&b.gridView.statusFilter){var a=null;a=this.isOnlyShowShutdownState?Object.keys((b.gridView.statusFilter.filterResult||[]).concat("SHUTDOWN").reduce(function(a,b){return a[b]=!0,a},{})):b.gridView.statusFilter.filterResult?b.gridView.statusFilter.filterResult.filter(function(a){return"SHUTDOWN"!=a}):null,b.gridView.statusFilter.setFilterResult(a)}}}),nmc.render(b.mainBee.$el,"cvm");var c=!k.isI18n();this.bee=G.mount(h.appArea.children()[0],f.extend({showActivity:c},H.getBeeConfig())),this.cvmListEl=f("#cvmList"),this.gridContainerWidth=this.cvmListEl.width(),this.searchAreaEl=f("#searchArea"),z.getTagKeyList().then(function(c){var d=c&&c.data&&c.data.rows.map(function(a){return{key:"label_"+a,name:a,_minWidth:72,_maxWidth:120,hide:!0}})||[];b.initGridView(d),b.renderGridView(a)},function(c){b.initGridView([]),b.renderGridView(a),console.warn(c.message)}),d(b.mainBee)},renderGridView:function(a){var b=this;b.cacheFilterConfig=null,b.searchData=null,b.renderBtnGroup(a),H.syncThen(function(a){if(a){var c=b.gridViewOptions.$data,d=c.colums=c.colums.filter(function(a){return a.i18n!==!1});b.gridView&&b.gridView.setColums(d)}}),b.gridView=new C(b.gridViewOptions),b.bindEvent(),b.cvmListEl.empty().append(b.gridView.$el)},updateGridColumsWithLabel:function(){var a=this;return z.getTagKeyList().then(function(b){var c=b.data.rows.map(function(a){return{key:"label_"+a,name:a,_minWidth:72,weight:4,hide:!0}}),d=v.colums.slice(-1),e=v.colums.slice(0,-1).concat({hide:!0,line:!0},c,d);a.gridView.setColums(A(e))},function(a){console.warn(a.message)})},initCopy:function(){var a=this.cvmListEl.find(".ip-cell"),b=a.find("[data-clipboard-text]");new l({handle:b,container:a})},initGridView:function(a){this.gridViewOptions=v.get(this,a)},operActionEvent:function(a,b){var c=this,d=f(a).data("name"),e=s.getModuleMap(),g=b.every(function(a){return!!a.opsAvailable});if(g){if(!(b&&b.length>0||"export"===d))return void D.error("请选择实例。");c.isNetworkShiftUpUser&&1==b.length&&"upgradebandwidth"==d&&b[0].deviceWanIp&&b[0].eipInfo&&(d="upgradeEipBandwidth");var h=e[d],i=e[d].name,j=e[d].hotTag,k=new h.module({listIns:c,button:f(a),selectedItems:b}),l=new t({whiteList:this.whiteList,dataItems:b,operAction:s.getModuleArr(),operActionModuleMap:s.getModuleMap(),listIns:c,check:function(a,b){return c.checkOperateStatus(a,b)}});k.operateAuth=l;var m=k.resolvePerm(b,d,i);if(k.cloudAPIActionNameMap=c.cloudAPIActionNameMap,k.permResult=m,k.hasPermItems=m.hasPermItems,k.selectedItems=m.hasPermItems,k.selectedShowOptions=m.selectedShowOptions,k.args=arguments,k.exec&&k.exec(),j){var n=k.selectedItems[0];n&&n.osType&&"yunzhuji.showvnc"==j&&(j+="linux"==n.osType?"_linux":"_windows"),F.click(j)}}},checkOperAction:function(a){var b=this,c=b.gridView.getSelected();a=a||c||[];var d=new t({whiteList:this.whiteList,dataItems:a,operAction:s.getModuleArr(),operActionModuleMap:s.getModuleMap(),listIns:this,check:function(a,c){return b.checkOperateStatus(a,c)}}),e=s.getModuleMap();for(var g in e){var h=e[g],i=f(".cvm-oper-area").find('[data-event=cvm_oper_action][data-name="'+g+'"]');if(i){var j=new h.module({listIns:this,button:i,selectedItem:[]});j.refresh&&j.refresh(a,g,d)}}},refreshItemOperAction:function(a){a=a||[];var b=this,c=f(b.gridView.$refs.body);a.forEach(function(a){var d=new t({whiteList:b.whiteList,dataItems:[a],operAction:s.getModuleArr(),operActionModuleMap:s.getModuleMap(),listIns:b,check:function(a,c){return b.checkOperateStatus(a,c)}}),e=s.getModuleMap(),f=c.find("tr[data-uinstanceid="+a.instanceId+"]");for(var g in e){var h=e[g],i=f.find('[data-event=cvm_oper_action][data-name="'+g+'"]');if(i){var j=new h.module({listIns:b,button:i,selectedItem:[a]});j.refresh&&j.refresh([a],g,d)}}}),b.refreshItemDataTitle(a)},refreshItemDataTitle:function(a){a.forEach(function(a){var b=f("tr[data-uinstanceid="+a.instanceId+"]").find(".ip-cell").parents("td");if(b.length){var c=b.find(".convert-ip-icon").attr("data-title");if(c)return;var d=a.ipConfig.eipQuotaData;d&&(c=d.currentEipNum<d.eipNumQuota?"IP保持不变，转为弹性公网IP，您最多可开通"+d.eipNumQuota+"个弹性公网IP，已开通"+d.currentEipNum+"个。":"弹性公网IP已达到"+d.eipNumQuota+"个上限，无法转换",b.find(".convert-ip-icon").attr("data-title",b.find(".convert-ip-icon").attr("data-title")||c))}})},checkOperateStatus:function(a,b){for(var c=0;c<a.length;c++)if(P[a[c].instanceId])return"该实例有操作正在进行中，请等待完成后再操作";return""},getSelectItem:function(a){var b=this,c=[];return f(b.gridView.list).each(function(b,d){a.each(function(a,b){var e=f(b).closest("tr").data("uinstanceid");d.uInstanceId==e&&(d.el=f(b).closest("tr"),c.push(d))})}),c},showTask:function(a,b,c,d){y.check({listIns:this,task:a,tipTxt:b,from:c,objBase:d})},refresh:function(){this.renderList()},reload:function(){var a=JSON.parse(localStorage.getItem("CVM_QUERY_HISTORY"))||{};a.page=this.gridView.page;try{localStorage.setItem("CVM_QUERY_HISTORY",JSON.stringify(a))}catch(b){console.warn(b)}this.refreshRegionOverview(this.regionId);var c=null;/backfrom=cvmdetai/.test(location.search)&&(c=f.extend({page:this.gridView.page},a.returnData||{})),this.renderList(c)},formatQueryInstanceParams:function(a){var b={},c=a.filters||[];a.projectId&&(a.projectId.forEach(function(b,c){-1===b&&a.projectId.splice(c,1)}),0==a.projectId.length&&delete a.projectId);var d={uInstanceIds:"instance-id",instanceState:"instance-state",projectIdList:"project-id",projectId:"project-id",zoneIdList:"zone",deviceClassList:"instance-family",cvmPayModeList:"instance-charge-type",uHostIds:"host-id",psId:"disaster-recover-group-id",vpcId:"vpc-id",subnetIds:"subnet-id",preciseInstanceName:"instance-name"};Object.keys(d).map(function(b){"undefined"!=typeof a[b]&&c.push({name:d[b],values:"[object Array]"==Object.prototype.toString.call(a[b])?a[b]:[a[b]]})}),1==a.recycleId&&c.push({name:"restrict-state",values:["EXPIRED"]},{name:"instance-charge-type",values:["PREPAID"]});var e,f=a.tag&&a.tag[0];f&&(e=f.split(/[,\;]/).forEach(function(a){var b=a.split(":"),d=b[0],e=b[1];d?void 0===e?c.push({name:"tag-key",values:[d]}):c.push({name:"tag:"+d,values:[e]}):c.push({name:"tag-value",values:[e]})})),b={filters:c,offset:a.offset||0,limit:a.limit||50,regionId:a.regionId||k.getRegionId()};var g={searchWord:"vagueIpAddress",ips:"ipAddresses",vagueInstanceName:"vagueInstanceName"};return Object.keys(g).map(function(c){"undefined"!=typeof a[c]&&(b[g[c]]=a[c])}),b},getFormattedCvmInfo:k.mutePrior(function(a,b){var c=S,d=c.formatQueryInstanceParams(a);return O&&O.hottag("getCvmListV2","beforeRequest"),Promise.all([w.queryCvmList2(d,b),w.getCvmWhiteList(),w.getProjects(),w.getCvmFilterConfig(a,b),w.checkBandwidthPackage({regionId:a.regionId}),w.queryBandwidthPackageList({regionId:a.regionId}),w.queryCVMActions({CloudProductList:[{ProductName:"cvm",ProductVersion:"2017-03-12"},{ProductName:"vpc",ProductVersion:"2017-03-12"}]})]).then(function(b){O&&O.hottag("getCvmListV2","getResponse");var d=b[0]&&b[0].response||{},e=d.instanceSet||[],f=b[1],g=b[2],h=b[3],i=f.PrepaidForCVM&&f.PrepaidForCVM.length>0,j=!!b[4],l=b[5],m=b[6]||{},n=f.CVM_REFUND&&f.CVM_REFUND.length>0,o=f.CBS_REFUND&&f.CBS_REFUND.length>0,p=f.network_shift_up&&f.network_shift_up.length>0,q=f.allow_system_data_copy&&f.allow_system_data_copy.length>0,r=f.ASYNC_EXPORT_CVM&&f.ASYNC_EXPORT_CVM.length>0,s=[],t=[];return I.setData(h),a.regionId==N&&c.cacheFilterConfig||(c.cacheFilterConfig=h,N=a.regionId,c.gridView.updateListHeadValue(h)),c.projectData=g,g&&g.length>0?c.notShow_changeproject=!1:c.notShow_changeproject=!0,c.whiteList=f,c.isI18n=k.isI18n(),c.isBandwidthPackageUser=j,c.isPrepaidUser=i,c.isNetworkShiftUpUser=p,c.cloudAPIActionNameMap=m,c.isAsyncExport=r,e.forEach(function(b){b.whiteList=f,b.isBandwidthPackageUser=c.isBandwidthPackageUser,b.isPrepaidUser=c.isPrepaidUser,b.isCvmRefundUser=n,b.isCbsRefundWhite=o,b.isNetworkShiftUpUser=p,b.isShowSystemDiskDataCopy=q,b.bandwidthPackageList=l,b.regionId=a.regionId,t.push(b.instanceId)}),e=u.get(e,{whiteList:f,cloudAPIActionNameMap:m,projectData:g,regionId:a.regionId,instanceFamilies:h.instanceFamilies&&h.instanceFamilies.nodes||[],zones:h.zones&&h.zones.nodes||[]}),s=e.filter(function(a){return!!a.deviceWanIp}).map(function(a){return a.deviceWanIp}),{params:a,deviceList:e,uInstanceIds:t,wipArr:s,cvmListData:d,cvmListErrors:d.error,whiteList:f}})}),getFormattedCvmMoreInfo:k.mutePrior(function(a,b){var c=a.deviceList,d=a.wipArr,e=a.uInstanceIds,h=a.regionId,i=g.REGIONMAP,j=[],k=[],l=[];c.forEach(function(a){a.imageId&&-1===j.indexOf(a.imageId)&&j.push(a.imageId),a.deviceWanIp&&k.push(a.deviceWanIp),a.virtualPrivateCloud.vpcId&&-1===l.indexOf(a.virtualPrivateCloud.vpcId)&&l.push(a.virtualPrivateCloud.vpcId)});var m=new Promise(function(a,c){d.length?w.queryIpBlockInfo({vipList:d,region:h},b).then(function(b){a(b&&b.list||[])},function(b){a({error:b})}):a([])}),n=new Promise(function(a,d){var e=i[h],f=c.filter(function(a){return a.isSafeIsolated&&a.deviceWanIp}).map(function(a){return{Area:e,Uuid:a.uuid,WanIp:a.deviceWanIp}});f.length?w.queryUnBlockInfo({UuidList:f},b).then(a,function(b){a({error:b})}):a([])}),o=[w.queryEipQuota({regionId:h},b)["catch"](function(a){return{error:a}}),m["catch"](function(a){return{error:a}}),n["catch"](function(a){return{error:a}}),w.queryInstancesConnectivity({instanceIds:e,regionId:h},b)["catch"](function(a){return{error:a}}),new Promise(function(a,c){j.length?w.queryImages({filters:[{name:"image-id",values:j}],limit:j.length,regionId:h},b).then(a,function(b){a({error:b})}):a([])}),new Promise(function(a,c){k.length?w.queryEip({filters:[{name:"address-ip",values:k}],limit:k.length,regionId:h},b).then(a,function(b){a({error:b})}):a([])}),new Promise(function(a,c){l.length?w.queryVpc({vpcId:l,regionId:h},b).then(a,function(b){a({error:b})}):a([])}),w.queryInstanceStatus({instanceIds:e,regionId:h},b)["catch"](function(a){return{error:a}}),new Promise(function(a,c){w.queryInstancesActionTimer({instanceIds:e,regionId:h},b).then(a,function(b){a({error:b})})}),new Promise(function(a,c){w.queryInstancesDeniedActions({instanceIds:e,regionId:h},b).then(a,function(b){a({error:b})})}),new Promise(function(a){w.queryPaiInfo({instanceIds:e,regionId:h},f.extend({},b,{v3:!1})).then(a,function(b){a({error:b})})}),w.queryInstanceReturnable({instanceIds:e,limit:e.length},h,b)["catch"](function(a){return{error:a}})];return O&&O.hottag("getCvmMoreInfoV2","beforeRequest"),Promise.all(o).then(function(b){O&&O.hottag("getCvmMoreInfoV2","getResponse");var d=b[0]?b[0].eipQuotas?b[0].eipQuotas.nodes:b[0]:[],e=b[3]&&b[3].response&&b[3].response.instanceConnectivitySet?b[3].response.instanceConnectivitySet:b[3]||[],f=b[4]&&b[4].images?b[4].images.nodes:b[4]||[],g=b[5]&&b[5].response&&b[5].response.addressSet?b[5].response.addressSet:b[5]||[],h=b[6]&&b[6].data?b[6].data:b[6]||[],i=b[7]&&b[7].response&&b[7].response.instanceStatusSet?b[7].response.instanceStatusSet:b[7]||[],j=b[8]&&b[8].response&&b[8].response.actionTimers?b[8].response.actionTimers:b[8]||[],k=b[9].response&&b[9].response.instanceDeniedActionSet||[],l=b[10].response&&b[10].response.paiInstanceSet||[],m=b[11].response&&b[11].response.instanceReturnableSet||[];return u.getMore(c,{eipQuota:d,ipBlocked:b[1],unblockable:b[2],instanceStatusList:i,instanceReturnableStatusList:m,connectivityList:e,imageList:f,eipList:g,vpcList:h,actionTimerList:j,instanceDeniedActionList:k,paiInstanceSet:l}),{params:a,deviceList:c}},function(a){console.error(a)})["catch"](function(b){return console.warn(b),{params:a,deviceList:c}})}),renderList:function(a){P={};var b=this;a=a||b.searchData||{},w.getValidRegions().then(function(c){var d=k.getRegionId();c.regionMap[d]||(d=c.regionList[0].value,k.setRegionId(d)),b.regionId=d,a.regionId=d;var e=a&&a.page>0?a.page:b.gridView.page,g=a&&a.count>0?a.count:b.gridView.count;a.offset=(e-1)*g,a.limit=g,"undefined"==typeof a.projectId&&-1!=k.getProjectId()&&(a.projectId=k.getProjectId());var h="";(a.psId||a.instanceName||a.instanceState||a.uInstanceIds||a.ips||a.searchWord||"undefined"!=typeof a.projectId&&-1!=a.projectId||a.zoneIdList||a.deviceClassList||a.cvmPayModeList||a.tag||"undefined"!=typeof a.vpcId||"undefined"!=typeof a.subnetIds||"undefined"!=typeof a.uHostIds)&&(h="not empty"),b.gridLoaded=!1,b.queryInstanceParams=b.formatQueryInstanceParams(a),b.getFormattedCvmInfo(a,{tipErr:!1,camTips:!1,withoutDefaultFilter:!0}).then(function(a){var c=a.params;a.deviceList.length>0&&b.renderMoreInfo({cvmListData:a.cvmListData,deviceList:a.deviceList,uInstanceIds:a.uInstanceIds,wipArr:a.wipArr,searchKey:h,page:Math.floor(c.offset/c.limit)+1,count:c.limit,regionId:c.regionId}).then(function(){var d=a.deviceList.filter(function(a){return"SHUTDOWN"!=a.instanceState||a.isolatedTime?x.isLoadingStatus(a)||x.isDuringExclusionOperation(a):!0});M.remove("cvm").push({id:"cvm",data:{regionId:c.regionId,loadingCVMList:d},work:b.inspectCvm.bind(b)})});var c=a.params;b.isPrepaidUser||f("#listtips").append('  <div    style="position:absolute;z-index:99;font-size:12px;line-height:20px;right:140px;top:15px;padding:5px 8px;background:#fffee7;border:1px solid #f2ba23;color:#264663;box-shadow:0 1px 3px rgba(0,0,0,.1)"  >    当前实例为后付费月结的购买方式，现在去    <a      href="https://console.qcloud.com/workorder/category/create?level1_id=6&level2_id=7&level1_name=%E8%AE%A1%E7%AE%97%E4%B8%8E%E7%BD%91%E7%BB%9C&level2_name=%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8%20CVM"      class=""      >切换到预付费</a    >购买方式，    <a target="_blank" href="https://www.qcloud.com/doc/product/213/5041"      >详细说明</a    >  </div>');var d=a.whiteList.CVM_LARGERLIST&&a.whiteList.CVM_LARGERLIST.length>0;if(d){var e=b.gridView.$refs.pager;e.maxCount=200,e.minCount=50,e.countInterval=50}b.gridLoaded=!0,b.gridView.hideTips(),b.gridView.$set({totalNum:a.cvmListData.totalCount,page:Math.floor(c.offset/c.limit)+1,count:c.limit||B,loading:!1}),b.spliceRender(a,function(){b.checkOperAction(),b.refreshItemOperAction(b.gridView.list),b.showTableTips(a.deviceList,a.cvmListData,h,a.cvmListErrors),b.bindEvent2(a.deviceList)}),O&&O.hottag("renderCvmListV2","renderComplete")}).fail(function(c){b.gridView.setData({list:[],totalNum:0,page:Math.floor(a.offset/a.limit)+1,count:0}),o.isCamRefused(c)?(c.message=c&&c.message||"页面加载中，您可以尝试刷新页面",b.gridView.showTips("<div><cam-tips>"+c.message+"</cam-tips></div>")):b.showTableTips([],[],h,[c])})})},spliceRender:function(a,b){function c(){var g=Math.min(f,a.deviceList.length-e);return 0>=g?(d.gridView.list.length>a.deviceList.length&&d.gridView.list.splice(a.deviceList.length,d.gridView.list.length-a.deviceList.length),void(b&&b())):(d.gridView.list.splice.apply(d.gridView.list,[e,g].concat(a.deviceList.slice(e,e+g))),e+=g,void setTimeout(function(){c()},0))}var d=this,e=0,f=10;c()},showTableTips:function(a,b,c,d){var e=this,g=d&&d[0]&&d[0].message||"页面加载中，您可以尝试刷新页面";if(0==a.length)d&&d.length>0?c?e.gridView.showTips('<span class="text" style="word-wrap:break-word;">'+g+'<a data-event="cvmnav" href="javascript:void(0);">返回列表</a></span>'):e.gridView.showTips('<span class="text" style="word-wrap:break-word;">'+g+"</span>"):c?e.gridView.showTips('<span class="text">抱歉，没有找到相关实例，尝试其他搜索条件。</span><a data-event="cvmnav" href="javascript:void(0);">返回列表</a>'):(e.gridView.showTips('<span class="text">当前项目下实例列表为空，您可以<a href="javascript:void(0);" data-event="list_add_cvm" data-hot="yunzhuji.new">新建</a>一台实例</span>'),f("[data-event=list_add_cvm]").click(q.add));else if(c){var h=I.boxContainer.tagSearchRef,i=h.state.tags,j="";i.forEach(function(a){j+=a.attr?a.attr.name+":"+a.values.map(function(a){return a.name}).join(" | ")+"; ":a.values.map(function(a){return a.name}).join(" | ")+"; "}),e.gridView.showTips('<div><p class="text-center mb-5">搜索'+j+'</p><p class="text-center">共找到<i class="text-danger">'+b.totalCount+'</i>条结果，<a data-event="cvmnav" href="javascript:void(0);">返回列表</a></p></div>')}f("[data-event=cvmnav]").unbind().click(function(){e.gridView.page=1,e.gridView.count=B,k.setProjectId(-1);try{localStorage.setItem("CVM_QUERY_HISTORY",JSON.stringify({}))}catch(a){console.warn(a)}E.navigate("/cvm")})},filterhange:function(a,b){var c=S;if(c.gridLoaded){c.gridView.page=1,c.gridView.count=B,a.instanceState&&c.mainBee.$set("isOnlyShowShutdownState",!!a.instanceState.find(function(a){return"SHUTDOWN"==a}));var d=[];I.setSearchValue(a,d,b),I.boxContainer.setState({value:d});var e=I.boxContainer.tagSearchRef;e.notify(e.state.tags)}},renderMoreInfo:function(a){var b=this;return D.stopLoading(),D.setLoading(!1),this.getFormattedCvmMoreInfo(a,{tipErr:!1,camTips:!1}).then(function(a){function c(){if(d>=b.gridView.list.length)return b.initCopy(),b.refreshItemOperAction(b.gridView.list),void b.checkOperAction();var a=b.gridView.list[d],h=g.find("tr[data-uinstanceid="+a.instanceId+"]");b.gridView.list.$set(d,a);var i=b.gridViewOptions.getCellContent(a.deviceWanIp,a,{key:"status"}),j=h.find(".dev-status").parents("td");j.html("<div>"+i+"</div>");var k=b.gridViewOptions.getCellContent(a.deviceWanIp,a,{key:"ip"}),l=b.gridViewOptions.getCellContent(a,a,{key:"_operCol"});if(k){var m=h.find(".ip-cell").parents("td"),n=h.find(".cvm-oper-cell").parents("td");if(b.isNetworkShiftUpUser&&a.eip&&n.html("<div>"+l+"</div>"),m.length){m.html(k);var o=m.find("[data-clipboard-text]");o.each(function(a,b){var c=f(b).attr("data-clipboard-text");if(c&&"-"!=c){var d=new p(b,{text:function(){return c}});d.on("success",function(){D.success("复制成功")}),d.on("error",function(a){D.error("您的浏览器不支持一键复制，请选中文本后用 Ctrl + C 快捷键进行复制"),console.warn(a)})}}),b.refreshItemDataTitle([a])}}if(a.terminateTimer){var q=b.gridViewOptions.getCellContent(a.deviceWanIp,a,{key:"cvmPayModeDesc"});q&&h.find(".cvmPayModeDesc").html(q)}d+=e,setTimeout(function(){c()},0)}D.setLoading(!0);var d=(a.params,0),e=1,g=f(b.gridView.$refs.body);c(),O&&O.hottag("renderCvmMoreInfoV2","renderComplete")},function(a){console.log(a)})},bindEvent2:function(a){var b=this,c=f("#cvmList");r.init(c,b),f("#cvmList").on("mouseover","tr[data-uinstanceid]",function(a){f(this).find(".tc-bubble").css("visibility","visible")}).on("mouseout","tr[data-uinstanceid]",function(a){f(this).find(".tc-bubble").css("visibility","hidden")}),b.notShow_changeproject?f(".cvm-oper-area").find("[data-name=ModifyInstancesProject]").remove():f(".cvm-oper-area").find("[data-name=ModifyInstancesProject]").show()},bindEvent:function(){var a=this;w.getCvmWhiteList().then(function(b){f(".cvm-oper-area").find(".tc-15-dropdown").append(j.tmpl(b.CVMpiliang?'  <ul class="tc-15-dropdown-menu" id="cvmBatchOperationNewButtonGroup">    <li data-event="cvm_oper_action" data-name="TerminateInstances">      <a href="javascript:;">销毁/退还</a>    </li>    <li class="has-submenu">      <a href="javascript:;">实例设置</a>      <ul class="tc-15-dropdown-menu" style="display:none">        <li          role="presentation"          data-event="cvm_oper_action"          data-name="ModifyInstancesAttribute.InstanceName"        >          <a role="menuitem" href="javascript:void(0);">改名</a>        </li>        <li data-event="cvm_oper_action" data-name="export">          <a href="javascript:;">导出实例</a>        </li>        <li role="presentation" data-event="cvm_oper_action" data-name="tag">          <a href="javascript:;">编辑标签</a>        </li>        <li          role="presentation"          data-event="cvm_oper_action"          data-name="ModifyInstancesProject"          style="display:none;"        >          <a href="javascript:;">分配至项目</a>        </li>        <li data-event="cvm_oper_action" data-name="ModifyInstancesRenewFlag">          <a href="javascript:;">设置自动续费</a>        </li>        <li          role="presentation"          data-event="cvm_oper_action"          data-name="ModifyInstancesChargeType"        >          <a role="menuitem" href="javascript:;">按量转包年包月</a>        </li>        <li          role="presentation"          data-event="cvm_oper_action"          data-name="BindAutoSnapshotPolicy"        >          <a role="menuitem" href="javascript:;">设置定时快照策略</a>        </li>      </ul>    </li>    <li      role="presentation"      data-event="cvm_oper_action"      data-name="AssociateInstancesKeyPairs"    >      <a role="menuitem" href="javascript:void(0);">加载密钥</a>    </li>    <li class="has-submenu">      <a href="javascript:;">资源调整</a>      <ul class="tc-15-dropdown-menu" style="display:none">        <% if(whiteList&&whiteList.CVM_BatchAdjustConfAll){%>    <li role="presentation" data-event="cvm_oper_action" data-name="ResetInstancesType">      <a role="menuitem" href="javascript:void(0);">调整配置</a>    </li>    <%}%>        <li          role="presentation"          data-event="cvm_oper_action"          data-name="ResetInstancesInternetMaxBandwidth"        >          <a role="menuitem" href="javascript:void(0);">调整网络</a>        </li>        <li          data-event="cvm_oper_action"          data-name="ModifyInstancesVpcAttribute"        >          <a href="javascript:;">切换私有网络</a>        </li>      </ul>    </li>    <li data-event="cvm_oper_action" data-name="AssociateSecurityGroups">      <a href="javascript:;">加入安全组</a>    </li>  </ul>':'  <ul class="tc-15-dropdown-menu">    <li role="presentation" data-event="cvm_oper_action" data-name="AssociateInstancesKeyPairs">      <a role="menuitem" href="javascript:void(0);">加载密钥</a>    </li>    <li role="presentation" data-event="cvm_oper_action" data-name="ModifyInstancesChargeType">      <a role="menuitem" href="javascript:;">按量转包年包月</a>    </li>    <li role="presentation" data-event="cvm_oper_action" data-name="BindAutoSnapshotPolicy">      <a role="menuitem" href="javascript:;">设置定时快照策略</a>    </li>    <li data-event="cvm_oper_action" data-name="ModifyInstancesRenewFlag">      <a href="javascript:;">设置自动续费</a>    </li>    <li role="presentation" data-event="cvm_oper_action" data-name="ModifyInstancesProject" style="display:none;">      <a href="javascript:;">分配至项目</a>    </li>    <li role="presentation" data-event="cvm_oper_action" data-name="tag">      <a href="javascript:;">编辑标签</a>    </li>    <li role="presentation" data-event="cvm_oper_action" data-name="ModifyInstancesAttribute.InstanceName">      <a role="menuitem" href="javascript:void(0);">改名</a>    </li>    <li data-event="cvm_oper_action" data-name="ModifyInstancesVpcAttribute">      <a href="javascript:;">切换私有网络</a>    </li>    <% if(whiteList&&whiteList.CVM_BatchAdjustConfAll){%>    <li role="presentation" data-event="cvm_oper_action" data-name="ResetInstancesType">      <a role="menuitem" href="javascript:void(0);">调整配置</a>    </li>    <%}%>    <li      role="presentation"      data-event="cvm_oper_action"      data-name="ResetInstancesInternetMaxBandwidth"    >      <a role="menuitem" href="javascript:void(0);">调整网络</a>    </li>    <li data-event="cvm_oper_action" data-name="TerminateInstances">      <a href="javascript:;">销毁/退还</a>    </li>    <li data-event="cvm_oper_action" data-name="export">      <a href="javascript:;">导出实例</a>    </li>    <li data-event="cvm_oper_action" data-name="AssociateSecurityGroups">      <a href="javascript:;">加入安全组</a>    </li>  </ul>',{whiteList:b})),new i(f(".cvm-oper-area").find(".tc-15-dropdown"),{newMode:!0}),b.CVMpiliang&&f("#cvmBatchOperationNewButtonGroup").on("mouseover","> li",function(){f(this).parent().find("ul").hide(),f(this).find("ul").show()}),f(".cvm-oper-area").on("click","[data-event=cvm_oper_action]",function(b){var c=a.getSelectItem(f("tr[data-uinstanceid] input[type=checkbox]:checked")),b=f(b.target).closest("[data-name][data-event]");b.hasClass("disabled")||a.operActionEvent(b,c,null,{from:"list"})}),H.syncThen(function(a){a&&f(".cvm-oper-area").find("[data-name=ModifyInstancesChargeType]").hide()}),f(".cvm-oper-area").find("[data-event=refresh]").click(function(b){a.reload()}),f(".cvm-oper-area").find("[data-event=set_Fields]").click(function(){a.gridView.showFieldsManager()}),f(".cvm-oper-area").find("[data-event=add_cvm]").click(q.add),f(".manage-area.cvm").bind("click",function(a){var b=(f(a.target).closest("tr"),f(a.target).closest("[data-name=moreBtn]"));0==b.length&&f(".manage-area.cvm").find(".tc-15-menu-active").removeClass("tc-15-menu-active")}),f("#cvmList").on("click",".item-row",function(b){var c=f(b.target).closest("tr");if(!(c.hasClass("disabled")||c.hasClass("disable")||c.data("isloading")||c.data("isfail"))){var d=c.find(".new-mark-icon");if(d.length>0){var e=[c.data("uinstanceid")];w.modifyInstancesAttribute(k.getRegionId(),{InstanceIds:e,ResetNewCreationIdentify:!0},{tipErr:!1,camTips:!1}).then(function(b){d.hide(),a.refreshRegionOverview(a.regionId)})}c=f(b.target);var g=c.data("router");g&&E.navigate(c.data("router")+"?backfrom=cvmdetail")}}).on("click",'[data-event="autoUnblock"]',function(a){var b=(f(a.target).closest("tr"),f(a.target).closest("tr").data("uuid")),c=f(a.target).closest("tr").data("devicewanip"),d=k.getRegionId(),e=g.REGIONMAP,h=[{Uuid:b,Area:e[d],WanIp:c}];w.autoUnblock({UuidList:h}).then(function(){n.create("您提交的自助解封申请已生效，您的实例将在1-2分钟直接解除隔离恢复使用。",420,"",{title:"解封成功",defaultCancelBtn:!1,button:{" 确定 ":function(){n.hide()}}})})["catch"](function(a){n.create("您提交的自助解封申请未生效，请稍后再试。",420,"",{title:"解封失败",defaultCancelBtn:!1,button:{" 确定 ":function(){n.hide()}}})})})})},inspectCvm:function(a,b){var c,d=this,e={global:!1,tipErr:!1,camTips:!1,withoutDefaultFilter:!0},f=[],g={};a.forEach(function(a){var b=a.regionId;-1===f.indexOf(b)&&f.push(b),g[b+""]||(g[b+""]=[]),g[b+""]=g[b+""].concat(a.loadingCVMList)}),f.forEach(function(a){c=g[a+""].map(function(a){return a.uInstanceId}),c&&c.length&&(c=x.distinctArray(c),function(a,c){d.refreshItems(a,c,e).then(function(a){for(var d=x.arr2Map(a,"instanceId"),e=0,f=b.data.length;f>e;e++){var g=b.data[e];g.regionId==c&&(g.loadingCVMList=g.loadingCVMList.filter(function(a){return!d[a.instanceId]||"SHUTDOWN"==d[a.instanceId].instanceState&&!d[a.instanceId].isolatedTime||x.isLoadingStatus(a)||x.isDuringExclusionOperation(a);
}))}})}(c,a))})},refreshItems:function(a,b,c,d){var e=this;return c=c||{global:!1,tipErr:!1,camTips:!1,withoutDefaultFilter:!0},e.getFormattedCvmInfo({regionId:b,uInstanceIds:a},c).then(function(a){return a&&a.uInstanceIds.length?e.getFormattedCvmMoreInfo({deviceList:a.deviceList,uInstanceIds:a.uInstanceIds,wipArr:a.wipArr,regionId:b},c).then(function(a){var b=a.deviceList||[],c=[];return b.forEach(function(a){e.gridView.list.forEach(function(b,d){if(b.instanceId===a.instanceId){c.push(b);var g=a.instanceId,h=f("tr[data-uinstanceid="+b.instanceId+"]"),i=e.cvmListEl.find("tr[data-uinstanceid="+g+"]");a.idx=d,e.gridView.updateItem(d,a);var j=e.gridViewOptions.getCellContent(b.deviceWanIp,b,{key:"status"}),k=f(i).find(".dev-status").parents("td");k.html("<div>"+j+"</div>");var l=e.gridViewOptions.getCellContent(b.deviceWanIp,b,{key:"ip"}),m=e.gridViewOptions.getCellContent(b,b,{key:"_operCol"});if(l){var n=i.find(".ip-cell").parents("td"),o=i.find(".cvm-oper-cell").parents("td");if(e.isNetworkShiftUpUser&&b.eip&&o.html("<div>"+m+"</div>"),n.length){n.html(l);var q=n.find("[data-clipboard-text]");q.each(function(a,b){var c=f(b).attr("data-clipboard-text");if(c&&"-"!=c){var d=new p(b,{text:function(){return c}});d.on("success",function(){D.success("复制成功")}),d.on("error",function(a){D.error("您的浏览器不支持一键复制，请选中文本后用 Ctrl + C 快捷键进行复制"),console.warn(a)})}}),e.refreshItemDataTitle([b])}}if(b.terminateTimer){var s=e.gridViewOptions.getCellContent(b.deviceWanIp,b,{key:"cvmPayModeDesc"});s&&h.find(".cvmPayModeDesc").html(s)}e.initCopy(),r.refresh(i,e,function(a,b){return e.checkOperateStatus(a,b)})}})}),e.refreshItemOperAction(c),b}):void 0})},resetItems:function(a,b){var c=this;a.forEach(function(a){c.gridView.list.forEach(function(d,e){if(d.instanceId==a.instanceId){var g=a.instanceId,h=c.cvmListEl.find("tr[data-uinstanceid="+g+"]");a.idx=e,c.gridView.updateItem(e,a);var i=c.gridViewOptions.getCellContent(d.deviceWanIp,d,{key:"status"},{tipTxt:b}),j=f(h).find(".dev-status").parents("td");j.html("<div>"+i+"</div>"),c.gridView.$refs.list[e].$set({$selected:!1}),P[d.instanceId]=!0,r.refresh(h,c,function(a,b){return c.checkOperateStatus(a,b)})}})}),c.checkOperAction()},cacheFilterConfig:null};c.exports={render:e,destroy:function(){S.regionPills=null,M.stop(),I.destroy()},operActionEvent:S.operActionEvent}}),define("cvm/cvm/cvmutil",function(a,b,c){function d(a,b,c){if(Array.isArray(a))a.forEach(function(a,e,f){(k(a)||Array.isArray(a))&&(f[e]=d(a,b,c))});else if(k(a))for(var e in a)if(a.hasOwnProperty(e)){var f=e;if(!c||c&&!/^[A-Z]+$/g.test(e)){var g=e.substr(0,1);f=("upper"===b?g.toUpperCase():g.toLowerCase())+e.slice(1)}f!==e&&(a[f]=JSON.parse(JSON.stringify(a[e])),delete a[e]),(k(a[f])||Array.isArray(a[f]))&&(a[f]=d(a[f],b,c))}return a}function e(a,b){return b||(b=a),function(c,d,e){c="string"==typeof c?[c]:c,d="string"==typeof d?[d]:d;for(var f=a,g=c.pop(),h=0;h<c.length;h++){var i=c[h];if(f=a[i],!f){var j=h+1;if(j===c.length)f=a[i]={};else if(j<c.length){var k=c[j];f=a[i]=isNaN(k)?{}:[]}}}var l=null,m=b,n=!1,o=d.pop();if(0===d.length)b[o+"__graphql_error"]&&(l=b[o+"__graphql_error"]);else for(var p=0;p<d.length;p++){var i=d[p];if(m=b[i],!l&&b[i+"__graphql_error"]&&(l=b[i+"__graphql_error"]),!m){n=!0;break}}l&&(f[g+"__graphql_error"]=l),n||(f[g]=m[o]),"undefined"!=typeof e&&(f[g]=f[g]||e)}}var f=a("cvm/common/constants"),g=a("cvm/common/cookie"),h=a("constants"),i=a("appUtil"),j=h.DEVICE_RUNFLAGS,k=function(a){return a===Object(a)};return{isOverseaRegion:function(a){return a&&!!f.OVERSEA_REGION_ID_LIST.find(function(b){return b==a})},loadJs:function(b,c){var d=g.get("language"),e=d&&"zh"!=d?"/"+d+"/"+b+".js":"/"+b+".js";a.async(["https://"+QCBASE_HOST+"/jsrouter?fileName="+e],c)},delay:function(a){return new Promise(function(b){setTimeout(b,a)})},toUpperCaseFL:function(a){return d(a,"upper")},toLowerCaseFL:function(a){return d(a,"lower",!0)},isPrepaidPayMode:function(a){return a===f.INSTANCEPAYMODE.PREPAID},isSameZone:function(){},isSecondPayMode:function(a){return a===f.INSTANCEPAYMODE.POSTPAID_BY_HOUR},isSpotPayMode:function(a){return a===f.INSTANCEPAYMODE.SPOTPAID},isAutoRenewMode:function(a){return a===f.INSTANCERENEWFLAG.NOTIFY_AND_AUTO_RENEW},isLocalDiskType:function(a){return"LOCAL_SSD"===a||"LOCAL_BASIC"===a||"LOCAL_PRO"===a},isCDHPayMode:function(a){return a===f.INSTANCEPAYMODE.CDHPAID},isBandwidthPrepaidPayMode:function(a){return a===f.NETWORKPAYMODE.BANDWIDTH_PREPAID},isBandwidthPostpaidPayMode:function(a){return a===f.NETWORKPAYMODE.BANDWIDTH_POSTPAID_BY_HOUR},isNetworkFlowPayMode:function(a){return a===f.NETWORKPAYMODE.TRAFFIC_POSTPAID_BY_HOUR},isBandwidthPackagePaymode:function(a){return a===f.NETWORKPAYMODE.BANDWIDTH_PACKAGE},isMemType:function(a){return/M\d?$/.test(a)},isCALType:function(a){return/C\d?$/.test(a)},isBareMetalType:function(a){return/BM\w*$/.test(a)},isVSELF25G_2:function(a){return a.indexOf("VSELF25G_2")>=0},isVSHCAL25G_2:function(a){return a.indexOf("VSHCAL25G_2")>=0},isV3Standard:function(a){return"S3"==a},isV3Compute:function(a){return"C3"==a},isGpuN8:function(a){return"GN8"==a},isGpuN10:function(a){return"GN10"==a},isI3:function(a){return"I3"==a},isSecondDeviceType:function(a){return/.+2$/.test(a)},isHighIOType:function(a){return/I\d?$/.test(a)},isGpu:function(a){return/^G/.test(a)},isFpga:function(a){return/FX\d?$/.test(a)},isGpuAmd:function(a){return/GA\d?$/.test(a)},isNetworkEnhanced:function(a){return/^N\d?$/.test(a)||this.isBareMetalType(a)},isBigData:function(a){return/D\d?$/.test(a)},isHighIN3:function(a){return"IN3"==a},isBC1:function(a){return"BC1"==a},isS4METAL:function(a){return"BMS4"==a},isS4:function(a){return"S4"==a},isBS1:function(a){return"BS1"==a},isRunning:function(a){return a==f.CVM_STATUS.RUNNING},isStopped:function(a){return a==f.CVM_STATUS.STOPPED},getCvmPayModeByChargeType:function(a){return f.CVMPAYMODE[a]},getRegion:function(a){return f.REGIONIDMAP[a]},getRegionNum:function(a){if(/^\d+$/.test(a))return a;for(var b in f.REGIONIDMAP)if(f.REGIONIDMAP[b]==a)return b;return a},isLoadingStatus:function(a){return[f.CVM_STATUS.PENDING,f.CVM_STATUS.STARTING,f.CVM_STATUS.STOPPING,f.CVM_STATUS.REBOOTING,f.CVM_STATUS.TERMINATING].indexOf(a.instanceState)>-1},isShoutdownStatus:function(a){return a==f.CVM_STATUS.SHUTDOWN},isLaunchFailed:function(a){return a==f.CVM_STATUS.LAUNCH_FAILED},isDuringExclusionOperation:function(a){return a.latestOperation&&"OPERATING"==a.latestOperationState},isOperationFailed:function(a){return a.latestOperation&&"FAILED"==a.latestOperationState},isOperationSuccess:function(a){return a.latestOperation&&"SUCCESS"==a.latestOperationState},getOperationTitleFromRunflag:function(a){"ModifyInstancesVpcAttribute"==a.latestOperation&&"OPERATING"==a.latestOperationState&&(a.runflag=j.MIGRATING.code);var b="",c=[j.DELETING,j.SHUTTING_DOWN,j.RESETING_PW,j.FORMATTING,j.CREATEIMG,j.SETTING_BANDWIDTH,j.RESETOS,j.UPGRADE,j.DELIVER_KEY,j.MIGRATING,j.HYPERVISOR_UPDATE,j.OS_PLATFORM_SWITCH,j.HA_CVM,j.SLA_CVM,j.MANUAL_OPER,j.CHANGE_IP,j.UNBIND_KEY,j.SETTING_DISK,j.DEVICE_DISK_ATTACH,j.DEVICE_DISK_DETACH,j.COPYING],d=c.find(function(b){return b&&b.code==a.runflag});return d&&(b=i.getRunFlagDesc(a.runflag)),"ModifyInstanceDiskType"==a.latestOperation&&"OPERATING"==a.latestOperationState&&(b="硬盘介质转换中"),b},getStatusTitle:function(a){return f.CVM_STATUS_TITLE[a.instanceState]},createMapAttr:e,isWindows:function(a){return/xserver|windows/i.test(a)},arr2Map:function(a,b,c){if(a=a||[],!a||!a.length)return a;var d={};return(a||[]).forEach(function(a){a&&a[b]&&(c?(d[a[b]]||(d[a[b]]=[]),d[a[b]].push(a)):d[a[b]]=a)}),d},paddingLeft:function(a,b,c){if("string"!=typeof a&&(a=a.toString(),!a))return a;if(c=c||"0",a.length<b){var d=b-a.length;a=new Array(d+1).join(c)+a}return a},distinctArray:function(a){if(!a)return a;for(var b=a.length-1;b>0;)a.indexOf(a[b])!==b&&a.splice(b,1),--b;return a},isStrongPassword:function(a){var b="0123456789",c="abcdefghijklmnopqrstuvwxyz",d="()`~!@#$%^&*-+=_|{}[]:;'<>,.?/",e=[b,c,c.toUpperCase(),d].map(function(b){var c=b.split(""),d=c.reduce(function(b,c){return a.indexOf(c)>-1?++b:b},0);return d});return e.every(function(a){return a>=2})},isChineseVersion:function(){var a=g.get("language");return"zh"==a},isEnglishVersion:function(){var a=g.get("language");return"en"==a},findPropertyByPath:function(a,b){for(var c=b.split("."),d=0;d<c.length;d++){var e=c[d];if(!a||!a.hasOwnProperty(e))return void 0;a=a[e]}return a},getInstanceDiscount:function(a,b,c){var d=f.SPECIAL_DISCOUNT,e=f.RENEW_DISCOUNT,g=f.HIDE_DISCOUNT_REGIONS,h=d.instanceFamily;if(-1!==g.indexOf(a))return null;var i=h.find(function(a){return a.value&&a.value.find(function(a){return a===b})}),j={};return i&&i.duration?i.duration.forEach(function(a){j[a.value]=a.iconText}):e.forEach(function(a){j[a.value]=a.iconText}),j[c]||null}}}),define("cvm/cvm/cvm_grid",function(a,b,c){function d(a,b,c,d,e){var i=d,j=i.gridView.list.indexOf(b);if("idName"==c.key)return s.idName;if("networkPayModeDesc"==c.key)return"<div>"+b.networkPayModeDesc+"</div>";if("deviceTypeName"==c.key){if(b.instanceTypeDesc=b.instanceTypeDesc||"",n.isCDHPayMode(b.instanceChargeType)){var k="/cvm/cdh/detail/"+h.getRegionId()+"/"+b.uHostId+"/1";return g.tmpl('<p><%= instanceTypeDesc%><i class="<%= osIcon%>" data-title="<%= osName %>"></i></p><p><a href="<%=url%>"><%= uHostId %></a></p>',f.extend(!0,{},b,{url:k}))}return g.tmpl('<%= instanceTypeDesc%><i class="<%= osIcon%>" data-title="<%= osName %>"></i>',b)}if("ip"==c.key){if(b.ipConfig){b.ipConfig.eipInfo__graphql_error=b.ipConfig.eipInfo__graphql_error||null,b.ipConfig.isNetworkShiftUpUser=b.isNetworkShiftUpUser,b.ipConfig.noWanIpTip="",b.$normal&&b.bandwidth>0&&b.ipConfig.ipConfirm&&!b.ipConfig.deviceWanIp&&(b.ipConfig.noWanIpTip=b.innerVpcId>0?'主网卡上无公网IP，可能导致无法登陆，建议<a href="javascript:;" data-name="AssociateAddress" data-event="cvm_oper_action">绑定弹性公网IP</a>':'无公网IP，可能导致无法登陆，建议<a href="javascript:;" data-name="AssociateAddress" data-event="cvm_oper_action">绑定弹性公网IP</a>'),b.ipConfig.isPrepaidNetworkChargeType="BANDWIDTH_PREPAID"===b.internetAccessible.internetChargeType;var l=g.tmpl('  <div class="ip-cell">    <p>      <%if(deviceWanIp){%>      <%if(eipInfo){%>      <!--eipInfo-->      <span class="text-overflow m-width" title="弹性公网IP: <%= deviceWanIp %>">        <%= deviceWanIp %>        <i class="net-type">(弹性)</i>      </span>      <i class="copy-icon" data-clipboard-text="<%=deviceWanIp%>" style="display:none; cursor:pointer;"        data-title="复制弹性公网IP"></i>      <% } else {%>      <!--deviceWanIp-->      <span class="text-overflow m-width" title="公网IP: <%= deviceWanIp %>">        <%= deviceWanIp %>        <%if(eipInfo__graphql_error){%>        <i class="plaint-icon" qc-popover="<cam-tips><%=eipInfo__graphql_error.message%></cam-tips>"></i>        <% } else {%>        <i class="net-type">(公)</i>        <% } %>      </span>      <i class="copy-icon" data-clipboard-text="<%=deviceWanIp%>" style="display:none; cursor:pointer;"        data-title="复制公网IP"></i>      <% if(eipQuotaData){ %>      <% if(eipQuotaData.currentEipNum < eipQuotaData.eipNumQuota && !(isNetworkShiftUpUser && isPrepaidNetworkChargeType)){ %>      <i class="convert-ip-icon" data-name="TransformAddress" data-event="cvm_oper_action" style="cursor:pointer;"        data-title="IP保持不变，转为弹性公网IP，您最多可开通<%=eipQuotaData.eipNumQuota%>个弹性公网IP，已开通<%=eipQuotaData.currentEipNum%>个。"></i>      <% } else if(isNetworkShiftUpUser && isPrepaidNetworkChargeType){ %>      <i class="convert-ip-ash-icon hover-icon" data-title="包月带宽的IP暂不支持此功能"></i>      <% } else { %>      <i class="convert-ip-ash-icon hover-icon" data-title="弹性公网IP已达到<%=eipQuotaData.eipNumQuota%>个上限，无法转换"></i>      <% } %>      <% } %>      <% } %>      <% } else {%>      <span class="text-overflow m-width">-        <%if(noWanIpTip){%>        <i class="plaint-icon" qc-popover="<%=noWanIpTip%>"></i>        <%}%>        </span>        <% }%>    </p>    <p>      <span class="text-overflow m-width" data-title="内网IP: <%= deviceLanIp %>">        <%= deviceLanIp %>        <% if (deviceLanIp && deviceLanIp!="-") { %>        <i class="net-type">(内)</i>        <% } %>      </span>      <i class="copy-icon" data-clipboard-text="<%=deviceLanIp%>" style="display:none; cursor:pointer;"        data-title="复制内网IP"></i>    </p>  </div>',b.ipConfig);return l}return""}if("cvmPayModeDesc"==c.key){var m="";return b.terminateTimer&&(m+=g.tmpl('定时销毁<i class="plaint-icon" qc-popover-style="min-width:280px;lfet: 80px;" qc-popover="<%=popoverTips%>"></i>',{popoverTips:"实例将于 "+b.terminateTimer.actionTime+' 销毁 <a href="javascript:;" data-name="DeleteInstancesActionTimer" data-event="cvm_oper_action">撤销</a>'})),g.tmpl('<div class="cvmPayModeDesc"><p>'+b.cvmPayModeDesc+'</p><p<%if (instanceState == "SHUTDOWN" && !!isolatedTime) {%> aria-qc-popover="<%=cvmPayModeTimeDesc %>"<%}%>>'+b.cvmPayModeTimeDesc+"</p><p>"+m+"</p></div>",b)}if("monitor"==c.key)return g.tmpl('<div style="text-align:center;"><a   href="javascript:;"  <% if (instanceState == "PENDING") { %><% }else{ %>  style="cursor:pointer;"   data-event="renderMonitor"<% }%>       class="icon-monitor always-active">监控</a>',b);if("status"==c.key){if(b.instanceState==o.CVM_STATUS.PENDING&&b.instanceStatus&&b.instanceStatus.totalDuration&&b.instanceStatus.totalDuration>180&&b.instanceStatus.usedDuration&&b.instanceStatus.usedDuration>=0){var p=new Date(1e3*(b.instanceStatus.totalDuration-b.instanceStatus.usedDuration)),q=0,r=p.getMinutes(),t=p.getSeconds();return b.instanceStatus.usedDuration>=b.instanceStatus.totalDuration||0==r&&5>=t?(q=99,r=0,t=5):q=Math.floor(b.instanceStatus.usedDuration/b.instanceStatus.totalDuration*100),g.tmpl('    <% if (item.instanceState != \'PENDING\' ) { %>  <a href="javascript:;" style="cursor:pointer;" data-event="renderMonitor" class="icon-monitor always-active">监控</a>  <% }%>  <div class="dev-status" style="text-align:center;">    <span class="status-col">      <span class="text-overflow" data-title="预计            <%if(leftMin>0){%>              <%=leftMin%>分            <%}%>            <%if(leftSec>0){%>              <%=leftSec%>秒            <%}%>            后完成">创建中        </span>      </span>    </div>    <table style="margin-left:25px;">      <tbody>        <tr>          <td class="item-dd-bar" style="border-bottom-width:0px;padding:0px;height:inherit">            <div class="mod-progress">              <span class="mod-bar" style="width:<%=ratio%>%;"></span>  </div>  </td>  <td class="item-dd" style="border-bottom-width:0px;padding:0px;height:inherit">    <div class="cell-box" style="padding: 0px;">      <%=ratio%>%</div>  </td>  </tr>  </tbody>  </table>',{leftMin:r,leftSec:t,ratio:q,item:b})}return b.isSafeIsolated=b.isSafeIsolated||!1,b.statusDesc=b.statusDesc||"",e&&e.tipTxt&&(b.operationTitle=e.tipTxt,b.operationClass="n-loading-icon"),g.tmpl('<p><span class="dev-status text-overflow <%-statusColorClass%>" <%if (statusDesc) {%> <%- statusDesc%><%}%>>\n        <%if (statusClass) {%><i class="<%- statusClass%>">\n        </i><%}%><span class="status-col<%if (statusColorClass == "text-danger") {%> text-danger-und<%}%>"><%- statusTitle%></span></span>\n        </p>\n        <% if (operationTitle) {%>\n        <p><span class="dev-status text-overflow <%-operationColorClass%>" <%if (operationDesc) {%> <%- operationDesc%><%}%>>\n          <%if (operationClass) {%>\n          <i class="<%- operationClass%>"></i>\n          <%}%>\n          <span class="status-col<%if (operationColorClass == "text-danger") {%> text-danger-und <%}%>" title="<%- operationTitle%>">\n            <%- operationTitle%>\n          </span>\n          </span>\n        </p> <% } %>\n        ',b)}if("_operCol"==c.key){var u=!1,v=i.gridView.list.length,w=8,x=2;u=j+w>v&&j+1>w-x;var y=g.tmpl('  <%if(item.$loading){%>  <div class="cvm-oper-cell" data-title="<%if(item.statusOperateTip){%><%=item.statusOperateTip%><%}else{%>正在执行任务<%}%>">          <a href="javascript:;">登录</a>          <% if (isPrepaidUser && !isSecondPayMode&& !isCDH && !isSPOT) { %>          <a href=" javascript:;">续费</a>    <% } %>    <div class="tc-15-dropdown">      <a href="javascript:;" class="tc-15-dropdown-link">更多        <i class="caret"></i>      </a>    </div>  </div>  <%}else{%>  <div class="cvm-oper-cell">    <a href="javascript:;" data-name="DescribeInstanceVncUrl" data-event="cvm_oper_action" data-hot="yunzhuji.web"      class="disabled">登录</a>    <% if (isPrepaidUser && !isSecondPayMode && !isCDH && !isSPOT) { %>    <a href="javascript:;" data-name="RenewInstances" data-event="cvm_oper_action" class="disabled">续费</a>    <% } %>    <!-- 展开下拉菜单添加tc-15-menu-active -->    <div data-name="moreBtn" class="tc-15-dropdown <%if(isUp){%>            tc-15-dropup            <%}%>">            <a href="javascript:void(0);" class="tc-15-dropdown-link" data-event="morebtn">更多              <i class="caret"></i>            </a>            <ul class="tc-15-dropdown-menu">                <li data-name="buysameconfig" data-event="cvm_oper_action">                    <a href="javascript:;">购买相同配置</a>                  </li>              <li class="has-submenu">                <a href="javascript:;">实例状态</a>                <ul class="tc-15-dropdown-menu" style="display:none">                  <li data-name="RebootInstances" data-event="cvm_oper_action">                    <a href="javascript:;">重启</a>                  </li>                  <li data-name="StartInstances" data-event="cvm_oper_action">                    <a href="javascript:;">开机</a>                  </li>                  <li data-name="StopInstances" data-event="cvm_oper_action">                    <a href="javascript:;">关机</a>                  </li>                  <li data-event="cvm_oper_action" data-name="TerminateInstances">                    <a href="javascript:;">销毁/退还</a>                  </li>                </ul>              </li>              <li class="has-submenu">                <a href="javascript:;">实例设置</a>                <ul class="tc-15-dropdown-menu" style="display:none">                  <li data-name="ModifyInstancesAttribute.InstanceName" data-event="cvm_oper_action">                    <a href="javascript:;">改名</a>                  </li>                  <li data-name="export" data-event="cvm_oper_action">                    <a href="javascript:;">导出实例</a>                  </li>                  <li data-name="tag" data-event="cvm_oper_action">                    <a href="javascript:;">编辑标签</a>                  </li>                  <% if (!notShow_changeproject) { %>                    <li data-name="ModifyInstancesProject" data-event="cvm_oper_action">      <a href="javascript:;">分配至项目</a>      </li>      <% } %>      <% if (!isI18n || isPrepaidPayMode) { %>      <li data-name="ModifyInstancesRenewFlag" data-event="cvm_oper_action">        <a href="javascript:;">设置自动续费</a>      </li>      <% } %>      <%if(!isI18n){%>      <li data-name="ModifyInstancesChargeType" data-event="cvm_oper_action">        <a href="javascript:;">按量转包年包月</a>      </li>      <%}%>                    <% if (isShowSystemDiskDataCopy) { %>      <li data-name="CopyInstanceDisk" data-event="cvm_oper_action">        <a href="javascript:;">拷贝系统盘数据</a>      </li>      <% } %>      <li data-name="BindAutoSnapshotPolicy" data-event="cvm_oper_action">        <a href="javascript:;">设置定时快照策略</a>      </li>      </ul>      </li>      <li data-name="ResetInstance" data-event="cvm_oper_action">        <a href="javascript:;">重装系统</a>      </li>      <li class="has-submenu">        <a href="javascript:;">密码/密钥</a>        <ul class="tc-15-dropdown-menu" style="display:none">          <li data-name="ResetInstancesPassword" data-event="cvm_oper_action">            <a href="javascript:;">重置密码</a>          </li>          <li data-name="AssociateInstancesKeyPairs" data-event="cvm_oper_action">            <a href="javascript:;">加载密钥</a>          </li>        </ul>      </li>      <li class="has-submenu tc-15-dropup">        <a href="javascript:;">资源调整</a>        <ul class="tc-15-dropdown-menu " style="display:none">          <li data-name="ResetInstancesType" data-event="cvm_oper_action">            <a href="javascript:;">调整配置</a>          </li>          <li data-name="ResizeInstanceDisks|ResizeDisk" data-event="cvm_oper_action">            <a href="javascript:;">调整硬盘</a>          </li>          <% if (!!whiteList.local_to_cbs) { %>          <li data-name="ModifyInstanceDiskType" data-event="cvm_oper_action">            <a href="javascript:;">调整硬盘介质</a>          </li>          <% } %>          <%if(isNetworkShiftUpUser && (!item.deviceWanIp || item.eipInfo)){%>          <li data-name="upgradeEipBandwidth" data-event="cvm_oper_action">            <a href="javascript:;">调整网络</a>          </li>          <% }else{ %>          <li data-name="ResetInstancesInternetMaxBandwidth" data-event="cvm_oper_action">            <a href="javascript:;">调整网络</a>          </li>          <% } %>          <li data-name="ModifyInstancesVpcAttribute" data-event="cvm_oper_action">            <a href="javascript:;">切换私有网络</a>          </li>          <% if (item.bandwidthPackageList && item.bandwidthPackageList.length) { %>          <li data-name="addBandwidthPackage" data-event="cvm_oper_action">            <a href="javascript:;">加入带宽包</a>          </li>          <% } %>        </ul>      </li>      <li data-name="CreateImage" data-event="cvm_oper_action">        <a href="javascript:;">制作镜像</a>      </li>      <li class="has-submenu tc-15-dropup">        <a href="javascript:;">IP/网卡</a>        <ul class="tc-15-dropdown-menu  " style="display:none">          <%if(!isHideTransformAddress){%>          <li data-name="TransformAddress" data-event="cvm_oper_action">            <a href="javascript:;">转换弹性IP</a>          </li>          <%}%>          <%if(!isHideAssociateAddress){%>          <li data-name="AssociateAddress" data-event="cvm_oper_action">            <a href="javascript:;">绑定弹性IP</a>          </li>          <%}%>                        <li data-name="DisassociateAddress" data-event="cvm_oper_action">                          <a href="javascript:;">解绑弹性IP</a>                        </li>                        <%if(!isNetworkShiftUpUser){%>          <li data-name="ReturnNormalAddresses" data-event="cvm_oper_action">            <a href="javascript:;">退还公网IP</a>          </li>          <%}%>                    <li data-name="AdjustPublicAddress" data-event="cvm_oper_action">                      <a href="javascript:;">更换公网IP</a>                    </li>                    <li data-name="AttachNetworkInterface" data-event="cvm_oper_action">                      <a href="javascript:;">绑定弹性网卡</a>                    </li>                    <li data-name="DetachNetworkInterface" data-event="cvm_oper_action">                      <a href="javascript:;">解绑弹性网卡</a>                    </li>                  </ul>                </li>                <li class="has-submenu tc-15-dropup">                  <a href="javascript:;">安全组</a>                  <ul class="tc-15-dropdown-menu " style="display:none">                    <li data-name="ModifyInstancesAttribute.SecurityGroups" data-event="cvm_oper_action">                      <a href="javascript:;">配置安全组</a>                    </li>                    <% if (item.securityGroupIds && item.securityGroupIds.length) { %>          <li data-name="checkPort" data-event="cvm_oper_action">            <a href="javascript:;">实例端口验通</a>          </li>          <% } %>        </ul>      </li>      </ul>    </div>  </div>  <%}%>    ',{item:b,isCDH:"CDHPAID"===b.instanceChargeType,isSPOT:"SPOTPAID"===b.instanceChargeType,isBandWidthPackageUser:i.isBandwidthPackageUser,isShowSystemDiskDataCopy:b.isShowSystemDiskDataCopy,isPrepaidUser:i.isPrepaidUser,notShow_changeproject:i.notShow_changeproject,isSecondPayMode:n.isSecondPayMode(b.instanceChargeType),isPrepaidPayMode:n.isPrepaidPayMode(b.instanceChargeType),isUp:u,isNetworkShiftUpUser:i.isNetworkShiftUpUser,isI18n:i.isI18n,whiteList:i.whiteList,isRecycle:n.isShoutdownStatus(b.instanceState),isHideTransformAddress:i.isNetworkShiftUpUser&&"BANDWIDTH_PREPAID"===b.internetAccessible.internetChargeType,isHideAssociateAddress:!(!i.isNetworkShiftUpUser||!b.publicIpAddresses||b.eipInfo)});return y}return c.tdTpl||'<div class="text-overflow">'+(a||"")+"</div>"}function e(a,b){var c=v.slice(0,-1).concat({hide:!0,line:!0},b,v.slice(-1)),e=localStorage.getItem(w);if(!e||!e.length)try{localStorage.setItem(w,v.map(function(a){return!a.hide&&a.key}).join(","))}catch(g){console.warn(g)}var o=j.getMaxCols(),s=i(w,"",o),y=s.formatColums(c,a.gridContainerWidth-u),z={$data:{hasFirst:!0,firstColWith:u+"px",order:1,initGetData:!1,i18n:a.isI18n,canResizeColum:!1,colMinWidth:30,selectedHighlight:!1,colums:y,gridWidth:a.gridContainerWidth,list:[],canSelectTotal:!1,autoMaxHeight:!0,minHeight:400,maxHeightOffset:10,autoCheckWidth:!1,showState:!0,showPagination:!0,totalNum:0,count:50,trackKey:"uuid",searchItemName:"云主机"},$mixins:[s],getData:function(b,c){a.gridView.page=b.page,a.gridView.count=b.count,a.reload()},updateProjectHead:function(){var a=this;r.getProjects(function(b){if(!b||!b.data||!b.data.length)return void(x.asyncProjectData=[]);if(x.asyncProjectData=b.data,1!=b.data.length||0!=b.data[0].projectId){var c=a.projectFilter&&a.projectFilter.$data.filterOptions,d=[],e=[];if(c&&!c.length){var f=h.getProjectId(),g=!1,i=null;b.data.forEach(function(a){var b={value:a.projectId,label:a.name};f==a.projectId&&(g=!0,i=b),d.push(b)}),c.splice.apply(c,[0,c.length].concat(d)),g?e.push(i.value):e.push(-1),a.projectFilter.setFilterResult(e)}}})},updateListHeadValue:function(b){if(b){var c={zoneList:b.zones&&b.zones.nodes||[],cvmTypeList:b.instanceFamilies&&b.instanceFamilies.nodes||[],payModeList:b.instancePayModes&&b.instancePayModes.nodes||[]},d=this.zoneNameFilter&&this.zoneNameFilter.$data.filterOptions,e=this.deviceTypeFilter&&this.deviceTypeFilter.$data.filterOptions,f=this.cvmPayModeFilter&&this.cvmPayModeFilter.$data.filterOptions,g=this.projectFilter&&this.projectFilter.$data.filterOptions;x.zoneList=c.zoneList,d&&d.splice.apply(d,[0,d.length].concat(c.zoneList.map(function(a){return{label:a.name,value:a.zone}}))),d&&a.searchData&&a.searchData.zoneIdList&&a.gridView.zoneNameFilter.setFilterResult(a.searchData.zoneIdList),x.cvmTypeList||(x.cvmTypeList=c.cvmTypeList),e&&!e.length&&(e.splice.apply(e,[0,e.length].concat(c.cvmTypeList.map(function(a){return{label:a.name,value:a.instanceFamily}}))),a.searchData&&a.searchData.deviceClassList&&a.gridView.deviceTypeFilter.setFilterResult(a.searchData.deviceClassList)),x.payModeList||(x.payModeList=c.payModeList),f&&!f.length&&(f.splice.apply(f,[0,f.length].concat(c.payModeList.map(function(a){return{label:a.description,value:a.name}}))),a.searchData&&a.searchData.cvmPayModeList&&a.gridView.cvmPayModeFilter.setFilterResult(a.searchData.cvmPayModeList)),(!x.asyncProjectData||g&&!g.length)&&this.updateProjectHead()}},getCellContent:function(b,c,e,f){var g=c[e.key+"__graphql_error"]||c[{monitor:"instanceStatus"}[e.key]+"__graphql_error"]||c[e.key+"__cam_error"];return g?p.isCamRefused(g)?"<cam-help-tips>"+g.message+"</cam-help-tips>":"<error-help-tips>"+g.message+"</error-help-tips>":d(b,c,e,a,f)},statusFilterOptions:[{label:"创建中",value:"PENDING"},{label:"运行中",value:"RUNNING"},{label:"已关机",value:"STOPPED"},{label:"待回收",value:"SHUTDOWN"},{label:"重启中",value:"REBOOTING"}],zoneNameFilterOptions:[],deviceTypeFilterOptions:[],cvmPayModeFilterOptions:[],projectFilterOptions:[],getHeadContent:function(a){return"monitor"===a.key?'<div class="text-overflow text-center" title="监控">监控</div>':"status"===a.key?'<grid-view-header-filter b-ref="statusFilter" b-with="{ ready: statusFilterReady.bind(this.$root), filterOptions: statusFilterOptions, col: col, change: filterhange.bind(this.$root) }"></grid-view-header-filter>':"zoneName"===a.key?'<grid-view-header-filter b-ref="zoneNameFilter" b-with="{ ready: zoneNameFilterReady.bind(this.$root), filterOptions: zoneNameFilterOptions, col: col, change: filterhange.bind(this.$root) }"></grid-view-header-filter>':"deviceTypeName"===a.key?'<grid-view-header-filter b-ref="deviceTypeFilter" b-with="{ ready: deviceTypeFilterReady.bind(this.$root), filterOptions: deviceTypeFilterOptions, col: col, change: filterhange.bind(this.$root) }"></grid-view-header-filter>':"cvmPayModeDesc"===a.key?'<grid-view-header-filter b-ref="cvmPayModeFilter" b-with="{ ready: cvmPayModeFilterReady.bind(this.$root), filterOptions: cvmPayModeFilterOptions, col: col, change: filterhange.bind(this.$root) }"></grid-view-header-filter>':"projectName"===a.key?'<grid-view-header-filter  b-ref="projectFilter" b-with="{ ready: projectFilterReady.bind(this.$root),filterOptions: projectFilterOptions, col: col, change: projectFilterhange.bind(this.$root) }"></grid-view-header-filter>':"networkPayModeDesc"===a.key?'<span class="text-overflow" id="networkPayModeSelector">网络计费模式</span>':void 0},updateHeadFilter:function(){var b=a.cacheFilterConfig;b&&a.gridView.updateListHeadValue(b)},projectFilterhange:function(b){b?h.setProjectId(b[0]):h.setProjectId(-1);var c=this.getFilter();a.filterhange(c,x)},filterhange:function(b){var c=this.getFilter();a.filterhange(c,x)},getFilter:function(){function b(a,b){var c=a.$data.filterResult;d[b]=c&&c.length?c:null}var c=["instanceState","zoneIdList","deviceClassList","cvmPayModeList","projectId"],d={};a.gridView.statusFilter&&b(a.gridView.statusFilter,"instanceState"),a.gridView.zoneNameFilter&&b(a.gridView.zoneNameFilter,"zoneIdList"),a.gridView.deviceTypeFilter&&b(a.gridView.deviceTypeFilter,"deviceClassList"),a.gridView.cvmPayModeFilter&&b(a.gridView.cvmPayModeFilter,"cvmPayModeList"),a.gridView.projectFilter&&b(a.gridView.projectFilter,"projectId");var e=a.searchData,f=Object.assign({},e,d);for(var g in f)c.indexOf(g)>=0&&null===f[g]&&delete f[g];return f},statusFilterReady:function(b){this.statusFilter=b,a.searchData&&a.searchData.instanceState&&a.gridView.statusFilter.setFilterResult(a.searchData.instanceState)},zoneNameFilterReady:function(a){this.zoneNameFilter=a,this.updateHeadFilter()},deviceTypeFilterReady:function(a){this.deviceTypeFilter=a,this.updateHeadFilter()},cvmPayModeFilterReady:function(a){this.cvmPayModeFilter=a,this.updateHeadFilter()},projectFilterReady:function(a){this.projectFilter=a,this.updateHeadFilter()},setTrAttr:function(a,b){return a={"data-role":"cvm_row","data-deviceLanIp":b.deviceLanIp,"data-deviceWanIp":b.deviceWanIp,"data-uuid":b.uuid},a["data-uinstanceid"]=b.uInstanceId,a},resetCheckbox:function(a){var b=f(a.target).closest("tr");f("tr[data-uinstanceid] input[type=checkbox]:checked").not(b.find(":checkbox")).trigger("click"),b.find(":checkbox").prop("checked")||b.find(":checkbox").trigger("click")},gridItemClickHandle:function(b){setTimeout(function(){a.checkOperAction(b),a.refreshItemOperAction(b)},0)},events:{"click tr[data-uinstanceid] input[type=checkbox]":function(b){var c=a.getSelectItem(f("tr[data-uinstanceid] input[type=checkbox]:checked"));this.gridItemClickHandle(c)},"click tr :checkbox:eq(0)":function(b){var c=a.getSelectItem(f("tr[data-uinstanceid] input[type=checkbox]"));this.gridItemClickHandle(c)},"click tr[data-uinstanceid]":function(b){var c=f(b.target).closest("tr"),d=c.find(":checkbox");if(d&&d.length>0&&!f(b.target).is(":checkbox")&&!f(b.target).closest(".cvm-oper-cell").length>0)if(f(b.target).closest("[data-event]").length>0);else{var e=a.getSelectItem(d);this.gridItemClickHandle(e)}},"click tr [data-event=renderMonitor]":function(b){a.gridView.resetCheckbox(b);var c,d=a.getSelectItem(f(b.target)),e=[];d.forEach(function(a){e.push(a.instanceId),c=c||a.regionId}),q.queryCbs({uInstanceIds:e,limit:e.length,offset:0,regionId:c}).then(function(b){var c=b.cbss&&b.cbss.nodes?b.cbss.nodes:b||[],e=n.arr2Map(c,"uInstanceId",!0);d.forEach(function(a){e[a.instanceId]&&(a.cbsList=e[a.instanceId])}),t.init(d[0],a)})},"click tr [data-event=wipToEip]":function(a){f(a.target).closest("tr").find("[data-event=cvm_oper_action][data-name=AssociateAddress]").trigger("click");
},"click tr [data-event=upgradeToKvm]":function(b){a.gridView.resetCheckbox(b);var c=f(b.target).closest("tr"),d=parseInt(c.attr("data-index"));a.gridView.$refs.list[d].$set({$selected:!0});var e=new m({listIns:a,selectedItems:[{uuid:c.attr("data-uuid"),el:c}]});return k.render(e),l.click("yunzhuji.cvm_list_xen2kvm"),!1},"click tr [data-event=cvm_oper_action]":function(b){var c=f(b.target).closest("[data-name][data-event]"),d=c.closest("tr");if(c.hasClass("disabled"));else{a.gridView.resetCheckbox(b);var e=a.getSelectItem(d);a.refreshItemOperAction(e),a.operActionEvent(f(b.target).closest("[data-name][data-event]"),e,null,{from:"grid"})}}}};return z}var f=a("$"),g=a("util"),h=a("appUtil"),i=a("cvm/fieldsManager/gridView"),j=a("cvm/common/components/columsWidth/CalColums"),k=a("widget/cvmList/xentokvm/xentokvm"),l=a("reporter"),m=a("cvm/cvm/event/operate_base"),n=a("cvm/cvm/cvmutil"),o=a("cvm/common/constants"),p=a("widget/errorTips/errorTips"),q=a("cvm/cvm/data"),r=a("manager"),s=(a("qccomponent"),{idName:'  <div class="id-name-cell">    <p>      <a b-if="item.uInstanceId && item.instanceState != \'SHUTDOWN\'"        href="/cvm/detail/{{ item.regionId }}/{{item.instanceId}}" data-event="nav">        {{item.instanceId}}      </a>      <span b-if="!item.uInstanceId || item.instanceState == \'SHUTDOWN\'">{{item.uInstanceId}}</span>      <span b-if="item.paiInfo" class="tc-badge success-dark"        qc-popover="域名：<a href=\'http://{{item.paiInfo.domainName}}\' target=\'_blank\'>{{item.paiInfo.domainName}}</a>"        qc-popover-attach-el="#appArea">        PAI      </span>      <span b-if="item.newCreationIdentify && !i18n" class="new-mark-icon"></span>      <span b-if="item.newCreationIdentify && i18n" class="tc-badge success">New</span>      <span b-if="item.renewFlag == \'NOTIFY_AND_AUTO_RENEW\'" class="icon-renewal-mark" title="该实例已设置为自动续费"></span>    </p>    <div>      <i b-if="item.canUpgradeToKvm" class="update-icon">        <div class="tc-bubble tc-bubble-top" style="top:27px;visibility:hidden;">          <div class="tc-bubble-inner">            <p>              <a href="javascript:;" data-event="upgradeToKvm">置换为新实例</a>后可用制作镜像等新特性            </p>          </div>        </div>      </i>      {{item.canUpgradeToKvm ? \'&nbsp;\' : \'\'}}      <span b-if="item.canUpgradeToKvm || item.autoRenewFlag" style="max-width: 70%;" class="m-width"        title="{{item.instanceName}}">        {{item.instanceName}}      </span>      <span b-if="!item.canUpgradeToKvm && !item.autoRenewFlag" class="m-width" title="{{item.instanceName}}">        {{item.instanceName}}      </span>      <i b-if="!item.$loading" class="pencil-icon hover-icon" data-name="ModifyInstancesAttribute.InstanceName"        data-event="cvm_oper_action"></i>      <p></p>    </div>  </div>'}),t=a("cvm/cvm/event/monitor"),u=36,v=[{key:"idName",name:"ID/实例名",_minWidth:100,_maxWidth:132,required:!0},{key:"monitor",name:"监控",_minWidth:24,_maxWidth:72},{key:"status",name:"状态",_minWidth:54,_maxWidth:120},{key:"zoneName",name:"可用区",_minWidth:72,_maxWidth:120},{key:"deviceTypeName",name:" 主机类型",_minWidth:100,_maxWidth:132},{key:"cvmConfig",name:"配置",_minWidth:120,_maxWidth:132},{key:"ip",name:"主IP地址",_minWidth:142,_maxWidth:174},{key:"cvmPayModeDesc",name:"实例计费模式",i18n:!1,_minWidth:130,_maxWidth:196},{key:"networkPayModeDesc",name:"网络计费模式",_minWidth:72,_maxWidth:192},{key:"projectName",name:"所属项目",_minWidth:72,_maxWidth:144,hide:!0},{key:"_operCol",name:"操作",_minWidth:120,_maxWidth:132,required:!0}],w="cvm2_fields_201806064101",x={};b.get=e,b.colums=v,b.cacheKey=w}),define("cvm/cvm/data",function(a,b,c){var d=a("$"),e=a("models/api"),f=a("manager"),g=a("cvm/common/model"),h=a("models/iaas"),i=a("appUtil"),j=a("cvm/common/constants");c.exports={queryProductActions:function(a){var b=a.ProductName,c=a.ProductVersion;return h.apiRequest({regionId:i.getRegionId(),action:"DescribeProductActions",serviceType:"apios",data:{ProductName:b,ProductVersion:c,Version:"2018-07-17"}})},queryCVMActions:function(a,b){var c=a.CloudProductList,d=this,e={};return d.cloudAPIActionNameMap&&Object.keys(d.cloudAPIActionNameMap).length?(e=d.cloudAPIActionNameMap,d.cloudAPIActionNameMap=e,e):new Promise(function(a,b){Promise.all(c.map(function(a){return d.queryProductActions({ProductName:a.ProductName,ProductVersion:a.ProductVersion}).then(function(b){var c=b.Response.ActionSet,d=void 0===c?[]:c;return _defineProperty({},a.ProductName,function(){var a={};return d.forEach(function(b){a[b.Action]=b.ActionName}),a}())},function(a){return{}})})).then(function(){var b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];d.cloudAPIActionNameMap=b.reduce(function(a,b){return Object.assign(a,b)},{}),a(d.cloudAPIActionNameMap)},function(b){d.cloudAPIActionNameMap={},a(d.cloudAPIActionNameMap)})})},queryZone:function(a){return this.queryConsoleZone({regionId:a}).then(function(a){var b=a.response.zoneSet,c=void 0===b?[]:b;return c.filter(function(a){return"UNAVAILABLE"!=a.zoneState}).map(function(a){return Object.assign({},a,{status:1,zoneName:j.ZONENAMEMAP[a.zoneId]||a.zoneName})})})},queryRegion:function(){return this.queryConsoleRegion().then(function(a){var b={};return a.forEach(function(a){b[a.regionId]=a.regionName}),b})},queryConsoleZone:function(a,b){return g.apiRequest({serviceType:"cvm",action:"DescribeZones",data:{},regionId:a.regionId},b)},queryConsoleRegion:function(){var a=this;return new Promise(function(b,c){a.regionList?b(a.regionList):g.request("/cgi/area?action=queryConsoleRegion",{}).then(function(c){var d=c.regionList;a.regionList=d,b(d)})})},getValidRegions:function(){return this.queryConsoleRegion().then(function(a){var b={},c=[],d=[];return a.forEach(function(a){b[a.regionId]=a.regionName,c.push({name:a.regionName,value:a.regionId,regionName:a.regionName}),d.push(a.regionId)}),{regionMap:b,regionList:c,regionIds:d}})},queryOvmRegion:function(){var a=(d.Deferred(),{tipErr:!1,camTips:!1});return g.apiDelegate({serviceType:"ovm",action:"DescribeOvmRegions",data:{withVmCnt:1}},a).then(function(a){return a&&a.data&&a.data.region_list||[]},function(a){return[]})},getProjects:function(){return new Promise(function(a,b){f.getProjects(function(b){setTimeout(function(){a(b.data)},0)},b)})},getCvmMore:function(a,b){var c="query getCvmMore ($filters: [Filter], $limit: Int, $offset: Int, $ipAddresses: [String], $innerSubnetIds: [String], $innerVpcIds: [String], $vagueIpAddress: String, $vagueInstanceName: String){\n                instances(filters: $filters, limit: $limit, offset: $offset, ipAddresses: $ipAddresses, vagueIpAddress: $vagueIpAddress, innerSubnetIds: $innerSubnetIds, innerVpcIds: $innerVpcIds, vagueInstanceName: $vagueInstanceName) {\n                    totalCount\n                    nodes{\n                        uInstanceId:id\n                        instanceName:name\n						instanceStatus {\n			  				isReturnable\n			  				returnFailCode\n			  				returnFailMessage\n							instanceState\n							operationMask\n							runFlag\n							hypervisor\n							totalDuration\n							usedDuration\n							innerVpcId\n						}\n						isVpcGateway:asVpcGateway\n						connectivity{\n							defaultLoginPort:defaultLoginPortConnectivity\n							ICMP:iCMPConnectivity\n						}\n						securityGroupIds\n						vpc{\n							unVpcId: id\n							vpcName: name\n							cidrBlock: cidr\n						}\n						subnet{\n							subnetId: id\n							subnetName: name\n						}\n						eip{\n							eipId: id\n							eipName: name\n							eip: addressIp\n							isBlocked\n							isEip\n							payMode\n							bandwidth\n							instanceId\n							networkInterfaceId\n							isArrears\n							createdTime\n							deadlineDate\n						}\n                    }\n                }\n			}",d={filters:a.filters,limit:a.limit||20,offset:a.offset||0};return g.graphql({query:c,variables:d,regionId:a.regionId},b)},queryInstanceStatus:function(a,b){return g.apiRequest({serviceType:"cvm",action:"DescribeInstancesStatus",data:{instanceIds:a.instanceIds,limit:a.instanceIds.length||20,offset:a.offset||0},regionId:a.regionId},b)},queryInstanceReturnable:function(a,b,c){return g.apiRequest({serviceType:"cvm",action:"DescribeInstancesReturnable",regionId:b||i.getRegionId(),data:a},c)},stopInstances:function(a,b){var c=a.regionId;return delete a.regionId,g.apiRequest({regionId:c,serviceType:"cvm",action:"StopInstances",data:a},b)},queryInstancesConnectivity:function(a,b){return g.apiRequest({serviceType:"cvm",action:"CheckInstancesConnectivity",data:{instanceIds:a.instanceIds},regionId:a.regionId},b)},queryInstancesActionTimer:function(a,b){return g.apiRequest({serviceType:"cvm",action:"QueryInstancesActionTimer",data:{instanceIds:a.instanceIds},regionId:a.regionId},b)},queryImages:function(a,b){var c="query imageList($filters: [Filter], $limit: Int, $offset: Int, $instanceType: String, $language: String){\n            images(filters: $filters, limit: $limit, offset: $offset, instanceType: $instanceType, language: $language) {\n                totalCount\n                nodes {\n                    id\n                    unImgId\n                    imageName\n                    name\n                    deviceImageId\n                    itemId\n                    imageDescription\n                    osName\n                    osKey\n                    sysprep\n                    imageType\n                    createTime\n                    creator\n                    status\n                    size:imageSize\n                }\n            }\n        }",d={filters:a.filters,limit:a.limit||100,offset:a.offset||0};return g.graphql({query:c,variables:d,regionId:a.regionId},b)},queryEip:function(a,b){return g.apiRequest({serviceType:"vpc",action:"DescribeAddresses",data:{filters:a.filters,limit:a.limit||20,offset:a.offset||0},regionId:a.regionId},b)},queryVpc:function(a,b){var c=JSON.parse(JSON.stringify(b));return c.v3=!1,g.apiDelegate({serviceType:"vpc",action:"BatchGetVpcInfo",data:{vpcId:a.vpcId,limit:a.vpcId.length},regionId:a.regionId},c)},querySubnet:function(a,b){return h.request("/cgi/capi?i=vpc/DescribeSubnet",{serviceType:"vpc",action:"DescribeSubnet",data:{vpcId:a.vpcId,subnetId:a.subnetId},regionId:a.regionId},b)},queryCbs:function(a,b){var c="query getCbs($uInstanceIds: [String], $limit: Int, $offset: Int){\n        cbss(uInstanceIds:$uInstanceIds, limit: $limit, offset: $offset){\n          nodes{\n            diskId: id\n            alias: name\n            projectId\n            zoneId\n            uInstanceId\n            portable\n            payMode\n            diskType\n            storageType\n            snapshotAbility\n            attached\n            storageStatus\n            diskSize:storageSize\n            createTime\n						expiredTime:deadlineTime\n						isReturnable\n						returnFailCode\n          }\n        }\n      }",d={uInstanceIds:a.uInstanceIds,limit:a.limit||20,offset:a.offset||0};return g.graphql({query:c,variables:d,regionId:a.regionId},b)},getCvmWhiteList:function(a,b){return new Promise(function(a,b){Promise.all([new Promise(function(a,b){f.getAllWhiteList(a,b)}),new Promise(function(a,b){f.queryWhiteList({whiteKey:["CVM_operation_adjustment","CVM_SingleAdjustConfAll","CVM_BatchAdjustConfAll","local_to_cbs","UsingNewOperationValidator","EnterRecycling-payasyougo","CVMpiliang"]},function(b){a(b)},function(a){b(a)})})]).then(function(b){var c=b[0];Object.keys(b[1]).forEach(function(a){c[a]=!0}),a(c)})})},queryCvmList2:function(a,b){if(a=a||{},b&&b.withoutDefaultFilter);else{var c={name:"restrict-state",values:["NORMAL","PROTECTIVELY_ISOLATED"]},d=a.filters.find(function(a){return a.name==c.name});d||a.filters.push(c)}var e={filters:a.filters||[],limit:a.limit||20,offset:a.offset||0};return["vagueInstanceName","vagueIpAddress","ipAddresses","innerSubnetIds","innerVpcIds"].forEach(function(b){a[b]&&(e[b]=a[b])}),g.apiRequest({serviceType:"cvm",action:"DescribeInstances",data:e,regionId:a.regionId},b)},queryCvmList:function(a,b){var c="query instances ($filters: [Filter], $limit: Int, $offset: Int, $ipAddresses: [String], $innerSubnetIds: [String], $innerVpcIds: [String], $vagueIpAddress: String, $vagueInstanceName: String){\n                instances(filters: $filters, limit: $limit, offset: $offset, ipAddresses: $ipAddresses, vagueIpAddress: $vagueIpAddress, innerSubnetIds: $innerSubnetIds, innerVpcIds: $innerVpcIds, vagueInstanceName: $vagueInstanceName) {\n                    totalNum: totalCount\n                    deviceList: nodes{\n                        uInstanceId:id\n                        alias:name\n						uuid\n						deviceId\n						placement {\n							zone\n							zoneId\n							zoneName\n							projectId\n							projectName\n							hostId\n						}\n						instanceType\n						instanceFamily\n						instanceStatus {\n							instanceState\n							operationMask\n							runFlag\n							hypervisor\n							totalDuration\n							usedDuration\n							innerVpcId\n						}\n						instanceTypeDesc\n						instanceChargeType\n						cpu\n						mem:memory\n						systemDisk {\n							diskId\n							diskType\n							diskSize\n						}\n						dataDisks {\n                            diskId\n                            diskType\n                            diskSize\n                    	}\n						cbsList:cbses{\n							diskId: id\n							alias: name\n							projectId\n							zoneId\n							uInstanceId\n							portable\n							payMode\n							diskType\n							storageType\n							snapshotAbility\n							attached\n							storageStatus\n							diskSize:storageSize\n							createTime\n							expiredTime:deadlineTime\n						}\n						createdTime\n						expiredTime\n            isolatedTime\n            isSafeIsolated\n            safeIsolatedInfo\n						renewFlag\n						osName\n						image {\n							unImgId\n    						imageName\n							osName\n							imageType\n						}\n						privateIpAddresses\n						publicIpAddresses\n						internetAccessible {\n                            internetChargeType\n                            internetMaxBandwidthOut\n                            publicIpAssigned\n                        }\n                        errorCode\n						errorKey\n						newCreationIdentify\n						keyPairIds\n                    }\n                }\n            }",d=a;if(c=d.query?d.query:c,d.filters=d.filters||[],d.limit=d.limit||20,d.offset=d.offset||0,b&&b.withoutDefaultFilter);else{var e={name:"restrict-state",values:["NORMAL","PROTECTIVELY_ISOLATED"]},f=d.filters.find(function(a){return a.name==e.name});f||d.filters.push(e)}return g.graphql({query:c,variables:d,regionId:a.regionId},b)},queryImageInfo:function(a,b){var c=d.Deferred();return e.req({cmd:"DescribeInstanceImageInfo",serviceType:"cvm",data:a},b).then(function(a){c.resolve(a)},function(a){c.reject(a)}),c},queryIpBlockInfo:function(a,b){var c=d.Deferred();return b.v3=!1,g.apiDelegate({cmd:"GetUnblockTime",serviceType:"bgpip",data:a,regionId:a.region},b).then(function(a){c.resolve(a.data||{})},function(a){c.reject(a)}),c},queryEipQuota:function(a,b){var c="query eipQuotas{\n                eipQuotas{\n                    totalCount\n                    nodes{\n                        id\n                        currentEipNum: current\n						            eipNumQuota: limit\n                    }\n                }\n            }";return g.graphql({query:c,regionId:a.regionId},b)},queryInstanceTypeConfigs:function(a,b){var c="query instanceTypeConfigs ($filters: [Filter]){\n                instanceTypeConfigs(filters: $filters) {\n                    totalNum: totalCount\n                    nodes{\n                        id\n                        cpu\n                        mem:memory\n                    }\n                }\n            }",d={filters:a.filters};return g.graphql({query:c,variables:d,regionId:a.regionId},b)},getCvmFilterConfig:function(a,b){var c="query cvmFilterConfig{\n				instancePayModes{\n					nodes{\n						name\n						description\n					}\n				}\n				instanceFamilies{\n					nodes{\n						name\n						instanceFamily\n					}\n				}\n				zones{\n					nodes{\n						id\n						name\n						zone\n					}\n				}\n      }";return g.graphql({query:c,regionId:a.regionId},b).then(function(a){var b=i.isI18n();if(b){var c=a.zones&&a.zones.nodes||[];c.forEach(function(a){a.name=a.zone.replace("ap-","").replace(/-/g," ").replace(/( |^)[a-z]/g,function(a){return a.toUpperCase()}).replace(/(\d$)/,function(a,b){return"Zone "+b})});var d=a.instanceFamilies&&a.instanceFamilies.nodes||[];d.forEach(function(a){a.name=a.instanceFamily}),a.instancePayModes&&a.instancePayModes.nodes&&(a.instancePayModes.nodes=a.instancePayModes.nodes.filter(function(a){return"POSTPAID_BY_HOUR"===a.name||"SPOTPAID"===a.name}).map(function(a){return a.description=a.name.replace(/_/g," ").toLowerCase().replace(/( |^)[a-z]/g,function(a){return a.toUpperCase()}),a}))}return a})},getUserCvmOverview:function(a){return g.apiDelegate({serviceType:"cvm",action:"DescribeUserCvmOverview",data:a,regionId:i.getRegionId()}).then(function(a){return a&&a.data||[]},function(a){return[]})},updateUserCvmOverview:function(a){return g.apiDelegate({serviceType:"cvm",action:"ModifyUserCvmOverview",data:a}).then(function(a){return a})},modifyInstancesAttribute:function(a,b,c){return g.apiRequest({regionId:a,serviceType:"cvm",action:"ModifyInstancesAttribute",data:b},c)},getActionsLimit:function(a,b,c){return g.apiRequest({regionId:a,serviceType:"cvm",action:"DescribeInstancesOperationLimit",data:{InstanceIds:[c],Operation:b}}).then(function(a){a=a.response;var b=a.instanceOperationLimitSet.filter(function(a){return a.instanceId==c})[0]||{};return{maxCount:b.limitCount||0,currCount:b.currentCount||0}},function(){return{maxCount:0,currCount:0}})},querryPriceRenewIns:function(a){return g.apiRequest({regionId:a.regionId,serviceType:"cvm",action:"InquiryPriceRenewInstances",data:a},{camTipsType:a.camTipsType})},queryPrepaidCvmRefund:function(a){return g.apiRequest({serviceType:"cvm",action:"TerminateInstances",data:d.extend({},a,{DryRun:!0})}).then(function(a){return a},function(a){return{response:{}}})},describeInstanceStatistics:function(a,b){var c=a.regionId;return delete a.regionId,g.apiRequest({serviceType:"cvm",action:"DescribeInstanceStatistics",data:a,regionId:c},b).then(function(a){return a},function(a){return{response:{}}})},queryUnBlockInfo:function(a,b){return g.apiDelegate({regionId:1,serviceType:"pfsec",action:"SecControlQureySelfRemoveIsolateStatus",data:Object.assign({},a,{Version:"2018-07-13"})},Object.assign({},b,{classicResponse:!1})).then(function(a){return a.Response&&a.Response.Records&&a.Response.Records.List||[]})},autoUnblock:function(a){return g.apiDelegate({regionId:1,serviceType:"pfsec",action:"SecControlOperSelfRemoveIsolateJob",data:Object.assign({},a,{Version:"2018-07-13"})}).then(function(a){if(a=a.Respone&&a.Respone.Records&&a.Respone.Records.List||[],a[0]&&0!=a[0].Code)throw a;return a})},checkBandwidthPackage:function(a,b){return new Promise(function(b,c){g.apiRequest({regionId:a.regionId,serviceType:"vpc",action:"CheckBandwidthPackage",data:{}}).then(function(a){b(a.response?a.response.isBandwidthpkg:!1)},function(a){b(!1)})})},queryBandwidthPackageList:function(a,b){return new Promise(function(b,c){g.apiRequest({regionId:a.regionId,serviceType:"vpc",action:"DescribeBandwidthPackages",data:{filters:[{Name:"network-type",Values:["BGP"]}],offset:0,limit:200}}).then(function(a){b(a.response?a.response.bandwidthPackageSet:[])},function(a){b([])})})},fetchSecurityGroupIngressPolicys:function(a,b){return g.graphql({regionId:a,variables:{sgIdList:[b]},query:"query fetchSecurityGroupIngressPolicys ($sgIdList: [String]){\n          resource {\n            securitygroups (idList: $sgIdList) {\n              nodes {\n                policy {\n                  ingress {\n                    action\n                    sgId\n                    sgName\n                    addressModule\n                    addressModuleName\n                    addressModuleItemList\n                    serviceModule\n                    serviceModuleName\n                    serviceModuleItemList\n                    desc\n                    index\n                    ipProtocol\n                    portRange\n                  }\n                }\n              }\n            }\n          }\n        }"}).then(function(a){return a.resource.securitygroups.nodes.map(function(a){return a.policy.ingress})})},fetchSecurityGroupEgressPolicys:function(a,b){return g.graphql({regionId:a,variables:{sgIdList:[b]},query:"query fetchSecurityGroupIngressPolicys ($sgIdList: [String]){\n          resource {\n            securitygroups (idList: $sgIdList) {\n              nodes {\n                policy{\n                  egress {\n                    action\n                    sgId\n                    sgName\n                    addressModule\n                    addressModuleName\n                    addressModuleItemList\n                    serviceModule\n                    serviceModuleName\n                    serviceModuleItemList\n                    desc\n                    index\n                    ipProtocol\n                    portRange\n                  }\n                }\n              }\n            }\n          }\n        }"}).then(function(a){return a.resource.securitygroups.nodes.map(function(a){return a.policy.egress})})},queryWhiteList:function(a){return new Promise(function(b){f.queryWhiteList({whiteKey:a||[]},function(a){b(a)})})},fetchInstanceConfigInfos:function(a){return g.apiRequest({regionId:a,serviceType:"cvm",action:"DescribeInstanceConfigInfos",data:{}})},queryNetworkInterfaces:function(a,b){return g.apiRequest({regionId:b||i.getRegionId(),serviceType:"vpc",action:"DescribeNetworkInterfaces",data:a})},fetchZoneInstanceConfigInfos:function(a,b){return g.apiRequest({regionId:a.regionId,serviceType:"cvm",action:"DescribeZoneInstanceConfigInfos",data:a.data})},queryTaskFlow:function(a,b){var c=a.regionId,d=void 0===c?i.getRegionId():c,e=a.taskId;return g.apiRequest({regionId:d,serviceType:"cvm",action:"DescribeTask",data:{flowId:e}},b)},queryInstancesDeniedActions:function(a,b){var c=a.regionId,d=void 0===c?i.getRegionId():c,e=a.instanceIds;return g.apiRequest({regionId:d,serviceType:"cvm",action:"DescribeInstancesDeniedActions",data:{InstanceIds:e}},b)},queryHangingEipPrice:function(a){var b=a.regionId;return g.apiDelegate({action:"InquiryPriceVacancyAddresses",serviceType:"eip",regionId:b},{v3:!0})},queryPaiInfo:function(a,b){var c=a.regionId,d=void 0===c?i.getRegionId():c,e=a.instanceIds;return g.apiRequest({serviceType:"as",action:"DescribePaiInstances",data:{InstanceIds:e,Offset:0,Limit:100,Version:"2018-04-19"},regionId:d},b)},queryMigrateRegion:function(){return g.apiRequest({regionId:1,serviceType:"cvm",action:"DescribePreferentialRegion"},{v3:!1})},queryPreferentialInstance:function(){return this.queryMigrateRegion().then(function(a){var b=a.response.preferentialRegion;return b?g.apiRequest({regionId:b.regionId,serviceType:"cvm",action:"DescribePreferentialInstances"}).then(function(a){var c=a.response.preferentialInstancesInfo||[],d=a.response.total||0;return{region:b,instances:c,totalCount:d}}):Promise.reject()})},migrateInstances:function(a,b){return g.apiRequest({regionId:a,serviceType:"cvm",action:"PreferentialUpgradeInstancesType",data:b})}}}),define("cvm/cvm/dataformat",function(a,b,c){var d=a("cvm/common/constants"),e=a("appUtil"),f=a("util"),g=a("cvm/cvm/cvmutil"),h=a("cvm/cbs2/cbsutil"),i=a("cvm/image/util"),j=a("cvm/eip2/data"),k=function(a){var b,c=d.CVM_ROOT_SYSTEM_ICON,e="";if(!a)return e;for(var f in c)if(b=new RegExp(f,"i"),b.test(a)){e=c[f];break}return e},l={3:"请等待创建完成后再操作",6:"请等待退还完成后再操作",7:"请等待重启完成后再操作",8:"请等待开机完成后再操作",9:"请等待关机完成后再操作",10:"请等待密码重置完成后再操作",11:"请等待格式化完成后再操作",12:"请等待制作镜像完成后再操作",13:"请等待调整网络完成后再操作",14:"请等待操作系统重装完成后再操作",19:"请等待配置调整完成后再操作",20:"请等待密钥下发完成后再操作",21:"请等待迁移完成后再操作",22:"请等待置换完成后再操作",23:"请等待更换完成后再操作",27:"请等待IP更换完成后再操作",29:"请等待密钥解绑完成后再操作",30:"请等待硬盘调整完成后再操作",32:"请等待云硬盘挂载完成后再操作",33:"请等待云硬盘解挂完成后再操作"},m={cvmConfig:function(a){var b=function(a){var b=0==a.bandwidth,c=!(a.publicIpAddresses&&a.publicIpAddresses[0]),d=!(a.connectivity&&a.connectivity.ICMP),e=!(a.connectivity&&a.connectivity.defaultLoginPort),g="",h="",i=f.tmpl("带宽为0，无法远程登录，建议<%=bandwidth%>，再<%=eip%>",{bandwidth:'<a href="javascript:;" data-name="upgradebandwidth" data-event="cvm_oper_action">调整带宽</a>',eip:c?'<a href="javascript:;" data-name="bindEip" data-event="cvm_oper_action">绑定弹性公网IP</a>':"确认安全组"+a.defaultLoginPort+"端口已经放通"});return a.$normal&&(b?g=' <i class="plaint-icon" qc-popover="'+i+'"></i>':c||4!=a.instanceStatus.runFlag&&a.connectivity&&(d||e)&&(d&&(h+=f.tmpl("ping不可达，建议在安全组中<%=firewall%>",{firewall:'<a href="javascript:;" data-name="firewall" data-event="cvm_oper_action">放通ICMP协议</a><br>'})),e&&(h+=f.tmpl("无法远程登录，建议在安全组中<%=firewall%>",{firewall:'<a href="javascript:;" data-name="firewall" data-event="cvm_oper_action">放通TCP'+a.defaultLoginPort+"端口</a>"})),g=' <i class="plaint-icon" qc-popover="'+h+'"></i>')),g},c=b(a),d='<p><span class="text-overflow">'+a.cpuInfo+"  "+a.memInfo+"  "+a.bandwidthInfo+c+"</span></p>",e=a.systemDisk&&a.systemDisk.diskTypeName;return!e&&(a.cbsList||[]).forEach(function(a){"root"===a.diskType&&(e=h.getDiskTypeNameByStorageType(a.storageType))}),e&&(d+="<p>系统盘："+e+"</p>"),a.netName?d+='<p class="text-overflow">网络：'+(a.unVpcId?'<a data-event="nav" href="https://console.qcloud.com/vpc/vpc?rid='+a.regionId+"&unVpcId="+a.unVpcId+'" target="_blank">'+a.netName+"</a>":a.netName)+"</p>":a.netName__graphql_error?d+='<p class="text-overflow">网络：<i class="plaint-icon" qc-popover="<cam-tips>'+a.netName__graphql_error.message+'</cam-tips>"></i>':void 0!=a.netName?(a.netName="基础网络",d+='<p class="text-overflow">网络：基础网络</p>'):d+="<p>&nbsp;</p>",d},statusDesc:function n(a){var n=a.rawStatusDesc=a.rawStatusDesc||a.statusDesc;a.statusOperateTip=l[a.runflag],a.$loading=!1,a.$disable=!1,"故障"!==n&&"运行中"!==n&&"已退还"!==n&&"已关机"!==n&&"待回收"!==n&&"重装系统失败"!==n&&"调整配置失败"!==n&&"数据盘扩容失败"!==n&&"调整带宽失败"!==n&&"系统盘扩容失败"!==n&&"发货失败"!==n&&(a.$loading=!0,a.$disable=!0),"发货失败"==n&&(a.$loading=!1,a.$disable=!1,a.$fail=!0),a.$normal=!(a.$loading&&a.$disable||a.$fail);var b="";if(b="运行中"===n?"text-success":"已关机"===n||"待回收"===n?"text-danger":"故障"===n||"重装系统失败"===n||"调整配置失败"===n||"数据盘扩容失败"===n||"调整带宽失败"===n||"系统盘扩容失败"===n||"发货失败"===n?"text-warning":"",a.statusDesc='<span class="text-overflow '+b+'">'+n+"</span>",a.isSafeIsolated){var c='<span class="text-overflow warning"><%=statusDesc%><i class="ico-warning" qc-popover="<%=popoverTip%>"></i></span>';a.statusDesc=f.tmpl(c,{statusDesc:n,popoverTip:a.unblockable?"实例由于安全风险外网已被隔离，具体安全风险为："+a.safeIsolatedInfo+'，请尽快处理安全风险，解除风险后可对实例进行<a data-event="autoUnblock" href="javascript:;">自助解封</a>':'实例由于有安全风险外网已被隔离，请尽快处理安全风险，解除风险后<a data-event="nav" href="/workorder/create?level1_id=6&level2_id=7&level1_name=计算与网络&level2_name=实例%20CVM">提交工单</a>给我们确认执行结果；<br>具体安全风险：'+a.safeIsolatedInfo})}else if(a.ipBlocked){a.statusDesc='<span class="text-overflow warning">'+n;var d=f.tmpl("<%=text%>",{text:'<span class="text-danger">封堵</span>'}),e=f.tmpl("<%=text%>",{text:'<a href="https://buy.qcloud.com/bgp_sp" target="_blank">购买</a>BGP<a href="https://www.qcloud.com/document/product/297/8337" target="_blank">高防服务包</a>'});a.statusDesc+='<i class="ico-warning" qc-popover="实例由于受到攻击被'+d+"。"+a.ipBlockedTime+"将自动解封，您也可以"+e+'来应对攻击，恢复业务。"></i></span>'}else("重装系统失败"===n||"调整配置失败"===n||"数据盘扩容失败"===n||"调整带宽失败"===n||"系统盘扩容失败"===n||"发货失败"===n)&&(a.statusDesc='<span class="text-overflow warning">'+n,a.statusDesc+='<i class="ico-warning" qc-popover="由于系统繁忙'+(a.errorKey?"（错误码："+a.errorKey+"）":"")+"，您的CVM实例"+n+"，请尽快"+f.tmpl("<%=text%>",{text:'<a data-event="nav" href="/workorder/create?level1_id=6&level2_id=7&level1_name=%E8%AE%A1%E7%AE%97%E4%B8%8E%E7%BD%91%E7%BB%9C&level2_name=%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8%20CVM">提交工单</a>'})+' 联系我们进行处理。"></i></span>');a.statusDesc='<span class="status-col">'+a.statusDesc+"</span>"},expiredTimeInfoAndStatus:function(a,b){var c=a.expiredTime,d=0,h="";if(c){if(g.isPrepaidPayMode(a.instanceChargeType)){var i=864e5,j=7*i,k=new Date(c),l=b&&!isNaN(b)?b:e.getSystemTime(),m=l-k.getTime();if(m>0){var n=Math.floor(m/i);h=1>n?'<span class="text-overflow status-recover error">今天到期</span>':'<span class="text-overflow status-recover error">已过期'+n+"天</span>",d=1}else if(-j>m)h=f.date.date2Str(new Date(c),"%Y-%M-%d",!0),d=0;else{var n=Math.floor(Math.abs(m/i));h=1>n?'<span class="text-overflow warning">小于1天到期</span>':'<span class="text-overflow warning">'+n+"天后到期</span>",d=2}}}else d=0,h="";return{status:d,expiredTimeStr:h}},getDeadLineStr:function(a,b){var c=e.formatDate(new Date(a.isolatedTime),"yyyy-MM-dd hh:mm:ss"),d=864e5,f=1*d,h=7*d,i=new Date(c.replace(/\-/g,"/")),j=0,k="-",l=b&&!isNaN(b)?b:(new Date).getTime();if(j=l-i.getTime(),c&&"0000-00-00 00:00:00"!=c){var m=1,n=f;if(g.isPrepaidPayMode(a.instanceChargeType)&&(n=h,m=7),n>j){j=j.toFixed(2)-0;var o=(m-j/d).toFixed(2).split("."),p="";if(o[1]){var p=(o[1]/100*24).toFixed(0)-0;p=p>0?p+"小时":""}k=0==o[0]&&0==p?'<span class="text-overflow text-danger">小于1小时释放</span>':'<span class="text-overflow text-danger">'+(o[0]>0?o[0]+"天":"")+p+"后释放</span>"}else k='<span class="text-overflow text-danger">即将释放</span>'}return k},cpuInfo:function(a){return!a.instanceType||"v1.0.5"!=a.instanceType.toLowerCase()&&"v1.1"!=a.instanceType.toLowerCase()?a.cpu+"核":"共享核"},memInfo:function(a){return a.instanceType&&"v1.0.5"==a.instanceType.toLowerCase()?a.mem+"MB":a.mem+"GB"},systemDisk:function o(a){var o=a.systemDisk;return o=o&&h.isLocalDiskType(o.diskType)?{diskSize:o.diskSize,diskType:o.diskType,diskTypeName:h.getDiskTypeNameByDiskType(o.diskType),diskId:o.diskId}:null},dataDisks:function p(a){var p=a.dataDisks;return p?p.filter(function(a){return h.isLocalDiskType(a.diskType)}).map(function(a){return{diskSize:a.diskSize,diskType:a.diskType,diskTypeName:h.getDiskTypeNameByDiskType(a.diskType),diskId:a.diskId}}):[]},cbsList:function(a){return a=a||[],a.forEach(function(a){return a.storageTypeName=h.getDiskTypeNameByStorageType(a.storageType)}),a},cvmPayModeInfo:function(a){var b="",c=[];return g.isCDHPayMode(a.instanceChargeType)||a.uHostId?(a.createdTime&&c.push("<p>"+a.createdTime.substring(0,10)+"创建</p>"),b="不计费"):a.isPrepaidUser?g.isSecondPayMode(a.instanceChargeType)?(a.createdTime&&c.push("<p>"+a.createdTime.substring(0,10)+"创建</p>"),b="按量计费"):g.isSpotPayMode(a.instanceChargeType)?(a.createdTime&&c.push("<p>"+a.createdTime.substring(0,10)+"创建</p>"),b="按量计费-竞价"):g.isPrepaidPayMode(a.instanceChargeType)&&("-"!=a.expiredTimeStr&&(0==a.expiredTimeStatus?a.expiredTimeStr&&c.push(a.expiredTimeStr+"到期"):c.push(a.expiredTimeStr)),b="包年包月"):b="后付费",{cvmPayModeDesc:b,cvmPayModeTimeDesc:c.join("")}},networkPayModeInfo:function(a){return a.isBandwidthPackageUser?d.NETWORKPAYMODETITLE.BANDWIDTH_PACKAGE:d.NETWORKPAYMODETITLE[a.internetAccessible.internetChargeType]||"-"},bandwidthInfo:function(a){var b=a.internetAccessible,c=b.internetMaxBandwidthOut||0;return 65535==c?"无限制":c+"Mbps"},canUpgradeToKvm:function q(a){var b=d.HYPERVISOR,c=100001,q=!1,e=a.isPrepaidUser;return!(e&&b&&b.ENABLE&&a.opsAvailable&&a.opsAvailable.XENTOKVM)||a.zoneId==c&&a.cbsList&&a.cbsList.length||(q=!0,b.ENABLE_WINDOWS||"windows"!==a.osType?!b.ENABLE_CBS&&a.cbsList&&a.cbsList.length&&(q=!1):q=!1),q},deviceImageIdInfo:function(a){return a.image&&a.image.unImgId||"-"}};c.exports={get:function(a,b){b.projectData;return a.map(function(a){a.regionId=b.regionId,a.zone=a.placement&&a.placement.zone,a.zoneId=a.placement&&a.placement.zoneId,a.zoneName=a.placement&&d.ZONEIDV3TONAMEMAP[a.placement.zone]||"-",a.projectId=a.placement&&a.placement.projectId,a.projectName=a.placement&&a.placement.projectName;var c=m.expiredTimeInfoAndStatus(a);a.expiredTimeStatus=c.status,a.expiredTimeStr=c.expiredTimeStr,"STOP_CHARGING"===a.stopChargingMode;var f=m.cvmPayModeInfo(a);return a.cvmPayModeDesc=f.cvmPayModeDesc,a.cvmPayModeTimeDesc=f.cvmPayModeTimeDesc,
a.uHostId=a.placement&&a.placement.hostId,a.runflag=a.instanceStatus&&a.instanceStatus.runFlag,a.hypervisor=a.instanceStatus&&a.instanceStatus.hypervisor,a.statusDesc=e.getRunFlagDesc(a.runflag),a.uHostId&&6==a.runflag&&(a.statusDesc="销毁中"),a.cpuInfo=m.cpuInfo(a),a.memInfo=m.memInfo(a),a.cbsList=m.cbsList(a.cbsList),a.systemDisk=m.systemDisk(a),a.dataDisks=m.dataDisks(a),a.osName=a.image&&a.image.osName||a.osName,a.osType=/xserver|windows/i.test(a.osName)?"windows":"linux",a.defaultLoginPort="windows"==a.osType?3389:22,a.unImgId=a.image&&a.image.unImgId,a.imageType=a.image&&i.TYPE_NAMES[a.image.imageType],a.osIcon=k(a.osName),a.unImgIdInfo=m.deviceImageIdInfo(a),m.statusDesc(a),a.bandwidth=a.internetAccessible&&a.internetAccessible.internetMaxBandwidthOut||"0",a.bandwidthInfo=m.bandwidthInfo(a),a.networkPayModeDesc=m.networkPayModeInfo(a),a.deviceLanIp=a.privateIpAddresses&&a.privateIpAddresses[0]||"",a.deviceWanIp=a.publicIpAddresses&&a.publicIpAddresses[0]||"",a.canUpgradeToKvm=m.canUpgradeToKvm(a),a.cvmConfig=m.cvmConfig(a),a.runflag=a.instanceStatus&&a.instanceStatus.runFlag||0,a.isPrepaid=g.isPrepaidPayMode(a.instanceChargeType),28==a.runflag&&(a.isPrepaid?a.isolatedTimeStr=e.formatDate(new Date(new Date(a.isolatedTime).getTime()+6048e5),"yyyy-MM-dd hh:mm"):a.isolatedTimeStr=e.formatDate(new Date(new Date(a.isolatedTime).getTime()+864e5),"yyyy-MM-dd hh:mm"),a.cvmPayModeTimeDesc=m.getDeadLineStr(a)),a})},getMore:function(a,b){var c=b.cvmMore||[],d=b.ipBlocked||[],f=b.unblockable||[],h=b.eipQuota;return a.map(function(a){var b=c.find(function(b){return b.uInstanceId==a.uInstanceId});if(!b)return a;b.eip&&a.isNetworkShiftUpUser&&(b.eip=j.formatList([b.eip])[0]);var i=g.createMapAttr(a,b);if(i("netName",["vpc","vpcName"],""),i("unVpcId",["vpc","unVpcId"],""),i("cidrBlock",["vpc","cidrBlock"]),i("subnetName",["subnet","subnetName"],"-"),i("isVpcGateway","isVpcGateway"),i("connectivity","connectivity",null),i(["ipConfig","eipInfo"],"eip",null),i("eipInfo","eip",null),i("securityGroupIds","securityGroupIds",null),a.cvmConfig=m.cvmConfig(a),i=g.createMapAttr(a,a),i(["ipConfig","deviceLanIp"],"deviceLanIp"),i(["ipConfig","deviceWanIp"],"deviceWanIp"),a.ipConfig.eipQuotaData=h&&h.eipQuotas?h.eipQuotas.nodes.find(function(a){return"TOTAL_EIP_QUOTA"==a.id}):null,a.deviceWanIp){a.unblockable=!!f.find(function(b){return b.wanip==a.deviceWanIp&&0==b.rCode});var k=d.find(function(b){return b.ip==a.deviceWanIp});k&&(a.ipBlocked=!!k.unblockTime,a.ipBlockedTime=k.unblockTime||"")}if(g.isPrepaidPayMode(a.instanceChargeType)){var l={1:"该实例已被退还，不可重复操作",2:"已过期实例不支持销毁",3:"包年包月实例已购买超过5天不支持销毁",4:"非包年包月实例不支持销毁",5:"广州Open地区实例暂不支持销毁",6:"FPGA 型实例暂不支持销毁",7:"包年包月机器不支持销毁",8:"包年包月销毁实例数量已达上限",9:"运营活动购买的实例暂不支持自助销毁，如需销毁，可提交工单申请",10:"EMR实例不支持销毁"};a.canRefund=a.isCvmRefundUser&&b.instanceStatus&&b.instanceStatus.isReturnable,a.refundReason=a.isCvmRefundUser&&b.instanceStatus&&l[b.instanceStatus.returnFailCode]||"包年包月机器不支持销毁"}return m.statusDesc(a),a.operateAuth=a.instanceStatus&&a.instanceStatus.operationMask||0,a.opsAvailable=e.getOperationTag(a.operateAuth,a.runflag),a})}}}),define("cvm/cvm/event/addBandwidthPackage/addBandwidthPackage",function(a,b,c){var d=(a("manager"),a("cvm/cvm/event/operate_base")),e=a("dialog"),f=a("tips"),g=(a("util"),a("cvm/cvm/event/selectedShow/selectedShow")),h=a("cvm/common/model"),i=a("qccomponent"),j=i.getComponent("grid-view"),k=i.components["qc-search"],l=function(a){d.call(this,a)};l.prototype=new d,l.prototype.exec=function(){var a=this,b=this.hasPermItems[0];h.apiRequest({serviceType:"vpc",action:"DescribeAddresses",data:{filters:[{name:"instance-id",values:[b.instanceId]},{name:"address-type",values:["WanIp","EIP","AnycastEIP"]}]},regionId:b.regionId},{camTipsType:"dialog"}).then(function(c){var d=c.response.addressSet||[],l=d.find(function(a){return a.addressIp==b.deviceWanIp});if(l){var m=new i({$tpl:'    <div>        <div class="renew-form old-hang tc-15-table-panel">            <div class="search-wrap" id="bandwidthPackage-search"></div>        </div>        <div id="bandwidthPackage-grid"></div>    </div>'});e.create(m.$el,600,"",{title:"加入带宽包",preventResubmit:!0,button:{" 确定 ":function(){a.gridView&&a.gridView.selectedBandwidthPackageId?h.apiRequest({serviceType:"vpc",action:"AddBandwidthPackageResources",data:{BandwidthPackageId:a.gridView.selectedBandwidthPackageId,ResourceIds:[l.addressId],NetworkType:"BGP",ResourceType:"Address"},regionId:b.regionId},{camTipsType:"dialog"}).then(function(b){f.success("操作成功"),e.hide(),a.callback&&a.callback()},function(a){e.toggleBtnDisable(!1)}):(f.error("请选择带宽包"),e.toggleBtnDisable(!1))}}}),g.render(a.selectedShowOptions);var n={$data:{selectedBandwidthPackageId:"",hasFirst:!1,initGetData:!1,canResizeColum:!1,selectedHighlight:!1,maxHeight:290,minHeight:"auto",autoMaxHeight:!1,maxHeightOffset:10,count:200,colums:[{key:"radio",name:" ",width:30,required:!0,tdTpl:'    <span class="text"><input type="radio" b-model="selectedBandwidthPackageId" value="{{item.bandwidthPackageId}}"            name="bandwidthPackage-id" class="tc-15-radio" disabled?="item.$disable"></span>'},{key:"bandwidthPackageId",name:"共享带宽包ID",_minWidth:40,_maxWidth:100,required:!0},{key:"bandwidthPackageName",name:"共享带宽包名称",_minWidth:100,_maxWidth:100,required:!0}],list:b.bandwidthPackageList||[],showState:!1,showPagination:!1,searchItemName:"带宽包"},backList:function(){this.getData()},getData:function(a){var c=[];a=a||{};var d=a.keyword?a.keyword.trim():"";if(d){var e=new RegExp(d);c=b.bandwidthPackageList.filter(function(a){return e.test(a.bandwidthPackageId)||e.test(a.bandwidthPackageName)})}else c=b.bandwidthPackageList;this.$set("selectedBandwidthPackageId",""),this.setData({list:c,totalNum:c.length,searchKey:d})},$afterInit:function(){this.$watch("selectedBandwidthPackageId",function(a){})}};a.gridView=new j(n),e.el.find("#bandwidthPackage-grid").append(a.gridView.$el),a.qcSearch=new k({$data:{keyword:"",searchEmpty:!0,multiple:!1,placeholder:"请输入带宽包ID或带宽包名称"},search:function(b){a.gridView.getData({keyword:b})}}),e.el.find("#bandwidthPackage-search").append(a.qcSearch.$el)}})},c.exports=l}),define("cvm/cvm/event/addcvm",function(a,b,c){var d=a("appUtil");b.add=function(){window.open("//"+window.QCBUY_HOST+"/cvm?regionId="+d.getRegionId()+"&projectId="+d.getProjectId(),"_blank")}}),define("cvm/cvm/event/adjustWanIp/adjustWanIp",function(a,b,c){var d=a("cvm/cvm/event/operate_base"),e=a("lib/vpc-eip-sdk-importer"),f=function(a){d.call(this,a)};f.prototype=new d,f.prototype.exec=function(){var a=this;e.ready().then(function(b){b.CvmOperationGen("AdjustPublicAddress",a.selectedItems,function(){a.refreshList&&a.refreshList(),a.callback&&a.callback()})})},c.exports=f}),define("cvm/cvm/event/alias/alias",function(a,b,c){var d,e=a("$"),f=(a("manager"),a("cvm/cvm/event/operate_base")),g=a("dialog"),h=a("tips"),i=a("util"),j=a("lengthlimiter"),k=a("cvm/cvm/event/selectedShow/selectedShow"),l=a("cvm/common/model"),m=a("cvm/common/renderMonitor"),n={main:'  <div class="edit_form_wrap">    <ul class="edit_psword">      <li>        <label class="txt">新实例名称:</label>        <input          class="txt_input"          style="width:260px"          id="aliasIpt"          data-lenLimit="60"          maxlength="60"          type="text"        />        <p class="tip" id="renameLeftTip"></p>      </li>    </ul>  </div>'},o=function(a){f.call(this,a)};o.prototype=new f,o.prototype.exec=function(){d=m.init(c.id,"kennyang"),d&&d.renderBefore();var a,b=this;a=this.hasPermItems[0],g.create(i.tmpl(n.main,{}),680,"",{title:"改名",preventResubmit:!0,button:{"确定":function(){b.sendReq()}},onload:function(a){d&&d.renderSuccess()}}),k.render(this.selectedShowOptions),j.trigger(),e("#aliasIpt").focus().val(a.alias),j.trigger(),e("#aliasIpt").on("input",function(a){var b=a.target.maxLength-a.target.value.length;e("#renameLeftTip").html("您还可以输入"+b+"个字符")});var f=e("#aliasIpt")[0].maxLength-e("#aliasIpt")[0].value.length;e("#renameLeftTip").html("您还可以输入"+f+"个字符")},o.prototype.sendReq=function(){var a=this,b=g.el.find('input[type="text"]'),c=e.trim(b.val());if(!c)return b.focus(),void this.restoreDialogBtn();for(var d,f=[],i=0;d=a.hasPermItems[i];i++)f.push(d.uInstanceId);var j=a.hasPermItems[0].regionId;l.apiRequest({serviceType:"cvm",action:"ModifyInstancesAttribute",data:{InstanceIds:f,InstanceName:c},regionId:j},{camTipsType:"dialog"}).then(function(){g.hide(),a.listIns&&a.listIns.refreshItems?a.listIns.refreshItems(f,j):a.listIns&&a.listIns.refresh&&a.listIns.refresh(),h.success("修改成功"),a.callback&&a.callback()})["catch"](function(a){console.warn(a)})},c.exports=o}),define("cvm/cvm/bandwidthlimit/bandwidthlimit",function(a,b,c){var d,e=a("$"),f=a("util"),g=(a("manager"),a("cvm/cvm/event/operate_base")),h=a("dialog"),i=a("widget/range/range"),j=a("cvm/cvm/event/selectedShow/selectedShow"),k=a("reporter"),l=a("cvm/common/constants"),m=a("cvm/cvm/cvmutil"),n=a("tips"),o=a("cvm/common/components/BandwidthRangePopover"),p=a("appUtil"),q=a("cvm/cvm/event/upgrade_common"),r=a("cvm/common/model"),s=a("cvm/common/renderMonitor"),t={main:'  <div class="form-wrap adjust-band-max bandwidth-limit-wrapper">    <ul class="form-list">      <li>        <div class="form-label"><label>网络计费模式</label></div>        <div>          <%=networkPayModeDesc%>          <a href="javascript:void(0);" id="changeMode" style="display:none;"            >&nbsp;&nbsp;切换成带宽计费</a          >          <span id="leftChangeCount" style="display:none;"            >(转换后将消耗一次转换机会)</span          >        </div>      </li>      <li>        <div class="form-label"><label>目标带宽上限</label></div>        <div class="form-input">          <% if (isShowNoLimitSelect) { %>          <p class="radio-line">            <label for="bw_no_restrictions">              <input                type="radio" class="tc-15-radio is-bandwidth-unlimited" id="bw_no_restrictions"                <%if (!isLimited) {%> checked <%}%> name="bw_limit_type" value="0">无上限</label>            <label for="bw_set_limits">              <input                type="radio" class="tc-15-radio is-bandwidth-limited" id="bw_set_limits"                <%if (isLimited) {%> checked <% } %> name="bw_limit_type" value="1">有上限</label>          </p>          <% } %>          <div class="rerange-wrapper" style="display:none; width:440px"></div>          <p style="display:none; color: red;" id="overWidthTps">            按流量计费允许的最高带宽上限低于原带宽，本次调整后实例的带宽上限会降低。          </p>          <p class="text-primary">出入带宽将按1：1限速</p>        </div>      </li>    </ul>  </div>',changeModeConfirm:'  <div class="act-outline">    <div style="text-indent:2em;">      每台实例只允许在按带宽计费与按流量计费两种模式之间转换 <%=maxCount%>次，      <span style="color:red;"        >该实例已经转换 <%=currCount%>次，转换次数用完后将无法再转换。</span      >    </div>    <div style="margin-top:20px;font-weight:bold;">您是否确定要操作？</div>  </div>  <div class="act-outline">    <div class="act-details">      <table class="act-details-tb">        <tbody>          <tr>            <td style="width:200px;">              <div><span class="text-overflow">退款账号</span></div>            </td>            <td>              <div><span class="text-overflow">退款金额(元)</span></div>            </td>          </tr>          <% for (var i = 0, item; item = returnInfo[i]; i++) { %>          <tr>            <td style="border-top:1px solid #E6EBF2">              <div><span class="text-overflow"> <%=item.uin%> </span></div>            </td>            <td style="border-top:1px solid #E6EBF2">              <div><span class="text-overflow"> <%=item.amount%> </span></div>            </td>          </tr>          <% } %>        </tbody>      </table>    </div>  </div>  <div class="act-outline">    <div style="text-indent:2em;">      <p>        注意：如果用代金券购买，代金券部分不退回。如果重新切换成带宽计费，可能造成费用增加。        <span class="text-danger"          >退款算法详见          <a            href="https://cloud.tencent.com/document/product/555/7440"            target="_blank"            >退款规则 <b class="external-link-icon"></b>          </a>        </span>      </p>    </div>  </div>',changeModeTips:'  <ul class="tc-15-msg warning mb-10">    <%if (isChangeFlow) {%>    <li style="list-style: square">      每台实例只允许在按带宽计费与按流量计费两种模式之间转换      <%=maxCount%>次。该实例已经转换      <%=currCount%>次，转换次数用完后将无法再转换。    </li>    <li style="list-style: square">      切换成按流量计费，按腾讯云官方退费算法进行退费。注意代金券和优惠部分不退。如果重新从按流量计费切换成按带宽计费，按重新购买带宽进行收费。    </li>    <%}%>    <li style="list-style: square">      请做好实例内部的安全防护，若被攻击产生大量流量，会增加您成本。建议您：合理设置带宽上限，或选择按带宽计费。    </li>    <li style="list-style: square">带宽调整实时设定，实时生效。</li>    <%if (networkPayModeDesc == "按流量计费") {%>    <li style="list-style: square">      流量费用每小时结算一次，当账户余额不足时，两小时内将停止流量服务。    </li>    <%}%>  </ul>'},u=null,v=!1,w=!1,x=65535,y=function(a){g.call(this,a)},z=a("cvm/eip2/data"),A=a("cvm/eip2/common/util"),B=a("cvm/eip2/common/config"),C=B.EIP_BANDWIDTH_QUOTA_CONFIG;z.describeBandwidthAttribute().then(function(a){C=a})["catch"](function(a){}),y.prototype=new g,y.prototype.exec=function(a){d=s.init(c.id,"kennyang"),d&&d.renderBefore();var b=this,g=this.hasPermItems[0];u=null;for(var k,n=0;n<this.hasPermItems.length;n++){var p=this.hasPermItems[n];p.bandwidth!=x&&(u=!0,k=p.bandwidth)}var q=this.hasPermItems.map(function(a){return A.getEipMaxBandwidth(C,{networkPayMode:"BANDWIDTH_PREPAID"===a.internetAccessible.internetChargeType?"BANDWIDTH_PREPAID_BY_MONTH":a.internetAccessible.internetChargeType,cvmPayMode:a.instanceChargeType,cpu:Number(a.cpu),zoneId:String(a.zoneId)})});v=m.isNetworkFlowPayMode(g.internetAccessible.internetChargeType);var y=(m.isBandwidthPackagePaymode(g.internetAccessible.internetChargeType),function(){m.isCDHPayMode(g.instanceChargeType)&&v;for(var a=!0,c=0;c<b.hasPermItems.length;c++){var d=b.hasPermItems[c];if(!m.isCDHPayMode(d.instanceChargeType)){a=!1;break}}return a}()),z=g.networkPayModeDesc,B=t.main;w=this.args&&"changeFlow"==this.args[2],w&&(z="按流量计费",v=!0);var D=q.every(function(a){return 0==a.bandwidthLimit});D||(u=!0);var E=u?k:10;p.isBandwidthPackageUser||g.bandwidth!=x||(E=0);var F=f.tmpl(B,{isLimited:u,isChangeFlow:w,networkPayModeDesc:z,bandwidth:E,trafficBandwidthUnLimitFlag:k===x?1:0,isShowNoLimitSelect:D});h.create(F,"780","",{title:"调整网络",preventResubmit:!0,isMaskClickHide:!1,button:{" 确定 ":function(){w?b.showChangeModeConfirm(a):b.sendReq()}}}),j.render(this.selectedShowOptions),this.wrapper=h.el.find(".bandwidth-limit-wrapper"),this.rangeWrapper=this.wrapper.find(".rerange-wrapper");var G=b.listIns.isNetworkShiftUpUser?1:0;if(g.isBandwidthPackageUser){var H=b.max=q[0].bandwidthUpper;this.bandWidthRange=new i({renderTo:this.rangeWrapper,value:E,min:G,max:H,section:b.getSliderSection(H),change:function(a){0==a&&o.show({range:b.bandWidthRange})}})}else if(y){var H=b.max=q[0].bandwidthUpper;this.bandWidthRange=new i({renderTo:this.rangeWrapper,min:G,max:H,section:b.getSliderSection(1e3),value:g.bandwidth||0,change:function(a){0==a&&o.show({range:b.bandWidthRange})}})}else{var H=b.max=Math.min.apply(Math,_toConsumableArray(q.map(function(a){return a.bandwidthUpper})));this.bandWidthRange=new i({renderTo:this.rangeWrapper,value:Math.min(E,H),min:G,max:H,section:b.getSliderSection(H),change:function(a){0==a&&o.show({range:b.bandWidthRange})}})}if(w){var I=a.getInputData(),J=JSON.parse(JSON.stringify(g.internetAccessible));J.internetMaxBandwidthOut=I.bandwidth;var K="InquiryPriceModifyInstanceInternetChargeType";E>H&&e("#overWidthTps").show();var L={InstanceId:g.uInstanceId,InternetAccessible:{InternetMaxBandwidthOut:Math.min(I.bandwidth,H),InternetChargeType:l.NETWORKPAYMODE.TRAFFIC_POSTPAID_BY_HOUR}};r.apiRequest({action:K,serviceType:"cvm",data:L,regionId:g.regionId}).then(function(a){d&&d.renderSuccess();var c,f,g=b.wrapper||e("body"),h=g.find('[data-field="cost"]'),i=g.find("[data-discount]"),j=a.response.price;j&&j.bandwidthPrice&&("undefined"!=typeof j.bandwidthPrice.unitPrice?f=j.bandwidthPrice.unitPrice:(c=j.bandwidthPrice.originalPrice,f=j.bandwidthPrice.discountPrice),e(".cost-li").show(),h.html(Math.abs(f)),e(".deadline-li").hide(),c&&c!==f?(g.find('[data-field="origin-cost"]').html(c),g.find('[data-field="pricetitle"]').text("优惠价"),i.show()):(g.find('[data-field="pricetitle"]').text("需支付费用"),i.hide()),"undefined"!=typeof c&&g.find('[data-field="orig-config-cost"]').html(c))})["catch"](function(a){console.warn(a)})}else d&&d.renderSuccess();u?(e(".is-bandwidth-limited").prop("checked",!0),e(".is-bandwidth-unlimited").prop("checked",!1),this.rangeWrapper.show()):(e(".is-bandwidth-unlimited").prop("checked",!0),e(".is-bandwidth-limited").prop("checked",!1)),this.bindEvent(),this.showChangeModeInfo(z)},y.prototype.showChangeModeInfo=function(a){var b=this;b.listIns.isNetworkShiftUpUser||b.getChangeLimit().then(function(c){b.changeLimitInfo=c,c=c||{},c.isChangeFlow=w,c.networkPayModeDesc=a;var d=c.maxCount-c.currCount,g=f.tmpl(t.changeModeTips,c);if(h.el.find(".dialog_layer_cont").prepend(e(g)),w&&h.el.find("#leftChangeCount").show(),!w&&d>0){var i=b.canChangeToYearMonth();i&&e("#changeMode").show()}})},y.prototype.bindEvent=function(){var a=this.rangeWrapper,b=this.wrapper.find('input[name="bw_limit_type"]');b.change(function(){var c=b.filter(":checked");"1"==c.val()?a.show():a.hide()}),e(".is-bandwidth-limited").click(function(){e(".is-bandwidth-unlimited").removeClass("checked"),e(this).addClass("checked"),a.show(),u=!0}),e(".is-bandwidth-unlimited").click(function(){e(".is-bandwidth-limited").removeClass("checked"),e(this).addClass("checked"),a.hide(),u=!1});var c=this;e("#changeMode").click(function(){c.upgrade.exec("changeFlow")})},y.prototype.canChangeToYearMonth=function(){if(this.hasPermItems.length>1)return!1;var a=this.hasPermItems[0];return m.isPrepaidPayMode(a.instanceChargeType)&&m.isNetworkFlowPayMode(a.internetAccessible.internetChargeType)?!0:!1},y.prototype.getChangeLimit=function(){if(this.changeLimitInfo){var a=e.Deferred();return a.resolve(this.changeLimitInfo),a}var b=this.hasPermItems[0];this.upgradeCommon=new q(this);var a=this.upgradeCommon.getActionsLimit(p.getRegionId(),"INTERNET_CHARGE_TYPE_CHANGE",b.uInstanceId);return a},y.prototype.showChangeModeConfirm=function(a){var b=this;h.hide();var c=b.hasPermItems[0],d=b.changeLimitInfo.currCount,e=b.changeLimitInfo.maxCount-b.changeLimitInfo.currCount,g=a.getInputData();r.apiRequest({action:"InquiryPriceModifyInstanceInternetChargeType",serviceType:"cvm",regionId:c.regionId,data:{InstanceId:c.uInstanceId,InternetAccessible:{InternetMaxBandwidthOut:Math.min(g.bandwidth,b.max),InternetChargeType:l.NETWORKPAYMODE.TRAFFIC_POSTPAID_BY_HOUR}}}).then(function(a){var c=a.response.price;if(c&&c.bandwidthPrice){var g=[{uin:c.bandwidthPrice.uin,amount:c.bandwidthPrice.returnCost.toFixed(2)}],i=f.tmpl(t.changeModeConfirm,{maxCount:b.changeLimitInfo.maxCount,currCount:d,leftCount:e,returnInfo:g});h.create(i,"580","",{title:"确认切换","class":"dialog_layer_v2",preventResubmit:!0,button:{"我知道了，确认切换":function(){b.sendReq()}}})}})["catch"](function(a){console.warn(a)})},y.prototype.sendReq=function(){var a=this,b=this.wrapper.find('input[name="bw_limit_type"]'),c=b.filter(":checked");if(c&&c.length>0)var d="1"==c.val()?this.bandWidthRange.val():x;else var d=this.bandWidthRange.val();for(var e,f=[],g=[],i=0;e=this.hasPermItems[i];i++)w||e.internetAccessible.internetMaxBandwidthOut!=d?f.push(e.uInstanceId):g.push(e.uInstanceId);if(a.args&&"changeFlow"!==a.args[2]&&g.length==this.hasPermItems.length)return this.restoreDialogBtn(),n.error("带宽未变更!");var j,m,o=this.hasPermItems[0];w?(j="ModifyInstanceInternetChargeType",m={InstanceId:f[0],InternetAccessible:{InternetMaxBandwidthOut:u?d:x,InternetChargeType:l.NETWORKPAYMODE.TRAFFIC_POSTPAID_BY_HOUR}}):(j="ResetInstancesInternetMaxBandwidth",m={InstanceIds:f,InternetAccessible:{InternetMaxBandwidthOut:u?d:x}}),r.apiRequest({action:j,serviceType:"cvm",data:m,regionId:o.regionId},{camTipsType:"dialog"}).then(function(b){h.hide(),a.checkTask({},"调整网络中"),a.listIns&&a.listIns.callback&&a.listIns.callback()})["catch"](function(a){console.warn(a)}),k.click("yunzhuji.btn.bandwidthlimit")},y.prototype.getSliderSection=function(a){switch(a){case 100:return[{value:5,width:100},{value:20,width:200},{value:100,width:300}];case 200:return[{value:10,width:100},{value:40,width:200},{value:200,width:300}];case 400:return[{value:20,width:100},{value:80,width:200},{value:400,width:300}];case 1e3:return[{value:500,width:150},{value:1e3,width:300}];default:return[{value:a,width:300}]}},c.exports=y}),define("cvm/cvm/event/bindAutoSnapshotPolicy/bindAutoSnapshotPolicy",function(a,b,c){var d,e=a("cvm/cvm/event/operate_base"),f=a("cvm/common/renderMonitor"),g=a("cvm/cbs2/data"),h=a("modules/cvm/cbs/cbs"),i=a("cvm/cbs2/event/bindAutoSnapshotPolicy"),j=function(a){e.call(this,a)};j.prototype=new e,j.prototype.exec=function(){d=f.init(c.id,"kennyang"),d&&d.renderBefore();var a=this,b=this.hasPermItems||[],e=b.reduce(function(a,b){return a.concat(b.cbsList)},[]),j=b[0]&&b[0].regionId;g.queryDisks({regionId:j,DiskIds:e.map(function(a){return a.diskId}),Limit:e.length,offset:0}).then(function(b){var c=b.response.diskSet,e=void 0===c?[]:c;i.init(h.formatData(e,[],[]),{regionId:j,callback:a.callback}),d&&d.renderSuccess()})},c.exports=j}),define("cvm/cvm/event/bindEip/bindEip",function(a,b,c){var d,e=(a("$"),a("cvm/cvm/event/operate_base")),f=a("dialog"),g=a("tips"),h=a("util"),i=a("cvm/eip2/data"),j=a("cvm/eip2/common/util"),k=a("cvm/eip2/eip"),l=a("qccomponent"),m=a("cvm/common/renderMonitor"),n={main:'  <ul class="form-list">    <li>      <div class="form-label required">        <label for="">实例</label>      </div>      <div class="form-input">        <p>{{ selectedItem.uInstanceId }} ({{ selectedItem.alias }})</p>      </div>    </li>    <li>      <div class="form-label required">        <label for="">当前IP</label>      </div>      <div class="form-input">        <p b-if="selectedItem.deviceWanIp">          {{ selectedItem.deviceWanIp          }}<span class="text-label text-danger" style="margin-left: 15px;"            >(此公网IP将被释放)</span          >        </p>        <p b-if="!selectedItem.deviceWanIp">          -<span class="text-label" style="margin-left: 15px;"            >(该实例没有公网IP)</span          >        </p>      </div>    </li>    <li>      <div class="form-label required">        <label for="">新IP</label>      </div>      <div class="form-input">        <div          class="cont-eip-select"          b-if="!eipList || eipList.length === 0"        ></div>        <div class="tc-15-select-wrap m" b-if="eipList && eipList.length > 0">          <select class="tc-15-select" b-model="selectEIpId">            <option b-repeat="item in eipList" value="{{ item.id }}">{{              item.label            }}</option>          </select>        </div>        <span          style="margin-left: 5px; color: red;"          class="eip-select-tips"        ></span>      </div>    </li>  </ul>',noeip:'  <span>您还没有弹性公网IP，</span  ><a    href="/cvm/eip"    data-event="nav"    data-hot="yunzhuji.createeip"    class="btn-createeip"    >点此创建</a  >。',wipToEieip:'  <div class="tc-15-msg">    <strong      >检测到这台实例已有公网IP(<%=item.deviceWanIp%>)，是否将其转化为EIP？</strong    >    <p class="txt">      特性：IP将保持不变，直接转为弹性公网IP保持绑定，且不中断您的服务！    </p>    <p class="txt">      配额：您最多可开通 <%=eipQuotaData.quotaLimit%> 个EIP，已开通      <%=eipQuotaData.quotaCurrent%> 个。    </p>    <p class="txt">      计费：为保证IP资源有效利用，未绑定实例的EIP，将按小时收取少量费用。    </p>  </div>',confirm:'  <div    style="width: 350px; margin-left: 10px; vertical-align: middle; display: inline-block;"  >    请确认弹性公网IP：<%= selectedEipItem.ip %>    <br />绑定实例：<%= selectedItem.uInstanceId %>(<%= selectedItem.alias    %>)的操作 <% if(selectedEipItem.deviceWanIp) { %>    <span      ><br />      绑定后，原来的公网IP：<%= selectedEipItem.deviceWanIp %>      将被释放回腾讯云，      <span style="color: red;">无法找回！</span>    </span>    <% } %>  </div>'},o=l.extend({$tpl:n.main,$afterInit:function(){this.$watch("selectEIpId",function(a){var b=this.$get("eipList"),c=b.find(function(b){return b.id==a});this.$set("selectedEipItem",c),c.isArrears?(f.toggleBtnDisable(!0,0),f.el.find(".eip-select-tips").text("该EIP已欠费隔离中")):(f.toggleBtnDisable(!1,0),f.el.find(".eip-select-tips").text(""))})}},{defaults:{expandList:!0,step:1}}),p=function(a){e.call(this,a)};p.prototype=new e,p.prototype.exec=function(){d=m.init(c.id,"kennyang"),d&&d.renderBefore();var a=this;a.bind()},p.prototype.bind=function(){var a=this,b=this.hasPermItems[0];a.bindEipBee=new o({$data:{selectedItem:b}}),f.create(a.bindEipBee.$el,540,"",{title:"绑定弹性公网IP",button:{" 确定 ":function(){a.sendReq()}}}),i.getEipList({filters:[{name:"address-status",values:["UNBIND"]},{name:"applicable-for-clb",values:["FALSE"]}],regionId:b.regionId}).then(function(c){d&&d.renderSuccess();var e=c.eips&&c.eips.nodes||[];if(e=i.formatList(e,{isNetworkShiftUpUser:a.listIns.isNetworkShiftUpUser}),0==e.length)return void f.el.find(".cont-eip-select").html(n.noeip);var g=[];e.forEach(function(a){var c=a.name||"未命名";g.push({id:a.id,ip:a.ip,label:a.id+"("+c+"|"+a.ip+")",regionId:b.regionId})}),0==g.length&&g.push({id:-1,arrears:0,label:"请选择弹性公网IP"}),a.bindEipBee.$set("eipList",g),a.bindEipBee.$set("selectedEipItem",g[0])}),a.initEvent()},p.prototype.initEvent=function(){f.el.find(".cont-eip-select").on("click",".btn-createeip",function(){k._needOpenCreate=!0})},p.prototype.sendReq=function(){var a=this,b=a.hasPermItems[0],c=a.bindEipBee.$get("selectedEipItem");if(!c||-1==c.id)return void g.error("请选择弹性公网IP");var d=h.tmpl(n.confirm,{selectedEipItem:c,selectedItem:b});j.getConfirm({title:"绑定弹性公网IP",content:d},function(){i.bindEip({data:{AddressId:c.id,InstanceId:b.uInstanceId},regionId:c.regionId},{camTipsType:"dialog"}).then(function(b){f.hide(),a.checkTask({},"绑定中"),a.callback&&a.callback()})["catch"](function(a){"InvalidInstanceId.NotSupported"==a&&f.confirm("S4系列、M4系列、GN6s系列、SN3ne系列、S2ne系列为新机型，暂不兼容Anycast等功能。您可在云主机“调整配置”功能中更改机型。")})})},c.exports=p}),define("cvm/cvm/event/bindEni/bindEni",function(a,b,c){var d,e=a("$"),f=a("cvm/cvm/event/operate_base"),g=a("widget/selectors/EniSelector"),h=a("dialog"),i=a("tips"),j=a("util"),k=a("cvm/common/renderMonitor"),l=a("cvm/common/model"),m={main:'  <div class="binding-ip" id="cvmBindEni">    <div class="tc-15-option-hd mb10">      <h4 class="mb10">请选择实例"{{ instanceId }}"要绑定的弹性网卡</h4>      <p class="mb10">        该实例支持{{ eniLimit }}块网卡，每个网卡支持{{ eniIpLimit }}个内网IP，<a          href="//www.qcloud.com/document/product/215/6513#.E4.BD.BF.E7.94.A8.E7.BA.A6.E6.9D.9F"          target="_blank"          >查看网卡配额说明 <b class="external-link-icon"></b        ></a>      </p>      <p class="mb10">        <label          class="form-ctrl-label {{ action.disabled ? \'text-weak\' : \'\' }}"          data-title?="action.disabled && action.disabledTip"          b-repeat="action in actions"        >          <input            type="radio"            name="rd-demo1"            class="tc-15-radio"            b-model="actionType"            disabled?="action.disabled"            value="{{ action.type }}"          />          {{ action.label }}        </label>      </p>      <span b-if="actionType==\'bind\'"        >已筛选"私有网络：{{ netName }}，可用区：{{          zoneName        }}"下的弹性网卡</span      >    </div>    <eni-selector      b-ref="eni"      zone-id="{{ zoneId }}"      instance-id="{{ instanceId }}"      region-id="{{ regionId }}"      callback="{{callback.bind(this)}}"      vpc-id="{{ unVpcId }}"      eni-ip-limit="{{ eniIpLimit }}"      extra-param="{{ extraParam }}"      search-placeholder="搜索名称、内网IP"      b-if="actionType==\'bind\'"    ></eni-selector>  </div>',overlimit:'  <div class="dialog-confirm-box">    <p class="dialog-confirm-title">      <i class="m-error-icon"></i><strong>弹性网卡数量已达到上限</strong>    </p>    <p class="dialog-confirm-text">实例绑定弹性网卡数量超过上限。</p>  </div>',tipcontent:'  <div class="dialog-confirm-box">    <p class="dialog-confirm-title">      <i class="<%= iconClassName %>"></i><strong><%= text %></strong>    </p>    <p class="dialog-confirm-text"><%= desc %></p>  </div>',bindtip:'  <div class="tc-15-msg" style="margin: 10px 0;">    <div class="tip-info">      实例绑定弹性网卡后，您需登录实例配置IP及路由，点击      <a href="//cloud.tencent.com/document/product/576/18535" target="_blank">        查看操作指南</a      >    </div>  </div>'},n={0:{text:"绑定成功",desc:"您的弹性网卡已经绑定成功。接下来，还需要登录实例并进行配置后才能生效。具体配置方法可查看文档。",iconClassName:"m-success-icon"},29231:{text:" 弹性网卡已绑定IP数超过此规格实例单网卡IP绑定数上限",desc:" 弹性网卡已绑定IP数超过当前实例单网卡IP绑定数上限，本次绑定失败。",iconClassName:"m-error-icon"},29232:{text:"弹性网卡数量已达到上限",desc:"可能有其它人已经绑定了弹性网卡，使当前实例的弹性网卡数量已达上限，本次绑定失败。",iconClassName:"m-error-icon"},9005:{text:"弹性网卡已被绑定",desc:"可能有其它人已经绑定了弹性网卡，本次绑定失败。您可以重新绑定其它弹性网卡。",iconClassName:"m-error-icon"}},o=Bee.extend({$tpl:m.main,callback:function(a){if(!a.length){var b=this.$get("actions");b[0].disabled=!0,b[0].disabledTip="私有网络："+this.netName+"，可用区：'"+this.zoneName+"'下没有可用的弹性网卡，您可以新建一个并绑定",b.$set(0,b[0]),this.$set("actionType","new")}}},{defaults:{actionType:"bind",actions:[{label:"绑定已有弹性网卡",type:"bind",disabled:!1},{label:"新建弹性网卡并绑定",type:"new",disabled:!1}]}});o.tag("eni-selector",g.extend({parseData:function(a){var b=this;a.list.forEach(function(a){a.ipNum=a.privateIpAddressesSet.length,a.instanceSet&&a.instanceSet.instanceId==b.instanceId&&(a.$disable=!0,a.$disableTips="实例已绑定绑定该网卡"),a.primary&&(a.$disable=!0,a.$disableTips="主网卡不可绑定"),a.instanceSet&&a.instanceSet.instanceId&&(a.$disable=!0,a.$disableTips="该网卡已绑定其他实例"),(a.privateIpAddressesSet||[]).length>b.eniIpLimit&&(a.$disable=!0,a.$disableTips="该网卡绑定的IP数超过了实例支持的上限")});var c=[];return l.apiRequest({serviceType:"vpc",action:"DescribeAddressAssociationQuota",data:{NetworkInterfaceIds:a.list.map(function(a){return a.networkInterfaceId})||[],InstanceId:b.instanceId}}).then(function(d){return c=d.response&&d.response.quotaSet||[],a.list.forEach(function(a){if(c.length){var b=c.find(function(b){return b.networkInterfaceId==a.networkInterfaceId});b&&0==b.quotaCurrent&&(a.$disable=!0,a.$disableTips="已超过设备可绑定的IP配额")}}),b.callback(a.list),a})["catch"](function(){return b.callback(a.list),a})}},{defaults:e.extend({},g.defaults,{colums:[{name:"网卡ID/名称",key:"networkInterfaceName",tdTpl:'<p><span class="text-overflow">{{item.networkInterfaceId}}</span></a></p><span class="text-overflow m-width">{{item.eniName}}</span>'},{name:"所属子网",key:"subnetId"},{name:"网卡内网IP数",key:"ipNum"}]})}));var p=function(a){f.call(this,a)};p.prototype=new f,p.prototype.exec=function(){d=k.init(c.id,"kennyang"),d&&d.renderBefore();var a=this,b=this.cloudAPIActionNameMap.vpc&&this.cloudAPIActionNameMap.vpc.AttachNetworkInterface||"绑定弹性网卡中";this.doAction({instanceId:this.hasPermItems[0].uInstanceId,regionId:this.hasPermItems[0].regionId,zoneId:this.hasPermItems[0].zoneId,zoneName:this.hasPermItems[0].zoneName,unVpcId:this.hasPermItems[0].unVpcId,netName:this.hasPermItems[0].netName}).then(function(c){c=(c||{}).data,a.checkTask(c,b),a.callback&&a.callback()},function(){})},p.prototype.doAction=function(b){var c=this;return new Promise(function(f,g){Promise.all([c.QueryInstanceEniLimit({regionId:b.regionId,instanceId:b.instanceId}),c.QueryInstanceEniNum({regionId:b.regionId,instanceId:b.instanceId,hideSecondary:0})]).then(function(j){d&&d.renderSuccess();var k=j[0].eniLimit||0,l=j[0].eniIpLimit||0,n=j[1]&&j[1].data||[],p=n.length||0;if(p>=k)return void h.create(m.overlimit,500,"",{struct:"rich",closeIcon:!1,defaultCancelBtn:!1,button:{"确定 ":function(){h.hide(),g()}}});var q=c.bee=new o({$data:{instanceId:b.instanceId,netName:b.netName,regionId:b.regionId,zoneId:b.zoneId,zoneName:b.zoneName,eniLimit:k,eniIpLimit:l,extraParam:{hideSecondary:0,limit:20,vpcId:b.unVpcId,zoneId:b.zoneId}}});c.bee.$watch("actionType",function(d){var f=this;"new"==d?nmcLoad("vpc2.js",function(){a.async(["modules/vpc/eni/add/add","modules/vpc/eni/model"],function(a,d){c.add=new a.Add({$data:{regionId:b.regionId,vpcId:b.unVpcId,netName:b.netName,eni:{vpcId:b.unVpcId},cvmAvaliableIP:l,hideRegion:!0},sendCreateRequest:function(a){var c=this;return a=e.extend({},a,{instanceId:b.instanceId
}),d.CreateAndAttachNetworkInterface(a,{tipErr:!1}).then(function(a){return a},function(a){var b,d,g=a.message,h=g.match(/privateIpAddress\(([\d\.]+)\)/);throw h=h&&h[1],h&&(b=e(f.$el).find('[data-ip="'+h+'"]'),29215==a.cgwCode?(d="该内网IP不在弹性网卡子网内",i.hideFlash(1)):29216==a.cgwCode?(d="该内网IP已经被使用",i.hideFlash(1)):29236==a.cgwCode&&(d="该IP为子网保留IP, 不能使用",i.hideFlash(1)),b&&b[0]&&d&&c.validator.showErr(b[0],d),i.error(a.message)),a})}}),e(c.bee.$el).append(c.add.$el),h&&h.center()})}):(e(c.add.$el).remove(),c.add&&c.add.$destroy())}),h.create(q.$el,720,"",{title:"绑定弹性网卡",defaultCancelCb:function(){q.$destroy(),g()},button:{"确定 ":function(a){var d,e=(c.bee.$refs.eni.currentItem||{}).networkInterfaceId;if("bind"==c.bee.actionType){if(!e)return i.flash("请选择弹性网卡","error"),void h.toggleBtnDisable(!1)}else if(!c.add.eni.eniName||!c.add.eni.eniName.length)return h.toggleBtnDisable(!1),void i.flash("弹性网卡名称不能为空","error");h.hide(),h.create(m.bindtip,550,"",(d={title:"绑定弹性网卡",defaultCancelCb:function(){q.$destroy(),g()}},_defineProperty(d,"defaultCancelCb",function(){q.$destroy(),g()}),_defineProperty(d,"button",{"确定":function(a){"bind"==c.bee.actionType?c.sendReq({networkInterfaceId:e,instanceId:b.instanceId,regionId:b.regionId}).then(function(a){var b=a.response;h.hide(),f({data:b})},g):c.add.submit({btn:a}).then(function(a){h.hide(),c.displayTip(a).then(f)},function(a){h.toggleBtnDisable(!1),c.displayTip(a).then(g)})}}),d))}},preventResubmit:!0})},function(){})})},p.prototype.sendReq=function(a){return new Promise(function(b,c){return a&&a.networkInterfaceId?void l.apiRequest({serviceType:"vpc",action:"AttachNetworkInterface",data:{networkInterfaceId:a.networkInterfaceId,instanceId:a.instanceId},regionId:a.regionId}).then(function(a){b(a)},function(){h.toggleBtnDisable(!1),c()}):void b()})},p.prototype.QueryInstanceEniLimit=function(a){return l.apiDelegate({regionId:a.regionId,serviceType:"vpc",action:"GetInstanceEniLimit",data:a}).then(function(a){return a&&a.data||{}})},p.prototype.QueryInstanceEniNum=function(a){return l.apiDelegate({regionId:a.regionId,serviceType:"vpc",action:"DescribeNetworkInterfaces",data:a}).then(function(a){return a&&a.data||{}})},p.prototype.displayTip=function(a){var b=n[a.cgwCode||a.code];return new Promise(function(c,d){0==a.code?c(a):b?h.create(j.tmpl(m.tipcontent,{text:b.text,desc:b.desc,iconClassName:b.iconClassName}),500,"",{struct:"rich",closeIcon:!1,defaultCancelBtn:!1,button:{"确定 ":function(){h.hide(),c(a)}}}):(i.error(a.message),c())})},c.exports=p}),define("cvm/event/bindkeypair/bindkeypair",function(a,b,c){var d,e=a("$"),f=a("cvm/cvm/event/operate_base"),g=a("dialog"),h=a("util"),i=a("appUtil"),j=a("tips"),k=(a("cvm/common/constants"),a("cvm/cvm/event/selectedShow/selectedShow")),l=a("cvm/cvm/event/upgrade_common"),m=a("cvm/common/model"),n=a("cvm/common/renderMonitor"),o=a("widget/errorTips/errorTips"),p=a("widget/mfa/mfa"),q={main:'  <div id="bindkeyWrapper">    <style>      .sshkey-list li label {        overflow: hidden;        text-overflow: ellipsis;        white-space: nowrap;      }    </style>    <div class="mod-secret-key" style="margin-top:0">      <div class="mod-secret-key-tit">对选中实例加载以下密钥：</div>      <div class="search-box" style="margin-bottom: 5px;">        <div class="search-input-wrap">          <textarea class="tc-15-input-text search-input" placeholder="搜索名称"></textarea>          <a href="#" role="button" class="btn-rm-txt" title="清空" id="resetSearchKeyPair">清空</a>        </div>        <input class="search-btn" type="button" value="搜索" id="searchKeypair">      </div>      <div class="secret-key-list" style="min-height:250px">        <ul class="sshkey-list"></ul>      </div>    </div>  </div>',confirm:'  <div class="text-tips">    <p>1、为了避免数据丢失，加载密钥需要在      <em class="text-danger">关机</em>状态下操作，实例将关机中断您的业务，请仔细确认</p>    <p>2、强制关机可能会导致数据丢失或文件系统损坏，您也可以主动关机后进行加载密钥</p>    <p>3、强制关机可能需要您等待较长时间，请耐心等待</p>    <p>      <label class="form-ctrl-label">        <input type="checkbox" b-model="agree" class="tc-15-checkbox">同意强制关机</label>    </p>  </div>',list:'  <% if (data.length) { %>  <% for (var i=0, item; item = data[i]; i++) { %>  <li>    <label class="tc-15-checkbox-wrap" style="display:block">      <input type="checkbox" class="tc-15-checkbox" value="<%- item.key_id %>">      <%= item.key_name %>    </label>  </li>  <% } %>  <% } else { %>  <li style="padding:20px; text-align:center">暂无密钥,    <a href="/cvm/sshkey" data-event="nav">点击新建</a>  </li>  <style>    .secret-key-list {              min-height: 0!important            }          </style>  <% } %>'},r=function(a){f.call(this,a)};r.prototype=new f,r.prototype.exec=function(){var a=this;p.verify({api:"cvm:AssociateInstancesKeyPairs"}).then(function(){d=n.init(c.id,"kennyang"),d&&d.renderBefore();var b=a.hasPermItems,f=b[0],i=h.tmpl(q.main,{}),j=!0;a.upgradeCommon=new l(a);for(var m,o=0;m=b[o];o++)a.upgradeCommon.isStopped(b[o].instanceState)||(j=!1);var p={shutdown:{" 确定 ":function(){a.sendReq()}},nonShutdown:{" 下一步 ":function(){a.toConfirmShutdown({confirmTpl:q.confirm,title:"加载密钥",confirmBtnTxt:"去调整"}).done(function(){a.sendReq(!0)})}}},r=p[j?"shutdown":"nonShutdown"];g.create(i,680,"",{title:"加载密钥",preventResubmit:!0,button:r}),k.render(a.selectedShowOptions),a.wrapper=e("#bindkeyWrapper"),a.keyList=a.wrapper.find(".sshkey-list"),a.keyListData=[],a.getKeyList(f.projectId,1);var s=e("#bindkeyWrapper .search-input");e("#searchKeypair").click(function(){var a=e(".sshkey-list"),b=s.val().trim().toLowerCase();return b.length?void a.children().each(function(a,c){var d=e(this).find(".tc-15-checkbox-wrap").text().trim().toLowerCase();-1===d.indexOf(b)&&e(this).addClass("hide")}):void a.children().each(function(a,b){e(this).removeClass("hide")})}),e("#resetSearchKeyPair").click(function(){var a=e(".sshkey-list");s.val(""),a.children().each(function(a,b){e(this).removeClass("hide")})})})},r.prototype.getKeyList=function(a,b){var c=this,e=1e3,f=e*(b-1);m.graphql({query:"query LoadKeyPairs($filters: [Filter], $limit: Int, $offset: Int){\n                keyPairs(filters: $filters, offset: $offset, limit: $limit) {\n                    totalCount\n                    nodes {\n                        id\n                        key_id\n                        name\n                        key_name\n                        projectId\n                        description\n                        publicKey\n                        associatedInstanceIds\n                        createTime\n                    }\n                }\n            }",variables:{limit:e,offset:f},operationName:null},{camTips:!0}).then(function(e){if(d&&d.renderSuccess(),e.errors)for(var f=0;f<e.errors.length;f++){var g,h=e.errors[f];g=o.isCamRefused(h)?new o.CamTips("<div><cam-tips>"+h.message+"</cam-tips></div>"):new o.ErrorTips("<div><error-tips>"+h.message+"</error-tips></div>"),c.keyList.append(g.$el);break}else{var i=e.keyPairs&&e.keyPairs.nodes||[];c.keyListData=c.keyListData.concat(i),c.renderListUi(i),b+=1,c.keyListData.length<e.keyPairs.totalCount&&c.getKeyList(a,b)}})},r.prototype.renderListUi=function(a){var b=this.keyList,c=h.tmpl(q.list,{data:a});b.append(c)},r.prototype.sendReq=function(a){var b=this,c=this.keyList,d=c.find('input[type="checkbox"]:checked');if(!d.length)return j.error("请选择密钥!"),i.restoreDialogBtn(),!1;for(var f,h=[],k=[],l=0;f=this.hasPermItems[l];l++)h.push(f.uInstanceId);d.each(function(a,b){k.push(e(b).val())});var n=this.cloudAPIActionNameMap&&this.cloudAPIActionNameMap.cvm&&this.cloudAPIActionNameMap.cvm.AssociateInstancesKeyPairs||"下发密钥中";m.apiRequest({action:"AssociateInstancesKeyPairs",serviceType:"cvm",data:{instanceIds:h,keyIds:k,ForceStop:!!a},regionId:i.getRegionId()},{camTipsType:"dialog"}).then(function(a){g.hide(),b.checkTask({taskId:a.response.taskId},n,"sshkey"),b.callback&&b.callback()})["catch"](function(a){console.warn(a)})},c.exports=r}),define("cvm/cvm/event/boot/boot",function(a,b,c){var d,e=(a("$"),a("manager"),a("cvm/cvm/event/operate_base")),f=a("dialog"),g=a("cvm/cvm/event/selectedShow/selectedShow"),h=(a("router"),a("cvm/common/model")),i=a("cvm/common/renderMonitor"),j={main:'<span class="tit">确定选中实例进行开机</span><br>',marginNotEnough:'<span class="tit">余额不足，不能继续使用按量付费资源</span>'},k=function(a){e.call(this,a)};k.prototype=new e,k.prototype.exec=function(){d=i.init(c.id,"kennyang"),d&&d.renderBefore();this.showBootConfirm()},k.prototype.showBootConfirm=function(){var a=this,b=this.hasPermItems,c=this.cloudAPIActionNameMap&&this.cloudAPIActionNameMap.cvm&&this.cloudAPIActionNameMap.cvm.StartInstances||"开机中";f.confirm(j.main,function(){for(var d,e=[],f=0;d=b[f];f++)e.push(d.uInstanceId);e.length&&h.apiRequest({regionId:b[0].regionId,serviceType:"cvm",action:"StartInstances",data:{InstanceIds:e}},{camTipsType:"dialog"}).then(function(b){a.checkTask({taskId:b.response.taskId},c),a.callback&&a.callback()})["catch"](function(a){console.warn(a)})},null,{title:"开机",width:540,hideIcon:!0}),g.render(this.selectedShowOptions),d&&d.renderSuccess()},c.exports=k}),define("cvm/event/buysameconfig/buysameconfig",function(a,b,c){var d=a("cvm/cvm/event/operate_base"),e=function(a){d.call(this,a)};e.prototype=new d,e.prototype.exec=function(){var a=function(a){var b,c=a.dataDisks,d=c.filter(function(a){return a.storageType.indexOf("CLOUD")>-1}).map(function(a){return a.storageType+":"+a.diskSize}).join("|"),e=c.filter(function(a){return a.storageType.indexOf("LOCAL")>-1}),f=a.image&&"MARKET_IMAGE"===a.image.imageType,g=(b={tab:"custom",devPayMode:"PREPAID"===a.instanceChargeType?"monthly":"hourly",regionId:a.regionId,zoneId:a.zoneId,vpcId:a.virtualPrivateCloud&&a.virtualPrivateCloud.vpcId,subnetId:a.virtualPrivateCloud&&a.virtualPrivateCloud.subnetId},_defineProperty(b,f?"marketImageId":"imageId",a.imageId),_defineProperty(b,"systemDiskType",a.systemDisk.storageType),_defineProperty(b,"systemDiskSize",a.systemDisk.diskSize),_defineProperty(b,"bandwidthType",a.internetAccessible.internetChargeType),_defineProperty(b,"dataLocalDiskType",e[0]&&e[0].storageType),_defineProperty(b,"dataLocalDiskSize",e[0]&&e[0].diskSize),_defineProperty(b,"dataCloudDisk",d.length&&d),_defineProperty(b,"bandwidth",a.internetAccessible.internetMaxBandwidthOut),_defineProperty(b,"instanceType",a.instanceType),_defineProperty(b,"networkType",a.virtualPrivateCloud.vpcId&&a.virtualPrivateCloud.subnetId?null:"basic"),_defineProperty(b,"wanIp",a.publicIpAddresses&&a.publicIpAddresses.length?"1":"0"),_defineProperty(b,"securitygroupId",a.securityGroupIds.length&&a.securityGroupIds[0]),_defineProperty(b,"loginSet",a.keyPairIds&&a.keyPairIds[0]?"BIND_SSH_KEY":"AUTO"),_defineProperty(b,"keyPairId",a.keyPairIds&&a.keyPairIds[0]),_defineProperty(b,"projectId",a.projectId),_defineProperty(b,"ignore",!0),_defineProperty(b,"silent",1),_defineProperty(b,"step",3),_defineProperty(b,"alias",a.alias),b),h=Object.keys(g).filter(function(a){return g[a]}).map(function(a){return a+"="+g[a]}).join("&");return"//buy.cloud.tencent.com?"+h},b=this.selectedItems&&this.selectedItems[0];b&&window.open(a(b),"_blank")},c.exports=e}),define("cvm/cvm/event/modifyDiskType/modifyDiskType",function(a,b,c){function d(a){return s.apiRequest({serviceType:"cvm",action:"InquiryPriceModifyInstanceDiskType",data:g(a),regionId:a.regionId})}function e(a){return s.apiRequest({serviceType:"cvm",action:"SwitchParameterModifyInstanceDiskType",data:g(a),regionId:a.regionId})}function f(a){return s.apiRequest({serviceType:"cvm",action:"ModifyInstanceDiskType",data:g(a),regionId:a.regionId})}function g(a){var b=a.instanceId,c=a.targetSystemDiskType,d=a.targetDataDiskType;return{systemDisk:c?{diskType:c}:void 0,dataDisks:d?[{diskType:d}]:void 0,instanceId:b}}function h(a){return r.queryDiskConfigQuota(Object.assign({},a,{InquiryType:"INQUIRY_CVM_CONFIG"})).then(function(a){var b=a.response.diskConfigSet,c=void 0===b?[]:b;return c})}function i(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],b=arguments[1],c=b.diskSize;return a.map(function(a){var b=c<a.minDiskSize||c>a.maxDiskSize,d=!a.available;return{name:q.getDiskTypeNameByDiskType(a.diskType),value:a.diskType,max:a.maxDiskSize,min:a.minDiskSize,disabled:b||d,title:b?"当前硬盘容量大小不满足目标类型大小范围["+a.minDiskSize+","+a.maxDiskSize+"]":d?"售卖火爆，已售罄，加紧补货中":void 0}})}function j(a,b){var c=b.find(function(a){return!a.disabled}),d=c&&c.value||"";if(q.isLocalBasicDiskType(a)){var e=b.find(function(a){return q.isCloudPremiumDiskType(a.value)&&!a.disabled});e&&(d=e.value)}if(q.isLocalSSDDiskType(a)){var f=b.find(function(a){return q.isCloudSSDDiskType(a.value)&&!a.disabled});f&&(d=f.value)}return d}function k(a){return"undefined"==typeof a}var l=a("cvm/cvm/event/operate_base"),m=a("dialog"),n=a("qccomponent"),o=a("appUtil"),p=a("cvm/cvm/cvmutil"),q=a("cvm/cbs2/cbsutil"),r=a("cvm/cbs2/data"),s=a("cvm/common/model"),t=function(a){l.call(this,a)};t.prototype=new l,t.prototype.exec=function(){var a=this,b=this.hasPermItems,c=b[0],g=c.instanceFamily,l=c.regionId,r=c.zone,s=c.instanceId,t=c.systemDisk,u=c.dataDisks,v=c.instanceChargeType,w=new n({$tpl:'  <div>    <p class="text-weak mb-10">      您已选<strong        ><span>{{ selectedItems.length }}</span        >台服务器</strong      >，<a href="javascript:;" b-on-click="toggleShowSelectedDetail()">        <span b-if="showSelectedDetail">收起</span        ><span b-if="!showSelectedDetail">查看详情</span>        <i b-if="!showSelectedDetail" class="blue-down-icon"></i>        <i b-if="showSelectedDetail" class="blue-up-icon"></i>      </a>    </p>    <div b-if="showSelectedDetail" class="mb-20">      <div class="tc-15-table-panel">        <div class="tc-15-table-fixed-head">          <table class="tc-15-table-box">            <colgroup>              <col style="width: 45px;" />              <col />              <col style="" />            </colgroup>            <thead>              <tr>                <th>                  <div><span class="text-overflow">NO</span></div>                </th>                <th>                  <div><span class="text-overflow">实例</span></div>                </th>                <th>                  <div><span class="text-overflow">配置</span></div>                </th>              </tr>            </thead>          </table>        </div>        <div          class="tc-15-table-fixed-body tc-scroll"          style="max-height: 140px;"        >          <table class="tc-15-table-box tc-15-table-rowhover">            <colgroup>              <col style="width: 45px;" />              <col />              <col style="" />            </colgroup>            <tbody>              <tr b-repeat="selectedItem in selectedItems">                <td>                  <span class="text">{{ $index + 1 }}</span>                </td>                <td>                  <div class="text-overflow">                    <p>实例名称：{{ selectedItem.alias }}</p>                    <p>所属网络：{{ selectedItem.netName }}</p>                    <p>内网IP：{{ selectedItem.deviceLanIp }}</p>                    <p>可用区：{{ selectedItem.zoneName }}</p>                  </div>                </td>                <td>                  <div class="text-overflow">                    <p>                      规格：{{ selectedItem.instanceTypeDesc }}，{{                        selectedItem.cpuInfo                      }}CPU，{{ selectedItem.memInfo }}内存                    </p>                    <p>                      系统盘：{{ selectedItem.systemDisk.diskSize }}GB (                      <a                        b-if="selectedItem.systemDisk.diskId"                        href="/cvm/cbs/detail?storageId={{selectedItem.systemDisk.diskId}}&rid={{selectedItem.regionId}}"                        target="_blank"                        >{{ selectedItem.systemDisk.diskId }}</a                      >                      <span b-if="!selectedItem.systemDisk.diskId">{{                        selectedItem.systemDisk.diskTypeName                      }}</span                      >)                    </p>                    <p b-repeat="cbsItem in selectedItem.dataDisks">                      数据盘：                      <span                        >{{ cbsItem.diskSize }}GB (                        <a                          b-if="cbsItem.diskId"                          href="/cvm/cbs/detail?storageId={{cbsItem.diskId}}&rid={{selectedItem.regionId}}"                          target="_blank"                          >{{ cbsItem.diskId }}</a                        >                        <span b-if="!cbsItem.diskId">{{                          cbsItem.diskTypeName                        }}</span                        >)                      </span>                    </p>                    <p>                      带宽：{{ selectedItem.bandwidthInfo }}({{                        selectedItem.networkPayModeDesc                      }})                    </p>                  </div>                </td>              </tr>            </tbody>          </table>        </div>      </div>    </div>    <div class="tip_box">      <p>        调整硬盘介质操作通过数据拷贝的方式进行，受数据量及网络传输影响操作将持续一定时间，请您耐心等待。同时，强烈建议您在转换完成后登陆实例确认数据。      </p>      <p>调整硬盘介质操作不会退还差价费用，关于操作计费的更多规则，请参考<a        href="//cloud.tencent.com/document/product/213/31977"        target="_blank"        >《硬盘介质调整费用说明》 <i class="external-link-icon"></i>      </a>。</p>    </div>    <div class="param-box">      <div class="param-bd">        <ul class="form-list">          <li b-if="instaceLocalSystemDisk" class="pure-text-row">            <div class="form-label"><label for="">系统盘</label></div>            <div class="form-input" b-if="!!systemDiskConfigList">              <p b-if="systemDiskConfigList.length">                <label                  class="form-ctrl-label"                  b-repeat="systemDiskConfigItem in systemDiskConfigList"                  data-title="{{systemDiskConfigItem.title}}"                   ><input                    type="radio"                    name="targetSystemDiskType"                    value="{{systemDiskConfigItem.value}}"                    checked?="targetSystemDiskType == systemDiskConfigItem.value"                    disabled?="systemDiskConfigItem.disabled"                    b-model="targetSystemDiskType"                    class="tc-15-radio"                  />{{ systemDiskConfigItem.name }}</label                >              </p>              <p b-if="!systemDiskConfigList.length">无可用云硬盘类型</span>            </div>          </li>          <li b-if="instaceLocalDataDisk" class="pure-text-row">            <div class="form-label"><label for="">数据盘</label></div>            <div class="form-input" b-if="!!dataDiskConfigList">              <p b-if="dataDiskConfigList.length">                <label                  class="form-ctrl-label"                  b-repeat="dataDiskConfigItem in dataDiskConfigList"                   data-title="{{dataDiskConfigItem.title}}"                  ><input                    type="radio"                    name="targetDataDiskType"                    value="{{dataDiskConfigItem.value}}"                    checked?="targetDataDiskType == dataDiskConfigItem.value"                    disabled?="dataDiskConfigItem.disabled"                    b-model="targetDataDiskType"                    class="tc-15-radio"                  />{{ dataDiskConfigItem.name }}</label                >                              </p>              <p b-if="!dataDiskConfigList.length">无可用云硬盘类型</span>            </div>          </li>          <li class="pure-text-row">            <div class="form-label"><label for="">费用</label></div>            <div class="form-input">              <p b-if="showNoTargetCloudDiskConfigTips">                  <span class="text-warning">没有可以选择的目标云硬盘配置</span>              </p>              <p b-if="queryPriceState == \'loading\'">                  <i class="n-loading-icon"></i>              </p>              <p b-if="queryPriceState == \'success\'">                <span b-if="finalPriceDesc" class="cost">                  <strong>{{ finalPriceDesc }}</strong>                </span>                <span b-if="originalPriceDesc" class="original-cost"> {{originalPriceDesc}}</span>              </p>              <p b-if="queryPriceState == \'failed\'">                <span class="cost">                    <strong>查询失败</strong>                  </span>              </p>            </div>          </li>        </ul>        <div class="mt-5">          <label class="form-ctrl-label">            <input              type="checkbox"              b-model="agreeChangeRule"              class="tc-15-checkbox"            />已阅读并同意            <a              href="//cloud.tencent.com/document/product/213/31978"              target="_blank"              >《调整硬盘介质规则说明》 <i class="external-link-icon"></i>            </a>          </label>        </div>      </div>    </div>  </div>',$data:{selectedItems:b,systemDisk:t,dataDisks:u,instaceLocalSystemDisk:q.isLocalDiskType(t.storageType)?t:null,instaceLocalDataDisk:u&&u.find(function(a){return q.isLocalDiskType(a.storageType)}),showSelectedDetail:!0,regionId:l,zone:r,instanceId:s,chargeType:v,instanceFamily:g,systemDiskConfigList:null,dataDiskConfigList:null,showNoTargetCloudDiskConfigTips:!1,targetSystemDiskType:"",targetDataDiskType:"",queryPriceState:""},$afterInit:function(){this.queryDiskConfig(),this.$watch("[targetSystemDiskType, targetDataDiskType, queryPriceState, agreeChangeRule]",function(a){var b=_slicedToArray(a,4),c=b[0],d=b[1],e=b[2],f=b[3],g=!this.instaceLocalSystemDisk||this.systemDiskConfigList&&!this.systemDiskConfigList.length||c,h=!this.instaceLocalDataDisk||this.dataDiskConfigList&&!this.dataDiskConfigList.length||d,i="success"==e;g&&h&&i&&f?m.toggleBtnDisable(!1):m.toggleBtnDisable(!0)}),this.$watch("[targetSystemDiskType, targetDataDiskType]",function(){var a=this.systemDiskConfigList&&this.systemDiskConfigList.length,b=this.dataDiskConfigList&&this.dataDiskConfigList.length,c=!!this.targetSystemDiskType,d=!!this.targetDataDiskType;(a&&!b&&c||!a&&b&&d||a&&b&&c&&d)&&this.queryPrice()}),this.$watch("[systemDiskConfigList, dataDiskConfigList]",function(){this.showNoTargetCloudDiskConfig(),this.setDefaultSelectedTargetDiskType()})},toggleShowSelectedDetail:function(){this.$set("showSelectedDetail",!this.showSelectedDetail)},queryDiskConfig:function(){var a=this,b=this.regionId,c=this.zone,d=this.chargeType,e=this.instanceFamily,f=this.instaceLocalSystemDisk,g=this.instaceLocalDataDisk,j=this.selectedItems,k={regionId:b,zones:[c],diskChargeType:d,instanceFamilies:[e],CPU:j[0].CPU,Memory:j[0].memory};Promise.all([function(){return f?h(Object.assign(k,{diskUsage:"SYSTEM_DISK"})).then(function(a){return i(a,{diskSize:f.diskSize})}):Promise.resolve(null)}(),function(){return g?h(Object.assign(k,{diskUsage:"DATA_DISK"})).then(function(a){return i(a,{diskSize:g.diskSize})}):Promise.resolve(null)}()]).then(function(b){var c=_slicedToArray(b,2),d=c[0],e=c[1];a.$set({systemDiskConfigList:d,dataDiskConfigList:e})})},showNoTargetCloudDiskConfig:function(){var a=this.systemDiskConfigList,b=this.dataDiskConfigList,c=a&&!a.length||a&&a.every(function(a){return a.disabled}),d=b&&!b.length||b&&b.every(function(a){return a.disabled}),e=a&&!b&&c||!a&&b&&d||a&&b&&(c||d);this.$set("showNoTargetCloudDiskConfigTips",e)},setDefaultSelectedTargetDiskType:function(){var a=this.systemDiskConfigList,b=this.dataDiskConfigList,c=this.systemDisk,d=this.instaceLocalSystemDisk,e=this.instaceLocalDataDisk,f=d&&a&&a.length?j(c.storageType,a):"",g=e&&b&&b.length?j(e.storageType,b):"";this.$set({targetSystemDiskType:f,targetDataDiskType:g})},queryPrice:function(){var a=this,b=this.instanceId,c=this.targetSystemDiskType,e=this.targetDataDiskType,f=this.regionId,g=o.isI18n(),h=g?"美元":"元",i=g?"美元/小时":"元/小时";a.$set({queryPriceState:"loading",finalPriceDesc:"",originalPriceDesc:""}),d({instanceId:b,targetDataDiskType:e,targetSystemDiskType:c,regionId:f}).then(function(b){var c=b.response.price.instancePrice,d=c.discountPrice,e=c.originalPrice,f=c.unitPrice,g=c.unitPriceDiscount;k(d)||k(e)?k(f)||k(g)?a.$set("queryPriceState","failed"):a.$set({queryPriceState:"success",finalPriceDesc:g+" "+i,originalPriceDesc:f>g?f+" "+i:""}):a.$set({queryPriceState:"success",finalPriceDesc:d+" "+h,originalPriceDesc:e>d?e+" "+h:""})},function(b){a.$set("queryPriceState","failed")})},modifyPrepaidInstanceDiskType:function(){var b=this.instanceId,c=this.targetSystemDiskType,d=this.targetDataDiskType,f=this.regionId;e({instanceId:b,targetDataDiskType:d,targetSystemDiskType:c,regionId:f}).then(function(b){var c=b.response.instanceOrder.goods,d=void 0===c?[]:c;a.toPay2(d)})},modifyPostpaidInstanceDiskType:function(){var b=this.instanceId,c=this.targetSystemDiskType,d=this.targetDataDiskType,e=this.regionId;f({instanceId:b,targetSystemDiskType:c,targetDataDiskType:d,regionId:e}).then(function(){m.hide();var b=a.cloudAPIActionNameMap.cvm&&a.cloudAPIActionNameMap.cvm.ModifyInstanceDiskType||"硬盘介质转换中";a.checkTask({},b),a.callback&&a.callback()})}});m.create(w.$el,"600","",{title:"调整硬盘介质",preventResubmit:!0,buttonDisable:[1],button:{" 立即转换 ":function(){p.isPrepaidPayMode(w.chargeType)?w.modifyPrepaidInstanceDiskType():w.modifyPostpaidInstanceDiskType()}}})},c.exports=t}),define("cvm/changeproject/changeproject",function(a,b,c){var d,e,f=a("$"),g=(a("manager"),a("cvm/cvm/event/operate_base")),h=a("dialog"),i=(a("util"),a("tips")),j=a("cvm/cvm/event/selectedShow/selectedShow"),k=(a("appUtil"),a("cvm/common/model")),l=a("cvm/cbs2/data"),m=a("cvm/common/renderMonitor"),n=a("cvm/common/components/ProjectSelector"),o=a("qccomponent"),p={main:'  <div>    <label b-if="storageIds.length" for="changeCbsProject" class="confirm-it" style="margin-bottom: 16px;">      <input type="checkbox" b-model="toChangeCbsPro" checked?="toChangeCbsPro" class="tc-15-checkbox" id="changeCbsProject">同时迁移所有实例上关联的云硬盘</label>    <!-- <div class="table-panel host-table-panel" style="position:static; height:200px">      <div class="tc-table-fixed">        <div class="tc-table-fixed-head">          <table class="tc-table tc-table-headcolor">            <colgroup>              <col class="tc-table-col1">              <col class="tc-table-col2">              <col class="tc-table-col3">            </colgroup>            <thead>              <tr>                <th></th>                <th>                  <span>项目名称</span>                </th>                <th>                  <span>项目说明</span>                </th>              </tr>            </thead>          </table>        </div>        <div class="tc-table-fixed-body def-scroll">          <table class="tc-table tc-table-rowhover">            <colgroup>              <col class="tc-table-col1">              <col class="tc-table-col2">              <col class="tc-table-col3">            </colgroup>            <tbody>              <% for (var i=0, item; item = data[i]; i++ ) {    if (item.projectId == currProjectId) {        var projectName = item.name + " (当前所属项目)";    %>                <tr class="select_project_row">                  <td style="padding-left: 5px;">                    <label class="form-ctrl-label">                      <input type="radio" class="tc-15-radio" name="change_project_radio" value="<%- item.projectId %>" checked disable />                    </label>                  </td>                  <td>                    <div class="mirror-gray-text">                      <span>                        <%= projectName %>                      </span>                    </div>                  </td>                  <td>                    <div class="mirror-gray-text">                      <span>                        <%= item.info %>                      </span>                    </div>                  </td>                </tr>                <%    } else {                            %>                  <tr class="select_project_row">                    <td style="padding-left: 5px;">                      <label class="form-ctrl-label">                        <input type="radio" class="tc-15-radio" name="change_project_radio" value="<%- item.projectId %>">                      </label>                    </td>                    <td>                      <span>                        <%= item.name %>                      </span>                    </td>                    <td>                      <span>                        <%= item.info %>                      </span>                    </td>                  </tr>                  <%                            }} %>            </tbody>          </table>        </div>      </div>    </div> -->    <project-selector b-ref="projectSelector"></project-selector>  </div>'},q=function(a){g.call(this,a)};q.prototype=new g,q.prototype.exec=function(){d=m.init(c.id,"kennyang"),d&&d.renderBefore();var a=this,b=a.listIns.projectData;e=[];for(var g,k=0;g=a.hasPermItems[k];k++)g.cbsList.forEach(function(a){1==a.portable&&e.push(a.diskId)});var l=a.selectedItems[0].projectId;b=b.map(function(a){var b=f.extend({},a);return b.projectId==l&&(b.$disable=!0),b});var q=o.extend({$tpl:p.main});q.tag("project-selector",n.extend({projectList:b,crrProjectId:l,$checked:l},{defaults:{colums:[{name:"项目名称",key:"name",tdTpl:'<div>{{item.name+ (item.projectId == crrProjectId ? "(当前所属项目)":"")}}</div>'},{name:"项目说明",key:"info"}]}}));var r=new q({data:a.listIns.projectData,storageIds:e,toChangeCbsPro:!0});this.bee=r,h.create(r.$el,"680","",{title:"分配至项目",preventResubmit:!0,button:{" 确定 ":function(){var b=a.bee.$refs.projectSelector,c=b.$checked,d=b.list,e=d.find(function(a){return a.projectId==c});return e?void a.sendReq(c):(i.error("请选择项目"),void h.toggleBtnDisable(!1))}}}),h.toggleBtnDisable(!0),r.$refs.projectSelector.$watch("[list,$checked]",function(a){var b=_slicedToArray(a,2),c=b[0],d=b[1],e=c.find(function(a){return a.projectId==d});return void 0!=d&&null!=d&&""!=d&&e?void(d==l?h.toggleBtnDisable(!0):h.toggleBtnDisable(!1)):void h.toggleBtnDisable({disable:!0,index:0,errTips:"请选择项目"})}),j.render(this.selectedShowOptions),d&&d.renderSuccess()},q.prototype.sendReq=function(a){for(var b,c=this,d=[],f=0;b=c.hasPermItems[f];f++)d.push(b.uInstanceId);if(null==a||void 0==a)return i.error("请选择项目!"),void c.restoreDialogBtn();var g={projectId:a,instanceIds:d};k.apiRequest({action:"ModifyInstancesProject",serviceType:"cvm",data:g,regionId:c.hasPermItems[0].regionId},{camTipsType:"dialog"}).then(function(b){var d=c.bee.toChangeCbsPro;e.length&&d?l.modifyStorageAttr({projectId:a,diskIds:e}).then(function(){h.hide(),c.refreshList&&c.refreshList(!0),i.success("修改成功"),c.callback&&c.callback()}):(h.hide(),c.refreshList&&c.refreshList(!0),i.success("修改成功"),c.callback&&c.callback())})["catch"](function(a){console.warn(a)})},c.exports=q}),define("cvm/cvm/event/copySystemDiskData/copySystemDiskData",function(a,b,c){var d=(a("$"),a("tips")),e=(a("util"),a("appUtil"),a("qccomponent")),f=a("cvm/cvm/event/operate_base"),g=a("dialog"),h=(a("reporter"),a("cvm/common/model")),e=a("qccomponent"),i=a("cvm/cbs2/data"),j=a("cvm/cbs2/constants"),k=(a("cvm/cbs2/cbsutil"),a("widget/page/makeAsyncDialogButton"));a("widget/region/regionSelector");var l=e.getComponent("device-selector"),m=(a("nmcConfig"),{cbsSelector:'  <div data-role="device-selector" class="tc-15-mod-selector">    <div b-on="events" class="tc-15-mod-selector-tb">      <div class="tc-15-option-cell options-left">        <div class="tc-15-option-hd">          <h4>            {{ title }}          </h4>        </div>        <div class="tc-15-option-bd">          <div class="search-box {{multipleSearch ? \'multi-search-box\' : \'\'}}">            <div class="search-input-wrap">              <input                b-if="!multipleSearch"                style="padding-left: 10px;"                data-search                type="text"                placeholder="{{searchPlaceHolder}}"                b-model="keyword"                class="tc-15-input-text search-input"              />              <textarea                b-if="multipleSearch"                data-search                type="text"                placeholder="{{searchPlaceHolder}}"                b-model="keyword"                class="tc-15-input-text search-input"              ></textarea>              <a                title="清空"                b-on-click="searchReset()"                class="btn-rm-txt"                role="button"                href="javascript:;"                >清空</a              >            </div>            <input              type="button"              data-search-btn              value="搜索"              class="search-btn"            />          </div>          <div class="tc-15-option-box">            <div class="info-row" b-if="list.length && searchKey">              {{> searchTipTpl }}，              <a b-on-click="backList()" href="javascript:;">返回列表</a>            </div>            <div class="tc-15-table-panel" data-list>              <div class="tc-15-table-fixed-head">                <table class="tc-15-table-box">                  <colgroup>                    <col width="30px" />                    <col width="120px" />                    <col />                    <col />                  </colgroup>                  <thead>                    <tr>                      <th><div class="tc-15-first-checkbox"></div></th>                      <th>                        <div><span class="text-overflow">ID/名称</span></div>                        <i class="resize-line-icon"></i>                      </th>                      <th>                        <div><span class="text-overflow">硬盘属性</span></div>                        <i class="resize-line-icon"></i>                      </th>                      <th>                        <div><span class="text-overflow">容量</span></div>                      </th>                    </tr>                  </thead>                </table>              </div>              <div class="tc-15-table-fixed-body">                <table class="tc-15-table-box tc-15-table-rowhover">                  <colgroup>                    <col width="30px" />                    <col width="120px" />                    <col />                    <col />                  </colgroup>                  <tbody>                    <tr                      data-item                      b-repeat="item in list"                      class="{{item.selected ? \'selected\' : \'\'}} {{item.disabled ? \'disabled\' : \'\'}}"                      data-title?="item.$title"                    >                      <td>                        <div>                          <input                            type="checkbox"                            disabled?="item.disabled"                            class="tc-15-checkbox"                            b-model="item.selected"                          />                        </div>                      </td>                      <td>                        <div class="">                          <p class="text-overflow">                            <a href="javascript:void(0)">{{ item.diskId }}</a>                          </p>                          <p>                            <span class="text-overflow">{{                              item.diskName.length == 0                                ? \'未命名\'                                : item.diskName                            }}</span>                          </p>                        </div>                      </td>                      <td>                        <div class="">                          <span class="text-overflow">{{                            item.diskUsageDesc                          }}</span>                        </div>                      </td>                      <td>                        <div class="">                          <span class="text-overflow">{{                            item.diskSizeDesc                          }}</span>                        </div>                      </td>                    </tr>                  </tbody>                </table>              </div>            </div>            <div class="info-row" b-if="loading">              <b class="n-loading-icon"></b>正在加载...            </div>            <div class="info-row" b-if="!list.length && !loading">              <b class="n-error-icon"></b              >{{ emptyTips || \'未找到匹配\' + deviceName }}              <a b-if="searchKey" b-on-click="backList()" href="javascript:;"                >返回列表</a              >            </div>          </div>        </div>      </div>      <div class="tc-15-option-cell separator-cell">        <i class="icon-sep"></i>      </div>      <div class="tc-15-option-cell options-right">        <div class="tc-15-option-hd">          <h4>已选择({{ selected.length }})</h4>        </div>        <div class="tc-15-option-bd">          <div class="tc-15-option-box">            <div class="tc-15-table-panel">              <div class="tc-15-table-fixed-head">                <table class="tc-15-table-box">                  <colgroup>                    <col style="width: 36%;" />                    <col />                    <col />                    <col style="width: 11%;" />                  </colgroup>                  <thead>                    <tr>                      <th>                        <div><span class="text-overflow">ID/名称</span></div>                        <i class="resize-line-icon"></i>                      </th>                      <th>                        <div><span class="text-overflow">硬盘属性</span></div>                        <i class="resize-line-icon"></i>                      </th>                      <th>                        <div><span class="text-overflow">容量</span></div>                      </th>                      <th></th>                    </tr>                  </thead>                </table>              </div>              <div class="tc-15-table-fixed-body">                <table class="tc-15-table-box tc-15-table-rowhover">                  <colgroup>                    <col style="width: 36%;" />                    <col />                    <col />                    <col style="width: 11%;" />                  </colgroup>                  <tbody data-selected>                    <tr b-repeat="item in selected">                      <td>                        <div class="">                          <p class="text-overflow">                            <a href="javascript:void(0)">{{ item.diskId }}</a>                          </p>                          <p>                            <span class="text-overflow">{{                              item.diskName.length == 0                                ? \'未命名\'                                : item.diskName                            }}</span>                          </p>                        </div>                      </td>                      <td>                        <div class="">                          <span class="text-overflow">{{                            item.diskUsageDesc                          }}</span>                        </div>                      </td>                      <td>                        <div class="">                          <span class="text-overflow">{{                            item.diskSizeDesc                          }}</span>                        </div>                      </td>                      <td>                        <div class="">                          <span class="text-overflow">                            <a                              href="javascript:;"                              class=""                              b-on="{click: _delSelected}"                            >                              <i class="icon-del"></i>                            </a>                          </span>                        </div>                      </td>                    </tr>                  </tbody>                </table>                <div class="info-row" b-if="!selected.length">                  {{ selectedEmptyTips || \'没有选择数据\' }}                </div>              </div>            </div>          </div>        </div>      </div>    </div>  </div>'
}),n=function(a){f.call(this,a)};n.prototype=new f,n.prototype.exec=function(){var a=this,b=a.selectedItems[0],c=new l({mode:"single",events:{"click [data-search-btn]":function(a){this.search(this.keyword||"")},"keydown [data-search]":function(a){13==a.keyCode&&(!this.multipleSearch||this.multipleSearch&&a.ctrlKey)&&(this.search(this.keyword||""),a.stopPropagation())},"mousedown [data-list]>li:not(.disabled),[data-list] [data-item]:not(.disabled)":function(a){var b=this.$root,c=b._shiftIndex,d=b.list[c]&&b.list[c].selected;a.shiftKey&&"undefined"!=typeof c&&d&&this._$list.css({"user-select":"none"})},"click [data-list]>li:not(.disabled),[data-list] [data-item]:not(.disabled)":function(a){var b=this;setTimeout(function(){var c;"INPUT"!==a.target.tagName&&(c=a.currentTarget.bee,c.$set("item.selected",!c.$get("item.selected")));var d,e=b.$root,f=e._shiftIndex,g=a.currentTarget.$index,h=(e.list[f]&&e.list[f].selected,e.$data.selected||[]);h.length&&(h.forEach(function(a,b){a.disabled||(a.selected=!1,e.list.forEach(function(b,c){a.diskId==b.diskId&&e.list.$set(c,{selected:!1})}))}),b._updateSelected(h),b._updateList(h)),d=[e.list[g]],b._updateSelected(d),b._updateList(d)},0)}},$tpl:m.cbsSelector,$data:{title:"选择云硬盘",alias:{id:"diskId"},deviceName:"云硬盘",searchPlaceHolder:"搜索云硬盘名称",initGetData:!0,scrollPager:!0,searchTipTpl:"共找到 {{size || list.length}} 块云硬盘"},$afterInit:function(){},initGetData:!1,scrollPager:!0,multipleSearch:!0,getData:function(a,c){var d=this,e=[{name:"disk-usage",values:["DATA_DISK"]},{name:"zone",values:[b.zone]}],f=a.searchKey?a.searchKey.trim():"";f&&(/^disk-\w{8}$/.test(f)?e.push({name:"disk-id",values:[f]}):e.push({name:"disk-name",values:[f]})),i.queryDisks({filters:e,limit:20,offset:20*(a.page-1),regionId:b.regionId}).then(function(a){var b=a.response&&a.response.diskSet||[];b=d.formatCbsData(b),c(null,{list:b,size:a.response&&a.response.totalCount||0})})},formatCbsData:function(a){return a.forEach(function(a){if(a.diskUsageDesc=j.DISK_USAGE_MAP[a.diskUsage],a.diskSizeDesc=a.diskSize+"G","UNATTACHED"==a.diskState);else if(a.disabled=!0,a.attached)a.$title="当前弹性云硬盘处于已挂载状态，您可先前往云硬盘控制台进行解挂后操作";else if(a.portable)if(a.encrypt)a.$title="该云硬盘为加密云硬盘，不支持作为数据拷贝目的端";else if(a.diskSize<b.systemDisk.diskSize)a.$title="小于系统盘大小的云硬盘不支持作为数据拷贝目的端";else{var c=j.DISK_STATE_DESC_MAP[a.diskState]||"在操作中";a.$title="该云盘正"+c+"，不能作为数据拷贝的目的端"}else a.$title="该云硬盘为非弹性云硬盘，不支持作为数据拷贝目的端"}),a}});g.create(c.$el,"800","",{title:"拷贝系统盘数据",preventResubmit:!0,button:{"确定":function(){if(0===c.selected.length){d.error("您尚未选择目标云硬盘",3e3);var a=g.el.find(".dialog_layer_ft").find(".btn:eq(0)");return a.length&&a.html("<span>确定</span>")&&a.removeClass("btn_unclick"),!1}g.create(new e("<div>复制后将覆盖该数据盘数据，继续复制吗？</div>").$el,"520","",{title:"确认复制",preventResubmit:!0,button:k({" 确定 ":function(){return f()}})})}}});var f=function(){var b=c.selected[0].diskId,d=a.selectedItems[0],e=g.el.find(".dialog_layer_ft").find(".btn:eq(0)");return e.length&&e.html('<i class="ico ico_loading"></i><span>处理中...</span>'),h.apiRequest({action:"CopyInstanceDisk",serviceType:"cvm",data:{InstanceId:d.uInstanceId,DestinationDiskId:b}}).then(function(b){setTimeout(function(){g.hide(),a.listIns&&a.listIns.reload&&a.listIns.reload(),a.callback&&a.callback()},1e3)})["catch"](function(a){e.length&&e.html("<span>确定</span>")&&e.removeClass("btn_unclick")})}},c.exports=n}),define("cvm/event/createimg/createimg",function(a,b,c){var d,e=a("$"),f=a("manager"),g=a("cvm/cvm/event/operate_base"),h=a("validator"),i=a("dialog"),j=a("tips"),k=a("util"),l=a("appUtil"),m=a("event"),n=a("cvm/cvm/event/xentokvm/xentokvm"),o=a("cvm/cvm/event/selectedShow/selectedShow"),p=a("lengthlimiter"),q=a("reporter"),r=a("cvm/cbs2/cbsutil"),s=a("cvm/common/model"),t=a("cvm/image/util"),u=a("cvm/common/renderMonitor"),v=a("widget/mfa/mfa"),w={main:'  <div id="createImgWrapper">    <style>      .deci-ul li {        list-style-type: decimal;        margin-left: 20px;      }    </style>    <div class="tip_box">      <ul class="deci-ul">        <li>          创建自定义镜像的同时系统默认会创建相关快照，删除此快照之前需要先删除关联的镜像，          <% if (!isI18n) { %>            <span class="text-danger">当前快照已经商业化</span>，保留镜像会产生一定的快照费用。账户欠费，会导致制作镜像失败。详细可见<a href="//cloud.tencent.com/document/product/362/17935" target="_blank">快照商业化FAQ</a>          <% } else { %>            <span class="text-danger">云硬盘快照（国际站）将于2019年3月1日启动正式商业化</span>，保留镜像会产生一定的快照费用。账户欠费，会导致制作镜像失败。详细可见<a href="//intl.cloud.tencent.com/document/product/213/30265" target="_blank">快照商业化FAQ</a>          <% } %>        </li>        <% if (osType == "linux") { %>        <li>          <% if (isSupportOnlineCreate) {%> 该实例支持在线制作镜像,          <%}%>镜像制作过程约需10分钟。        </li>        <li>          Linux实例制作自定义镜像请确认          <span class="text-danger">/etc/fstab不包含数据盘配置</span>，否则会导致使用该镜像创建的实例无法正常启动。如果有挂载数据盘，          需要注释或删掉/etc/fstab中自行配置的数据盘的相关配置。        </li>        <% } else if (osType == "windows" && sysprep) { %>        <li>          <% if (isSupportOnlineCreate) {%> 该实例支持在线制作镜像,          <%}%>镜像制作过程约需30分钟。        </li>        <li>          <span class="text-danger">            执行sysprep需要云服务器启用administrator账户；基于windows            2008制作的镜像，无法保留administrator用户目录下的文件。          </span>若不需要使用域账户登录windows，强烈建议选择          <a href="javascript:;" data-event="change_no_sysprep">            不执行sysprep制作镜像          </a>。        </li>        <li>          请务必确认          <span class="text-danger">QcloudService</span>服务已设置为自动启动，否则制作的镜像将不可用。镜像制作失败常见          <a href="https://www.qcloud.com/document/product/213/2504" target="_blank">            解决办法</a>        </li>        <% } else if (osType == "windows" && !sysprep) { %>        <li>          <% if (isSupportOnlineCreate) {%> 该实例支持在线制作镜像,          <%}%>镜像制作过程约需30分钟。        </li>        <% if (!isSupportCloudinit) {%>          <li>            若您需要使用域账号登陆windows，请选择            <a href="javascript:;" data-event="change_sysprep">执行sysprep制作镜像</a>。          </li>        <%}%>        <li>          请务必确认          <span class="text-danger">QcloudService</span>服务已设置为自动启动，否则制作的镜像将不可用。镜像制作失败常见          <a href="https://www.qcloud.com/document/product/213/2504" target="_blank">            解决办法</a>        </li>        <% } %>      </ul>      <% if(isPowerOn){ %>      <p id="norebootTips" style="color:#f00;display:none;">        注意：未选择重启制作镜像时，运行中CVM的内存数据会有一定概率不被写入镜像。      </p>      <% } %>    </div>    <div class="edit_form_wrap">      <ul class="edit_psword">        <li>          <label class="txt"> <span style="color:#f00">*</span>镜像名称:</label>          <input class="tc-15-input-text m" type="text" maxlength="60" />          <p class="tip">支持中文、字母、数字、连接符号</p>        </li>        <li>          <label class="txt">镜像描述:</label>          <textarea class="tc-15-input-textarea" data-lenLimit="60" relTipId="descTip"></textarea>          <p class="tip" id="descTip"></p>        </li>      </ul>    </div>    <% if(isSupportInstanceImage){ %>    <p class="mt-20">      <label class="form-ctrl-label">        <input type="checkbox" id="onlySystemDisk" class="tc-15-checkbox" />仅创建系统盘镜像</label>    </p>    <% } %>  </div>',xenTip:'  <div style="padding:10px; font-size:14px">    该服务器需要置换为新服务器才能制作自定义镜像。    <a href="javascript:;" id="replaceServer">立即置换新服务器</a>  </div>',confirm:'  <div class="text-tips">    <p>      1、为了避免数据丢失，制作自定义镜像需要在      <em class="text-danger">关机</em>状态下操作，云服务器将关机中断您的业务，请仔细确认    </p>    <p>      2、强制关机可能会导致数据丢失或文件系统损坏，您也可以主动关机后进行自定义镜像的制作    </p>    <p>3、强制关机可能需要您等待较长时间，请耐心等待</p>    <p>      <label class="form-ctrl-label">        <input type="checkbox" id="isHardPowerOffFlag" b-model="agree" class="tc-15-checkbox" />同意强制关机</label>    </p>    <% if (isWhiteList){ %>    <p id="noRebootTips" style="color:#f00;">      注意：未选择关机制作镜像时，运行中CVM的内存数据会有一定概率不被写入镜像。    </p>    <% } %>  </div>'},x=function(a){g.call(this,a)};x.prototype=new g,x.prototype.exec=function(){if(1===this.hasPermItems[0].hypervisor)return this.showXenTip();d=u.init(c.id,"kennyang"),d&&d.renderBefore();var a=this;this.isPowerOn=this.hasFeature("NONSHUTDOWN")&&!this.isRecycle,this.imgName="",f.getAllWhiteList(function(b){return b&&b.windows2003_offline&&b.windows2003_offline.length&&(a.whiteList2003=!0),!a.whiteList2003&&/windows2003/.test(a.hasPermItems[0].osValue)?(j.error('不再支持windows 2003的实例制作自定义镜像 <a href="http://bbs.qcloud.com/thread-4937-1-2.html" target="_blank">了解原因</a>',6e3),void(d&&d.renderSuccess())):(s.graphql({query:"query imageList($filters: [Filter], $limit: Int, $offset: Int){\n                    images(filters: $filters, limit: $limit, offset: $offset) {\n                        totalCount\n                        nodes {\n                            id\n                            unImgId\n                            imageName\n                            name\n                            imageDescription\n                            osName\n                            imageType\n                            createTime\n                            creator\n                            status\n                            size:imageSize\n                        }\n                    }\n                }",variables:{filters:[{name:"image-type",values:[t.TYPES.PRIVATE]}],limit:100,offset:0}}).then(function(b){if(b&&b.images){var c={imageSet:b.images.nodes,totalCount:b.images.totalCount};b=c,a.imgData=b}}),void a.showDialog())})},x.prototype.showDialog=function(a){function b(){"windows"===g&&(h+=a?"(执行sysprep)":"(不执行sysprep)"),i.create(c,"550","",{title:h,preventResubmit:!0,button:e}),o.render(f.selectedShowOptions),f.bindEvent(),p.trigger(),d&&d.renderSuccess()}var c,e,f=this,g=f.hasPermItems[0].osType,h="制作自定义镜像";v.verify({api:"cvm:CreateImage"}).then(function(){s.apiRequest({serviceType:"cvm",action:"DescribeInstancesCreateImageAttributes",data:{instanceIds:[f.hasPermItems[0].uInstanceId]},regionId:f.hasPermItems[0].regionId||l.getRegionId()},{camTipsType:"dialog"}).then(function(d){var h=d.response.instanceCreateImageAttributeSet&&d.response.instanceCreateImageAttributeSet[0]||{},i=h.supportOnlineCreateImage,j=void 0===i?!1:i,m=h.supportInstanceImage,n=void 0===m?!1:m,o=h.supportCloudinit,p=void 0===o?!1:o;f.isSupportOnlineCreate=j,f.isSupportInstanceImage=n,f.isSupportCloudinit=p,e=!f.isPowerOn||j?{" 制作镜像 ":function(){f.sendReq(a)}}:{" 下一步 ":function(){f.sendReq(a)}},c=k.tmpl(w.main,{osType:g,sysprep:a,isPowerOn:f.isPowerOn,isSupportOnlineCreate:f.isSupportOnlineCreate,isSupportInstanceImage:f.isSupportInstanceImage,isSupportCloudinit:f.isSupportCloudinit,isI18n:l.isI18n()}),b()})})},x.prototype.bindEvent=function(){var a=this;m.bindCommonEvent(e("#createImgWrapper")[0],"click",{change_sysprep:function(){a.showDialog(!0)},change_no_sysprep:function(){a.showDialog()}})},x.prototype.showXenTip=function(){var a=this;i.create(w.xenTip,"500","",{title:"制作镜像",button:{}}),e("#replaceServer").click(function(){n.render(a)})},x.prototype.sendReq=function(a){var b=this,c=this.hasPermItems[0],d=i.el.find('input[type="text"]'),f=i.el.find("textarea"),g=e.trim(d.val()),j=e.trim(f.val()),l=function(a,b){var c={tip:a};return h.showErr(b,c)},m=this.cloudAPIActionNameMap&&this.cloudAPIActionNameMap.cvm&&this.cloudAPIActionNameMap.cvm.CreateImage||"制作镜像中";if(!g)return l("请输入镜像名称",d);if(g.length>60)return l("镜像名称不能超过60个字符",d);if(!/^[0-9a-zA-Z-\u4e00-\u9fa5]{1,60}$/.test(g))return l("请输入格式正确的名称",d);if(this.imgData)for(var n,o=0;n=this.imgData.imageSet[o];o++)if(g.toLowerCase()==n.imageName.toLowerCase())return l("输入的名称已经存在",d);if(j&&j.length>60)return l("描述长度不能超过60个字符",f);var p={instanceId:c.uInstanceId,imageName:g,imageDescription:j};"windows"==this.hasPermItems[0].osType&&(p.sysprep=a?"TRUE":"FALSE");var t=!!e("#onlySystemDisk").prop("checked"),u=c.dataDisks.filter(function(a){return r.isCloudDiskType(a.storageType)}).map(function(a){return a.diskId});b.isSupportInstanceImage&&(t||(p.dataDiskIds=u));var v=function(){b.isSupportOnlineCreate||(b.isReboot=e("#isHardPowerOffFlag").prop("checked"),b.isPowerOn&&(p.ForcePoweroff=!!b.isReboot)),s.apiRequest({serviceType:"cvm",action:"CreateImage",data:p,regionId:b.hasPermItems[0].regionId},{camTipsType:"dialog"}).then(function(a){i.hide(),a.response.taskId&&(b.checkTask({taskId:a.response.taskId},m),b.callback&&b.callback())})["catch"](function(a){console.warn(a)}),b.isSupportOnlineCreate||b.isPowerOn&&(b.isReboot?q.click("yunzhuji.zzjingxiang.shutoff"):q.click("yunzhuji.zzjingxiang.noshutoff"))};b.isSupportOnlineCreate?v():b.isPowerOn?b.toConfirmShutdown({confirmTpl:k.tmpl(w.confirm,{isWhiteList:b.isWhiteList}),title:"制作自定义镜像",confirmBtnTxt:"制作镜像",isConfirmBtnNoDisable:b.isWhiteList}).done(function(){v()}):v()},c.exports=x}),define("cvm/event/customField/customField",function(a,b,c){var d=a("qccomponent"),e=a("dialog"),f={main:'    <div>        <device-selector list="{{ [{alias: \'cvm\', deviceLanIp: \'10.204.159.113\', uuid: \'123\'}]}}" selected="{{ [{alias: \'cvm\', deviceLanIp: \'10.204.159.113\', uuid: \'123\'}]}}"            init-get-data="{{false}}" scroll-pager="true" multiple-search="true" title="请选择你想显示的列表字段" device-name="云硬盘" search-place-holder="请输入关键字进行搜索"></device-selector>    </div>',selector:'    <div data-role="device-selector" class="tc-15-mod-selector customize-column">        <div b-on="events" class="tc-15-mod-selector-tb">            <div class="tc-15-option-cell options-left">                <div class="tc-15-option-hd">                    <h4>{{title}}</h4>                </div>                <div class="tc-15-option-bd">                    <div class="search-box {{multipleSearch ? \'multi-search-box\' : \'\'}}">                        <div class="search-input-wrap">                            <input b-if="!multipleSearch" style="padding-left: 10px;" data-search type="text" placeholder="{{searchPlaceHolder}}" b-model="keyword"                                class="tc-15-input-text search-input">                            <textarea b-if="multipleSearch" data-search type="text" placeholder="{{searchPlaceHolder}}" b-model="keyword" class="tc-15-input-text search-input"></textarea>                            <a title="清空" b-on-click="searchReset()" class="btn-rm-txt" role="button" href="javascript:;">清空</a>                        </div>                        <input type="button" data-search-btn value="搜索" class="search-btn">                    </div>                    <div class="tc-15-option-box">                        <ul data-list class="tc-15-option-list">                            <li data-item b-repeat="item in list" class="{{item.required  || item.line ? \'disabled\' : \'\'}}" title?="item.$title" b-style="{display: (!item.line && searchStatus && !item.searchStatus)?\'none\':\'block\'}" data-disabled="{{item.required || (selected.length >= maxColumsNum && !item.selected)}}">                                <input b-if="!item.line" type="checkbox" disabled?="item.required || (selected.length >= maxColumsNum && !item.selected)"                                    class="tc-15-checkbox" b-model="item.selected">                                <span b-if="!item.line" class="opt-txt">                                    <span class="opt-txt-inner">                                        <span class="item-name">{{item[alias.name]}}</span>                                    </span>                                </span>                                <div class="text-weak info-row" b-if="item.line">标签键</div>                            </li>                        </ul>                        <div class="info-row" b-if="loading">                            <b class="n-loading-icon"></b>正在加载...</div>                        <div class="info-row" b-if="searchStatus && !found" style="padding-left: 40px;">                            未找到匹配的标签                            <a b-on-click="backList()" href="javascript:;">返回列表</a>                        </div>                    </div>                </div>            </div>            <div class="tc-15-option-cell separator-cell">                <i class="icon-sep"></i>            </div>            <div class="tc-15-option-cell options-right">                <div class="tc-15-option-hd">                    <h4>已选择 ({{selected.length}} / {{maxColumsNum}})</h4>                </div>                <div class="tc-15-option-bd">                    <div class="tc-15-option-box">                        <ul data-selected class="tc-15-option-list">                            <li b-repeat="item in selected">                                <span class="opt-txt">                                    <span class="opt-txt-inner">                                        <span class="item-name">{{> nameTpl}}</span>                                    </span>                                </span>                                <a b-if="!item.required" role="button" class="opt-act" href="javascript:;">                                    <i b-on="{click: _delSelected}" class="icon-del">取消</i>                                </a>                            </li>                        </ul>                        <div class="info-row" b-if="!selected.length">                            {{selectedEmptyTips || ("暂无关联" + deviceName)}}                        </div>                    </div>                </div>            </div>        </div>    </div>'},g={title:"请选择你想显示的列表字段",searchPlaceHolder:"输入关键字",alias:{name:"alias",id:"uuid"},emptyTips:"",searchStatus:!1,found:!1,selectedEmptyTips:"",deviceName:"标签",keyword:"",list:[],size:void 0,selected:[],scrollPager:!1,pageCoef:1,loading:!1,multipleSearch:!1,page:1,count:20,showDesc:!0},h=d.extend({$tpl:f.selector,$afterInit:function(){this.selected.forEach(function(a){a.selected=!0}),this._updateList(this.selected),this.bindEvent()},nameTpl:"{{item[alias.name]}}",searchTipTpl:"共找到 {{size || list.length}} 标签",search:function(a){if(a=a.trim().toLowerCase(),this.searchReset(!0),!a.length)return void this.$set("searchStatus",!1);var b=this.$get("list"),c=!1;b.forEach(function(d,e){!d.line&&d.alias.toLowerCase().indexOf(a)>-1&&(c=!0,b.$set(e,Object.assign({},b[e],{searchStatus:!0})))}),this.$set("found",c),this.$set("searchStatus",!0)},_getData:function(a){var b=this,c=$.Deferred();return this.$set("loading",!0),1===a.page&&b.$set("list",[]),this.getData(a,function(d,e){b.$set("loading",!1),e&&(a.searchKey!==b.searchKey||1===a.page?b.$set($.extend({},a,e)):b.$set({size:e.size,list:b.list.concat(e.list)}),b._updateList(b.selected)),d?c.reject(d):c.resolve(e)}),c.promise()},getData:function(a,b){b(null,this.list.filter(function(a){return a.required||a.selected}))},backList:function(){this.searchReset()},searchReset:function(a){var b=this.$get("list");a||this.$set("keyword",""),this.$set("searchStatus",!1),b.forEach(function(a,c){b.$set(c,Object.assign({},b[c],{searchStatus:!1}))})},_updateSelected:function(a){var b=this.selected,c=this.alias.id;a.forEach(function(a){for(var d=0,e=b.length;e>d;d++)if(b[d]===a||"undefined"!=typeof a[c]&&b[d][c]===a[c])return void(a.selected||b.splice(d,1));a.selected&&b.push(a)}.bind(this))},_updateList:function(a){var b=this.list,c=this.alias.id;a.forEach(function(a){for(var d=0,e=b.length;e>d;d++)if(b[d]===a||"undefined"!=typeof a[c]&&b[d][c]===a[c])return void b.$set(d,a)})},replaceList:function(a){this.$replace("list",a),this._updateList(this.selected)},replaceSelected:function(a){this.$set("selected",a||[]),this._updateList(this.selected.map(function(a){return a.selected=!0,a}))},nextPage:function(){},_delSelected:function(a){this.$data.selected=!1;var b=[this.$data];this.$root._updateSelected(b),this.$root._updateList(b)},bindEvent:function(){var a=this,b=this,c=this._$list=$(this.$el).find("[data-list]");this._scrollLoad({list:c,checkFn:function(){return!b.loading&&b.page*b.count<b.size},callback:function(){return a.nextPage()}}),this._scrollLoad({list:$(this.$el).find("[data-selected]"),checkFn:function(){return!b.loading&&b.selectedPage*b.count<b.selectedSize},callback:function(){}})},_scrollLoad:function(){var a=this,b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},c=b.list,d=c.parent(),e=b.checkFn||function(){},f=b.callback||function(){};d.on("scroll",function(){if(a.scrollPager&&e()){var b=c.height(),g=d.height();b-d.scrollTop()<=g*(a.pageCoef+1)&&f()}})},events:{"click [data-search-btn]":function(a){this.search(this.keyword||"")},"keydown [data-search]":function(a){13==a.keyCode&&(!this.multipleSearch||this.multipleSearch&&a.ctrlKey)&&(this.search(this.keyword||""),a.stopPropagation())},"mousedown [data-list]>li:not(.disabled),[data-list] [data-item]:not(.disabled)":function(a){var b=this.$root,c=b._shiftIndex,d=b.list[c]&&b.list[c].selected;a.shiftKey&&"undefined"!=typeof c&&d&&this._$list.css({"user-select":"none"})},"click [data-list]>li:not(.disabled),[data-list] [data-item]:not(.disabled)":function(a){var b=this;"false"===a.currentTarget.dataset.disabled&&setTimeout(function(){var c;"INPUT"!==a.target.tagName&&(c=a.currentTarget.bee,c.$set("item.selected",!c.$get("item.selected")));var d,e,f,g,h=b.$root,i=h._shiftIndex,j=a.currentTarget.$index,k=[],l=h.list[i]&&h.list[i].selected;if(a.shiftKey&&"undefined"!=typeof i&&l){i>j?(d=j,e=i,"undefined"!=typeof h.lastEnd&&(h.lastEnd>i?(g=i,k=h.list.slice(i,h.lastEnd)):(g=h.lastEnd-1,k=h.list.slice(h.lastEnd,d))),h.lastEnd=d):(d=i,e=j,"undefined"!=typeof h.lastEnd&&(h.lastEnd<i?(g=h.lastEnd-1,k=h.list.slice(h.lastEnd,i)):(g=e,k=h.list.slice(e,h.lastEnd))),h.lastEnd=e),f=h.list.slice(d,e+1),f.forEach(function(a,b){a.disabled||(a.selected=l,h.list.$set(d+b,{selected:l}))});var m=[];k.forEach(function(a,b){h.list.$set(g+1+b,{selected:!l}),m.push(h.list[g+1+b])}),b._updateSelected(m),b._$list.css({"user-select":""})}else f=[h.list[j]],h._shiftIndex=j,delete h.lastEnd,l=h.list[j].selected;b._updateSelected(f)},0)}}},{defaults:g}),i=function(a){this.options=a};i.prototype={showDialog:function(){var a=this.options,b=a.cb,c=new h({$data:{list:a.list,selected:a.selected,maxColumsNum:a.maxColumsNum,reset:a.reset}});e.create(c.$el,"1200","",{title:"自定义列表字段",preventResubmit:!0,button:{" 确定 ":function(){c.getData({},function(a,c){b&&b(c),e.hide()})}}})}},c.exports=i}),define("cvm/cvm/event/destroycvm/destroycvm",function(a,b,c){function d(a){return new Promise(function(b,c){r.queryHangingEipPrice({regionId:a}).then(function(a){b(a.response.price.addressPrice.discountPrice)},function(c){b(q.EIP_REGION_PRICE[a]&&q.EIP_REGION_PRICE[a].price||"-")})})}var e,f,g=a("$"),h=(a("manager"),a("util"),a("config/reactSupport")),i=a("appUtil"),j=a("cvm/cvm/cvmutil"),k=a("cvm/cvm/event/operate_base"),l=a("dialog"),m=(a("validator"),a("cvm/cvm/event/selectedShow/selectedShow")),n=a("cvm/cdh/dialog/destroy"),o=a("cvm/common/model"),j=a("cvm/cvm/cvmutil"),p=a("cvm/eip2/data"),q=a("cvm/eip2/common/config"),r=a("cvm/cvm/data"),s=a("cvm/cbs2/data"),t=a("cvm/common/renderMonitor"),u=a("widget/mfa/mfa"),v=a("cvm/cvm/event/gridViewSelector/gridViewSelector"),w="销毁中",x={main:'  <div class="cvm-ip-dialog">    <style type="text/css">      .swapnotes li {        padding: 4px 0;        list-style-type: disc;        margin-left: 20px;      }    </style>    <div class="tc-15-rich-dialog-bd">      <div class="tc-15-step col2 mb-20">        <ol>          <li b-class="currStep===\'1\' ? \'current\': \'\'">            <div class="tc-15-step-name">              <span class="tc-15-step-num"></span              >{{ isPrepay ? \'退还选项\' : \'销毁选项\' }}            </div>            <div class="tc-15-step-arrow"></div>          </li>          <li b-class="currStep===\'2\' ? \'current\': \'\'">            <div class="tc-15-step-name">              <span class="tc-15-step-num"></span              >{{ isPrepay ? \'确认退还\' : \'确认销毁\' }}            </div>            <div class="tc-15-step-arrow"></div>          </li>        </ol>      </div>      <div b-if="currStep === \'1\'">        <div id="choosed-cvm"></div>        <div          b-if="isSecondpay || isRecycle"          class="tip_box"          style="margin-top:10px;"        >          <ul class="swapnotes">            <li b-if="!isRecycledSecondInstance">              销毁后所有数据将被清除且不可恢复，请提前备份数据。            </li>            <li b-if="isRecycledSecondInstance">              销毁后（立即释放和定时销毁）所有数据将被清除且不可恢复，请提前备份数据。            </li>            <li b-if="!needModifyAddressesAttribute">              如果含有弹性IP(含辅助网卡上的IP)，机器销毁后还会继续保留，闲置IP              <span class="text-danger">会继续产生费用</span              >，如不需保留，请到对应资源管理页面进行释放。            </li>          </ul>        </div>        <ul b-if="isSecondpay && !isRecycle" class="form-list">          <li class="pure-text-row" b-if="needModifyAddressesAttribute">            <div class="form-label"><label for="">弹性公网IP</label></div>            <div class="form-input">              <div class="form-unit">                <p>                  <label class="form-ctrl-label"                    ><input                      type="radio"                      name="delEip"                      b-model="releaseIpModel"                      class="tc-15-radio"                      value="0"                      chekced                    />保留。先解绑弹性公网IP再销毁实例，解绑后的弹性公网IP可以给其他实例继续使用。                    <span class="text-danger"                      >（注意：解绑后的弹性公网IP属于闲置状态，会收取{{                        toI18nMoney(eipPrice, moneyFormat)                      }}/小时的闲置费用）</span                    >                  </label>                </p>                <p>                  <label class="form-ctrl-label">                    <input                      type="radio"                      name="delEip"                      b-model="releaseIpModel"                      class="tc-15-radio"                      value="1"                    />                    销毁。弹性公网IP与实例连带删除，<span class="text-danger"                      >以后将无法找回该弹性公网IP。</span                    ></label                  >                </p>                <p class="form-input-help pl-20">                  云实例绑定的弹性公网IP :                  <a href="https://console.qcloud.com/cvm/eip" target="_blank">                    查看弹性公网IP绑定情况<i class="external-link-icon"></i>                  </a>                </p>              </div>            </div>          </li>          <li class="pure-text-row">            <div class="form-label required">              <label for="">销毁开始时间</label>            </div>            <div class="form-input">              <div class="form-unit">                <p>                  <label class="form-ctrl-label"                    ><input                      b-on-click="selectRightNow()"                      type="radio"                      name="destoryType"                      class="tc-15-radio"                      checked                    />立即销毁</label                  >                </p>                <p>                  <label class="form-ctrl-label"                    ><input                      b-on-click="selectSetTimer()"                      type="radio"                      name="destoryType"                      class="tc-15-radio"                    />定时销毁</label                  >                </p>                <span                  b-if="destoryType==\'setTimer\'"                  class="text-weak"                  b-model="timerTips"                ></span>                <div b-if="destoryType==\'setTimer\'" class="time-box">                  <div class="dev-datepicker date-dropdown-box"></div>                  <div class="dev-timepicker date-dropdown-box"></div>                  <p b-if="less5m" class="text-danger">                    时间设定必须晚于当前时间 5 分钟及以上                  </p>                </div>              </div>            </div>          </li>          <li            class="pure-text-row"            b-if="destoryType!=\'setTimer\' && isRecycledSecondInstance"          >            <div class="form-label required">              <label for="">释放选项</label>            </div>            <div class="form-input">              <p>                <label class="form-ctrl-label"                  ><input                    value="{{ 0 }}"                    type="radio"                    name="remainTime"                    b-model="remainTimeModel"                    class="tc-15-radio"                  />立即释放</label                >              </p>              <p>                <label class="form-ctrl-label"                  ><input                    value="{{ 2 }}"                    type="radio"                    name="remainTime"                    b-model="remainTimeModel"                    class="tc-15-radio"                  />2小时释放</label                >              </p>            </div>          </li>        </ul>        <div          b-if="isPrepay && !isRecycle"          class="tip_box"          style="margin-top:10px;"        >          <ul class="swapnotes">            <li>              销毁后实例将在              <span class="text-danger">回收站保留7天</span>，请提前备份数据。            </li>            <li>              如果含有弹性IP(含辅助网卡上的IP)，机器退还后还会继续保留，闲置IP              <span class="text-danger">会继续产生费用</span              >，如不需保留，请到对应资源管理页面进行释放。            </li>            <li>              您可以选择同时销毁实例上挂载的弹性数据盘，也可以选择保留数据盘数据。需注意，按量计费数据盘将根据其“是否随实例释放”标记决定是否销毁，您可根据需求，前往云硬盘修改属性。            </li>            <li>              资源销毁后，5天无理由退款金额退还至您的腾讯云账号。普通退款金额将按购买支付使用的现金和赠送金比例退还至您的腾讯云账户。            </li>            <li>              若购买时享有折扣或代金券，折扣和代金券              <span class="text-danger">不予退还</span>。            </li>          </ul>        </div>        <div b-if="showReturnCbs" style="margin-bottom: 8px;">          <label class="form-ctrl-label">            <input              b-if="disableReturnCbs"              type="checkbox"              class="tc-15-checkbox"              disabled            />            <input              b-if="!disableReturnCbs"              type="checkbox"              class="tc-15-checkbox"              id="returnCbsBtn"            />            同时销毁挂载在实例上的包年包月数据盘            <span b-if="disableReturnCbs" class="text-danger"              >{{{nonreturnabledCbsReason}}}</span            >          </label>        </div>        <div b-if="isPrepay && !isRecycle">          <label class="form-ctrl-label">            <input              type="checkbox"              b-model="agreeReturn"              class="tc-15-checkbox"            />            已阅读并同意            <a              href="https://www.qcloud.com/document/product/213/9711"              target="_blank"              >退费规则              <i class="external-link-icon"></i>            </a>          </label>        </div>      </div>    </div>    <div b-if="currStep === \'2\'">      <h3 class="mb-10">        本次将        <span class="text-danger">{{ isPrepay ? \'退还\' : \'销毁\' }}</span>        的资源如下：      </h3>      <div id="destroy-cvm-list"></div>      <div id="destroy-cbs-list"></div>      <div id="destroy-ip-list"></div>      <h3 class="mb-10">        本次将 <span class="text-success">保留</span> 的资源如下：      </h3>      <div id="retain-cbs-list"></div>      <div id="retain-ip-list"></div>    </div>    <div class="tc-15-rich-dialog-ft">      <div class="tc-15-rich-dialog-ft-btn-wrap">        <button          class="{{ buttonDisable ? \'tc-15-btn disabled\' : \'tc-15-btn\' }}"          b-if="currStep === \'1\'"          b-on-click="juptToStep(\'2\')"        >          下一步        </button>        <button          class="tc-15-btn weak"          b-if="currStep === \'2\'"          b-on-click="juptToStep(\'1\')"        >          上一步        </button>        <button          class="tc-15-btn "          b-if="currStep === \'2\'"          b-on-click="startDestroyCvm()"        >          {{ isPrepay && !isRecycle ? \'核对退款信息\' : \'开始销毁\' }}        </button>      </div>    </div>  </div>'},y=Bee.extend({$tpl:x.main,toI18nMoney:a("widget/i18n").toI18nMoney,$destroy:function(){this.isSecondpay&&h.useTea(function(){React.__SECRET_DOM_DO_NOT_USE_OR_YOU_WILL_BE_FIRED})},$afterInit:function(){var a=this;this.$watch("releaseIpModel",function(b){a.$set({releaseIpWithInstance:"1"==b?!0:!1,
buttonDisable:!(!this.needSelectRemainTime||"setTimer"==this.destoryType||void 0!=this.remainTime)})}),this.$watch("remainTimeModel",function(b){a.$set({buttonDisable:!(!this.needModifyAddressesAttribute||void 0!=this.releaseIpModel),remainTime:1*b})}),this.$watch("destoryType",function(b){a.$set({buttonDisable:"setTimer"!=b&&this.needSelectRemainTime&&void 0==this.remainTime})}),this.$watch("agreeReturn",function(b){a.$set({agreeReturn:b}),a.validate()}),this.initSelectedDateTime()},validate:function(){return this.isPrepay&&!this.isRecycle?void this.$set("buttonDisable",!this.$get("agreeReturn")):this.isDateValidate?void this.$set("buttonDisable",!1):void this.$set("buttonDisable",!0)},juptToStep:function(a){var b=this.$get("buttonDisable");b||(this.$set({isReturnCbsChecked:g("#returnCbsBtn").is(":checked"),currStep:a}),"2"===a&&this.renderStep2())},renderStep2:function(){var a=this.releaseIpWithInstance,b=this.cbsList,c=this.addressList,d=this.isReturnCbsChecked,f=this.returnableCbsIds,g=this.isPrepaidInstance,h=b.filter(function(a){return"SYSTEM_DISK"===a.diskUsage||!a.portable||"POSTPAID_BY_HOUR"==a.diskChargeType&&a.deleteWithInstance||"PREPAID"==a.diskChargeType&&g&&f.length>0&&f.find(function(b){return b==a.diskId})&&d});this.$set("deleteWithInstanceDiskList",h),v.render({list:e.selectedItems,renderTo:"#destroy-cvm-list",type:"cvm"}),v.render({list:h,renderTo:"#destroy-cbs-list",type:"cbs"});var i=b.filter(function(a){return!h.find(function(b){return b.diskId===a.diskId})});v.render({list:i,renderTo:"#retain-cbs-list",type:"cbs"});var j=[],k=[];c.length>0&&(a?(j=c,k=[]):(j=[],k=c)),v.render({list:j,renderTo:"#destroy-ip-list",type:"eip"}),v.render({list:k,renderTo:"#retain-ip-list",type:"eip"})},startDestroyCvm:function(){var a=this,b=this.regionId,c=this.instanceIds,d=this.isPrepay,f=this.isSecondpay,g=this.releaseIpWithInstance,h=this.isReturnCbsChecked,j=this.returnableCbsIds,k=this.needModifyAddressesAttribute;c.length>0&&(!d||f||e.isRecycle?k?s.ModifyAddressesAttribute({AddressIds:a.addressList.map(function(a){return a.addressId}),CascadeRelease:!!g},b).then(function(){a.destroySecondInstance()})["catch"](function(a){console.warn(a)}):a.destroySecondInstance():o.apiRequest({action:"SwitchParameterTerminateInstances",serviceType:"cvm",data:{InstanceIds:c,Version:"2017-03-12"},regionId:b}).then(function(a){var c="https://"+window.QCBUY_HOST+"/refund/check",d=a&&a.response&&a.response.instanceOrder.goodsInfo||{};j.length&&h&&(d.cbs={regionId:b,resourceIdList:j}),i.submitForm(c,{rawRefundsInfo:d})})["catch"](function(a){console.warn(a)}))},destroySecondInstance:function(){var a=this,b=this.regionId,c=this.instanceIds,d=this.releaseIpWithInstance,f=this.importTTIds,g=this.updateTTIds,h=this.terminateTimerIds,j=this.remainTime;if(a.isSecondpay&&"setTimer"==a.$get("destoryType")){var k=i.formatDate(a.selectDateTime,"yyyy-MM-dd hh:mm:ss");Promise.all([new Promise(function(a,c){f.length?o.apiRequest({regionId:b,serviceType:"cvm",action:"ImportInstancesActionTimer",data:{InstanceIds:f,ActionTimer:{TimerAction:"TerminateInstances",ActionTime:k,Externals:{ReleaseAddress:!!d}}}},{camTipsType:"dialog"}).then(function(b){a(b)})["catch"](function(a){c({error:a})}):a()}),new Promise(function(a,c){g.length?o.apiRequest({regionId:b,serviceType:"cvm",action:"UpdateInstancesActionTimer",data:{ActionTimerIds:h,ActionTimer:{ActionTime:k}}},{camTipsType:"dialog"}).then(function(b){a(b)})["catch"](function(a){c({error:a})}):a()})]).then(function(a){var b=a[0]||a[1];b&&(l.hide(),setTimeout(function(){e.refreshList()},1e3)),e.callback&&e.callback()})["catch"](function(a){console.warn(a)})}else o.apiRequest({regionId:b,serviceType:"cvm",action:"TerminateInstances",data:{InstanceIds:c,ReleaseAddress:!!d,RemainTime:j}},{camTipsType:"dialog"}).then(function(a){l.hide(),e.checkTask({taskId:a.response.taskId},w),e.callback&&e.callback()})["catch"](function(a){console.warn(a)})},selectRightNow:function(){this.$set("destoryType","rightNow"),this.hideTimer()},selectSetTimer:function(){this.$set("destoryType","setTimer"),this.showTimer()},initSelectedDateTime:function(){if(this.terminateTimer){var a=i.getDate(this.terminateTimer.actionTime);a&&(this.selectDateTime=a)}},getInitDateTime:function(){return this.selectDateTime?this.selectDateTime:new Date((new Date).getTime()+36e5)},hideTimer:function(){this.$destroy()},showTimer:function(){var a=this;a.isDateValidate=!0,this.isSecondpay&&h.useTea(function(){var b=React.__SECRET_DOM_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,c=a.getInitDateTime();a.selectDateTime=c;var d=[j.paddingLeft(c.getFullYear(),4),j.paddingLeft(c.getMonth()+1,2),j.paddingLeft(c.getDate(),2)].join("-"),e=[j.paddingLeft(c.getHours(),2),j.paddingLeft(c.getMinutes(),2),j.paddingLeft(c.getSeconds(),2)].join(":"),f=new Date,g={min:[j.paddingLeft(f.getFullYear(),4),j.paddingLeft(f.getMonth()+1,2),j.paddingLeft(f.getDate(),2)].join("-"),max:[j.paddingLeft(f.getFullYear()+100,4),j.paddingLeft(f.getMonth()+1,2),j.paddingLeft(f.getDate(),2)].join("-")},h=function(){var b=i.getDate(d+" "+e),c=a.isDateValidate=b.getTime()-Date.now()>3e5;a.$set("less5m",!c),c?(a.selectDateTime=b,a.$set("timerTips","已设定 "+d+" "+e+" 销毁")):(a.selectDateTime=null,a.$set("timerTips","")),a.validate()},k=window.tea.component.DatePicker,l=React.createClass({displayName:"DatePicker",render:function(){return React.createElement(k,{mode:"single",defaultValue:d,selected:{from:d,to:d},range:g,onPick:function(a){d=a.from,h()}})}});b.render(React.createElement(l,null),document.querySelector(".dev-datepicker"));var m=window.tea.component.TimePicker,n=React.createClass({displayName:"TimePicker",render:function(){return React.createElement(m,{defaultValue:e,onChange:function(a){e=a,h()}})}});b.render(React.createElement(n,null),document.querySelector(".dev-timepicker")),h()})}},{defaults:{moneyFormat:"words",destoryType:"rightNow"}}),z=function(a){k.call(this,a)};z.prototype=new k,z.prototype.exec=function(){var a=this;u.verify({api:"cvm:TerminateInstances"}).then(function(){f=t.init(c.id,"kennyang"),f&&f.renderBefore();var b=a;e=a;var h=a.hasPermItems,i=!1,k=!0,o=!0,p=!0,q=!0,r=[],s=!0,u=!0,v=[],x=[],z=a.listIns&&a.listIns.whiteList,A=[],B=[],C=z&&z["EnterRecycling-payasyougo"];if(w=a.cloudAPIActionNameMap&&a.cloudAPIActionNameMap.cvm&&a.cloudAPIActionNameMap.cvm.TerminateInstances||"销毁中",h.forEach(function(a){a.uHostId&&(i=!0),r.push(a.uInstanceId),j.isPrepaidPayMode(a.instanceChargeType)&&(o=!1,q=!1),j.isSecondPayMode(a.instanceChargeType)&&(k=!1,q=!1),j.isSpotPayMode(a.instanceChargeType)&&(o=!1,k=!1);var b=a.instanceState||a.instanceStatus&&a.instanceStatus.instanceState;j.isShoutdownStatus(b)||(s=!1,u=!1),a.isCbsRefundWhite||(p=!1),a.terminateTimer?(v.push(a.terminateTimer),x.push(a.terminateTimer.actionTimerId),B.push(a.instanceId)):A.push(a.instanceId)}),b.isRecycle=b.isRecycle||u,o&&k&&(k=!1,o=!0),b.noReturn=s,i){var D=new n({selectedItems:h});l.create(D.$el,"600","",{title:"销毁","class":"dialog_layer_v2 tc-15-rich-dialog",preventResubmit:!0,button:{" 确定 ":function(a){D.doAction(l,null,function(a){b.checkTask({},w),b.callback&&b.callback()})}},onload:function(a){f&&f.renderSuccess()}})}else{var E=h[0].regionId;Promise.all([b.checkHasEip(r),b.checkReturnableCbs(r,E,h[0].instanceChargeType),d(E)]).then(function(a){var c=a[0],d=a[1],h=a[2],i=e&&e.listIns&&e.listIns.isNetworkShiftUpUser,j=!b.isRecycle&&o&&!i&&c.hasEip&&!c.hasPrepaidEip,n=o&&!b.isRecycle&&C,q=!1;j||n?q=!0:k&&!b.isRecycle&&(q=!0);var s=new y({$data:{eipPrice:h,isPrepay:k,isSecondpay:o,isRecycle:!!b.isRecycle,currStep:"1",needModifyAddressesAttribute:j,needSelectRemainTime:n,showReturnCbs:p&&d.showReturn&&!b.isRecycle,disableReturnCbs:d.disableReturn,nonreturnabledCbsReason:d.nonreturnabledReason,terminateTimer:v[0],cbsList:d.cbsList,addressList:c.addressList,instanceIds:r,importTTIds:A,updateTTIds:B,terminateTimerIds:x,returnableCbsIds:d.returnableCbsIds,regionId:E,buttonDisable:q,isPrepaidInstance:d.isPrepaidInstance,isRecycledSecondInstance:C,isNetworkShiftUpUser:i}});l.create(s.$el,"610","",{title:k?"退还实例":"销毁实例",preventResubmit:!0,hideIcon:!0,defaultCancelBtn:!1,defaultCancelCb:function(){s.$destroy()},onload:function(a){f&&f.renderSuccess()}}),m.render(Object.assign(b.selectedShowOptions,{renderTo:g("#choosed-cvm")}))})}})},z.prototype.checkHasEip=function(a){var b=this;return new Promise(function(c,d){p.queryEip({data:{filters:[{name:"instance-id",values:a}],limit:200},regionId:b.hasPermItems[0].regionId}).then(function(a){var b=a.response&&a.response.addressSet,d=!1,e=!1;b&&b.length&&(d=!0,b.forEach(function(a){a.payMode&&"BANDWIDTH_PREPAID_BY_MONTH"==a.payMode&&(e=!0)})),c({hasEip:d,hasPrepaidEip:e,addressList:b})},function(a){c({hasEip:!1,hasPrepaidEip:!1,addressList:[]})})["catch"](function(a){console.warn(a)})})},z.prototype.checkReturnableCbs=function(a,b,c){return new Promise(function(d,e){s.queryDisks({filters:[{name:"instance-id",values:a}],limit:1e3,offset:0,regionId:b}).then(function(a){var b=a.response&&a.response.diskSet||[],e=[],f=!1,g="",h={1:"当前云硬盘曾执行过退还操作，暂不支持重复退还",2:"当前云硬盘已过期",3:"包年包月云硬盘已购买超过5天暂不支持退还",4:"非预付费云硬盘不支持退还",8:"超过可退还的数量限制",9:"通过活动购买的云硬盘暂不支持退还",10:"非弹性云盘、系统盘不支持退还",TREADE_LIMIT:"当前选中销毁的数据盘超过单次销毁上限，请您前往[云硬盘控制台](https://console.qcloud.com/cvm/cbs)退还这些数据盘"};b.length||(f=!1),b.forEach(function(a){"DATA_DISK"==a.diskUsage&&a.diskChargeType==c&&a.portable&&"PREPAID"==a.diskChargeType&&(f=!0,a.isReturnable?e.push(a.diskId):g=h[a.returnFailCode]||h[10])}),e.length>50&&(g=h.TREADE_LIMIT),d({cbsList:b,returnableCbsIds:e,nonreturnabledReason:g,disableReturn:!!g,showReturn:f,isPrepaidInstance:"PREPAID"===c})},function(){d({cbsList:[],returnableCbsIds:[],nonreturnabledReason:"",showReturn:!1})})})},c.exports=z}),define("cvm/cvm/event/dropdown",function(a,b,c){var d=(a("reporter"),a("cvm/cvm/event/operate_entry")),e=a("cvm/cvm/event/operate_auth");return{refresh:function(a,b,c){var f,g=b.gridView,h=a.data("uinstanceid");if($(g.list).each(function(a,b){b.uInstanceId==h&&(f=b)}),f)for(var i,j=d.getModuleArr(),k=new e({dataItems:[f],operAction:j,operActionModuleMap:d.getModuleMap(),listIns:b,check:c,whiteList:b.whiteList}).getAuth(),l=0;i=j[l];l++){var m=a.find('[data-name="'+i+'"]');k[i]&&m.length&&(0===k[i].code?(m.removeClass("disabled").attr("data-title",""),m.is('[data-name="ModifyInstancesAttribute.InstanceName"]')&&m.css("cursor","pointer")):m.is('[data-name="ModifyInstancesAttribute.InstanceName"]')?m.addClass("disabled").attr("title",k[i].tip):m.addClass("disabled").attr("data-title",k[i].tip))}},init:function(a,b){b.gridView;$(a).on("click","tr[data-uinstanceid] [data-event=morebtn]",function(){var b=$(this).closest("div.tc-15-menu-active").length>0;if(b)$(this).parent().removeClass("tc-15-menu-active");else{$(a).find("[data-event=morebtn]").parent().removeClass("tc-15-menu-active");var c=this;setTimeout(function(){$(c).parent().addClass("tc-15-menu-active")},0)}}).on("mouseover","tr[data-uinstanceid] ul.tc-15-dropdown-menu li",function(){$(this).closest("tr").find("ul:gt(0)").hide(),$(this).find("ul").show()});var c=this,d=a.find("tr[data-uinstanceid]");d.each(function(a,d){c.refresh($(this),b)})}}}),define("cvm/cvm/event/export/export",function(a,b,c){function d(a,b){function c(b){if(!(Date.now()-d>12e4)){var f="//"+l+"/cgi/cvm?action=exportPoll&regionId="+a.regionId+"&t"+Date.now();j.request(f,{data:e.extend(a,{Version:"2017-03-12"})}).then(function(a){"DONE"==a.status?b&&b():setTimeout(function(){c(b)},5e3)})["catch"](function(){setTimeout(function(){c(b)},5e3)})}}var d=Date.now();a.rk=[h.getUin(),(new Date).getTime(),Math.round(1e4*Math.random())].join("-");var f=h.objectToParams(a);if(b)c(function(){var a="//"+l+"/cgi/cvm?action=downloadCvm&"+f;location.href=a});else{var g="//"+l+"/cgi/cvm?action=exportCvm&"+f;location.href=g}}var e=a("$"),f=a("cvm/cvm/event/operate_base"),g=a("cvm/common/components/fieldsManager"),h=a("util"),i=a("appUtil"),j=a("cvm/common/model"),k=a("tips"),l=location.hostname.indexOf("cloud.tencent.com")>-1?"iaas.cloud.tencent.com":"iaas.qcloud.com",m=[{name:"ID",key:"InstanceId",defaults:!0,hide:!1,required:!0,miniWidth:134},{name:"实例名",key:"InstanceName",defaults:!0,hide:!0,required:!0,miniWidth:134},{name:"状态",key:"statusDesc",defaults:!0,hide:!1,miniWidth:134},{name:"地域",key:"regionName",defaults:!0,hide:!1,miniWidth:134},{name:"可用区",key:"zoneName",defaults:!0,hide:!1,miniWidth:134},{name:"实例类型",key:"deviceTypeName",defaults:!0,hide:!1,miniWidth:134},{name:"操作系统",key:"OsName",defaults:!0,hide:!1,miniWidth:134},{name:"镜像id",key:"ImageId",defaults:!0,hide:!1,miniWidth:134},{name:"CPU",key:"CPU",defaults:!0,hide:!1,miniWidth:134},{name:"内存",key:"Memory",defaults:!0,hide:!1,miniWidth:134},{name:"带宽",key:"bandwidth",defaults:!0,hide:!1,miniWidth:134},{name:"公网IP",key:"wanIp",defaults:!0,hide:!1,miniWidth:134},{name:"内网IP",key:"lanIp",defaults:!0,hide:!1,miniWidth:134},{name:"系统盘类型",key:"rootType",defaults:!0,hide:!1,miniWidth:134},{name:"系统盘大小",key:"rootSize",defaults:!0,hide:!1,miniWidth:134},{name:"数据盘类型",key:"diskType",defaults:!0,hide:!1,miniWidth:134},{name:"数据盘大小",key:"diskSize",defaults:!0,hide:!1,miniWidth:134},{name:"所属网络",key:"netName",defaults:!0,hide:!1,miniWidth:134},{name:"所在子网",key:"subnetName",defaults:!0,hide:!1,miniWidth:134},{name:"关联vpc",key:"vpcName",defaults:!0,hide:!1,miniWidth:134},{name:"创建时间",key:"CreatedTime",defaults:!0,hide:!1,miniWidth:134},{name:"到期时间",key:"ExpiredTime",defaults:!0,hide:!1,miniWidth:134},{name:"实例计费模式",key:"cvmPayModeName",defaults:!0,hide:!1,miniWidth:134},{name:"网络计费模式",key:"networkPayModeName",defaults:!0,hide:!1,miniWidth:134},{name:"所属项目",key:"projectName",defaults:!0,hide:!1,miniWidth:134},{name:"专用宿主机ID",key:"uHostId",defaults:!0,hide:!1,miniWidth:134},{name:"标签",key:"tagString",defaults:!0,hide:!1,miniWidth:134}],n=[],o=function(a){f.call(this,a),n=a&&a.columns||m,this.expired=a&&a.expired||"",this.hostId=a&&a.hostId||""};o.prototype=new f,o.prototype.exec=function(){this.showFieldsManager()},o.prototype["export"]=function(a,b){var c=this.listIns.isAsyncExport;if(this.listIns&&this.listIns.queryInstanceParams){var e=void 0;switch(b){case"filter":e=Object.assign({},this.listIns.queryInstanceParams);break;case"selected":var f=this.listIns.gridView&&this.listIns.gridView.getSelected();if(!f.length)return k.error("未选中实例"),!0;e=Object.assign({},this.listIns.queryInstanceParams,{filters:[{Name:"instance-id",Values:f.map(function(a){return a.uInstanceId})}]});break;default:e=Object.assign({},this.listIns.queryInstanceParams,{filters:[],vagueIpAddress:void 0,ipAddresses:void 0,vagueInstanceName:void 0})}this.hostId&&e.filters.push({Name:"host-id",Values:[this.hostId]}),delete e.query,delete e.limit,delete e.regionId;var g={t:(new Date).getTime(),uin:h.getUin(),csrfCode:h.getACSRFToken(),projectId:i.getProjectId(),regionId:e.regionId||i.getRegionId(),columns:a,qip:JSON.stringify(e),expired:this.expired};d(g,c)}else{var j=this.selectedItems,l={filters:[{Name:"instance-id",Values:j.map(function(a){return a.uInstanceId})}]},m={t:(new Date).getTime(),uin:h.getUin(),csrfCode:h.getACSRFToken(),projectId:i.getProjectId(),regionId:this.selectedItems[0]&&this.selectedItems[0].regionId||i.getRegionId(),columns:a,qip:JSON.stringify(l),expired:this.expired};d(m,c)}},o.prototype.showFieldsManager=function(){var a=this,b={};n.forEach(function(a){a.hide||0==a.selected||(a.defaults=!0),b[a.key]=a});var c=new g({withoutTips:!0,title:"自定义导出字段",tipText:"请选择你要导出的字段",data:b,eachColNum:1,cacheKey:this.expired?"export-cvm-recycle-columns":"export-cvm-columns",showExportType:!0,callback:function(b,c){return a["export"](b.fields,c)}});if(c.showDialog(),this.args&&this.args[3]&&["grid","detail"].indexOf(this.args[3].from)>=0){var d=e("#customizeColumn");d.find('input[type="radio"]').prop("disabled",!0).eq(2).prop("checked",!0)}},c.exports=o}),define("cvm/cvm/event/firewall/associateSecurityGroup",function(a,b,c){var d,e=a("$"),f=a("reporter"),g=a("dialog"),h=a("tips"),i=a("util"),j=(a("appUtil"),a("event"),a("search"),a("router"),a("cvm/common/model")),k=(a("cvm/cvm/data"),a("./firewall")),l=a("cvm/common/renderMonitor"),m=function(a){k.call(this,a)};m.prototype=new k,m.prototype.initMonitor=function(){d=l.init(c.id,"kennyang"),d&&d.renderBefore()},m.prototype._renderList=function(a,b,c){var e=a;this.searchStr=c;var f=this.hasPermItems[0];e.forEach(function(a){a.url="https://console.cloud.tencent.com/cvm/securitygroup/detail/"+a.sgId+"?rid="+f.regionId}),this.listEl.html(i.tmpl('<div><style>  .inf:hover {    text-decoration: underline  }</style>  <% if (data.length) { %>    <% for (var i=0, item; item = data[i]; i++ ) { %>      <li>        <input class="radio" type="radio" id="rd<%- i %>" value="<%= item.sgId %>" name="rd_test" <% if (item._checked) { %> checked        <% } %>>          <a          class="inf"          for="rd<%- i %>"          href = <%= item.url %>          target = "_blank"          >          ID:            <%= item.sgId %>          </a>          <label class="label" title="<%= item.sgName %>" style="white-space: nowrap;max-width: 360px;  overflow: hidden; text-overflow: ellipsis"            for="rd<%- i %>">            <%= item.sgName %>          </label>      </li>      <% } %>        <% } else { %>          <li style="color:#999">            <%- nodataHtml %>          </li>          <% } %></div>',{data:e,searchStr:c,nodataHtml:b})),this._checkBinding(),d&&d.renderSuccess()},m.prototype.renderFirewallList=function(a){var b=this,c=this.hasPermItems[0].regionId;if(void 0!=a)return a?this._searchList(a):this._renderList(this.listData,'  当前过滤条件下没有安全组，  <a href="javascript:void(0);" data-event="cvm_firewall_add">点击新建</a>');var d=this.hasPermItems.reduce(function(a,b){var c=b.securityGroupIds||[];return c.forEach(function(b){a[b]?a[b]+=1:a[b]=1}),a},{}),e=this.hasPermItems.length;j.apiDelegate({regionId:c,cmd:"DescribeSecurityGroups",serviceType:"dfw",data:{}}).then(function(a){b.listData=a.data.filter(function(a){var b=a.sgId;return d[b]&&d[b]==e?!1:!0}),b._requestComplete()})},m.prototype._requestComplete=function(){this._renderList(this.listData,'  当前过滤条件下没有安全组，  <a href="javascript:void(0);" data-event="cvm_firewall_add">点击新建</a>')},m.prototype._getCheckedSgIds=function(){var a=this.wrapper.find('[name="rd_test"]:checked'),b=a.map(function(){return e(this).val()}).toArray();return b},m.prototype.sendReq=function(){var a=this,b=this.hasPermItems[0].regionId,c=a._getCheckedSgIds();j.apiRequest({regionId:b,serviceType:"cvm",cmd:"AssociateSecurityGroups",data:{Version:"2017-03-12",InstanceIds:this.hasPermItems.map(function(a){return a.uInstanceId}),SecurityGroupIds:c}},{v3:!0}).then(function(){g.hide(),a.refreshList&&a.refreshList(!0),h.success("操作成功"),a.callback&&a.callback(),e("#dfwDetail").trigger("firewallFieldRefresh")})["catch"](function(a){console.warn(a)}),f.click("SecurityGroup.cvmAttachSG")},c.exports=m}),define("cvm/cvm/event/firewall/firewall",function(a,b,c){var d,e,f=a("$"),g=a("reporter"),h=a("dialog"),i=a("tips"),j=a("util"),k=(a("appUtil"),a("event")),l=a("search"),m=a("router"),n=a("cvm/cvm/event/operate_base"),o=a("cvm/cvm/event/selectedShow/selectedShow"),p=a("cvm/common/model"),q=a("cvm/cvm/data"),r=a("cvm/common/renderMonitor"),s={main:'  <div class="change-safe-rule" id="cvmFirewall">    <div class="til clearfix">      <span>选择处于当前地区和项目的安全组</span>      <div id="cvmFirewallSearch" style="float:right"></div>    </div>    <ul class="safe-rule-list def-scroll" id="cvmFirewallList"></ul>  </div>  <div class="tc-15-msg warning" id="firewall-select-tip" style="margin-top: 10px;">    <div class="tip-info"> 每个实例至少需要加入一个安全组，      <a href="//console.cloud.tencent.com/cvm/securitygroup" target="_blank">        <span>新建或查看我的安全组详情          <b class="external-link-icon"></b>。</span>      </a>    </div>  </div>',list:'<div><style>  .inf:hover {    text-decoration: underline  }</style>  <% if (data.length) { %>    <% for (var i=0, item; item = data[i]; i++ ) { %>      <li>        <input class="radio" type="checkbox" id="rd<%- i %>" value="<%= item.sgId %>" name="rd_test" <% if (item._checked) { %> checked        <% } %>>          <a          class="inf"          for="rd<%- i %>"          href = <%= item.url %>          target = "_blank"          >          ID:            <%= item.sgId %>          </a>          <label class="label" title="<%= item.sgName %>" style="white-space: nowrap;max-width: 360px;  overflow: hidden; text-overflow: ellipsis"            for="rd<%- i %>">            <%= item.sgName %>          </label>      </li>      <% } %>        <% } else { %>          <li style="color:#999">            <%- nodataHtml %>          </li>          <% } %></div>',filterNodata:'  当前过滤条件下没有安全组，  <a href="javascript:void(0);" data-event="cvm_firewall_add">点击新建</a>',searchNodata:'  抱歉，未找到匹配安全组，请尝试其他搜索条件。  <a href="javascript:void(0);" data-event="cvm_firewall_list_back">返回列表</a>'},t=function(a){n.call(this,a)};t.prototype=new n,t.prototype.exec=function(){this.initMonitor(),g.click("CVM.SetSecurityGroup.Entry");var a=this;h.create(s.main,"600","",{title:"配置安全组",button:{"确定 ":function(){a.sendReq()}},preventResubmit:!0}),o.render(this.selectedShowOptions),e=2,this.wrapper=f("#cvmFirewall"),this.searchWrapper=f("#cvmFirewallSearch"),this.listEl=f("#cvmFirewallList"),this.search=new l({placeholder:"搜索安全组名称或ID",renderTo:this.searchWrapper,dialogMode:2,width:250,listFun:function(b){a.renderFirewallList(b)}}),this.renderFirewallList(),this.bindEvent()},t.prototype.initMonitor=function(){d=r.init(c.id,"kennyang"),d&&d.renderBefore()},t.prototype.bindEvent=function(){var a=this;k.bindCommonEvent(this.wrapper[0],"click",{cvm_firewall_list_back:function(){a.renderFirewallList("")},cvm_firewall_add:function(){h.hide(),m.navigate("/cvm/firewall")}}),this.wrapper.on("change",function(){a._checkBinding()})},t.prototype._checkBinding=function(){var a=this,b=0===a._getCheckedSgIds().length?!0:!1;h.toggleBtnDisable(b,0)},t.prototype.renderFirewallList=function(a){var b=this,c=this.hasPermItems[0];if(void 0!=a)return a?this._searchList(a):this._renderList(this.listData,s.filterNodata);p.apiDelegate({regionId:c.regionId,cmd:"DescribeSecurityGroups",serviceType:"dfw",data:{}}).then(function(a){b.listData=a.data,b._requestComplete()});var d=this.hasPermItems[0].uInstanceId;p.apiDelegate({regionId:c.regionId,cmd:"DescribeSecurityGroupsOfInstance",serviceType:"dfw",data:{instanceIds:[d]}}).then(function(a){b.usgInfo=a.data.filter(function(a){return a.instanceId==d})[0].sgInfo||[],b._requestComplete()})},t.prototype._requestComplete=function(){e--,0==e&&this._renderList(this.listData,s.filterNodata)},t.prototype._searchList=function(a){var b=this.listData,c=[],d=new RegExp(a);if(b&&a)for(var e,f=0;e=b[f];f++)(d.test(e.sgId)||d.test(e.sgName))&&c.push(e);this._renderList(c,s.searchNodata,a)},t.prototype._renderList=function(a,b,c){var e=this,f=a.filter(function(a){return!e.usgInfo.some(function(b){return a.sgId==b.sgId})}),g=e.usgInfo.filter(function(b){return b._checked=!0,a.some(function(a){return b.sgId==a.sgId})});f=g.concat(f),this.searchStr=c;var h=this.hasPermItems[0];f.forEach(function(a){a.url="https://console.cloud.tencent.com/cvm/securitygroup/detail/"+a.sgId+"?rid="+h.regionId}),this.listEl.html(j.tmpl(s.list,{data:f,searchStr:c,nodataHtml:b})),this._checkBinding(),d&&d.renderSuccess()},t.prototype._getCheckedSgIds=function(){var a=this.wrapper.find('[name="rd_test"]:checked'),b=this.wrapper.find('[name="rd_test"]'),c=a.map(function(){return f(this).val()}).toArray();return this.searchStr&&(c=this.usgInfo.map(function(a){return a.sgId}),b.each(function(){var a=f(this).val(),b=c.indexOf(a),d=f(this).prop("checked");b>-1&&!d?c.splice(b,1):-1===b&&d&&c.push(a)})),c},t.prototype.sendReq=function(){var a=this,b=this.hasPermItems[0],c=a._getCheckedSgIds();q.modifyInstancesAttribute(b.regionId,{InstanceIds:[b.uInstanceId],SecurityGroups:c},{camTipsType:"dialog"}).then(function(){h.hide(),a.refreshList&&a.refreshList(!0),i.success("操作成功"),a.callback&&a.callback(),f("#dfwDetail").trigger("firewallFieldRefresh")}),g.click("SecurityGroup.cvmAttachSG")},c.exports=t}),define("cvm/cvm/event/firewall/firewall2",function(a,b,c){var d=a("cvm/cvm/event/selectedShow/selectedShow"),e=a("lib/dfw-sdk-importer"),f=a("cvm/cvm/event/operate_base"),g=a("config/reactSupport"),h=a("dialog"),i=a("reporter"),j=a("cvm/common/model"),k=a("cvm/cvm/data"),l=a("cvm/common/renderMonitor"),m=a("$"),n='\n<div>\n  <div  id="cvmFirewallList"></div>\n</div>\n<div\n  class="tc-15-msg warning"\n  id="firewall-select-tip"\n  style="margin-top: 10px;"\n>\n  <div class="tip-info">\n    每个实例至少需要加入一个安全组，\n    <a href="//console.cloud.tencent.com/vpc/securitygroup" target="_blank">\n      <span\n        >新建或查看我的安全组详情 <b class="external-link-icon"></b>。</span\n      >\n    </a>\n  </div>\n</div>',o=function(a){f.call(this,a)};o.prototype=new f,o.prototype.exec=function(){var a=this;this.initMonitor(),i.click("CVM.SetSecurityGroup.Entry"),g.useTea(function(){var b=React.__SECRET_DOM_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;e.ready().then(function(c){var e=a.hasPermItems[0],f=[];Promise.all([e.projectData?Promise.resolve(e.projectData):k.getProjects(),j.apiDelegate({regionId:e.regionId,cmd:"DescribeSecurityGroupsOfInstance",serviceType:"dfw",data:{instanceIds:[e.uInstanceId]}})]).then(function(g){e.projectData=g[0];var j=g[1].data[0].sgInfo,l=React.createElement(c.components.AssociateSgs,{getCurrentSelectSgIds:function(a){f=a,h.toggleBtnDisable(0===f.length,0)},sgs:j,projectList:e.projectData,projectId:e.projectId,showProjectSelector:!0,isShowSearchBox:!0}),o=m(n),p=o.find("#cvmFirewallList")[0];b.render(l,p),h.create(o,"800","",{title:"配置安全组",button:{"确定 ":function(){k.modifyInstancesAttribute(e.regionId,{InstanceIds:[e.uInstanceId],SecurityGroups:f},{camTipsType:"dialog"}).then(function(){h.hide(),b.unmountComponentAtNode(p),a.refreshList(!0),tips.success("操作成功"),m("#dfwDetail").trigger("firewallFieldRefresh")}),i.click("SecurityGroup.cvmAttachSG")}},defaultCancelCb:function(){b.unmountComponentAtNode(p)},preventResubmit:!0}),d.render(a.selectedShowOptions),myMonitor&&myMonitor.renderSuccess()})})})},o.prototype.initMonitor=function(){myMonitor=l.init(c.id,"kennyang"),myMonitor&&myMonitor.renderBefore()},c.exports=o}),define("cvm/cvm/event/firewall/checkPort",function(a,b,c){var d=(a("qccomponent"),a("dialog"),a("tips"),a("cvm/cvm/event/operate_base")),e=(a("cvm/cvm/event/selectedShow/selectedShow"),a("cvm/common/model"),a("router")),f=function(a){d.call(this,a)};f.prototype=new d,f.prototype.exec=function(){return e.navigate("/vpc/helper")},c.exports=f}),define("cvm/cvm/event/gridViewSelector/gridViewSelector",function(a,b,c){var d=a("$"),e=a("util"),f=a("event"),g=a("dialog"),h=a("cvm/cbs2/constants"),i=Bee.getComponent("grid-view"),j={main:'  <div class="act-outline">    <p class="text-weak mb-10">      <%= list.length %>      <%= typeToZh %>      <% if( list.length> 0){ %>，      <a href="javascript:;" data-event="s_show_detail_a" data-item=<%=wrapperElement %> > 收起        <i id=<%=iconElement %> class="blue-up-icon"></i>      </a>      <% } %>    </p>    <div id=<%=wrapperElement %> class = "mb-20"></div>  </div>'},k={cvm:"台 实例",cbs:"个 云硬盘",eip:"个 弹性公网IP"},l={cbs:[{key:"index",name:"No.",width:40},{key:"diskName",name:"云盘名称",minWidth:100},{key:"diskId",name:"云盘ID",width:130},{key:"diskUsage",name:"属性",width:130},{key:"diskType",name:"配置",width:130}],cvm:[{key:"index",name:"No.",width:40},{key:"instanceName",name:"实例名称",minWidth:100,tdTpl:"<div>{{item.instanceName || item.alias}}</div>"},{key:"instanceId",name:"实例ID",width:130,tdTpl:"<div>{{item.instanceId || item.uInstanceId}}</div>"},{key:"bandwidth",name:"当前带宽上限",width:130},{key:"instanceTypeDesc",name:"实例类型",width:130}],eip:[{key:"index",name:"No.",width:40},{key:"addressName",name:"弹性IP名称",minWidth:100},{key:"addressId",name:"弹性IP ID",width:130},{key:"addressIp",name:"IP地址",width:130},{key:"bandwidth",name:"带宽",width:130}]},m={},n={render:function(a){var b=a.renderTo.slice(1)+"-wrapper",c=a.renderTo.slice(1)+"-icon",f=a.tpl||e.tmpl(j.main,{wrapperElement:b,iconElement:c,list:a.list,typeToZh:k[a.type]||""});d(a.renderTo).html(f),a.list.length>0&&(this.createGridView(b,a.list,a.type),m[b]=c,this.bindEvt()),g.center()},setData:function(a,b){},bindEvt:function(){var a=this;f.addCommonEvent("click",{s_show_detail_a:function(b){a._toggleBox(b.target.dataset.item)}})},_toggleBox:function(a){var b=m[a],c=d("#"+a),e=d("#"+b);c.toggle(),c.is(":visible")?(e.removeClass("blue-down-icon").addClass("blue-up-icon"),d("a[data-item = '"+a+"']").text("收起")):(e.removeClass("blue-up-icon").addClass("blue-down-icon"),d("a[data-item = '"+a+"']").text("查看"))},createGridView:function(a,b,c){b.forEach(function(a,b){a.index=b+1});var e=l[c],f={$data:{showPagination:!1,showState:!1,canSelectTotal:!1,hasFirst:!1,maxHeight:150,minHeight:"auto",autoMaxHeight:!1,maxHeightOffset:10,list:b,colums:e},getCellContent:function(a,b,c){return"diskUsage"==c.key?"<div>"+h.DISK_USAGE_MAP[b.diskUsage]+"</div>":"diskType"==c.key?"<div>"+(h.DISK_TYPE_MAP[b.diskType]+" "+b.diskSize)+"G</div>":"addressName"==c.key?"<div>"+(b.addressName||"未命名")+"</div>":"bandwidth"==c.key?"<div>"+(b.bandwidth||"-")+" Mbps</div>":void 0}},g=new i(f);d("#"+a).html(g.$el)}};c.exports=n}),define("cvm/cvm/event/migrate/migrate",function(a,b,c){var d=a("cvm/cvm/event/operate_base"),e=a("qccomponent"),f=e.getComponent("grid-view"),g=a("widget/i18n"),h=a("dialog"),i=a("appUtil"),j=a("cvm/cvm/data"),k=[{name:"实例ID",key:"instanceId"},{name:"实例名称",key:"instanceName"},{name:"当前配置",key:"instanceType"},{name:"目标配置",key:"newInstanceType"},{name:"当前到期时间",key:"expiredTime"},{name:"新到期时间",key:"newExpiredTime"},{name:"费用",key:"price",width:60,tdTpl:'<div><span class="text-overflow text-warning">{{toI18nMoney(item.price, "words")}}</span></div>'}],l=f.extend(g.getBeeConfig()).extend({getData:function(a){var b=this.list.slice((a.page-1)*a.count,a.page*a.count);this.setData({list:b,page:a.page,count:a.count})}},{defaults:{hasFirst:!0,initGetData:!1,canResizeColum:!1,selectedHighlight:!0,colums:k,canSelectTotal:!1,minHeight:200,autoMaxHeight:!1,maxHeight:260,maxHeightOffset:10,autoCheckWidth:!1,showState:!0,showPagination:!0,trackKey:"instanceId",emptyTips:"当前没有可以调整的机型"}}),m=e.extend({$tpl:'  <div>    <p class="mb-10">      您的以下机型可<span class="text-warning">免费换代</span>，并<span class="text-warning">免费续期1年</span>，请选择本次您要换代的示例：    </p>    <migrate-grid b-ref="grid"></migrate-grid>    <p class="mt-20 mb-10">本次免费活动适用条件和注意事项：</p>    <div class="tc-text-list tc-text-list--wrap">      <ul>        <li>          <div class="text-cont">            <span class="text-label">1.本次回馈老客户免费升级延期活动只适用于上表中包含且为当前配置的的实例</span>          </div>        </li>        <li>          <div class="text-cont">            <span class="text-label ">2.符合上述条件情况下，腾讯云额外赠送您一年使用时长（购买三日内生效），建议您在升级前制作快照做好数据备份</span>          </div>        </li>        <li>          <div class="text-cont">            <span class="text-label">3.实例调整配置后会出现内网 IP 变化，请您提前评估自身业务情况</span>          </div>        </li>        <li>          <div class="text-cont">            <span              class="text-label">4.调整配置需在关机状态下操作，您可以主动关机后进行调整配置或者选择强制关机。强制关机可能会导致数据丢失或文件系统损坏，同时可能需要您等待较长时间，请耐心等待</span>          </div>        </li>        <li>          <div class="text-cont">            <span class="text-label">5.如您在升级过程中遇到问题，请您提工单与我们联系，我们尽快为您处理</span>          </div>        </li>      </ul>    </div>    <p class="mt-20">      <label class="form-ctrl-label"><input b-model="agreeForceStop" type="checkbox"          class="tc-15-checkbox">同意强制关机</label>    </p>    <div class="tc-15-rich-dialog-ft">      <div class="tc-15-rich-dialog-ft-btn-wrap">        <button class="tc-15-btn {{!agreeForceStop?\'disabled\': \'\'}}" b-on="{click: confirm}">开始升级</button>        <button class="tc-15-btn weak" b-on-click="cancel()">取消</button>      </div>    </div>  </div>',$afterInit:function(){var a=this;this.grid=this.$refs.grid,j.queryPreferentialInstance().then(function(b){var c=b.region,d=b.instances,e=b.totalCount,f=d.map(function(a){
return a.instanceId});a.$set({region:c}),j.queryCvmList2({regionId:c.regionId,filters:[{Name:"instance-id",Values:f}]},{withoutDefaultFilter:!0}).then(function(b){var c=b.response.instanceSet||[];d=d.map(function(a){var b=c.find(function(b){return b.instanceId===a.instanceId});if(!b)return a;var d,e;return b.expiredTime&&(d=new Date(b.expiredTime),e=new Date(d),e.setFullYear(d.getFullYear()+1)),Object.assign(a,{instanceName:b.instanceName,instanceType:b.instanceType,expiredTime:d?i.formatDate(d,"yyyy-MM-dd hh:mm:ss"):"-",newExpiredTime:e?i.formatDate(e,"yyyy-MM-dd hh:mm:ss"):"-",price:0})}),a.grid.setData({list:d,totalNum:e})})["catch"](function(){a.grid.setData({list:d,totalNum:e})})})["catch"](function(){a.grid.setData({list:[],totalNum:0})})},confirm:function(){var a=this.grid.getSelected();if(this.agreeForceStop&&a&&a.length){var b=new n({$data:{region:this.region,instances:a}});h.create(b.$el,650,"",{struct:"rich",title:"机型升级换代",isMaskClickHide:!1,defaultCancelCb:function(){b.$set("stop",!0)},button:{" 完成 ":function(){b.$set("stop",!0),h.hide()}}})}},cancel:function(){this.$destroy(),h.hide()}},{defaults:{region:null,agreeForceStop:!1}});m.tag("migrate-grid",l);var n=e.extend({$tpl:'  <div class="tc-15-rich-dialog-bd">    <div class="tc-15-msg">      <div class="tip-info">        <p>批量调整配置将通过API方式自动逐条扣费。</p>        <p class="text-warning">调整过程中请不要关闭窗口，关闭窗口将中断操作</p>      </div>    </div>    <div class="tag-popup">      <div class="tc-15-progress ">        <div class="tc-15-progress-value" style="width:{{            (migratingInstances.length / instances.length) * 100 +              \'%\'          }}">          <span            b-if="currentInstance && instances.length > successNumber + failNumber">正在调整：{{ currentInstance.instanceId }}</span>          <span class="text-right">{{ migratingInstances.length }}/{{              instances.length            }}</span>        </div>      </div>      <div class="pt-20 ">        <p class="">          调整{{ instances.length }}个实例，<span class="text-success">已成功{{ successNumber }}个</span>，<span            class="text-danger">失败{{ failNumber }}个</span>，等待{{            instances.length - successNumber - failNumber          }}个，          <a href="javascript:;" b-on-click="toggle()">            <span>{{ showDetail ? \'收起\' : \'展开\' }}</span>            <i class="{{ showDetail? \'blue-up-icon\':  \'blue-down-icon\' }}"></i>          </a>        </p>      </div>      <div b-if="showDetail" class="tag-modify">        <ul>          <li b-repeat="item in migratingInstances" class="{{ item.error ? \'text-danger\' : \'\'}}">            <span>{{ item.migrateAt }}</span>            <span>调整：{{ item.instanceId }}</span>            <span>配置到：{{ item.newInstanceType }}</span>            <span>{{ !item.error ? "成功！": "失败！" }}</span>            <span b-if="item.error">{{              item.error.message            }}</span>          </li>        </ul>      </div>    </div>  </div>',$afterInit:function(){this.start()},start:function(){var a=this,b=this.instances||[];b.reduce(function(b,c){return b.then(function(){return a.stop?Promise.reject():a.migrate(c)})},Promise.resolve())},migrate:function(a){var b=this,c=this.region;return this.$set({currentInstance:a}),j.migrateInstances(c.regionId,{instanceIds:[a.instanceId],instanceType:a.newInstanceType}).then(function(){var c=Object.assign(a,{migrateAt:i.formatDate(new Date,"yyyy-MM-dd hh:mm:ss")});b.$set({migratingInstances:b.migratingInstances.concat(c),successNumber:++b.successNumber})})["catch"](function(c){var d=Object.assign(a,{migrateAt:i.formatDate(new Date,"yyyy-MM-dd hh:mm:ss"),error:{message:c.message}});b.$set({migratingInstances:b.migratingInstances.concat(d),failNumber:++b.failNumber})})},toggle:function(){this.$set({showDetail:!this.showDetail})}},{defaults:{region:null,instances:[],migratingInstances:[],showDetail:!0,currentInstance:null,successNumber:0,failNumber:0,stop:!1}}),o=function(a){d.call(this,a)};o.prototype=new d,o.prototype.exec=function(){var a=this;this.migrateBee=new m,h.create(this.migrateBee.$el,1e3,"",{isMaskClickHide:!1,struct:"rich",title:"机型升级换代",defaultCancelCb:function(){a.migrateBee.$destroy()}})},c.exports=o}),define("cvm/cvm/event/modifyChargeType/modifyChargeType",function(a,b,c){var d=a("dialog"),e=(a("util"),a("appUtil")),f=a("cvm/cvm/cvmutil"),g=(a("cvm/cvm/event/operate_base"),a("cvm/cvm/event/renew/renew_base")),h=a("cvm/cvm/event/selectedShow/selectedShow"),i=a("cvm/common/components/TimePill/timePill"),j=a("cvm/common/model"),k=a("cvm/common/constants"),l=a("models/iaas"),m={main:'  <div class="cvm-renew-dialog">    <div class="tip_box">      <p>按量计费转换包年包月后，包年包月的实例无法转换回按量计费的实例。</p>      <p>按量计费转换包年包月功能只支持转换实例和硬盘的计费模式，转换后带宽付费模式不变。</p>      <p>显示的时长折扣只代表当前所有实例里的最高折扣。</p>    </div>    <div class="param-box">      <div class="param-bd">        <ul class="form-list">          <li>            <div class="form-label">              <label for="">续费时长</label>            </div>            <div class="form-input">              <div id="modifyChargeType-period"></div>            </div>          </li>          <li>            <div class="form-label">              <label for="">自动续费</label>            </div>            <div class="form-input">              <label class="form-ctrl-label">                <input type="checkbox" class="tc-15-checkbox" b-model="isAutoRenew">账户余额足够时，设备到期后按月自动续费</label>            </div>          </li>          <li>            <div class="form-label">              <label for="">存储</label>            </div>            <div class="form-input">              <label class="">同时转为包年包月                <i class="plaint-icon" data-title="实例的系统盘和数据盘将随实例一起转为包年包月计费模式"></i>              </label>            </div>          </li>          <li>            <div class="form-label">              <label for="">费用</label>            </div>            <div class="form-input">              <div class="cost-col">                <span b-if="finalPriceDesc" class="cost">                  <strong>{{finalPriceDesc}}</strong>                </span>                <span b-if="originalPriceDesc" style="font-size: 1.2em;">                  <span style="text-decoration: line-through; margin: 0 5px">{{originalPriceDesc}}</span>                </span>              </div>            </div>          </li>        </ul>        <div>          <label class="form-ctrl-label">            <input type="checkbox" b-model="agreeModifyRule" class="tc-15-checkbox">已阅读并同意            <a href="https://cloud.tencent.com/document/product/213/2762" target="_blank">按量计费转包年包月规则              <i class="external-link-icon"></i>            </a>          </label>          <p class="text-danger">            <span b-if="quotaNotEnoughZoneArray.length == 1 && selectedInstanceZoneNum == 1">您在{{quotaNotEnoughZoneArray[0].zoneName}}              {{month}}              月包年包月配额为{{quotaNotEnoughZoneArray[0].quotaLimit}}台，已购买{{quotaNotEnoughZoneArray[0].quotaCurrent}}台。本次转换{{quotaNotEnoughZoneArray[0].selectedItemNum}}台，由于包月配额不足不支持转换。</span>            <span b-if="quotaNotEnoughZoneArray.length == 1 && selectedInstanceZoneNum > 1">您的{{quotaNotEnoughZoneArray[0].zoneName}}              {{month}} 月包月配额不足，不支持转换。</span>            <span b-if="quotaNotEnoughZoneArray.length > 1 && selectedInstanceZoneNum > 1">您的              <span b-repeat="item in quotaNotEnoughZoneArray">{{item.zoneName}}                <i b-if="$index != quotaNotEnoughZoneArray.length -1">，</i>              </span>包月配额不足,不支持转换。</span>            <a b-if="quotaNotEnoughZoneArray.length > 0" href="https://console.cloud.tencent.com/workorder/category/create?level1_id=6&amp;level2_id=7&amp;source=0"              target="_blank">提升配额              <i class="external-link-icon"></i>            </a>          </p>        </div>      </div>    </div>  </div>',config:'  <div class="cvm-renew-config-table">    <div class="act-summary" style="margin-bottom:10px">      您已选      <strong>{{selectedItems.length}}台实例</strong>，      <a href="javascript:;" data-event="s_show_detail">查看详情        <i id="selectedShowIconArr" class="blue-down-icon"></i>      </a>    </div>    <div class="tc-15-table-panel" id="selectedShowDetail" style="margin-bottom:10px;">      <div class="tc-15-table-fixed-head">        <table class="tc-15-table-box">          <colgroup>            <col style="width: 24%;">            <col style="width: 40%;">            <col style="width: 18%;">            <col style="width: 18%;">          </colgroup>          <thead>            <tr>              <th>                <div>                  <span class="text-overflow">实例</span>                </div>                <i class="resize-line-icon"></i>              </th>              <th>                <div>                  <span class="text-overflow">配置</span>                </div>                <i class="resize-line-icon"></i>              </th>              <th>                <div>                  <span class="text-overflow">转换后到期时间</span>                </div>              </th>              <th>                <div>                  <span>折扣                    <div class="tc-15-bubble-icon">                      <i class="tc-icon icon-help"></i>                      <div class="tc-15-bubble tc-15-bubble-left">                        <div class="tc-15-bubble-inner" style="padding: 4px">                          <a target="_blank" href="//cloud.tencent.com/document/product/213/2176">折扣详情</a>                        </div>                      </div>                    </div>                  </span>                </div>              </th>            </tr>          </thead>        </table>      </div>      <div class="tc-15-table-fixed-body" style="max-height: 200px">        <table class="tc-15-table-box tc-15-table-rowhover">          <colgroup>            <col style="width: 24%;">            <col style="width: 40%;">            <col style="width: 18%;">            <col style="width: 18%;">          </colgroup>          <tbody>            <tr b-repeat="selectedItem in selectedItems">              <td>                <div class="text-overflow">                  <p>实例名称：{{selectedItem.alias}}</p>                  <p>所属网络：{{selectedItem.netName}}</p>                  <p>内网IP：{{selectedItem.deviceLanIp}}</p>                  <p>可用区：{{selectedItem.zoneName}}</p>                </div>              </td>              <td>                <div class="text-overflow">                  <p>规格：{{selectedItem.instanceTypeDesc}}，{{selectedItem.cpuInfo}}CPU，{{selectedItem.memInfo}}内存</p>                  <p>系统盘：{{selectedItem.systemDisk.diskSize}}GB (                    <a b-if="selectedItem.systemDisk.diskId" href="/cvm/cbs/detail?storageId={{selectedItem.systemDisk.diskId}}&rid={{selectedItem.regionId}}"                      target="_blank">{{selectedItem.systemDisk.diskId}}</a>                    <span b-if="!selectedItem.systemDisk.diskId">{{selectedItem.systemDisk.diskTypeName}}</span>)                  </p>                  <p b-repeat="cbsItem in selectedItem.dataDisks">数据盘：                    <span>{{cbsItem.diskSize}}GB (                      <a b-if="cbsItem.diskId" href="/cvm/cbs/detail?storageId={{cbsItem.diskId}}&rid={{selectedItem.regionId}}"                        target="_blank">{{cbsItem.diskId}}</a>                      <span b-if="!cbsItem.diskId">{{cbsItem.diskTypeName}}</span>)                    </span>                  </p>                  <p>带宽：{{selectedItem.bandwidthInfo}}({{selectedItem.networkPayModeDesc}})</p>                </div>              </td>              <td>                <div class="">                  <span class="text-overflow text-warning">{{newExpiredTime}}</span>                </div>              </td>              <td>                <div>                  <span b-if="selectedItem.discountInfo" class="text-overflow text-danger">{{selectedItem.discountInfo}}</span>                  <span b-if="!selectedItem.discountInfo" class="text-overflow">无</span>                </div>              </td>            </tr>          </tbody>        </table>      </div>    </div>  </div>'},n=function(a){g.call(this,a)};n.prototype=new g,n.prototype.exec=function(){var a=this,b=this.hasPermItems,c=[],g={};b.forEach(function(a,b){c.push(a.uInstanceId),g[a.zone]?g[a.zone].selectedItemNum++:g[a.zone]={selectedItemNum:1,zoneName:k.ZONEIDV3TONAMEMAP[a.zone]}}),a.instanceIds=c,j.apiRequest({serviceType:"cvm",action:"DescribeUserInstanceQuota",data:{filters:[{name:"instance-charge-type",values:["PREPAID"]},{name:"zone",values:Object.keys(g)}]},regionId:a.hasPermItems[0].regionId||e.getRegionId()}).then(function(c){var e=a.formatInstanceZoneQuota(c,g),j=new Bee({$tpl:m.config,$data:{selectedItems:b,newExpiredTime:"-"}}),k=new Bee({$tpl:m.main,$data:{selectedInstanceZoneNum:e.selectedInstanceZoneNum,quotaNotEnoughZoneArray:e.quotaNotEnoughZoneArray,isQuotaNotEnough:e.quotaNotEnoughZoneArray.length>0,month:(new Date).getMonth()+1},$afterInit:function(){var a=this;this.$watch("agreeModifyRule",function(b){var c=a.$get("isQuotaNotEnough");c||!b?d.toggleBtnDisable(!0):d.toggleBtnDisable(!1)}),this.$watch("isQuotaNotEnough",function(a){d.toggleBtnDisable(a)})}});a.selectedShowBee=j,a.modifyChargeTypeBee=k,d.create(k.$el,"730","",{title:"按量计费转包年包月",preventResubmit:!0,buttonDisable:[1],button:{" 立即转换 ":function(){a.collectData().then(function(b){b&&a.toPay2(b)})}}}),h.render({tpl:j.$el,hasPermItems:b});var l=(b||[]).map(function(a){return a.instanceFamily});a.timePill=new i({renderTo:$("#modifyChargeType-period"),showDiscountIcon:!1,defaultTriggerChange:!0,change:function(c){var d=a.getExpires(new Date,parseInt(c));a.setPrice(c);var e=b.map(function(a){return Object.assign({},a,{discountInfo:f.getInstanceDiscount(a.regionId,a.instanceFamily,c)})});a.selectedShowBee.$set({selectedItems:e,newExpiredTime:d})},discountHandler:function(a,c){return c.call(this,{list:a,regionId:b[0].regionId,instanceFamilies:l})}}),d&&d.center()})["catch"](function(a){console.warn(a)})},n.prototype.formatInstanceZoneQuota=function(a,b){var c=a.response&&a.response.userInstanceQuotaSet&&a.response.userInstanceQuotaSet||[];c.forEach(function(a,c){var d=b[a.zone];d.quotaCurrent=a.quotaCurrent,d.quotaLimit=a.quotaLimit,d.isQuotaNotEnough=a.quotaCurrent+d.selectedItemNum>a.quotaLimit});var d=[];for(var e in b){var f=b[e];f.isQuotaNotEnough&&d.push(f)}return{quotaNotEnoughZoneArray:d,selectedInstanceZoneNum:Object.keys(b).length}},n.prototype.setPrice=function(a){var b=this;b.modifyChargeTypeBee.$set("originalPriceDesc",!1),j.apiRequest({serviceType:"cvm",action:"InquiryPriceModifyInstancesChargeType",data:{instanceIds:b.instanceIds,instanceChargeType:"PREPAID",instanceChargePrepaid:{period:a},modifyPortableDataDisk:!0},regionId:b.hasPermItems[0].regionId||e.getRegionId()},{camTipsType:"dialog"}).then(function(c){var d=c.response&&c.response.price,e="",f="",g=b.timePill.val();if(d&&d.instancePrice){if(g==a){var h=d.instancePrice.originalPrice,i=d.instancePrice.discountPrice;e=i+"元",h>i&&(f=h+"元")}}else e="查询失败";b.modifyChargeTypeBee.$set("finalPriceDesc",e),b.modifyChargeTypeBee.$set("originalPriceDesc",f)},function(a){b.modifyChargeTypeBee.$set("finalPriceDesc","查询失败")})["catch"](function(a){console.warn(a)})},n.prototype.collectData=function(){var a=this,b=a.timePill.val(),c=a.modifyChargeTypeBee.$get("isAutoRenew")?"NOTIFY_AND_AUTO_RENEW":"NOTIFY_AND_MANUAL_RENEW";return l.apiRequest({serviceType:"cvm",action:"SwitchParameterModifyInstancesChargeType",data:{Version:"2017-03-12",instanceIds:a.instanceIds,instanceChargeType:"PREPAID",instanceChargePrepaid:{period:b,renewFlag:c},modifyPortableDataDisk:!0},regionId:a.hasPermItems[0].regionId||e.getRegionId()},{camTipsType:"dialog"}).then(function(a){var b=a.Response&&a.Response.InstanceOrder;return b&&b.goods&&b.goods.length?b.goods:void 0})["catch"](function(a){console.warn(a)})},c.exports=n}),define("cvm/cvm/event/modifyVpcAttribute/modifyVpcAttribute",function(a,b,c){var d,e,f=a("$"),g=a("cvm/cvm/event/operate_base"),h=a("dialog"),i=a("cvm/common/renderMonitor"),j=a("widget/mfa/mfa"),k=a("qccomponent"),l=k.getComponent("grid-view"),m=(a("tips"),a("cvm/common/components/SubnetSelector")),n=a("widget/baseInfo/validator"),o=a("cvm/common/model"),p=a("appUtil"),q=a("cvm/cvm/cvmutil"),r={main:'  <div class="cvm-ip-dialog">    <div class="tc-15-step col2 mb-20">      <ol>        <li b-class="currStep===1 ? \'current\': \'\'">          <div class="tc-15-step-name">            <span class="tc-15-step-num">1</span>迁移准备          </div>          <div class="tc-15-step-arrow"></div>        </li>        <li b-class="currStep===2 ? \'current\': currStep=== 3 ? \'\': \'disabled\'">          <div class="tc-15-step-name">            <span class="tc-15-step-num">2</span>选择网络          </div>          <div class="tc-15-step-arrow"></div>        </li>        <li b-class="currStep===3 ? \'current\': \'disabled\'">          <div class="tc-15-step-name">            <span class="tc-15-step-num">3</span>设置IP          </div>          <div class="tc-15-step-arrow"></div>        </li>        <li b-class="currStep===4 ? \'current\': \'disabled\'">          <div class="tc-15-step-name">            <span class="tc-15-step-num">4</span>关机提醒          </div>          <div class="tc-15-step-arrow"></div>        </li>      </ol>    </div>    <div b-if="currStep == 1">      <p class="text-weak mb-10">        您已选择{{ selectedItems.length }}台实例，        <span          b-if="supportedItems.length &&  supportedItems.length != selectedItems.length"          >其中{{            selectedItems.length - supportedItems.length          }}台不支持切换VPC，请先进行配置升级。</span        >        <a href="#" b-on-click="toggleShowList()"          >查看详情          <i b-class="expandList ? \'blue-up-icon\': \'blue-down-icon\'"></i>        </a>      </p>      <div id="insInfo" b-if="expandList" class="mb-20"></div>      <div class="param-box">        <div class="param-hd"><h3>迁移开始前，请注意：</h3></div>        <div class="param-bd">          <p>            1.迁移前，请自行解绑内外网LB以及弹性网卡，并释放主网卡的辅助IP，迁移后再进行绑定          </p>          <p>2.迁移过程中，实例需要进行重启，请勿进行其他操作</p>          <p>3.迁移后，请注意检查实例运行状态，内网访问以及远程登录是否正常</p>          <p>            4.基础网络切换VPC后不可逆，CVM切换至VPC后与其他基础网络的云服务不互通          </p>        </div>      </div>    </div>    <div b-if="currStep == 2">      <ul class="form-list mb-10">        <li class="">          <div class="form-label "><label for="">私有网络</label></div>          <div class="form-input" id="vpcListSelector">            <div class="tc-15-select-wrap m">              <select class="tc-15-select" b-model="selectVpcId">                <option                  b-repeat="item in vpcSet"                  value="{{ item.vpcId }}"                  selected?="item.vpcId == selectVpcId"                  disabled?="item.disabled"                  title="{{ item.disabledTitle }}"                  >{{ item.label }}</option                >              </select>            </div>          </div>        </li>      </ul>      <div id="vpcSearch" class="search-input-wrap"></div>      <div class="cvm-ip-dialog">        <div class="tc-15-option-hd">          <p class="text-label">请选择 {{ zoneName }} 的子网</p>        </div>      </div>      <div id="subNetIpList" class="mb-20"></div>      <subnet-selector b-ref="subnetSelector"></subnet-selector>    </div>    <div b-if="currStep == 3">      <ul class="form-list mb-10">        <li class="pure-text-row">          <div class="form-label ">            <label for="">迁移到私有网络</label>          </div>          <div class="form-input">            <div class="form-unit">              <p class="form-text">                <span b-if="selectedVpc"                  >{{ selectedVpc.vpcName }}(<a                    data-event="nav"                    href="/vpc/vpc?unVpcId={{ selectedVpc.vpcId }}"                    >{{ selectedVpc.vpcId }}</a                  >                  | {{ selectedVpc.cidrBlock }})</span                >              </p>            </div>          </div>        </li>        <li class="pure-text-row">          <div class="form-label ">            <label for="">所在子网</label>          </div>          <div class="form-input">            <div class="form-unit">              <p class="form-text">                <span b-if="selectedSubnet"                  >{{ selectedSubnet.subnetName }}(<a                    data-event="nav"                    href="/vpc/subnet?subnetId={{ selectedSubnet.subnetId }}"                    >{{ selectedSubnet.subnetId }}</a                  >                  | {{ selectedSubnet.cidrBlock }})</span                >              </p>            </div>          </div>        </li>      </ul>      <p class="mb-10">实例IP地址</p>      <div class="tc-15-table-panel">        <div class="tc-15-table-fixed-head">          <table class="tc-15-table-box">            <colgroup>              <col />              <col />              <col />            </colgroup>            <thead>              <tr>                <th>                  <div><span class="text-overflow">实例名</span></div>                </th>                <th>                  <div><span class="text-overflow">实例ID</span></div>                </th>                <th>                  <div><span class="text-overflow">预分配IP地址</span></div>                </th>              </tr>            </thead>          </table>        </div>        <div class="tc-15-table-fixed-body" style="max-height: 220px">          <table class="tc-15-table-box tc-15-table-rowhover">            <colgroup>              <col />              <col />              <col />            </colgroup>            <tbody>              <tr b-repeat="supportedItem in supportedItems">                <td>                  <div>                    <span class="text-overflow">{{                      supportedItem.instanceName                    }}</span>                  </div>                </td>                <td>                  <div>                    <span class="text-overflow">{{                      supportedItem.instanceId                    }}</span>                  </div>                </td>                <td>                  <div class="form-unit">                    <input                      data-validate="privateIp"                      b-model="supportedItem.privateIp"                      b-on-blur="validatePrivateIp()"                      placeholder="不填将自动分配"                      type="text"                      class="tc-15-input-text "                    />                  </div>                </td>              </tr>            </tbody>          </table>        </div>      </div>      <p class="mt-20">HostName选项</p>      <p class="text-weak">        您可以选择切换私有网络的同时重置实例HostName，也可以选择保留实例原有HostName      </p>      <div class="mt-10">        <p>          <label class="form-ctrl-label"            ><input              type="radio"              value="Reset"              b-model="saveHostName"              name="HostName"              class="tc-15-radio"            />重置HostName</label          >        </p>        <p>          <label class="form-ctrl-label"            ><input              type="radio"              value="Reserve"              b-model="saveHostName"              name="HostName"              class="tc-15-radio"            />保留实例原HostName</label          >        </p>      </div>    </div>    <div b-if="currStep == 4">      <div b-if="!isAllStopped">        <div class="tc-15-msg msg-dot mt-20">          <div class="tip-info">            <p>切换私有网络需要在关机状态下操作：</p>            <div class="num-item">              <p>                <span class="num">1</span                >为了避免数据丢失，云服务器将关机中断您的业务。请仔细确认              </p>            </div>            <div class="num-item">              <p>                <span class="num">2</span                >强制关机可能会导致数据丢失或文件系统损坏。您也可以主动关机后进行调整配置              </p>            </div>            <div class="num-item">              <p>                <span class="num">3</span                >强制关机可能需要您等待较长时间，请耐心等待              </p>            </div>          </div>        </div>        <p class="mt-10">          <label class="form-ctrl-label"            ><input              type="checkbox"              b-model="shutdownConfirm"              class="tc-15-checkbox"            />同意强制关机</label          >        </p>      </div>      <div b-if="isAllStopped">        <div class="param-box">          <div class="param-hd">            <h3>              切换私有网络需要在关机状态下操作，目前所选实例已处于关机状态            </h3>          </div>        </div>      </div>    </div>    <div class="tc-15-rich-dialog-ft">      <div class="tc-15-rich-dialog-ft-btn-wrap">        <button          class="tc-15-btn weak"          b-if="currStep != 1"          b-on-click="juptToStep(currStep-1)"        >          上一步        </button>        <button          class="tc-15-btn disabled"          b-if="currStep == 2 && !selectedSubnet || currStep == 3 && !saveHostName"        >          下一步        </button>        <button          class="tc-15-btn"          b-if="currStep == 1 || (currStep == 2 && selectedSubnet) || (currStep == 3 && !!saveHostName)"          b-on-click="juptToStep(currStep+1)"        >          下一步        </button>        <button          class="tc-15-btn "          b-if="currStep == 4 && (shutdownConfirm || isAllStopped)"          b-on-click="modifyVpc()"        >          开始迁移        </button>        <button          class="tc-15-btn disabled"          b-if="currStep == 4 && (!shutdownConfirm && !isAllStopped)"        >          开始迁移        </button>      </div>    </div>  </div>'},s=k.extend({$tpl:r.main,toI18nMoney:a("widget/i18n").toI18nMoney,$afterInit:function(){this.$watch("selectVpcId",function(a){this.$set({selectedVpc:this.vpcSet.find(function(b){return b.vpcId==a}),selectedSubnet:null}),this.fetchSubNet({vpcId:a,regionId:this.regionId,zone:this.zone})})},validatePrivateIp:function(){var a=this.selectedSubnet,b=new n({errClass:"is-error",rules:{privateIp:function(b){if(b){if(!p.isValidIp(b))return"请输入合法的IP";if(a&&!p.isCIDRIntersect(a.cidrBlock,b))return"IP地址应在子网网段内"}}}});b.btn=this.$el;for(var c=!0,d=f(this.$el).find("[data-validate]"),e=0;e<d.length;e++){var g=d[e];if(!b.validate(g,{noTips:!0})){g.focus&&g.focus(),g.scrollIntoView(!1),b.validate(g,{trigger:"click",position:"left"}),c=!1;break}}return c},juptToStep:function(a){this.$set("currStep",a),2==a&&this.renderStep2()},modifyVpc:function(){var a=this.regionId,b=this.supportedItems,c=this.selectVpcId,d=this.selectedSubnet,e=this.saveHostName;return d&&this.validatePrivateIp()?void t.sendModifyVpc({regionId:a,InstanceIds:b.map(function(a){return a.instanceId}),VpcId:c,SubnetId:d.subnetId,PrivateIpAddresses:b.map(function(a){return a.privateIp}),ReserveHostName:Boolean(e&&"Reserve"==e)}):void h.toggleBtnDisable(!1)},fetchVpc:function(){return o.apiRequest({regionId:this.regionId,serviceType:"vpc",action:"DescribeVpcs",data:{offset:0,limit:100}},{camTipsType:"dialog"})},fetchSubNet:function(a){this.subnetSelector.$set({list:[],param:a}),this.subnetSelector.pullData()},sortByAccount:function(a){return a.sort(function(a,b){return a.availableIpAddressCount<b.availableIpAddressCount})},renderStep2:function(){var a=this;this.$set("subnetSelector",this.$refs.subnetSelector),this.$refs.subnetSelector.$watch("$checked",function(b){a.$set("selectedSubnet",a.subnetSelector.list.find(function(a){return a.subnetId==b}))}),this.fetchVpc().then(function(b){var c=a.isBMType,d=b&&b.response&&b.response.vpcSet,e=[];a.$set("vpcSet",e),d?(d.forEach(function(a){var b=c&&!a.enableDhcp,d=b&&c?"黑石物理服务器2.0仅支持DHCP私有网络":void 0;e.push({vpcId:a.vpcId,cidrBlock:a.cidrBlock,label:a.vpcName+"("+a.vpcId+"|"+a.cidrBlock+")",vpcName:a.vpcName||"未命名",disabled:b,disabledTitle:d})}),e=e.sort(function(a,b){return a.disabled&&!b.disabled?1:!a.disabled&&b.disabled?-1:a.disabled&&b.disabled?0:void 0}),!a.selectVpcId&&a.$set("selectVpcId",e[0].vpcId)):e=[{id:-1,label:"选择私有网络"}]})},toggleShowList:function(){this.$set("expandList",!this.$get("expandList"))}},{defaults:{expandList:!0,step:1}});s.tag("subnet-selector",m.extend({param:{},crrsubnetId:"",$checked:""},{defaults:{searchPlaceholder:"搜索子网名称/说明",colums:[{key:"subnetName",name:"名称",minWidth:100},{key:"subnetId",name:"ID",width:130},{key:"cidrBlock",name:"CIDR",width:130},{key:"availableIpAddressCount",name:"数量",width:100}]}}));var t=function(a){g.call(this,a)};t.prototype=new g,t.sendModifyVpc=function(a){var b=a.regionId,c=a.InstanceIds,e=a.VpcId,f=a.SubnetId,g=a.PrivateIpAddresses,i=a.ReserveHostName,j=d.cloudAPIActionNameMap.cvm&&d.cloudAPIActionNameMap.cvm.ModifyInstancesVpcAttribute||"迁移中";o.apiRequest({regionId:b,serviceType:"cvm",action:"ModifyInstancesVpcAttribute",data:{InstanceIds:c,VirtualPrivateCloud:{VpcId:e,SubnetId:f,PrivateIpAddresses:g},ReserveHostName:i}},{camTipsType:"dialog"}).then(function(a){h.hide(),d.checkTask({},j),d.callback&&d.callback()})},t.prototype.exec=function(){var a=this;d=this,j.verify({api:"cvm:ModifyInstancesVpcAttribute"}).then(function(){e=i.init(c.id,"kennyang"),e&&e.renderBefore();var b=a.selectedItems.map(function(a){return Object.assign({},a,{privateIp:""})});a.hasPermItems=b.filter(function(a){return-1!=a.innerVpcId&&"SHUTDOWN"!=a.instanceState});var d=b[0]&&b[0].regionId||p.getRegionId(),g=[],j=[],k=!1;b.forEach(function(a,b){var c=-1!=a.innerVpcId&&"SHUTDOWN"!=a.instanceState;c&&g.push(Object.assign({},a)),q.isBareMetalType(a.instanceFamily)&&(k=!0),j.push({alias:a.alias,instanceId:a.instanceId,zoneName:a.zoneName,vpc:a.vpc,isSupported:c,statusTitle:a.statusTitle,instanceState:a.instanceState})});var m=b.every(function(a){return"STOPPED"===a.instanceState}),n=new s({$data:{isBMType:k,selectedItems:b,currStep:1,regionId:d,zone:b[0].zone,supportedItems:g,zoneName:b[0].zoneName,isAllStopped:m,shutdownConfirm:!1}});h.create(n.$el,"800","",{title:"切换私有网络",preventResubmit:!0,hideIcon:!0,defaultCancelBtn:!1,onload:function(){e&&e.renderSuccess()}});var o={$data:{showPagination:!1,showState:!1,canSelectTotal:!1,hasFirst:!1,maxHeight:150,minHeight:"auto",autoMaxHeight:!1,maxHeightOffset:10,list:j,colums:[{key:"alias",name:"实例名",minWidth:100},{key:"instanceId",name:"实例ID",width:130},{key:"zoneName",name:"可用区",width:130},{key:"network",name:"所属网络",width:130},{key:"statusTitle",name:"运行状态",width:100},{key:"isSupported",name:"是否支持切换"}]},getCellContent:function(a,b,c){return"network"==c.key?"<div>"+b.vpc&&b.vpc.unVpcId||"基础网络</div>":"isSupported"==c.key?"<div>"+(b.isSupported?"支持":"不支持")+"</div>":"statusTitle"==c.key?"STOPPED"===b.instanceState?"<div>"+b.statusTitle+"</div>":'<div class="text-danger">'+b.statusTitle+"</div>":void 0},setTrAttr:function(a,b){return b.isSupported||(a={"data-title":-1==b.innerVpcId?"该实例不支持切换VPC，请先进行配置升级":"当前状态不可进行该操作"}),a}};a.gridView=new l(o),f("#insInfo").append(a.gridView.$el),h.center()})},c.exports=t}),define("cvm/cvm/event/monitor",function(a,b,c){function d(a,b){if(!e.getSelectedText()&&(!a.$loading||a.deviceLanIp)&&"SHUTDOWN"!=a.instanceState){f.click("yunzhuji.line");var c=b,d=c.cvmListEl,h=d.find('tr[data-uinstanceid="'+a.uInstanceId+'"]').attr("data-index"),i=function(a){var b=$("#cvmList"),c=b.find('tr[data-uinstanceid="'+a+'"]');c.length&&(b.find("input:checkbox").removeProp("checked"),c.find("input:checkbox").prop("checked","true"))},j=[],k=0,l=0;c.gridView.list.forEach(function(a,b){var c=d.find('tr[data-index="'+b+'"]');c.length&&(c.data("monitor-index",k),j.push(a),b==h&&(l=k),k++)}),g.showList(j,l,i)}}var e=a("appUtil"),f=a("reporter"),g=a("cvm/detail/monitor");a("panel"),a("router");return{init:d}}),define("cvm/cvm/event/operate_auth",function(a,b,c){var d=a("cvm/common/constants"),e=a("cvm/cvm/cvmutil"),f=a("cvm/cbs2/cbsutil"),g=function(a){this.options=a,this.listIns=a.listIns,this.checkOpsAvailable()};g.prototype={checkOpsAvailable:function(){this.auth={},this.feature={},this.allFeature={},this.multiTypeCvm={hourCvm:!1,cdhCvm:!1,spotCvm:!1,prepaidCvm:!1,hasWaitToRecycle:!1,allWaitToRecycle:!0};for(var a,b=this.options.dataItems,c=0;a=b[c];c++){
var d=a.opsAvailable;if(!d)return;e.isPrepaidPayMode(a.instanceChargeType)&&(this.feature.BATCHRETURN=!0),d.DELETE&&(this.auth.DELETE=!0),d.REBOOT&&(this.auth.REBOOT=!0),d.BOOT&&(this.auth.BOOT=!0),d.SHUTDOWN&&(this.auth.SHUTDOWN=!0),d.RESETPW&&(this.auth.RESETPW=!0),d.FORMAT&&(this.auth.FORMAT=!0),d.RENAME&&(this.auth.RENAME=!0),d.CREATEIMG&&(this.auth.CREATEIMG=!0),d.SETBANDWIDTH&&(this.auth.SETBANDWIDTH=!0),d.RESETOS&&(this.auth.RESETOS=!0),d.SNAPSHOT&&(this.auth.SNAPSHOT=!0),d.UPGRADEBANDWIDTH&&(this.auth.UPGRADEBANDWIDTH=!0),d.RENEW&&(this.auth.RENEW=!0),d.SETAUTORENEW&&(this.auth.SETAUTORENEW=!0),d.UPGRADECONFIG&&(this.auth.UPGRADECONFIG=!0),d.UPGRADEDISKCONFIG&&(this.auth.UPGRADEDISKCONFIG=!0),d.DELIVERKEY&&(this.auth.DELIVERKEY=!0),d.CONNECTVNC&&(this.auth.CONNECTVNC=!0),d.XENTOKVM&&(this.auth.XENTOKVM=!0),"linux"!==a.osType?this.feature.WINDOWS=!0:this.allFeature.WINDOWS=!1,a.dataDisks=a.dataDisks||[],a.cbsList=a.cbsList||[],a.dataDisks.length||a.cbsList.length?this.allFeature.NOSPACE=!1:this.feature.NOSPACE=!0,a.unVpcId?this.feature.VPC=!0:this.allFeature.VPC=!1,e.isShoutdownStatus(a.instanceState)?this.feature.ISOLATION=!0:this.allFeature.ISOLATION=!1;var f=a.runflag,g=[1,5,6,19,21,23,24,25,28];g.indexOf(f)<0&&(this.auth.FIREWALL=!0),-1==a.runflag?this.feature.CREATE_FAIL=!0:this.allFeature.CREATE_FAIL=!1,4!==a.runflag?(this.auth.COPY_SYSTEM_DISK=!1,this.feature.NONSHUTDOWN=!0):(this.auth.COPY_SYSTEM_DISK=!0,this.allFeature.NONSHUTDOWN=!1),e.isPrepaidPayMode(a.instanceChargeType)&&(this.multiTypeCvm.prepaidCvm=!0,this.feature.CVMPREPAID=!0,a.canRefund?this.feature.CVMPREPAID_CANREFUND=!0:(this.allFeature.CVMPREPAID_CANREFUND=!1,this.feature.CVMPREPAID_REFUNDREASON=a.refundReason)),e.isSecondPayMode(a.instanceChargeType)?(this.multiTypeCvm.hourCvm=!0,this.feature.CVMSECONDPAY=!0):this.allFeature.CVMSECONDPAY=!1,e.isShoutdownStatus(a.instanceState)?this.multiTypeCvm.hasWaitToRecycle=!0:this.multiTypeCvm.allWaitToRecycle=!1,a.uHostId?(this.multiTypeCvm.cdhCvm=!0,this.feature.CDH_MACHINE=!0):this.allFeature.CDH_MACHINE=!1,e.isSpotPayMode(a.instanceChargeType)?(this.multiTypeCvm.spotCvm=!0,this.feature.CVMSPOTPAID=!0):this.allFeature.CVMSPOTPAID=!1;var h=[1,2,4,6,7,8,9,10,11,12,13,14,17,18,37];!a.ipBlocked&&h.indexOf(f)>=0&&(a.eipInfo&&!a.eipInfo.isBlocked?this.auth.UNBIND_EIP=!0:this.auth.BIND_EIP=!0),e.isShoutdownStatus(a.instanceState)||!a.deviceWanIp||a.eipInfo?this.auth.RETURN_WANIP=!1:this.auth.RETURN_WANIP=!0;var i=e.isNetworkEnhanced(a.instanceFamily);!i&&a.unVpcId&&28!=a.runflag&&(this.auth.BIND_ENI=!0,this.auth.UNBIND_ENI=!0),e.isBandwidthPostpaidPayMode(a.internetAccessible.internetChargeType)&&(this.feature.BANDWIDTH_POSTPAID_BY_HOUR=!0),a.terminateTimer&&(this.feature.TERMINATE_TIMER=!0),e.isBC1(a.instanceFamily)?this.feature.BC1_MACHINE=!0:this.allFeature.BC1_MACHINE=!1,e.isBS1(a.instanceFamily)?this.feature.BS1_MACHINE=!0:this.allFeature.BS1_MACHINE=!1,e.isS4METAL(a.instanceFamily)?this.feature.S4_MACHINE=!0:this.allFeature.S4_MACHINE=!1,e.isFpga(a.instanceFamily)&&(this.feature.FPGA_MACHINE=!0),e.isGpuAmd(a.instanceFamily)&&(this.feature.GPUAMD_MACHINE=!0),e.isBigData(a.instanceFamily)&&(this.feature.BIGDATA_MACHINE=!0),e.isHighIN3(a.instanceFamily)&&(this.feature.HIGH_IN3_MACHINE=!0),e.isGpuN8(a.instanceFamily)&&(this.feature.GPUN8_MACHINE=!0),"GN6S"==a.instanceFamily&&(this.feature.GN6S_MACHINE=!0),"GN10S"==a.instanceFamily&&(this.feature.GN10S_MACHINE=!0),e.isGpuN10(a.instanceFamily)&&(this.feature.GPUN10_MACHINE=!0),e.isI3(a.instanceFamily)&&(this.feature.I3_MACHINE=!0)}this.multiTypeCvm.hourCvm&&this.multiTypeCvm.cdhCvm&&(this.feature.MULTI_CVM=!0)},getAuth:function(){var a=this.options,b=a.dataItems,c=a.operAction,d=a.whiteList||{};c="string"==typeof c?[c]:c;for(var e,f={},g=0;e=c[g];g++){var h=this.getDeniedActionResult(b,e),i=this.judgment[e];d.UsingNewOperationValidator?f[e]=h:i?f[e]=i.call(this,b):f[e]={code:0}}return f},getDeniedActionResult:function(a,b){var c=this.options.operActionModuleMap&&this.options.operActionModuleMap[b]&&this.options.operActionModuleMap[b].name||b;b=b&&b.split(".")[0];var d=null,f=["tag","export","buysameconfig"],g=["addBandwidthPackage","AttachNetworkInterface","DetachNetworkInterface","AssociateAddress","DisassociateAddress","ReleaseAddresses","TransformAddress","ReturnNormalAddresses","AdjustPublicAddress","upgradeEipBandwidth"],h=f.concat(g);if(a&&a.length&&b)if(h.find(function(a){return a==b}))d=this.judgment[b].call(this,a);else{var i=null,j=b.split("&"),k=b.split("|");if(a.forEach(function(a){if(!i&&a.deniedActions){if(k.length>1)i=function(){var b=a.deniedActions.filter(function(a){return k.find(function(b){return b==a.action})}).map(function(a){return a.message});return b.length==k.length?b[0]:null}();else if(b.split("&").length>1)i=function(){var b=a.deniedActions.filter(function(a){return j.find(function(b){return b==a.action})}).map(function(a){return a.message});return b.length?b[0]:null}();else{var c=a.deniedActions.find(function(a){return a.action==b});i=c&&c.message}"TerminateInstances"==b&&e.isPrepaidPayMode(a.instanceChargeType)&&!a.canRefund&&(i=a.refundReason)}}),a.length>1&&!i){var l={ModifyInstancesChargeType:30,tag:50,ModifyInstancesVpcAttribute:20},m={ResetInstancesInternetMaxBandwidth:[{name:"网络计费模式",path:"internetAccessible.internetChargeType"}],TerminateInstances:[{name:"实例计费模式",path:"instanceChargeType"},{name:"状态",path:"instanceState"}],RenewInstances:[{name:"实例计费模式",path:"instanceChargeType"}],ModifyInstancesVpcAttribute:[{name:"可用区",path:"placement.zone"}],ResetInstancesType:[{name:"可用区",path:"placement.zone"}]};if(l[b]&&(i=a.length>l[b]?"您选择的实例超过 "+l[b]+" 台，超过批量"+c+"的数量上限":i),m[b]){var n=m[b].find(function(b){return Object.keys(a.map(function(a){return e.findPropertyByPath(a,b.path)}).reduce(function(a,b){return Object.assign(a,_defineProperty({},b,!0))},{})).length>1});i=n?"批量"+c+"操作需要所有实例的"+n.name+"属性一致。":i}}d={code:i?1:0,tip:i?i:void 0}}else d={code:1,tip:"请先选择实例"};return d},judgment:{"ModifyInstancesAttribute.InstanceName":function(a){return a.length>0?this.isOperable("RENAME")?this.enable():this.disable():this.disable("请选择需要改名的实例")},upgradeEipBandwidth:function(a){return a.length<1?this.disable("请选择需要调整带宽的实例"):a.length>1?this.disable("弹性公网IP暂不支持批量调整带宽"):a[0].deviceWanIp?this.enable():this.disable("请先绑定弹性公网IP后再调整带宽")},ResetInstancesInternetMaxBandwidth:function(a){if(a.length<1)return this.disable("请选择需要调整网络的实例");var b=this.checkWanIp(a);if(!this.listIns.isNetworkShiftUpUser||b.isAllHasWanIp){if(!this.listIns.isNetworkShiftUpUser||b.isAllNormalWanIp){if(!this.listIns.isPrepaidUser||this.listIns.isBandwidthPackageUser)return this.isOperable("SETBANDWIDTH")?this.enable():this.disable();var c=this.getItemsNetworkPayMode();return c.isSame?c.mode==d.NETWORKPAYMODE.BANDWIDTH_POSTPAID_BY_HOUR?this.isOperable("SETBANDWIDTH")?this.enable():this.disable():this.isOperableUpBandwith()?this.enable():this.disable():this.enable()}return 1==a.length?this.enable():b.isAllEIP?this.disable("暂时无法批量调整绑定弹性公网IP的实例带宽"):this.disable("暂时无法批量混合调整实例和弹性公网IP的带宽")}return this.disable("请先绑定弹性公网IP后再调整带宽")},ResetInstancesType:function(a){return a.length>0?1==a.length&&e.isShoutdownStatus(a[0])?this.disable():this.ifSameZone(a)?this.enable():this.disable("请选择同一可用区的实例"):this.disable("请选择需要调整的实例")},"ResizeInstanceDisks|ResizeDisk":function(a){return 1!==a.length?this.disable("请选择需要调整的单台实例"):this.feature.I3_MACHINE?this.disable("高IO型 I3 实型不支持调整硬盘"):this.feature.BIGDATA_MACHINE?this.disable("大数据机型不支持调整硬盘"):this.feature.HIGH_IN3_MACHINE?this.disable("高IO型 IN3 实例不支持调整硬盘"):this.isOperableUpDisk()?this.enable():a[0].uHostId?this.disable("独享型实例只有数据盘存在本地盘才可调整硬盘"):this.hasCorrectDisk()?this.disable():this.disable("仅数据盘为云硬盘才支持硬盘扩容")},ResizeInstanceDisks:function(a){return 1!==a.length?this.disable("请选择需要调整的单台实例"):this.feature.I3_MACHINE?this.disable("高IO型 I3 实型不支持调整硬盘"):this.feature.BIGDATA_MACHINE?this.disable("大数据机型不支持调整硬盘"):this.feature.HIGH_IN3_MACHINE?this.disable("高IO型 IN3 实例不支持调整硬盘"):this.isOperableUpDisk()?this.enable():a[0].uHostId?this.disable("独享型实例只有数据盘存在本地盘才可调整硬盘"):this.hasCorrectDisk()?this.disable():this.disable("仅数据盘为云硬盘才支持硬盘扩容")},ModifyInstancesChargeType:function(a){return a.length>0?this.hasAllFeature("CREATE_FAIL")?this.disable("发货失败的实例不支持计费模式转换"):this.multiTypeCvm.hasWaitToRecycle?this.disable("不支持待回收实例从按量计费转换为包年包月"):1==a.length?this.hasFeature("TERMINATE_TIMER")?this.disable("该实例存在定时销毁任务，不支持将该实例从按量计费转换为包年包月，请撤销定时销毁后重试"):this.hasFeature("BC1_MACHINE")?this.disable("批量通用型BS1实例不支持包年包月计费，不支持将该实例从按量计费转换为包年包月"):this.hasFeature("BS1_MACHINE")?this.disable("批量通用型BS1实例不支持包年包月计费，不支持将该实例从按量计费转换为包年包月"):this.hasFeature("CVMSECONDPAY")?this.hasFeature("BANDWIDTH_POSTPAID_BY_HOUR")?this.disable("网络计费模式为按带宽使用时长的实例暂不支持从按量计费转换为包年包月"):this.enable():this.disable("该实例不是按量计费实例，不支持将该实例从按量计费转换为包年包月"):a.length>30?this.disable("您每次最多可将 30 个按量付费实例转换为包年包月实例，如需更多，请分批操作"):this.hasFeature("BC1_MACHINE")||this.hasFeature("BS1_MACHINE")?this.disable("批量型实例不支持包年包月计费，不支持将该实例从按量计费转换为包年包月"):this.multiTypeCvm.prepaidCvm||this.multiTypeCvm.cdhCvm?this.disable("您所勾选的实例中包含非按量计费实例，请确认后实例计费模式后再进行转换"):this.hasFeature("BANDWIDTH_POSTPAID_BY_HOUR")?this.disable("您所勾选的实例中包含网络按小时带宽的实例，暂不支持将该实例从按量计费转换为包年包月"):this.hasFeature("TERMINATE_TIMER")?this.disable("您所勾选的实例中存在定时销毁任务，不支持该实例从按量转包年包月，请撤销定时销毁后重试"):this.enable():this.disable("请选择需要转换为包年包月的实例")},ModifyInstanceDiskType:function(a){return a.length>0?a.every(function(a){return"STOPPED"==a.instanceState})?this.hasFeature("S4_MACHINE")?this.disable("暂不支持裸金属实例类型"):a.every(function(a){return f.isLocalDiskType(a.systemDisk.storageType)||a.dataDisks.some(function(a){return f.isLocalDiskType(a.storageType)})})?this.hasFeature("CVMSPOTPAID")?this.disable("暂不支持竞价实例类型"):this.hasFeature("CDH_MACHINE")?this.disable("暂不支持独享型实例"):this.enable():this.disable("实例的系统盘或数据盘至少有一种类型为普通本地盘或SSD本地盘"):this.disable("仅支持在实例关机状态下进行硬盘介质转换操作"):this.disable("请选择需要切换为云硬盘的实例")},TerminateInstances:function(a){return a.length>0?this.isOperable("DELETE")?this.multiTypeCvm.hourCvm&&this.multiTypeCvm.cdhCvm?this.disable("不支持独享型实例和按量计费实例混合销毁"):this.multiTypeCvm.hourCvm&&this.multiTypeCvm.prepaidCvm?this.disable("不支持包年包月实例和按量计费实例混合销毁"):this.multiTypeCvm.cdhCvm&&this.multiTypeCvm.prepaidCvm?this.disable("不支持独享型实例和包年包月实例混合销毁"):this.multiTypeCvm.hourCvm&&this.multiTypeCvm.spotCvm?this.disable("不支持按量计费实例和按量计费竞价实例混合销毁"):this.multiTypeCvm.prepaidCvm&&this.multiTypeCvm.spotCvm?this.disable("不支持包年包月实例和按量计费竞价实例混合销毁"):this.multiTypeCvm.cdhCvm&&this.multiTypeCvm.spotCvm?this.disable("不支持独享型实例和按量计费竞价实例混合销毁"):this.multiTypeCvm.hasWaitToRecycle&&!this.multiTypeCvm.allWaitToRecycle?this.disable("不支持待回收实例和正常实例混合销毁"):this.hasFeature("CDH_MACHINE")?this.enable():this.hasFeature("CVMSECONDPAY")?this.enable():this.hasFeature("CVMSPOTPAID")?this.enable():this.hasFeature("CVMPREPAID")?this.multiTypeCvm.allWaitToRecycle||0!=this.hasAllFeature("CVMPREPAID_CANREFUND")?this.enable():this.disable(a.length>1?"包含当前不支持销毁的实例":this.feature.CVMPREPAID_REFUNDREASON):void 0:this.disable():this.disable("请选择需要销毁的实例")},AssociateInstancesKeyPairs:function(a){return a.length>0?this.isOperable("DELIVERKEY")?this.hasAllFeature("WINDOWS")?this.disable("密钥仅支持linux实例"):this.enable():this.disable():this.disable("请选择需要加载密钥的实例")},StartInstances:function(a){return a.length>0?this.isOperable("BOOT")?this.checkAllSameState(a,"STOPPED")?this.enable():this.disable("实例全部处于关机状态才可进行批量开机 "):this.hasAllFeature("ISOLATION")&&this.hasAllFeature("CVMSECONDPAY")?this.disable("欠费关机，请充值"):this.disable("关机状态的实例才可开机"):this.disable("请选择需要开机的实例")},ModifyInstancesProject:function(a){return a.length>0?this.hasAllFeature("ISOLATION")?this.disable():this.hasAllFeature("CDH_MACHINE")?this.disable("独享型实例不支持分配项目"):this.hasAllFeature("CREATE_FAIL")?this.disable("发货失败的实例不支持分配项目"):this.enable():this.disable("请选择需要分配至项目的实例")},CreateImage:function(a){return 1===a.length?this.isOperable("CREATEIMG")?/windows2003/.test(a[0].osName)?this.disable("该实例系统老旧不支持制作镜像"):this.enable():this.feature.S4_MACHINE?this.disable("裸金属实例不可制作镜像"):1===a[0].hypervisor&&this.isOperable("XENTOKVM")&&this.listIns.isPrepaidUser?this.enable():this.disable("当前状态不可制作镜像"):this.disable("请选择需要制作镜像的单台实例")},"export":function(a){return a.length>0?this.enable():this.disable("请选择需要导出的实例")},addBandwidthPackage:function(a){return 1==a.length?this.hasAllFeature("ISOLATION")?this.disable():!a[0].deviceWanIp||e.isBandwidthPrepaidPayMode(a[0].internetAccessible.internetChargeType)||e.isBandwidthPackagePaymode(a[0].internetAccessible.internetChargeType)?this.disable():this.enable():this.disable("请选择需要加入带宽包的单台实例")},checkPort:function(a){return 1==a.length&&!e.isShoutdownStatus(a[0])&&a[0].securityGroupIds&&a[0].securityGroupIds.length?this.enable():this.disable()},"ModifyInstancesAttribute.SecurityGroups":function(a){return 1==a.length?this.isOperable("FIREWALL")?this.enable():this.disable():this.disable("请选择需要配置安全组的单台实例")},associateSecurityGroup:function(a){return a&&a.length?this.isOperable("FIREWALL")?this.enable():this.disable():this.disable("请选择需要配置安全组的实例")},RebootInstances:function(a){return a.length<1?this.disable("请选择需要重启的实例"):this.isOperable("REBOOT")?this.enable():this.disable("运行中的实例才可重启")},RenewInstances:function(a){if(a.length<1)return this.disable("请选择需要续费的实例");if(a.length>1&&this.hasFeature("CVMSECONDPAY")&&!this.hasAllFeature("CVMSECONDPAY"))return this.disable("不支持包年包月实例和按量计费实例混合恢复");if(this.hasFeature("CDH_MACHINE"))return this.disable("独享型实例不支持续费");if(this.hasFeature("CVMSPOTPAID"))return this.disable("竞价计费实例不支持续费");var b=a[0],c=100001;return c!=b.zoneId||!b.deviceClass||"v1.0.5"!=b.deviceClass.toLowerCase()&&"v1.1"!=b.deviceClass.toLowerCase()?this.isOperable("RENEW")?this.enable():this.disable():this.disable("广州一区共享核机器已下架,请查看公告")},ModifyInstancesRenewFlag:function(a){if(a.length<1)return this.disable("请选择需要自动续费的实例");if(this.hasFeature("CVMSECONDPAY"))return this.disable("按量计费实例不支持自动续费");if(this.hasFeature("CDH_MACHINE"))return this.disable("独享型实例不支持自动续费");if(this.hasFeature("CVMSPOTPAID"))return this.disable("竞价计费实例不支持自动续费");var b=a[0],c=100001;return c!=b.zoneId||!b.deviceClass||"v1.0.5"!=b.deviceClass.toLowerCase()&&"v1.1"!=b.deviceClass.toLowerCase()?this.isOperable("SETAUTORENEW")?this.enable():this.disable():this.disable("广州一区共享核机器已下架,请查看公告")},ModifyInstancesVpcAttribute:function(a){if(a.length<1)return this.disable("请选择需要切换VPC的实例");if(a.length>20)return this.disable("单次批量切换私有网络最多支持20个实例");if(this.hasAllFeature("ISOLATION"))return this.disable();var b=this.checkModifyVpc(a);return b.isSameZone?b.isAllOldSwitch?this.disable("选择的实例目前不支持切换VPC，请先进行配置升级"):this.enable():this.disable("选择的实例属于不同可用区")},ResetInstance:function(a){return 1===a.length?this.isOperable("RESETOS")?this.enable():this.hasFeature("CVMSPOTPAID")?this.disable("竞价实例不可进行该操作"):this.disable():this.disable("请选择需要重装系统的单台实例")},ResetInstancesPassword:function(a){return a.length>0?this.isOperable("RESETPW")?this.enable():this.disable():this.disable("请选择需要重置密码的实例")},StopInstances:function(a){return a.length>0?this.isOperable("SHUTDOWN")?this.checkAllSameState(a,"RUNNING")?this.enable():this.disable("实例全部处于开机状态才可进行批量关机 "):this.disable("运行中的实例才可关机"):this.disable("请选择需要关机的实例")},DescribeInstanceVncUrl:function(a){return this.isOperable("CONNECTVNC")?this.enable():!this.hasAllFeature.NONSHUTDOWN&&a.length&&4==a[0].runflag?this.disable("请先开机再登录"):this.disable()},ReturnNormalAddresses:function(a){if(this.isOperable("RETURN_WANIP"))return this.enable();if(!a||!a[0])return this.disable();var b=a[0];return e.isShoutdownStatus(b.instanceState)?this.disable("当前状态不可退还公网IP"):b.deviceWanIp?b.eipInfo?this.disable("弹性IP请先解绑后再释放"):void 0:this.disable("当前实例不存在公网IP")},AdjustPublicAddress:function(a){if(!a||!a[0])return this.disable();var b=a[0];return!b.publicIpAddresses||b.publicIpAddresses.length<1?this.disable("当前实例不存在公网IP"):b.eipInfo?this.disable("弹性公网IP暂不支持直接更换"):this.enable()},TransformAddress:function(a){return a&&a[0]?a[0].ipBlocked?this.disable("当前IP已被安全隔离"):a[0].publicIpAddresses&&a[0].publicIpAddresses.length?a[0].eipInfo?this.disable("已绑定弹性IP，请先解绑"):a[0].ipConfig.eipQuotaData&&a[0].ipConfig.eipQuotaData.currentEipNum>=a[0].ipConfig.eipQuotaData.eipNumQuota?this.disable("弹性公网IP已达到"+a[0].ipConfig.eipQuotaData.eipNumQuota+"个上限，无法转换"):a[0].whiteList.network_shift_up&&"BANDWIDTH_PREPAID"===a[0].internetAccessible.internetChargeType?this.disable("包月带宽的IP暂不支持此功能"):this.isOperable("BIND_EIP")?this.enable():this.disable():this.disable("当前实例不存在公网IP"):this.disable()},AssociateAddress:function(a){return this.isOperable("BIND_EIP")?this.enable():a&&a[0]&&a[0].ipBlocked?this.disable("当前IP已被安全隔离"):a&&a[0]&&a[0].eipInfo?this.disable("已绑定弹性IP，请先解绑"):this.disable("当前状态不可绑定弹性EIP")},DisassociateAddress:function(a){return this.isOperable("UNBIND_EIP")?this.enable():a&&a[0]&&(a[0].ipBlocked||a[0].eipInfo&&a[0].eipInfo.isBlocked)?this.disable("当前IP已被安全隔离"):this.disable("未绑定弹性IP")},AttachNetworkInterface:function(a){return a.length>0?this.isOperable("BIND_ENI")?this.enable():this.disable("当前实例不支持绑定弹性网卡"):this.disable("请选择需要绑定弹性网卡的实例")},DetachNetworkInterface:function(a){return a.length>0?this.isOperable("UNBIND_ENI")?this.enable():this.disable("当前实例不支持解绑弹性网卡"):this.disable("请选择需要解绑弹性网卡的实例")},tag:function(a){return a.length>50?this.disable("您选择的实例超过50台，超过了批量编辑标签的上限"):a.length>0?this.hasFeature("ISOLATION")?this.disable():this.enable():this.disable("请选择需要设置标签的实例")},CopyInstanceDisk:function(a){return a.length>0?this.isOperable("COPY_SYSTEM_DISK")?this.enable():this.disable("只有处于关机状态的实例才可以复制系统盘数据"):this.disable("请选择需要复制的实例")},BindAutoSnapshotPolicy:function(a){return a.length>0?a.every(function(a){return a.cbsList&&a.cbsList.length})?this.enable():this.disable("仅云硬盘实例才支持定期数据备份能力"):this.disable("请选择实例")},buysameconfig:function(a){var b=a&&a[0];return b?b.instanceType?b.instanceType.indexOf("CDH")>-1?this.disable("独享型实例不支持该操作"):this.enable():this.disable():void 0}},checkAllSameState:function(a,b){var c=!0;return a.forEach(function(a){return a.instanceState!=b?void(c=!1):void 0}),c},checkModifyVpc:function(a){var b=!0,c=!0,d=a[0].zoneId;return a.forEach(function(a){a.zoneId!==d&&(b=!1),-1!=a.innerVpcId&&(c=!1)}),{isSameZone:b,isAllOldSwitch:c}},ifSameZone:function(a){var b=!0,c=a[0].zoneId;return a.forEach(function(a){a.zoneId!==c&&(b=!1)}),b},checkWanIp:function(a){var b=!0,c=!0,d=!0;return a.forEach(function(a){a.deviceWanIp||(c=!1),a.eipInfo&&(b=!1),a.deviceWanIp&&!a.eipInfo&&(d=!1)}),{isAllNormalWanIp:b,isAllHasWanIp:c,isAllEIP:d}},isOperableUpBandwith:function(){return this.isOperable("UPGRADEBANDWIDTH")&&!this.listIns.isBandwidthPackageUser},isOperableUpConfig:function(){return this.isOperable("UPGRADECONFIG")&&this.hasCorrectConfig()},isOperableUpDisk:function(){return this.isOperable("UPGRADEDISKCONFIG")&&this.hasCorrectDisk()},isOperableOnlineCreateImage:function(){return this.isOperable("CREATEIMG")&&this.listIns.onlineImage},hasCorrectDisk:function(){var a=this.options.dataItems[0],b=!1;return b=a.uHostId?(a.dataDisks||[]).some(function(a){return f.isLocalDiskType(a.storageType)}):(a.cbsList||[]).filter(function(a){return f.isCloudDiskType(a.storageType)}).some(function(a){return"data"==a.diskType})},hasCorrectConfig:function(){var a=this.options.dataItems[0];return a.uHostId?!0:f.isCloudDiskType(a.systemDisk.storageType)},getItemsNetworkPayMode:function(){var a=[],b=!0;return this.options.dataItems.forEach(function(b){a.indexOf(b.internetAccessible.internetChargeType)<0&&a.push(b.internetAccessible.internetChargeType)}),a.length>1&&(b=!1),b?{isSame:!0,mode:a[0]||d.NETWORKPAYMODE.BANDWIDTH_POSTPAID_BY_HOUR}:{isSame:!1}},enable:function(){return{code:0}},disable:function(a,b){var c="当前状态不可进行该操作";return a=a||c,{code:1,tip:a,reason:b||a}},isOperable:function(a){var b=!1;return this.auth[a]===!0&&(b=!0),b},hasFeature:function(a){var b=!1;return this.feature[a]===!0&&(b=!0),b},hasAllFeature:function(a){var b=!0;return this.allFeature[a]===!1&&(b=!1),b}},c.exports=g}),define("cvm/cvm/event/operate_base",function(a,b,c){var d=a("$"),e=(a("manager"),a("tips"),a("util"),a("appUtil")),f=(a("widget/msg/msg"),a("./operate_auth")),g=a("widget/operatelog/floattips"),h=a("dialog"),i=a("cvm/cvm/event/selectedShow/selectedShow"),j=a("cvm/cvm/cvmutil"),k=function(a){a&&(this.listIns=a.listIns,this.button=a.button,this.selectedItems=a.selectedItems)};k.prototype={change:function(a,b,c){this.operateAuth=c;var d=this.operateAuth.getAuth();d[b]&&"export"!=b&&(0===d[b].code?this.enable():this.disable(d[b].tip))},exec:function(){},refresh:function(a,b,c){a?this.selectedItems=a:this.selectedItems=[],this.change(a,b,c)},refreshList:function(a){this.listIns.refresh(a)},disable:function(a,b){this.button.addClass("disabled"),this.setTitle(a),b&&b.call(this)},enable:function(a){this.button.removeClass("disabled"),this.setTitle(),a&&a.call(this)},setTitle:function(a){a=a||"",this.button.attr("data-title",a)},isOperable:function(a){return this.operateAuth.isOperable(a)},hasFeature:function(a){return this.operateAuth.hasFeature(a)},restoreDialogBtn:function(){e.restoreDialogBtn()},selectedItemIsExpire:function(){var a=!1,b=this.hasPermItems[0];return 1==b.expiredTimeStatus&&(a=!0),a},isCvmSecondPay:function(){var a=this.hasPermItems[0];return j.isSecondPayMode(a.instanceChargeType)},isNetworkSecondPay:function(){var a=this.hasPermItems[0];return j.isBandwidthPostpaidPayMode(a.internetAccessible.internetChargeType)},isNetworkFlowPay:function(){var a=this.hasPermItems[0];return j.isNetworkFlowPayMode(a.internetAccessible.internetChargeType)},toPay2:function(a){var b="https://"+window.QCBUY_HOST+"/order/check";"[object Array]"!==Object.prototype.toString.call(a)&&(a=[a]);var c={itemDetails:{raw_goodsData:a}};e.submitForm(b,c)},getRootDiskPara:function(){var a=this.hasPermItems[0],b=a.rootType,c=a.rootSize,d="";return 1==b?d="rootDisk":2==b?d="rootCbs":3==b&&(d="rootSsd"),{key:d,val:c}},resolvePerm:function(a,b,c){var d=this,e=[],g=[],h={actionName:c,hasPermItems:[],noPermItems:[]};a.forEach(function(a){var i=new f({dataItems:[a],operAction:b,operActionModuleMap:_defineProperty({},b,{name:c}),listIns:d.listIns,whiteList:d.listIns.whiteList}).getAuth(),j=a.internetAccessible&&/^\d+$/.test(a.internetAccessible.internetMaxBandwidthOut)?65535==a.internetAccessible.internetMaxBandwidthOut?"无上限":a.internetAccessible.internetMaxBandwidthOut+" Mbps":"0 Mbps";i[b]&&(0===i[b].code?(e.push(a),h.hasPermItems.push({regionId:a.regionId,name:a.alias,id:a.uInstanceId,bandwidth:j})):(g.push(a),h.noPermItems.push({bandwidth:j,name:a.alias,id:a.uInstanceId,reason:i[b].reason})))});var i={hasPermItems:e,noPermItems:g,selectedShowOptions:h};return i},checkTask:function(a,b,c){var e=(a.taskId,this.listIns);e.gridView,e.cvmListEl;if(e.showTask){var f=this;return void e.showTask(a,b,c,f)}g.showNoticeTip({msg:b,business_id:1},2);var h="正在执行任务",i=d(".cvm-more-opt");d(".cvm-more-opt").attr("data-isloading",!0),i.find(">button").addClass("disabled").attr("data-title",h),d(".tc-15-dropdown-link").addClass("disabled").attr("data-title",h),this.listIns.operatedCallback&&this.listIns.operatedCallback(),this.listIns.clearCheckTask&&this.listIns.clearCheckTask()},clearQueryStatus:function(){clearTimeout(this.timeOut)},toConfirmShutdown:function(a){var b={},c=d.Deferred(),e=a.isConfirmBtnNoDisable?0:1,f=new Bee(a.confirmTpl,{$afterInit:function(){a.isConfirmBtnNoDisable||this.$watch("agree",function(a){h.toggleBtnDisable(!a,0)})},$data:{agree:!1}});return b[a.confirmBtnTxt]=function(){c.resolve()},h.create(f.$el,"525","",{title:a.title,preventResubmit:!0,button:b,buttonDisable:[e,0],defaultCancelCb:function(){c.reject()}}),i.render(this.selectedShowOptions),c.promise()},destroy:function(){this.clearQueryStatus()}},c.exports=k}),define("cvm/cvm/event/operate_entry",function(a,b,c){var d=a("tips"),e=a("reporter"),f=a("cvm/cvm/event/operate_auth"),g={},h={RebootInstances:{name:"重启",module:a("cvm/cvm/event/reboot/reboot"),hotTag:"yunzhuji.reboot"},StartInstances:{name:"开机",module:a("cvm/cvm/event/boot/boot"),hotTag:"yunzhuji.turnon"},StopInstances:{name:"关机",module:a("cvm/cvm/event/shutdown/shutdown"),hotTag:"yunzhuji.shutdown"},"ModifyInstancesAttribute.InstanceName":{name:"重命名",module:a("cvm/cvm/event/alias/alias"),hotTag:"yunzhuji.rename"},ResetInstancesPassword:{name:"重置密码",module:a("cvm/event/resetpwd/resetpwd"),hotTag:"yunzhuji.rekey"},RenewInstances:{name:"续费",module:a("cvm/cvm/event/renew/renew"),hotTag:"yunzhuji.xufei"},CreateImage:{name:"制作镜像",module:a("cvm/event/createimg/createimg"),hotTag:"yunzhuji.zzjingxiang"},buysameconfig:{name:"购买相同配置",hotTag:"yunzhuji.buysameconfig",module:a("cvm/event/buysameconfig/buysameconfig")},addBandwidthPackage:{name:"加入带宽包",module:a("cvm/cvm/event/addBandwidthPackage/addBandwidthPackage"),hotTag:"yunzhuji.addBandwidthPackage"},ResetInstancesInternetMaxBandwidth:{name:"调整带宽",module:a("cvm/cvm/event/upgradebandwidth/upgradebandwidth"),hotTag:"yunzhuji.upgradebandwidth"},upgradeEipBandwidth:{name:"调整带宽",module:a("cvm/eip2/upgradeBandwidth"),hotTag:"yunzhuji.upgradebandwidth"},ResetInstancesType:{name:"调整配置",module:a("cvm/cvm/event/resetType/resetType"),hotTag:"yunzhuji.upgradeconfig"},"ResizeInstanceDisks|ResizeDisk":{name:"调整硬盘",module:a("cvm/cvm/event/upgradedisk/upgradedisk"),hotTag:"yunzhuji.upgradedisk"},ResetInstance:{name:"重装系统",module:a("cvm/cvm/event/resetos/resetos"),hotTag:"yunzhuji.chongzhuang"},ModifyInstancesChargeType:{name:"按量转包年包月",module:a("cvm/cvm/event/modifyChargeType/modifyChargeType"),hotTag:"yunzhuji.anliangzhuanbaonianbaoyue"},ModifyInstanceDiskType:{name:"调整硬盘介质",module:a("cvm/cvm/event/modifyDiskType/modifyDiskType"),hotTag:"yunzhuji.localDiskToCbs"},ModifyInstancesRenewFlag:{name:"设置自动续费",module:a("cvm/cvm/event/setAutoRenew/setAutoRenew"),hotTag:"yunzhuji.setAutoRenew"},ModifyInstancesVpcAttribute:{name:"切换私有网络",module:a("cvm/cvm/event/modifyVpcAttribute/modifyVpcAttribute"),hotTag:"yunzhuji.modifyVpcAttribute"},"export":{name:"导出实例",module:a("cvm/cvm/event/export/export"),hotTag:"yunzhuji.export"},AssociateInstancesKeyPairs:{name:"加载密钥",module:a("cvm/event/bindkeypair/bindkeypair"),hotTag:"yunzhuji.ssh"},returncvm:{name:"退还实例",module:a("widget/cvmList/returncvm/returncvm"),hotTag:"yunzhuji.tuihuan"},TerminateInstances:{name:"销毁/退还",module:a("cvm/cvm/event/destroycvm/destroycvm"),hotTag:"yunzhuji.destroy"},bandwidthlimit:{name:"调整带宽",module:a("cvm/cvm/bandwidthlimit/bandwidthlimit"),hotTag:"yunzhuji.bandwidthlimit"},ModifyInstancesProject:{name:"分配至项目",module:a("cvm/changeproject/changeproject"),hotTag:"yunzhuji.changeproject"},"ModifyInstancesAttribute.SecurityGroups":{name:"配置安全组",module:a("cvm/cvm/event/firewall/firewall"),hotTag:"yunzhuji.firewall"},checkPort:{name:"一键放通",module:a("cvm/cvm/event/firewall/checkPort"),hotTag:"yunzhuji.checkPort"},AssociateSecurityGroups:{name:"加入安全组",module:a("cvm/cvm/event/firewall/associateSecurityGroup"),hotTag:"yunzhuji.firewall"},TransformAddress:{name:"转换为弹性公网IP",module:a("cvm/cvm/event/wipToEip/wipToEip"),hotTag:"yunzhuji.wipToEip"},ReturnNormalAddresses:{name:"退还公网IP",module:a("cvm/cvm/event/returnWanIp/returnWanIp"),hotTag:"yunzhuji.returnWanIp"},AdjustPublicAddress:{name:"更换公网IP",module:a("cvm/cvm/event/adjustWanIp/adjustWanIp"),hotTag:"yunzhuji.adjustWanIp"},AssociateAddress:{name:"绑定弹性公网IP",module:a("cvm/cvm/event/bindEip/bindEip"),hotTag:"yunzhuji.bindEip"},DisassociateAddress:{name:"解绑弹性公网IP",module:a("cvm/cvm/event/unbindEip/unbindEip"),hotTag:"yunzhuji.unbindEip"},AttachNetworkInterface:{name:"绑定弹性网卡",module:a("cvm/cvm/event/bindEni/bindEni"),hotTag:"yunzhuji.bindEni"},DetachNetworkInterface:{name:"解绑弹性网卡",module:a("cvm/cvm/event/unbindEni/unbindEni"),hotTag:"yunzhuji.unbindEni"},DescribeInstanceVncUrl:{name:"登录",module:a("cvm/cvm/event/vnc"),hotTag:"yunzhuji.showvnc"},DeleteInstancesActionTimer:{name:"撤销定时销毁",module:a("cvm/cvm/event/removeTerminateTimer"),hotTag:"yunzhuji.removeTerminateTimer"},CopyInstanceDisk:{name:"拷贝系统盘数据",module:a("cvm/cvm/event/copySystemDiskData/copySystemDiskData"),hotTag:"yunzhuji.copySystemDiskData"},BindAutoSnapshotPolicy:{name:"设置定时快照策略",module:a("cvm/cvm/event/bindAutoSnapshotPolicy/bindAutoSnapshotPolicy"),hotTag:"yunzhuji.bindAutoSnapshotPolicy"},tag:{name:"编辑标签",module:a("./tag/tag"),hotTag:"yunzhuji.editTag"},Migrate:{name:"免费升级换代",module:a("cvm/cvm/event/migrate/migrate"),hotTag:"yunzhuji.migrate"}},i={getModuleArr:function(){var a=[];for(var b in h)a.push(b);return a},getModuleMap:function(){return h},exec:function(a,b,c){var f=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=f&&f.cloudAPIActionNameMap||{};if(d.hideFlash(1),b){var j=this.listIns,k=h[a],l=new k.module({listIns:j,selectedItem:b});c&&(l.operateAuth=c)}else var l=g[a];var m=h[a].name,n=h[a].hotTag;if(l){if(b)var o=l.resolvePerm(b,a,m);else var o=l.resolvePerm(l.selectedItems,a,m);l.cloudAPIActionNameMap=i,l.permResult=o,l.hasPermItems=o.hasPermItems,b&&(l.selectedItems=o.hasPermItems),l.selectedShowOptions=o.selectedShowOptions,l.args=arguments,l.exec&&l.exec()}n&&e.click(n)},refresh:function(a,b){a=a||[];var c=new f({dataItems:a,operAction:this.getModuleArr(),operActionModuleMap:this.getModuleMap(),listIns:this.listIns,whiteList:this.listIns.whiteList});for(var d in g)g[d].refresh&&g[d].refresh(a,d,c);return b?c:void 0},destroy:function(){for(var a in g)g[a].destroy&&g[a].destroy()}};c.exports=i}),define("cvm/cvm/event/reboot/reboot",function(a,b,c){var d,e=a("$"),f=(a("manager"),a("cvm/cvm/event/operate_base")),g=a("dialog"),h=a("util"),i=(a("cvm/common/constants"),a("cvm/cvm/event/selectedShow/selectedShow")),j=a("cvm/common/model"),k=a("cvm/common/renderMonitor"),l=a("widget/mfa/mfa"),m={main:'<span class="tit">确定对选中的实例进行重启？</span><br>    <span class="txt">    重启期间，实例将无法正常提供服务，请您做好准备，以免造成影响    </span>    <label for="rebootConfirmCheck" class="confirm-it">    <input type="checkbox" class="tc-15-checkbox" id="rebootConfirmCheck">    强制重启</label><div class="tc-15-msg" style="margin:10px 10px 10px 0">        强制重启的效果等同于关闭计算机的电源后再接入电源启动。强制重启可能会导致实例数据丢失或者文件系统损坏，请仅在实例无法正常重启的情况下使用。    </div>'},n=function(a){f.call(this,a)};n.prototype=new f,n.prototype.exec=function(){var a=this;l.verify({api:"cvm:RebootInstances"}).then(function(){d=k.init(c.id,"kennyang"),d&&d.renderBefore();var b=a,f=h.tmpl(m.main,{}),l=a.hasPermItems,n=a.cloudAPIActionNameMap&&a.cloudAPIActionNameMap.cvm&&a.cloudAPIActionNameMap.cvm.RebootInstances||"重启中";g.confirm(f,function(){for(var a,c=[],d=e("#rebootConfirmCheck").prop("checked")?"HARD":"SOFT_FIRST",f=0;a=l[f];f++)c.push(a.uInstanceId);c.length&&j.apiRequest({regionId:l[0].regionId,serviceType:"cvm",action:"RebootInstances",data:{InstanceIds:c,StopType:d}},{camTipsType:"dialog"}).then(function(a){g.hide(),b.checkTask({taskId:a.response.taskId},n),b.callback&&b.callback()})["catch"](function(a){console.warn(a)})},null,{title:"重启实例",width:550,hideIcon:!0}),i.render(a.selectedShowOptions),d&&d.renderSuccess()})},c.exports=n}),define("cvm/cvm/event/removeTerminateTimer",function(a,b,c){var d=a("dialog"),e=a("cvm/cvm/event/operate_base"),f=(a("util"),a("appUtil"),a("cvm/cvm/event/selectedShow/selectedShow")),g=a("cvm/common/model"),h=function(a){e.call(this,a)};h.prototype=new e,h.prototype.exec=function(){var a=this,b=this.hasPermItems;d.create(['<div class="tc-icon-box">','<div class="col">','<h3 class="tc-dialog-title">您确认要关闭以上实例的自动释放吗？</h3>',"</div>","</div>"].join(""),"610","",{title:"确认撤销定时销毁",preventResubmit:!0,button:{" 确定 ":function(){var c=[];b.forEach(function(a){a.terminateTimer&&c.push(a.terminateTimer.actionTimerId)}),g.apiRequest({regionId:b[0].regionId,serviceType:"cvm",action:"DeleteInstancesActionTimer",data:{ActionTimerIds:c}},{camTipsType:"dialog"}).then(function(b){d.hide(),setTimeout(function(){a.refreshList&&a.refreshList(),a.callback&&a.callback()},400)})["catch"](function(a){console.error(JSON.stringiry(a,null,4))})}}}),f.render(this.selectedShowOptions)},c.exports=h}),define("cvm/cvm/event/RecoverInstances",function(a,b,c){var d=a("$"),e=a("dialog"),f=a("util"),g=a("qccomponent"),h=(a("cvm/cvm/cvmutil"),a("cvm/common/model")),i=a("cvm/cvm/event/operate_base"),j={
main:'  <div class="tc-15-msg">    <p>请您确定您需要恢复的实例，确认恢复后将保持原配置并开始计费。</p>    <p>恢复成功后，以上设备将恢复到左侧导航栏【实例】下</p>  </div>  <div class="mb-10">    <p><strong>下列设备（共<%=len%>项）将进行恢复操作</strong></p>  </div>  <div id="recoverInstanceList" style="position:relative;"></div>'},k=function(a){i.call(this,a)};k.prototype=new i,k.prototype.constructor=k,k.prototype.exec=function(){var a=this,b=f.tmpl(j.main,{len:this.hasPermItems.length});e.create(b,"800","",{title:"恢复实例",preventResubmit:!0,button:{" 确定 ":function(){if(a.isSecondpay){var b=a.hasPermItems.map(function(a){return a.uInstanceId});h.apiRequest({action:"RenewInstances",serviceType:"cvm",data:{InstanceIds:b,Version:"2017-03-12"}}).then(function(){e.hide(),a.listIns&&a.listIns.operatedCallback&&a.listIns.operatedCallback(),a.callback&&a.callback()})}}}}),this.renderDeviceList()},k.prototype.renderDeviceList=function(){var a={$data:{showPagination:!1,showState:!1,canSelectTotal:!1,hasFirst:!1,maxHeight:150,minHeight:"auto",colums:[{key:"alias",name:"实例名",minWidth:200},{key:"uInstanceId",name:"实例ID",minWidth:200},{key:"bandwidth",name:"当前带宽上限",width:200,minWidth:150,tdTpl:"<div>{{item.bandwidth}}Mbps</div>"},{key:"action",name:"操作",width:200,tdTpl:"<div>可恢复</div>"}],autoMaxHeight:!1,maxHeightOffset:10},events:{},getData:function(a){}},b=g.getComponent("grid-view");this.gridView=new b(a),this.gridView.setData({list:this.hasPermItems}),d("#recoverInstanceList").append(this.gridView.$el),e&&e.center()},c.exports=k}),define("cvm/cvm/event/renew/renew",function(a,b,c){var d,e=a("$"),f=a("manager"),g=(a("lib/Class"),a("dialog")),h=a("util"),i=(a("appUtil"),a("widget/range/range")),j=(a("widget/pills/pills"),a("cvm/common/components/TimePill/timePill")),k=a("cvm/cvm/event/selectedShow/selectedShow"),l=a("cvm/cvm/cvmutil"),m=a("cvm/cvm/event/renew/renew_base"),n=a("cvm/cvm/event/renew/renew_batch"),o=a("cvm/common/constants"),p=a("cvm/common/renderMonitor"),q=a("cvm/common/components/BandwidthRangePopover"),r=(a("cvm/common/common"),a("models/iaas")),s=a("cvm/cvm/event/RecoverInstances"),t={main:'  <div class="renew-wrapper">    <% if (isRecycle && isPrepay) { %>      <div class="tc-15-msg">          <p>您需要通过续费来恢复实例，恢复后将保持原配置。</p>          <p>续费恢复后，与实例关联的负载均衡、弹性云盘、基础网络互通将不恢复，需要您重新配置。</p>          <p>支付成功后，以上设备将恢复到左侧【实例】栏目</p>          <p>显示的时长折扣只代表当前所有实例里的最高折扣。</p>       </div>      <% } else if(isRecycle && !isPrepay){ %>         <div class="tc-15-msg">            <p>请您确定您需要恢复的实例，确认恢复后将保持原配置并开始计费。</p>            <p>恢复成功后，以上设备将恢复到左侧导航栏【实例】下</p>          </div>      <% } %>    <div id="instance-list"></div>    <div class="edit_form_wrap">      <ul class="edit_psword">        <li>          <label class="txt" for="">续费时长:</label>          <span class="renewals"></span>          <p id="payCbsDiff" style="display: none;margin-top:10px;">            <label class="form-ctrl-label">              <input type="checkbox" checked class="tc-15-checkbox">同时续费实例挂载的云硬盘              <i class="plaint-icon" data-title="为避免预付费（包年包月）的实例与云硬盘到期时间不一致，导致欠费隔离时影响实例运行，建议您启用实例关联云硬盘的关联续费功能，将自动为您对齐实例与云硬盘的到期时间。"></i>            </label>          </p>          <p id="payCbsDiffWarn" class="text-weak text-danger" style="display: none;">当实例与云硬盘的到期回收时间不一致时，云硬盘欠费时会被隔离，中断业务。</p>        </li>        <% if (upgradeBandwidth) { %>        <li>          <label class="txt" for="">调整带宽:</label>          <span class="rerange-ctrl" style="display:none">            <span class="inf">当前带宽              <%-bandwidth%>Mbps</span>            <a href="javascript:;" class=\'set-bandwidth\'>调整带宽</a>          </span>          <div class="rerange-wrapper">            <div class="rerange-inner-wrapper"></div>            <span style="color:#ff7a22">调整后的带宽将于              <%- expiredTimeNext %>之后生效</span>          </div>          <p class="tip"></p>        </li>        <% } %>        <li>          <label class="txt" for="" data-field="pricetitle">费用:</label>          <span class="price">            <span data-field="cost"></span>            <em>元</em>          </span>          <span data-discount style="display: none;">            <span data-field="origin-cost" class="original-cost"></span>          </span>        </li>        <%-activity%>      </ul>    </div>  </div>',config:'  <div class="cvm-renew-config-table">    <div class="act-summary" style="margin-bottom:10px">      您已选      <strong>1台实例</strong>，      <a href="javascript:;" data-event="s_show_detail">查看详情        <i id="selectedShowIconArr" class="blue-down-icon"></i>      </a>    </div>    <div class="tc-15-table-panel" id="selectedShowDetail" style="margin-bottom:20px">      <div class="tc-15-table-fixed-head">        <table class="tc-15-table-box">          <colgroup>            <col>            <col style="width: 37%;">            <col>            <col>            <col>          </colgroup>          <thead>            <tr>              <th>                <div>                  <span class="text-overflow">续费实例</span>                </div>                <i class="resize-line-icon"></i>              </th>              <th>                <div>                  <span class="text-overflow">配置</span>                </div>                <i class="resize-line-icon"></i>              </th>              <th>                <div>                  <span class="text-overflow">到期时间</span>                </div>                <i class="resize-line-icon"></i>              </th>              <th>                <div>                  <span class="text-overflow">续费后到期日</span>                </div>              </th>              <th>                <div>                  <div class="text-overflow">折扣                    <div class="tc-15-bubble-icon">                      <i class="tc-icon icon-help"></i>                      <div class="tc-15-bubble tc-15-bubble-left">                        <div class="tc-15-bubble-inner" style="padding: 4px">                          <a target="_blank" href="//cloud.tencent.com/document/product/213/2176">折扣详情</a>                        </div>                      </div>                    </div>                  </div>                </div>              </th>            </tr>          </thead>        </table>      </div>      <div class="tc-15-table-fixed-body">        <table class="tc-15-table-box tc-15-table-rowhover">          <colgroup>            <col>            <col style="width: 37%;">            <col>            <col>            <col>          </colgroup>          <tbody>            <tr>              <td>                <div>                  <p class="text-overflow" title={{alias}}>实例：{{alias}}</p>                  <p class="text-overflow" title={{netName}}>所属网络：{{netName}}</p>                  <p class="text-overflow">内网IP：{{deviceLanIp}}</p>                </div>              </td>              <td>                <div class="text-overflow">                  <p>机型：{{instanceTypeDesc}}，{{cpuInfo}}CPU，{{memInfo}}内存</p>                  <p>系统盘：{{systemDisk.diskSize}}GB(                    <a b-if="systemDisk.diskId" href="/cvm/cbs/detail?diskId={{systemDisk.diskId}}&rid={{regionId}}"                      target="_blank">{{systemDisk.diskId}}</a>                    <span b-if="!systemDisk.diskId">{{systemDisk.diskTypeName}}</span>)</p>                  <p b-repeat="cbsItem in dataDisks">数据盘：                    <span>                      {{cbsItem.diskSize}}GB (                      <a b-if="cbsItem.diskId" href="/cvm/cbs/detail?diskId={{cbsItem.diskId}}&rid={{regionId}}" target="_blank">{{cbsItem.diskId}}</a>                      <span b-if="!cbsItem.diskId">{{cbsItem.diskTypeName}}</span>)                    </span>                  </p>                  <p>带宽：{{bandwidthInfo}}({{networkPayModeDesc}})</p>                </div>              </td>              <td>                <div class="">                  {{expiredTimeDesc}}                </div>              </td>              <td>                <div class="">                  <span class="text-overflow text-warning">{{renewExpiredTime||\'-\'}}</span>                </div>              </td>              <td>                <div class="">                  <span b-if="discountInfo" class="text-overflow text-danger">{{discountInfo}}</span>                  <span b-if="!discountInfo" class="text-overflow">无</span>                </div>              </td>            </tr>          </tbody>        </table>      </div>    </div>  </div>'},u=65535,v=600,w=function(a){m.call(this,a)},x=function(){};x.prototype=m.prototype,w.prototype=new x,w.prototype.constructor=w,w.prototype.superclass=m,w.prototype.exec=function(){var a=this,b=this.isRecycle;if(this.hasPermItems.forEach(function(b){l.isPrepaidPayMode(b.instanceChargeType)?a.isPrepay=!0:l.isSecondPayMode(b.instanceChargeType)&&(a.isSecondpay=!0)}),this.isSecondpay){var m=new s({listIns:this.listIns});return m.hasPermItems=this.hasPermItems,m.isRecycle=this.isRecycle,m.selectedItems=this.hasPermItems,m.selectedShowOptions=this.selectedShowOptions,m.isRecycle=!0,m.isSecondpay=a.isSecondpay,void m.exec()}if(this.hasPermItems.length>1){var w=new n({listIns:this.listIns,button:this.button,selectedItems:this.selectedItems,isRecycle:b});return w.hasPermItems=this.hasPermItems,w.isPrepay=a.isPrepay,void w.exec()}d=p.init(c.id,"kennyang"),d&&d.renderBefore();var x=this.hasPermItems[0],y=this.checkCanUpgradeBandwidth(x),z="",A=0,B=l.isGpu(x.instanceType);A=B?3:12;var C=h.tmpl(t.main,{isPrepay:a.isPrepay,isRecycle:b,expires:this.getExpires(this.hasPermItems[0].expiredTime,A),upgradeBandwidth:y,bandwidth:x.bandwidth,expiredTime:x.expiredTime,expiredTimeNext:this.getNextDay(),activity:z});g.create(C,"890","",{title:b?"恢复实例":"实例续费",preventResubmit:!0,button:{" 确定 ":function(){null!==a.orderParams&&a.toRenew(a.orderParams)}}}),this.renewConfigInfoBee=new Bee({$tpl:t.config,$data:x}),k.render({tpl:this.renewConfigInfoBee.$el,hasPermItems:this.hasPermItems,renderTo:"#instance-list"}),this.wrapper=g.el.find(".renew-wrapper"),this.renewals=this.wrapper.find(".renewals"),this.cbsDiff=g.el.find("#payCbsDiff"),this.timePills=new j({renderTo:g.el.find(".renewals"),showDiscountIcon:!1,defaultTriggerChange:!1,showOtherTime:!0,change:function(b){var c=b;a.renewConfigInfoBee.$set("renewExpiredTime",a.getExpires(a.hasPermItems[0].expiredTime,parseInt(c)));var d=l.getInstanceDiscount(a.hasPermItems[0].regionId,x.instanceFamily,b);a.renewConfigInfoBee.$set("discountInfo",d),a.setPrice()},discountHandler:function(a,b){return b.call(this,{list:a,regionId:x.regionId,instanceFamilies:[x.instanceFamily]})}});var D=this.timePills.getActiveObj();if(this.timePills.select(D),this.timePills.change(D),y)if(this.rerangeCtrl=this.wrapper.find(".rerange-ctrl"),this.setBandwidth=this.rerangeCtrl.find(".set-bandwidth"),this.rerangeWrapper=this.wrapper.find(".rerange-wrapper"),this.rerangeInnerWrapper=this.rerangeWrapper.find(".rerange-inner-wrapper"),l.isBandwidthPrepaidPayMode(x.internetAccessible.internetChargeType)){var E=o.NETWORK_PAYMODE_VPC[x.internetAccessible.internetChargeType],F=function(a,b,c){var d=[.25,.5,.75,1];return d.map(function(e,f){return{value:Math.max(b,e*c),width:a/d.length*(f+1)}})};r.apiRequest({action:"DescribeBandwidthAttribute",serviceType:"vpc",regionId:x.regionId,data:{NetworkPayMode:[E],ZoneId:x.zoneId}},{v3:!0}).then(function(b){var c=b&&b.response&&b.response.bandwidthAttribute,d=c&&c.find(function(a){return a.cvmPayMode.indexOf(x.instanceChargeType)>-1&&(!a.cpu||!a.cpu.length||x.cpu>=a.Cpu[0]&&(-1==a.Cpu[1]||x.cpu<=a.Cpu[1]))}),e=d&&d.bandwidthUpper,f=0,g=F(v,f,e);a.bandWidthRange=new i({renderTo:a.rerangeInnerWrapper,value:x.bandwidth==u?0:x.bandwidth,min:f,max:e,unit:"Mbps",section:g,step:1,width:v,change:function(b){0==b&&q.show({range:a.bandWidthRange}),a.setPrice()}})})}else this.bandWidthRange=new i({renderTo:this.rerangeInnerWrapper,value:x.bandwidth==u?0:x.bandwidth,change:function(b){0==b&&q.show({range:a.bandWidthRange}),a.setPrice()}});else this.bandWidthRange=null;this.bindEvt(),a.setPrice(),f.getComData(function(a){a.isAgentClient||a.isAgentClient||e("#actLink99").show()}),this.cbsDiff.find("input").click(function(){a.setPrice()})},w.prototype.bindEvt=function(){var a=this;if(this.bandWidthRange){var b=this.setBandwidth;b.on("click",function(){a.rerangeCtrl.hide(),a.rerangeWrapper.show()})}a.timePills&&e("#otherTimeSpan").on("click",function(){this.remove(),a.timePills.setData(a.getAllTimeSpanData())})},w.prototype.setPrice=function(){this.orderParams=null;var a=this;this.queryPrice(function(b){var c=a.cbsDiff.find("input").is(":checked");b.needAlign?(a.cbsDiff.show(),c?g.el.find("#payCbsDiffWarn").hide():g.el.find("#payCbsDiffWarn").show()):(a.cbsDiff.hide(),g.el.find("#payCbsDiffWarn").hide());var d=a.wrapper.find('[data-field="cost"]'),e=a.wrapper.find("[data-discount]");d.html(b.discountPrice),b.originPrice&&b.originPrice!==b.discountPrice?(a.wrapper.find('[data-field="origin-cost"]').html(b.originPrice+" 元 "),a.wrapper.find("[data-field=pricetitle]").text("优惠价:"),e.show()):(a.wrapper.find("[data-field=pricetitle]").text("费用:"),e.hide()),a.orderParams=b.orderParams,g.toggleBtnDisable(!1)})},w.prototype.checkCanUpgradeBandwidth=function(a){var b=!1;return this.isOperable("UPGRADEBANDWIDTH")&&!this.listIns.isBandwidthPackageUser&&l.isBandwidthPrepaidPayMode(a.internetAccessible.internetChargeType)&&(this.listIns.isNetworkShiftUpUser?!a.eipInfo&&a.deviceWanIp&&(b=!0):b=!0),b},c.exports=w}),define("cvm/cvm/event/renew/renew_base",function(a,b,c){var d=a("$"),e=a("manager"),f=(a("lib/Class"),a("cvm/cvm/event/operate_base")),g=a("appUtil"),h=a("cvm/common/model"),i=a("cvm/cvm/cvmutil"),j=(a("util"),a("cvm/cbs2/cbsutil"),a("cvm/cvm/data")),k=a("cvm/common/constants"),l=a("cvm/cbs2/data"),m=(a("dialog"),a("models/iaas")),n=function(a){a=d.extend({},{listIns:{},button:d(),selectedItems:[]},a),f.call(this,a)},o=function(){};o.prototype=f.prototype,n.prototype=new o,n.prototype.constructor=n,n.prototype.setPrice=function(a,b){return h.apiRequest({serviceType:"cvm",action:"InquiryPriceRenewInstances",data:a,regionId:b})},n.prototype.toRenew=function(a){var b=this,c=this.hasPermItems;e.getAllWhiteList(function(d){var e=d.CVM_ORDER_APIV3TOV2&&d.CVM_ORDER_APIV3TOV2.length;if(e){var f=a[0];f.Version="2017-03-12",m.apiRequest({serviceType:"cvm",action:"SwitchParameterRenewInstances",data:f,regionId:c[0].regionId}).then(function(c){a=c.Response.InstanceOrder.goods,b.toPay2(a)})["catch"](function(a){console.warn(a)})}else b.toPay2(a)})},n.prototype.getNextDay=function(){var a=this.hasPermItems[0].expiredTime||this.hasPermItems[0].deadline;if(!a)return"";var b=new Date(new Date(a).getTime()+864e5);return g.formatDate(b,"yyyy-MM-dd")+" 00:00:00"},n.prototype.getExpires=function(a,b){return e.getNextDate(a,parseInt(b))},n.prototype.getInputData=function(){var a={timespan:this.timePills.val()};this.bandWidthRange&&(a.bandwidth=this.bandWidthRange.val()),this.listIns.isBandwidthPackageUser&&(a.bandwidth=65535);var b=this.cbsDiff.find("input").is(":checked");return a.alignToCvmFlag=b,a},n.prototype.queryPrice=function(a){var b=this,c=this.hasPermItems,d=c[0].regionId,e=c.map(function(a){return a.uInstanceId}),f=this.getInputData(),g=!1,h=!0;return c.forEach(function(a){a.internetAccessible.internetMaxBandwidthOut!=f.bandwidth&&(g=!0),a.internetAccessible.internetChargeType!=k.NETWORKPAYMODE.BANDWIDTH_PREPAID&&(h=!1)}),this.getCbsDiffData().then(function(c){var i={instanceIds:e,instanceChargePrepaid:{period:f.timespan},renewPortableDataDisk:!0};if((b.canUpgradeBandwidth||g&&h&&/^\d+$/.test(f.bandwidth))&&(i.internetAccessible={internetMaxBandwidthOut:f.bandwidth}),c&&c.portableStorageIds&&c.portableStorageIds.length){i.renewPortableDataDisk=f.alignToCvmFlag;var j=[b.superclass.prototype.setPrice(i,d),l.getRenewDiskOrderParams({regionId:d,diskIds:c.portableStorageIds,diskChargePrepaids:c.cbsQueryPriceParams})]}else{i.renewPortableDataDisk=!1;var j=[b.superclass.prototype.setPrice(i,d)]}Promise.all(j).then(function(c){var d=c[0],e=c[1],f=d&&d.response&&d.response.price||{},g=e&&e.response||{},h={origin:f.instancePrice&&f.instancePrice.originalPrice,discount:f.instancePrice&&f.instancePrice.discountPrice},j=f.bandwidthPrice&&f.bandwidthPrice.prepaidPrice,k=b.addPrice(h.discount,j),l=h.origin.toFixed(2),m=g.needAlignWithInstance,n=b.collectData(i.renewPortableDataDisk);a&&a({originPrice:l,discountPrice:k,needAlign:m,orderParams:n})})})},n.prototype.getCbsDiffData=function(){var a,b=this,c=(this.timePills.val(),[]),d=[],e=[],f=[];return this.hasPermItems.forEach(function(b){f.push(b.instanceId),a=b.regionId}),j.queryCbs({uInstanceIds:f,limit:1,offset:0,regionId:a}).then(function(a){var f=b.getInputData(),h=a.cbss&&a.cbss.nodes?a.cbss.nodes:[],j=i.arr2Map(h,"uInstanceId",!0);return b.hasPermItems.forEach(function(a){a.cbsList=j[a.instanceId||a.uInstanceId]||a.cbsList;var b=a.expiredTime||a.deadline;a.cbsList.forEach(function(a){if(a.portable&&"prePay"==a.payMode){var h=a.diskId||a.cbsInstanceId;c.push(h),d.push(a);var i={period:f.timespan,curInstanceDeadline:g.formatDate(new Date(b),"yyyy-MM-dd hh:mm:ss")};e.push(i)}})}),c.length?{portableStorageIds:c,cbsQueryPriceParams:e}:null})},n.prototype.collectData=function(a){var b,c,d=this,e=this.getInputData(),f=[],g=[];return this.hasPermItems.forEach(function(a){f.push(a.uInstanceId);var c=[{name:"项目",value:a.projectName},{name:"实例名",value:a.uInstanceId},{name:"内网IP",value:a.deviceLanIp},{name:"所属网络",value:a.netName},{name:"可用区",value:a.zoneName}];if("undefined"!=typeof a.internetAccessible&&i.isBandwidthPrepaidPayMode(a.internetAccessible.internetChargeType)&&!d.listIns.isBandwidthPackageUser||"undefined"==typeof a.internetAccessible&&1==a.networkPayMode&&!d.listIns.isBandwidthPackageUser){var h=a.bandwidth;"undefined"!=typeof e.bandwidth&&(h=e.bandwidth),c.push({name:"带宽",value:a.bandwidth+"=>"+h})}g.push(c),b||(b=i.getRegion(a.regionId))}),c={InstanceIds:f,InstanceChargePrepaid:{Period:e.timespan},renewPortableDataDisk:!!a},d.listIns.isBandwidthPackageUser||"undefined"==typeof e.bandwidth||(c.InternetAccessible={InternetMaxBandwidthOut:e.bandwidth}),[c]},n.prototype.getTimeSpanData=function(a){if(a){for(var b=[],c=1;6>c;c++)b.push({name:c,value:c});return b}for(var b=[],c=1;3>=c;c++)b.push({name:c,value:c});return b.concat([{name:"半年",value:"6",ico:"icon-hui",iconVal:"88折"},{name:"1年",value:"12",ico:"ico ico_join icon-hui",iconVal:"83折"},{name:"2年",value:"24",ico:"ico ico_join icon-hui",iconVal:"7折"},{name:"3年",value:"36",ico:"ico ico_join icon-hui",iconVal:"5折"},{name:"4年",value:"48",ico:"ico ico_join icon-hui",iconVal:"5折"},{name:"5年",value:"60",ico:"ico ico_join icon-hui",iconVal:"5折"}])},n.prototype.getAllTimeSpanData=function(){var a=[],b=0;for(b=1;5>=b;b++)a.push({name:b,value:b});for(b=6;11>=b;b++)a.push({name:b,value:b,ico:"icon-hui",iconVal:"88折"});return a.concat([{name:"1年",value:"12",ico:"ico ico_join icon-hui",iconVal:"83折"},{name:"2年",value:"24",ico:"ico ico_join icon-hui",iconVal:"7折"},{name:"3年",value:"36",ico:"ico ico_join icon-hui",iconVal:"5折"},{name:"4年",value:"48",ico:"ico ico_join icon-hui",iconVal:"5折"},{name:"5年",value:"60",ico:"ico ico_join icon-hui",iconVal:"5折"}])},n.prototype.addPrice=function(){var a=[].slice.call(arguments),b=0;return a.forEach(function(a){isNaN(a)||(b+=100*a)}),(b/100).toFixed(2)},c.exports=n}),define("cvm/cvm/event/renew/renew_batch",function(a,b,c){var d,e=a("$"),f=a("tips"),g=a("qccomponent"),h=(a("manager"),a("dialog")),i=a("util"),j=a("appUtil"),k=(a("widget/range/range"),a("widget/pills/pills"),a("cvm/common/components/TimePill/timePill")),l=a("cvm/cvm/cvmutil"),m=a("cvm/cvm/event/renew/renew_base"),n=a("cvm/common/renderMonitor"),o=(a("cvm/common/constants"),{main:'  <div class="renewal-wrapper">      <% if (isRecycle) { %>     <div class="tc-15-msg">            <p>您需要通过续费来恢复实例，恢复后将保持原配置。</p>            <p>续费恢复后，与实例关联的负载均衡、弹性云盘、基础网络互通将不恢复，需要您重新配置。</p>            <p>支付成功后，以上设备将恢复到左侧【实例】栏目</p>            <p>显示的时长折扣只代表当前所有实例里的最高折扣。</p>         </div>     <% } %>    <div class="renewal-hints">      <p>        <strong>下列设备（共<%=len%>项）将进行续费操作</strong>      </p>    </div>    <div id="renewList" style="position:relative;" class="mb-20"></div>    <ul class="form-list renewal-form">        <li>          <div class="form-label">            <span class="label">购买时长</span>          </div>          <div class="form-input">            <span class="renewals">            </span>            <p id="payCbsDiff" style="display: none;">              <label class="form-ctrl-label">                <input type="checkbox" checked class="tc-15-checkbox">同时续费实例挂载的云硬盘                <i class="plaint-icon" data-title="为避免预付费（包年包月）的实例与云硬盘到期时间不一致，导致欠费隔离时影响实例运行，建议您启用实例关联云硬盘的关联续费功能，将自动为您对齐实例与云硬盘的到期时间。"></i>              </label>            </p>            <p id="payCbsDiffWarn" class="text-weak text-danger" style="display: none;">当实例与云硬盘的到期回收时间不一致时，云硬盘欠费时会被隔离，中断业务。</p>          </div>        </li>      </ul>    <!-- 总价 -->    <div class="total-price clearfix">      <div class="pull-right">        <em class="gray-text">总计费用</em>&nbsp;&nbsp;        <span class="org-text" id="loading">          正在计算价格          <span class="percent"></span>...        </span>        <span title="优惠价">          <span style="display:none;" class="cost">            <span id="realcost"></span>            <em>元</em>          </span>          <span style="display:none;text-decoration:line-through;margin-left:10px;color:#74777c;" title="原价">            <span id="totalCost"></span>            <em>元</em>          </span>        </span>      </div>    </div>  </div>'}),p=function(a){m.call(this,a),this.isRecycle=a&&a.isRecycle},q=function(){};q.prototype=m.prototype,p.prototype=new q,p.prototype.constructor=p,p.prototype.superclass=m,p.prototype.exec=function(){if(this.check()){d=n.init(c.id,"kennyang"),d&&d.renderBefore();var a=this,b=this.hasPermItems[0],f=this.isRecycle,g=i.tmpl(o.main,{len:this.hasPermItems.length,isRecycle:f});h.create(g,"800","",{title:f?"恢复实例":"实例续费",preventResubmit:!0,button:{" 确定 ":function(){null!==a.orderParams&&a.toRenew(a.orderParams)}}}),this.wrapper=h.el.find(".renewal-wrapper"),this.renewals=this.wrapper.find(".renewals"),this.cbsDiff=h.el.find("#payCbsDiff");var j=(this.hasPermItems||[]).map(function(a){return a.instanceFamily});a.timePills=new k({renderTo:a.renewals,showDiscountIcon:!1,newMode:!0,showOtherTime:!0,change:function(){var b=this.val(),c=a.renewals.find("button");c.each(function(){var a=e(this),c=a.data("value"),d=a.find("span");e(this).data("value")<=11&&(c==b?d.text(c+"个月"):d.text(c))}),a.refreshDevice()},discountHandler:function(a,c){return c.call(this,{list:a,regionId:b.regionId,instanceFamilies:j})}}),this.renderDeviceList(),this.bandWidthRange=null,this.cbsDiff.find("input").click(function(){a.setPrice()}),a.timePills&&e("#otherTimeSpan").on("click",function(){this.remove(),a.timePills.setData(a.getAllTimeSpanData())})}},p.prototype.check=function(){for(var a=this.hasPermItems,b=!1,c=!1,d=0;d<a.length;d++)if(l.isGpu(a[d].instanceType)){if(c)return f.flash("不支持GPU机型和其他机型混合续费"),!1;b=!0}else{if(b)return f.flash("不支持GPU机型和其他机型混合续费"),!1;c=!0}return a.length>100?(f.flash("一次最多支持100台实例批量续费"),!1):!0},p.prototype.renderDeviceList=function(){var a=this,b={$data:{showPagination:!1,showState:!1,canSelectTotal:!1,hasFirst:!1,maxHeight:150,minHeight:"auto",colums:[{key:"alias",name:"待续费项",minWidth:200,tdTpl:'<div><div><p class="text-overflow" title="{{item.alias}}">实例：{{item.alias}}</p><p class="text-overflow text-weak" title="所属网络：{{item.netName}}，内网IP：{{item.deviceLanIp}}">所属网络：{{item.netName}}，内网IP：{{item.deviceLanIp}}</p></div></div>'},{key:"config",name:"实例规格",width:100},{key:"bandwidth",name:"续费带宽",width:75},{key:"expiredTime",name:"到期时间",width:100},{key:"nextLine",name:"续费后到期时间",width:110},{key:"discount",name:"折扣",thTpl:'<div>                折扣                <div class="tc-15-bubble-icon">                  <i class="tc-icon icon-help"></i>                  <div class="tc-15-bubble tc-15-bubble-left">                    <div class="tc-15-bubble-inner" style="padding: 4px">                      <a target="_blank" href="//cloud.tencent.com/document/product/213/2176">折扣详情</a>                    </div>                  </div>                </div>              </div>',width:120}],autoMaxHeight:!1,maxHeightOffset:10},getCellContent:function(b,c,d){if("config"==d.key)return"<div><p title="+c.instanceTypeDesc+">"+c.instanceTypeDesc+"</p><p>"+c.cpuInfo+"，"+c.memInfo+"</p></div>";if("bandwidth"==d.key)return"<div>"+c.bandwidthInfo+"</div>";if("expiredTime"==d.key)return c.uHostId?"<div>不计费</div>":"<div>"+j.formatDate(new Date(c.expiredTime),"yyyy-MM-dd")+"</div>";if("nextLine"==d.key)return c.uHostId?"<div>不计费</div>":'<div class="text-warning">'+a.getExpires(c.expiredTime,a.getInputData().timespan)+"</div>";if("discount"===d.key){var e=a.getInputData().timespan,f=l.getInstanceDiscount(c.regionId,c.instanceFamily,e);return f?'<div class="text-danger">'+f+"</div>":"<div>无</div>"}},events:{},getData:function(a){}},c=g.getComponent("grid-view");this.gridView=new c(b),e("#renewList").append(this.gridView.$el),this.refreshDevice()},p.prototype.refreshDevice=function(){this.gridView.setData({list:this.hasPermItems}),this.cdhOnly||this.setPrice(),h&&h.center()},p.prototype.setPrice=function(){this.orderParams=null;var a=this;this.queryPrice(function(b){var c=a.cbsDiff.find("input").is(":checked");b.needAlign?(a.cbsDiff.show(),c?h.el.find("#payCbsDiffWarn").hide():h.el.find("#payCbsDiffWarn").show()):(a.cbsDiff.hide(),h.el.find("#payCbsDiffWarn").hide()),e("#loading").hide(),e("#realcost").text(b.discountPrice).parent().show(),e("#totalCost").text(b.originPrice).parent().show(),a.orderParams=b.orderParams,h.toggleBtnDisable(!1)})},c.exports=p}),define("cvm/cvm/event/resetos/imageApi",function(a,b,c){var d=a("manager"),e=(a("models/api"),a("modules/cvm/image/util")),f=e.TYPES,g=a("cvm/common/model"),h=a("models/iaas"),i=a("cvm/image/util");b.queryPublicImage=function(a){return g.apiRequest({regionId:a.regionId,serviceType:"image",action:"DescribeImages",data:{InstanceType:a.instanceType,Limit:200,Filters:[{name:"image-type",values:[i.TYPES.PUBLIC]}]}}).then(function(a){a=a.response;var b=a.imageSet||[];return b.map(function(a){return Object.assign(a,{flags:a.flags,_imageType:f.PUBLIC,imgId:a.imageId,label:a.osName,desc:a.osName,osName:a.osKey,rootSize:a.imageSize,osType:/Xserver|windows/.test(a.osKey)?"windows":"linux",is32bit:/(32位|32bit)/i.test(a.osName)})})})},b.queryPublicImageMap=function(){return a("widget/getOsName/getOsName").promise.then(function(a){var b={};return a.data.os.forEach(function(a){b[a.name]=a}),b})},b.queryImage=function(a,c){var d={1:"PRIVATE",2:"PUBLIC",4:"SHARED"};return Promise.all([g.apiRequest({regionId:a,serviceType:"image",cmd:"DescribeImages",data:{Filters:[{name:"image-type",values:[i.TYPES[d[c]]]},{name:"image-state",values:["NORMAL","USING"]}],Limit:200}}),b.queryPublicImageMap()]).then(function(a){var b=a[0].response,d=a[1],e=b.imageSet||[];return e.map(function(a){var b=d[a.osKey]||{};return $.extend({},a,{_imageType:c,imgId:a.imageId,osName:a.osKey,label:a.imageId+" | "+a.imageName+" | "+a.osName,osType:b.osType||(/Xserver|windows/.test(a.osKey)?"windows":"linux"),desc:b.desc,rootSize:a.imageSize,is32bit:b.is32bit})})})},b.queryMarketCategories=function(){var a;return function(){return a||(a=h.apiRequest({serviceType:"market",action:"DescribeCategoryTree",data:{DeliverType:"IMAGE",CateId:1001,Version:"2018-06-01"}}).then(function(a){var b=a.Response.CateSets,c=void 0===b?[]:b;return c.map(function(a){return{label:a.CateName,value:a.CateId}})}))}}(),b.queryMarketImage=function(a,c,e){var g=e.whitelists,i=void 0===g?{}:g;if(!a)return Promise.resolve([]);var j=[b.queryPublicImageMap()];return i.UsingNewOperationValidator?j.unshift(h.apiRequest({serviceType:"market",action:"DescribeImages",data:{IsvInfo:"SIMPLE",CategoryId:a,CpuType:c.cpu,MemType:c.mem,Limit:100,Offset:0,Version:"2018-06-01"},regionId:c.regionId}).then(function(a){var b=a.Response.ImageSet,c=void 0===b?[]:b;return{list:c}})):j.unshift(new Promise(function(b,e){d.getImageProductsDetail({regionId:c.regionId,categoryId:a,cputype:c.cpu,memtype:c.mem,count:999,startIndex:0},b,e)})),Promise.all(j).then(function(a){var b=_slicedToArray(a,2),c=b[0].list,d=void 0===c?[]:c,e=b[1];return d.map(function(a){var b=a.imgs&&a.imgs[0]||{},c=e[a.OsKey]||e[b.os]||{};return Object.assign(a,{unImgId:a.UnImgId||b.unImgId,imageName:a.ImageName||a.productName,spaceRequire:a.SpaceRequire||b.spaceRequire,software:a.Software||b.software,_imageType:f.MARKET,label:a.ImageName||a.productName,osType:c.osType||(1===a.OsType||1===b.osType?"linux":"windows"),osName:a.OsKey||b.os,desc:c.desc||a.OsKey||b.os,rootSize:+a.SpaceRequire||+b.spaceRequire,is32bit:c.is32bit,companyName:a.developer&&a.developer.companyName})})})}}),define("cvm/cvm/event/resetos/ImageDropdown",function(a,b,c){var d=a("qccomponent");c.exports=d.extend({$tpl:'<div><select b-model="value" class="tc-15-select m {{cls}}" b-style="style"><option b-repeat="item in list" value="{{item.value}}" disabled?="item.image.$disabled" title?="item.image.$disabled" selected?="value===item.value">{{item.label}}</option><option b-if="list && !list.length">{{emptyTips}}</option><option b-if="!list">加载中...</option></select></div>',$valuekey:"image",$afterInit:function(){this.$watch("[list, value]",function(){var a,b=this.value,c=this.list||[];c.some(function(c){return""+c.value==""+b?(a=c.image,!0):void 0});var d=this.image||{};a&&d.imgId!==a.imgId&&this.$set("image",a)})}},{defaults:{emptyTips:"您在当前地域没有适合此机器的镜像"}})}),define("cvm/cvm/event/resetos/resetos",function(a,b,c){function d(a,b){return function(c){var d=b(c);return"string"==typeof d?d||a(c):d&&a(c)}}function e(a,b){return function(c){return a(c)&&b(c)}}function f(a,b){return b}function g(a){return(a||"").toLowerCase()}var h,i=a("$"),j=a("manager"),k=a("qccomponent"),l=a("dialog"),m=a("util"),n=a("appUtil"),o=a("tips"),p=a("models/iaas"),q=a("reporter"),r=a("cvm/common/constants"),s=a("modules/cvm/image/util"),t=a("modules/cvm/diskUtil"),u=a("./imageApi"),v=a("./validator"),w=a("widget/page/makeAsyncDialogButton"),x=a("cvm/cvm/cvmutil"),y=a("cvm/cvm/event/operate_base"),z=a("cvm/cbs2/cbsutil"),A=a("cvm/common/model"),B=a("cvm/cvm/data"),C=a("cvm/cbs2/data"),D=a("cvm/common/renderMonitor"),E=a("widget/mfa/mfa"),F=n.isI18n(),G=t.TYPE,H=s.TYPES,I={Password:1,SSH:2,KeepSetting:3},J=!1,K={},L=[31,32,34],M={isOversea:"_checkOverseasRegion(instance.regionId)",isRegionWithoutMarketImage:"_checkRegionWithoutMarketImage(instance.regionId)",isSupportLargerSystemCbs:"_checkLargerSystemCbs()",isBM:"_isBM(instance.instanceFamily)",isGpu:"_isGpu(instance.instanceFamily)",isGpuN8:"_isGpuN8(instance.instanceFamily)",isFpga:"_isFpga(instance.instanceFamily)",isGpuAmd:"_isGpuAmd(instance.instanceFamily)",isLocalDisk:"_isLocalDiskType(instance.systemDisk.storageType)",isCbsDisk:"!_isLocalDiskType(instance.systemDisk.storageType)",osType:"instance.osType",isWindows:'osType === "windows"',isLinux:'osType === "linux"',mem:"_getActualMem(instance.mem, instance.instanceFamily)",rootSize:"_getSystemDiskSize(instance)",targetImage:"_getTargetImage(imageType, publicImage, privateImage, sharedImage, marketImage)",targetOsType:"targetImage.osType",isTargetWindows:'targetOsType === "windows"',isTargetLinux:'targetOsType === "linux"',sysprep:"targetImage.sysprep",isSwitchSystem:"osType !== targetOsType",isOldCbs:"_checkOldCbs(instance.cbsList)",isMiniCvm:"_checkMiniCvm(instance.instanceFamily)",isXen:"instance.hypervisor != 0 && instance.hypervisor != 2",canXenToKvm:"instance.canUpgradeToKvm",canAdjustDisk:"!policy.fixedRootSize && policy.minRootSize<policy.maxRootSize",loginTypeList:"_getLoginType(targetOsType, imageType, sysprep)",loginName:"_getLoginName(targetOsType, targetImage.osName)",keepCurrentImage:"!imageType",resetFlag:"keepCurrentImage ? 0 : 2"},N='当前实例系统盘为本地盘，且容量为{{_getSystemDiskSize(instance)}}G，所选镜像要求系统盘不小于50G，如有需求请<a data-event="nav" href="/workorder">提交工单</a>，进行实例升级。',O='因云盘架构升级，检测到当前CVM为{{capitalize(osType)}}，<span style="color:#ff0000;">仅限重装为{{capitalize(osType)}}</span>，重装为{{capitalize(targetOsType)}}需<a data-event="nav" href="/workorder">提工单</a>',P=!0,Q=v.passwordTip,R="注意：您的密码已经符合设置密码规则，但密码需要具备一定的强度，建议您设置12位以上，至少包括4项（[a-z],[A-Z],[0-9]和[()`~!@#$%^&*-+=_|{}[]:;'<>,.?/]的特殊符号]），每种字符大于等于2位且不能相同的密码。",S={
targetImage:{},"true":{freeRootSize:t.FREE_ROOT_SIZE,maxRootSize:t.FREE_ROOT_SIZE,topTip:'  <p>注意：重装后，实例系统盘内的所有数据将被清除，恢复到初始状态。</p>  <p>    1.请在操作前通过制作快照或镜像做好相关备份，以免数据丢失给您造成损失，具体请参看    <a      data-event="just_for_hot"      data-hot="yunzhuji.chongzhuang.page3_normal.guide"      target="_blank"      href="//cloud.tencent.com/document/product/362/5755"      >操作指引</a    >  </p>  <p>    2.实例数据盘的数据不会清除，但重装后需要手动挂载才能使用，具体请参看    <a      data-event="just_for_hot"      data-hot="yunzhuji.chongzhuang.page3_normal.guide"      target="_blank"      href="{{ WikiUrls[osType] }}"      >操作指引</a    >  </p>'},"!priceFetched":{unsupported:!0},isSwitchSystem:{confirm:'  <style>    .confirmswapos li {      padding: 5px 0;      list-style-type: disc;      margin-left: 20px;    }  </style>  <ul class="confirmswapos">    <p>      注意：CVM原系统盘为{{ capitalize(osType) }}，重装为{{        capitalize(targetOsType)      }}后，请注意：    </p>    <li>您的原【系统盘】数据会丢失，重装后环境将变为您所选新镜像环境；</li>    <li>      关联的【数据盘】格式仍为{{        capitalize(osType)      }}系统格式，可使用工具读取【数据盘】数据后，再将盘格式化使用；    </li>    <li b-if="isTargetLinux">      相关工具的使用方式：      <a        href="http://www.qcloud.com/doc/product/213/Windows%E9%87%8D%E8%A3%85%E4%B8%BALinux%E5%90%8E%E8%AF%BB%E5%86%99%E5%8E%9FNTFS%E7%B1%BB%E5%9E%8B%E6%95%B0%E6%8D%AE%E7%9B%98"        target="_blank"        >工具链接</a      >；    </li>    <li b-if="isTargetWindows">      相关工具的使用方式：      <a        href="http://www.qcloud.com/doc/product/213/Linux%E9%87%8D%E8%A3%85%E4%B8%BAWindows%E5%90%8E%E8%AF%BB%E5%8F%96%E5%8E%9FEXT%E7%B1%BB%E5%9E%8B%E6%95%B0%E6%8D%AE%E7%9B%98"        target="_blank"        >工具链接</a      >；    </li>  </ul>'},isLocalDisk:{fixedRootSize:t.FREE_ROOT_SIZE},"isLocalDisk && isBM":{fixedRootSize:null},"isLocalDisk && isLinux":{imageFilter:function(a){return a._imageType===H.PUBLIC?!0:"linux"===a.osType||"本地盘暂不支持通过此镜像切换操作系统"}},"isLocalDisk && isWindows":{imageFilter:function(a){return a._imageType===H.PUBLIC?!0:"windows"===a.osType||"本地盘暂不支持通过此镜像切换操作系统"}},"mem < 2":{imageFilter:function(a){return!("windows"===a.osType&&"2016"==a.osVersion1)||"Windows 2016需要至少2G内存"}},"isLocalDisk && isLinux && _getSystemDiskSize(instance)<=20":{linuxMaxRootSize:20},"isLocalDisk && isLinux && isTargetLinux && _getSystemDiskSize(instance)<=20":{fixedRootSize:20},"isLocalDisk && isLinux && _getSystemDiskSize(instance)<50 && isTargetWindows":{topTip:N,imageFilter:function(a){return!("windows"===a.osType)||"当前CVM系统盘为本地盘，暂不允许重装为Windows"}},"isCbsDisk && isSupportLargerSystemCbs && whitelists.CBS_rootDisk_500":{maxRootSize:500},"isCbsDisk && isSupportLargerSystemCbs && whitelists.CBS_rootDisk_1024":{maxRootSize:1024},"[_getSystemDiskSize(instance), targetImage.rootSize]":function(){return{minRootSize:this.instance.systemDisk&&20==this.instance.systemDisk.diskSize?20:Math.max(this._getSystemDiskSize(this.instance),this.targetImage&&this.targetImage.rootSize||0)}},"isOldCbs && isTargetWindows":{topTip:'因云盘架构升级，<span style="color:#ff0000;">仅限重装为Linux</span>，重装为Windows需<a data-event="nav" href="/workorder">提工单</a>'},"isOldCbs && isLinux && isTargetWindows":{unsupported:P},isRegionWithoutMarketImage:{imageTypeFilter:function(a){return a!==H.MARKET}},"isOversea && (imageType!=0 || isSwitchSystem)":{topTip:'当前实例为{{capitalize(osType)}}操作系统，由于非中国大陆地区操作系统版权导致的价格差异，<span style="color:red">无法重装为{{capitalize(osType) == "Windows" ? "Linux": "Windows"}}</span>'},"isOversea && isLinux":{imageFilter:function(a){return"linux"===a.osType||"因版权原因，不支持互换操作系统"}},"isOversea && isWindows":{imageFilter:function(a){return"windows"===a.osType||"因版权原因，不支持互换操作系统"}},"!whitelists.windows2003_offline":{imageFilter:function(a){return!/windows2003/i.test(a.osName)||"Windows 2003已下线"}},"instance.zoneId == 100001 && isSwitchSystem":{topTip:O,unsupported:P},"isMiniCvm && [osType]":function(){var a=this.osType;return{imageFilter:function(b){return b.osType===a||"微型机无法更换操作系统"}}},"isXen && [canXenToKvm, imageType]":function(){switch(this.imageType){case H.PRIVATE:case H.SHARED:case H.MARKET:return{curImageTip:"xen子机自定义镜像直接不支持按当前重装",bottomTip:this.canXenToKvm?'  <div class="error_tip_box">    <p style="margin: 4px 0">      该实例技术架构老旧，要使用{{ ImageTypeNames[imageType] }}重装系统，请先      <a        href="javascript:;"        data-hot="yunzhuji.chongzhuang.page3_xen.switch_now"        data-event="xenToKvm"        >置换为新实例</a      >。    </p>  </div>':'  <div class="error_tip_box">    该实例暂不支持使用{{ ImageTypeNames[imageType] }}重装系统。  </div>',unsupported:!0}}},"isOldImageUnavailable && imageType==0 && !isCurrentInstanceImage":function(){return{curImageTip:"当前镜像"+(this.instance.deviceImageId>0?"已删除":"已下架"),unsupported:!0}},"imageType==0 && !!isCurrentInstanceImage":function(){return{topTip:'当前镜像是整机镜像，<span class="text-danger">暂不支持当前镜像重装</span>',unsupported:!0}},"imageType==1":{imageFilter:function(a){return"InstanceImage"!=a._ImageClass||"整机镜像暂不支持重装"}},"mem>4":{imageFilter:function(a){return"windows"===a.osType||a.is32bit!==!0||"32位Linux系统不支持大于4G内存"}},"!!whitelists.under_security_control":{imageTypeFilter:function(a){return a==H.PUBLIC||a==H.PRIVATE}},isBM:{imageTypeFilter:function(a){return a!==H.MARKET},imageFilter:function(a){return a.flags&&a.flags.find(function(a){return"SupportBMTag"==a})?!0:"当前机型不支持使用此镜像重装"}},isFpga:{fixedRootSize:100,imageFilter:function(a){return a._imageType!==H.PUBLIC?!0:/centos/i.test(a.osName)?-1!=a.osName.indexOf("fpga")||"FPGA机型不支持此操作系统":"FPGA机型不支持此操作系统"}},isGpuAmd:{imageFilter:function(a){return a._imageType!==H.PUBLIC?!0:a._imageType===H.PUBLIC&&/windows|xserver/i.test(a.osName)?a.osName&&-1!=a.osName.indexOf("Xserver V8.1_64")||"GPU渲染型机型不支持此操作系统":"GPU渲染型机型不支持此操作系统"}}},T={windowsMax:"policy.windowMaxRootSize || policy.fixedRootSize || policy.maxRootSize",linuxMax:"policy.linuxMaxRootSize || policy.fixedRootSize || policy.maxRootSize",filter:"policy.imageFilter"},U={topTip:f,curImageTip:f,bottomTip:f,unsupported:f,freeRootSize:Math.max,imageTypeFilter:e,minRootSize:Math.max,maxRootSize:Math.max,fixedRootSize:f,linuxMaxRootSize:Math.max,imageFilter:d},V=function(a,b){var c,d;return b&&(d={},b.forEach(function(a){d[a]=1})),a.filter(function(a){return a}).forEach(function(a){a&&(c?Object.keys(a).forEach(function(b){if(!d||b in d){var e,f=a[b];b in c&&(e=U[b])&&(f=e(c[b],f)),c[b]=f}}):c=i.extend({},a))}),c||{}},W=k.extend({capitalize:n.capitalize,_isBM:x.isBareMetalType,_isGpu:x.isGpu,_isGpuN8:x.isGpuN8,_isFpga:x.isFpga,_isGpuAmd:x.isGpuAmd,_isLocalDiskType:z.isLocalDiskType,_getSystemDiskSize:function(a){var b=a.systemDisk&&a.systemDisk.diskSize||0;return(a.cbsList||[]).forEach(function(a){"root"===a.diskType&&(b=a.diskSize)}),b},_checkOverseasRegion:x.isOverseaRegion,_checkRegionWithoutMarketImage:function(a){return L.indexOf(1*a)>-1||x.isOverseaRegion(a)},_checkLargerSystemCbs:function(a){return!!J},_getActualMem:function(a,b){return"v1.0.5"===b.toLowerCase()&&(a/=1024),a},_checkOldCbs:function(a){var b,c;return(a||[]).some(function(a){return"xvde"!==a.target||a.portable?void 0:(b=+a.hostBlockSize,c=+a.vmBlockSize,4096===b&&4096===c||512===b&&4096===c)})},_checkMiniCvm:function(a){return a=(a||"").toLowerCase(),"v1.1"===a||"v1.0.5"===a},assureSelected:function(a,b){var c=this;return function(d){var e,f=c.$get(a),g=d.filter(function(a){return!a.$disabled});return!g.some(function(a){return f===(b?a[b]:a)})&&(e=g[0])&&c.$set(a,b?e[b]:e),0===g.length&&c.$set(a,null),d}},$beforeInit:function(){W.__super__.$beforeInit.apply(this,arguments),this._initLogical(),this._initData(),this._preLoad(),this._initEvents()},_initLogical:function(){var a=this;Object.keys(M).forEach(function(b){n.beeBind(a,a,M[b],b)});var b=[],c={},d=function(d,e,f){var g=b[d];if(g!==e&&(i.extend(c,g,e),b[d]=e),!f){var h=Object.keys(c);if(h.length){c={};var j=V(b,h),k=a.policy;k||a.$set("policy",k={}),h.forEach(function(b){k[b]!==j[b]&&a.$set("policy."+b,j[b])})}}};Object.keys(S).forEach(function(b,c){var e,f=S[b];i.isPlainObject(f)&&(e=f),a.$watch(b,function(b){d(c,b?e||f.call(a):null,!a.targetImage)},!0)}),this.$set("imagePolicy",{}),Object.keys(T).forEach(function(b){n.beeBind(a,a,T[b],"imagePolicy."+b)})},_initData:function(){var a=this;a.$set("whitelists",{});var b=["windows2003_offline","CBS_rootDisk_500","CBS_rootDisk_1024","under_security_control","UsingNewOperationValidator"];j.queryWhiteList({whiteKey:b},function(c){b.forEach(function(a){c&&c[a]&&c[a].length&&(K[a]=!0)}),a.$set("whitelists",K)});var c=a.instance;A.apiRequest({action:"DescribeImages",serviceType:"cvm",data:{Filters:[{name:"image-id",values:[c.imageId]}]},regionId:c.regionId}).then(function(b){var c=b.response.imageSet||[];c.length&&"InstanceImage"==c[0]._ImageClass&&a.$set("isCurrentInstanceImage",!0)}),p.apiRequest({action:"ResetInstance",serviceType:"cvm",data:{InstanceId:c.instanceId,DryRun:!0,EnhancedService:{MonitorService:{Enabled:!0}}},regionId:c.regionId},{v3:!0,tipErr:!1})["catch"](function(b){"InvalidInstance.NotSupported"!==b.code&&o.error(b.message),a.$set("isOldImageUnavailable",!0)})},_preLoad:function(){var a=this,b=a.policy&&a.policy.imageTypeFilter;Object.keys(H).forEach(function(c){var d=H[c];if(!b||b(d))switch(d){case H.PUBLIC:a._queryPublicImage();break;case H.PRIVATE:a._queryPrivateImage();break;case H.SHARED:a._querySharedImage();break;case H.MARKET:a._queryMarketCategories().then(function(b){b[0]&&a._queryMarketImage(b[0].value)})}})},_initEvents:function(){this.$watch("resetPwd",function(a){a||(this.$set("resetConfirmPwd",""),this.$set("invalids.resetConfirmPwd",""))})},_getLoginType:function(a,b,c){return[{label:"密码",value:I.Password},{label:"SSH密钥",disabled:"windows"===a,value:I.SSH},{label:"保留镜像设置",disabled:!(b===H.PRIVATE||b===H.SHARED)||"windows"===a&&c,value:I.KeepSetting}].filter(function(a){return a.disabled!==!0})},_getLoginName:function(a,b){var c="root";return"windows"===a?c="Administrator":/ubuntu/i.test(b)&&(c="ubuntu"),c},_getTargetImage:function(a,b,c,d,e){var f=this.instance;switch(this.imageType){case H.PUBLIC:return b;case H.PRIVATE:return c;case H.SHARED:return d;case H.MARKET:return e;default:return{osType:f.osType,rootSize:this._getSystemDiskSize(f),osName:f.osName,imgId:f.unImgId,unImgId:f.unImgId}}},_imgToOption:function(a){return a.map(function(a){return{value:a.imgId||a.unImgId,label:a.label||a.desc,image:a}})},_filterImageType:function(a,b){return b?(a=a.filter(function(a){return b(a.value)}),a&&a[0]&&a[0].value&&this.$set("imageType",a[0].value),a):a},_cachePromise:function(a,b){var c=this._cache||(this._cache={});return c[a]||(c[a]=b()),c[a]},_filterImage:function(a,b,c){var d=this.instance,e=function(a){var c="windows"===a.osType?b.windowsMax:b.linuxMax;if(d.systemDisk&&20==d.systemDisk.diskSize);else if(a.rootSize>c)return"镜像大小超出"+c+"G";if(b.filter){var e=b.filter(a);return"string"==typeof e?e:e?"":"不可用"}return""};return Promise.resolve(a).then(function(a){return a=a.filter(function(a){return c&&0!==a.desc.toLowerCase().indexOf(c.toLowerCase())?!1:!0}),a.forEach(function(a){a.$disabled=e(a)}),a})},_categoryPublicImage:function(a){var b=this;return Promise.resolve(a).then(function(a){var c=Object.keys(a.map(function(a){return a.platform}).reduce(function(a,b){return Object.assign(a,_defineProperty({},b,!0))},{}));b.isGpu&&(c=c.filter(function(a){return"FreeBSD"!=a&&"CoreOS"!=a})),c=b.$get("whitelists.under_security_control")?c.filter(function(a){return"Tencent"===a||"Windows"===a}):c,b.isOversea&&(c=b.isWindows?["Windows"]:c.filter(function(a){return"Windows"!=a}));var d=c.slice(0),e={};return a.forEach(function(a){var b;d.some(function(c,d){return 0===a.desc.toLowerCase().indexOf(c.toLowerCase())?(b=d,e[c]=1,!0):void 0})&&d.splice(b,1)}),c.filter(function(a){return a in e}).map(function(a){return{label:a,value:a}})})},_queryPublicImage:function(){var a=this.instance;return this._cachePromise("public",function(){return u.queryPublicImage(a)})},_queryPrivateImage:function(){var a=this.instance;return this._cachePromise("private",function(){return u.queryImage(a.regionId,H.PRIVATE)})},_querySharedImage:function(){var a=this.instance;return this._cachePromise("shared",function(){return u.queryImage(a.regionId,H.SHARED)})},_queryMarketCategories:function(){return this._cachePromise("marketCategories",function(){return u.queryMarketCategories()})},_queryMarketImage:function(a){var b=this.instance,c=this.whitelists;return this._cachePromise("market."+a,function(){return u.queryMarketImage(a,b,{whitelists:c})})},getRootSize:function(){if(this.canAdjustDisk)return this.rootSize;var a=this.policy;return a.fixedRootSize||Math.max(this.rootSize,a.maxRootSize)},collectOldDisk:function(){var a=this.instance||{rootSize:0,rootType:1},b={size:a.systemDisk&&a.systemDisk.diskSize||0,type:a.systemDisk&&z.getTypeByDiskType(a.systemDisk.storageType),target:"xvda"},c={size:a.dataDisks&&a.dataDisks[0]&&a.dataDisks[0].diskSize||0,type:a.dataDisks[0]&&z.getTypeByDiskType(a.dataDisks[0].storageType),target:"xvde"};return(a.cbsList||[]).forEach(function(a){"root"===a.diskType&&(b.type=z.getTypeByStorageType(a.storageType),b.size=a.diskSize),"data"!==a.diskType||a.portable||(c.type=z.getTypeByStorageType(a.storageType),c.size+=a.diskSize)}),{root:b,data:c}},collectNewDisk:function(){var a=this.collectOldDisk();return a.root.size=this.getRootSize(),a},collectImage:function(){var a=this,b=a.targetImage.imgId,c={};switch(a.imageType){case H.PRIVATE:case H.SHARED:c.deviceImageId=b;break;case H.MARKET:c.itemId=b}return c},collectAgentList:function(){var a=this.agentList||{};return{security:a.security?1:0,monitor:a.monitor?1:0}},collectPassword:function(){var a=this,b={};return a.loginType===I.Password?b.passwd=a.resetPwd:a.loginType===I.SSH?b.keyid=a.sshKey:a.loginType===I.KeepSetting&&(b.keepImageSetting=1),b},isValid:function(a){var b=this,c=[];if(a)c=[a];else switch(c=["targetImage"],this.loginType){case I.SSH:c.push("sshKey");break;case I.Password:c=c.concat(["resetPwd","resetConfirmPwd"])}var d=b;return!c.some(function(a){var c=v[a](d[a],d);return c?(b.$set("invalids."+a,c),!0):(b.$set("invalids."+a,""),!1)})},resetLoginPwd:function(){this.$set("invalids.resetPwd",""),this.$set("warn.resetPwd","")},resetPwdblurHandler:function(){var a=this.resetPwd,b=this.isValid("resetPwd");b&&!x.isStrongPassword(a)?this.$set("warn.resetPwd",R):this.$set("warn.resetPwd","")},resetConfirmLoginPwd:function(){this.$set("invalids.resetConfirmPwd",""),this.$set("warn.resetConfirmPwd","")},resetConfirmPwdblurHandler:function(){this.isValid("resetConfirmPwd")}},{defaults:{invalids:{},passwordTip:Q,isShowDetail:!0,toggleShowDetail:function(){this.$set("isShowDetail",!this.isShowDetail)},capitalize:n.capitalize,DiskType:G,DiskTypeName:function(a){var b=a.systemDisk&&a.systemDisk.diskTypeName;return!b&&(a.cbsList||[]).forEach(function(a){"root"===a.diskType&&(b=z.getDiskTypeNameByStorageType(a.storageType))}),b||""},WikiUrls:function(){return F?{windows:"https://intl.cloud.tencent.com/document/product/213/4933",linux:"https://intl.cloud.tencent.com/document/product/213/4933"}:{windows:"https://www.qcloud.com/doc/product/213/2158",linux:"https://www.qcloud.com/doc/product/213/2042"}}(),ImageType:H,ImageTypeNames:s.TYPE_NAMES,imageTypeList:[{label:"当前镜像",value:0}].concat([H.PUBLIC,H.PRIVATE,H.SHARED,H.MARKET].map(function(a){return{label:s.TYPE_NAMES[a],value:a}})),imageType:0,LoginType:I,loginType:I.Password}}),X=k.getComponent("qc-segment");W.tag("button-bar",X.extend({$valuekey:"value",$afterInit:function(){n.beeBind(this,this,"buttons","list"),X.__super__.$afterInit.apply(this,arguments),this.$on("selected",function(a){a&&a.value!==this.value&&this.$set("value",a.value)}),this.$watch("[buttons, value]",function(){this.toggle({value:this.value})})}},{defaults:{idKey:"value"}})),W.tag("ssh-key-dropdown",a("./SSHKeyDropdown")),W.tag("image-select",a("./ImageDropdown")),W.tag("market-image-select",k.getComponent("qc-select").extend({listTpl:'  <li    data-item    role="presentation"    b-repeat="item in list | _filter : filterKey"    class="{{ selected == item ? \'selected\' : \'\' }} {{      item.$disabled ? \'disabled\' : \'\'    }}"    data-title?="item.$disabled"  >    <div class="store-os-item">      <div class="os-item-name">        {{ item.imageName }}        <span class="mirror-space">({{ item.spaceRequire }}GB)</span>      </div>      <div class="os-item-desc">        <p>操作系统：{{ item.desc }}</p>        <p>集成软件：{{ item.software }}</p>        <p b-if="item.companyName">提供商家：{{ item.companyName || \'\' }}</p>      </div>    </div>  </li>',filterData:function(a,b){return b=g(b),a.filter(function(a){return b?g(a.label).indexOf(b)>-1:!0})}},{defaults:{filter:!0,styleType:1,cls:"select-os-from-store"}}));var Y={main:'  <div>    <style>      .select-os-from-store.tc-15-dropdown-btn-style        .dropdown-list-wrap        .tc-15-dropdown-menu {        max-height: 283px;      }      .dev-bold {        font-weight: bold;      }      .dev-title-col {        margin-bottom: 0px !important;        border-bottom: none !important;      }      .dev-content-col {        margin-top: 0px !important;      }    </style>    <div id="resetosWrapper">      <div class="act-outline">        <div class="act-summary">          您已选 <strong>1台实例</strong>，          <a href="javascript:;" b-on-click="toggleShowDetail()"            >查看详情 <i class="blue-down-icon" b-if="isShowDetail"></i>            <i class="blue-up-icon" b-if="!isShowDetail"></i>          </a>        </div>        <div b-if="isShowDetail">          <style>            .dev-bold {              font-weight: bold;            }            .dev-title-col {              margin-bottom: 0px !important;              border-bottom: none !important;            }            .dev-content-col {              margin-top: 0px !important;            }          </style>          <div class="act-details dev-title-col">            <table class="act-details-tb">              <tbody>                <tr>                  <td>No.</td>                  <td><span class="entity-name dev-bold">实例名</span></td>                  <td><span class="entity-name dev-bold">实例ID</span></td>                  <td><span class="entity-name dev-bold">系统盘大小</span></td>                  <td><span class="entity-name dev-bold">操作系统</span></td>                </tr>              </tbody>            </table>          </div>          <div class="act-details dev-content-col">            <table class="act-details-tb">              <tbody>                <tr>                  <td>1</td>                  <td>                    <span                      class="entity-name"                      title="{{ instance.instanceName }}"                    >                      {{ instance.instanceName }}                    </span>                  </td>                  <td>                    <span class="entity-name" title="{{ instance.instanceId }}">                      {{ instance.instanceId }}                    </span>                  </td>                  <td>                    <span                      class="entity-name"                      title="系统盘大小：{{ instance.systemDisk.diskSize }}GB"                    >                      {{ instance.systemDisk.diskSize }}GB</span                    >                  </td>                  <td>                    <span class="entity-name" title="{{ instance.osName }}">                      {{ instance.osName }}</span                    >                  </td>                </tr>              </tbody>            </table>          </div>        </div>      </div>      <ul>        <div b-if="policy.topTip" class="tip_box">{{>policy.topTip}}</div>        <%#lastSetting%>        {{>policy.bottomTip}}      </ul>    </div>  </div>',lastSetting:'  <div class="form-wrap re-install" id="lastSettingWrap">    <ul class="form-list">      <li>        <div class="form-label"><label for="">镜像来源</label></div>        <div class="form-input">          <button-bar            b-model="imageType"            buttons="{{              _filterImageType(imageTypeList, policy.imageTypeFilter)            }}"          ></button-bar>          <div class="tc-15-rich-radio" role="radiogroup" id="imageSet"></div>        </div>      </li>      <li b-if="imageType===0" class="curImg-li">        <div class="form-label "><label for="">镜像</label></div>        <div class="form-input">          <div class="mirror-name">            {{ targetImage.osName }} {{>policy.curImageTip}}          </div>          <%#agent%>        </div>      </li>      <li b-if="imageType === ImageType.PUBLIC" class="commonImg-li">        <div class="form-label "><label for="">操作系统</label></div>        <div class="form-input">          <button-bar            b-model="publicOsCategory"            buttons="{{              _categoryPublicImage(                _filterImage(_queryPublicImage(), imagePolicy)              ).then(assureSelected(\'publicOsCategory\', \'value\'))            }}"          ></button-bar>          <!--            <div class="tc-15-rich-radio" role="radiogroup" id="osSet"></div>          -->        </div>      </li>      <li b-if="imageType === ImageType.PUBLIC" class="commonImg-li">        <div class="form-label "><label for="">系统版本</label></div>        <div class="form-input">          <image-select            b-model="publicImage"            list="{{              _filterImage(_queryPublicImage(), imagePolicy, publicOsCategory)                .then(assureSelected(\'publicImage\'))                .then(_imgToOption)            }}"            style="width:220px;max-width:220px;"          ></image-select>          <%#agent%>        </div>      </li>      <li b-if="imageType === ImageType.PRIVATE" class="diyImg-li">        <div class="form-label "><label for="">镜像</label></div>        <div class="form-input">          <image-select            b-model="privateImage"            list="{{              _filterImage(_queryPrivateImage(), imagePolicy)                .then(assureSelected(\'privateImage\'))                .then(_imgToOption)            }}"            style="width:220px;max-width:220px;"          ></image-select>          <%#agent%>        </div>      </li>      <li b-if="imageType === ImageType.SHARED" class="sharedImg-li">        <div class="form-label "><label for="">镜像</label></div>        <div class="form-input">          <image-select            b-model="sharedImage"            list="{{              _filterImage(_querySharedImage(), imagePolicy)                .then(assureSelected(\'sharedImage\'))                .then(_imgToOption)            }}"            style="width:220px;max-width:220px;"          ></image-select>          <%#agent%>        </div>      </li>      <li b-if="imageType === ImageType.MARKET" class="marketImg-li">        <div class="form-label "><label for="">镜像</label></div>        <div class="form-input">          <button-bar            b-model="marketOsCategory"            buttons="{{              _queryMarketCategories().then(                assureSelected(\'marketOsCategory\', \'value\')              )            }}"          ></button-bar>          <div>            <market-image-select              b-model="marketImage"              list="{{                _filterImage(                  _queryMarketImage(marketOsCategory),                  imagePolicy                ).then(assureSelected(\'marketImage\'))              }}"            ></market-image-select>          </div>          <%#agent%>        </div>      </li>      <li class="sysdiskoption-li">        <div class="form-label "><label for="">系统盘</label></div>        <div b-if="!canAdjustDisk" class="form-input">          {{ policy.fixedRootSize || Math.max(rootSize, policy.maxRootSize) }}GB          <span class="inline-help-text text-weak"            >（{{ DiskTypeName(instance) }}）</span          >          <span>            <a              href="http://www.qcloud.com/doc/product/213/%E7%B3%BB%E7%BB%9F%E7%9B%98%E6%89%A9%E5%AE%B9%E7%9B%B8%E5%85%B3%E9%97%AE%E9%A2%98"              target="_blank"              >系统盘扩容介绍</a            >          </span>        </div>        <div b-if="canAdjustDisk" class="form-input">          <slider-range            b-model="rootSize"            min="{{ policy.minRootSize }}"            max="{{ policy.maxRootSize }}"            unit="GB"          ></slider-range>          <span>            <a              href="http://www.qcloud.com/doc/product/213/%E7%B3%BB%E7%BB%9F%E7%9B%98%E6%89%A9%E5%AE%B9%E7%9B%B8%E5%85%B3%E9%97%AE%E9%A2%98"              target="_blank"              >系统盘扩容介绍</a            >          </span>        </div>      </li>      <li id="loginArea">        <div class="form-label"><label for="">登录设置</label></div>        <div class="form-input">          <button-bar            b-model="loginType"            buttons="{{ assureSelected(\'loginType\', \'value\')(loginTypeList) }}"          ></button-bar>          <div class="tc-15-rich-radio" role="radiogroup" id="loginSet"></div>        </div>      </li>      <li b-if="loginType === LoginType.SSH" class="sshKey-li">        <div class="form-label"><label for="">SSH密钥</label></div>        <div class="form-input">          <!-- <select class="tc-15-select m" id="sshkeySelect"></select> -->          <ssh-key-dropdown            region-id="{{ instance.regionId }}"            project-id="{{ instance.projectId }}"            b-model="sshKey"          ></ssh-key-dropdown>        </div>      </li>      <li b-if="loginType === LoginType.Password" class="pwd-li">        <div class="form-label "><label for="">用户名</label></div>        <div class="form-input">          <p id="loginUsername">{{ loginName }}</p>        </div>      </li>      <li b-if="loginType === LoginType.Password" class="pwd-li">        <div class="form-label"><label for="">密码</label></div>        <form          onkeydown="if(event.keyCode==13){return false;}"          autocomplete="off"        >          <div class="form-input">            <div class="form-unit {{ invalids.resetPwd ? \'is-error\' : \'\' }}">              <input                b-on-input="resetLoginPwd()"                b-on-blur="resetPwdblurHandler()"                type="password"                id="resetPwd"                b-model="resetPwd"                class="tc-15-input-text m"                placeholder=""                autocomplete="new-password"              />              <b class="icon-valid-flag"></b>              <p class="form-input-help" id="r_errtips">                {{ invalids.resetPwd }}              </p>              <p                b-if="!invalids.resetPwd && warn.resetPwd"                class="form-input-help text-warning"              >                {{ warn.resetPwd }}              </p>            </div>            <p              class="inline-help-text text-weak"              b-if="!invalids.resetPwd && !warn.resetPwd"            >              {{ passwordTip[targetOsType] || \'\' }}            </p>          </div>        </form>      </li>      <li        b-if="loginType === LoginType.Password && resetPwd"        class="pwd-confirm-li"      >        <div class="form-label"><label for="">确认密码</label></div>        <form          onkeydown="if(event.keyCode==13){return false;}"          autocomplete="off"        >          <div class="form-input">            <div              class="form-unit {{ invalids.resetConfirmPwd ? \'is-error\' : \'\' }}"            >              <input                b-on-input="resetConfirmLoginPwd()"                b-on-blur="resetConfirmPwdblurHandler()"                type="password"                id="resetConfirmPwd"                b-model="resetConfirmPwd"                class="tc-15-input-text m"                placeholder=""                autocomplete="new-password"              />              <b class="icon-valid-flag"></b>              <p class="form-input-help" id="c_errtips">                {{ invalids.resetConfirmPwd }}              </p>            </div>          </div>        </form>      </li>      <li b-if="loginType === LoginType.KeepSetting" class="reserved-image-li">        <div class="d-tbc form-label"><label></label></div>        <div class="d-tbc psw-cell">          <div class="auto-gen-tips" style="margin-top:0">            重装后，您可使用自定义镜像内登录信息(密钥/密码)登录          </div>        </div>      </li>      <!-- 按量计费 -->      <li b-if="priceMode === \'flow\'" class="payflow-li">        <div class="form-label "><label for="">原配置费用</label></div>        <div class="form-input">          <i class="n-loading-icon" b-if="oldPriceLoading"></i>          <span b-if="!oldPriceLoading" class="original-cost normal">{{            toI18nMoney(oldPrice, \'words\')          }}</span          >/小时        </div>      </li>      <li b-if="priceMode === \'flow\'" class="payflow-li">        <div class="form-label "><label for="">新配置费用</label></div>        <div class="form-input">          <i class="n-loading-icon" b-if="priceLoading"></i>          <span b-if="!priceLoading" class="cost">            <strong>{{ toI18nMoney(price, \'words\') }}</strong            >/小时          </span>          <span b-if="originPrice">            <span class="original-cost">{{              toI18nMoney(originPrice, \'words\')            }}</span            >/小时          </span>        </div>      </li>      <!-- 补差价 -->      <li b-if="priceMode === \'payoff\'" class="payoff-li">        <div class="form-label "><label for="">应付费用</label></div>        <div class="form-input">          <i class="n-loading-icon" b-if="priceLoading"></i>          <span b-if="!priceLoading" class="cost">{{            toI18nMoney(price, \'words\')          }}</span>          <div b-if="!priceLoading" class="inline-help-text text-weak">            调整后的系统盘将随实例一起到期，您须补齐相应的差价            <div class="tc-15-bubble-icon tc-15-triangle-align-end">              <i class="tc-icon icon-info-red"></i>              <div class="tc-15-bubble tc-15-bubble-top">                <div class="tc-15-bubble-inner">                  <p>                    实例将在{{ deadline }}到期，截止目前剩余{{                      restday                    }}天有效期，需补齐差价{{ toI18nMoney(price, \'words\') }}                  </p>                </div>              </div>            </div>          </div>        </div>      </li>      <!-- 退费 -->      <li b-if="priceMode === \'payback\'" class="payback-li">        <div class="form-label "><label for="">退还差价</label></div>        <div class="form-input">          <i class="n-loading-icon" b-if="priceLoading"></i>          <span b-if="!priceLoading" class="cost">{{            toI18nMoney(price, \'words\')          }}</span>          <span class="inline-help-text text-weak">            差价将在重装完成后退回你的账户余额            <!--              <div class="tc-15-bubble-icon tc-15-triangle-align-end">                  <i class="tc-icon icon-info-red"></i>                  <div class="tc-15-bubble tc-15-bubble-top">                      <div class="tc-15-bubble-inner">                          <p>您已在<span class="dealTime"></span>调整系统盘时新购<span class="dealSize"></span>GB容量，截至目前剩余<span class="dealRestday"></span>天有效期，应退差价¥ <strong class="realCost"></strong></p>                      </div>                  </div>              </div>            -->          </span>        </div>      </li>    </ul>  </div>',agent:'  <div class="option-line">    <label class="form-ctrl-label">      <input        type="checkbox"        id="securityAgentCk"        class="tc-15-checkbox"        checked="checked"        b-model="agentList.security"      />免费开通DDos防护和云镜实例防护      <a href="https://www.qcloud.com/product/hs" target="_blank"        >安全加固介绍</a      >    </label>  </div>  <div class="option-line">    <label class="form-ctrl-label">      <input        type="checkbox"        id="monitorAgentCk"        class="tc-15-checkbox"        disabled?="isBM"        checked="checked"        b-model="agentList.monitor"      />免费开通云产品监控、分析和实时告警      <a href="https://www.qcloud.com/doc/product/248" target="_blank"        >云监控介绍</a      >    </label>  </div>'},Z=function(a){y.call(this,a)};Z.prototype=new y,Z.prototype.exec=function(){var b=this;E.verify({api:"cvm:ResetInstance"
}).then(function(){h=D.init(c.id,"kennyang"),h&&h.renderBefore();var d=b;J=!1;var e=b.hasPermItems[0];Promise.all([B.queryCbs({uInstanceIds:[e.instanceId],limit:1,offset:0,regionId:e.regionId}),C.queryDiskConfigQuota({regionId:e.regionId,diskUsage:"SYSTEM_DISK",instanceFamilies:[e.instanceFamily],diskChargeType:"PREPAID"==e.instanceChargeType?e.instanceChargeType:"POSTPAID_BY_HOUR",zones:[e.zone],inquiryType:"INQUIRY_CVM_CONFIG",innerInquiryType:"INQUIRY_RESIZE"})]).then(function(b){var c=b[0],f=b[1].response&&b[1].response.diskConfigSet||[];if(f.length){var g=f.find(function(a){return a.diskType===e.systemDisk.storageType});g&&g.maxDiskSize>50&&(J=!0)}var i=c.cbss&&c.cbss.nodes?c.cbss.nodes:[];if(e.cbsList=i,d.selectedItemIsExpire())return h&&h.renderSuccess(),o.error("实例已过期，请续费");var j=m.tmpl(Y.main,{},{lastSetting:Y.lastSetting,agent:Y.agent});d.$dialog=l.create(j,"730","",{title:"重装系统",preventResubmit:!0,button:w({" 开始重装 ":function(){return q.click("yunzhuji.chongzhuang"),d.reset()}})});var k=d.bee=W.mount(l.contentEl.children()[0],{instance:e,regionId:e.regionId,toI18nMoney:a("widget/i18n").toI18nMoney}),p=n.bufferFn(function(a){d.getPrice().then(a)["catch"](function(a){d.reset()})},500);k.$watch("[canAdjustDisk, rootSize, targetImage]",function(){k.$set("priceFetched",!1),p(function(){h&&h.renderSuccess(),k.$set("priceFetched",!0)})},!0),k.$watch("policy.unsupported",function(a){h&&h.renderSuccess();var b=a===!0;l.toggleBtnDisable(b)},!0),setTimeout(function(){l.center()},0)})})},Z.prototype.reset=function(){var a=this,b=a.bee;if(!b.isValid())return!1;var c=b.policy.unsupported;if(c&&c.content&&l.create(new k("<div>"+c.content+"</div>",b.$data).$el,"520","",{title:c.title,button:w(c.button)}),c)return!1;var d=b.policy.confirm;return d?(l.create(new k("<div>"+d+"</div>",b.$data).$el,"520","",{title:"确认重装",preventResubmit:!0,button:w({" 确定 ":function(){return a.sendReq()}})}),!1):a.sendReq()};var $={VSELF_2:10694,VSHIO_2:10700,VSLMEM_2:10697,VSHCAL_2:10703,VSHGPU_2:10992,VSGPUNVIDIAP40_2:11352};(function(){var a={};return function(b,c){b=+b||1;var d=[b].join("_");return a[d]||(a[d]=new Promise(function(a,c){j.getQuotiesChargeItem({regionId:b},a,c,"",!1)}).then(function(a){return a.data},function(){return a[d]=null,null})),a[d].then(function(a){var d;return a&&c in a&&a[c][0]&&a[c][0].pid?a[c]:(d=b in{9:1,15:1}?10622:$[c]||10578,[{start:0,end:"96",pid:d}])})}})();Z.prototype.collectDataV3=function(a){var b,c=this.bee,d=this.hasPermItems[0],e=c.collectOldDisk(),f=c.collectNewDisk(),g=a?e:f;b=a?d.unImgId||d.imageId:0==c.imageType?d.unImgId||d.imageId:c.imageType==H.MARKET?c.targetImage.unImgId:c.targetImage.unImgId||c.targetImage.imgId;var h={InstanceId:d.uInstanceId};if(a||e.root.size!=f.root.size&&(h.SystemDisk={DiskSize:g.root.size}),b&&(h.ImageId=b),a)return h;var i=c.collectAgentList();h.EnhancedService={SecurityService:{Enabled:1==i.security},MonitorService:{Enabled:1==i.monitor}};var j=c.collectPassword();return j.passwd?h.LoginSettings={Password:j.passwd}:j.keyid?h.LoginSettings={KeyIds:[j.keyid]}:1==j.keepImageSetting&&(h.LoginSettings={KeepImageLogin:!0}),h},Z.prototype.collectDataV3ForPay=function(){var a=this.bee,b=(this.hasPermItems[0],a.targetImage,a.collectNewDisk(),this.collectDataV3());return[b]},Z.prototype.getPrice=function(){var a=this,b=a._priceToken={},c=a.hasPermItems[0];return x.isPrepaidPayMode(c.instanceChargeType)?a.bee.$set({priceMode:"payoff",priceLoading:!0}):a.bee.$set({priceMode:"flow",priceLoading:!0,oldPriceLoading:!0}),new Promise(function(d,e){if(x.isPrepaidPayMode(c.instanceChargeType)){var f=!1,g=a.collectDataV3(f);g.ImageId||(a.bee.$set({priceLoading:!1,price:"-"}),e()),A.apiRequest({action:"InquiryPriceResetInstance",serviceType:"cvm",data:g,regionId:c.regionId}).then(function(e){if(b===a._priceToken){var f=new Date(c.expiredTime);a.bee.$set({priceLoading:!1,price:e.response.price.instancePrice.discountPrice,deadline:n.formatDate(f,"yyyy-MM-dd"),restday:Math.floor((f.getTime()-Date.now())/864e5)}),d()}})["catch"](function(a){console.warn(a)})}else Promise.all([function(){var d=a.collectDataV3(!0);return d.ImageId?A.apiRequest({action:"InquiryPriceResetInstance",serviceType:"cvm",data:d,regionId:c.regionId}).then(function(c){if(b===a._priceToken){var d=c.response.instancePrice?c.response.instancePrice.unitPrice:c.response.price.instancePrice.unitPriceDiscount;a.bee.$set({oldPriceLoading:!1,oldPrice:d})}}):new Promise(function(b,c){a.bee.$set({priceLoading:!1,oldPrice:"-"}),b()})}(),function(){var d=a.collectDataV3(!1);return d.ImageId?A.apiRequest({action:"InquiryPriceResetInstance",serviceType:"cvm",data:d,regionId:c.regionId}).then(function(c){if(b===a._priceToken){var d=c.response.instancePrice?c.response.instancePrice.unitPrice:c.response.price.instancePrice.unitPriceDiscount,e=c.response.price&&c.response.price.instancePrice.unitPrice>d?c.response.price.instancePrice.unitPrice:null;a.bee.$set({priceLoading:!1,price:d,originPrice:e})}}):new Promise(function(b,c){a.bee.$set({priceLoading:!1,price:0}),c()})}()]).then(d)})},Z.prototype.sendReq=function(){var a=this,b=a.bee,c=this.hasPermItems[0],d=b.isWindows&&b.isTargetLinux,e=!b.isWindows&&b.isTargetWindows,f=x.getCvmPayModeByChargeType(c.instanceChargeType);d&&q.click("yunzhuji.chongzhuang.windowstolinux"),e&&q.click("yunzhuji.chongzhuang.linuxtowindows"),i("#payback-li").is(":visible")&&q.click("yunzhuji.chongzhuang.payback");var g=(b.collectNewDisk(),f===r.CVMPAYMODE.POSTPAID_BY_HOUR?b.price==b.oldPrice:0==b.price);b.collectAgentList();if(b.isLocalDisk&&b.isSwitchSystem||f!=r.CVMPAYMODE.PREPAID||g){var h=a.collectDataV3(),j=a.cloudAPIActionNameMap&&a.cloudAPIActionNameMap.cvm&&a.cloudAPIActionNameMap.cvm.ResetInstance||"重装操作系统中";return new Promise(function(b,d){A.apiRequest({action:"ResetInstance",serviceType:"cvm",data:h,regionId:c.regionId},{camTipsType:"dialog"}).then(function(b){l.hide(),a.checkTask({taskId:b.response.taskId},j),a.callback&&a.callback()})})}var k=a.collectDataV3ForPay();return h=k[0],h.Version="2017-03-12",p.apiRequest({serviceType:"cvm",action:"SwitchParameterResetInstance",data:h,regionId:c.regionId}).then(function(b){var c=b&&b.Response.InstanceOrder.goods;a.toPay2(c)})["catch"](function(a){console.warn(a)}),new Promise(function(){})},c.exports=Z}),define("cvm/cvm/event/resetos/SSHKeyDropdown",function(a,b,c){var d=a("qccomponent"),e=(a("manager"),a("cvm/common/model")),f=c.exports=d.extend({$valuekey:"value",$tpl:'  <div>    <span>      <select b-if="!empty" class="tc-15-select m" b-model="value">        <option b-repeat="item in list" value="{{item.keyId}}" title="{{item.keyName}}">{{item.subKeyName}}</option>      </select>      <span b-if="empty">您当前没有可选的ssh密钥,        <a href="/cvm/sshkey" target="_blank">现在创建</a>      </span>      <a href="javascript:;" b-on-click="refresh()"><i class="icon-refresh"></i></a>    </span>    <a b-if="showHelp" href="https://www.qcloud.com/document/product/213/6092" class="inline-help-text links" target="_blank">密钥使用说明</a>    <p b-if="!empty" class="text-weak mt-5">如您现有的密钥不合适，可以<a href="/cvm/sshkey" target="_blank">现在创建</a></p>  </div>',$afterInit:function(){f.__super__.$afterInit.apply(this,arguments),this.getData()},getData:function(){var a=this,b=[],c=function f(c){var g=40,h=g*(c-1);1==c&&(b=[]),e.apiRequest({regionId:a.regionId,serviceType:"cvm",action:"DescribeKeyPairs",data:{Offset:h,Limit:g,Filters:[]}}).then(function(e){var g=e.response||{},h=g.keyPairSet;h.forEach(function(a){a.keyName&&a.keyName.length>16?a.subKeyName=a.keyName.slice(0,16)+"...":a.subKeyName=a.keyName}),1!=c||h.length||a.$set("empty",!0),b=b.concat(h),d(h),b.length<g.totalCount&&f(c+1)})},d=function(b){var c=a.list;c||(a.$set("list",[{keyName:"请选择...",subKeyName:"请选择..."}]),c=a.list),c.splice.apply(c,[c.length,0].concat(b)),c.length>1&&a.$set("empty",!1)};c(1)},refresh:function(){this.$set("list",null),this.getData()}},{defaults:{empty:!1,showHelp:!0}})}),define("cvm/cvm/event/resetos/validator",function(a,b,c){var d="()`~!@#$%^&*-+=_|{}[]:;'<>,.?/",e="windows机器密码需12到30位，至少包括三项（[a-z],[A-Z],[0-9]和["+d+"]的特殊符号）",f="linux机器密码需8到30位，至少包括三项（[a-z],[A-Z],[0-9]和["+d+"]的特殊符号）",g=/^\//,h="不支持“/”置于密码首位",i="windows机器密码中不得包含用户名，如：“administrator”（大小写不敏感），请重新设置",j=d.split("").map(function(a){return"\\"+a}).join("");b.passwordTip={windows:e,linux:f},b.windowsPassword=function(){var a=new RegExp("^[\\da-zA-Z"+j+"]{12,30}$"),b=[/[a-z]+/,/[A-Z]+/,/[0-9]+/,new RegExp("["+j+"]+")];return function(c,d){if(!a.test(c))return e;var f=0;return b.forEach(function(a){c.match(a)&&f++}),3>f?e:g.test(c)?h:new RegExp(d.loginName,"i").test(c)?i:void 0}}(),b.linuxPassword=function(){var a=new RegExp("^[\\da-zA-Z"+j+"]{8,30}$"),b=[/[a-z]+/,/[A-Z]+/,/[0-9]+/,new RegExp("["+j+"]+")];return function(c){if(!a.test(c))return f;var d=0;return b.forEach(function(a){c.match(a)&&d++}),3>d?f:g.test(c)?h:void 0}}(),b.resetPwd=function(a,c){return a=$.trim(a),a?c.isTargetWindows?b.windowsPassword(a,c):b.linuxPassword(a):"请输入登录密码"},b.resetConfirmPwd=function(a,b){return a=$.trim(a),a?a!==b.resetPwd?"两次密码不一致":void 0:"请输入确认密码"},b.sshKey=function(a,b){return a?void 0:"未选择任何密钥"},b.targetImage=function(a){return a?void 0:"请选择合适的镜像"}}),define("cvm/event/resetpwd/resetpwd",function(a,b,c){var d,e=a("$"),f=a("cvm/cvm/event/operate_base"),g=a("validator"),h=a("dialog"),i=a("util"),j=(a("cvm/common/constants"),a("cvm/cvm/event/selectedShow/selectedShow")),k=a("cvm/cvm/event/upgrade_common"),l=a("widget/mfa/mfa"),m=a("cvm/common/model"),n=a("cvm/cvm/cvmutil"),o=a("cvm/common/renderMonitor"),p={main:'    <div class="form-wrap">        <ul class="form-list">            <li>                <div class="d-tbc form-label"><label>用户名</label></div>                <div class="d-tbc">                    <div class="tc-15-select-wrap m">                        <select class="tc-15-select" id="pwdUserSelect">                            <option value="0">系统默认</option>                            <option value="1">指定用户名</option>                        </select>                    </div>                    <div class="tc-15-input-text-wrap m usr-name">                        <input id="pwdUserIptDefault" class="tc-15-input-text disabled" type="text" disabled="disabled" value="">                        <input id="pwdUserIptCustom" class="tc-15-input-text" type="text" style="display:none">                        <div id="pwdUserIptCustomTip" class="tc-15-input-tips" style="display:none">仅可对系统中已存在的用户进行重置密码操作</div>                    </div>                </div>            </li>            <li>                <div class="d-tbc form-label"><label>新密码</label></div>                <div class="d-tbc">                    <div class="tc-15-input-text-wrap m">                        <input id="pwdUserIpt" type="password" class="tc-15-input-text">                        <div id="pwdUserTip" class="tc-15-input-tips"><%=passwordTip%></div>                    </div>                </div>            </li>            <li>                <div class="d-tbc form-label"><label>确认密码</label></div>                <div class="d-tbc">                    <div class="tc-15-input-text-wrap m">                        <input id="confirmPwdUserIpt" type="password" class="tc-15-input-text">                     </div>                </div>            </li>        </ul>    </div>',confirm:'    <div class="text-tips">        <p>1、为了避免数据丢失，重置密码需要在<em class="text-danger">关机</em>状态下操作，实例将关机中断您的业务，请仔细确认</p>        <p>2、强制关机可能会导致数据丢失或文件系统损坏，您也可以主动关机后进行重置密码</p>        <p>3、强制关机可能需要您等待较长时间，请耐心等待</p>        <p><label class="form-ctrl-label"><input type="checkbox" b-model="agree" class="tc-15-checkbox">同意强制关机</label></p>    </div>'},q="()`~!@#$%^&*-+=_|{}[]:;'<>,.?/",r="Windows 机器密码需12到30位，至少包括三项（[a-z],[A-Z],[0-9]和["+q+"]的特殊符号），且不得包含用户名，如：“administrator”（大小写不敏感）",s="Linux 机器密码需8到30位，至少包括三项（[a-z],[A-Z],[0-9]和["+q+"]的特殊符号）",t="机器密码需12到30位，至少包括三项（[a-z],[A-Z],[0-9]和["+q+"]的特殊符号），且不得包含 administrator（大小写不敏感）",u="由于您重置密码的系统中含有windows系统，所以密码需12到30位，至少包括三项（[a-z],[A-Z],[0-9]和["+q+"]的特殊符号），且不得包含用户名，如：“administrator”（大小写不敏感）",v="不支持“/”置于密码首位",w="注意：您的密码已经符合设置密码规则，但密码需要具备一定的强度，建议您设置12位以上，至少包括4项（[a-z],[A-Z],[0-9]和[()`~!@#$%^&*-+=_|{}[]:;'<>,.?/]的特殊符号]），每种字符大于等于2位且不能相同的密码。",x=function(a,b){var c,d,e=a.newPwdVal,f=a.userSelectVal,g=q.split("").map(function(a){return"\\"+a}).join(""),h=0;if(2==b||4==b||6==b){if(c=new RegExp("^[\\da-zA-Z"+g+"]{8,30}$"),!c.test(e))return!1;d=[/[a-z]+/,/[A-Z]+/,/[0-9]+/,new RegExp("["+g+"]+")];for(var c,i=0;c=d[i];i++)e.match(c)&&h++;return h>=3}var j=0==f?"administrator":a.userVal;if(c=new RegExp("^[\\da-zA-Z"+g+"]{12,30}$"),!c.test(e))return!1;d=[/[a-z]+/,/[A-Z]+/,/[0-9]+/,new RegExp("["+g+"]+")];for(var c,i=0;c=d[i];i++)e.match(c)&&h++;return 3>h?!1:new RegExp(j,"i").test(e)?!1:!0},y=function(a){f.call(this,a)};y.prototype=new f,y.prototype.exec=function(){var a=this,b=this;l.verify({api:"cvm:ResetInstancesPassword"}).then(function(){d=o.init(c.id,"kennyang"),d&&d.renderBefore();var f=[],g=[],l=!1,m=!1,q=!1,u=0,v="",w=a.hasPermItems,x=!0;a.upgradeCommon=new k(a);for(var y,z=0;y=w[z];z++)f.push(y.deviceLanIp),g.push(y.uInstanceId),"windows"===y.osType?(l=!0,u=1|u):(m=!0,/ubuntu/i.test(y.osName)?(q=!0,u=4|u):u=2|u),b.upgradeCommon.isStopped(w[z].instanceState)||(x=!1);var A=l&&m;v=A?t:m?s:r,b.data={hasWindows:l,osSet:u,passwordTip:v};var B=i.tmpl(p.main,b.data),C={shutdown:{" 确认重置 ":function(){var a=b.getInputData();if(b.checkPwdVcode(a)){var c={password:a.newPwdVal,instanceIds:g,forceStop:"TRUE"};"1"==a.userSelectVal&&(c.userName=a.userVal),b.sendReq(c)}}},nonShutdown:{" 下一步 ":function(){var a=b.getInputData();if(b.checkPwdVcode(a)){var c={password:a.newPwdVal,instanceIds:g,forceStop:"TRUE"};"1"==a.userSelectVal&&(c.userName=a.userVal),b.toConfirmShutdown({confirmTpl:p.confirm,title:"重置密码",confirmBtnTxt:"去调整"}).done(function(){b.sendReq(c)})}}}},D=C[x?"shutdown":"nonShutdown"],E=n.isChineseVersion()?540:780;h.create(B,E,"",{title:"重置密码",preventResubmit:!0,button:D}),j.render(a.selectedShowOptions);var F="root/ubuntu/Administrator";1==u?F="Administrator":4==u?F="ubuntu":2==u&&(F="root"),e("#pwdUserIptDefault").val(F),a.bindEvent(A),d&&d.renderSuccess()})},y.prototype.bindEvent=function(a){var b=this;e("#pwdUserSelect").change(function(){var b,c=e(this).val(),d=e("#pwdUserIptDefault"),f=e("#pwdUserIptCustom"),g=e("#pwdUserIptCustomTip"),h=e("#pwdUserTip");"0"==c?(d.show(),f.hide(),g.hide(),g.closest(".tc-15-input-text-wrap").removeClass("error"),g.html("仅可对系统中已存在的用户进行重置密码操作"),b=t):(d.hide(),f.show(),g.show(),b=u),a&&h.html(b)}),e("#pwdUserIpt").on("blur",function(){var a=b.getInputData();b.checkPwdVcode(a,"newPwdVal")}),e("#confirmPwdUserIpt").on("blur",function(){var a=b.getInputData();b.checkPwdVcode(a,"confirmPwdVal")})},y.prototype.getInputData=function(){var a=h.el.find("input"),b=e("#pwdUserSelect"),c=a.eq(0),d=a.eq(1),f=a.eq(2),g=a.eq(3),i=a.eq(4);return{userSelectVal:b.val(),userDefaultVal:e.trim(c.val()),userVal:e.trim(d.val()),newPwdVal:e.trim(f.val()),confirmPwdVal:e.trim(g.val()),vcodeVal:e.trim(i.val())}},y.prototype.checkPwdVcode=function(a,b){var c=h.el.find("input"),d=c.eq(1),e=c.eq(2),f=c.eq(3),i=(c.eq(4),this.data.osSet),j=function(a,b){var c={needFocus:!1,tip:a,errMode:1};return g.showErr(b,c),!1},k=function(a,b){if(b){var c=b.parent(),d=c.find(".tc-15-input-tips");void 0===d.data("origHtml")&&d.data("origHtml",d.html()),b.off("keydown.reset"),b.on("keydown.reset",function(){d.data("origHtml")&&d.html(d.data("origHtml")).show()}),a&&d.html('<p class="text-warning">'+a+"</p>").show()}},l="1"===a.userSelectVal,m={userVal:{el:d,valid:function(a){var b=[];return l&&!a&&b.push({level:"ERROR",msg:"请输入用户名"}),b}},newPwdVal:{el:e,valid:function(b){var c=[];if(b)if(x(a,i))"/"==b[0]?c.push({level:"ERROR",msg:v}):b&&!n.isStrongPassword(b)&&c.push({level:"WARN",msg:w});else{var d=1==i?r:2==i||4==i||6==i?s:l?u:t;c.push({level:"ERROR",msg:d})}else c.push({level:"ERROR",msg:"请输入新密码"});return c}},confirmPwdVal:{el:f,valid:function(b){var c=[];return b?b!==a.newPwdVal&&c.push({level:"ERROR",msg:"两次密码不一致"}):c.push({level:"ERROR",msg:"请输入确认密码"}),c}}},o=function(a,b){return a.filter(function(a){return a.level===b})};if(b){var p=m[b];if(!p)return;var q=p.valid.call(this,a[b]),y=o(q,"ERROR"),z=o(q,"WARN");return y.length&&j(y[0].msg,p.el),z.length&&k(z[0].msg,p.el),!y.length}var A=Object.keys(m),B=[];return A.forEach(function(b){var c=m[b],d=c.valid.call(this,a[b]),e=o(d,"ERROR"),f=o(d,"WARN");e.length&&j(e[0].msg,c.el),f.length&&k(f[0].msg,c.el),B.push(!e.length)}),B.every(function(a){return a})},y.prototype.sendReq=function(a){var b=this,c=this.cloudAPIActionNameMap&&this.cloudAPIActionNameMap.cvm&&this.cloudAPIActionNameMap.cvm.ResetInstancesPassword||"密码重置中";m.apiRequest({action:"ResetInstancesPassword",serviceType:"cvm",data:a,regionId:b.hasPermItems[0].regionId},{camTipsType:"dialog"}).then(function(a){h.hide(),b.checkTask({taskId:a.response.taskId},c,"password"),b.callback&&b.callback()})["catch"](function(a){console.warn(a)})},c.exports=y}),define("cvm/cvm/event/resetType/resetType",function(a,b,c){function d(a){return a.isCloudDisk?v.isI3(a.instanceFamily)?"高IO型 I3 实型不支持调整配置":v.isFpga(a.instanceFamily)?"暂不支持FPGA机型调整配置":v.isBigData(a.instanceFamily)?"大数据机型不支持调整配置":v.isHighIN3(a.instanceFamily)?"高IO型 IN3 实例不支持调整配置":v.isGpu(a.instanceFamily)?"GPU计算型目前只支持当前配置售卖，暂不支持调整配置":"SN2"==a.instanceFamily?"标准网络增强型SN2目前只支持当前配置售卖，暂不支持调整配置":"CN2"==a.instanceFamily?"计算网络增强型SN2目前只支持当前配置售卖，暂不支持调整配置":v.isSpotPayMode(a.instanceChargeType)?"竞价实例不允许调整配置":v.isCDHPayMode(a.instanceChargeType)?"独享型实例不支持调整配置":v.isShoutdownStatus(a.instanceState)?"当前状态不可进行该操作":a.opsAvailable.UPGRADECONFIG?!1:"当前状态不可进行该操作":"系统盘和数据盘均为云盘才可调整配置"}function e(a){var b="-",c=a.instanceChargeType;return v.isPrepaidPayMode(c)?b=a.expiredTimeDesc:v.isSecondPayMode(c)&&(b="按小时计费"),b}function f(a){return a.instanceIds&&a.instanceIds.length?u.apiRequest({regionId:a.regionId,serviceType:"cvm",action:"DescribeInstancesModification",data:{InstanceIds:a.instanceIds}}):new Promise(function(a,b){a({response:{instanceTypeConfigSet:[]}})})}function g(a){return new Promise(function(b,c){u.apiRequest({regionId:a.regionId,serviceType:"cvm",action:"DescribeInstancesOperationLimit",data:{InstanceIds:a.instanceIds,Operation:a.operation}}).then(function(a){b(a.response.instanceOperationLimitSet[0])},function(a){b(null)})})}function h(a){return new Promise(function(b,c){u.apiDelegate({regionId:a.regionId,serviceType:"vpc",action:"GetInstanceEniLimit",data:{instanceId:a.instanceId,cpu:a.cpu,mem:a.mem}}).then(function(a){b(a.data)},function(a){b(null)})})}function i(a){return new Promise(function(b,c){u.apiRequest({regionId:a.regionId,serviceType:"vpc",action:"DescribeNetworkInterfaces",data:{filters:[{name:"attachment.instance-id",values:[a.instanceId]}]}}).then(function(a){b(a.response.networkInterfaceSet)},function(a){b([])})})}function j(a){var b=[];return a.forEach(function(c){if(!b.find(function(a){return c.instanceType==a.instanceType})){var d=a.filter(function(a){return a.instanceType==c.instanceType});b.push({instanceType:d[0].instanceType,instanceFamily:d[0].instanceFamily,disable:d[0].disable,status:d.every(function(a){return a.instanceType==c.instanceType&&"SELL"==a.status})?"SELL":"SOLD_OUT"})}}),b}function k(a,b){var c={SELL:"SELL",SOLD_OUT:"SOLD_OUT",NOT_SUPPORT_CUR_ZONE:"NOT_SUPPORT_CUR_ZONE",NOT_SUPPORT_CUR_NETWORK:"NOT_SUPPORT_CUR_NETWORK"};return b=b.sort(function(a,b){return a.instanceFamily==b.instanceFamily?a.instanceType==b.instanceType?a.disable==b.disable?a.status==b.status?-1:"SELL"==a.status?-1:1:"ENABLE"==a.disable?-1:1:a.instanceType<b.instanceType?-1:1:a.instanceFamily<b.instanceFamily?-1:1}),a.forEach(function(a){a.instanceFamilies=a.instanceFamilies.sort(function(a,b){return a.order-b.order}),a.instanceFamilies.forEach(function(d){d.instanceTypes.forEach(function(e){var f=b.find(function(a){return a.instanceType==e.instanceType});Object.assign(e,f,{type:a.type,typeName:d.typeName,instanceFamily:d.instanceFamily,disable:f&&f.disable,status:f?c[f.status]:c.NOT_SUPPORT_CUR_ZONE})})})}),a}function l(a){return new Promise(function(b,c){u.apiRequest({regionId:a.regionId,serviceType:"cvm",action:"InquiryPriceResetInstancesType",data:{InstanceIds:[a.instanceId],InstanceType:a.instanceType,ForceStop:a.forceStop}}).then(function(c){var d=c.response&&c.response.price||{};d.instancePrice=d.instancePrice||{},b({price:{isDownGradeRefund:!!d.isDownGradeRefund,returnCost:d.instancePrice.returnCost,discountPrice:d.instancePrice.discountPrice,originalPrice:d.instancePrice.originalPrice,unitPrice:d.instancePrice.unitPrice,unitPriceDiscount:d.instancePrice.unitPriceDiscount},instanceId:a.instanceId})},function(c){b({error:c,instanceId:a.instanceId})})})}function m(a,b,c){var d=!0;a.forEach(function(a){"STOPPED"!=a.instanceState&&(d=!1)});var e=a.filter(function(a){return!a.disabledResetType}),f=e.map(function(a){return a.instanceId}),g=a.filter(function(a){return!a.isCloudDisk}).map(function(a){return a.instanceId}),i=r.isI18n(),j=new s({$tpl:'  <div id="reset-type-dialog">    <!-- step 1 -->    <div class="tc-15-step">      <ol>        <li b-class="step==1 ? \'current\': \'\'">          <div class="tc-15-step-name">            <span class="tc-15-step-num"></span>选择目标配置          </div>          <div class="tc-15-step-arrow"></div>        </li>        <li b-class="step==2 ? \'current\': \'\'">          <div class="tc-15-step-name">            <span class="tc-15-step-num"></span>费用统计          </div>          <div class="tc-15-step-arrow"></div>        </li>        <li b-class="step==3 ? \'current\': \'\'">          <div class="tc-15-step-name">            <span class="tc-15-step-num"></span>关机提示          </div>          <div class="tc-15-step-arrow"></div>        </li>      </ol>    </div>    <div style="display: {{ step == 1 ? \'block\' : \'none\' }}">      <div>        <p class="mb-10 mt-10">          已选<strong><span>{{ selectedItems.length }}</span>台实例</strong>,          <a href="javascript:;" b-on-click="toggleShowSelectedDetail()">            查看详情 <i b-if="!showSelectedDetail" class="blue-down-icon"></i>            <i b-if="showSelectedDetail" class="blue-up-icon"></i>          </a>        </p>        <div b-if="showSelectedDetail" class="mb-20">          <div class="tc-15-table-panel">            <div class="tc-15-table-fixed-head">              <table class="tc-15-table-box">                <colgroup>                  <col style="width: 45px;" />                  <col />                  <col style="width: 100px;" />                  <col />                  <col style="width: 150px" />                  <col style="width: 80px;" />                  <col style="width: 250px;" />                </colgroup>                <thead>                  <tr>                    <th>                      <div><span class="text-overflow">NO</span></div>                    </th>                    <th>                      <div><span class="text-overflow">实例名称</span></div>                    </th>                    <th>                      <div><span class="text-overflow">实例ID</span></div>                    </th>                    <th>                      <div><span class="text-overflow">当前配置</span></div>                    </th>                    <th>                      <div><span class="text-overflow">计费时长</span></div>                    </th>                    <th>                      <div><span class="text-overflow">状态</span></div>                    </th>                    <th>                      <div><span class="text-overflow">操作</span></div>                    </th>                  </tr>                </thead>              </table>            </div>            <div class="tc-15-table-fixed-body tc-scroll" style="max-height: 140px;">              <table class="tc-15-table-box tc-15-table-rowhover">                <colgroup>                  <col style="width: 45px;" />                  <col />                  <col style="width: 100px;" />                  <col />                  <col style="width: 150px" />                  <col style="width: 80px;" />                  <col style="width: 250px;" />                </colgroup>                <tbody>                  <tr b-repeat="selectedItem in selectedItems">                    <td>                      <span class="text">{{ $index + 1 }}</span>                    </td>                    <td>                      <div>                        <p>                          <span class="text-overflow"                            title="{{ selectedItem.instanceName }}">{{ selectedItem.instanceName }}</span>                        </p>                      </div>                    </td>                    <td>                      <div>                        <span class="text-overflow"                          title="{{ selectedItem.instanceId }}">{{ selectedItem.instanceId }}</span>                      </div>                    </td>                    <td>                      <div>                        <span class="text-overflow">{{ selectedItem.instanceType }}({{                            selectedItem.instanceTypeDesc                          }}，{{ selectedItem.CPU }}核{{                            selectedItem.memory                          }}GB)</span>                      </div>                    </td>                    <td>                      <div>                        <span class="text-overflow">{{                          selectedItem.chargeTypeTimeDesc                        }}</span>                      </div>                    </td>                    <td>                      <div>                        <span class="text-overflow">                          {{ selectedItem.statusTitle }}</span>                      </div>                    </td>                    <td>                      <div>                        <span b-if="selectedItem.disabledResetType"                          class="text-overflow text-danger">{{ selectedItem.disabledResetType }}</span>                        <span b-if="!selectedItem.disabledResetType" class="text-overflow">可调整配置</span>                      </div>                    </td>                  </tr>                </tbody>              </table>            </div>          </div>        </div>      </div>      <div b-if="supportedInstances.length == 0 && isAllNotCloudDisk" class="param-box">        <div class="param-hd">          <h3>您的实例系统盘/数据盘为本地盘，很抱歉无法进行调整配置。</h3>        </div>        <div class="param-bd">          <div class="rules-info-box">            <p class="rules-info-title">              系统盘和数据盘均为云硬盘，才支持调整配置。如果当前配置影响您的使用，可以按以下步骤新购服务进行迁移;            </p>            <div class="rules-info">              <h4>1，备份您的业务数据</h4>              <ul>                <li>                  备份系统盘:您可以通过<a href="{{ cvmListLink }}" target="_blank">制作镜像<i                      class="external-link-icon"></i></a>来备份您的系统盘数据。                </li>              </ul>            </div>            <div class="rules-info">              <h4>2，保留您的实例IP</h4>              <ul>                <li>                  保留公网IP:先将实例的公网IP转为弹性IP, 再解绑。详情见 【<a href="{{ cvmListLink }}" target="_blank">转为弹性IP<i                      class="external-link-icon"></i></a>】                </li>                <li>                  保留内网IP:记下内网IP地址，新实例购买后，您可以通过弹性网卡修改实例的内网IP                </li>              </ul>            </div>            <div class="rules-info">              <h4>                3，购买新云硬盘（同可用区）<a href="//console.cloud.tencent.com/cvm/cbs" target="_blank">立即购买<i                    class="external-link-icon"></i></a>              </h4>              <ul>                <li>                  当原实例中数据盘为本地盘时，需要您购买新的云硬盘（同可用区的）并挂载到需要调整的本台服务器上，拷贝数据盘的数据然后卸载，重新挂载新的服务器上。                </li>              </ul>            </div>            <div class="rules-info">              <h4>                4，购买新的实例<a href="//buy.cloud.tencent.com/cvm" target="_blank">立即购买<i class="external-link-icon"></i></a>              </h4>              <ul>                <li>使用您制作的自定义镜像创建实例</li>                <li>系统盘使用云硬盘，以便后续可以进行升级配置</li>                <li>当原实例中数据盘为非本地盘时，新数据盘使用快照创建磁盘</li>                <li>公网IP暂不购买</li>              </ul>            </div>            <div class="rules-info">              <h4>5，恢复IP</h4>              <ul>                <li>                  <a href="{{ cvmListLink }}" target="_blank">绑定<i class="external-link-icon"></i></a>您原来的公网IP                </li>                <li>                  进入实例详情页，在弹性网卡中，将主内网IP地址修改为原来的内网IP                </li>              </ul>            </div>            <div class="rules-info">              <h4>6，退还当前实例</h4>              <ul>                <li>                  迁移后，若原实例不再使用，确保数据备份完毕后，您可以通过【更多                  - 实例状态 - 销毁】进行实例退还                </li>              </ul>            </div>          </div>        </div>      </div>      <div class="param-box mt-20" b-if="supportedInstances && supportedInstances.length">        <p class="mb-10">          请选择您的目标配置        </p>        <div class="param-bd">          <ul class="form-list">            <li>              <div class="form-unit">                <p class="mb-10">                  <span class="mr-5">                    <select class="tc-15-select s" b-model="selectedCPU">                      <option b-repeat="cpu in targetCPUs" value="{{ cpu }}" selected?="cpu == selectedCPU">                        {{ cpu == \'all\' ? \'全部\' : cpu + \'核\' }}</option>                    </select>                  </span>                  <span class="mr-5">                    <select class="tc-15-select s" b-model="selectedMEM">                      <option b-repeat="mem in targetMEMs" value="{{ mem }}" selected?="mem == selectedMEM">                        {{ mem == \'all\' ? \'全部\' : mem + \'GB\' }}</option>                    </select>                  </span>                  <span>                    <select class="tc-15-select s" b-model="selectedDeviceType">                      <option b-repeat="mem in targetDeviceTypes" value="{{ mem.value }}"                        selected?="mem.value == selectedDeviceType">{{ mem.label }}</option>                    </select>                  </span>                </p>                <div id="reset-type-instance-type-config-gridview"></div>                <p class="mt-10">                  <label class="form-ctrl-label">                    <input b-model="showOnlySupported" type="checkbox" class="tc-15-checkbox"                      checked="" />仅显示支持的机型</label>                </p>              </div>            </li>          </ul>          <br />          <p b-if="selectedTargetInstanceTypeConfig.type==\'I\'">            注意：高 IO 型实例需配备本地 SSD 硬盘才可获得数据盘较高            I/O读写性能，建议您调整前检查系统盘介质，本次调整不涉及您原有实例挂载的盘类型的变更          </p>        </div>      </div>      <div class="tc-15-rich-dialog-ft">        <div class="tc-15-rich-dialog-ft-btn-wrap">          <button b-if="(!supportedInstances) || (supportedInstances.length == 0)" class="tc-15-btn"            b-on-click="close()">            确定          </button>          <div b-if="supportedInstances && supportedInstances.length">            <button b-if="!!selectedTargetInstanceType" class="tc-15-btn " b-on-click="setStep(2)">              下一步            </button>            <button b-if="!selectedTargetInstanceType" class="tc-15-btn disabled">              下一步            </button>          </div>        </div>      </div>    </div>    <!-- step 2 -->    <div b-if="step == 2">      <div b-if="supportedInstances && supportedInstances.length > 1" class="tc-15-msg mt-20">        <div class="tip-info">          批量调整配置将自动逐条扣费，请保持账户余额充足。        </div>      </div>      <div class="mb-20">        <div class="tc-15-table-panel">          <div class="tc-15-table-fixed-head">            <table class="tc-15-table-box">              <colgroup>                <col style="width: 45px;" />                <col />                <col style="width: 120px;" />                <col />                <col />                <col style="width:140px;" />                <col style="width: 110px;" />              </colgroup>              <thead>                <tr>                  <th>                    <div><span class="text-overflow">NO</span></div>                  </th>                  <th>                    <div><span class="text-overflow">实例名</span></div>                  </th>                  <th>                    <div><span class="text-overflow">实例ID</span></div>                  </th>                  <th>                    <div><span class="text-overflow">当前配置</span></div>                  </th>                  <th>                    <div><span class="text-overflow">目标配置</span></div>                  </th>                  <th>                    <div><span class="text-overflow">计费时长</span></div>                  </th>                  <th class="text-right">                    <div><span class="text-overflow">费用</span></div>                  </th>                </tr>              </thead>            </table>          </div>          <div class="tc-15-table-fixed-body tc-scroll" style="max-height: 140px;">            <table class="tc-15-table-box tc-15-table-rowhover">              <colgroup>                <col style="width: 45px;" />                <col />                <col style="width: 120px;" />                <col />                <col />                <col style="width:140px;" />                <col style="width: 110px;" />              </colgroup>              <tbody>                <tr b-repeat="supportedItem in supportedInstances">                  <td>                    <span class="text">{{ $index + 1 }}</span>                  </td>                  <td>                    <div>                      <span class="text-overflow"                        title="{{ supportedItem.instanceName }}">{{ supportedItem.instanceName }}</span>                    </div>                  </td>                  <td>                    <div>                      <span class="text-overflow">{{                        supportedItem.instanceId                      }}</span>                    </div>                  </td>                  <td>                    <div>                      <span class="text-overflow">{{ supportedItem.instanceType }}({{                          supportedItem.instanceTypeDesc                        }}，{{ supportedItem.CPU }}核{{                          supportedItem.memory                        }}GB)</span>                    </div>                  </td>                  <td>                    <div>                      <span class="text-overflow">{{                        selectedTargetInstanceTypeDesc                      }}</span>                    </div>                  </td>                  <td>                    <div>                      <span class="text-overflow">{{                        supportedItem.chargeTypeTimeDesc                      }}</span>                    </div>                  </td>                  <td class="text-right">                    <div>                      <span class="text-overflow">                        <i b-if="supportedItem.queryPriceLoading" class="n-loading-icon"></i>                        <!--                            <span b-if="!supportedItem.queryPriceLoading && !supportedItem.resetInstanceTypePriceResult.price" class="cost">-</span>                          -->                        <span                          b-if="!supportedItem.queryPriceLoading && supportedItem.resetInstanceTypePriceResult.price"                          class="cost">                          <span class="text" b-if="supportedItem.isResetSameType" data-title="与当前机型规格一致，不需要进行调整">无需调整                          </span>                          <span b-if="!supportedItem.isResetSameType && supportedItem.instanceChargeType == \'PREPAID\'">{{                              supportedItem.resetInstanceTypePriceResult.price                                .isDownGradeRefund                                ? \'退还\' +                                  supportedItem.resetInstanceTypePriceResult                                    .price.returnCost +                                  prepaidPriceUnit                                : supportedItem.resetInstanceTypePriceResult                                    .price.discountPrice + prepaidPriceUnit                            }}</span>                          <span                            b-if="!supportedItem.isResetSameType && !(supportedItem.instanceChargeType == \'PREPAID\')">{{                              supportedItem.resetInstanceTypePriceResult.price                                .unitPriceDiscount                            }}{{ postpaidPriceUnit }}</span>                        </span>                        <span                          b-if="!supportedItem.queryPriceLoading && supportedItem.resetInstanceTypePriceResult.error"                          class="cost text-danger">查询失败</span>                      </span>                    </div>                  </td>                </tr>              </tbody>            </table>          </div>        </div>        <div class="mt-20 tc-15-msg"          b-if="hasPrepaidDownGrade || hasPostpaid || (privateIpChangeInstances&&privateIpChangeInstances.length>=1)">          <ul b-if="hasPrepaidDownGrade">            <li>              退款金额将              <strong>按购买使用的现金和赠送金支付比例</strong>              返还到您的腾讯云账户。            </li>            <li>若购买时使用折扣或代金券，折扣和代金券不予退还。</li>            <li>              <span b-if="hasVPCPrepaidDownGrade && instanceEniLimitResult">降配后实例最多支持{{                  instanceEniLimitResult.eniLimit                }}个网卡，每个网卡最多支持{{                  instanceEniLimitResult.eniIpLimit                }}个IP。</span>              <span b-if="hasVPCPrepaidDownGrade && !instanceEniLimitResult">降配后云主机支持的网卡及IP数量将会发生变化，请密切关注。<a                  href="//cloud.tencent.com/document/product/576/18527" target="_blank">查看网卡配额说明<i                    class="external-link-icon"></i></a></span>            </li>          </ul>          <ul>            <li b-if="privateIpChangeInstances.length == 1">              调整配置后，该实例的内网IP可能发生变化。            </li>            <li b-if="privateIpChangeInstances.length > 1">              调整配置后，<span b-repeat="privateIpChangeItem in privateIpChangeInstances">{{ privateIpChangeItem.instanceId }}({{                  privateIpChangeItem.instanceName                }})                <i b-if="$index != privateIpChangeInstances.length -1">，</i></span>              的内网IP可能发生变化。            </li>            <li b-if="hasPostpaid">              调整配置后，按量计费价格将从第一阶梯开始计费，请谨慎调整，<a                href="https://www.qcloud.com/doc/product/213/%E8%AE%A1%E8%B4%B9%E6%A8%A1%E5%BC%8F%E8%AF%B4%E6%98%8E#2"                target="_blank">查看详情</a>。            </li>          </ul>        </div>        <ul class="form-list mt-20">          <li b-if="hasPrepaid">            <div class="form-label"><label for="">需支付费用合计</label></div>            <div class="form-input">              <div class="form-unit">                <span class="cost"><strong>{{                    prepaidTotalPrice < 0                      ? \'查询失败\'                      : prepaidTotalPrice + prepaidPriceUnit                  }}</strong>                </span>              </div>            </div>          </li>          <li b-if="hasPostpaid">            <div class="form-label"><label for="">需冻结费用合计</label></div>            <div class="form-input">              <div class="form-unit">                <span class="cost"><strong>{{                      postpaidTotalPrice < 0                        ? \'查询失败\'                        : postpaidTotalPrice + postpaidPriceUnit                    }}                  </strong>                </span>              </div>            </div>          </li>        </ul>        <div b-if="hasPrepaid">          <label class="form-ctrl-label">            <input type="checkbox" b-model="agreeResetRule" class="tc-15-checkbox reduce-agree-btn" />            已阅读并同意            <a href="//cloud.tencent.com/document/product/213/15569" target="_blank">实例调整配置费用说明 <i                class="external-link-icon"></i> </a></label>        </div>      </div>      <div class="tc-15-rich-dialog-ft">        <div class="tc-15-rich-dialog-ft-btn-wrap">          <button class="tc-15-btn weak" b-on-click="setStep(1)">上一步</button>          <button            b-if="isQueryPriceSuccess && (hasPrepaid && agreeResetRule || !hasPrepaid) && !isSingleDegradeLimit && !isSingleEniLimit && !isSingleEniIpLimit"            class="tc-15-btn" b-on-click="setStep(3)">            下一步          </button>          <button            b-if="!(isQueryPriceSuccess && (hasPrepaid && agreeResetRule || !hasPrepaid) && !isSingleDegradeLimit && !isSingleEniLimit && !isSingleEniIpLimit)"            class="tc-15-btn disabled" data-title="{{ disabledResetTypeButtonTitle }}">            下一步          </button>        </div>      </div>    </div>    <!-- step 3 -->    <div b-if="step == 3">      <div b-if=" isAllStop" class="param-box">        <div class="param-hd">          <h3>调整配置需要在关机状态下操作，目前所选实例已处于关机状态</h3>        </div>      </div>      <div b-if="!isAllStop" class="param-box">        <div class="tc-15-msg msg-dot mt-10">          <div class="tip-info">            <p>调整配置需要在关机状态下操作：</p>            <div class="num-item">              <p>                <span class="num">1</span>为了避免数据丢失，云服务器将关机中断您的业务。请仔细确认              </p>            </div>            <div class="num-item">              <p>                <span class="num">2</span>强制关机可能会导致数据丢失或文件系统损坏。您也可以主动关机后进行调整配置              </p>            </div>            <div class="num-item">              <p>                <span class="num">3</span>强制关机可能需要您等待较长时间，请耐心等待              </p>            </div>          </div>        </div>        <p class="mt-10">          <label class="form-ctrl-label"><input b-model="agreeForceStop" type="checkbox"              class="tc-15-checkbox" />同意强制关机</label>        </p>      </div>      <div class="tc-15-rich-dialog-ft">        <div class="tc-15-rich-dialog-ft-btn-wrap">          <button class="tc-15-btn" b-on-click="setStep(2)">            上一步          </button>          <button b-if="agreeForceStop || isAllStop" class="tc-15-btn " b-on-click="resetInstanceType()">            开始调整          </button>          <button b-if=" !isAllStop  && !agreeForceStop " class="tc-15-btn disabled">            开始调整          </button>        </div>      </div>    </div>  </div>',
$data:{prepaidPriceUnit:i?"美元":"元",postpaidPriceUnit:i?"美元/小时":"元/小时",regionId:a[0].regionId,zone:a[0].zone,step:1,cvmListLink:g.length?"//console.cloud.tencent.com/cvm/index?uInstanceIds="+g.join("|"):"//console.cloud.tencent.com/cvm/index",isAllStop:d,isAllNotCloudDisk:!a.some(function(a){return a.isCloudDisk}),hasPrepaid:e.some(function(a){return v.isPrepaidPayMode(a.instanceChargeType)}),hasPostpaid:e.some(function(a){return v.isSecondPayMode(a.instanceChargeType)}),privateIpChangeInstances:e.filter(function(a){return-1==a.innerVpcId}),showSelectedDetail:!0,selectedItems:a,supportedInstances:e,supportedInstanceIds:f,agreeForceStop:!1,targetCPUs:["all"],targetMEMs:["all"],targetDeviceTypes:[],selectedCPU:"all",selectedMEM:"all",selectedDeviceType:"",showOnlySupported:!0,allInstanceConfigInfos:[],instancesModificationSet:[],selectedTargetInstanceType:"",selectedTargetInstanceTypeConfig:"",selectedTargetInstanceTypeDesc:"",prepaidTotalPrice:"",postpaidTotalPrice:""},$afterInit:function(){this.$watch("step",function(a){2==a&&this.queryPrice(),q.center()}),this.$watch("[selectedCPU, selectedMEM, selectedDeviceType, showOnlySupported]",function(a){var c=this.filterInstanceConfigs(),d=c.length,e=c.slice(0,b.count);b.setData({page:1,list:e,totalNum:d,totalList:c})}),this.$watch("selectedTargetInstanceType",function(a){var c=b.list.find(function(b){return b.instanceType==a});this.$set({selectedTargetInstanceTypeConfig:c,selectedTargetInstanceTypeDesc:c.instanceType+"("+c.instanceFamilyDesc+"，"+c.cpuDesc+c.memDesc+")"})})},close:function(){q.hide()},toggleShowSelectedDetail:function(){this.$set("showSelectedDetail",!this.showSelectedDetail)},setStep:function(a){this.$set("step",a)},filterInstanceConfigs:function(){var a=this.allInstanceConfigInfos,b=[],c=this.selectedDeviceType,d=this.selectedCPU,e=this.selectedMEM,f=this.showOnlySupported,g=this.instancesModificationSet;return a.filter(function(a){return"all"==c?!0:a.type==c}).forEach(function(a){a.instanceFamilies.forEach(function(c){c.instanceTypes.forEach(function(f){("all"==d&&"all"==e||"all"==d&&e==f.memory||f.cpu==d&&"all"==e||f.cpu==d&&f.memory==e)&&"ENABLE"==f.disable&&"NOT_SUPPORT_CUR_ZONE"!=f.status&&b.push({$soldOut:"SOLD_OUT"==f.status,instanceFamilyDesc:c.typeName,type:a.type,instanceType:f.instanceType,cpu:f.cpu,mem:f.memory,cpuDesc:f.cpu+" 核",memDesc:f.memory+" GB",cpuModelAndFrequency:"-"==f.cpuModelName?"-":f.cpuModelName+"("+f.frequency+")",maxBandwidthDesc:f.maxBandwidth+" Gbps",ppsDesc:f.pps&&0!=f.pps?f.pps+" 万pps":"-",remark:f.remark||"无"})})})}),b.filter(function(a){var b=g.find(function(b){return b.instanceTypeConfig.instanceType==a.instanceType});return b?(a.$disable="UNAVAILABLE"==b.status,a.$disabledTips=B.parse(b.message)):(a.$disable=!0,a.$disabledTips="不支持调整到该机型"),a.$soldOut&&(a.$disable=!0,a.$disabledTips="该机型已售罄"),f?!a.$disable:!0}).map(function(a,b){return Object.assign(a,{index:b})})},queryPrice:function(){var a=this;if(this.queryPriceInstanceType!=this.selectedTargetInstanceType){var b=this.supportedInstances.map(function(a){return Object.assign({},a,{queryPriceLoading:!0})});this.$set("supportedInstances",b),this.$set({hasPrepaidDownGrade:!1,prepaidTotalPrice:"",postpaidTotalPrice:"",isSingleDegradeLimit:!1,isSingleEniLimit:!1,isSingleEniIpLimit:!1,isQueryPriceSuccess:!1,disabledResetTypeButtonTitle:null});var c=this.supportedInstanceIds,d=this.selectedTargetInstanceType,e=this.regionId;Promise.all(c.map(function(a){return l({regionId:e,instanceId:a,instanceType:d})})).then(function(f){b=b.map(function(a){return Object.assign({},a,{queryPriceLoading:!1,isResetSameType:d==a.instanceType,resetInstanceTypePriceResult:f.find(function(b){return b.instanceId==a.instanceId})})}),a.$set("hasPrepaidDownGrade",f.some(function(a){return a.price&&a.price.isDownGradeRefund})),a.$set("hasVPCPrepaidDownGrade",f.some(function(b){var c=a.supportedInstances.find(function(a){return a.instanceId==b.instanceId});return b.price&&b.price.isDownGradeRefund&&c.virtualPrivateCloud&&c.virtualPrivateCloud.vpcId}));for(var g=0,i=0,j=0;j<b.length;j++){var k=b[j];if(!k.resetInstanceTypePriceResult.price){v.isPrepaidPayMode(k.instanceChargeType)?g=-1:v.isSecondPayMode(k.instanceChargeType)&&(i=-1);break}k.isResetSameType||(k.resetInstanceTypePriceResult.price.discountPrice?g+=k.resetInstanceTypePriceResult.price.discountPrice:k.resetInstanceTypePriceResult.price.unitPriceDiscount&&(i+=k.resetInstanceTypePriceResult.price.unitPriceDiscount))}a.$set({prepaidTotalPrice:g.toFixed(2),postpaidTotalPrice:i.toFixed(2),supportedInstances:b,isQueryPriceSuccess:a.prepaidTotalPrice>=0&&a.postpaidTotalPrice>=0}),1==a.supportedInstances.length&&h({regionId:e,instanceId:c[0],cpu:a.selectedTargetInstanceTypeConfig.cpu,mem:a.selectedTargetInstanceTypeConfig.mem}).then(function(b){var c=!1,d=!1,e=!1,f=a.supportedInstances[0];if(c=a.hasPrepaid&&a.hasPrepaidDownGrade&&f.isDegradeLimit,f.networkInterfaceSet&&f.networkInterfaceSet.length){d=f.networkInterfaceSet.length>b.eniLimit;var g=0;f.networkInterfaceSet.forEach(function(a){g=Math.max(g,a.privateIpAddressSet&&a.privateIpAddressSet.length||0)}),e=g>b.eniIpLimit}var h=void 0;c?h="该实例调整配置次数已达上限":d?h="当前实例绑定的网卡已超过配额，请先解绑网卡，再调整配置":e&&(h="当前实例绑定的网卡已超过配额，请先更换其他网卡或释放IP"),a.$set({instanceEniLimitResult:b,isSingleDegradeLimit:c,isSingleEniIpLimit:e,isSingleEniLimit:d,disabledResetTypeButtonTitle:h})})}),this.queryPriceInstanceType=this.selectedTargetInstanceType}},resetInstanceType:function(){var a=this.selectedTargetInstanceType,b=this.supportedInstances,d=this.regionId,e=this.agreeForceStop,f=this.prepaidPriceUnit,g=this.postpaidPriceUnit;if(1==b.length)return void(v.isPrepaidPayMode(b[0].instanceChargeType)?C.apiRequest({serviceType:"cvm",action:"SwitchParameterResetInstancesType",data:{InstanceIds:[b[0].instanceId],InstanceType:a,ForceStop:e,Version:"2017-03-12"},regionId:d}).then(function(a){var b=a&&a.Response.InstanceOrder.goods;c.toPay2(b)}):n({regionId:d,instanceIds:[b[0].instanceId],instanceType:a,forceStop:e}).then(function(a){q.hide();var b=c.cloudAPIActionNameMap&&c.cloudAPIActionNameMap.cvm&&c.cloudAPIActionNameMap.cvm.ResetInstancesType||"调整配置中";c.checkTask({taskId:a.response.taskId},b),setTimeout(function(){c.listIns&&c.listIns.reload(),c.callback&&c.callback()},250)}));b=b.filter(function(a){return!a.isResetSameType});var h=new s({$tpl:'  <div class="tc-15-rich-dialog-bd">    <div class="tc-15-msg">      <div class="tip-info">        <p>批量调整配置将通过API方式自动逐条扣费，请保持账户余额充足。</p>        <p class="text-warning">调整过程中请不要关闭窗口，关闭窗口将中断操作</p>      </div>    </div>    <div class="tag-popup">      <div class="tc-15-progress ">        <div class="tc-15-progress-value" style="width:{{            (resetingInstanceInfos.length / supportedInstances.length) * 100 +              \'%\'          }}">          <span b-if="resetingInstanceId">正在调整：{{ resetingInstanceId }}</span>          <span class="text-right">{{ resetingInstanceInfos.length }}/{{              supportedInstances.length            }}</span>        </div>      </div>      <div class="pt-20 ">        <p class="">          调整{{ supportedInstances.length }}个实例，<span class="text-success">已成功{{ successNumber }}个</span>，<span            class="text-danger">失败{{ failNumber }}个</span>，等待{{            supportedInstances.length - successNumber - failNumber          }}个，          <a href="javascript:;" b-on-click="toggleShowResetDetail()">            <span>{{ showResetDetail ? \'收起\' : \'展开\' }}</span>            <i b-if="!showResetDetail" class="blue-down-icon"></i>            <i b-if="showResetDetail" class="blue-up-icon"></i>          </a>        </p>      </div>      <div b-if="showResetDetail" class="tag-modify">        <ul>          <li b-repeat="resetingInstanceInfo in resetingInstanceInfos"            class="{{ resetingInstanceInfo.success ? \'\' : \'text-danger\' }}">            <span>{{ resetingInstanceInfo.timeInfo }}</span>            <span>{{ resetingInstanceInfo.sourceInfo }}</span>            <span>{{ resetingInstanceInfo.targetInfo }}</span>            <span>{{ resetingInstanceInfo.priceInfo }}</span>            <span>{{ resetingInstanceInfo.resetResultInfo }}</span>            <span b-if="resetingInstanceInfo.failReason">{{              resetingInstanceInfo.failReason            }}</span>          </li>        </ul>      </div>    </div>  </div>',$data:{stop:!1,supportedInstances:b,resetingInstanceId:"",resetingInstanceInfos:[],successNumber:0,failNumber:0,showResetDetail:!0},toggleShowResetDetail:function(){this.$set("showResetDetail",!this.showResetDetail)}});q.hide(),q.create(h.$el,650,"",{struct:"rich",title:"调整配置",isMaskClickHide:!1,button:{" 完成 ":function(){h.$set("stop",!0),setTimeout(function(){c.listIns&&c.listIns.reload(),c.callback&&c.callback()},250),q.hide()}},defaultCancelCb:function(){h.$set("stop",!0),setTimeout(function(){c.listIns&&c.listIns.reload(),c.callback&&c.callback()},250),q.hide()},onload:function(){function c(){return i.apply(this,arguments)}var i=_asyncToGenerator(regeneratorRuntime.mark(function j(){var c,i,k;return regeneratorRuntime.wrap(function(j){for(;;)switch(j.prev=j.next){case 0:c=0;case 1:if(!(c<b.length)){j.next=20;break}if(!h.stop){j.next=4;break}return j.abrupt("break",20);case 4:return i=b[c],k={timeInfo:r.formatDate(new Date,"yyyy-MM-dd hh:mm:ss"),sourceInfo:"调整："+i.instanceId,targetInfo:"配置到："+a,priceInfo:i.resetInstanceTypePriceResult.price.isDownGradeRefund?"退还"+i.resetInstanceTypePriceResult.price.returnCost+f:"undefined"!=typeof i.resetInstanceTypePriceResult.price.discountPrice?"支付"+i.resetInstanceTypePriceResult.price.discountPrice+f:"冻结"+i.resetInstanceTypePriceResult.price.unitPriceDiscount+g},h.$set("resetingInstanceId",i.instanceId),j.prev=7,j.next=10,n({regionId:d,instanceIds:[i.instanceId],instanceType:a,forceStop:e});case 10:h.$set("resetingInstanceInfos",h.resetingInstanceInfos.concat(Object.assign(k,{success:!0,resetResultInfo:"成功！"}))),j.next=16;break;case 13:j.prev=13,j.t0=j["catch"](7),h.$set("resetingInstanceInfos",h.resetingInstanceInfos.concat(Object.assign(k,{success:!1,resetResultInfo:"失败！",failReason:j.t0.message})));case 16:h.$set({successNumber:h.resetingInstanceInfos.filter(function(a){return!!a.success}).length,failNumber:h.resetingInstanceInfos.filter(function(a){return!a.success}).length,resetingInstanceId:""});case 17:c++,j.next=1;break;case 20:case"end":return j.stop()}},j,this,[[7,13]])}));return c}()})}});return b.$watch("selectedInstanceType",function(a){j.$set("selectedTargetInstanceType",a)}),j}function n(a){return u.apiRequest({regionId:a.regionId,serviceType:"cvm",action:"ResetInstancesType",data:{InstanceIds:a.instanceIds,InstanceType:a.instanceType,ForceStop:a.forceStop}})}function o(){var a=[{name:"",key:"radio",width:40,tdTpl:'  <span class="text"><input type="radio" b-model="selectedInstanceType" value="{{ item.instanceType }}"      name="instance-type" class="tc-15-radio" disabled?="item.$soldOut || item.$disable" /></span>'},{name:"机型",key:"instanceFamilyDesc"},{name:"规格",key:"instanceType"},{name:"vCPU",key:"cpuDesc",width:60},{name:"内存",key:"memDesc",width:70},{name:"处理器型号（主频）",key:"cpuModelAndFrequency",width:210},{name:"内网带宽",key:"maxBandwidthDesc"},{name:"网络收发包",key:"ppsDesc"},{name:"备注",key:"remark"}],b=s.getComponent("grid-view");return new b({events:{"click tr[data-instancetype] input[type=radio]":function(a){}},$data:{selectedInstanceType:"",totalList:[],hasFirst:!1,initGetData:!1,canResizeColum:!1,selectedHighlight:!0,colums:a,canSelectTotal:!1,minHeight:200,autoMaxHeight:!1,maxHeight:260,maxHeightOffset:10,autoCheckWidth:!1,showState:!0,showPagination:!0,trackKey:"instanceType",emptyTips:"当前过滤条件下没有可以调整的机型"},getData:function(a,b){var c=this.totalList,d=c.slice((a.page-1)*a.count,a.page*a.count);this.setData({list:d,page:a.page,count:a.count})},setTrAttr:function(a,b){var c=this.count;return a={"data-instancetype":b.instanceType},b.$disable&&b.$disabledTips&&(a["qc-popover"]=b.$disabledTips,a["data-position"]=b.index%c===0?"bottom":"top",a["data-hide-destroy"]=!0),a}})}var p=a("cvm/cvm/event/operate_base"),q=a("dialog"),r=a("appUtil"),s=a("qccomponent"),t=a("cvm/cvm/data"),u=a("cvm/common/model"),v=a("cvm/cvm/cvmutil"),w=a("cvm/cbs2/cbsutil"),x=a("cvm/common/constants"),y=a("widget/mfa/mfa"),z=a("cvm/cvm/event/upgradeconfig/cdhupgradeconfig"),A=a("cvm/cvm/event/selectedShow/selectedShow"),B=a("cvm/common/simpleMarked"),C=a("models/iaas"),D=function(a){p.call(this,a)};D.prototype=new p,D.prototype.cdhUpgradeConfig=function(){var a=this;y.verify({api:"cvm:ResetInstancesType"}).then(function(){var b=a.hasPermItems[0],c=new z({selectedItem:b,listIns:a}),d=v.isStopped(b.instanceState),e={shutdown:{" 确定 ":function(){c.doAction(!1).then(function(b){q.hide(),a.checkTask({taskId:b.response.taskId},"调整配置中"),a.callback&&a.callback()},function(a){q.toggleBtnDisable(!1)})}},nonShutdown:{" 下一步 ":function(){a.toConfirmShutdown({confirmTpl:'  <div class="text-tips">    <p>      1、为了避免数据丢失，配置调整需要在      <em class="text-danger">关机</em>状态下操作，实例将关机中断您的业务，请仔细确认    </p>    <p>      2、强制关机可能会导致数据丢失或文件系统损坏，您也可以主动关机后进行调整配置    </p>    <p>3、强制关机可能需要您等待较长时间，请耐心等待</p>    <p>      <label class="form-ctrl-label">        <input type="checkbox" b-model="agree" class="tc-15-checkbox" />同意强制关机</label>    </p>  </div>',title:"升级配置",confirmBtnTxt:"去调整"}).done(function(){c.doAction(!0).then(function(b){q.hide(),a.checkTask({taskId:b.response.taskId},"调整配置中"),a.callback&&a.callback()})},function(a){q.toggleBtnDisable(!1)})}}},f=e[d?"shutdown":"nonShutdown"];q.create(c.$el,"600","",{title:"升级配置","class":"dialog_layer_v2 tc-15-rich-dialog new-gateway",preventResubmit:!0,button:f}),A.render(a.selectedShowOptions)})},D.prototype.exec=function(){var a=this,b=a.hasPermItems.map(function(a,b){return a.isCloudDisk=w.isCloudDiskType(a.systemDisk.storageType),Object.assign({},a,{disabledResetType:d(a),chargeTypeTimeDesc:e(a)})});return 1==b.length&&v.isCDHPayMode(b[0].instanceChargeType)?a.cdhUpgradeConfig():void y.verify({api:"cvm:ResetInstancesType"}).then(function(){a.gridView=o(),a.resetTypeBee=m(b,a.gridView,a),q.create(a.resetTypeBee.$el,1145,"",{isMaskClickHide:!1,struct:"rich",title:"调整配置",defaultCancelCb:function(){a.resetTypeBee.$destroy()}}),q.el.find("#reset-type-instance-type-config-gridview").html(a.gridView.$el),q.center();var c=[{name:"zone",values:[a.resetTypeBee.zone]}],d=[];a.resetTypeBee.hasPrepaid&&d.push(x.INSTANCEPAYMODE.PREPAID),a.resetTypeBee.hasPostpaid&&d.push(x.INSTANCEPAYMODE.POSTPAID_BY_HOUR),d.length&&c.push({name:"instance-charge-type",values:d}),a.resetTypeBee.supportedInstanceIds&&a.resetTypeBee.supportedInstanceIds.length&&(Promise.all([t.fetchInstanceConfigInfos(a.resetTypeBee.regionId),t.fetchZoneInstanceConfigInfos({data:{filters:c,instanceIds:a.resetTypeBee.supportedInstanceIds,inquiryType:"INQUIRY_MODIFY_TYPE"},regionId:a.resetTypeBee.regionId}),f({regionId:a.resetTypeBee.regionId,instanceIds:a.resetTypeBee.supportedInstanceIds})]).then(function(b){var c=_slicedToArray(b,3),d=c[0].response.instanceConfigInfos,e=void 0===d?[]:d,f=c[1].response.instanceTypeQuotaSet,g=void 0===f?[]:f,h=c[2].response.instanceTypeConfigStatusSet,i=void 0===h?[]:h,l=k(e,j(g));a.resetTypeBee.$set({allInstanceConfigInfos:l,instancesModificationSet:i,targetDeviceTypes:[{label:"全部机型",value:"all",$checked:!0}].concat(e.sort(function(a,b){return a.order-b.order}).map(function(a){return{label:a.typeName,value:a.type}}))}),a.resetTypeBee.$set("selectedDeviceType",[a.resetTypeBee.targetDeviceTypes[0].value]);var m={},n={};e.forEach(function(a){a.instanceFamilies.forEach(function(a){a.instanceTypes.forEach(function(a){m[a.cpu]=!0,n[a.memory]=!0})})}),Object.keys(m).length&&a.resetTypeBee.$set("targetCPUs",a.resetTypeBee.targetCPUs.concat(Object.keys(m))),Object.keys(n).length&&a.resetTypeBee.$set("targetMEMs",a.resetTypeBee.targetMEMs.concat(Object.keys(n)))})["catch"](function(a){console.error(a)}),1==a.resetTypeBee.supportedInstanceIds.length&&Promise.all([g({regionId:a.resetTypeBee.regionId,instanceIds:[a.resetTypeBee.supportedInstanceIds[0]],operation:"INSTANCE_DEGRADE"}),i({regionId:a.resetTypeBee.regionId,instanceId:a.resetTypeBee.supportedInstanceIds[0]})]).then(function(b){var c=_slicedToArray(b,2),d=c[0],e=c[1],f=d&&d.currentCount>=d.limitCount;a.resetTypeBee.supportedInstances[0].isDegradeLimit=f,a.resetTypeBee.supportedInstances[0].networkInterfaceSet=e,a.resetTypeBee.$set("supportedInstances",a.resetTypeBee.supportedInstances)}))})},c.exports=D}),define("cvm/cvm/event/returnWanIp/returnWanIp",function(a,b,c){var d,e=(a("$"),a("cvm/cvm/event/operate_base")),f=a("dialog"),g=a("util"),h=a("cvm/eip2/data"),i=a("cvm/eip2/common/util"),j=a("cvm/common/renderMonitor"),k={main:'  <div>    <div class="tip_box">        确定要释放实例：<strong><%=instanceId%>(<%=instanceName%>)</strong>上的公网IP：<strong><%=wanIp%></strong>？    </div>    <p>释放公网IP后将无法访问外网，建议您绑定弹性公网IP。</p>  </div>'},l=function(a){e.call(this,a)};l.prototype=new e,l.prototype.exec=function(){d=j.init(c.id,"kennyang"),d&&d.renderBefore();var a=this,b=a.hasPermItems[0];a.wanIp=b.deviceWanIp,a.instanceId=b.uInstanceId,a.instanceName=b.alias,a.regionId=b.regionId,f.create(g.tmpl(k.main,{instanceName:a.instanceName,instanceId:a.instanceId,wanIp:a.wanIp}),600,"",{title:"释放公网IP",button:{" 确定 ":function(){a.ConfirmReturn()}}}),d&&d.renderSuccess()},l.prototype.ConfirmReturn=function(){var a=this,b=this.cloudAPIActionNameMap.vpc&&this.cloudAPIActionNameMap.vpc.ReturnNormalAddresses||"释放中";i.getConfirm({title:"释放公网IP",content:"请确认公网IP："+a.wanIp+" 的释放操作。<br>释放公网IP后，该IP将无法找回，您的服务可能会受影响，请提前做好准备！"},function(){h.returnWanIp({ips:[a.wanIp],regionId:a.regionId},{camTipsType:"dialog"}).then(function(c){f.hide(),a.checkTask({taskId:c.response&&c.response.taskId},b),a.callback&&a.callback()})})},c.exports=l}),define("cvm/cvm/event/selectedShow/selectedShow",function(a,b,c){var d=a("$"),e=a("util"),f=a("event"),g=a("dialog"),h=a("appUtil"),i={main:'  <div class="act-outline" id="selectedShowWrap">    <style>      .dev-bold {        font-weight: bold;      }      .dev-title-col {        margin-bottom: 0px !important;        border-bottom: none !important;      }      .dev-content-col {        margin-top: 0px !important;      }      .dev-name-col {        width: 142px !important;      }    </style>    <div class="act-summary">      您已选      <strong> <%-allLength%>台 <%=insName%> </strong>，      <a href="javascript:;" data-event="s_show_detail"        >查看详情<i id="selectedShowIconArr" class="blue-down-icon"></i      ></a>    </div>    <div id="selectedShowDetail">      <div class="tc-15-table-panel">        <div class="tc-15-table-fixed-head">          <table class="tc-15-table-box">            <colgroup>              <col style="width: 60px;" />              <col />              <col />              <col />            </colgroup>            <thead>              <tr>                <th>                  <div><span class="text-overflow">No.</span></div>                </th>                <th>                  <div><span class="text-overflow">实例名</span></div>                </th>                <th>                  <div><span class="text-overflow">实例ID</span></div>                </th>                <th>                  <div><span class="text-overflow" title="当前带宽上限">当前带宽上限</span></div>                </th>              </tr>            </thead>          </table>        </div>        <div class="tc-15-table-fixed-body" style="max-height: 243px;">          <table class="tc-15-table-box tc-15-table-rowhover">            <colgroup>              <col style="width: 60px;" />              <col />              <col />              <col />            </colgroup>            <tbody>              <% for (var i = 0, item; item = allItems[i]; i++) { %>              <tr>                <td>                  <div class="">                    <span class="text-overflow"><%=i+1%></span>                  </div>                </td>                <td>                  <div class="">                    <span class="text-overflow"><%=item.name%></span>                  </div>                </td>                <td>                  <div class="">                    <span class="text-overflow"                      ><a                        data-event="nav"                        href="/cvm/detail/<%=regionId%>/<%=item.id%>?backfrom=cvmdetail"                      >                        <%=item.id%>                      </a></span                    >                  </div>                </td>                <td>                  <div class="">                    <span class="text-overflow"> <%=item.bandwidth%></span>                  </div>                </td>              </tr>              <% } %>            </tbody>          </table>        </div>      </div>    </div>  </div>'},j={render:function(a){var b=a.hasPermItems||[],c=a.noPermItems||[],f=[],j=b[0]&&b[0].regionId||h.getRegionId();f=f.concat(c).concat(b);var k=a.tpl||e.tmpl(i.main,{regionId:j,actionName:a.actionName||"",allItems:f,allLength:f.length,hasPermItems:b,noPermItems:c,insName:a.insName||"实例"});b.length||g.toggleBtnDisable(1),a.renderTo?d(a.renderTo).html(k):g.el&&g.el.find(".dialog_layer_cont").prepend(k),g.center(),this.bindEvt()},bindEvt:function(){var a=this;f.addCommonEvent("click",{s_show_detail:function(){a._toggleBox()}})},_toggleBox:function(){var a=d("#selectedShowDetail"),b=d("#selectedShowIconArr");a.toggle(),a.is(":visible")?b.removeClass("blue-down-icon").addClass("blue-up-icon"):b.removeClass("blue-up-icon").addClass("blue-down-icon")}};c.exports=j}),define("cvm/cvm/event/setAutoRenew/setAutoRenew",function(a,b,c){var d,e=a("$"),f=a("cvm/common/constants"),g=a("cvm/cvm/cvmutil"),h=a("cvm/cvm/event/operate_base"),i=a("dialog"),j=a("cvm/common/model"),k=a("cvm/common/renderMonitor"),l=a("widget/mfa/mfa"),m=a("manager"),n=Bee.getComponent("grid-view"),o=a("tips"),p=a("appUtil"),q={main:'  <div class="cvm-ip-dialog">    <div class="tc-15-msg">      <div class="tip-info">· 设置自动续费后，将于到期当日，        <i class="text-warning">按月自动续费</i>，请确保余额充足</div>      <div class="tip-info">· 若续费时有可用代金券，系统将自动使用代金券续费，        <a href="https://cloud.tencent.com/document/product/555/7428" target="_blank">代金券说明</a>      </div>      <div class="tip-info">· 如果您的设备今天到期，请选择手动续费</div>      <div class="tip-info">· 如您在扣款日前人工续费，则系统按最新到期时间自动进行续费</div>    </div>    <div class="mb-10">      <strong>下列实例        <span class="text-warning">（共{{isRenewCbs ? currInstanceIds.length + currDiskIds.length : currInstanceIds.length}}项，其中实例{{currInstanceIds.length          }}项，云硬盘{{isRenewCbs ? currDiskIds.length: 0}}项）</span>将        <span b-if="!isRenewCvm">关闭</span>        <span b-if="isRenewCvm">开启</span>        自动续费        <a href="#" b-on-click="toggleShowList()">{{isShowList ? \'收起详情\' : \'查看详情\'}}          <i b-class="isShowList ? \'blue-up-icon\': \'blue-down-icon\'"></i>        </a>      </strong>    </div>    <div id="renewList" b-if="isShowList" class="mb-20"></div>    <ul class="form-list">      <li class="pure-text-row">        <div class="form-label">          <label for="">实例自动续费</label>        </div>        <div class="form-input">          <div class="form-unit">            <label class="form-ctrl-label-stacked">              <input checked?="isRenewCvm" b-on-click="renewCvm(true)" value="renew" type="radio" name="renewItem" class="tc-15-radio">启用            </label>            <label class="form-ctrl-label-stacked">              <input checked?="!isRenewCvm" b-on-click="renewCvm(false)" value="disRenew" type="radio" name="renewItem" class="tc-15-radio">关闭（到期后，实例将自动回收，请谨慎选择）            </label>          </div>        </div>      </li>      <li class="pure-text-row">        <div class="form-label">          <label for="">云硬盘选项：</label>        </div>        <label class="form-ctrl-label-stacked">          <input checked?="isRenewCbs" class="tc-15-checkbox" data-checkbox type="checkbox" b-on-change="renewCbs()" />同时应用到已挂载的云硬盘</label>      </li>      <li b-if="isRenewCvm">        <div class="form-label">          <label for="">每月费用：</label>        </div>        <div class="form-input">          <div class="form-unit">            <span class="cost">¥              <strong>{{totalPrice.discountPrice}}</strong>              <em style="font-size: 12px;">元</em>            </span>            <span class="ml-10 original-cost">¥              <strong>{{totalPrice.originalPrice}}</strong>              <em style="font-size: 12px;">元</em>            </span>          </div>        </div>      </li>    </ul>  </div>'},r=Bee.extend({$tpl:q.main,toI18nMoney:a("widget/i18n").toI18nMoney,$afterInit:function(){var a=this;this.$watch("currInstanceIds",function(){a.validate()})},validate:function(){if(this.$get("currInstanceIds").length)return e(".btn_blue")[0].title&&(e(".btn_blue")[0].title=""),void i.toggleBtnDisable(!1);i.toggleBtnDisable(!0);var a="";return a=this.$get("isRenewCvm")?"您选择的实例自动续费已全部开启，请重新选择":"您选择的实例自动续费已全部关闭，请重新选择",void(e(".btn_blue")[0].title=a)},renewCvm:function(a){this.$set("isRenewCvm",a),this.$set("isRenewCbs",a);var b=a?this.$get("instanceIds"):this.$get("renewedInstanceIds"),c=a?this.$get("diskIds"):this.$get("renewedDiskIds");this.$set("currInstanceIds",b),this.$set("currDiskIds",c);var d=this.getColumns();this.gridView.setColums(d)},renewCbs:function(){this.$set("isRenewCbs",!this.$get("isRenewCbs")),this.queryPrice()},toggleShowList:function(){this.$set("isShowList",!this.$get("isShowList"))},queryPrice:function(){var a=this,b=a.$get("instanceIds");if(b.length){var c={instanceChargePrepaid:{period:"1",renewFlag:"NOTIFY_AND_AUTO_RENEW"},instanceIds:b,renewPortableDataDisk:a.$get("isRenewCbs")},d=a.$get("regionId");return j.apiRequest({serviceType:"cvm",action:"InquiryPriceRenewInstances",data:c,regionId:d}).then(function(b){a.$set("totalPrice",b.response.price.instancePrice)})}},getColumns:function(){return[{key:"alias",name:"自动续费项",minWidth:100,tdTpl:'<div><div><p class="text-overflow">实例：{{item.alias}}</p><p class="text-overflow text-weak">所属网络：{{item.netName}}</p><p class="text-overflow text-weak">内网IP：{{item.deviceLanIp}}</p></div></div>'},{key:"renewFlag",name:"当前自动续费状态",width:130,tdTpl:'<div>{{item.renewFlag === "NOTIFY_AND_AUTO_RENEW" ? "启用": "关闭"}}</div>'},{key:"config",name:"配置",width:100},{key:"bandwidth",name:"续费带宽",width:75},{key:"expiredTime",name:"到期时间",width:100},{key:"nextLine",name:"自动续费",width:110}]},renderDeviceList:function(){var a=this,b={$data:{showPagination:!1,showState:!1,canSelectTotal:!1,hasFirst:!1,maxHeight:150,minHeight:"auto",autoMaxHeight:!1,maxHeightOffset:10,colums:a.getColumns()},getCellContent:function(b,c,d){if("config"==d.key)return"<div><p>"+c.instanceTypeDesc+"</p><p>"+c.cpuInfo+"，"+c.memInfo+"</p></div>";if("bandwidth"==d.key)return"<div>"+c.bandwidthInfo+"</div>";if("expiredTime"==d.key)return c.uHostId?"<div>不计费</div>":"<div>"+p.formatDate(new Date(c.expiredTime),"yyyy-MM-dd")+"</div>";if("nextLine"==d.key){if(c.uHostId)return"<div>不计费</div>";var e="";return e=a.$get("isRenewCvm")?'<div class="text-warning">'+a.getExpires(c.expiredTime,1)+"</div>":'<div  class="text-warning">到期不续费</div>'}},events:{},getData:function(){}};this.gridView=new n(b),e("#renewList").append(this.gridView.$el)},getExpires:function(a,b){return m.getNextDate(a,parseInt(b))}},{defaults:{isShowList:!0}}),s=function(a){h.call(this,a)};s.prototype=new h,s.prototype.getExpires=function(a,b){return m.getNextDate(a,parseInt(b))},s.prototype.renderDeviceList=function(a){var b=this,c={$data:{showPagination:!1,showState:!1,canSelectTotal:!1,hasFirst:!1,maxHeight:150,minHeight:"auto",autoMaxHeight:!1,maxHeightOffset:10,colums:[{key:"alias",name:"自动续费项",minWidth:100,tdTpl:'<div><div><p class="text-overflow">实例：{{item.alias}}</p><p class="text-overflow text-weak">所属网络：{{item.netName}}</p><p class="text-overflow text-weak">内网IP：{{item.deviceLanIp}}</p></div></div>'},{key:"renewFlag",name:"当前自动续费状态",width:130,tdTpl:'<div>{{item.renewFlag === "NOTIFY_AND_AUTO_RENEW" ? "启用": "关闭"}}</div>'},{key:"config",name:"配置",width:100},{key:"bandwidth",name:"续费带宽",width:75},{key:"expiredTime",name:"到期时间",width:100},{key:"nextLine",name:"自动续费",width:110}]},getCellContent:function(a,c,d){if("config"==d.key)return"<div><p>"+c.instanceTypeDesc+"</p><p>"+c.cpuInfo+"，"+c.memInfo+"</p></div>";if("bandwidth"==d.key)return"<div>"+c.bandwidthInfo+"</div>";if("expiredTime"==d.key)return c.uHostId?"<div>不计费</div>":"<div>"+p.formatDate(new Date(c.expiredTime),"yyyy-MM-dd")+"</div>";if("nextLine"==d.key){if(c.uHostId)return"<div>不计费</div>";var e="";return e="NOTIFY_AND_AUTO_RENEW"===c.renewFlag&&b.$get("isRenewCvm")?'<div  class="text-warning">到期不续费</div>':'<div class="text-warning">'+b.getExpires(c.expiredTime,1)+"</div>"}},events:{},getData:function(){}};this.gridView=new n(c),e("#renewList").append(this.gridView.$el),this.gridView.setData({list:this.hasPermItems}),i&&i.center()},s.prototype.exec=function(){var a=this;l.verify({api:"cvm:ModifyInstancesRenewFlag"}).then(function(){d=k.init(c.id,"kennyang"),d&&d.renderBefore();var b=a.hasPermItems,e=[],h=[],l=[],m=[],n=!1;b.forEach(function(a){g.isPrepaidPayMode(a.instanceChargeType)&&(g.isAutoRenewMode(a.renewFlag)?(h.push(a.uInstanceId),a.dataDisks&&a.dataDisks.map(function(a){g.isLocalDiskType(a.storageType)||m.push(a.diskId)})):(n=!0,e.push(a.uInstanceId),a.dataDisks&&a.dataDisks.map(function(a){g.isLocalDiskType(a.storageType)||l.push(a.diskId)})))});var p=new r({$data:{regionId:b[0].regionId,isRenewCbsDef:n,isRenewCvmDef:n,isRenewCvm:n,isRenewCbs:n,totalPrice:{discountPrice:0,originalPrice:0},instanceIds:e,diskIds:l,renewedInstanceIds:h,renewedDiskIds:m,currInstanceIds:n?e:h,currDiskIds:n?l:m}});p.queryPrice(),i.create(p.$el,"800","",{title:"设置自动续费",preventResubmit:!0,hideIcon:!0,defaultCancelCb:function(){},button:{" 确定 ":function(){var c=f.INSTANCERENEWFLAG.NOTIFY_AND_AUTO_RENEW;if(p.$get("isRenewCvm")||(e=h,l=m,c=f.INSTANCERENEWFLAG.NOTIFY_AND_MANUAL_RENEW),!e.length)return o.error("请选择将要启动/关闭自动续费的实例"),void i.toggleBtnDisable(!0);var d=j.apiRequest({regionId:b[0].regionId,serviceType:"cvm",action:"ModifyInstancesRenewFlag",data:{InstanceIds:e,RenewFlag:c}},{camTipsType:"dialog"}).then(function(){p.$get("isRenewCbs")&&l.length||(i.hide(),a.refreshList&&a.refreshList(!0),o.success("修改成功"),a.callback&&a.callback())});if(p.$get("isRenewCbs")&&l.length){var g=j.apiRequest({regionId:b[0].regionId,serviceType:"cbs",action:"ModifyDisksRenewFlag",data:{DiskIds:l,RenewFlag:c}},{camTipsType:"dialog"});Promise.all([d,g]).then(function(){i.hide(),a.refreshList(!0),o.success("修改成功")})["catch"](function(a){console.warn(a)})}}},onload:function(){d&&d.renderSuccess()}}),p.renderDeviceList(),p.gridView.setData({list:a.hasPermItems}),i&&i.center()})},c.exports=s}),define("cvm/cvm/event/shutdown/shutdown",function(a,b,c){var d,e=a("$"),f=(a("manager"),a("cvm/cvm/event/operate_base")),g=a("dialog"),h=a("util"),i=a("cvm/cvm/event/shutdownSelectedShow/shutdownSelectedShow"),j=(a("cvm/common/model"),a("cvm/cvm/data")),k=a("widget/mfa/mfa"),l=a("cvm/cvm/cvmutil"),m=a("cvm/common/renderMonitor"),n={main:'  <span class="tit">确定对选中的实例进行关机？</span> <br />  <% if (showStopCharge) {%>  <label for="shutdownStopChargeCheck" class="confirm-it">    <input      type="checkbox"      class="tc-15-checkbox"      id="shutdownStopChargeCheck"      disabled    />关机不收费  </label>  <div class="tc-15-msg msg-dot mt-10">    <div class="tip-info">      <div id="shutdownStopChargeConditions">        <p style="margin-left:-1px;font-weight: bold;">          关机不收费，满足以下条件方可进行操作：        </p>        <p class="dot-item">按量计费实例</p>        <p class="dot-item">实例系统盘和数据盘同时为云硬盘</p>        <p class="dot-item">非GPU、FPGA异构计算的实例</p>      </div>      <div id="shutdownStopChargeCheckTips" style="display:none">        <p style="font-weight: bold;">关机后，请注意以下信息：</p>        <p class="dot-item">          关机后，将释放CPU、内存，并停止对CPU、内存的计费，<strong>所关联硬盘、镜像、公网带宽(如需计费)依然计费</strong>        </p>        <p class="dot-item">          关机后，实例的 CPU          、内存将不再保留，所以再次启动实例时可能会失败。此时，您可以尝试再次启动，或者换一个时间再次启动        </p>        <p class="dot-item">          <strong>关机后，普通公网 IP 将被释放不可找回，建议您先转换为弹性公网 IP          后再进行关机操作</strong>        </p>        <p class="dot-item">          <strong>关机后，弹性公网 IP 将被保留，不会被释放，关机期间也不收取费用</strong>        </p>        <p class="dot-item">          关机期间实例较多操作（如调整配置、重装系统等）无法支持，如需操作请开机后进行        </p>        <p id="shutdownContinueChargeCheckTips" style="font-weight: bold;display:none;">不支持关机不收费的实例，关机后继续正常收费</p>        <p class="dot-item">          <a            href="https://cloud.tencent.com/document/product/213/19918"            target="_blank"            >更多详情</a          >        </p>      </div>    </div>  </div>  <% } %>  <label for="shutdownConfirmCheck" class="confirm-it">    <input      type="checkbox"      class="tc-15-checkbox"      id="shutdownConfirmCheck"    />强制关机  </label>  <div class="tc-15-msg" style="margin:10px 10px 10px 0">    强制关机的效果等同于关闭计算机的电源。强制关机可能会导致实例数据丢失或者文件系统损坏，请仅在实例无法正常关机的情况下使用。  </div>'
},o=function(a){f.call(this,a)};o.prototype=new f,o.prototype.exec=function(){var a=this;k.verify({api:"cvm:StopInstances"}).then(function(){d=m.init(c.id,"kennyang"),d&&d.renderBefore();var b=a,f=n.main,k=a.hasPermItems,o=k.some(function(a){return l.isSecondPayMode(a.instanceChargeType)&&!l.isLocalDiskType(a.systemDisk.storageType)});g.create(h.tmpl(f,{showStopCharge:k[0].whiteList.CVM_StopNoCharging&&o}),540,"",{title:"关机",preventResubmit:!1,onload:function(){var a=k.map(function(a){return a.uInstanceId})||[],c=!0,d={};j.stopInstances({regionId:k[0].regionId,instanceIds:a,dryRun:!0}).then(function(a){var b=a.response.instanceAttrSet||[];d=b.reduce(function(a,b){return"STOP_CHARGING"===b.supportStopMode?a[b.instanceId]=!0:(a[b.instanceId]=!1,c=!1),a},{}),e("#shutdownStopChargeCheck").attr("disabled",!1)}),e("#shutdownStopChargeCheck").click(function(a){if(a.target.checked){var f=e.extend(!0,{},b.selectedShowOptions);e("#shutdownStopChargeCheckTips").show(),c?e("#shutdownStopChargeConditions").hide():(e("#shutdownContinueChargeCheckTips").show(),e("#shutdownStopChargeConditions").show()),f.hasPermItems=f.hasPermItems.filter(function(a){return d[a.id]?a.actionName="支持关机不收费":f.noPermItems.push(Object.assign(a,{reason:"不支持关机不收费"})),d[a.id]}),e("#selectedShowWrap").remove(),i.render(f,b.selectedShowOptions)}else e("#shutdownStopChargeCheckTips").hide(),e("#selectedShowWrap").remove(),e("#shutdownStopChargeConditions").show(),i.render(b.selectedShowOptions,b.selectedShowOptions)})},button:{" 确定 ":function(){for(var a,c=[],d=e("#shutdownConfirmCheck").prop("checked")?"HARD":"SOFT_FIRST",f=e("#shutdownStopChargeCheck").prop("checked")?"STOP_CHARGING":"KEEP_CHARGING",h=0;a=k[h];h++)c.push(a.uInstanceId);c.length&&j.stopInstances({regionId:k[0].regionId,instanceIds:c,stopType:d,stoppedMode:f},{camTipsType:"dialog"}).then(function(a){g.hide();var c=b.cloudAPIActionNameMap&&b.cloudAPIActionNameMap.cvm&&b.cloudAPIActionNameMap.cvm.StopInstances||"关机中";b.checkTask({taskId:a.response&&a.response.taskId},c),b.callback&&b.callback()})}}}),i.render(a.selectedShowOptions,b.selectedShowOptions),d&&d.renderSuccess()})},c.exports=o}),define("cvm/cvm/event/shutdownSelectedShow/shutdownSelectedShow",function(a,b,c){var d=a("$"),e=(a("util"),a("event")),f=a("dialog"),g=a("appUtil"),h=a("qccomponent"),i={render:function(a,b){var c=a.hasPermItems||[],e=a.noPermItems||[],i=[],b=b||{},j=b.noPermItems||[],k=c[0]&&c[0].regionId||g.getRegionId();i=i.concat(e).concat(c);var l=new h('    <div class="act-outline" id="selectedShowWrap">        <style>            .dev-bold {                font-weight: bold;            }            .dev-title-col {                margin-bottom: 0px !important;                border-bottom: none !important;            }            .dev-content-col {                margin-top: 0px !important;            }            .dev-name-col {                width: 142px !important;            }        </style>        <div class="act-summary">您已选            <strong>                {{allLength}}台 {{insName}}            </strong>，            <span b-if="originNoPermItems.length">其中                <strong>                    {{originNoPermItems.length}}台 {{insName}}                </strong>将不能执行关机操作，            </span>            <a href="javascript:;" data-event="s_show_detail">查看详情                <i id="selectedShowIconArr" class="blue-down-icon"></i>            </a>        </div>        <div id="selectedShowDetail">            <div class="act-details dev-title-col">                <table class="act-details-tb">                    <tbody>                        <tr>                            <td>No.</td>                            <td class="dev-name-col">                                <span class="entity-name dev-bold">实例名</span>                            </td>                            <td>                                <span class="entity-name dev-bold">实例ID</span>                            </td>                            <td>                                <span class="act-result dev-bold">操作</span>                            </td>                        </tr>                    </tbody>                </table>            </div>            <div class="act-details dev-content-col">                <table class="act-details-tb">                    <tbody>                        <tr b-repeat="item in allItems">                            <td>                                {{$index + 1}}                            </td>                            <td class="dev-name-col">                                <span class="entity-name" title="{{item.name}}">                                    {{item.name}}                                </span>                            </td>                            <td>                                <span class="entity-name" title="{{item.id}}">                                    <a data-event="nav" href="/cvm/detail/{{regionId}}/{{item.id}}">                                        {{item.id}}                                    </a>                                </span>                            </td>                            <td>                                <span b-if="item.reason" class="act-result text-danger" title="{{item.reason}}">                                    {{item.reason}}                                </span>                                <span class="act-result" b-if="!item.reason" title="{{item.actionName || \'可关机\'}}">                                    {{item.actionName || \'可关机\'}}                                </span>                            </td>                        </tr>                    </tbody>                </table>            </div>        </div>    </div>',{$data:{regionId:k,actionName:a.actionName||"",allItems:i,allLength:i.length,hasPermItems:c,noPermItems:e,insName:a.insName||"实例",originNoPermItems:j}});a.renderTo?d(a.renderTo).html(l.$el):f.el&&f.el.find(".dialog_layer_cont").prepend(l.$el),f.center(),this.bindEvt()},bindEvt:function(){var a=this;e.addCommonEvent("click",{s_show_detail:function(){a._toggleBox()}})},_toggleBox:function(){var a=d("#selectedShowDetail"),b=d("#selectedShowIconArr");a.toggle(),a.is(":visible")?b.removeClass("blue-down-icon").addClass("blue-up-icon"):b.removeClass("blue-up-icon").addClass("blue-down-icon")}};c.exports=i}),define("cvm/cvm/event/tag/tag",function(a,b,c){var d=a("cvm/cvm/event/operate_base"),e=a("cvm/cvm/cvmutil"),f=a("cvm/fieldsManager/gridView"),g=a("cvm/cvm/cvm_grid"),h=a("lib/tag-sdk-importer"),i=function(a){d.call(this,a)};i.prototype=new d,i.prototype.exec=function(){var a=this.hasPermItems,b=a[0].regionId,c=e.getRegion(b),d=this;h.ready().then(function(b){b.batchEditTag({resourceIds:a.map(function(a){return a.instanceId}),resourcePrefix:"instance",serviceType:"cvm",region:c,callback:function(a,b){"complete"===a&&d.listIns&&(d.listIns.updateGridColumsWithLabel?d.listIns.updateGridColumsWithLabel().then(function(){f(g.cacheKey).buildFieldsManager.call(d.listIns.gridView),d.listIns.refresh()}):d.listIns.refresh(),d.callback&&d.callback())}})})},c.exports=i}),define("cvm/cvm/event/unbindEip/unbindEip",function(a,b,c){var d,e=(a("$"),a("manager"),a("cvm/cvm/event/operate_base")),f=a("dialog"),g=(a("tips"),a("util"),a("appUtil"),a("lengthlimiter"),a("cvm/cvm/event/selectedShow/selectedShow"),a("cvm/eip2/data")),h=a("cvm/eip2/common/util"),i=a("cvm/common/renderMonitor"),j=a("cvm/cvm/data"),k=a("cvm/eip2/common/config"),l={main:'  <div class="unwrap-ip">    <p class="tc-15-msg">      <strong        >确定将该弹性公网IP：{{ eipInfo.eip }}与绑定的实例：{{          selectedItem.uInstanceId        }}({{ selectedItem.alias || \'未命名\' }})&nbsp解绑？</strong      >      <br />解绑后，可能会影响您的业务，请提前做好准备。    </p>    <ul class="form-list">      <li b-if="selectedItem.isNetworkShiftUpUser">        <p class="">          <em class="tit">{{ eipInfo.payModeDesc }}计费的弹性公网IP解绑后，</em>          <em b-if="eipInfo.isTraffic" class="tit"            >将收取闲置费用 <span class="price">{{ eipInfo.price }}</span            >/小时          </em>          <em b-if="!eipInfo.isTraffic" class="tit">不收取闲置费用</em>        </p>      </li>      <li b-if="!selectedItem.isNetworkShiftUpUser">        <div class="form-label required">          <label for="">费用</label>        </div>        <div class="form-input">          <span class="price">            <span class="">{{ eipInfo.price }}</span>            <em class="tit">/小时</em>            <em class="tit">解绑后，空置EIP将开始收费</em>          </span>        </div>      </li>    </ul>    <label      b-if="canAllocWanIp"      class="form-ctrl-label-stacked"      style="padding-top: 10px;"    >      <input        type="checkbox"        id="allocWanIp"        b-model="allocWanIp"        class="tc-15-checkbox"      />解绑后免费分配公网IP（注意：该公网IP随机分配，且无法与实例解绑）</label    >  </div>'},m=function(a){e.call(this,a)};m.prototype=new e,m.prototype.exec=function(){d=i.init(c.id,"kennyang"),d&&d.renderBefore();var a=this,b=this.hasPermItems[0],e=b.eipInfo,h=k.EIP_REGION_PRICE[e.regionId]&&k.EIP_REGION_PRICE[e.regionId].price||"-";j.queryHangingEipPrice({regionId:e.regionId}).then(function(a){h=a&&a.response&&a.response.price.addressPrice.discountPrice})["catch"](function(){})["finally"](function(){e.price=h,g.checkIfCanAllocWanIp(e,b,a.listIns.isNetworkShiftUpUser).then(function(c){a.unbindEipBee=new Bee({$tpl:l.main,$data:{selectedItem:b,eipInfo:e,canAllocWanIp:c}}),f.create(a.unbindEipBee.$el,540,"",{title:"解绑弹性公网IP",button:{" 确定 ":function(){a.confirmUnbind()}}}),d&&d.renderSuccess()})})},m.prototype.confirmUnbind=function(){var a=this,b=a.hasPermItems[0],c=b.eipInfo,d=a.listIns.isNetworkShiftUpUser,e=!!a.unbindEipBee.$get("allocWanIp"),i="请确认弹性公网IP："+c.addressIp+" 的解绑操作，<br>解绑后，您的服务可能会受影响，请提前做好准备！";i=!d||d&&c.isTraffic?i+'<br>为保证资源有效利用，按流量计费的弹性公网IP空置状态将开始计费。<a href="http://www.qcloud.com/doc/product/213/%E5%BC%B9%E6%80%A7%E5%85%AC%E7%BD%91IP%EF%BC%88EIP%EF%BC%89#6.-弹性公网ip的计费"target="_blank">费用情况说明</a>。</strong>':i,h.getConfirm({title:"解绑弹性公网IP",content:i},function(){g.unbindEip({regionId:c.regionId,id:c.id,reallocAddress:e},{camTipsType:"dialog"}).then(function(b){f.hide();var c=a.cloudAPIActionNameMap.vpc&&a.cloudAPIActionNameMap.vpc.DisassociateAddress||"解绑中";a.checkTask({},c),a.callback&&a.callback()})})},c.exports=m}),define("cvm/cvm/event/unbindEni/unbindEni",function(a,b,c){function d(a){return new Promise(function(b,c){m.queryHangingEipPrice({regionId:a}).then(function(a){b(a.response.price.addressPrice.discountPrice)},function(c){b(k.EIP_REGION_PRICE[a]&&k.EIP_REGION_PRICE[a].price||"-")})})}var e,f=a("cvm/cvm/event/operate_base"),g=a("widget/selectors/EniSelector"),h=a("dialog"),i=(a("tips"),a("util")),j=a("cvm/common/renderMonitor"),k=a("cvm/eip2/common/config"),l=a("cvm/common/model"),m=a("cvm/cvm/data"),n={main:'  <div class="binding-ip" id="cvmUnbindEni">    <div class="tc-15-option-hd mb10">      <h4 class="mb10">请选择您要解绑的弹性网卡</h4>      <div class="tc-15-msg warning">        <div class="tip-info">          弹性网卡解绑后，将保留内网IP、弹性公网IP、安全组的关联关系。        </div>      </div>    </div>    <eni-selector      b-ref="eni"      region-id="{{ regionId }}"      zone-id="{{ zoneId }}"      vpc-id="{{ unVpcId }}"      extra-param="{{ extraParam }}"      search-placeholder="搜索名称、内网IP"    ></eni-selector>  </div>',tipcontent:'  <div class="dialog-confirm-box">    <p class="dialog-confirm-title">      <i class="<%= iconClassName %>"></i><strong><%= text %></strong>    </p>    <p class="dialog-confirm-text"><%= desc %></p>  </div>',unbindtip:'  <div class="tc-15-msg">    <div class="tip-info">      <span        >弹性公网IP在解绑后将收取        <span class="text-warning"><%=price%>元/小时</span>        的费用</span      >    </div>  </div>'},o=Bee.extend({$tpl:n.main});o.tag("eni-selector",g.extend({parseData:function(a){return a.list.forEach(function(a){a.ipNum=a.privateIpAddressesSet.length,a.primary&&(a.$disable=!0,a.$disableTips="主网卡不可解绑")}),a}},{defaults:$.extend({},g.defaults,{checkType:"radio",colums:[{name:"网卡ID/名称",key:"networkInterfaceName",tdTpl:'<p><span class="text-overflow">{{item.networkInterfaceId}}</span></a></p><span class="text-overflow m-width">{{item.eniName}}</span>'},{name:"所属子网",key:"subnetId"},{name:"网卡IP数",key:"ipNum"}]})}));var p=function(a){f.call(this,a)};p.prototype=new f,p.prototype.exec=function(){e=j.init(c.id,"kennyang"),e&&e.renderBefore();var a=this;this.doAction({regionId:this.hasPermItems[0].regionId,instanceId:this.hasPermItems[0].uInstanceId,zoneId:this.hasPermItems[0].zoneId,unVpcId:this.hasPermItems[0].unVpcId}).then(function(b){b=(b||{}).data;var c=a.cloudAPIActionNameMap.vpc&&a.cloudAPIActionNameMap.vpc.DetachNetworkInterface||"解绑中";a.checkTask(b,c),a.callback&&a.callback()},function(){})},p.prototype.doAction=function(a){var b=this,c=this.bee=new o({$data:{zoneId:a.zoneId,regionId:a.regionId,extraParam:{instanceId:a.instanceId,hideSecondary:0,limit:999,unVpcId:a.unVpcId}}}),f="-";return d(a.regionId).then(function(a){f=a}),new Promise(function(d,g){h.create(c.$el,720,"",{title:"解绑弹性网卡",defaultCancelCb:function(){c.$destroy(),g()},button:{"确定":function(){var c=b.bee.$refs.eni.currentItem;c&&(h.hide(),h.create(i.tmpl(n.unbindtip,{price:f}),550,"",{title:"解绑弹性网卡",preventResubmit:!0,button:{"确定":function(){b.sendReq({instanceId:a.instanceId,regionId:a.regionId,networkInterfaceId:c.networkInterfaceId}).then(function(a){var b=a.response;h.hide(),d({data:b})},g)}}}))}},preventResubmit:!0,onload:function(){e&&e.renderSuccess()}})})},p.prototype.sendReq=function(a){return new Promise(function(b,c){return a&&a.networkInterfaceId?void l.apiRequest({serviceType:"vpc",action:"DetachNetworkInterface",data:{networkInterfaceId:a.networkInterfaceId,instanceId:a.instanceId},regionId:a.regionId}).then(function(a){b(a)},function(){h.toggleBtnDisable(!1),c()}):void b()})},c.exports=p}),define("cvm/cvm/event/upgradebandwidth/upgradebandwidth",function(a,b,c){var d,e=a("$"),f=a("manager"),g=a("cvm/cvm/event/operate_base"),h=a("dialog"),i=a("util"),j=a("appUtil"),k=a("tips"),l=a("widget/range/range"),m=(a("datepicker"),a("cvm/cvm/event/selectedShow/selectedShow")),n=a("cvm/common/constants"),o=a("cvm/cvm/event/upgrade_common"),p=a("qccomponent"),q=a("reporter"),r=a("cvm/cvm/cvmutil"),s=a("cvm/common/components/BandwidthRangePopover"),t=a("cvm/cvm/bandwidthlimit/bandwidthlimit"),u=65535,v=a("cvm/common/model"),w=a("cvm/common/renderMonitor"),x={different:'  <div    style="font-weight:bold; font-size:18px; margin-bottom:15px; color:#404a58"  >    <%=title%>  </div>  <div class="act-outline">    <div class="act-details">      <table class="act-details-tb">        <tbody>          <% for (var i = 0, item; item = allItems[i]; i++) { %>          <tr>            <td>              <%=i+1%>            </td>            <td>              <span class="entity-name" title="<%=item.alias%>">                <%=item.alias%>              </span>            </td>            <td>              <span class="">                <%=item.networkPayModeDesc%>              </span>            </td>          </tr>          <% } %>        </tbody>      </table>    </div>  </div>',monthYear:'  <style>    .hasDatepicker .dialog_layer_main {      overflow: visible;    }  </style>  <div class="form-wrap" id="upgradeBandwidthWrap">    <ul class="form-list">      <li>        <div class="form-label">          <label>网络计费模式</label>        </div>        <div>          <%=networkPayModeDesc%>          <a href="javascript:void(0);" id="chooseFlow" style="display:none;">            切换按流量计费</a          >          <span id="leftChangeCount" style="display:none;"            >(转换后将消耗一次转换机会)</span          >        </div>      </li>      <li>        <div class="form-label">          <label>目标带宽</label>        </div>        <div class="form-input">          <div            class="bandwidth-choose-area"            id="bandwidthChooseArea"            style="width:450px"          ></div>          <p class="datetime-tips">            目标带宽需大于本次升级时间段内最大带宽，降低带宽请在实例续费中操作          </p>        </div>      </li>      <li>        <div class="form-label">          <label>生效时间</label>        </div>        <div class="form-input">          <qc-date-picker id="bandwidthDateInput"></qc-date-picker>          <p class="datetime-tips">            结束时间不能超过实例到期时间，当前有效期至 <%-deadline%>          </p>          <p class="text-primary" id="bandwidthDatePtxt"></p>        </div>      </li>      <li>        <div class="form-label">          <label data-field="pricetitle">需支付费用</label>        </div>        <div class="form-input">          <span class="cost"> <strong data-field="cost"></strong>元</span>          <span data-discount style="display:none;font-size:1.2em;">            <span              data-field="origin-cost"              style="text-decoration:line-through; margin:0 5px"            ></span            >元          </span>        </div>      </li>    </ul>  </div>',second:'  <div class="form-wrap" id="upgradeBandwidthWrap">    <ul class="form-list">      <li>        <div class="form-label">          <label>网络计费模式</label>        </div>        <div>          <%=networkPayModeDesc%>        </div>      </li>      <li>        <div class="form-label">          <label>目标带宽</label>        </div>        <div class="form-input">          <div            class="bandwidth-choose-area"            id="bandwidthChooseArea"            style="width:450px"          ></div>          <p class="text-primary">带宽调整实时设定，实时生效</p>        </div>      </li>      <li>        <div class="form-label">          <label data-field="pricetitle">调整后单价</label>        </div>        <div class="form-input">          <span class="cost"> <strong data-field="cost"></strong>元/小时</span>        </div>      </li>    </ul>  </div>',changeModeConfirm:'  <div class="act-outline">    <div style="text-indent:2em;">      每台实例只允许在按带宽计费与按流量计费两种模式之间转换 <%=maxCount%>次，      <span style="color:red;"        >该实例已经转换 <%=currCount%>次，转换次数用完后将无法再转换。</span      >    </div>    <div style="text-indent:2em;">      流量计费切换带宽计费实时生效。切换后带宽费      <span style="color:red;"        >从切换当天0点开始算。带宽费用按原价计算，不享受折扣</span      >    </div>    <div style="margin-top:20px;font-weight:bold;">您是否确定要操作？</div>  </div>'},y=a("cvm/eip2/data"),z=a("cvm/eip2/common/util"),A=a("cvm/eip2/common/config"),B=A.EIP_BANDWIDTH_QUOTA_CONFIG;y.describeBandwidthAttribute().then(function(a){B=a})["catch"](function(a){});var C=function(a){g.call(this,a)};C.prototype=new g,C.prototype.exec=function(a){this.isChangeMode=a;var b=this.operateAuth.getItemsNetworkPayMode();b.isSame?!this.listIns.isPrepaidUser||this.listIns.isBandwidthPackageUser||b.isSame&&b.mode==n.NETWORKPAYMODE.BANDWIDTH_PACKAGE?this.execResetBandwidthLimit():b.mode!=n.NETWORKPAYMODE.TRAFFIC_POSTPAID_BY_HOUR||a?this.isSingleSelected()?this.selectedItemIsExpire()?k.error("实例已过期，请续费"):(this.oldBandwidth=null,this.upgradeCommon=new o(this),d=w.init(c.id,"kennyang"),d&&d.renderBefore(),b.mode==n.NETWORKPAYMODE.BANDWIDTH_POSTPAID_BY_HOUR?this.execBandwidthPostPaidByHour():this.execTrafficPostPaidByHour()):this.tipCantBatchUpgrade("网络"+this.hasPermItems[0].cvmPayModeDesc+"模式无法批量调整"):this.execResetBandwidthLimit():this.tipCantBatchUpgrade("网络计费模式不同, 无法批量调整")},C.prototype.execResetBandwidthLimit=function(a){var b=this,c=new t({listIns:this.listIns,button:this.button,selectedItems:this.selectedItems});c.permResult=this.permResult,c.hasPermItems=this.hasPermItems,c.selectedItems=this.selectedItems,c.selectedShowOptions=this.selectedShowOptions,c.args=["bandwidthlimit",b.selectedItems,a],c.upgrade=b,c.exec&&c.exec(b)},C.prototype.execBandwidthPostPaidByHour=function(){var a=this,b=this.hasPermItems[0],c=i.tmpl(x.second,{bandwidth:b.bandwidth,networkPayModeDesc:b.networkPayModeDesc});this.showDialog(c,function(){a.toUpgrade()}),this.wrapper=e("#upgradeBandwidthWrap");var d=z.getEipMaxBandwidth(B,{networkPayMode:"BANDWIDTH_POSTPAID_BY_HOUR"}).bandwidthUpper;this.bandWidthRange=new l({renderTo:e("#bandwidthChooseArea"),value:b.bandwidth,change:function(b){0==b&&s.show({range:a.bandWidthRange}),a.refreshPrice()},max:d,min:0,section:[{value:Math.floor(d/2),width:150},{value:d,width:300}]}),this.refreshPrice(!0),m.render(this.selectedShowOptions)},C.prototype.execTrafficPostPaidByHour=function(){var a=this,b=this.hasPermItems[0];this.getBandwidthInfo(function(c){a.oldBandwidth=c;var d=c[0].endTime||"",f=j.formatDate(new Date(d),"yyyy-MM-dd"),g=b.networkPayModeDesc;a.isChangeMode&&(g="按带宽包年包月计费");var h=i.tmpl(x.monthYear,{bandwidth:b.bandwidth,deadline:f,networkPayModeDesc:g});a.showDialog(h,function(){a.toUpgrade()}),a.wrapper=e("#upgradeBandwidthWrap"),m.render(a.selectedShowOptions);var k=a.datepicker=p.mount("bandwidthDateInput",{$data:{tabs:[]}}),l=new Date(j.getSystemTime()),n=new Date(d)<l?l:new Date(d),o=j.formatDate(l,"yyyy-MM-dd");a.today=o;var q=j.formatDate(n,"yyyy-MM-dd");k.setAllowRange(o,q),k.setSelectedRange(o,q),a.isChangeMode&&(k.disabled=!0,e(".tc-15-calendar2-hook").attr("data-title","流量转带宽暂不支持修改生效时间"));o.split("-");if(a.wrapper.find("#bandwidthDatePtxt").text("带宽升级将立即生效"),k.$on("datepick",function(c){var d=c.from.split("-");if(o==c.from?a.wrapper.find("#bandwidthDatePtxt").text("带宽升级将立即生效"):a.wrapper.find("#bandwidthDatePtxt").text("带宽升级将在"+d[0]+"年"+(d[1]-0)+"月"+(d[2]-0)+"日00:00:00生效"),a.isChangeMode)a.renderBandwidthRange({value:b.internetAccessible.internetMaxBandwidthOut==u||b.internetAccessible.internetMaxBandwidthOut>200?0:b.internetAccessible.internetMaxBandwidthOut,min:1});else{var e=a.getMaxMinBandWidthByTimeSpan(a.oldBandwidth,a.datepicker.selected.from,a.datepicker.selected.to);a.bandWidthRange.setMaxMin("min",e.max),a.bandWidthRange.val()<e.max&&a.bandWidthRange.val(e.max),a.refreshPrice(!0)}}),a.isChangeMode)a.renderBandwidthRange({value:b.internetAccessible.internetMaxBandwidthOut==u||b.internetAccessible.internetMaxBandwidthOut>200?0:b.internetAccessible.internetMaxBandwidthOut,min:1});else{var s=a.getMaxMinBandWidthByTimeSpan(a.oldBandwidth,a.datepicker.selected.from,a.datepicker.selected.to),t={};r.isPrepaidPayMode(b.instanceChargeType)&&r.isBandwidthPrepaidPayMode(b.internetAccessible.internetChargeType)?(t.value=b.internetAccessible.internetMaxBandwidthOut==u||b.internetAccessible.internetMaxBandwidthOut>200?s.max:b.internetAccessible.internetMaxBandwidthOut,t.min=s.max):(t.value=b.internetAccessible.internetMaxBandwidthOut==u?0:b.internetAccessible.internetMaxBandwidthOut,t.min=s.max),a.renderBandwidthRange(t)}a.showChangeModeInfo()})},C.prototype.getBandwidthInfo=function(a){var b=this.hasPermItems[0];if(r.isBandwidthPrepaidPayMode(b.internetAccessible.internetChargeType))this.getBandwidthHistory(a);else{var c=new Date;a&&a([{startTime:c.toISOString(),endTime:b.expiredTime,internetAccessible:{internetMaxBandwidthOut:10}}])}},C.prototype.showChangeModeInfo=function(){var a=this,b=j.getRegionId(),c=function(){for(var a=0;a<n.NOT_SUPPORT_HOURLY_REGION.length;a++)if(b==n.NOT_SUPPORT_HOURLY_REGION[a])return!1;return!0}();c&&(a.listIns.isNetworkShiftUpUser||a.getChangeLimit().then(function(b){b=b||{},a.changeLimitInfo=b;var c=b.maxCount-b.currCount;if(a.isChangeMode){h.el.find("#leftChangeCount").show();var d="每台实例只允许在按带宽计费与按流量计费两种模式之间转换"+b.maxCount+"次。该实例已经转换"+b.currCount+"次，转换次数用完后将无法再转换。</br>";d+='流量计费切换带宽计费实时生效。切换后带宽费<strong style="color:#DF9500;">从切换当天0点</strong>开始算。带宽费用<strong style="color:#DF9500;">按原价计算，不享受折扣</strong>';var f='<p class="tc-15-msg warning" style="margin: 0 0 10px;"> <span class="tip-info">'+d+"</span></p>";h.el.find(".dialog_layer_cont").prepend(f)}else c>0&&e("#chooseFlow").show().click(function(){a.execResetBandwidthLimit("changeFlow")})}))},C.prototype.getChangeLimit=function(){if(this.changeLimitInfo){var a=e.Deferred();return a.resolve(this.changeLimitInfo),a}var b=this.hasPermItems[0],a=this.upgradeCommon.getActionsLimit(b.regionId,"INTERNET_CHARGE_TYPE_CHANGE",b.uInstanceId);return a},C.prototype.renderBandwidthRange=function(a){var b=this,c=this.hasPermItems[0],d=z.getEipMaxBandwidth(B,{networkPayMode:"BANDWIDTH_PREPAID_BY_MONTH",zoneId:c.zoneId}),f=d.bandwidthUpper,g=a.min||0;g=0==g&&b.listIns.isNetworkShiftUpUser?1:g;var h=1e3==f?[{value:100,width:75},{value:200,width:150},{value:500,width:225},{value:1e3,width:300}]:200==f?[{value:20,width:75},{value:50,width:150},{value:100,width:225},{value:200,width:300}]:[{value:Math.floor(f/2),width:150},{value:f,width:300}];b.bandWidthRange=new l({renderTo:e("#bandwidthChooseArea"),value:a.value,min:a.min||0,max:a.max||f,unit:"Mbps",section:h,step:1,change:function(a){0==a&&s.show({range:b.bandWidthRange}),b.refreshPrice()}}),b.refreshPrice(!0)},C.prototype.getMaxMinBandWidthByTimeSpan=function(a,b,c){for(var d,e=0,f=100,g=0;d=a[g];g++)Date.parse(d.startTime.replace(/-/g,"/"))<=Date.parse(c.replace(/-/g,"/"))&&Date.parse(d.endTime.replace(/-/g,"/"))>=Date.parse(b.replace(/-/g,"/"))&&(d.internetAccessible.internetMaxBandwidthOut!=u&&(e=Math.max(d.internetAccessible.internetMaxBandwidthOut,e)),f=Math.min(d.internetAccessible.internetMaxBandwidthOut,f));return{min:f,max:e}},C.prototype.getBandwidthHistory=function(a){var b=this,c=this.hasPermItems[0],d=j.getSystemTime();d-=5184e6,this.oldBandwidth?a(this.oldBandwidth):v.graphql({query:"query instanceInternetBandWidthConfigs ($instanceId: String, $region: String) {\n                      bandWidthConfigs(instanceId: $instanceId, region: $region) {\n                          totalNum: totalCount\n                          nodes{\n                            startTime\n                            endTime\n                            internetAccessible\n                            {\n                              internetChargeType\n                              internetMaxBandwidthOut\n                              publicIpAssigned\n                            }\n                          }\n                      }\n                    }",variables:{instanceId:c.uInstanceId,startTime:j.formatDate(new Date(d),"yyyy-MM-dd"),region:n.REGIONIDMAP[c.regionId]}}).then(function(c){return!c.bandWidthConfigs&&c.bandWidthConfigs__graphql_error?v.checkAndShowError(c.bandWidthConfigs__graphql_error):(c=c.bandWidthConfigs.nodes,c.sort(function(a,b){var c=a.endTime?new Date(a.endTime):new Date,d=b.endTime?new Date(b.endTime):new Date;return d-c}),b.oldBandwidth=c,void a(c))})},C.prototype.collectData=function(){var a,b=this.getInputData(),c=[],d=[];this.hasPermItems.forEach(function(e){c.push(e.uInstanceId),d.push([{name:"项目",value:e.projectName},{name:"实例名",value:e.uInstanceId},{name:"内网IP",value:e.deviceLanIp},{name:"所属网络",value:e.netName},{name:"可用区",value:e.zoneName},{name:"带宽",value:e.bandwidth+"=>"+b.bandwidth}]),a||(a=r.getRegion(e.regionId))}),a=a||r.getRegion(j.getRegionId());var e;return e=this.isChangeMode?[{InstanceId:c[0],Action:"ModifyInstanceInternetChargeType",InternetAccessible:{InternetChargeType:n.NETWORKPAYMODE.BANDWIDTH_PREPAID,InternetMaxBandwidthOut:b.bandwidth}}]:[{Action:"ResetInstancesInternetMaxBandwidth",InstanceIds:c,InternetAccessible:{InternetMaxBandwidthOut:b.bandwidth},StartTime:b.sTime,EndTime:b.eTime}]},C.prototype.refreshPrice=function(a){var b=this,c=this.hasPermItems[0],f=this.getInputData(),g=JSON.parse(JSON.stringify(c.internetAccessible));g.internetMaxBandwidthOut=f.bandwidth;var h,i;this.isChangeMode?(h="InquiryPriceModifyInstanceInternetChargeType",i={InstanceId:c.uInstanceId,InternetAccessible:{InternetMaxBandwidthOut:f.bandwidth,InternetChargeType:n.NETWORKPAYMODE.BANDWIDTH_PREPAID}}):(h="InquiryPriceResetInstancesInternetMaxBandwidth",i={instanceIds:[c.uInstanceId],internetAccessible:g,startTime:f.sTime,endTime:f.eTime}),v.apiRequest({action:h,serviceType:"cvm",data:i,regionId:c.regionId}).then(function(c){d&&d.renderSuccess();var f,g,h=b.wrapper||e("body"),i=h.find('[data-field="cost"]'),j=h.find("[data-discount]"),k=c.response.price;k&&k.bandwidthPrice&&("undefined"!=typeof k.bandwidthPrice.unitPrice?g=f=k.bandwidthPrice.unitPrice:(f=k.bandwidthPrice.originalPrice,g=k.bandwidthPrice.discountPrice),e(".cost-li").show(),i.html(Math.abs(g)),e(".deadline-li").hide(),f&&f!==g?(h.find('[data-field="origin-cost"]').html(f),h.find('[data-field="pricetitle"]').text("优惠价"),j.show()):(h.find('[data-field="pricetitle"]').text("需支付费用"),j.hide()),a&&"undefined"!=typeof f&&h.find('[data-field="orig-config-cost"]').html(f))})["catch"](function(a){console.warn(a)})},C.prototype.getPriceParaForHour=function(a){var b=this.hasPermItems[0],c=this.getInputData(),d={bandwidth:a?b.bandwidth:c.bandwidth};return d},C.prototype.showDialog=function(a,b){h.create(a,"760","",{title:"调整网络","class":"dialog_layer_v2 hasDatepicker",preventResubmit:!0,isMaskClickHide:!1,button:{" 确定 ":b},onload:function(a){d&&d.renderSuccess()}})},C.prototype.isSingleSelected=function(){return 1==this.hasPermItems.length},C.prototype.getInputData=function(){var a=this.bandWidthRange.val(),b={bandwidth:a};return this.isNetworkSecondPay()||(b.sTime=this.datepicker.selected.from,b.eTime=this.datepicker.selected.to),b},C.prototype.toUpgrade=function(){var a=this,b=this.hasPermItems[0],c=this.getInputData();if(this.isNetworkSecondPay()){if(c.bandwidth==b.bandwidth)return this.restoreDialogBtn(),k.error("带宽未变更!");r.isCDHPayMode(b.instanceChargeType)?this.upgradeCommon.checkSecondModeEnoughPay().then(function(d){d?v.apiRequest({action:"ResetInstancesInternetMaxBandwidth",serviceType:"cvm",data:{InstanceIds:[b.uInstanceId],InternetAccessible:{InternetMaxBandwidthOut:c.bandwidth}},regionId:b.regionId},{camTipsType:"dialog"}).then(function(b){h.hide(),a.refreshList();var c=a.cloudAPIActionNameMap&&a.cloudAPIActionNameMap.cvm&&a.cloudAPIActionNameMap.cvm.ResetInstancesInternetMaxBandwidth||"调整网络中";a.checkTask({taskId:b.response&&b.response.taskId},c),a.callback&&a.callback()})["catch"](function(a){console.warn(a)}):a.upgradeCommon.showNotEnoughPay()}):v.apiRequest({action:"ResetInstancesInternetMaxBandwidth",serviceType:"cvm",data:{InstanceIds:[b.uInstanceId],InternetAccessible:{InternetMaxBandwidthOut:c.bandwidth},startTime:c.sTime,endTime:c.eTime},regionId:b.regionId},{camTipsType:"dialog"}).then(function(b){h.hide(),a.refreshList();var c=a.cloudAPIActionNameMap.cvm&&a.cloudAPIActionNameMap.cvm.ResetInstancesInternetMaxBandwidth||"调整网络中";a.checkTask({taskId:b.response&&b.response.taskId},c),a.callback&&a.callback()})["catch"](function(a){console.warn(a)}),q.click("yunzhuji.btn.upgradebandwidth.second")}else{var d=function(){var c=a.collectData();f.getAllWhiteList(function(d){var e=d.CVM_ORDER_APIV3TOV2&&d.CVM_ORDER_APIV3TOV2.length;if(e){var f=c[0],g={ModifyInstanceInternetChargeType:"SwitchParameterModifyInstanceInternetChargeType",ResetInstancesInternetMaxBandwidth:"SwitchParameterResetInstancesInternetMaxBandwidth"}[f.Action];delete f.Action,delete f.productInfo,delete f.productInfos,v.apiRequest({serviceType:"cvm",action:g,data:f,regionId:b.regionId}).then(function(b){var c=b&&b.response.instanceOrder.goods;a.toPay2(c)})["catch"](function(a){console.warn(a)})}else a.toPay2(c)}),q.click("yunzhuji.btn.upgradebandwidth.monthyear")};if(a.upgradePrice=a.wrapper.find('[data-field="cost"]').text(),this.isChangeMode){h.hide();var e=a.changeLimitInfo.currCount,g=a.changeLimitInfo.maxCount-a.changeLimitInfo.currCount,j=i.tmpl(x.changeModeConfirm,{maxCount:a.changeLimitInfo.maxCount,currCount:e,leftCount:g});h.create(j,"580","",{title:"确认切换","class":"dialog_layer_v2",preventResubmit:!0,button:{"我知道了，确认切换":d}})}else h.confirm("<p>确定进行带宽升级？</p><p>带宽由"+b.bandwidth+"Mbps调整为"+c.bandwidth+"Mbps</p><p>生效时间："+(a.today&&a.today===c.sTime?"立即":c.sTime+" 00:00:00")+"</p>",function(){d()})}},C.prototype.tipCantBatchUpgrade=function(a){var b=i.tmpl(x.different,{allItems:this.selectedItems,title:a});this.showDialog(b,function(){h.hide()}),h.getBtn(0).hide()},c.exports=C}),define("cvm/cvm/event/upgradeconfig/cdhupgradeconfig",function(a,b,c){var d=(a("$"),a("qccomponent")),e=a("tips"),f=a("cvm/common/model"),g=a("cvm/cdh/data"),h={main:'  <div>    <div b-if="isPrivateIpChange" class="tc-15-msg">      调整配置后，该实例的内网IP可能发生变化。    </div>    <div class="form-wrap" style="padding-top: 10px">      <ul class="form-list">        <li>          <div class="form-label"><label>原配置</label></div>          <div class="form-input">            <span class="text-overflow m-width" title=""              >{{ selectedItem.cpu }}核 {{ selectedItem.mem }}GB</span            >          </div>        </li>        <li>          <div class="form-label"><label>目标CPU核数</label></div>          <div class="form-input">            <div id="cdhcvm-cpuRange"></div>          </div>        </li>        <li>          <div class="form-label"><label>目标内存容量</label></div>          <div class="form-input">            <div id="cdhcvm-memRange"></div>          </div>        </li>      </ul>    </div>  </div>'
},i=a("config/reactSupport"),j=d.extend({$tpl:h.main,$beforeInit:function(){},$afterInit:function(){var a=this,b=-1==a.selectedItem.innerVpcId;a.$set("isPrivateIpChange",b),a.oldCpuSize=a.selectedItem.cpu,a.oldMemSize=a.selectedItem.mem,a.newCpuSize=a.oldCpuSize,a.newMemSize=a.oldMemSize,f.apiRequest({serviceType:"cvm",action:"DescribeHosts",data:{filters:[{name:"host-id",values:[a.selectedItem.uHostId]}],offset:0,limit:1},regionId:a.selectedItem.regionId},{camTipsType:"dialog"}).then(function(b){var c=b.response&&b.response.hostSet&&b.response.hostSet||[],d=g.formatList(c).pop();a.setSlider(d)})},setSlider:function(a){var b=this,c=+b.selectedItem.cpu,d=+b.selectedItem.mem,e=a.cpuAvailable>a.cpuOrigin?a.cpuOrigin:a.cpuOrigin-(a.cpuTotal-a.cpuAvailable),f=a.memAvailable+d;i.useTea(function(){var a=React.__SECRET_DOM_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,g=window.tea.component.RangeSlider,h=React.createClass({displayName:"CpuRangeSlider",getInitialState:function(){return{cpu:c}},render:function(){return React.createElement(g,{className:"mb20",section:[{value:0,width:0},{value:e,width:300}],unit:"核",min:1,max:e,width:300,step:1,value:this.state.cpu,onChange:this.onChangeEvent})},onChangeEvent:function(a){this.setState({cpu:a}),b.newCpuSize=a}});a.render(React.createElement(h,null),document.getElementById("cdhcvm-cpuRange"));var i=React.createClass({displayName:"MemRangeSlider",getInitialState:function(){return{mem:d}},render:function(){return React.createElement(g,{className:"mb20",section:[{value:0,width:0},{value:f,width:300}],min:1,max:f,width:300,step:1,value:this.state.mem,onChange:this.onChangeEvent})},onChangeEvent:function(a){this.setState({mem:a}),b.newMemSize=+a}});a.render(React.createElement(i,null),document.getElementById("cdhcvm-memRange"))})},doAction:function(a){var b="CDH_"+this.newCpuSize+"C"+this.newMemSize+"G";return this.newCpuSize==this.oldCpuSize&&this.newMemSize==this.oldMemSize?(e.error("配置未变更！"),Promise.reject()):f.apiRequest({serviceType:"cvm",action:"ResetInstancesType",data:{InstanceIds:[this.selectedItem.uInstanceId],InstanceType:b,ForceStop:!!a},regionId:this.selectedItem.regionId},{camTipsType:"dialog"})}});c.exports=j}),define("cvm/cvm/event/upgradedisk/cdhupgradedisk",function(a,b,c){var d=a("$"),e=a("qccomponent"),f=(a("dialog"),a("appUtil"),a("tips")),g=a("widget/range/range"),h=(a("models/cdh"),a("cvm/cbs2/cbsutil")),i=a("cvm/common/model"),j=a("cvm/cdh/data"),k={main:'    <div>        <div class="tc-15-msg">            硬盘扩容后需要您手动调整文件系统，把新增的部分容量使用起来。        </div>        <div class="form-wrap" style="padding-top: 10px">            <ul class="form-list">                <li>                    <div class="form-label"><label>数据盘容量</label></div>                    <div class="form-input">                        <span class="text-overflow m-width" title="" >{{oldDiskSize}}GB</span>                    </div>                </li>                <li>                    <div class="form-label"><label>目标容量</label></div>                    <div class="form-input">                        <div id="cdhcvm-rangeWrap" style="width:450px"></div>                    </div>                </li>            </ul>        </div>    </div>'},l=e.extend({$tpl:k.main,$beforeInit:function(){},$afterInit:function(){var a=this,b=a.selectedItem.dataDisks.find(function(a){return h.isLocalDiskType(a.storageType)});a.oldDiskSize=b.diskSize,a.newDiskSize=a.oldDiskSize,a.$set("oldDiskSize",a.oldDiskSize),i.apiRequest({serviceType:"cvm",action:"DescribeHosts",data:{filters:[{name:"host-id",values:[a.selectedItem.uHostId]}],offset:0,limit:1},regionId:a.selectedItem.regionId},{camTipsType:"dialog"}).then(function(b){var c=b.response&&b.response.hostSet&&b.response.hostSet||[];if(c.length){var d=j.formatList(c).pop();a.renderDiskRange(a.oldDiskSize,a.oldDiskSize+d.diskAvailable)}})},renderDiskRange:function(a,b){var c=this,e=d("#cdhcvm-rangeWrap");c.cbsRange=new g({renderTo:e,value:a,min:a,max:b,unit:"GB",section:[{value:a,width:2},{value:b,width:300}],step:1,change:function(a){c.newDiskSize=a,c.$set("newDiskSize",a)}})},doAction:function(a){var b=this;return b.newDiskSize==b.oldDiskSize?(f.error("数据盘容量未变更！"),Promise.reject()):i.apiRequest({serviceType:"cvm",action:"ResizeInstanceDisks",data:{InstanceId:b.selectedItem.uInstanceId,DataDisks:[{DiskSize:+b.newDiskSize}],ForceStop:!!a},regionId:b.selectedItem.regionId},{camTipsType:"dialog"})}});c.exports=l}),define("cvm/cvm/event/upgradedisk/upgradedisk",function(a,b,c){function d(a){var b=[];return 250==a?b=[50,100,250]:400==a?b=[100,200,400]:500==a?b=[100,300,500]:800==a?b=[160,480,800]:1e3==a?b=[200,500,1e3]:1200==a?b=[200,500,1200]:a>=1500&&(b=[200,500,1e3,a]),b}var e,f=a("$"),g=(a("manager"),a("cvm/cvm/event/operate_base")),h=a("dialog"),i=a("qccomponent"),j=a("util"),k=a("appUtil"),l=a("tips"),m=a("widget/range/range"),n=a("cvm/cvm/event/selectedShow/selectedShow"),o=a("cvm/cvm/event/upgrade_common"),p=a("reporter"),q=a("cvm/cvm/event/upgradedisk/cdhupgradedisk"),r=a("cvm/common/model"),s=a("cvm/cbs2/data"),t=a("cvm/cbs2/constants"),u=a("cvm/common/constants"),v=a("cvm/cbs2/cbsutil"),w=a("cvm/cvm/data"),x=a("cvm/common/renderMonitor"),y=(a("cvm/cvm/cvmutil"),{main:'  <div id="upgradeConfigWrap">    <ul class="form-list">      <li>        <div class="form-label"><label>当前容量</label></div>        <div class="form-input">          <p class="normal-txt"><span> <%-cbsSize%>GB</span></p>        </div>      </li>      <li>        <div class="form-label"><label>目标容量</label></div>        <div class="form-input">          <div id="cbsRangeWrap" style="width:450px"></div>        </div>      </li>      <% if (!isSecondPay && !isCdcPay) { %>      <li>        <div class="form-label">          <label data-field="pricetitle"> 需支付费用 </label>        </div>        <div class="form-input">          <span class="cost"> <strong data-field="cost"></strong>元</span>          <span class="original-cost"></span>        </div>      </li>      <% }else if((isSecondPay || isCdcPay) && isCbsPortable){ %>      <li>        <div class="form-label">          <label data-field="pricetitle"> 费用 </label>        </div>        <div class="form-input">          <span class="cost">            <strong data-field="cost"></strong><% if (isI18n) {            %>美元<%}else{%>元<%}%>/小时</span          >          <span class="original-cost"></span>        </div>      </li>      <%}%>    </ul>  </div>',confirm:'  <div class="text-tips">    <p>1、为了避免数据丢失，调整硬盘需要在      <em class="text-danger">关机</em>状态下操作，实例将关机中断您的业务，请仔细确认</p>    <p>2、强制关机可能会导致数据丢失或文件系统损坏，您也可以主动关机后进行调整配置</p>    <p>3、强制关机可能需要您等待较长时间，请耐心等待</p>    <p>      <label class="form-ctrl-label">        <input          type="checkbox"          b-model="agree"          class="tc-15-checkbox"        />同意强制关机</label      >    </p>  </div>',select:'  <div id="upgradeSelectWrap">    <div class="tc-15-msg" style="margin-bottom:20px">      <div style="color:#f00">重要提示：</div>      <ul>        <li>为了防止数据丢失，硬盘只可扩容不可缩</li>        <li>          硬盘扩容后需要登录虚拟机手动修改文件系统配置，把新增部分容量使用起来，请见详细说明：          <a            href="https://www.qcloud.com/document/product/362/6737"            target="_blank"            class="guide-link"            >扩容Windows文件系统 <b class="external-link-icon"></b>          </a>          和          <a            href="https://www.qcloud.com/document/product/362/6738"            target="_blank"            class="guide-link"            >扩容Linux文件系统 <b class="external-link-icon"></b>          </a>        </li>      </ul>    </div>    <div class="renew-form old-hang">      <div class="tc-15-option-hd"><h4>请选择硬盘</h4></div>      <div class="tc-15-table-panel"><div id="dialog_cbsList"></div></div>    </div>  </div>',error:'  <div class="dialog-confirm-box">    <p class="dialog-confirm-title">      <i class="m-error-icon"></i> <strong>调整硬盘失败</strong>    </p>    <p class="dialog-confirm-text">      调整弹性云盘需要关闭云主机，请关机后重试。    </p>  </div>'}),z=function(a){g.call(this,a)};z.prototype=new g,z.prototype.exec=function(){var a=this.hasPermItems[0];this.upgradeCommon=new o(this),a&&(a.uHostId?this.cdhUpgradeDisk():this.cvmUpgradeDisk())},z.prototype.renderSelectGrid=function(){var a=this.hasPermItems[0];this.cbsList=(a.cbsList||[]).filter(function(a){return"data"==a.diskType}),this.selectedCbs=null,this.initCbsGridView(),this.renderGrid(this.cbsList,1,20,this.gridView),this.gridView.checkCellWidth()},z.prototype.initCbsGridView=function(){var a=this,b=i.getComponent("grid-view");a.gridView=new b({$data:{hasFirst:!1,initGetData:!1,canResizeColum:!1,selectedHighlight:!1,maxHeight:290,minHeight:210,autoMaxHeight:!1,maxHeightOffset:10,count:20,colums:[{key:"radio",name:"",width:"",minWidth:50,required:!0},{key:"diskId",name:"ID/云硬盘名",width:"",minWidth:153,tdTpl:'<div><p>{{item.diskId}}</p><p><span class="text-overflow m-width">{{item.alias}}</span></p></div>',required:!0},{key:"diskSize",name:"硬盘容量",width:153,required:!0},{key:"diskType",name:"硬盘类型",width:153,required:!0}],list:[],showState:!1,showPagination:!1},diskTypeFilterOptions:function(){var a=[],b=t.STORAGETYPE||[];for(var c in b)a.push({label:b[c],value:c});return a}(),getHeadContent:function(a){return"diskType"===a.key?'<grid-view-header-filter b-ref="diskTypeFilter" b-with="{filterOptions: diskTypeFilterOptions, col: col, change: filterchange.bind(this.$root)}"></grid-view-header-filter>':void 0},getCellContent:function(b,c,d){if("radio"==d.key)return'<div class="tc-15-first-radio"><input type="radio" class="tc-15-radio">'+(a.gridView.diskId==c.diskId?"checked   ":"")+"</div>";if("diskType"===d.key){var e=v.getDiskTypeNameByStorageType(c.storageType);return"<div><p>"+e+"</p></div>"}},filterchange:function(b){var c=[];f(a.cbsList).each(function(a,d){-1!=b.indexOf(d.storageType)&&c.push(d)}),a.renderGrid(c,1,20,a.gridView)},setTrAttr:function(a,b){return{"data-diskid":b.diskId}},events:{"click tr":function(a){var b=f(a.target),c=b.closest("tr").find(":radio").prop("disabled");c||(f(this.$el).find(":radio").prop("checked",!1),b.closest("tr").find(":radio").prop("checked",!0),h.toggleBtnDisable(!1,0))}},getData:function(b){var c=b.count;c*(b.page-1);a.renderGrid(a.cbsList,b.page,c,a.gridView)}}),f("#dialog_cbsList").append(a.gridView.$el)},z.prototype.renderGrid=function(a,b,c,d){var e=a;d.setData({list:e,totalNum:a.length,page:b,count:c})},z.prototype.cdhUpgradeDisk=function(){var a=this,b=this.hasPermItems[0],c=new q({selectedItem:b}),d=a.upgradeCommon.isStopped(b.instanceState),e={shutdown:{" 确定 ":function(){c.doAction(!1).then(function(b){h.hide(),a.checkTask({taskId:b.response&&b.response.taskId},"调整硬盘中"),a.callback&&a.callback()},function(a){h.toggleBtnDisable(!1)})}},nonShutdown:{" 下一步 ":function(){a.toConfirmShutdown({confirmTpl:y.confirm,title:"调整硬盘",confirmBtnTxt:"去调整"}).done(function(){c.doAction(!0).then(function(b){h.hide(),a.checkTask({taskId:b.response&&b.response.taskId},"调整硬盘中"),a.callback&&a.callback()})},function(a){h.toggleBtnDisable(!1)})}}},f=e[d?"shutdown":"nonShutdown"];h.create(c.$el,"600","",{title:"硬盘调整","class":"dialog_layer_v2 tc-15-rich-dialog new-gateway",preventResubmit:!0,button:f}),n.render(a.selectedShowOptions)},z.prototype.selectDisk=function(){var a=(this.hasPermItems[0],f.Deferred()),b=j.tmpl(y.select);return h.create(b,"720","",{title:"调整硬盘",preventResubmit:!0,button:{" 下一步 ":function(){a.resolve()}},buttonDisable:[1,0],defaultCancelCb:function(){a.reject()}}),n.render(this.selectedShowOptions),this.renderSelectGrid(),a.promise()},z.prototype.cvmUpgradeDisk=function(){var a=this;if(this.selectedItemIsExpire())return l.error("实例已过期，请续费");e=x.init(c.id,"kennyang"),e&&e.renderBefore();var b=a.hasPermItems[0];w.queryCbs({uInstanceIds:[b.instanceId],limit:1,offset:0,regionId:b.regionId}).then(function(c){var d=c.cbss&&c.cbss.nodes?c.cbss.nodes:[];b.cbsList=d,a.selectDisk().done(function(){var c=f(a.gridView.$el).find(":radio:checked");if(!c.length)return void l.error("请选择硬盘");a.gridView.diskId=c.closest("tr").data("diskid"),a.selectedCbs=a.getSelectedCbs();var d=a.upgradeCommon.isStopped(b.instanceState),e=a.isCbsSecondPay(),g=a.isCbsPortable(),h=j.tmpl(y.main,{isI18n:k.isI18n(),isSecondPay:a.isCbsSecondPay(),isCdcPay:a.isCdcPay(),isCbsPortable:a.isCbsPortable(),cbsSize:a.selectedCbs.diskSize}),i={shutdown:{" 确定 ":function(){a.toUpgrade()}},nonShutdown:{" 下一步 ":function(){a.toConfirmShutdown({confirmTpl:y.confirm,title:"调整硬盘",confirmBtnTxt:"去调整"}).done(function(){a.toUpgrade(!0)})}}},m=i[e&&g||d?"shutdown":"nonShutdown"];a.wrapper=f("#upgradeConfigWrap"),a.initComponent(h,m)})})},z.prototype.initComponent=function(a,b){var c=this,e=this.hasPermItems[0],g=this.selectedCbs,i=g.diskSize,l=g.payMode,n=g.zoneId,o=u.ZONEIDMAP[n]||e.zone,p={regionId:k.getRegionId(),diskChargeType:"prePay"==l?"PREPAID":"POSTPAID_BY_HOUR",zones:[o],inquiryType:g.portable?"INQUIRY_CBS_CONFIG":"INQUIRY_CVM_CONFIG",instanceFamilies:[e.instanceFamily],cPU:e.cpu,memory:e.mem,innerInquiryType:"INQUIRY_RESIZE"};s.queryDiskConfigQuota(p).then(function(e){var k=e&&e.response&&e.response.diskConfigSet||[],l=k.find(function(a){return a.diskType==t.STORAGETYPE_DISKTYPE_MAP[g.storageType]&&a.diskUsage==t.DISKTYPE_DISKUSAGE_MAP[g.diskType]});if(!l)return void h.create(j.tmpl('  <div class="ui-popmsg">    <div class="info">      <span class="tit"></span>      <p>云硬盘售罄</p>    </div>  </div>'),"720","",{title:"调整硬盘",button:{" 确定 ":function(a){h.hide()}}});h.create(a,"720","",{title:"调整硬盘",preventResubmit:!0,button:b});var n=l.maxDiskSize,o=l.minDiskSize;o=o>i+10?o:i+10,o=o>n?n:o;var p=d(n)||[];p=p.map(function(a,b){return{value:a,width:300/p.length*(b+1)}}),c.cbsRange=new m({renderTo:f("#cbsRangeWrap"),value:i,min:o,max:n,unit:"GB",section:p,step:10,change:function(){c.setPrice()}}),c.setPrice()})},z.prototype.collectData=function(a,b){var c=this.hasPermItems[0],d=this.selectedCbs,e=this.cbsRange?this.cbsRange.val():0;if(this.isCbsPortable())s.getResizeDiskOrderParams({regionId:c.regionId,diskId:d.diskId,diskSize:e}).then(function(a){var c=a&&a.response&&a.response.diskOrder;c&&b&&b(c)});else{var f=[{InstanceId:c.uInstanceId,DataDisks:[{DiskSize:+e}],ForceStop:!!a}];r.apiRequest({serviceType:"cvm",action:"SwitchParameterResizeInstanceDisks",data:f[0],regionId:c.regionId}).then(function(a){f=a&&a.response.instanceOrder.goods,b&&b(f)})["catch"](function(a){console.warn(a)})}},z.prototype.setPrice=function(){var a=this,b=this.hasPermItems[0],c=this.gridView.diskId,d=(this.selectedCbs,this.cbsRange?this.cbsRange.val():0);if(this.selectedCbs.portable)s.queryResizeDiskPrice({diskId:c,diskSize:d,regionId:b.regionId}).then(function(b){if(e&&e.renderSuccess(),b.response&&b.response.diskPrice){var c=a.isCbsSecondPay()||a.isCdcPay()?b.response.diskPrice.unitPriceDiscount:b.response.diskPrice.discountPrice;h.el.find("[data-field=cost]").text(c)}});else if(this.isCvmSecondPay())e&&e.renderSuccess();else{var g={regionId:b.regionId,instanceId:b.uInstanceId,dataDisks:[{diskSize:+d}]};s.queryResizeInstanceDiskPrice(g).then(function(b){var c,d,e=b&&b.response&&b.response.price&&b.response.price.instancePrice&&b.response.price.instancePrice||{},g=f(a.wrapper.selector)||f("body"),h=g.find('[data-field="cost"]'),i=g.find(".original-cost");a.isCvmSecondPay()?d=e.unitPrice:(c=e.originalPrice,d=e.discountPrice),f(".cost-li").show(),h.html(Math.abs(d)),f(".deadline-li").hide(),c&&c!==d?(i.html(c+"元"),g.find('[data-field="pricetitle"]').text("优惠价"),i.show()):(g.find('[data-field="pricetitle"]').text("需支付费用"),i.hide())})}},z.prototype.getSelectedCbs=function(){for(var a,b,c=this.hasPermItems[0],d=this.gridView.diskId,e=0;b=c.cbsList[e];e++)if(b.diskId==d){a=b;break}return a},z.prototype.isCbsSecondPay=function(){return"postPay"==this.selectedCbs.payMode},z.prototype.isCdcPay=function(){return"cdcpaid"==this.selectedCbs.payMode},z.prototype.isCbsPortable=function(){return 1==this.selectedCbs.portable},z.prototype.tipsError=function(a){return this.restoreDialogBtn(),l.error(a)},z.prototype.toUpgrade=function(a){var b=this,c=this.hasPermItems[0],d=this.selectedCbs,e=this.cbsRange?this.cbsRange.val():0;if(this.isCbsSecondPay()||this.isCdcPay()){if(e==d.diskSize)return this.tipsError("配置未变更!");d.portable?s.resizePostpaidDiskPortable({diskId:d.diskId,diskSize:e,regionId:c.regionId}).then(function(a){h.hide()}):s.resizePostpaidDiskUnportable({instanceId:c.uInstanceId,dataDisks:[{diskId:d.storageId,diskSize:e}],forceStop:!!a,regionId:c.regionId}).then(function(a){h.hide(),b.checkTask({taskId:a.response&&a.response.taskId},"调整硬盘中"),b.callback&&b.callback()})["catch"](function(a){a&&"InvalidAccount.InsufficientBalance"==a.code&&b.upgradeCommon.showNotEnoughPay()}),p.click("yunzhuji.btn.upgradedisk.second")}else this.collectData(a,this.upgradeCommon.toUpgrade.bind(this.upgradeCommon)),p.click("yunzhuji.btn.upgradedisk.monthyear")},c.exports=z}),define("cvm/cvm/event/upgrade_common",function(a,b,c){var d=a("manager"),e=a("tips"),f=a("appUtil"),g=a("dialog"),h=a("router"),i=a("reporter"),j=a("cvm/cvm/data"),k=a("cvm/common/common"),l=function(a){this.ins=a,this.selectedItem=a.hasPermItems[0],this.yearmonthPriceData={},this.hourPriceData={}},m={windows:50,linux:20};l.prototype={getInputData:function(){var a=this.selectedItem,b=this.ins,c=b.cpuPills?b.cpuPills.val():a.cpu,d=b.memPills?b.memPills.val():a.mem,e=b.cbsRange?b.cbsRange.val():this.getCbsSize(),f=b.bandWidthRange?parseInt(b.bandWidthRange.val()):void 0,g=a.disk,h=a.diskType,i=a.deviceWanIp?1:0,j=0;3==a.diskType&&(j=g,g=0);var k={cpu:parseInt(c),mem:parseInt(d),cbsSize:parseInt(e),bandwidth:f,diskType:h,disk:g,wanIp:i,ssd:j};return this.setRootPara(k),k},getCbsSize:function(a){var b=this.selectedItem,c=0;if(a){for(var d,e=0;d=b.cbsList[e];e++)if(d.cbsInstanceId==a){c=d.diskSize;break}}else for(var d,e=0;d=b.cbsList[e];e++)d.diskType&&"data"!==d.diskType||1==d.portable||(c+=d.diskSize);return c},setRootPara:function(a){var b=this.ins,c=this.selectedItem,d=b.getRootDiskPara();if(d.key){var e=m[c.osType];a[d.key]=d.val-e<0?0:d.val-e}for(var f=["rootDisk","rootCbs","rootSsd"],g=0,h=f.length;h>g;g++)f[g]!=d.key&&(a[f[g]]=0)},getPrice:function(a){var b=this;d.getPrice({goodsDetail:a},function(a){b.setPriceUI(a,{})})},getPriceForHour:function(a,b,c){var e=this,f=$.Deferred();return d.getPriceForHour({pid:a,parts:b},function(b){e.setPriceUIForHour(a,b,c),e.hourPriceData[a]=b[a]||{},f.resolve()},f.reject),f},setPriceUI:function(a,b){var c=this.ins.wrapper||$("body"),d=c[0].bee,e=a[0].totalCost/100,h=a[0].realTotalCost/100,i=c.find('[data-field="cost"]'),j=c.find("[data-discount]");if($(".cost-li").show(),i.html(Math.abs(h)),d&&d.$set("cost",Math.abs(h)),$(".deadline-li").hide(),a[0].newDeadline){$(".cost-li").hide(),$(".deadline-li").show(),$(".curDeadline").html(this.selectedItem.deadline),$(".targetDeadline").html(a[0].newDeadline),$(".oldC").html(this.selectedItem.cpu),$(".oldM").html(this.selectedItem.mem),$(".newC").html(b.cpu),$(".newM").html(b.mem);var k=(a[0].downGradeCvmCost/100).toFixed(2);k>0?($(".realCost").html("补差价"+k),$(".payback-tag").hide(),$(".payoff-tag").show()):($(".realCost").html("退差价"+Math.abs(k)),$(".payback-tag").show(),$(".payoff-tag").hide(),$(".oldDate").html(this.getYearMonthDay(this.selectedItem.deadline)),$(".newDate").html(this.getYearMonthDay(a[0].newDeadline))),this.getActionsLimit(f.getRegionId(),"INSTANCE_DEGRADE",this.selectedItem.uInstanceId).then(function(a){a=a||{maxCount:0,currCount:0};var b=a.maxCount-a.currCount;$(".maxCount").html(a.maxCount),$(".leftCount").html(b),0==b?g.toggleBtnDisable(!0):g.toggleBtnDisable(!1)})}else g.toggleBtnDisable(!1);e&&e!==h?(c.find('[data-field="origin-cost"]').html(e),d&&d.$set("originCost",e),c.find('[data-field="pricetitle"]').text("优惠价"),j.show()):(c.find('[data-field="pricetitle"]').text("需支付费用"),j.hide())},getYearMonthDay:function(a){return-1!=a.indexOf(" ")&&(a=a.split(" ")[0]),/(\-)/.exec(a),a.replace(RegExp.$1,"年").replace(RegExp.$1,"月").concat("日")},setPriceUIForHour:function(a,b,c){var d=this.ins.wrapper||$("body"),e=d[0].bee,b=b[a]||{},f=b.money.toFixed(2),h=d.find('[data-field="cost"]'),i=d.find('[data-field="orig-config-cost"]');c?(i.html(f),h.html(f),e&&e.$set({cost:f,origConfigCost:f})):(h.html(f),e&&e.$set({cost:f})),g&&g.toggleBtnDisable(!1)},getPriceParaForReduce:function(a,b){for(var c,d,e,f,g,h=this.selectedItem,i=(this.getInputData(),{}),j=0;g=h.cbsList[j];j++)"root"===g.diskType&&(c=g.target,e=g.diskSize),"data"===g.diskType&&(d=g.target,f=g.diskSize);i.os=h.osValue,i.bandwidth=h.bandwidth,i.cpu=a,i.mem=b,i.diskInfo={root:{target:c,type:h.rootType,size:e?e:h.rootSize},data:[{target:d,type:h.diskType,size:f?f:h.diskSize}]};var k={type:"cvm",subType:"cvmBasicConfig",action:"upgradeCvm",lanIp:h.deviceLanIp,uuid:h.uuid,curDeadline:h.deadline,vpcId:h.vpcId,subnetId:h.subnetId,isVpcGateway:h.isVpcGateway,networkPayMode:h.networkPayMode,returnParts:{cpu:h.cpu,mem:h.mem},parts:i};return k},getPriceParaForConfig:function(a){var b=this.selectedItem,c=this.getInputData(),d={};d.upgradeCpu=c.cpu,d.oldCpu=b.cpu,d.upgradeCvmConfig=1,d.upgradeMem=c.mem,d.oldMem=b.mem,d.upgradeCvmConfig=1;for(var e,f,g=0;f=b.cbsList[g];g++)if("data"===f.diskType&&1!=f.portable){e=f.target;break}d.upgradeDiskInfo={data:[{target:e,type:b.diskType,size:c.cbsSize}]},d.oldDiskInfo={data:[{target:e,type:b.diskType,size:this.getCbsSize(a)}]},d.upgradeCvmConfig=1;var h={type:"cvm",subType:"cvmBasicConfig",action:"upgradeCvm",lanIp:b.deviceLanIp,uuid:b.uuid,curDeadline:b.deadline,vpcId:b.vpcId,subnetId:b.subnetId,isVpcGateway:b.isVpcGateway,networkPayMode:b.networkPayMode,parts:d};return h},getBandwidthPricePid:function(){return 1e4},getConfigPricePid:function(){function a(){var a=$.Deferred();return a.resolve(10578),Promise.resolve(a.promise())}return a}(),checkSecondModeEnoughPay:function(){var a=this,b=k.queryAccountBalance(),c=new Promise(function(b){a.getConfigPricePid().then(function(c){if(a.hourPriceData[c])b(a.hourPriceData[c].money);else{var e=a.getInputData();e.bandwidth=void 0,d.getPriceForHour({pid:c,parts:e},function(a){a=a[c]||{},b(a.money)})}})}),e=new Promise(function(b){var c=a.getBandwidthPricePid();if(a.hourPriceData[c])b(a.hourPriceData[c].money);else{var e=a.getInputData();d.getPriceForHour({pid:c,parts:{bandwidth:e.bandwidth||a.selectedItem.bandwidth}},function(a){a=a[c]||{},b(a.money)})}});return new Promise(function(d){var f=[b,c];a.ins.isNetworkSecondPay()&&f.push(e),Promise.all(f).then(function(a){var b=a[0],c=a[2]?a[1]+a[2]:a[1];d(b>=c)})})},showNotEnoughPay:function(a,b){a=a||'<span class="tit">您的余额不足以支撑所有按量付费资源一个小时的消耗，请先充值!</span>',b=b||"余额不足",g.confirm(a,function(){h.navigate("/account/recharge"),i.click("yunzhuji.btn.recharge")},null,{title:b,width:540,mainBtnName:"立即充值"})},toUpgrade:function(a){var b=$(this.ins.wrapper.selector).find('[data-field="cost"]');return b.length&&0==b.text()?(e.error("该升级方案总计费用为0元, 请重新选择"),this.ins.restoreDialogBtn()):void this.ins.toPay2(a)},isShutdown:function(a){return 4==a},isStopped:function(a){return"STOPPED"==a},getActionsLimit:function(a,b,c){var d=$.Deferred();return j.getActionsLimit(a,b,c).then(d.resolve,d.reject),d}},c.exports=l}),define("cvm/cvm/event/vnc",function(a,b,c){function d(a){return/ubuntu/i.test(a.osName)?"ubuntu":"root"}function e(a){return/tencent/i.test(a.osName)}var f=a("cvm/cvm/event/operate_base"),g=a("dialog"),h=a("qccomponent"),i=a("reporter"),j=a("util"),k=a("cvm/common/model"),l=a("widget/mfa/mfa"),m=function(a){f.call(this,a)};m.prototype=new f,m.prototype.exec=function(){var a=this,b=a.hasPermItems[0];b&&l.verify({api:"cvm:DescribeInstanceVncUrl"}).then(function(){k.apiRequest({regionId:b.regionId,serviceType:"cvm",action:"DescribeInstanceVncUrl",data:{instanceId:b.uInstanceId}},{camTipsType:"dialog"}).then(function(c){var d=c.response.instanceVncUrl;a.loginOption(b,d)})})},m.prototype.openVNC=function(a){var b=this.hasPermItems[0],c="//iaas.cloud.tencent.com/vnc?regionId="+b.regionId+"&instanceId="+b.uInstanceId+"&InstanceVncUrl="+a;window.open(c,"","width=830,height=650,location=no "),i.click("yunzhuji.login.vnc."+b.osType)},m.prototype.openWebshell=function(){var a=this.hasPermItems[0],b="//iaas.cloud.tencent.com/webshell?regionId="+a.regionId+"&instanceId="+a.uInstanceId;"ubuntu"===d(a)&&(b+="&username=ubuntu"),e(a)&&(b+="&isTlinux=true"),window.open(b),i.click("yunzhuji.login.webshell")},m.prototype.loginOption=function(a,b){var c=this,e=this.getDisabledWebShellTips(),f="windows"==a.osType,i=new h('  <div class="login-cvm-dialog">    <div b-if="!isWindows">      <div class="clearfix">        <div class="pull-left">          标准登录方式          <i b-if="!disabledWebShellTips" class="tc-badge success">推荐</i>        </div>        <div class="pull-right">          <a            target="_blank"            href="https://cloud.tencent.com/document/product/213/35574"            >登录不上？</a          >        </div>      </div>      <div class="login-info-box">        <p>          支持复制粘贴、中文输入法，需要开启 SSH 端口（TCP:22）        </p>        <div class="mt-10">          <button            class="tc-15-btn {{ disabledWebShellTips ? \'text-weak\' : \'\' }}"            data-title?="disabledWebShellTips"            b-on-click="login(\'webshell\')"          >            立即登录          </button>        </div>        <p class="text-danger" b-if="disabledWebShellTips">          {{ disabledWebShellTips }}        </p>      </div>      <p class="mt-20">其他方式（VNC）</p>      <div class="login-info-box two">        <p class="mb-10">          该方式暂不支持复制粘贴、中文输入法。          <span b-if="cvm.instanceClass==\'G\'"            >安装GPU图形驱动后不可用，详见            <a              href="https://cloud.tencent.com/document/product/560/36207"              target="_blank"              >控制台VNC不可用</a            >          </span>        </p>        <p class="text-label mb-10">          提示：采用VNC方式登录，请务必开启 MFA 二次验证提高安全保障级别        </p>        <div class="mt-10">          <button class="tc-link-btn" b-on-click="login(\'vnc\')">            <a              class="pull-right {{ vncUrl ? \'\' : \'disabled\' }}"              href="javascript:;"              >立即登录</a            >          </button>        </div>      </div>      <p b-if="host" class="mt-20">        更多方式：<a          target="_blank"          href="https://cloud.tencent.com/document/product/213/5436"          class="tc-external-link-btn"          >登录Linux云服务器</a        >      </p>    </div>    <div b-if="isWindows">      <div class="login-cvm-dialog">        <div class="clearfix">          <div class="pull-left">            使用RDP文件登录            <i b-if="canUseRdp" class="tc-badge success">推荐</i>          </div>          <div class="pull-right">            <a              target="_blank"              href="https://cloud.tencent.com/document/product/213/10339"              >登录不上？</a            >          </div>        </div>        <div class="login-info-box">          <p>            下载RDP文件后运行直接登录远程桌面程序，需要开启远程登录端口(TCP:3389)          </p>          <p class="text-label">注意：支持复制粘贴</p>          <p>            1.使用Windows系统电脑直接点击下方按钮下载RDP文件，详情见登录<a              target="_blank"              href="https://cloud.tencent.com/document/product/213/5435#windows-.E7.B3.BB.E7.BB.9F.E4.BD.BF.E7.94.A8-rdp-.E7.99.BB.E5.BD.95"              class="tc-external-link-btn"              >Windows 实例</a            >            <br />            <button              class="tc-15-btn ml-10 mb-10 {{ canUseRdp ? \'\' : \'text-weak\' }}"              data-report="yunzhuji.login.dowloadrdp"              b-on-click="downloadRdp()"            >              下载RDP文件            </button>          </p>          <p>            2.使用Linux系统电脑需先安装            <a              target="_blank"              href="https://cloud.tencent.com/document/product/213/5435#linux-.E7.B3.BB.E7.BB.9F.E4.BD.BF.E7.94.A8-rdp-.E7.99.BB.E5.BD.95"              class="tc-external-link-btn"              >rdesktop</a            >          </p>          <p>            3.使用MacOS系统电脑需先安装            <a              target="_blank"              href="https://cloud.tencent.com/document/product/213/5435#macos-.E7.B3.BB.E7.BB.9F.E4.BD.BF.E7.94.A8-rdp-.E7.99.BB.E5.BD.95"              class="tc-external-link-btn"              >Microsoft Remote Desktop for Mac</a            >          </p>          <p class="text-danger" b-if="!canUseRdp">            提示：当前实例无公网IP，无法使用 RDP            文件方式，您可以采取以下方式进行登录          </p>        </div>        <p class="mt-20">          其他方式（VNC）        </p>        <div class="login-info-box two">          <p class="mb-10">            该方式暂不支持复制粘贴、中文输入法。            <span b-if="cvm.instanceClass==\'G\'"              >安装GPU图形驱动后不可用，详见              <a                href="https://cloud.tencent.com/document/product/560/36207"                target="_blank"                >控制台VNC不可用</a              >            </span>          </p>          <p class="text-label ">            提示：采用VNC方式登录，请务必开启 MFA 二次验证提高安全保障级别          </p>          <div class="mt-10">            <button class="tc-link-btn" b-on-click="login(\'vnc\')">              <a                class="pull-right {{ vncUrl ? \'\' : \'disabled\' }}"                href="javascript:;"                >立即登录</a              >            </button>          </div>        </div>        <p b-if="host" class="mt-20">          更多方式：<a            target="_blank"            href="https://cloud.tencent.com/document/product/213/5435"            class="tc-external-link-btn"            >登录Windows云服务器</a          >        </p>      </div>    </div>  </div>',{$data:{cvm:a,host:a.deviceWanIp,isWindows:f,linuxUsername:d(a),disabledWebShellTips:e,canUseRdp:f&&a.deviceWanIp,vncUrl:b},login:function(a){if("vnc"===a)c.openVNC(this.vncUrl);else if("webshell"===a){if(this.disabledWebShellTips)return;c.openWebshell()}g.hide()},downloadRdp:function(){if(this.canUseRdp){var b=j.getACSRFToken();window.open("//iaas.cloud.tencent.com/cgi/cvm?action=rdp&regionId="+a.regionId+"&instanceId="+a.uInstanceId+"&csrfCode="+b)}}});g.create(i.$el,720,"",{title:"登录"+(f?"Windows":"Linux")+"实例",defaultCancelBtn:!1})},m.prototype.getDisabledWebShellTips=function(){var a=this.hasPermItems[0],b="";return window.Bee&&window.Bee.utils.ie<=9&&(b="提示：使用 Webshell 需使用 IE10 及以上浏览器"),"windows"==a.osType&&(b="提示：Webshell 仅支持 linux 虚拟机"),a.deviceWanIp?0==a.bandwidth&&(b="提示：当前实例带宽为0，不支持Webshell 登录和远程登录软件登录，您可以采取以下方式进行登录"):b="提示：当前实例无公网IP，不支持Webshell 登录和远程登录软件登录，您可以采取以下方式进行登录",b},c.exports=m}),define("cvm/cvm/event/wipToEip/wipToEip",function(a,b,c){var d,e=(a("$"),a("cvm/cvm/event/operate_base")),f=a("dialog"),g=(a("tips"),a("util")),h=a("cvm/eip2/data"),i=(a("cvm/eip2/common/util"),a("cvm/eip2/eip"),a("qccomponent"),a("cvm/common/renderMonitor")),j=a("cvm/cvm/event/bindEip/bindEip"),k={wipToEieip:'  <div class="tc-15-msg">    <strong      >检测到这台实例已有公网IP(<%=item.deviceWanIp%>)，是否将其转化为EIP？</strong    >    <p class="txt">      特性：IP将保持不变，直接转为弹性公网IP保持绑定，且不中断您的服务！    </p>    <p class="txt">      配额：您最多可开通 <%=eipQuotaData.quotaLimit%> 个EIP，已开通      <%=eipQuotaData.quotaCurrent%> 个。    </p>    <p class="txt">      计费：为保证IP资源有效利用，未绑定实例的EIP，将按小时收取少量费用。    </p>  </div>'},l=function(a){e.call(this,a)};l.prototype=new e,l.prototype.exec=function(){d=i.init(c.id,"kennyang"),d&&d.renderBefore();var a=this,b=a.hasPermItems[0];h.getEipQuota({regionId:b.regionId}).then(function(c){var d=c.response.quotaSet[0];d&&(b.deviceWanIp&&"-"!=b.deviceWanIp&&!b.eipInfo&&d.quotaCurrent<d.quotaLimit?a.wipToEip(d):a.bind())})},l.prototype.wipToEip=function(a){var b=this,c=this.hasPermItems[0],e=b.getWipTpEipButtons(),h=f.create(g.tmpl(k.wipToEieip,{eipQuotaData:a,item:c}),540,"",{title:"转换为弹性公网IP",defaultCancelBtn:!b.listIns.isNetworkShiftUpUser,button:e});h.find(".btn_blue").eq(1).removeClass("btn_blue ").addClass("btn_white_2"),d&&d.renderSuccess()},l.prototype.getWipTpEipButtons=function(){var a=this,b=this.hasPermItems[0],c={" 确定转换 ":function(){h.wipToEip({regionId:b.regionId,unInstanceId:b.uInstanceId},{camTipsType:"dialog"}).then(function(b){f.hide();var c=a.cloudAPIActionNameMap.vpc&&a.cloudAPIActionNameMap.vpc.TransformAddress||"转换中";a.checkTask({},c),
a.callback&&a.callback()})}};return a.listIns.isNetworkShiftUpUser||(c["其他弹性公网IP"]=function(){a.bind()}),c},l.prototype.bind=function(){var a=new j({listIns:this.listIns,button:this.button,selectedItems:this.selectedItems});a.hasPermItems=this.hasPermItems,a.exec()},c.exports=l}),define("cvm/cvm/event/xentokvm/xentokvm",function(a,b,c){var d=a("$"),e=(a("manager"),a("dialog")),f={main:'    <style type="text/css">    .swapnotes li{padding:4px 0; list-style-type:disc; margin-left: 20px}    .dialog-confirm-ck{position: absolute; left: 20px; top:20px; font-size: 14px}    </style><div class="tip_box">        <ul class="swapnotes">            <li>该实例架构老旧，已不支持自动置换，请退还后重新购买。</li>            <li style="color:#f00">退还前请务必备份好重要数据。</li>            <li>如有疑问，请填写<a data-event="nav" href="/workorder">工单反馈</a></li>        </ul>    </div>'},g={render:function(a){this.operIns=a,e.create(f.main,"640","",{title:"置换新实例注意事项",preventResubmit:!0,button:{"确定":function(){e.hide()}}}),d("#confirmEnter").change(function(){var a=d(this).prop("checked");e.toggleBtnDisable(!a)})}};c.exports=g}),define("cvm/cvm/format",function(a,b,c){function d(a){var b=a.runflag,c=a.latestOperation,d=a.latestOperationState,e=a.operateServiceType,f=void 0===e?"cvm":e,g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return h.UsingNewOperationValidator?i.isOperationFailed({latestOperation:c,latestOperationState:d})?g[f]&&g[f][c]&&g[f][c]+"失败"||"操作失败":i.isDuringExclusionOperation({latestOperation:c,latestOperationState:d})&&g[f]&&g[f][c]||"":i.getOperationTitleFromRunflag({runflag:b,latestOperation:c,latestOperationState:d})}var e=a("cvm/cbs2/constants"),f=a("cvm/common/constants"),g=a("appUtil"),h=a("util"),i=a("cvm/cvm/cvmutil"),j=a("cvm/cbs2/cbsutil"),k=a("cvm/image/util"),l=a("cvm/eip2/data"),m=a("widget/errorTips/errorTips"),n=function(a){var b,c=f.CVM_ROOT_SYSTEM_ICON,d="";if(!a)return d;for(var e in c)if(b=new RegExp(e,"i"),b.test(a)){d=c[e];break}return d},o=function(a){var b,c=g.isI18n();return b=c?"<br />"+a:a.substring(0,10)+"<br />"+a.substring(11,16)},p={S4:"标准型S4",BMS4:"裸金属标准型BMS4",D1:"大数据机型D1",S1:"标准型S1",N1:"网络优化型N1",I1:"高IO型I1",M1:"内存型M1",S2:"标准型S2",SN2:"标准网络增强型SN2",SN3:"标准型SN3",I2:"高IO型I2",I3:"高IO型I3",M2:"内存型M2",C2:"计算型C2",CN2:"计算网络增强型CN2",CN3:"计算型CN3",MN3:"内存型MN3",M3:"内存型M3",M4:"内存型M4",S3:"标准型S3",C3:"计算型C3",FX2:"FPGA型FX2",GN2:"GPU计算型GN2",GA2:"GPU渲染型GA2",GN8:"GPU计算型GN8",CDH:"独享型",BS1:"批量通用型BS1",BC1:"批量计算型BC1",SHARED:"共享核",SPECIAL:"特殊机型",S2ne:"标准网络优化型S2ne",SN3ne:"标准网络优化型SN3ne",DR1:"大数据机型DR1",SA1:"标准型SA1",GN6:"GPU计算型GN6",GN10:"GPU计算型GN10",GN6S:"GPU计算型GN6S",GN10S:"GPU计算型GN10S",GN10X:"GPU计算型GN10X",OTHER:"其他"},q={cvmConfig:function(a){var b=function(a){var b=0==a.bandwidth,c=!(a.publicIpAddresses&&a.publicIpAddresses[0]),d=!(a.connectivity&&a.connectivity.ICMP),e=!(a.connectivity&&a.connectivity.defaultLoginPort),f="",g="",j=h.tmpl("带宽为0，无法远程登录，建议<%=bandwidth%>，再<%=eip%>",{bandwidth:'<a href="javascript:;" data-name="ResetInstancesInternetMaxBandwidth" data-event="cvm_oper_action">调整带宽</a>',eip:c?'<a href="javascript:;" data-name="AssociateAddress" data-event="cvm_oper_action">绑定弹性公网IP</a>':"确认安全组"+a.defaultLoginPort+"端口已经放通"});return a.$normal&&(b?f=' <i class="plaint-icon" qc-popover="'+j+'"></i>':c||!i.isStopped(a.instanceState)&&a.connectivity&&(d||e)&&(d&&(g+=h.tmpl("ping不可达，建议在安全组中<%=firewall%>",{firewall:'<a href="javascript:;" data-name="ModifyInstancesAttribute.SecurityGroups" data-event="cvm_oper_action">放通ICMP协议</a><br>'})),e&&(g+=h.tmpl("无法远程登录，建议在安全组中<%=firewall%>",{firewall:'<a href="javascript:;" data-name="ModifyInstancesAttribute.SecurityGroups" data-event="cvm_oper_action">放通TCP'+a.defaultLoginPort+"端口</a>"})),f=' <i class="plaint-icon" qc-popover="'+g+'"></i>')),f},c=b(a),d="\n      <div>\n        <p>\n          <span class=\"text-overflow\">\n            {{item.cpuInfo + '  ' + item.memInfo + '  ' + item.bandwidthInfo}}"+c+'\n          </span>\n        </p>\n        <p b-if="item.systemDisk && item.systemDisk.diskTypeName">系统盘：{{item.systemDisk.diskTypeName}}</p>\n        <p b-if="item.virtualPrivateCloud.vpcId" class="text-overflow" >\n          网络：\n          <a b-if="item.unVpcId" data-event="nav" href="https://console.qcloud.com/vpc/vpc?rid={{item.regionId}}&unVpcId={{item.unVpcId}}" target="_blank">\n            {{item.netName}}\n          </a>\n          <span b-if="!item.unVpcId">{{item.netName}}</span>\n        </p>\n\n        <p b-if="!item.virtualPrivateCloud.vpcId && item.netName != undefined" class="text-overflow">\n          网络：基础网络\n        </p>\n        <p b-if="!item.virtualPrivateCloud.vpcId && item.netName == undefined">\n          &nbsp;\n        </p>\n      <div>';return d},isOperationSameWithStatus:function(a,b){var c=a.latestOperation,d=a.latestOperationState;return i.isDuringExclusionOperation({latestOperation:c,latestOperationState:d})&&["StartInstances","StopInstances","RunInstances","RebootInstances","TerminateInstances"].find(function(a){return a==c})||["开机中","关机中","创建中","重启中","退还中"].indexOf(b)>-1},operationTitle:function r(a,b){var c=b.cloudAPIActionNameMap,e=b.whiteList,r=d(a,c,e);a.operationTitle=this.isOperationSameWithStatus(a,r)?"":r},operationDesc:function(a){a.operationDesc="",a.operationClass="",a.operationColorClass="",i.isOperationFailed(a)?(a.operationColorClass="text-danger",a.operationClass="n-error-icon",[f.CVM_OPERATION.ResetInstance].indexOf(a.latestOperation)>-1?a.operationDesc+=' qc-popover-style="min-width:420px;" qc-popover="由于选择的镜像内部配置存在问题，导致重装系统失败'+(a.errorKey?"（错误码："+a.errorKey+"）":"")+'，请选择其他镜像重装"':a.operationDesc+=' qc-popover-style="min-width:420px;" qc-popover="由于系统繁忙'+(a.errorKey?"（错误码："+a.errorKey+"）":"")+"，您的CVM实例"+a.operationTitle+'，建议您稍后重试"'):i.isDuringExclusionOperation(a)&&(a.operationClass="n-loading-icon")},statusTitle:function(a){a.statusTitle=i.getStatusTitle(a)},statusDesc:function(a){if(i.isLoadingStatus(a)?a.statusOperateTip="请等待"+f.CVM_STATUS_TITLE[a.instanceState].replace("中","")+"完成后再操作":i.isDuringExclusionOperation(a)&&(a.statusOperateTip="请等待"+f.CVM_OPERATION_TITLE[a.latestOperation]+"完成后再操作"),a.statusClass="",a.statusColorClass="",i.isLaunchFailed(a.instanceState)||i.isShoutdownStatus(a.instanceState)?(a.statusClass="n-error-icon",a.statusColorClass="text-danger"):i.isLoadingStatus(a)?a.statusClass="n-loading-icon":i.isRunning(a.instanceState)?a.statusClass="running-icon":i.isStopped(a.instanceState)&&(a.statusClass="shutdown-icon"),a.statusClass=this.isOperationSameWithStatus(a)?"n-loading-icon":a.statusClass,a.isSafeIsolated)a.statusClass="n-error-icon",a.statusDesc=h.tmpl(' qc-popover-style="min-width:480px;" qc-popover="<%=popoverTip%>"',{popoverTip:a.unblockable?"实例由于安全风险外网已被隔离，具体安全风险为："+a.safeIsolatedInfo+'，请尽快处理安全风险，解除风险后可对实例进行<a data-event="autoUnblock" href="javascript:;">自助解封</a>':'实例由于有安全风险外网已被隔离，请尽快处理安全风险，解除风险后<a data-event="nav" href="//console.qcloud.com/workorder/category?level1_id=6&level2_id=7&source=0&data_title=实例%20CVM&step=1">提交工单</a>给我们确认执行结果；具体安全风险：'+a.safeIsolatedInfo});else if(a.ipBlocked){var b=h.tmpl("<%=text%>",{text:'<span class="text-danger">封堵</span>'}),c=h.tmpl("<%=text%>",{text:'<a href="https://buy.qcloud.com/bgp_sp" target="_blank">购买</a>BGP<a href="https://www.qcloud.com/document/product/297/8337" target="_blank">高防服务包</a>'});a.statusDesc=' qc-popover-style="min-width:280px;" qc-popover="实例由于受到攻击被'+b+"。"+a.ipBlockedTime+"将自动解封，您也可以"+c+'来应对攻击，恢复业务。"'}else if(i.isLaunchFailed(a))a.statusDesc+=' qc-popover-style="min-width:480px;" qc-popover="由于系统繁忙'+(a.errorKey?"（错误码："+a.errorKey+"）":"")+"，您的CVM实例"+a.operationTitle+"，请尽快 "+h.tmpl("<%=text%>",{text:'<a data-event="nav" href="//console.qcloud.com/workorder/category?level1_id=6&level2_id=7&source=0&data_title=实例%20CVM&step=1">提交工单</a>'})+' 联系我们进行处理。"';else if(i.isShoutdownStatus(a.instanceState)){var d="";a.isPrepaid?a.isolatedTime&&(d="您的实例因到期或主动销毁已移入回收站，请在 "+a.isolatedTimeStr+" 前续费。逾期未续费，将被释放。若您不需要该实例，请忽略该提示。"):d="MANMADE"==a.isolatedSource?"您的实例因主动销毁已移入回收站，请在"+a.isolatedTimeStr+" 前恢复。逾期未恢复，将被释放。若您不需要该实例，请忽略该提示。":"您的实例因账户欠费被隔离待回收，请在 "+a.isolatedTimeStr+" 前将账户充正，<br/>逾期实例将被彻底释放无法找回。",a.statusDesc=h.tmpl(' qc-popover-style="min-width:420px;" qc-popover="<%=popoverTip%>"',{popoverTip:d})}},expiredTimeInfoAndStatus:function(a,b){var c="NOTIFY_AND_AUTO_RENEW"===a.renewFlag,d=a.expiredTime,e=0,f="",j="";if(d){if(i.isPrepaidPayMode(a.instanceChargeType)){j=g.formatDate(new Date(a.expiredTime),"yyyy-MM-dd hh:mm:ss");var k=864e5,l=7*k,m=new Date(d),n=b&&!isNaN(b)?b:g.getSystemTime(),o=n-m.getTime();if(o>0){var p=Math.floor(o/k);f=1>p?c?'<span class="text-overflow status-recover error">今日执行自动续费</span>':'<span class="text-overflow status-recover error">今天到期</span>':'<span class="text-overflow status-recover error">已过期'+p+"天</span>",e=1}else if(-l>o)f=h.date.date2Str(new Date(d),"%Y-%M-%d %h:%m",!0),e=0;else{var p=Math.floor(Math.abs(o/k));if(1>p)f=c?'<span class="text-overflow warning">小于1天将自动续费</span>':'<span class="text-overflow warning">小于1天到期</span>';else{var q=c?p+"天后自动续费":p+"天后到期";f='<span class="text-overflow warning">'+q+"</span>"}e=2}}}else e=0,f="";return{status:e,expiredTimeStr:f,expiredTimeDesc:j}},getDeadLineStr:function(a,b){var c,d,e=g.formatDate(new Date(a.isolatedTime),"yyyy-MM-dd hh:mm:ss"),h=new Date(e.replace(/\-/g,"/")),j="-",k=b&&!isNaN(b)?b:(new Date).getTime(),l=k-h.getTime();if(e&&"0000-00-00 00:00:00"!=e)if(i.isPrepaidPayMode(a.instanceChargeType)){var m=7,n=864e5,o=7*n;if(c=o,c>l){l=l.toFixed(2)-0,d=(m-l/n).toFixed(2).split(".");var p="";d[1]&&(p=(d[1]/100*24).toFixed(0)-0,p=p>0?p+"小时":""),j=0==d[0]&&0==p?'<span class="text-overflow text-danger">小于1小时释放</span>':'<span class="text-overflow text-danger">'+(d[0]>0?d[0]+"天":"")+p+"后释放</span>"}else j='<span class="text-overflow text-danger">即将释放</span>'}else{var q=36e5,r="MANMADE"==a.isolatedSource?f.CVM_REMAIN_TIME.SECOND_MANMADE_HOUR:f.CVM_REMAIN_TIME.SECOND_ISO_HOUR;if(c=r*q,c>l){var s=Math.floor(Number((c-l)/1e3/60)),t=Math.floor(Number(s/60)),u=Number(s%60);j=0===t&&0===u?'<span class="text-overflow text-danger">小于1分钟释放</span>':'<span class="text-overflow text-danger">'+(t>0?t+"小时":"")+(u>0?u+"分钟":"")+"后释放</span>"}else j='<span class="text-overflow text-danger">即将释放</span>'}return j},cpuInfo:function(a){return!a.instanceType||"v1.0.5"!=a.instanceType.toLowerCase()&&"v1.1"!=a.instanceType.toLowerCase()?a.CPU+" 核":"共享核"},memInfo:function(a){return a.instanceType&&"v1.0.5"==a.instanceType.toLowerCase()?a.memory+" MB":a.memory+" GB"},systemDisk:function s(a){var s=a.systemDisk;return s={diskSize:s.diskSize,diskType:s.diskType,storageType:s.storageType,diskTypeName:j.getDiskTypeNameByDiskType(s.storageType),diskId:s.diskId}},dataDisks:function t(a){var t=a.dataDisks;return t?t.map(function(a){return{diskSize:a.diskSize,diskType:a.diskType,storageType:a.storageType,diskTypeName:j.getDiskTypeNameByDiskType(a.storageType),diskId:a.diskId}}):[]},cvmPayModeInfo:function(a){var b="",c=[];if(i.isCDHPayMode(a.instanceChargeType)||a.uHostId){if(a.createdTime){var d=h.date.date2Str(new Date(a.createdTime),"%Y-%M-%d %h:%m",!0),e=o(d),f=e+"创建";c.push(f)}b="不计费"}else if(a.isPrepaidUser){if(i.isSecondPayMode(a.instanceChargeType)){if(a.createdTime){var d=h.date.date2Str(new Date(a.createdTime),"%Y-%M-%d %h:%m",!0),e=o(d),f=e+"创建";c.push(f)}b="按量计费"}else if(i.isSpotPayMode(a.instanceChargeType)){if(a.createdTime){var d=h.date.date2Str(new Date(a.createdTime),"%Y-%M-%d %h:%m",!0),e=o(d),f=e+"创建";c.push(f)}b="按量计费-竞价"}else if(i.isPrepaidPayMode(a.instanceChargeType)){if("-"!=a.expiredTimeStr)if(0==a.expiredTimeStatus){if(a.expiredTimeStr){var e=o(a.expiredTimeStr),f=e+"到期";c.push(f)}}else c.push(a.expiredTimeStr);b="包年包月"}}else b="后付费";if("STOPPED"===a.instanceState&&"STOP_CHARGING"===a.stopChargingMode){var g=h.date.date2Str(new Date(a.createdTime),"%Y-%M-%d %h:%m",!0);c=['<span class="text-danger-und" data-position="top"\n          qc-popover="<p>'+g+' 创建</p><p>已释放CPU、内存，并停止对CPU内存的计费，磁盘、镜像、公网带宽依然收费</p>"\n          >停止收费</span>']}return{cvmPayModeDesc:b,cvmPayModeTimeDesc:c.join("")}},networkPayModeInfo:function(a){return f.NETWORKPAYMODETITLE[a.internetAccessible.internetChargeType]||"-"},bandwidthInfo:function(a){var b=a.internetAccessible,c=b.internetMaxBandwidthOut||0;return 65535==c?"无限制":c+" Mbps"},canUpgradeToKvm:function u(a){var b=f.HYPERVISOR,c=100001,u=!1,d=a.isPrepaidUser;return!(d&&b&&b.ENABLE&&a.opsAvailable&&a.opsAvailable.XENTOKVM)||a.zoneId==c&&a.cbsList&&a.cbsList.length||(u=!0,b.ENABLE_WINDOWS||"windows"!==a.osType?!b.ENABLE_CBS&&a.cbsList&&a.cbsList.length&&(u=!1):u=!1),u},deviceImageIdInfo:function(a){return a.imageId||a.image&&a.image.unImgId||"-"},tags:function(a){(a.tags||[]).forEach(function(b){a["label_"+b.tagKey]=b.tagValue})},instanceTypeDesc:function v(a,b){var v=p[a]||a;if(b&&b.length){var c=b.find(function(b){return b.instanceFamily==a});c&&(v=c.name)}return v}};c.exports={get:function(a,b){var c=b.cloudAPIActionNameMap,d=b.whiteList||{};return a.map(function(a,h){var l=a.placement&&a.placement.zone&&b.zones&&b.zones.find(function(b){return b.zone==a.placement.zone});a.idx=h,a.uInstanceId=a.instanceId,a.alias=a.instanceName,a.regionId=b.regionId,a.zone=a.placement&&a.placement.zone,a.zoneId=a.placement&&f.ZONEV3TOZONEIDMAP[a.placement.zone]||l&&l.id,a.zoneName=f.ZONEIDV3TONAMEMAP[a.placement&&a.placement.zone]||l&&l.name||a.placement.zone,a.instanceTypeDesc=q.instanceTypeDesc(a.instanceFamily,b.instanceFamilies),a.cpu=a.CPU=a.cpu||a.CPU,a.mem=a.memory=a.mem||a.memory,a.runflag=a.runFlag,a.projectId=a.placement&&a.placement.projectId,a.projectName=a.placement&&a.placement.projectName;var m=q.expiredTimeInfoAndStatus(a);a.expiredTimeStatus=m.status,a.expiredTimeStr=m.expiredTimeStr,a.expiredTimeDesc=m.expiredTimeDesc;var o=q.cvmPayModeInfo(a);a.isPrepaid=i.isPrepaidPayMode(a.instanceChargeType),a.cvmPayModeDesc=o.cvmPayModeDesc,a.cvmPayModeTimeDesc=o.cvmPayModeTimeDesc,a.uHostId=a.placement&&a.placement.hostId,a.instanceStatus=a.instanceStatus||{},a.cpuInfo=q.cpuInfo(a),a.memInfo=q.memInfo(a);var p=a.systemDisk;p.storageType=e.STORAGETYPE_DISKTYPE_MAP[p.diskType]||p.diskType,p.diskType="root";var r=[];j.isCloudDiskType(p.storageType)&&r.push(p);var s=a.dataDisks||[];return s.forEach(function(a,b,c){a.storageType=e.STORAGETYPE_DISKTYPE_MAP[a.diskType]||a.diskType,a.diskType="data",c[b]=a,j.isCloudDiskType(a.storageType)&&r.push(a)}),a.cbsList=r,a.systemDisk=q.systemDisk(a),a.dataDisks=q.dataDisks(a),a.ipConfig=a.ipConfig||{},a.ipConfig.eipInfo=a.ipConfig.eipInfo||"",a.ipConfig.eipQuotaData=a.ipConfig.eipQuotaData||"",a.ipConfig.deviceLanIp=a.deviceLanIp=a.privateIpAddresses&&a.privateIpAddresses[0],a.ipConfig.deviceWanIp=a.deviceWanIp=a.publicIpAddresses&&a.publicIpAddresses[0],a.ipConfig.ipConfirm=!1,a.unVpcId=a.virtualPrivateCloud&&a.virtualPrivateCloud.vpcId||"",a.netName=a.virtualPrivateCloud&&a.virtualPrivateCloud.vpcName?a.virtualPrivateCloud.vpcName:"基础网络",a.cidrBlock=a.virtualPrivateCloud&&a.virtualPrivateCloud.cidrBlock,a.vpc={vpcName:a.netName,unVpcId:a.unVpcId},a.osName=a.image&&a.image.osName||a.osName,a.osType=/xserver|windows/i.test(a.osName)?"windows":"linux",a.defaultLoginPort="windows"==a.osType?3389:22,a.unImgId=a.imageId||a.image&&a.image.unImgId,a.imageType?a.imageType=k.TYPE_NAMES[a.imageType]:a.imageType=a.image&&k.TYPE_NAMES[a.image.imageType],a.osIcon=n(a.osName),a.unImgIdInfo=q.deviceImageIdInfo(a),a.bandwidth=a.internetAccessible&&a.internetAccessible.internetMaxBandwidthOut||"0",a.bandwidthInfo=q.bandwidthInfo(a),a.networkPayModeDesc=q.networkPayModeInfo(a),a.cvmConfig=q.cvmConfig(a),a.operateAuth=a.operationMask||0,a.opsAvailable=g.getOperationTag(a.operateAuth,a.runflag),q.tags(a),a.isolatedTimeStr="",i.isShoutdownStatus(a.instanceState)&&(a.isPrepaid?a.isolatedTimeStr=g.formatDate(new Date(new Date(a.isolatedTime).getTime()+24*f.CVM_REMAIN_TIME.PREPAID_DAY*60*60*1e3),"yyyy-MM-dd"):"MANMADE"==a.isolatedSource?a.isolatedTimeStr=g.formatDate(new Date(new Date(a.isolatedTime).getTime()+60*f.CVM_REMAIN_TIME.SECOND_MANMADE_HOUR*60*1e3),"yyyy-MM-dd hh:mm"):a.isolatedTimeStr=g.formatDate(new Date(new Date(a.isolatedTime).getTime()+60*f.CVM_REMAIN_TIME.SECOND_ISO_HOUR*60*1e3),"yyyy-MM-dd hh:mm"),a.cvmPayModeTimeDesc=q.getDeadLineStr(a)),a.lastOperationServiceType=a.lastOperationServiceType||"cvm",a.whiteList=d,q.statusDesc(a),q.statusTitle(a),q.operationTitle(a,{cloudAPIActionNameMap:c,whiteList:d}),q.operationDesc(a),a})},getMore:function(a,b){function c(a,b,c){if(a=a||[],a.error&&(a.type=m.isCamRefused(a.error)?"cam-tips":"error-tips"),!a||!a.length)return a;var d={};return(a||[]).forEach(function(a){a&&a[b]&&(c?(d[a[b]]||(d[a[b]]=[]),d[a[b]].push(a)):d[a[b]]=a)}),d}var d=c(b.ipBlocked||[],"ip"),f=b.unblockable||[],g=c(b.eipQuota,"id"),h=c(b.instanceStatusList,"instanceId"),j=c(b.instanceReturnableStatusList,"instanceId"),n=c(b.connectivityList,"instanceId"),o=c(b.imageList,"id"),p=c(b.eipList,"instanceId"),r=c(b.cbsList,"uInstanceId",!0),s=c(b.vpcList,"unVpcId"),t=c(b.actionTimerList,"instanceId",!0),u=c(b.instanceDeniedActionList,"instanceId"),v=c(b.paiInstanceSet,"instanceId");return a.map(function(a){a.ipConfig=a.ipConfig||{},a.deniedActions=u[a.instanceId]&&u[a.instanceId].deniedActions||[];var b=t[a.instanceId];if(b&&b.length){var m=b.filter(function(a){return"TerminateInstances"==a.timerAction&&"UNDO"===a.status});m&&m.length&&(a.terminateTimer=m[0])}if(a.terminateTimer=a.terminateTimer||null,a.deviceLanIp)if(p.error)a.eipInfo__graphql_error=a.ipConfig.eipInfo__graphql_error=p.error;else{var w=p[a.instanceId];w&&(a.eip=l.formatList([w],{isNetworkShiftUpUser:a.isNetworkShiftUpUser})[0],a.eip.eip=a.eip.addressIp,a.eip.eipId=a.eip.addressId,a.ipConfig.eipInfo=a.eip)}if(a.eipInfo=a.ipConfig.eip=a.eip,a.ipConfig.ipConfirm=!0,h.error||j.error)a.statusDesc__graphql_error=h.error||j.error;else{var x=h[a.instanceId],y=j[a.instanceId];x&&y&&(x=Object.assign({},x,y),a.status=a.instanceStatus=x,a.runflag=x.runFlag,a.hypervisor=x.hypervisor)}if(o.errors&&o.errors.length)a.image__graphql_error=o.errors[0];else{var z=o[a.imageId];z&&(a.image=z,a.unImgId=z.unImgId,a.imageType=z&&k.TYPE_NAMES[z.imageType],a.unImgIdInfo=q.deviceImageIdInfo(a))}if(s.error)a.virtualPrivateCloud.vpcId&&(a.netName__graphql_error=s.error);else{var A=s[a.virtualPrivateCloud.vpcId];A&&(a.virtualPrivateCloud.vpcName=a.netName=A.vpcName,a.virtualPrivateCloud.vpcCIDR=A.vpcCIDR)}a.virtualPrivateCloud.vpcName||(a.virtualPrivateCloud.vpcName=a.netName=a.virtualPrivateCloud.vpcId?"私有网络":"基础网络"),a.vpc={vpcName:a.netName,unVpcId:a.unVpcId};var B=r[a.instanceId];if(B){B.forEach(function(a,b,c){a.storageType=e.STORAGETYPE_DISKTYPE_MAP[a.storageType]||a.storageType});var C=c(B,"diskId");a.dataDisks.forEach(function(a,b,c){c[b]=C[a.diskId]||a}),a.systemDisk=C[a.systemDisk.diskId]||a.systemDisk,a.cbsList=B,a.systemDisk=q.systemDisk(a),a.dataDisks=q.dataDisks(a),a.cbsListMap=C}if(a.canUpgradeToKvm=q.canUpgradeToKvm(a),a.connectivity=n[a.instanceId]||{},a.connectivity.ICMP=a.connectivity.iCMPConnectivity,a.connectivity.defaultLoginPort=a.connectivity.defaultLoginPortConnectivity,a.ipConfig.eipQuotaData=g?g.TOTAL_EIP_QUOTA:null,a.cvmConfig=q.cvmConfig(a),a.deviceWanIp){a.unblockable=f&&!f.error&&!!f.find(function(b){return b.WanIp==a.deviceWanIp&&0==b.Code});var D=d[a.deviceWanIp];D&&(a.ipBlocked=1==D.status,a.ipBlockedTime=D.unblockTime||"")}return i.isPrepaidPayMode(a.instanceChargeType)&&(a.canRefund=a.isCvmRefundUser&&a.status&&a.status.isReturnable,a.refundReason=a.isCvmRefundUser&&a.status&&a.status.returnFailMessage||"包年包月机器不支持销毁"),v[a.instanceId]&&(a.paiInfo=v[a.instanceId]),a})},getRootSystemIcon:n}}),define("cvm/fieldsManager/gridView",function(a,b,c){var d=a("cvm/common/components/columsWidth/ColumsWidth"),e=a("cvm/event/customField/customField"),f=a("$"),g=a("tips"),h=function(a,b){b=b||this.colums;var c=d(b,a,this.gridWidth);this.setColums(c)},i=function(a,b){var c=[];try{c=(localStorage.getItem(a)||"").split(",")}catch(d){c=b.map(function(a){return!a.hide||a.required?a.key:void 0})}var e=b.reduce(function(a,b){return c.indexOf(b.key)>-1&&(a[b.key]=b),a},{});return{data:e,fields:c}},j=function(a,b){var c=[],d=[],e=[];try{e=(localStorage.getItem(b)||"").split(",")}catch(f){e=a.map(function(a){return!a.hide||a.required?a.key:void 0})}return a.forEach(function(a){c.push({alias:a.name,uuid:a.key,selected:a.selected&&!a.hide,required:a.required,line:a.line}),(a.required||e.indexOf(a.key)>-1&&!a.hide)&&d.push({alias:a.name,uuid:a.key,selected:a.selected&&!a.hide,required:a.required})}),{list:c,selected:d}};c.exports=function(a,b,c){return{$afterInit:function(){var a=this;a.$watch("colums.length",function(b){a.buildFieldsManager()},!0),f(b).click(function(){a.showFieldsManager()})},buildFieldsManager:function(b){var d=this,f=d.$get("colums")||[],g=j(f,a);d.fm=new e({list:g.list,selected:g.selected,cb:d.setFields(f),maxColumsNum:c,reset:d.buildFieldsManager.bind(d)}),h.call(d,i(a,f),f)},showFieldsManager:function(a){var b=this;b.buildFieldsManager();b.fm.showDialog()},formatColums:function(b,f,g){var h=this,k=j(b,a);return h.fm=new e({list:k.list,selected:k.selected,cb:h.setFields(b),maxColumsNum:c,reset:h.buildFieldsManager.bind(h)}),d(b,i(a,b),f)},setFields:function(b){var c=this;return function(d){try{localStorage.setItem(a,d.map(function(a){return a.uuid}).join(","))}catch(e){console.warn(e)}h.call(c,i(a,b),b),g.success("设置成功")}}}}}),define("cvm/cvm/main",function(a,b,c){var d=(a("$"),a("pageManager"),a("manager"),a("util"),a("appUtil")),e=a("cvm/cvm/cvmlist"),f=a("cvm/common/components/SmartHelper");c.exports={render:function(a,b){var c=arguments.length;2==c||(1==c?(b=a,a=""):(b=a,a={})),"detail"==a||(d.getRegionId()>0?"":d.setRegionId(1),e.render(b),d.isI18n()||f.show())},destroy:function(){e.destroy(),d.isI18n()||f.destroy()}}}),define("cvm/cvm/search_box",function(a,b,c){function d(a,b){var c;if(a=a||[],!b)return c;for(var d=0;d<a.length;d++)if(b(a[d])){c=a[d];break}return c}function e(a,b,c){if(c&&(a.zoneIdList&&b.push({values:z(a.zoneIdList,c.zoneList),attr:w[4]}),a.deviceClassList&&b.push({values:A(a.deviceClassList,c.cvmTypeList),attr:w[5]}),a.cvmPayModeList&&b.push({values:B(a.cvmPayModeList,c.payModeList),attr:w[6]}),void 0!==a.projectId&&b.push({values:D(a.projectId,c.asyncProjectData),attr:{key:"projectId",name:"所属项目",type:"multiple"}})),a.instanceState&&b.push({values:C(a.instanceState,u),attr:w[2]}),a.instanceName&&b.push({values:a.instanceName.map(function(a){return{name:a}}),attr:w[0]}),a.uInstanceIds&&b.push({values:a.uInstanceIds.map(function(a){return{name:a}}),attr:w[1]}),a.searchWord||a.ips){if(a.searchWord)var d=[{name:a.searchWord}];else d=a.ips.map(function(a){return{name:a}});b.push({values:d,attr:w[3]})}a.tag&&b.push({values:a.tag.map(function(a){return{name:a}}),attr:w[7]}),a.vpcId&&(b.push({values:[{name:a.vpcId}],attr:q}),-1==w.indexOf(q)&&w.push(q)),a.subnetIds&&(b.push({values:a.subnetIds.map(function(a){return{name:a}}),attr:r}),-1==w.indexOf(r)&&w.push(r)),a.uHostIds&&(b.push({values:a.uHostIds.map(function(a){return{name:a}}),attr:s}),-1==w.indexOf(s)&&w.push(s)),a.psId&&(b.push({values:[{name:a.psId}],attr:t}),-1==w.indexOf(t)&&w.push(t))}var f,g,h=a("config/reactSupport"),i=a("manager"),j=a("appUtil"),k=a("tips"),l=/^(?:(?:[1-9]?[0-9]|1[0-9]{2}|2(?:[0-4][0-9]|5[0-5]))\.){3}(?:[1-9]?[0-9]|1[0-9]{2}|2(?:[0-4][0-9]|5[0-5]))$/,m=/^\d{1,3}((\.(\d{1,3})?)?){0,3}$/,n=/^ins-/,o={key:-1,name:"全部项目"},p={key:"projectId",name:"所属项目",type:"multiple"},q={key:"vpcId",name:"私有网络ID",type:"input"},r={key:"subnetIds",name:"子网ID",type:"input"},s={key:"uHostIds",name:"宿主机ID",type:"input"},t={key:"psId",name:"置放群组Id",type:"input"},u=[{key:"PENDING",name:"创建中"},{key:"RUNNING",name:"运行中"},{key:"STOPPED",name:"已关机"},{key:"SHUTDOWN",name:"待回收"},{key:"REBOOTING",name:"重启中"}],v=[],w=[{type:"input",key:"instanceName",name:"实例名"},{type:"input",key:"uInstanceIds",name:"实例ID"},{type:"multiple",key:"instanceState",name:"实例状态"},{type:"input",key:"searchWord",name:"IP"},{type:"multiple",key:"zoneIdList",name:"可用区"},{type:"multiple",key:"deviceClassList",name:"实例类型"},{type:"multiple",key:"cvmPayModeList",name:"实例计费模式"},{type:"input",key:"tag",name:"标签"}],x=function(){i.getProjects(function(a){if(a&&a.data&&a.data.length&&(1!=a.data.length||0!=a.data[0].projectId)){var b=j.getProjectId(),c=!1,d=[o],e=null;a.data.forEach(function(a){var f={key:a.projectId,name:a.name};b==a.projectId&&(c=!0,e=f),d.push(f)}),c?v.push({attr:p,values:[e]}):v.push({attr:p,values:[o]}),-1==w.indexOf(p)&&(p.values=d,w.push(p))}})},y=function(a){w[2].values=u;var b=a.zoneList,c=[];b.forEach(function(a){c.push({key:a.id,name:a.name,value:a.zone})}),w[4].values=c;var e=a.cvmTypeList,f=[];e.forEach(function(a){var b=d(f,function(b){return b.name==a.name});b?b.key+=","+a.instanceFamily:f.push({key:a.instanceFamily,name:a.name})}),w[5].values=f;var g=a.payModeList,h=[];g.forEach(function(a){h.push({key:a.name,name:a.description})}),w[6].values=h,E(a)},z=function(a,b){return a.map(function(a){for(var c=0;c<b.length;c++)if(b[c].zone==a)return{key:b[c].id,name:b[c].name,value:b[c].zone}})},A=function(a,b){return a.map(function(a){var c=b.filter(function(b){return b.instanceFamily===a})[0];return{key:c.instanceFamily,name:c.name}})},B=function(a,b){return a.map(function(a){var c=b.filter(function(b){return b.name===a})[0];return{key:c.name,name:c.description}})},C=function(a,b){return a.map(function(a){var c=b.filter(function(b){return b.key===a})[0];return{name:c.name,key:c.key}})},D=function(a,b){return a.map(function(a){var c=b.filter(function(b){return b.projectId==a})[0];return c?{key:c.projectId,name:c.name}:{key:-1,name:"全部项目"}})},E=function(a){if(g){if(g.zoneIdList){var b=a.zoneList,c=z(g.zoneIdList,b);c=c.filter(function(a){return a}),c.length&&v.push({values:c,attr:w[4]})}if(g.deviceClassList){var d=a.cvmTypeList,c=A(g.deviceClassList,d);v.push({values:c,attr:w[5]})}if(g.cvmPayModeList){var e=a.payModeList,c=B(g.cvmPayModeList,e);v.push({values:c,attr:w[6]})}f&&f.setState({value:v}),g=null}},F=function(a){a=a||[];for(var b={},c=0;c<a.length;c++){var d=a[c];if(null!=d.attr)if(d.attr=d.attr||{},"projectId"==d.attr.key&&j.setProjectId(d.values[0].key),"searchWord"==d.attr.key)l.test(d.values[0].name)?(b.ips=b.ips||[],b.ips=b.ips.concat(d.values.map(function(a){return a.name}))):(b.searchWord=b.searchWord||[],b.searchWord=b.searchWord.concat(d.values.map(function(a){return a.name})));else if("deviceClassList"==d.attr.key){var e=[];d.values.forEach(function(a){e=e.concat(a.key.split(","))}),b[d.attr.key]=e}else"instanceName"==d.attr.key?(b.instanceName=b.instanceName||[],b.instanceName=b.instanceName.concat(d.values.map(function(a){return a.name}))):"zoneIdList"==d.attr.key?(b.zoneIdList=b.zoneIdList||[],b.zoneIdList=b.zoneIdList.concat(d.values.map(function(a){return a.value}))):"input"==d.attr.type?(b[d.attr.key]=b[d.attr.key]||[],b[d.attr.key]=b[d.attr.key].concat(d.values.map(function(a){return a.name}))):"single"==d.attr.type?b[d.attr.key]=d.values[0].key:b[d.attr.key]=d.values.map(function(a){return a.key});else{var f="instanceName";l.test(d.values[0].name)?f="ips":m.test(d.values[0].name)?f="searchWord":n.test(d.values[0].name)&&(f="uInstanceIds"),b[f]=b[f]||[],b[f]=b[f].concat(d.values.map(function(a){return a.name}))}}if(b.searchWord){if(b.searchWord.length>1)return k.error("IP段暂不支持批量模糊搜索"),null;b.searchWord=b.searchWord[0]}if(b.vpcId){if(b.vpcId.length>1)return k.error("vpcId暂不支持批量查询"),null;b.vpcId=b.vpcId[0]}if(b.psId){if(b.psId.length>1)return k.error("置放群组Id暂不支持批量查询"),null;b.psId=b.psId[0]}return b.ips&&1==b.ips.length&&(b.searchWord=b.ips[0],delete b.ips),"undefined"==typeof b.projectId&&-1!=j.getProjectId()&&j.setProjectId(-1),b.instanceName&&1==b.instanceName.length?b.vagueInstanceName=b.instanceName[0]:b.preciseInstanceName=b.instanceName,b};b.init=function(a){var b=this,c=!0,d=function(b){var d=F(b);if(/backfrom=cvmdetai/.test(location.search)&&c)c=!1;else{var e={res:b,returnData:d};try{localStorage.setItem("CVM_QUERY_HISTORY",JSON.stringify(e))}catch(f){console.warn(f)}}d&&a&&a(d)};x();var e=null;h.useTea(function(){function c(){null!=document.getElementById("searchArea")&&(f=h.render(React.createElement(i,null),document.getElementById("searchArea")),b.boxContainer=f,b.boxContainer.tagSearchRef=e)}var g=window.tea.component.TagSearchBox,h=React.__SECRET_DOM_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,i=React.createClass({displayName:"TSearchBox",getInitialState:function(){return{value:v}},onChange:d,render:function(){return React.createElement(g,{ref:function(a){return e=a},attributes:w,tipZh:"关键字用“|”分隔，过滤标签用回车键分隔",value:this.state.value,onChange:d})}});c();var j=F(v);j&&a&&a(j)})},b.setData=function(a){var b={zoneList:a.zones&&a.zones.nodes||[],cvmTypeList:a.instanceFamilies&&a.instanceFamilies.nodes||[],payModeList:a.instancePayModes&&a.instancePayModes.nodes||[]};y(b)},b.setDefaultData=function(a){v=[],e(a,v),g={zoneIdList:a.zoneIdList,deviceClassList:a.deviceClassList,cvmPayModeList:a.cvmPayModeList}},b.destroy=function(){if(null!=document.getElementById("searchArea")){var a=React.__SECRET_DOM_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;a.unmountComponentAtNode(document.getElementById("searchArea"))}},b.attributes=w,b.getZoneSearch=z,b.getDeviceClassSearch=A,b.getCvmPayModeSearch=B,b.getInstanceStateSearch=C,b.getProjectIdSearch=D,b.cvmStatusFilterOptions=u,b.setSearchValue=e}),define("cvm/cvm/task",function(a,b,c){var d=a("$"),e=a("manager"),f=a("tips"),g=(a("util"),a("appUtil")),h=a("widget/msg/msg"),i=a("widget/operatelog/floattips");a("cvm/cvm/event/dropdown");return{check:function(a){var b=a.task,c=a.tipTxt,j=a.from,k=a.objBase,l=a.listIns,m=k,n=b.taskId,o=l.gridView,p=(l.cvmListEl,l.whiteList),q=void 0===p?{}:p,r=a.regionId;void 0==r&&(r=g.getRegionId());var s=k.permResult,t=s?s.hasPermItems:k.selectedItems;if(l.resetItems(t,c),q.UsingNewOperationValidator)setTimeout(function(){l.refresh()},5e3);else{var u=function A(a){e.getFlowCscResult(a,function(b){var c=b.status;0===c?(l.refresh(),h.echo()):2===c?m.timeOut=setTimeout(function(){A(a)},3e3):(!d("#getFlowCscResultErrTip").length&&f.error("操作执行失败"),l.refreshItems(t.map(function(a){return a.uInstanceId}),r),h.echo())},null,j)};if(n){i.showTaskProcessTip({msg:c,business_id:1,task_id:n});for(var v,w=s?s.noPermItems:[],x=0;v=w[x];x++){var y=v.el,z=y.attr("data-index");o.$refs.list[z].$set({$selected:!1})}u({taskId:n,regionId:r}),l.clearCheckTask&&l.clearCheckTask()}else setTimeout(function(){l.refresh()},5e3)}}}}),define("modules/cvm/detail/detail",function(a,b,c){var d=a("$"),e=(a("manager"),a("pageManager"),a("util")),f=a("appUtil"),g=a("cvm/cvm/data"),h=a("cvm/cvm/cvmutil"),i=a("widget/errorTips/errorTips"),j=(a("cvm/common/model"),a("cvm/detail/monitor")),k=a("cvm/detail/paramdetail"),l=a("cvm/detail/oplogdetail"),m=a("cvm/detail/healthdetail"),n=a("reporter"),o=(a("cvm/cvm/format"),a("dataManager"),a("cvm/cvm/event/operate_entry")),p=a("cvm/cvm/event/operate_auth"),q=a("tips"),r=(a("config/constants"),a("dropdown")),s=a("router"),t=a("cvm/detail/enidetail"),u=a("cvm/common/components/SmartHelper"),v=a("lib/dfw-sdk-importer"),w=a("cvm/detail/ipdetail"),x=(a("cvm/cbs2/event/renew"),a("cvm/detail/event/attach"),a("cvm/common/common")),y=(a("cvm/eip2/data"),a("cvm/cbs2/data")),z=null,A={main:'  <div>    <style>      #monitorDetail,      #healthDetail,      #paramDetail,      #opLogDetail {        margin: 0;      }      .tc-15-table-rowhover tr.disable td a.id-link {        color: #0071ce;        cursor: pointer;      }      .convert-ip-icon,      .convert-ip-ash-icon {        display: none;        cursor: pointer;      }      .item-wip-hover .convert-ip-icon,      .item-wip-hover .convert-ip-ash-icon {        display: inline-block;      }      /* .cvm-more-opt {} */    </style>    <div class="manage-area cvm-details">      <div class="manage-area-title secondary-title">        <a href="{{ curNav.url }}" data-event="nav" class="back-link">          <i class="btn-back-icon"></i> {{ curNav.alias }}        </a>        <span class="line-icon">|</span>        <h2>          {{ instanceId }}{{ item ? \'（\' + item.instanceName + \'）\' : \'\' }}        </h2>        <div class="cvm-more-opt manage-area-title-right"></div>      </div>      <div b-if="item" class="manage-area-main secondary-main keyboard-focus-obj" id="detailScrollWrap">        <div class="tc-15-tab tc-15-tab-alt fixed-tab tc-special-tab">          <ul role="tablist" class="tc-15-tablist" id="cvmDetailNav">            <li class="tc-cur" id="paramNav">              <a href="javascript:void(0)" role="tab">基本信息</a>            </li>            <li id="eni">              <a href="javascript:void(0)" role="tab">弹性网卡</a>            </li>            <li b-if="item&&item.isNetworkShiftUpUser" id="ip">              <a href="javascript:void(0)" role="tab">公网IP</a>            </li>            <li id="monitorNav">              <a href="javascript:void(0)" role="tab">监控</a>            </li>            <!--              <li id="healthNav">                <a href="javascript:void(0)" role="tab">健康检查</a>              </li>            -->            <li id="dfwNav">              <a href="javascript:void(0)" role="tab">安全组</a>            </li>            <li id="opLogNav">              <a href="javascript:void(0)" role="tab">操作日志</a>            </li>          </ul>          <!-- 参数 -->          <div class="tab-panel param-panel" id="paramDetail" data-detail-type="param"></div>          <!-- 弹性网卡 -->          <div class="tab-panel param-panel" id="eniDetail" data-detail-type="eni">            <style>              .eip-oper-cell a.disabled,              .eip-oper-cell a.disabled:hover {                color: #999;                cursor: default;              }              .eip-oper-cell a.disabled:hover {                text-decoration: none;              }            </style>          </div>          <!-- 公网IP -->          <div class="tab-panel param-panel" data-detail-type="ip">            <div class="manage-area-full-inner" id="ipDetail"></div>          </div>          <!-- 监控 -->          <div class="tab-panel" style="display:none" data-detail-type="monitor">            <div class="manage-area-full-inner" id="monitorDetail"></div>          </div>          <!-- 健康度 -->          <div class="tab-panel health-panel" id="healthDetail" style="display:none" data-detail-type="health"></div>          <!-- 安全防火墙 -->          <div class="tab-panel dfw-panel" style="display:none" data-detail-type="dfw">            <div class="manage-area-full-inner" id="dfwDetail"></div>          </div>          <!-- 操作日志 -->          <div class="tab-panel log-panel" id="opLogDetail" style="min-height:320px;display:none;"            data-detail-type="opLog"></div>        </div>      </div>    </div>  </div>'
},B=e.tmpl('  <!-- <div class="cvm-oper-cell" style="white-space:nowrap"> -->  <button class="tc-15-btn weak m" data-name="DescribeInstanceVncUrl" data-event="web_ssh" data-hot="yunzhuji.web">    登录  </button>  <% if (isPrepaidUser && !isSecondPayMode) { %>  <button class="tc-15-btn weak m" data-name="RenewInstances" data-event="cvm_oper_action">    续费  </button>  <% } %>  <div class="tc-15-dropdown tc-15-dropdown-btn-style tc-15-menu-active">    <a href="javascript:;" class="tc-15-dropdown-link">更多操作 <i class="caret"></i>    </a>  </div>  <!-- </div> -->',null),C=e.tmpl('  <div class="tc-15-dropdown tc-15-dropdown-btn-style tc-15-menu-active" id="cvmRowDropdown">    <a href="javascript:;" class="tc-15-dropdown-link">更多操作 <i class="caret"></i>    </a>    <ul class="tc-15-dropdown-menu" role="menu">      <li data-name="RebootInstances" title="重启" data-event="cvm_oper_action" role="presentation">        <a href="javascript:;" role="menuitem">重启</a>      </li>      <li data-name="StartInstances" title="开机" data-event="cvm_oper_action" role="presentation">        <a href="javascript:;" role="menuitem">开机</a>      </li>      <li data-name="StopInstances" title="关机" data-event="cvm_oper_action" role="presentation">        <a href="javascript:;" role="menuitem">关机</a>      </li>      <% if (!isPrepaidUser) { %>      <li data-event="cvm_oper_action" title="退还实例" role="presentation" data-name="returncvm">        <a href="javascript:;" role="menuitem">退还实例</a>      </li>      <% } else { %>      <li data-event="cvm_oper_action" title="销毁/退还" role="presentation" data-name="TerminateInstances">        <a href="javascript:;" role="menuitem">销毁/退还</a>      </li>      <% } %>      <li role="presentation" class="sep-line"></li>      <li data-name="ModifyInstancesAttribute.InstanceName" title="改名" data-event="cvm_oper_action" role="presentation">        <a href="javascript:;" role="menuitem">改名</a>      </li>      <% if (isPrepaidUser) { %>      <li data-name="ResetInstancesType" title="调整配置" data-event="cvm_oper_action" role="presentation">        <a href="javascript:;" role="menuitem">调整配置</a>      </li>      <li data-name="ResizeInstanceDisks|ResizeDisk" title="调整硬盘" data-event="cvm_oper_action" role="presentation">        <a href="javascript:;" role="menuitem">调整硬盘</a>      </li>      <% } %> <%if(isNetworkShiftUpUser && (!data.deviceWanIp ||      data.eipInfo)){%>      <li data-name="upgradeEipBandwidth" title="调整网络" data-event="cvm_oper_action">        <a href="javascript:;">调整网络</a>      </li>      <% }else{ %>      <li data-name="ResetInstancesInternetMaxBandwidth" title="调整网络" data-event="cvm_oper_action">        <a href="javascript:;">调整网络</a>      </li>      <% } %> <% if (isShowSystemDiskDataCopy) { %>      <li data-name="CopyInstanceDisk" title="拷贝系统盘数据" data-event="cvm_oper_action">        <a href="javascript:;">拷贝系统盘数据</a>      </li>      <% } %> <% if (!!whiteList.local_to_cbs) { %>      <li data-name="ModifyInstanceDiskType" title="调整硬盘介质" data-event="cvm_oper_action" role="presentation">        <a href="javascript:;" role="menuitem">调整硬盘介质</a>      </li>      <% } %>      <li data-name="BindAutoSnapshotPolicy" title="设置定时快照策略" data-event="cvm_oper_action" role="presentation">        <a href="javascript:;" role="menuitem">设置定时快照策略</a>      </li>      <li role="presentation" class="sep-line"></li>      <li data-name="ResetInstancesPassword" data-event="cvm_oper_action" title="重置密码" role="presentation">        <a href="javascript:;" role="menuitem">重置密码</a>      </li>      <li data-name="AssociateInstancesKeyPairs" data-event="cvm_oper_action" title="加载密钥" role="presentation">        <a href="javascript:;" role="menuitem">加载密钥</a>      </li>      <li data-name="buysameconfig" data-event="cvm_oper_action" title="购买相同配置" role="presentation">        <a href="javascript:;" role="menuitem">购买相同配置</a>      </li>      <li role="presentation" class="sep-line"></li>      <% if (!notShow_firewall) { %>      <li data-control="firewall" data-name="ModifyInstancesAttribute.SecurityGroups" title="配置安全组"        data-event="cvm_oper_action" role="presentation">        <a href="javascript:;" role="menuitem">配置安全组</a>      </li>      <% if (data.securityGroupIds && data.securityGroupIds.length) { %>      <li data-control="firewall" data-name="checkPort" title="实例端口验通" data-event="cvm_oper_action" role="presentation">        <a href="javascript:;" role="menuitem">实例端口验通</a>      </li>      <% } %> <% } %>      <li data-name="AttachNetworkInterface" data-event="cvm_oper_action" title="绑定弹性网卡">        <a href="javascript:;">绑定弹性网卡</a>      </li>      <li data-name="DetachNetworkInterface" data-event="cvm_oper_action" title="解绑弹性网卡">        <a href="javascript:;">解绑弹性网卡</a>      </li>      <li role="presentation" class="sep-line"></li>      <li data-name="CreateImage" data-event="cvm_oper_action" role="presentation" title="制作镜像">        <a href="javascript:;" role="menuitem">制作镜像</a>      </li>      <li data-name="ResetInstance" data-event="cvm_oper_action" role="presentation" title="重装系统">        <a href="javascript:;" role="menuitem">重装系统</a>      </li>      <% if (!isI18n || isPrepaidPayMode) { %>      <li data-event="cvm_oper_action" data-name="ModifyInstancesRenewFlag" title="设置自动续费">        <a href="javascript:;">设置自动续费</a>      </li>      <% } %>      <li data-name="ModifyInstancesVpcAttribute" data-event="cvm_oper_action" role="presentation" title="切换私有网络">        <a href="javascript:;" role="menuitem">切换私有网络</a>      </li>      <% if (!notShow_changeproject) { %>      <li data-control="changeproject" data-name="ModifyInstancesProject" data-event="cvm_oper_action"        role="presentation" title="分配至项目">        <a href="javascript:;" role="menuitem">分配至项目</a>      </li>      <% } %>      <li role="presentation" data-event="cvm_oper_action" data-name="tag" title="编辑标签">        <a href="javascript:;">编辑标签</a>      </li>      <%if(isNetworkShiftUpUser && data.deviceWanIp){%>      <li data-name="TransformAddress" data-event="cvm_oper_action" role="presentation" title="绑定弹性IP">        <a href="javascript:;" role="menuitem">转换弹性IP</a>      </li>      <% } else{%>      <li data-name="AssociateAddress" data-event="cvm_oper_action" role="presentation" title="绑定弹性IP">        <a href="javascript:;" role="menuitem">绑定弹性IP</a>      </li>      <% } %>      <li data-name="DisassociateAddress" data-event="cvm_oper_action" role="presentation" title="解绑弹性IP">        <a href="javascript:;" role="menuitem">解绑弹性IP</a>      </li>      <% if (!isNetworkShiftUpUser && data.deviceWanIp) { %>      <li data-name="ReturnNormalAddresses" data-event="cvm_oper_action" role="presentation" title="退还公网IP">        <a href="javascript:;" role="menuitem">退还公网IP</a>      </li>      <% } %> <% if (!isI18n) { %>      <li data-name="ModifyInstancesChargeType" data-event="cvm_oper_action" role="presentation" title="按量转包年包月">        <a href="javascript:;" role="menuitem">按量转包年包月</a>      </li>      <% } %>      <li        data-name="export"        data-event="cvm_oper_action"        role="presentation"        title="导出实例"      >        <a href="javascript:;" role="menuitem">导出实例</a>      </li>    </ul>  </div>',null),D={},E={},F=o.getModuleMap(),G=null,H=function(a,b,e){d("#detailScrollWrap").scrollTop(0);var f={param:"#paramDetail",eni:"#eniDetail",ip:"#ipDetail",health:"#healthDetail",opLog:"#opLogDetail"};if(d("#cvmDetailNav li").removeClass("tc-cur"),a.addClass("tc-cur").siblings().removeClass("tc-cur"),d("[data-detail-type]").hide(),d("[data-detail-type="+b+"]").show(),z){D[b]||(D[b]=!0,"monitor"==b?(j.showDetail(z,document.getElementById("monitorDetail")),n.collect({operId:18,operType:2,from:"detail"})):"dfw"==b?v.ready().then(function(a){a.build(d.extend({mustBindDfw:!0,type:"cvm",isMultiple:!0,showProjectSelector:!0},z,{instanceId:z.uInstanceId}),d("#dfwDetail")[0])}):e&&e.render(d(f[b]),z,c.exports));var g="monitor"===b?"jiankong":"param"===b?"canshu":"rizhi";"health"==b&&(g="health"),n.click("yunzhuji."+g)}};c.exports={title:"实例-控制台",pageClass:"",getIpBlockInfo:function(a,b){return new Promise(function(c,d){a.wipArr.length?g.queryIpBlockInfo({vipList:wipArr,region:a.regionId},b).then(function(a){c(a&&a.list||[])},function(a){c({error:a})}):c([])})["catch"](function(a){return{error:a}})},getUnBlockInfo:function(a,b){return new Promise(function(c,d){var e=a.deviceList.filter(function(a){return a.isSafeIsolated}).map(function(a){return a.deviceWanIp});e.length?g.queryUnBlockInfo({wanip:e},b).then(c,function(a){c({error:a})}):c([])})["catch"](function(a){return{error:a}})},getEip:function(a,b){return new Promise(function(c,d){a.instanceId?g.queryEip({filters:[{name:"instance-id",values:[a.instanceId]}],limit:1,regionId:a.regionId},b).then(function(a){c({addressSet:a.response.addressSet})},function(a){a=a||{},a.isCam=i.isCamRefused(a),c({error:a})}):c([])})},getDisks:function(a,b){return new Promise(function(c,d){y.queryDisks({filters:[{name:"instance-id",values:[a.instanceId]}],limit:50,offset:0,regionId:a.regionId},b).then(function(a){c({diskSet:a.response.diskSet})},function(a){a=a||{},a.isCam=i.isCamRefused(a),c({error:a})})})},getActionTimer:function(a,b){return new Promise(function(c,d){g.queryInstancesActionTimer({instanceIds:[a.instanceId],regionId:a.regionId},b).then(function(a){c(a&&a.response&&a.response.actionTimers?a.response.actionTimers:[])},function(a){c([])})})},render:function(){function a(a,c,d){return b.apply(this,arguments)}var b=_asyncToGenerator(regeneratorRuntime.mark(function c(a,b,d){return regeneratorRuntime.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.abrupt("return",s.navigate("/cvm/instance/detail?id="+b+"&rid="+a));case 13:case"end":return c.stop()}},c,this)}));return a}(),renderNav:function(a){for(var b=this,c=d(".qc-aside-level-1,.qc-aside-level-2"),e={alias:"实例",url:"/cvm?backfrom=detail"},f=0;f<c.length;f++)if(c.eq(f).hasClass("qc-aside-select")){e.alias=c.eq(f).find("span").html()||c.eq(f).html(),e.url=c.eq(f).attr("href");break}e.url+="?backfrom=cvmdetai",b.detailBee=new Bee({$tpl:A.main,$data:{curNav:e,instanceId:a,item:null}}),b.detailContainer.html(b.detailBee.$el)},renderUi:function(a){var b=this.isPrepaidUser,c=h.isSecondPayMode(a.instanceChargeType);this.detailBee.$set("item",a),G&&G.hottag("renderCvmDetail","gotCvmData");var e=B({isPrepaidUser:b,isSecondPayMode:c});d(".cvm-more-opt").html(e),d(".manage-area-title").off().on("click","[data-router]",function(a){for(var b=d(a.currentTarget),c=d(".qc-aside-level-1"),e=b.data("router")||"/",f=0;f<c.length;f++)if(c.eq(f).hasClass("qc-aside-select")){e=c.eq(f).attr("href");break}var g=location.search.match(/backfrom=(\w+)/);g&&g[1]?s.navigate(e+"?backfrom="+g[1]):s.navigate(e)}),d(".cvm-more-opt").on("click","button",function(b){var b=b||window.event,c=b.target||b.srcElement,e=d(c).attr("data-event");if(d(this).attr("data-disabled"))return void q.error(d(this).attr("data-title"));if("web_ssh"==e){if(d(this).hasClass("disabled"))return;f.showVnc(d(".cvm-more-opt"))}else if("cvm_oper_action"==e){var g=d(this);if(g.hasClass("disabled"))return;if(d(".cvm-more-opt").attr("data-isloading"))return void q.flash("正在执行任务");var h=g.attr("data-name"),i=[];i.push(a);var j=o.refresh(i,!0);o.exec(h,i,j)}return!1});var f=this;this.setAttr(a),this.initOper(a),d(".param-panel").on("click",'[data-action="editAlias"]',function(){if(d(".cvm-more-opt").attr("data-isloading"))return void q.flash("正在执行任务");var b=[];return b.push(a),o.exec(d(this).attr("data-name"),b),!1}),d(".param-panel").on("click",'[data-action="bindEip"]',function(){if(d(".cvm-more-opt").attr("data-isloading"))return void q.flash("正在执行任务");var b=[];return b.push(a),o.exec(d(this).attr("data-name"),b),!1}),d(".param-panel").on("click",'[data-action="tag"]',function(){if(d(".cvm-more-opt").attr("data-isloading"))return void q.flash("正在执行任务");var b=[];return b.push(a),o.exec(d(this).attr("data-name"),b),!1}),d(".param-panel").on("click","#detail-dfwNav",function(){d("#dfwNav").trigger("click")}),d(".param-panel").on("click","#detail-eni",function(){d("#eni").trigger("click")}),d(".param-panel").on("click",'[data-action="hostDetail"]',function(){var b="/cvm/cdh/detail/"+f.lastParams.regionId+"/"+a.uHostId;s.navigate(b)});var g={cvmListEl:d("#paramDetail"),projectData:a.projectData,isPrepaidUser:this.isPrepaidUser,isBandwidthPackageUser:this.isBandWidthPackageUser,isNetworkShiftUpUser:this.isNetworkShiftUpUser,operatedCallback:function(){f.business&&f.business.operatedCallback&&f.business.operatedCallback()},refresh:function(){f.render(f.lastParams.regionId,f.lastParams.instanceId,!0)}};f.listIns=o.listIns=g,d("#cvmDetailNav li").bind("click",function(a){var b=d(this).attr("id"),c=d(this).attr("class");if(b||c){var e=(b||c).replace("Nav","");switch(e){case"monitor":f.business=j;break;case"health":f.business=m;break;case"param":f.business=k,n.click("CvmDetail.BasicInfo");break;case"opLog":f.business=l;break;case"eni":f.business=t;break;case"dfw":n.click("CvmDetail.SecurityGroup");break;case"ip":f.business=w}H(d(this),e,f.business)}}),d("#paramNav a").trigger("click")},showVnc:function(a){o.exec("DescribeInstanceVncUrl",[z]);var b="yunzhuji.showvnc",c=a.attr("data-osType");c&&(b+="linux"==c?"_linux":"_windows"),n.click(b)},setAttr:function(a){var b={"data-deviceLanIp":a.deviceLanIp,"data-uuid":a.uuid,"data-osType":a.osType};a.$loading&&(b["data-isLoading"]=!0);for(var c in b)d(".cvm-more-opt").attr(c,b[c])},initOper:function(a){var b=this,c=d(".tc-15-dropdown-link");if(d(".cvm-more-opt").attr("data-isloading")){var e=d(".cvm-more-opt"),f="正在执行任务";return e.find(">button").addClass("disabled").attr("data-title",f),void e.find(".tc-15-dropdown-link").addClass("disabled").attr("data-title",f)}for(var g,h=d(".cvm-more-opt"),i=["DescribeInstanceVncUrl","RenewInstances"],j=new p({whiteList:this.whiteList,dataItems:[a],operAction:i,operActionModuleMap:o.getModuleMap(),listIns:b}),k=j.getAuth(),l=0;g=i[l];l++){var m=h.find('[data-name="'+g+'"]');k[g]&&m.length&&(0===k[g].code?m.removeClass("disabled").attr("data-title",""):m.addClass("disabled").attr("data-title",k[g].tip))}c.off("click").on("click",function(){return d(this).parent().hide(),b.showRowDropDown(this,a),!1})},showRowDropDown:function(a,b){var c=(d(a),d(".cvm-more-opt")),e=d("#cvmRowDropdown");if(!e.length){var e=d(C({isI18n:f.isI18n(),whiteList:this.whiteList,isPrepaidUser:this.isPrepaidUser,isNetworkShiftUpUser:this.isNetworkShiftUpUser,isPrepaidPayMode:h.isPrepaidPayMode(b.instanceChargeType),isBandWidthPackageUser:this.isBandWidthPackageUser,notShow_changeproject:this.notShow_changeproject,notShow_firewall:this.notShow_firewall,isShowSystemDiskDataCopy:this.isShowSystemDiskDataCopy,data:b})).hide();c.append(e);var g=new r(e,{newMode:!0});e.data("dropdown",g)}e.data("onTr",c);this.isPrepaidUser,h.isSecondPayMode(b.instanceChargeType);e.show().data("dropdown").show(),this.displayOperMenu(e,c,b)},displayOperMenu:function(a,b,c){var e=this;for(var f in F){var g=F[f];E[f]=new g.module({listIns:e.listIns,button:d(".cvm-more-opt").find('[data-name="'+f+'"]'),selectedItem:[]})}var h=new p({whiteList:this.whiteList,dataItems:[c],operAction:o.getModuleArr(),operActionModuleMap:o.getModuleMap(),listIns:e.listIns}),i=h.getAuth();for(var f in E){var j=a.find('[data-name="'+f+'"]');i[f]&&j.length&&(0===i[f].code?j.removeClass("disabled").attr("data-title",""):j.addClass("disabled").attr("data-title",i[f].tip))}d(".tc-15-dropdown").on("click","li",function(){if(!d(this).hasClass("disabled")){var a=[];a.push(c);var b=o.refresh(a,!0);o.exec(d(this).attr("data-name"),a,b,{cloudAPIActionNameMap:e.cloudAPIActionNameMap||{},from:"detail"})}})},renderDetailNoData:function(){x.renderDetailNoData("实例","/cvm")},destroy:function(){d("#cvmDetailNav li").unbind("click",H),z=null,D={},k.destroy&&k.destroy(),m.destroy&&m.destroy(),t.destroy(),f.isI18n()||u.destroy()}}}),define("cvm/detail/enidetail",function(a,b,c){var d=a("qccomponent"),e=a("manager"),f=a("dialog"),g=a("tips"),h=a("util"),i=a("appUtil"),j=a("cvm/cvm/event/bindEni/bindEni"),k=a("cvm/cvm/event/unbindEni/unbindEni"),l=a("widget/errorTips/errorTips"),m=a("cvm/cvm/cvmutil"),n=a("cvm/common/model"),o=a("config/reactSupport"),p=d.extend({$tpl:'  <div class="eni">    <div b-on-click="toggle()" class="tc-15-table-panel tc-15-table-panel-edit">      <div class="tc-15-table-fixed-body">        <table class="tc-15-table-box tc-15-table-rowhover">          <colgroup>            <col class="tc-15-table-col1" />            <col class="tc-15-table-col2" />          </colgroup>          <tbody>            <tr              tabindex="0"              b-class="open ? \'selection-summary open\': \'selection-summary\'"            >              <td>                <div class="selection-task-name">                  <i class="icon"></i>                  <span class="text-overflow">{{ item.eniName }}</span>                  <i class="resize-line-icon"></i>                  <a                    href="/vpc/eni/detail?rid={{ regionId }}&id={{                      item.networkInterfaceId                    }}"                    data-event="nav"                    >{{ item.networkInterfaceId }}</a                  >                  <span class="text-label">{{                    item.primary ? \'（主网卡）\' : \'（辅助网卡）\'                  }}</span>                </div>              </td>              <td>                <div class="mod-handle">                  <a                    b-class="canAdd ? \'\' : \'text-weak\'"                    b-on="{click: assignIp()}"                    href="javascript:;"                    >分配内网IP</a                  >                  <a                    b-on="{click: unbindEni()}"                    href="javascript:;"                    class="{{ !item.primary ? \'\' : \'text-weak\' }}"                    data-title="{{                      item.primary ? \'实例的主网卡不能解绑\' : \'\'                    }}"                    >解绑</a                  >                </div>              </td>            </tr>          </tbody>        </table>      </div>    </div>    <ip-manager      b-ref="ipManager"      id="{{ item.networkInterfaceId }}"      hidden-ip-operate="{{ hiddenIpOperate }}"      instance-id="{{ instanceId }}"      region-id="{{ regionId }}"    ></ip-manager>  </div>',$afterInit:function(){i.beeBind(this.$refs.ipManager,this,"canAdd")},unbindEni:function(){var a=this;return function(b){var c=new k,d=a.item.networkInterfaceId;b.stopPropagation(),a.item.primary||f.confirm("确认解绑弹性网卡？",function(){c.sendReq(_defineProperty({networkInterfaceId:d,instanceId:a.instanceId,regionId:a.regionId,zoneId:a.zoneId,unVpcId:a.item.vpcId},"regionId",a.regionId)).then(function(b){return b=(b||{}).data,b&&b.taskId?e.checkTask({regionId:a.regionId,taskId:b.taskId,tips:"正在解挂中..."}):void 0}).then(function(b){g.stopLoading(),f.hide(),f.create(h.tmpl('  <div class="dialog-confirm-box">    <p class="dialog-confirm-title">      <i class="<%= iconClassName %>"></i> <strong> <%= text %> </strong>    </p>    <p class="dialog-confirm-text"><%= desc %></p>  </div>',{text:"解绑成功",desc:"您的弹性网卡已经解绑成功。",iconClassName:"m-success-icon"}),500,"",{struct:"rich",closeIcon:!1,defaultCancelBtn:!1,button:{" 确定 ":function(){f.hide(),a.refreshCb&&a.refreshCb()}}})},function(){g.stopLoading(),f.toggleBtnDisable(!1)})})}},assignIp:function(a){var b=this;return function(a){a.stopPropagation(),b.$refs.ipManager.assignIp()}},toggle:function(){var a=this;$(a.$refs.ipManager.$el).slideToggle(function(){a.$set("open",!a.$get("open"))})}},{defaults:{open:!0}});c.exports={render:function(b,c){var i=this;o.useTea(function(){m.loadJs("vpc",function(){a.async(["modules/vpc/eni-sdk/IPManager"],function(a){var k=d.extend({$tpl:'  <div class="manage-area-full-inner">    <div>      <div class="tc-15-msg" style="margin: 10px 0;" b-if="cvm.unVpcId">        <div class="tip-info">          实例绑定弹性网卡后，您需登录实例配置IP及路由，点击          <a            href="//cloud.tencent.com/document/product/576/18535"            target="_blank"          >            查看操作指南</a          >        </div>      </div>      <div class="param-box">        <div b-if="cvm.unVpcId && cvm.instanceFamily != \'N1\'">          <div class="top-title">            <h3>弹性网卡</h3>            <span b-if="!isBareMetalType">              <a b-on-click="bindEni()" href="javascript:void(0);">绑定网卡</a>            </span>          </div>          <div            b-repeat="item in eni"            b-ref="eniItem"            class="elastic-network-table"          >            <eni              item="{{ item }}"              instance-id="{{ instanceId }}"              region-id="{{ regionId }}"              zone-id="{{ zoneId }}"              vpc-id="{{ unVpcId }}"              hidden-ip-operate="{{ hiddenIpOperate }}"            ></eni>          </div>        </div>        <div          style="padding: 100px; text-align: center"          b-if="cvm.unVpcId && cvm.instanceFamily == \'N1\'"        >          <div class="tc-15-list-legend" style="border: none">            网络优化型实例暂不支持弹性网卡          </div>          <div class="tc-15-list-content">请期待功能升级</div>        </div>        <div b-if="cvm.unVpcId__graphql_error">          <cam-tips> {{ cvm.unVpcId__graphql_error.message }}</cam-tips>        </div>        <div          style="padding: 100px; text-align: center"          b-if="!cvm.unVpcId && !cvm.unVpcId__graphql_error"        >          <div class="tc-15-list-legend" style="border: none">            基础网络实例不支持弹性网卡          </div>          <div class="tc-15-list-content">弹性网卡仅支持私有网络实例</div>        </div>      </div>    </div>  </div>',$afterInit:function(){var a=this;c.unVpcId&&(a.unVpcId=c.unVpcId,n.apiDelegate({serviceType:"vpc",action:"DescribeNetworkInterfaces",data:{instanceId:this.instanceId,hideSecondary:0},regionId:c.regionId},{tipErr:!1,camTips:!1}).then(function(b){var c=b&&b.data&&b.data.data||[];c=c.sort(function(a,b){return a.primary&&!b.primary?-1:!a.primary&&b.primary?1:0}).map(function(a){return a._type=a.primary?"主网卡":"辅助网卡",a.privateIpAddressesSet&&a.privateIpAddressesSet.forEach(function(a){a._type=a.primary?"主IP":"辅助IP"}),a}),a.$set("eni",c)})["catch"](function(a){var b;b=l.isCamRefused(a)?new l.CamTips("<div><cam-tips>"+a.message+"</cam-tips></div>"):new l.ErrorTips("<div><error-tips>"+a.message+"</error-tips></div>"),$("#eniDetail").append(b.$el)}))},bindEni:function(){var a=this,b=new j;b.doAction({instanceId:c.uInstanceId,regionId:c.regionId,zoneId:c.zoneId,zoneName:c.zoneName,unVpcId:c.unVpcId,netName:c.netName}).then(function(a){return a=(a||{}).data,a&&a.taskId?e.checkTask({regionId:c.regionId,taskId:a.taskId,tips:"正在挂载中..."}):new Promise(function(a,b){b()})}).then(function(b){g.stopLoading(),f.hide(),f.create(h.tmpl('  <div class="dialog-confirm-box">    <p class="dialog-confirm-title">      <i class="<%= iconClassName %>"></i> <strong> <%= text %> </strong>    </p>    <p class="dialog-confirm-text"><%= desc %></p>  </div>',{text:"绑定成功",desc:"您的弹性网卡已经绑定成功。",iconClassName:"m-success-icon"}),500,"",{struct:"rich",closeIcon:!1,defaultCancelBtn:!1,button:{" 确定 ":function(){f.hide(),a.refresh()}}})},function(){g.stopLoading(),f.toggleBtnDisable(!1)})},refresh:function(){i.render(b,c)}},{defaults:{cvm:c,isBareMetalType:m.isBareMetalType(c.instanceFamily)}});p.tag("ip-manager",a),k.tag("eni",p.extend({refreshCb:function(){i.render(b,c)}}));var o=new k({$data:{instanceId:c.uInstanceId,regionId:c.regionId,zoneId:c.zoneId,unVpcId:c.unVpcId,hiddenIpOperate:!0}});b.html(o.$el),this.page=o})})})},destroy:function(){this.page&&this.page.$destroy()}}}),define("cvm/detail/event/attach",function(a,b,c){var d=(a("$"),a("event"),a("tips")),e=(a("util"),a("appUtil"),a("dialog")),f=(a("manager"),a("validator"),a("regionSelector"),a("contextmenu"),a("reporter"),a("cvm/common/model"),a("cvm/sshkey/data"),a("cvm/cvm/data"),a("cvm/cvm/cvmutil"),a("widget/errorTips/errorTips"),a("qccomponent")),g=a("cvm/cbs2/data"),h=a("cvm/cbs2/constants"),i=(a("cvm/cbs2/cbsutil"),{attachCbs:'  <div>    <div id="bindServerWrapper">      <!-- <div class="tc-15-mod-selector-area">          <h4 class="run-in">选择地域</h4>          <region-selector b-model="regionId"></region-selector>        </div> -->    </div>    <div class="tc-15-msg">      <ul>        <li>当前实例已挂载{{hasAttached}}块云硬盘，还可以挂载{{restAttached}}块</li>      </ul>    </div>    <device-selector init-get-data="{{false}}" scroll-pager="true" multiple-search="true" list-tpl="{{listTpl}}" selected-tpl="{{selectedTpl}}"      b-ref="ds" title="选择云硬盘" device-name="云硬盘" get-data="{{getData}}" search-place-holder="请输入关键字进行搜索" alias="{{{ id: \'diskId\' }}}"></device-selector>  </div>',listTpl:'  <style>    .item-value {      display: block;      max-width: 16em;      white-space: nowrap;      overflow: hidden;      -ms-text-overflow: ellipsis;      text-overflow: ellipsis;      color: #ababab;    }  </style>  <input type="checkbox" disabled?="item.disabled" class="tc-15-checkbox" b-model="item.selected">  <span class="opt-txt">    <span class="opt-txt-inner" style="width: 30%;">      <span class="item-name">{{item.diskId}}</span>      <span class="item-value text-overflow" data-title="{{item.diskName}}">{{item.diskName}}</span>    </span>    <span class="opt-txt-inner" style="width: 30%;">      <span class="item-name">{{item.diskTypeName}}</span>      <span class="item-value text-overflow" data-title="{{item.diskSizeDesc}}">{{item.diskSizeDesc}}</span>    </span>    <span class="opt-txt-inner" style="width: 30%;">      <span class="item-name">{{item.diskChargeDesc}}</span>      <span class="item-value text-overflow" data-title="{{item.deadlineTime}}">{{item.deadlineTime?(item.deadlineTime + \'到期\'):\'\'}}</span>    </span>  </span>',selectedTpl:'  <style>    .item-value {      display: block;      max-width: 16em;      white-space: nowrap;      overflow: hidden;      -ms-text-overflow: ellipsis;      text-overflow: ellipsis;      color: #ababab;    }  </style>  <span class="opt-txt">    <span class="opt-txt-inner" style="width: 30%;">      <span class="item-name">{{item.diskId}}</span>      <span class="item-value text-overflow" data-title="{{item.diskName}}">{{item.diskName}}</span>    </span>    <span class="opt-txt-inner" style="width: 30%;">      <span class="item-name">{{item.diskTypeName}}</span>      <span class="item-value text-overflow" data-title="{{item.diskSizeDesc}}">{{item.diskSizeDesc}}</span>    </span>    <span class="opt-txt-inner" style="width: 30%;">      <span class="item-name">{{item.diskChargeDesc}}</span>      <span class="item-value text-overflow" data-title="{{item.deadlineTime}}">{{item.deadlineTime?(item.deadlineTime + \'到期\'):\'\'}}</span>    </span>  </span>  <a role="button" class="opt-act" style="position: absolute;right:0;" href="javascript:;" b-if="!item.disabled">    <i b-on="{click: _delSelected}" class="icon-del">取消</i>  </a>'}),j=20;c.exports={init:function(a,b){var c=this;c.cvmInstance=a,c.regionId=a.regionId,c.opts=b,c.attachCbs()},formatCbsList:function(a){var b=this,c=b.cvmInstance.systemDisk.storageType;return a=a.filter(function(a){return!(("LOCAL_BASIC"===c||"LOCAL_SSD"===c)&&a.encrypt)}),a.forEach(function(a){a.diskTypeName=h.DISKTYPE[a.diskType],a.diskSizeDesc=a.diskSize+"GB",a.diskChargeDesc=h.DISK_CHARGE_TYPE_MAP[a.diskChargeType]}),a},attachCbs:function(){var a=this,b=a.opts.portCloudDiskLength,c=new f(i.attachCbs,{listTpl:i.listTpl,selectedTpl:i.selectedTpl,hasAttached:b,restAttached:j-b,$afterInit:function(){var a=this,b=this.$refs.ds;b.$set({searchKey:""}),b._getData({page:1,count:20}),b.$watch("selected",function(b){b.length>a.restAttached?e.toggleBtnDisable(!0):e.toggleBtnDisable(!1)})},getData:function(b,c){var d=[],e={};b.searchKey&&(/^disk-\w{8}$/.test(b.searchKey)?d.push({name:"disk-id",values:[b.searchKey]}):d.push({name:"disk-name",values:[b.searchKey]})),d.push({name:"disk-state",values:["UNATTACHED"]},{name:"portable",values:["TRUE"]},{name:"zone",values:[a.cvmInstance.zone]}),e.filters=d,e.limit=b.count,e.offset=(b.page-1)*b.count,e.regionId=a.regionId,g.queryDisks(e).then(function(b){var d=[],e=0;b&&b.response&&b.response.diskSet.length>0&&b.response.totalCount>0&&(e=b.response.totalCount,d=b.response.diskSet),c(null,{list:a.formatCbsList(d),size:e})})},initSelected:[],loadSelected:function(a){}});c.$refs.ds;e.create(c.$el,"1200","",{title:"挂载云硬盘",preventResubmit:!0,button:{" 确定 ":function(){var b=c.$refs.ds.selected.map(function(a){return a.diskId}),f={diskIds:b,instanceId:a.cvmInstance.instanceId,regionId:a.regionId};g.attachDisks(f).then(function(b){if(b.code)d.error(b.code);else{var f=c.$refs.ds.selected.map(function(a,b){return a});a.opts.callback(f)}e.hide()})}}})}}}),define("cvm/detail/healthdetail",function(a,b,c){var d,e=a("$"),f=a("manager"),g=(a("pageManager"),a("util")),h=(a("appUtil"),a("event")),i=a("tips"),j=a("cvm/cvm/cvmutil"),k=function(a,b,c,d){return-c*((a=a/d-1)*a*a*a-1)+b},l={linux:22,windows:3389},m={main:'  <div class="manage-area-full-inner">    <div id="cvmHealthCheckContainer">      <div class="health-state">        <strong class="tit">          <% if (mode==0) { %>            您的实例不在运行中,不能进行健康状态检查            <% } else if (mode==1) { %>              您还没有进行健康状态检查              <% } else if (mode==2) { %>                正在进行健康状态检查...                <% } else { %>                  发现                  <%-warnNum%>个问题                    <% } %>        </strong>        <p class="txt">健康状态检查帮助您检测实例可能存在的问题，          <br>并给出建议的解决方法，以确保您业务的正常运行</p>        <a class="tc-btn xl <% if (mode==0 || mode==2) { %> disable <% } %>" href="javascript:;" data-event="check_cvm_health">          <% if (mode==3) { %>            重新检查            <% } else if (mode==2) { %>              检查中...              <% } else { %>                开始检查                <% } %>        </a>        <i class="ico-health              <% if (mode==0 || mode==1) { %>              health-mod              <% } else if (mode==2) { %>              health-loading              <% } else if (mode==3 && warnNum==0) { %>              health-normal              <% } else if (mode==3 && warnNum>0) { %>              <% } %>              ">          <% if (mode==2) { %>            <i class="num" id="healthLoading"></i>            <% } %>        </i>      </div>      <ul class="health-data-list">        <li>          <em class="tit">实例状态</em>          <span class="txt">            <%-statusDesc%>          </span>        </li>        <li>          <em class="tit">检查结果</em>          <%-result%>        </li>      </ul>    </div>  </div>',checking:'  <p>    <i class="loading-icon"></i>    <span>正在检查内网IP地址是否可达...</span>  </p>  <p>    <i class="loading-icon"></i>    <span>正在检查内网登录端口是否可达...</span>  </p>  <% if (deviceWanIp) { %>    <p>      <i class="loading-icon"></i>      <span>正在检查外网IP地址是否可达...</span>    </p>    <p>      <i class="loading-icon"></i>      <span>正在检查外网登录端口是否可达...</span>    </p>    <% } %>      <!--<p><i class="loading-icon"></i><span>正在检查虚拟化驱动是否正常...</span></p>-->',sucIp:'  <p>    <i class="success-icon"></i>    <span class="success-txt">      <%-netType%>网IP地址可达</span>  </p>',sucDrive:'  <p>    <i class="success-icon"></i>    <span class="success-txt">虚拟化驱动运行正常</span>  </p>',sucPort:'  <p>    <i class="success-icon"></i>    <span class="success-txt">      <%-netType%>网登录端口(        <%-port%>)可达</span>  </p>',failIp:'  <p>    <i class="error-icon"></i>    <span class="wrong-txt">      <%-netType%>网IP地址不可达...</span>  </p>  <dl class="suggest-list">    <dt>处理建议:</dt>    <dd>      <em class="num">1.</em>      <span class="txt">请检查您的实例        <%-netType%>网IP是否已禁止ping，如果禁ping属于您的主动使用行为，请忽略此          <br> 提示      </span>      <a href="http://wiki.qcloud.com/wiki/%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%8A%B6%E6%80%81%E6%A3%80%E6%B5%8B#.E5.A6.82.E4.BD.95.E6.89.8B.E5.B7.A5.E4.BF.AE.E5.A4.8D.E5.86.85.E7.BD.91IP.E9.85.8D.E7.BD.AE"        target="_blank">如何关闭禁ping功能？</a>    </dd>    <dd>      <em class="num">2.</em>      <span class="txt">其他问题请通过        <a data-event="nav" href="/workorder">工单系统</a>反馈检查问题</span>    </dd>  </dl>',
failPort:'  <p>    <i class="error-icon"></i>    <span class="wrong-txt">      <%-netType%>网登录端口(        <%-port%>)不可达...</span>  </p>  <dl class="suggest-list">    <dt>处理建议:</dt>    <dd>      <em class="num">1.</em>      <span class="txt">请检查您的实例        <%-netType%>网登录端口(          <%-port%>)是否已禁止，如果禁止            <%-port%>端口属于您的主动使用行为，请忽略此提示 </span>    </dd>    <dd>      <em class="num">2.</em>      <span class="txt">其他问题请通过        <a data-event="nav" href="/workorder">工单系统</a>反馈检查问题</span>    </dd>  </dl>',failDrive:'  <p>    <i class="warning-icon"></i>    <span class="warning-txt">虚拟化驱动运行未安装</span>  </p>  <dl class="suggest-list">    <dt>处理建议:</dt>    <dd>      <span class="txt">建议安装，</span>      <a href="javascript:;">如何安装虚拟化驱动？</a>    </dd>  </dl>'};c.exports={model:a("models/cvmHealth"),render:function(a,b){this.container=a,this.data=b,this.statusDesc=b.statusTitle;var c=this.isCheckable();c?this.getLasthealthCheck():this.renderContent({statusDesc:this.statusDesc,mode:0,warnNum:0,result:"无结果"}),this.bindEvent(a)},renderContent:function(a){var b=g.tmpl(m.main,{statusDesc:a.statusDesc,mode:a.mode,warnNum:a.warnNum,result:a.result});this.container.html(b),d=e("#cvmHealthCheckContainer")},bindEvent:function(){var a=this;h.bindCommonEvent(this.container[0],"click",{check_cvm_health:function(){e(this).hasClass("disable")||a.checkHealth()}})},isCheckable:function(){return j.isStopped(this.data.instanceState)?!1:!0},getLasthealthCheck:function(){var a=this;this.model.request({name:"getConfigHealth",data:{deviceList:[this.data.deviceId]},success:function(b){a.displayResult(b.result)}})},checkHealth:function(){var a=this;this.renderContent({statusDesc:this.statusDesc,mode:2,warnNum:0,result:g.tmpl(m.checking,{deviceWanIp:this.data.deviceWanIp})}),this.loadingStart(),this.model.request({name:"checkCvmConfig",data:{uuidList:[this.data.uuid]},success:function(b){b&&b.taskId&&a.getFlowCscResult(b.taskId)}})},loadingStart:function(){this.isLoadingEnd=!1;var a=this,b=e("#healthLoading"),c=0,d=0,f=90,h=function i(){var e=k(c,d,f,1e3);b.text(parseInt(e)),e===f||a.isLoadingEnd||(c++,g.requestAnimationFrame(i))};h()},loadingEnd:function(a){this.isLoadingEnd=!0;var b=e("#healthLoading"),c=0,d=parseInt(b.text()),f=100,h=1e3/(f-d)*10;isNaN(h)&&(h=1e3);var i=function j(){var e=k(c,d,f,h);b.text(parseInt(e)),e>f&&(e=f),f>e?(c++,g.requestAnimationFrame(j)):a&&a()};i()},getFlowCscResult:function(a){var b=this;f.getFlowCscResult({taskId:a},function(c){var d=c.status;0===d?c.output&&c.output.resultDetail&&c.output.resultDetail.result?b.loadingEnd(function(){b.displayResult(c.output.resultDetail.result)}):(i.error("检查失败，请重试"),b.toggleBtn(1)):2===d?b.timeOut=setTimeout(function(){b.getFlowCscResult(a)},3e3):(i.error("状态查询失败，请重试"),b.toggleBtn(1))})},toggleBtn:function(a){var b=d.find(".tc-btn");a?b.html("重新检查").removeClass("disable"):b.html("检查中...").addClass("disable")},displayResult:function(a){var b=this,c=0,d=1,e="",f=function(a,c){c=1==c?"外":"内";var d=l[b.data.osType];return g.tmpl(m[a],{port:d,netType:c})};if(a&&a.length)for(var h,i=0;h=a[i];i++)0==h.checkLanIp?e+=f("sucIp",0):(e+=f("failIp",0),c++),void 0!=h.checkLanPort&&(0==h.checkLanPort?e+=f("sucPort",0):(e+=f("failPort",0),c++)),this.data.deviceWanIp&&(0==h.checkWanIp?e+=f("sucIp",1):(e+=f("failIp",1),c++),void 0!=h.checkWanPort&&(0==h.checkWanPort?e+=f("sucPort",1):(e+=f("failPort",1),c++))),d=3;else e="无结果";this.renderContent({statusDesc:this.statusDesc,mode:d,warnNum:c,result:e})},destroy:function(){clearTimeout(this.timeOut)}}}),define("cvm/detail/ipdetail",function(a,b,c){var d=a("$"),e=(a("pageManager"),a("qccomponent")),f=(a("manager"),a("dialog"),a("tips"),a("util"),a("appUtil"),a("cvm/common/model"),a("widget/fieldsManager/gridView")),g=(a("widget/popover/popConfirm"),a("cvm/eip2/data")),h=a("cvm/eip2/upgradeBandwidth"),i=a("cvm/cvm/event/operate_entry"),j=a("cvm/eip2/unbindEip"),k={idName:'  <div>    <div>{{ item.id }}</div>    <div>      <span class="text-overflow m-width">{{ item.name || \'未命名\' }}</span>      <i        b-if="isEip"        data-event="editEipName"        class="pencil-icon hover-icon"        style="cursor:pointer"      ></i>    </div>  </div>',operate:'  <div class="eip-oper-cell">    <a      href="javascript:void(0)"      class="{{item.canUpgradeBandwidth ? \'\':\'disabled\'}}"      data-title="{{item.isArrears ? \'该弹性公网IP已经被隔离至回收站，无法调整带宽\' : \'\'}}"      data-operate="upgradeBandwidth"      >调整带宽</a    >    <a      href="javascript:void(0)"      class="{{item.isEip ? \'\':\'disabled\'}}"      data-title="{{item.isEip ? \'\':\'普通公网IP无法解绑\'}}"      data-operate="unbind"    >      解绑</a    >  </div>'};c.exports={render:function(a,b){var c=this;g.eipListThis=this,c.container=a,c.cvmItem=b,c.isNetworkShiftUpUser=b.isNetworkShiftUpUser,c.initGridView(),c.bindEvent(),c.renderList()},initGridView:function(){var a=this,b={$data:{hasFirst:!1,orderField:"id",order:1,initGetData:!1,canResizeColum:!0,selectedHighlight:!1,colums:a.getColumns(),list:[],autoMaxHeight:!0,maxHeightOffset:10,autoCheckWidth:!1,totalNum:0,minHeight:120,trackKey:"id"},$mixins:[f("ip_fields")],getCellContent:function(b,c,d){return a.getCellContent(b,c,d)},setTrAttr:function(a,b){return{"data-id":b.id}},events:{"click tr:not(.disable) [data-operate]":function(b){b.stopPropagation();var c=this,e=d(b.target),f=e.closest("tr"),g=c.list[f[0].$index],h=e.attr("data-operate");!e.hasClass("disabled")&&a[h]&&a[h].call(a,g)}},getData:function(b,c){a.renderList(b)}},c=e.getComponent("grid-view");a.gridView=new c(b),a.container.append(a.gridView.$el)},getColumns:function(){return[{name:"ID/名称",key:"id",tdTpl:k.idName},{name:"IP地址",key:"ip"},{name:"IP类型",key:"ipTypeDesc"},{name:"计费模式",key:"payModeDesc"},{name:"带宽上限",key:"bandwidthDesc"},{name:"操作",key:"operate",tdTpl:k.operate}]},getCellContent:function(a,b,c){var d="";switch(c.key){case"id":break;case"address":break;case"type":break;case"payModeDesc":break;case"bandwidth":break;case"operate":break;default:d+="<span>"+b[c.key]+"</span>"}return d||void 0},bindEvent:function(){},getQueryObject:function(a){var b=this,c=b.cvmItem.uInstanceId,d=[{name:"instance-id",values:[c]},{name:"address-type",values:["WanIp","EIP","AnycastEIP"]}];return{filters:d}},renderList:function(a){var b=this,c=b.getQueryObject(a);g.getEipList(c,{withoutDefaultFilter:!0}).then(function(a){if(a&&a.eips&&a.eips.nodes){var c=g.formatList(a.eips.nodes,{regionId:b.cvmItem.regionId,isNetworkShiftUpUser:b.cvmItem.isNetworkShiftUpUser}),d=a.eips.totalCount;b.gridView.setData({list:c,totalNum:d})}else{if(a.errors&&a.errors.length){b.gridView.setData({list:[]});for(var e=0;e<a.errors.length;e++){var f=a.errors[e];errorTips.isCamRefused(f)?b.gridView.showTips("<div><cam-tips>"+f.message+"</cam-tips></div>"):b.gridView.showTips("<div><error-tips>"+f.message+"</error-tips></div>");break}return}b.gridView.setData({list:[]})}})},upgradeBandwidth:function l(a){var b=this;if(a.isEip){var l=new h({listIns:b,selectedItems:[b.cvmItem]});l.exec(a,b.cvmItem)}else{var c=i.refresh([b.cvmItem],!0);i.exec("ResetInstancesInternetMaxBandwidth",[b.cvmItem],c)}},unbind:function(a){j.exec(a)}}}),define("cvm/detail/monitor",function(a,b,c){var d=a("manager"),e=a("appUtil"),f=["I3","IT2","IT3a"],g={namespace:"qce/cvm",policyViewName:"cvm_device",metrics:[{category:"CPU监控",metrics:[{metricName:"cpu_usage",metricCName:"CPU利用率",dimensions:["unInstanceId"],unit:"%",min:0,max:100},{metricName:"base_cpu_usage",metricCName:"基础CPU使用率",dimensions:["unInstanceId"],unit:"%"}]},{category:"系统平均负载",checkIfVisible:function(a){return a.some(function(a){return"linux"==a.osType})},metrics:[{metricCName:"系统平均负载",showInNav:!1,type:"select",options:function(){return[{id:"1min",label:"1分钟"},{id:"5min",label:"5分钟"},{id:"15min",label:"15分钟"}]},onChange:function(a,b){b.setExtCondition&&b.setExtCondition({cpuType:a.id})}},{metricName:"cpu_loadavg",metricCName:"CPU平均负载",dimensions:["unInstanceId"],unit:"",min:0,checkIfVisible:function(a,b){var c=b&&b.state&&b.state.extCondition&&b.state.extCondition.cpuType||"1min";return"1min"===c}},{metricName:"CPULoadAvg5m",metricCName:"CPU平均负载",dimensions:["unInstanceId"],unit:"",min:0,checkIfVisible:function(a,b){var c=b&&b.state&&b.state.extCondition&&b.state.extCondition.cpuType;return"5min"===c}},{metricName:"CPULoadAvg15m",metricCName:"CPU平均负载",dimensions:["unInstanceId"],unit:"",min:0,checkIfVisible:function(a,b){var c=b&&b.state&&b.state.extCondition&&b.state.extCondition.cpuType;return"15min"===c}}]},{category:"内存监控",metrics:[{metricName:"mem_used",metricCName:"内存使用量",dimensions:["unInstanceId"],unit:"MB",min:0},{metricName:"mem_usage",metricCName:"内存利用率",dimensions:["unInstanceId"],unit:"%",min:0}]},{category:"内网带宽监控",metrics:[{metricName:"lan_outtraffic",metricCName:"内网出带宽",dimensions:["unInstanceId"],unit:"Mbps",min:0},{metricName:"lan_intraffic",metricCName:"内网入带宽",dimensions:["unInstanceId"],unit:"Mbps",min:0},{metricName:"lan_outpkg",metricCName:"内网出包量",dimensions:["unInstanceId"],unit:"个/秒",min:0},{metricName:"lan_inpkg",metricCName:"内网入包量",dimensions:["unInstanceId"],unit:"个/秒",min:0},{metricName:"tcp_curr_estab",metricCName:"TCP连接数",unit:"个",dimensions:["unInstanceId"],min:0}]},{category:"外网带宽监控",metrics:[{metricName:"wan_outtraffic",metricCName:"外网出带宽",dimensions:["unInstanceId"],unit:"Mbps",min:0},{metricName:"wan_intraffic",metricCName:"外网入带宽",dimensions:["unInstanceId"],unit:"Mbps",min:0},{metricName:"wan_outpkg",metricCName:"外网出包量",dimensions:["unInstanceId"],unit:"个/秒",min:0},{metricName:"wan_inpkg",metricCName:"外网入包量",dimensions:["unInstanceId"],unit:"个/秒",min:0},{metricName:"acc_outtraffic",metricCName:"外网出流量",unit:"MB",dimensions:["unInstanceId"],min:0}]},{category:"GPU监控",checkIfVisible:function(a){return a.some(function(a){return/^GN/i.test(a.instanceType)})},metrics:[{metricName:"GpuUtil",metricCName:"GPU使用率",dimensions:["unInstanceId"],unit:"%",min:0,multiLine:{dimensions:["gpuId"]},checkIfVisible:function(a){return a.some(function(a){return/^GN/i.test(a.instanceType)})}},{metricName:"gpu_mem_used",metricCName:"GPU显存使用量",dimensions:["unInstanceId"],unit:"MB",min:0,multiLine:{dimensions:["gpuId"]},checkIfVisible:function(a){return a.some(function(a){return/^GN/i.test(a.instanceType)})}},{metricName:"GpuPowUsage",metricCName:"GPU功耗",dimensions:["unInstanceId"],unit:"W",min:0,multiLine:{dimensions:["gpuId"]},checkIfVisible:function(a){return a.some(function(a){return/^GN/i.test(a.instanceType)})}},{metricName:"GpuTemp",metricCName:"GPU温度",dimensions:["unInstanceId"],unit:"°C",min:0,max:100,multiLine:{dimensions:["gpuId"]},checkIfVisible:function(a){return a.some(function(a){return/^GN/i.test(a.instanceType)})}}]},{category:"硬盘使用及监控",metrics:[{metricCName:"分区使用情况",type:"column",rollup:{name:"硬盘总容量",metric:"total",unit:"GB"},getData:function(a){return new Promise(function(b,c){d.loadChartDataV2({chartInfos:["disk_usage"],date:"1h",area:a.regionId,uuid:a.uuid,vpc:a.unVpcId,ip:a.deviceLanIp,appId:e.getAppId(),namespace:"Cvm"},function(a){if(a.length){var d=a[0].chartData.partition;b(d)}else c({msg:""})},function(){c({msg:""})},a.unInstanceId)})}},{metricCName:"硬盘监控",showInNav:!1,type:"select",options:function(a){return new Promise(function(b,c){var d=[];a.systemDisk&&a.systemDisk.diskSize&&d.push({diskId:a.systemDisk.diskId,label:a.unInstanceId+"的系统盘("+a.systemDisk.diskSize+"GB)"}),a.dataDisks.forEach(function(b){d.push({diskId:b.diskId,label:a.unInstanceId+"的数据盘"+(b.diskId||"")+"("+b.diskSize+"GB)"})}),a.instanceType&&-1!=f.indexOf(a.instanceFamily)&&d.push({unInstanceId:a.unInstanceId,diskType:"nvme",label:a.unInstanceId+"的NVME盘"}),b(d)})},onChange:function(a,b){b.setExtCondition&&b.setExtCondition({isNVME:"nvme"==a.diskType}),b.updateDimensions({diskId:a.diskId})}},{metricCName:"硬盘读流量",metricName:"disk_read_traffic",namespace:"qce/block_storage",dimensions:["diskId"],unit:"KB/s",checkIfVisible:function(a,b){return!(b&&b.state&&b.state.extCondition&&b.state.extCondition.isNVME)}},{metricCName:"硬盘读流量",metricName:"vm_disk_read_traffic",namespace:"qce/block_storage",dimensions:["unInstanceId"],unit:"KB/s",multiLine:{dimensions:["Address"]},checkIfVisible:function(a,b){return b&&b.state&&b.state.extCondition&&b.state.extCondition.isNVME}},{metricCName:"硬盘写流量",metricName:"disk_write_traffic",namespace:"qce/block_storage",dimensions:["diskId"],unit:"KB/s",checkIfVisible:function(a,b){return!(b&&b.state&&b.state.extCondition&&b.state.extCondition.isNVME)}},{metricCName:"硬盘写流量",metricName:"vm_disk_write_traffic",namespace:"qce/block_storage",dimensions:["unInstanceId"],unit:"KB/s",multiLine:{dimensions:["Address"]},checkIfVisible:function(a,b){return b&&b.state&&b.state.extCondition&&b.state.extCondition.isNVME}},{metricCName:"硬盘读IOPS",metricName:"disk_read_iops",namespace:"qce/block_storage",dimensions:["diskId"],unit:"个",checkIfVisible:function(a,b){return!(b&&b.state&&b.state.extCondition&&b.state.extCondition.isNVME)}},{metricCName:"硬盘读IOPS",metricName:"vm_disk_read_iops",namespace:"qce/block_storage",dimensions:["unInstanceId"],unit:"个",multiLine:{dimensions:["Address"]},checkIfVisible:function(a,b){return b&&b.state&&b.state.extCondition&&b.state.extCondition.isNVME}},{metricCName:"硬盘写IOPS",metricName:"disk_write_iops",namespace:"qce/block_storage",dimensions:["diskId"],unit:"个",checkIfVisible:function(a,b){return!(b&&b.state&&b.state.extCondition&&b.state.extCondition.isNVME)}},{metricCName:"硬盘写IOPS",metricName:"vm_disk_write_iops",namespace:"qce/block_storage",dimensions:["unInstanceId"],multiLine:{dimensions:["Address"]},unit:"个",checkIfVisible:function(a,b){return b&&b.state&&b.state.extCondition&&b.state.extCondition.isNVME}},{metricCName:"IO Await",metricName:"disk_await",namespace:"qce/block_storage",dimensions:["diskId"],unit:"ms",checkIfVisible:function(a,b){return!(b&&b.state&&b.state.extCondition&&b.state.extCondition.isNVME)}},{metricCName:"IO Await",metricName:"vm_disk_await",namespace:"qce/block_storage",dimensions:["unInstanceId"],multiLine:{dimensions:["Address"]},unit:"ms",checkIfVisible:function(a,b){return b&&b.state&&b.state.extCondition&&b.state.extCondition.isNVME}},{metricCName:"IO Svctm",metricName:"disk_svctm",namespace:"qce/block_storage",dimensions:["diskId"],unit:"ms",checkIfVisible:function(a,b){return!(b&&b.state&&b.state.extCondition&&b.state.extCondition.isNVME)}},{metricCName:"IO Svctm",metricName:"vm_disk_tmpio",namespace:"qce/block_storage",dimensions:["unInstanceId"],unit:"ms",multiLine:{dimensions:["Address"]},checkIfVisible:function(a,b){return b&&b.state&&b.state.extCondition&&b.state.extCondition.isNVME}},{metricCName:"IO %util",metricName:"disk_util",namespace:"qce/block_storage",dimensions:["diskId"],unit:"%",checkIfVisible:function(a,b){return!(b&&b.state&&b.state.extCondition&&b.state.extCondition.isNVME)}},{metricCName:"IO %util",metricName:"vm_disk_util",namespace:"qce/block_storage",dimensions:["unInstanceId"],unit:"%",multiLine:{dimensions:["Address"]},checkIfVisible:function(a,b){return b&&b.state&&b.state.extCondition&&b.state.extCondition.isNVME}}]}]},h=function(a){return a.unInstanceId=a.uInstanceId,{title:a.uInstanceId,subTitle:a.alias||a.name,instance:a}};c.exports.showList=function(b,c,d){var e=a("lib/monitor-sdk-importer");e.ready().then(function(a){var e=$.extend({pagination:{range:{from:0,to:b.length-1},index:c},getData:function(a){return a=a||0,new Promise(function(c){var e=h(b[a]);d&&d(e.instance.uInstanceId),c(e)})}},g);a.MonitorPanelBuilder.build(e)})},c.exports.showDetail=function(b,c){var d=a("lib/monitor-sdk-importer");d.ready().then(function(a){var d=$.extend({getData:function(){return new Promise(function(a){a(h(b))})}},g);a.MonitorDetailBuilder.build(d,c)})}}),define("cvm/detail/oplogdetail",function(a,b,c){var d=a("$"),e=a("models/iaas"),f=a("qccomponent"),g=a("appUtil"),h={main:'  <div class="manage-area-full-inner">    <div class="log-param snap-log-param">      <div class="justify-grid">        <div class="col">          <!-- TODO: 如何处理? -->          <!--<a class="link" href="javascript:void(0);" id="exportLogBtn">导出列表</a>-->          <qc-date-picker b-ref="datePicker">            <script type="text/json" data>              {                "showCalendar": true,                "tabs": [                  { "label": "今天", "from": "%TODAY", "to": "%TODAY"},                  { "label": "近7天", "from": "%TODAY-6", "to": "%TODAY"},                  { "label": "近15天", "from": "%TODAY-14", "to": "%TODAY"},                  { "label": "近30天", "from": "%TODAY-29", "to": "%TODAY"}                ],                "selected": {                  "from": "%TODAY-29",                  "to": "%TODAY"                },                "range": {                  "min": null,                  "max": "%TODAY",                  "maxLength": 29                }              }            </script>          </qc-date-picker>        </div>      </div>      <div data-role="grid-view">        <div class="tc-15-table-panel">          <div class="tc-15-table-fixed-head">            <table class="tc-15-table-box">              <colgroup>                <col style="width: 15%" />                <col />                <col style="width: 20%" />                <col style="width: 20%" />                <col style="width: 15%" />                <col style="width: 10%" />              </colgroup>              <thead>                <tr>                  <th>                    <div><span class="text-overflow">操作时间</span></div>                  </th>                  <th>                    <div><span class="text-overflow">操作名称</span></div>                  </th>                  <th>                    <div><span class="text-overflow">Action</span></div>                  </th>                  <th>                    <div><span class="text-overflow">操作者</span></div>                  </th>                  <th>                    <div><span class="text-overflow">操作结果</span></div>                  </th>                  <th>                    <div><span class="text-overflow">详情</span></div>                  </th>                </tr>              </thead>            </table>          </div>          <div class="tc-15-table-fixed-body">            <table class="tc-15-table-box tc-15-table-rowhover">              <colgroup>                <col style="width: 15%" />                <col />                <col style="width: 20%" />                <col style="width: 20%" />                <col style="width: 15%" />                <col style="width: 10%" />              </colgroup>              <tbody>                <tr b-repeat="event in events">                  <td>                    <div>                      <span class="text-overflow">                        {{event[\'EventTime\']}}                      </span>                    </div>                  </td>                  <td>                    <div>                      <span class="text-overflow">                        {{event[\'EventNameCn\']}}                      </span>                    </div>                  </td>                  <td>                    <div>                      <span class="text-overflow">                        {{event[\'EventName\']}}                      </span>                    </div>                  </td>                  <td>                    <div>                      <span class="text-overflow">                        {{event[\'Username\']}}                      </span>                    </div>                  </td>                  <td>                    <div>                      <span class="text-overflow">                        <span class="text-success" b-if="event.success">成功</span>                        <span class="text-danger" b-if="!event.success">失败</span>                      </span>                    </div>                  </td>                  <td>                    <div>                      <a data-event="nav" href="{{event.detailsUrl}}">详情</a>                    </div>                  </td>                </tr>                <tr b-if="loading" tabindex="0">                  <td class="text-center" colspan="6">                    <div style="padding: 20px 0;">                      <i class="n-loading-icon"></i> <span>加载中...</span>                    </div>                  </td>                </tr>                <tr b-if="!loading && pageToken" tabindex="0">                  <td class="text-center" colspan="6">                    <div style="padding: 20px 0;">                      <a href="javascript:void(0);" b-on-click="loadMore()">点击加载更多</a>                    </div>                  </td>                </tr>                <tr b-if="!loading && !pageToken && !events.length" tabindex="0">                  <td class="text-center" colspan="6">                    <div style="padding: 20px 0;">                      <span class="text">抱歉，暂无相关日志！</span>                    </div>                  </td>                </tr>              </tbody>            </table>          </div>        </div>      </div>    </div>  </div>'},i=f.extend({$tpl:h.main,$afterInit:function(){var a=this;a.initDatePicker(),a.refresh()},initDatePicker:function(){var a=this,b=a.$refs.datePicker;b.setAllowRange("%TODAY-29","%TODAY",29),b.$on("datepick",function(){a.dateChange()})},dateChange:function(){var a=this;a.refresh()},refresh:function(){var a=this,b=a.$refs.datePicker;a.$set({loading:!0,events:[],pageToken:null}),a.getData({instanceId:a.$data.data.instanceId,startTime:g.getDate(b.selected.from+" 00:00:00"),endTime:g.getDate(g.getDate(b.selected.to+" 00:00:00").getTime()+864e5)}).then(function(b){a.$set({loading:!1,events:b.events,pageToken:b.pageToken})})},loadMore:function(){var a=this,b=a.$refs.datePicker;a.$set({loading:!0}),a.getData({instanceId:a.$data.data.instanceId,startTime:g.getDate(b.selected.from+" 00:00:00"),endTime:g.getDate(g.getDate(b.selected.to+" 00:00:00").getTime()+864e5)},a.pageToken).then(function(b){a.$set({loading:!1,events:a.events.concat(b.events),pageToken:b.pageToken})})},getData:function(a,b){return e.apiRequest({serviceType:"cloudaudit",action:"LookUpEvents",regionId:1,data:{Version:"2019-03-19",StartTime:Math.floor(a.startTime.getTime()/1e3),EndTime:Math.floor(a.endTime.getTime()/1e3),LookupAttributes:[{AttributeKey:"ReadOnly",AttributeValue:"false"},{AttributeKey:"ResourceType",AttributeValue:"cvm"},{AttributeKey:"ResourceName",AttributeValue:"instance/"+a.instanceId}],NextToken:b}}).then(function(b){return{events:(b.Response&&b.Response.Events?b.Response.Events:[]).map(function(b){var c=null;try{c=JSON.parse(b.CloudAuditEvent)}catch(d){}return b.success=Boolean(c&&!c.apiErrcode),b.detailsUrl="https://console.cloud.tencent.com/cloudaudit?"+["attributeKey=EventId","attributeValue="+b.EventId,"startTime="+a.startTime.getTime(),"endTime="+a.endTime.getTime(),"from=cvm"].join("&"),b}),pageToken:b.Response&&b.Response.NextToken&&!b.Response.ListOver?b.Response.NextToken:null}})}},{defaults:{}});c.exports={render:function(a,b){this.page=new i({$data:{data:b}}),d(a).html(this.page.$el)},destroy:function(){this.page&&this.page.$destroy()}}}),define("cvm/detail/paramdetail",function(a,b,c){var d=a("$"),e=a("manager"),f=a("util"),g=a("appUtil"),h=(a("constants"),a("dialog")),i=a("tips"),j=(a("models/firewall"),a("widget/copy/copy")),k=a("cvm/detail/viewUtil"),l=a("cvm/eip2/data"),m=a("cvm/cbs2/cbsutil"),n=a("cvm/common/model"),o=a("cvm/cbs2/data"),k=(a("router"),a("cvm/detail/viewUtil")),m=a("cvm/cbs2/cbsutil"),p=a("cvm/cvm/cvmutil"),q=a("cvm/cbs2/event/renew"),r=a("cvm/detail/event/attach"),s=a("cvm/common/constants"),t=a("cvm/cbs2/constants"),u=a("cvm/cvm/data"),v=a("cvm/cvm/format"),w=a("widget/errorTips/errorTips"),x=a("widget/mfa/mfa"),y={main:'  <div class="manage-area-full-inner">    <div class="manage-area-main-inner">      <div class="cvm-details-info">        <div class="tc-g">          <style>            .tc-panel {              margin-bottom: 20px;            }          </style>          <div class="tc-g-u-1-3">            <div class="tc-panel">              <div class="param-box">                <div class="param-hd">                  <h3>实例信息</h3>                </div>                <div class="param-bd">                  <ul class="form-list item-descr-list">                    <li class="pure-text-row">                      <div class="form-label">                        <label for="">名称</label>                      </div>                      <div class="form-input">                        <span id="instanceName">                          {{item.instanceName}}                        </span>                        <a href="javascript:;">                          <i class="pencil-icon" data-name="ModifyInstancesAttribute.InstanceName"                            data-action="editAlias" style="visibility:hidden;"></i>                        </a>                      </div>                    </li>                    <li class="pure-text-row">                      <div class="form-label ">                        <label for="">实例ID</label>                      </div>                      <div class="form-input viewIpCopyWrap">                        <span>                          {{item.instanceId}}                        </span>                      </div>                    </li>                    <li class="pure-text-row">                      <div class="form-label ">                        <label for="">UUID</label>                      </div>                      <div class="form-input viewIpCopyWrap">                        <span>                          {{item.uuid}}                          <a href="javascript:;" data-clipboard-text="{{item.uuid}}" style="display:none">复制</a>                        </span>                      </div>                    </li>                    <li class="pure-text-row">                      <div class="form-label">                        <label for="">实例规格</label>                      </div>                      <div class="form-input">                        <span>                          {{item.instanceTypeDesc}} | {{item.instanceType}}                        </span>                      </div>                    </li>                    <li class="pure-text-row">                      <div class="form-label">                        <label for="">所属项目</label>                      </div>                      <div class="form-input">                        <span>                          {{item.projectName}}                        </span>                      </div>                    </li>                    <li class="pure-text-row">                      <div class="form-label">                        <label for="">地域</label>                      </div>                      <div class="form-input">                        <span>                          {{item.regionCity}}                        </span>                      </div>                    </li>                    <li class="pure-text-row">                      <div class="form-label">                        <label for="">可用区</label>                      </div>                      <div class="form-input">                        <span>                          {{item.zoneName}}                        </span>                      </div>                    </li>                    <li class="pure-text-row" id="sshkey" data-sshkey>                      <div class="form-label">                        <label for="">密钥</label>                      </div>                      <div b-if="item.keyPairIds && item.keyPairIds.length" class="form-input">                      </div>                      <div b-if="!(item.keyPairIds && item.keyPairIds.length)" class="form-input">                        无                      </div>                    </li>                    <li class="pure-text-row">                      <div class="form-label">                        <label for="">标签</label>                      </div>                      <!-- <span class="item-descr-tit">标签</span> -->                      <div class="form-input">                        <div b-if="item.tags&&item.tags.length" class="tc-tag-cont" style="padding: 0">                          <span b-repeat="tag in item.tags" class="tc-tag-txt">                            <span data-title="{{tag.tagKey + \':\' + tag.tagValue}}">                              {{tag.tagKey + ":" + tag.tagValue}}                            </span>                          </span>                        </div>                        <div b-if="!(item.tags&&item.tags.length)" class="tc-tag-cont" style="padding: 0">无</div>                        <a href="javascript:;" class="pencil-icon" data-name="tag" data-action="tag"                          style="visibility:hidden;"></a>                      </div>                    </li>                  </ul>                </div>              </div>            </div>            <div b-if="item.paiInfo" class="tc-panel">              <div class="param-box">                <div class="param-hd">                  <h3>域名信息</h3>                </div>                <div class="param-bd">                  <ul class="form-list item-descr-list">                    <li class="pure-text-row">                      <div class="form-label">                        <label>域名</label>                      </div>                      <div class="form-input">                        <a href="http://{{item.paiInfo.domainName}}" target="_blank">                          {{item.paiInfo.domainName}}                        </a>                      </div>                    </li>                  </ul>                </div>              </div>            </div>            <div class="tc-panel">              <div class="param-box">                <div class="param-hd">                  <h3>网络信息</h3>                </div>                <div class="param-bd">                  <ul class="form-list">                    <li class="pure-text-row">                      <div class="form-label">                        <label for="">所属网络</label>                      </div>                      <div class="form-input">                        <span b-if="item.virtualPrivateCloud.vpcId" class="item-descr-txt">                          <a                            href="//console.qcloud.com/vpc/vpc?regionId={{item.regionId}}&unVpcId={{item.virtualPrivateCloud.vpcId}}">                            {{item.virtualPrivateCloud.vpcId}}                          </a>                          (                          <span class="text-truncate text-max text-mod" title="{{item.virtualPrivateCloud.vpcName}}">                            {{item.virtualPrivateCloud.vpcName}}{{item.cidrBlock?\' | \'+item.cidrBlock :\'\'}}                            <i b-if="item.cidrBlockError&&item.cidrBlockError.isCam" class="plaint-icon"                              data-position="right"                              qc-popover="<cam-tips>{{item.cidrBlockError.message}}</cam-tips>"></i>                            <i b-if="item.cidrBlockError&&!item.cidrBlockError.isCam" class="plaint-icon"                              data-position="right"                              qc-popover="<error-tips>{{item.cidrBlockError.message}}</cam-tips>"></i>                          </span>)                        </span>                        <span b-if="!item.virtualPrivateCloud.vpcId" class="item-descr-txt">基础网络</span>                      </div>                    </li>                    <li b-if="item.virtualPrivateCloud.subnetId" class="pure-text-row">                      <div class="form-label">                        <label for="">所在子网</label>                      </div>                      <div class="form-input">                        <span b-if="item.virtualPrivateCloud.subnetId" class="item-descr-txt">                          <a                            href="https://console.qcloud.com//vpc/subnet?regionId={{item.regionId}}&subnetId={{item.virtualPrivateCloud.subnetId}}">                            {{item.virtualPrivateCloud.subnetId}}                          </a> （{{item.virtualPrivateCloud.subnetName}}）                        </span>                      </div>                    </li>                    <li class="pure-text-row item-wip">                      <div class="form-label">                        <label for="">                          <span class="item-descr-tit">                            {{item.eipInfo?\'弹性公网IP\':\'公网IP\'}}                          </span>                        </label>                      </div>                      <div class="form-input">                        <span class="item-descr-txt viewIpCopyWrap">                          {{item.deviceWanIp || "-"}}                          <a href="javascript:;" data-clipboard-text="{{item.deviceWanIp}}" style="display:none">复制</a>                          <span b-if="item.deviceWanIp&&!item.eipInfo&&item.eipQuotaData">                            <i b-if="item.eipQuotaData[0] &&item.eipQuotaData[0].quotaCurrent < item.eipQuotaData[0].quotaLimit"                              class="convert-ip-icon" data-name="TransformAddress" data-action="bindEip"                              data-title="IP保持不变，转为弹性公网IP，您最多可开通{{item.eipQuotaData[0].quotaLimit}}个弹性公网IP，已开通{{item.eipQuotaData[0].quotaCurrent}}个。"></i>                            <i b-if="item.eipQuotaData[0] &&item.eipQuotaData[0].quotaCurrent >= item.eipQuotaData[0].quotaLimit"                              class="convert-ip-ash-icon"                              data-title="弹性公网IP已达到{{item.eipQuotaData[0].quotaLimit}}个上限，无法转换"></i>                            <i b-if="item.eipError&&item.eipError.isCam" class="plaint-icon" data-position="right"                              qc-popover="<cam-tips>{{item.eipError.message}}</cam-tips>"></i>                            <i b-if="item.eipError&&!item.eipError.isCam" class="plaint-icon" data-position="right"                              qc-popover="<error-tips>{{item.eipError.message}}</cam-tips>"></i>                          </span>                        </span>                      </div>                    </li>                    <li class="pure-text-row">                      <div class="form-label">                        <label for="">                          <span class="item-descr-tit">内网IP</span>                        </label>                      </div>                      <div class="form-input">                        <span class="item-descr-txt viewIpCopyWrap">                          {{item.deviceLanIp || "-"}}                          <a href="javascript:;" data-clipboard-text="{{item.deviceLanIp}}" style="display:none">复制</a>                        </span>                      </div>                    </li>                    <li class="pure-text-row">                      <div class="form-label">                        <label for="">                          <span class="item-descr-tit">用作公网网关</span>                        </label>                      </div>                      <div class="form-input">                        <span class="item-descr-txt">                          {{item.virtualPrivateCloud.asVpcGateway?"是":"否"}}                        </span>                      </div>                    </li>                  </ul>                </div>              </div>            </div>            <div class="tc-panel">              <div class="param-box">                <div class="param-hd">                  <h3>配置信息</h3>                </div>                <div class="param-bd">                  <ul class="form-list">                    <li class="pure-text-row">                      <div class="form-label">                        <label for="">                          操作系统                        </label>                      </div>                      <div class="form-input">                        <span>                          {{item.osName}}                        </span>                      </div>                    </li>                    <li class="pure-text-row">                      <div class="form-label">                        <label for="">                          CPU                        </label>                      </div>                      <div class="form-input">                        <span>                          {{item.cpuInfo}}                        </span>                      </div>                    </li>                    <li class="pure-text-row">                      <div class="form-label">                        <label for="">                          内存                        </label>                      </div>                      <div class="form-input">                        <span>                          {{item.memInfo}}                        </span>                      </div>                    </li>                    <li class="pure-text-row">                      <div class="form-label">                        <label for="">                          公网带宽                        </label>                      </div>                      <div class="form-input">                        <span>                          {{item.bandwidthInfo}}                        </span>                      </div>                    </li>                  </ul>                </div>              </div>            </div>            <div class="tc-panel">              <div class="param-box">                <div class="param-hd">                  <h3>镜像信息</h3>                </div>                <div class="param-bd">                  <ul class="form-list">                    <li class="pure-text-row">                      <div class="form-label">                        <label for="">                          操作系统                        </label>                      </div>                      <div class="form-input">                        <span class="item-descr-txt osField" id="paramOsField">                          {{item.osName}}                        </span>                      </div>                    </li>                    <li class="pure-text-row">                      <div class="form-label">                        <label for="">                          镜像ID                        </label>                      </div>                      <div class="form-input">                        <span class="item-descr-txt" id="paramUnImgId">                          <a b-if="item.unImgId" href="/cvm/image/detail/{{item.regionId}}/{{item.unImgId}}"                            data-event="nav">                            {{item.unImgIdInfo}}                          </a>                        </span>                      </div>                    </li>                    <li class="pure-text-row">                      <div class="form-label">                        <label for="">                          镜像类型                        </label>                      </div>                      <div class="form-input">                        <span class="item-descr-txt">                          {{item.imageType || "-"}}                        </span>                      </div>                    </li>                  </ul>                </div>              </div>            </div>            <div class="tc-panel">              <div class="param-box">                <div class="param-hd">                  <h3>计费信息</h3>                </div>                <div class="param-bd">                  <ul class="form-list">                    <li class="pure-text-row">                      <div class="form-label">                        <label for="">                          实例计费模式                        </label>                      </div>                      <div class="form-input">                        <span class="item-descr-txt">                          {{item.uHostId? \'不计费\': item.cvmPayModeDesc}}                      </div>                    </li>                    <li class="pure-text-row">                      <div class="form-label">                        <label for="">                          带宽计费模式                        </label>                      </div>                      <div class="form-input">                        <span class="item-descr-txt">                          {{item.networkPayModeDesc||"-"}}                      </div>                    </li>                    <li class="pure-text-row">                      <div class="form-label">                        <label for="">                          创建时间                        </label>                      </div>                      <div class="form-input">                        <span class="item-descr-txt">                          {{item.createdTime || "-"}}                      </div>                    </li>                    <li class="pure-text-row">                      <div class="form-label">                        <label for="">                          到期时间                        </label>                      </div>                      <div class="form-input">                        <span class="item-descr-txt">                          {{item.uHostId||!item.expiredTime?\'-\':item.expiredTime}}                      </div>                    </li>                    <li b-if="item.terminateTimer" class="pure-text-row">                      <div class="form-label">                        <label for="">                          释放时间                        </label>                      </div>                      <div class="form-input">                        <span class="item-descr-txt">                          {{item.terminateTimer &&item.terminateTimer.actionTime? item.terminateTimer.actionTime :\'-\'}}                      </div>                    </li>                  </ul>                </div>              </div>            </div>          </div>          <div class="tc-g-u-2-3">            <div class="tc-panel">              <div class="param-box">                <div class="param-hd">                  <h3>架构图</h3>                  <p style="position: relative;">                    <em class="text-weak line-before">                      {{item.regionCity}}/ {{item.zoneName}}                    </em>                    <em b-if="item.virtualPrivateCloud.subnetId" class="text-weak line-before">/</em>                    <a b-if="item.virtualPrivateCloud.subnetId" class="cur-name"                      href="//console.qcloud.com//vpc/subnet?regionId={{item.regionId}}&subnetId={{item.virtualPrivateCloud.subnetId}}">                      {{item.virtualPrivateCloud.subnetId}}                    </a>                  </p>                </div>                <div class="param-bd">                  <ul class="jiagou-list">                    <li class="dfwNav" id="detail-dfwNav" style="cursor:pointer;">                      <i class="safe-icon"></i>                      <a>                        {{item.securityGroupIds?item.securityGroupIds.length:\'0\'}}个安全组</a>                    </li>                    <li b-if="item.virtualPrivateCloud.vpcId" class="eni" id="detail-eni">                      <i class="lb-icon"></i>                      <a href="javascript:;">                        {{item.networkInterfaceSet&&item.networkInterfaceSet.length}}个弹性网卡</a>                    </li>                    <li class="last-li">                      <i class="system-icon"></i>                    </li>                  </ul>                  <div class="jiagou-bd-box">                  </div>                </div>              </div>            </div>          </div>        </div>      </div>    </div>  </div>',
usedettach:'  <div class="param-box">    <div class="param-bd">      <ul class="form-list">        <li>          <div class="form-label">            <label for="">启动磁盘</label>          </div>          <div class="form-input">            <p>数据盘，              <%=diskSize%>GB，              <%=diskTypeName%>            </p>          </div>        </li>        <li class="vm-text-row">          <div class="form-label">            <label for="">说明</label>          </div>          <div class="form-input">            <p>1、在2017年6月前实例关联的数据盘（云硬盘），是不支持从虚拟机上卸载下来的。最新的架构已支持自由挂载，卸载能力。启用卸载功能后，您可将磁盘自由的挂载卸载到指定的实例，计费的生命周期将独立。              <br>              <br>              2、续费说明：云硬盘从实例独立后，续费的周期将独立。为了延续之前的体验，实例团队提供“整体续费”的功能，即您在实例控制台对某实例资源续费时，默认会协助您将关联的云硬盘一并续费。避免云硬盘忘记续费，导致资源欠费，被回收。              <br>              <br>              3、云api接口问题：云硬盘从实例独立后，使用DescribeInstance的接口，拉取某实例详细信息时，将返回关联云硬盘的disk-id。需要查看该云硬盘详细信息，可使用DescribeCbsStorages，查看磁盘的详细属性、容量大小等            </p>          </div>        </li>      </ul>    </div>  </div>',dettach:'  <div class="tc-icon-box">    <div class="col">      <h3 class="tc-dialog-title">卸载实例（        <%=insId%>）的云硬盘（        <%=diskId%>）</h3>      <p class="text-weak">为了保证数据完整性，建议您在卸载之前，对该磁盘执行脱机操作，一暂停对该磁盘所有文件系统的读写操作，否则未完成读写的数据会丢失。        <a href="https://cloud.tencent.com/document/product/362/6740" target="_blank">查看详情          <i class="external-link-icon"></i>        </a>      </p>    </div>  </div>',diskList:'  <div class="jiagou-left">    <div class="jiagou-sub-hd">      <i class="system-icon"></i>      <p class="mb-5">        <i class="{{systemIcon}}"></i>        <em class="text">          {{osName}}        </em>      </p>      <p class="{{insStatusColorClass}}">        <!-- <i class="circle-icon"></i> -->        {{rawStatusDesc}}      </p>    </div>    <div class="jiagou-sub-bd">      <ul>        <i class="ul-left-line"></i>        <li class="justify-grid">          <div class="col">            <i class="line-icon"></i>            <i class="system-icon2"></i>            <p>系统盘              <a b-if="showSystemDisk.isCloudDisk" target="_blank"                href="{{\'https://console.qcloud.com/cvm/cbs/detail?diskId=\' + showSystemDisk.diskId + \'&rid=\' + regionId}}">                {{showSystemDisk.diskId}}              </a>            </p>            <p class="text-weak">{{showSystemDisk.diskTypeName}}，共 {{showSystemDisk.diskSize}} GB</p>            <div b-if="showSystemDisk.isCloudDisk">              <p b-if="showSystemDisk.diskChargeType==\'PREPAID\'" class="text-weak">{{showSystemDisk.payModeDesc|| \'\'}}                到期时间：{{showSystemDisk.deadlineTime||\'-\'}}</p>              <p b-if="showSystemDisk.diskChargeType==\'POSTPAID_BY_HOUR\'" class="text-weak">                {{showSystemDisk.payModeDesc|| \'\'}} 创建时间：{{showSystemDisk.createTime||\'-\'}}</p>            </div>          </div>          <div class="col">            <p b-if="showSystemDisk.isCloudDisk">              <a b-if="showSystemDisk.isRenew" b-on-click="diskRenew(showSystemDisk)" class="cbsRenew" href="#">续费</a>              <span b-if="!showSystemDisk.isRenew" data-title="{{showSystemDisk.errorTip}}" class="text-weak">续费</span>            </p>          </div>        </li>        <li class="justify-grid" b-repeat="item in allDataDisks">          <div class="col">            <i class="line-icon"></i>            <i class="system-icon2"></i>            <p>数据盘              <a b-if="item.isCloudDisk" target="_blank"                href="{{\'https://console.qcloud.com/cvm/cbs/detail?diskId=\' + item.diskId + \'&rid=\' + regionId}}">                {{item.diskId}}              </a>            </p>            <p class="text-weak">{{item.diskTypeName}}，共 {{item.diskSize}} GB</p>            <div b-if="item.isCloudDisk">              <p b-if="item.diskChargeType==\'PREPAID\'" class="text-weak">{{item.payModeDesc|| \'\'}}                到期时间：{{item.deadlineTime||\'-\'}}</p>              <p b-if="item.diskChargeType==\'POSTPAID_BY_HOUR\'" class="text-weak">{{item.payModeDesc|| \'\'}}                创建时间：{{item.createTime||\'-\'}}</p>            </div>          </div>          <div class="col" b-if="item.diskState === \'ATTACHED\'">            <p b-if="item.isCloudDisk">              <a b-if="item.isRenew" b-on-click="diskRenew(item)" class="cbsRenew" href="#">续费</a>              <span b-if="!item.isRenew" data-title="{{item.errorTip}}" class="text-weak">续费</span>            </p>            <p>              <a b-if="item.useDettach" class="edit" b-on-click="diskDettach(item.diskId, 1)" href="javascript:;"                data-type="1" data-diskid="{{allDataDisks[i].diskId}}">启动卸载功能</a>              <span b-if="item.canDettach">                <a b-if="insCanAttachOrDetach" class="edit" b-on-click="diskDettach(item.diskId, 2)" href="javascript:;"                  data-type="2">卸载</a>                <span b-if="!insCanAttachOrDetach" class="text-weak" data-title="当前实例状态下磁盘无法进行挂载操作">卸载</span>              </span>            </p>          </div>          <div class="col" b-if="item.diskState === \'ATTACHING\'">            <p>              <span class="text-weak">                <i class="n-loading-icon"></i>                <span class="ml-5">挂载中</span>              </span>            </p>          </div>          <div class="col" b-if="item.diskState === \'DETACHING\'">            <p>              <span class="text-weak">                <i class="n-loading-icon"></i>                <span class="ml-5">卸载中</span>              </span>            </p>          </div>        </li>        <li class="justify-grid null">          <div class="col">            <i class="line-icon"></i>            <span b-if="insCanAttachOrDetach">              <a b-if="portCloudDiskLength < 20" href="#" class="cbsAttach" b-on-click="diskAttach()">挂载</a>              <span b-if="portCloudDiskLength >= 20" class="text-weak" data-title="实例最多能挂载20块弹性云盘">挂载</span>            </span>            <span b-if="!insCanAttachOrDetach">              <span class="text-weak" b-if="!isS4Mental" data-title="当前实例状态下磁盘无法进行挂载操作">挂载</span>              <span class="text-weak" b-if="isS4Mental" data-title="裸金属实例不支持磁盘挂载">挂载</span>            </span>          </div>        </li>      </ul>    </div>  </div>'},z=["RUNNING","STOPPED"];c.exports={title:"实例-控制台",pageClass:"",render:function(a,b,c){var d=this;d.data=b,d.regionId=b.regionId,d.instanceId=b.instanceId;var e=s.REGIONAREAMAP[s.REGIONIDMAP[d.regionId]];b.regionCity=e.area+"（"+e.name+"）",d.module_detail=c;var f={},g=b.diskSet;g.forEach(function(a){f[a.diskId]=a}),b.cDiskIdToDetailMap=f,b.showSystemDisk=d.formatSystemDisk(),b.allDataDisks=(b.dataDisks||[]).map(function(a){return d.formatDataDisk(a)}),d.renderContent(a,b)},formatSystemDisk:function(){var a=this.data,b=this,c=a.diskSet.find(function(b){return b.diskId==a.systemDisk.diskId}),d=Object.assign({},a.systemDisk,{isCloudDisk:m.isCloudDiskType(a.systemDisk&&a.systemDisk.storageType),diskState:a.cDiskIdToDetailMap[a.systemDisk.diskId]&&a.cDiskIdToDetailMap[a.systemDisk.diskId].diskState,deadlineTime:b.formatDeadline(c),payModeDesc:c&&t.DISK_CHARGE_TYPE_MAP[c.diskChargeType]},b.checkDiskCanRenew(c),c);return d},formatDataDisk:function(a){var b=this,c=this.data,d=c.diskSet.find(function(b){return b.diskId==a.diskId}),e=m.isCloudDiskType(a.storageType);if(e){if(d){var f=b.checkDiskCanRenew(d);a.portable=d.portable,a.diskChargeType=d.diskChargeType,a.diskState=d.diskState}else var f=b.checkDiskCanRenew(a);a.isRenew=f.isRenew,a.errorTip=f.errorTip}var g=Object.assign({},a,{isCloudDisk:e,useDettach:"PREPAID"==a.diskChargeType&&!a.portable,canDettach:a.portable,deadlineTime:b.formatDeadline(d||a),payModeDesc:d&&t.DISK_CHARGE_TYPE_MAP[d.diskChargeType]},d);return g},formatDeadline:function(a){var b=null;return a&&(b=a.deadlineTime),b},checkDiskCanRenew:function(a){var b={};return a&&(a.portable&&"PREPAID"===a.diskChargeType?b.isRenew=!0:(b.isRenew=!1,"SYSTEM_DISK"===a.diskUsage&&"PREPAID"===a.diskChargeType?b.errorTip="实例续费时，该实例CPU、内存，系统盘一并续费，请到实例控制台进行续费":"POSTPAID_BY_HOUR"===a.diskChargeType?b.errorTip="按量计费的云硬盘，无需续费，请保持账户余额充足":b.errorTip="")),b},getunLink:function(a){var b=this;return function(c){if(!a.$disable){var e=new(Bee.getComponent("popup-confirm"))({handler:c.target,attachEl:d("#sshkey"),$data:{trigger:"",title:"确定解绑该密钥？"},onConfirm:function(){c.currentTarget.style.display="none",n.apiRequest({action:"DisassociateInstancesKeyPairs",serviceType:"cvm",data:{instanceIds:[b.instanceId],keyIds:[a.keyId],ForceStop:!0},regionId:g.getRegionId()},{camTipsType:"dialog"}).then(function(a){b.diskBee&&b.diskBee.checkInsTask(),k.checkTask(a.response.taskId,function(){i.success("解绑成功")})})["catch"](function(){i.error("解绑失败")})}});e.show()}}},getkeyPairIdsInfo:function(a){var b=this,c=!p.isStopped(a.instanceState);a.keyPairIds&&a.keyPairIds.length&&n.apiRequest({regionId:b.regionId,serviceType:"cvm",action:"DescribeKeyPairs",data:{KeyIds:a.keyPairIds,Limit:a.keyPairIds.length}},{tipErr:!1,camTips:!1}).then(function(a){a=a.response;var e,f=a.keyPairSet||[],g=[];e=f.length?f.map(function(a,d){return g.push({$disable:c,keyId:a.keyId,keyName:a.keyName}),'<div class="keyItem"><span><a class="id-link" data-event="nav" href="/cvm/sshkey/detail/'+a.keyId+'">'+a.keyId+"</a> | "+a.keyName+'</span><a href="javascript:;"><i data-title="'+(c?"关机状态才可解绑密钥":"")+'" data-index='+d+' data-name="unBindKey" data-disable='+b.disabled+' class="pencil-icon"></i></a><br/></div>'}).join(""):'<div class="keyItem"><span>无</span></div>',d("#sshkey .form-input").append(d(e)),d("#sshkey").on("click","i",function(a){var c=d(this).attr("data-index");b.getunLink(g[c])(a)})})["catch"](function(a){console.warn(a)})},renderContent:function(a,b){var c=this;this.container=a;var e=JSON.parse(JSON.stringify(b));e.createdTime&&(e.createdTime=g.formatDate(new Date(e.createdTime),"yyyy-MM-dd hh:mm:ss")),e.expiredTime&&(e.expiredTime=g.formatDate(new Date(e.expiredTime),"yyyy-MM-dd hh:mm:ss")),c.paramDetailBee=new Bee({$tpl:y.main,$data:{item:e}});f.tmpl(y.main,e);a.html(c.paramDetailBee.$el);var j=d(".item-descr-list");j.on("mouseenter","li",function(a){d(this).find(".pencil-icon").css("visibility","visible")}).on("mouseleave","li",function(a){d(this).find(".pencil-icon").css("visibility","hidden")}),this.getkeyPairIdsInfo(b),c.getNetworkInterfaces({vpc:e.virtualPrivateCloud,regionId:e.regionId,instanceId:e.instanceId},{tipErr:!1,camTips:!1}).then(function(a){e.networkInterfaceSet=a,c.paramDetailBee.$set("item",e)}),c.getCIDR({vpc:e.virtualPrivateCloud,regionId:e.regionId},{tipErr:!1,camTips:!1}).then(function(a){e.cidrBlock=a.cidrBlock,e.cidrBlockError=a.error,c.paramDetailBee.$set("item",e)}),this.initCopy(a),this.initEvents(a,b),c.diskBee=new Bee(y.diskList,{$data:{regionId:c.regionId,showSystemDisk:b.showSystemDisk,allDataDisks:b.allDataDisks,osName:b.osName,rawStatusDesc:b.statusTitle,instanceState:b.instanceState,insCanAttachOrDetach:!0,isS4Mental:"BMS4"===b.instanceFamily,systemIcon:v.getRootSystemIcon(b.osName)},$afterInit:function(){var a=0,c=this;this.showSystemDisk&&this.showSystemDisk.isCloudDisk&&this.showSystemDisk.portable&&(a+=1),this.allDataDisks.forEach(function(b){b.isCloudDisk&&b.portable&&(a+=1)}),this.$set("portCloudDiskLength",a),this.isWaiting=!1,this.$set("insCanAttachOrDetach",this.checkIsDiskAttached()),this.$watch("instanceState",function(a){c.getInsStateColor(a)},!0),this.checkInsTask(b)},checkIsDiskAttached:function(){var a=this.$get("instanceState");return z.indexOf(a)>-1&&!this.$get("isS4Mental")},getInsStateColor:function(a){var b="text-weak";p.isRunning(a)?b="text-success":p.isStopped(a)&&(b="text-danger"),this.$set("insStatusColorClass",b)},diskRenew:function(a){q.init([a],{regionId:b.regionId})},diskAttach:function(){var a=this,d=function(b){b.forEach(function(b){b.storageType||(b.storageType=b.diskType),b.diskType=t.DISKUSAGE_DISKTYPE_MAP[b.diskUsage],!b.payMode&&b.diskChargeType&&(b.payMode=t.DISK_CHARGE_TYPE_PAYMODE_MAP[b.diskChargeType]),a.allDataDisks.push(c.formatDataDisk(b))}),a.isWaiting=!0,a.checkTask(),a.checkInsTask()},e={portCloudDiskLength:a.portCloudDiskLength,callback:d};r.init(b,e)},diskDettach:function(a,d){var e,j,k=this,l=a,m=d;return b.allDataDisks.forEach(function(a,b){return a.diskId==l?(e=a,void(j=b)):void 0}),e=e||{},1==m?void h.create(f.tmpl(y.usedettach,e),710,"",{title:"启动磁盘卸载功能",button:{" 开始启用 ":function(a){o.modifyStorageAttr({regionId:c.regionId||g.getRegionId(),portable:!0,diskIds:[e.diskId]}).then(function(){h.hide();var a=Object.assign({},e,{useDettach:!e.useDettach,canDettach:!e.canDettach});k.allDataDisks.$set(j,a)})}}}):2==m?void x.verify({api:"cvm:DetachDisks"}).then(function(){var a=t.DISK_ERROR_TIP,d={insId:b.instanceId,diskId:l};h.create(f.tmpl(y.dettach,d),540,"",{title:"卸载云硬盘",button:{" 开始卸载 ":function(b){o.detachCbsStoragesCgi({regionId:c.regionId||g.getRegionId(),diskIds:[l]}).then(function(b){if(b=b.response,b.error){var c=b.error||{};a[c.code]?i.error(a[c.code]):i.error(c.message||"操作执行失败，请稍后重试")}else{var d;k.allDataDisks.forEach(function(a,b){return a.diskId===l?void(d=b):void 0}),k.isWaiting=!0,k.checkTask(),k.checkInsTask(),h.hide()}})}}})}):void 0},checkInsTask:function(a){var b=this;(!a||p.isDuringExclusionOperation(a))&&(b.insWaitingTime=setTimeout(function(){b.clearCheckInsTask(),Promise.all([u.queryCvmList2({filters:[{name:"instance-id",values:[c.instanceId]}],regionId:c.regionId},{tipErr:!1,camTips:!1,withoutDefaultFilter:!0})]).then(function(a){var d=_slicedToArray(a,1),e=d[0].response.instanceSet,f=void 0===e?[]:e,h=f[0];if(h){var i=h.runFlag,j=h.instanceState;h.lastOperationServiceType,h.latestOperation;b.$set({instanceState:j}),b.$set("insCanAttachOrDetach",b.checkIsDiskAttached()),b.$set("rawStatusDesc",g.getRunFlagDesc(i)),p.isDuringExclusionOperation(h)?(b.$set("insStatusColorClass","text-weak"),b.checkInsTask()):(b.clearCheckInsTask(),c.module_detail.listIns.refresh())}else c.module_detail.listIns.refresh()})},5e3))},checkTask:function(a){var b=this;b.allDataDisks.forEach(function(a){return"ATTACHING"===a.diskState||"DETACHING"===a.diskState?void(b.isWaiting=!0):void 0}),b.clearCheckTask(),b.isWaiting&&(b.waitingTime=setTimeout(function(){var d=b.allDataDisks.filter(function(a){return a.isCloudDisk}).map(function(a){return a.diskId});o.queryDisks({regionId:c.regionId,diskIds:d}).then(function(c){var d=c.response.diskSet,e=!1,f=[],g=[];if(d.forEach(function(a){b.allDataDisks.forEach(function(c,d){return a.diskId===c.diskId?(("ATTACHING"===a.diskState||"DETACHING"===a.diskState)&&(e=!0),"ATTACHING"===c.diskState&&"UNATTACHED"===a.diskState&&f.push(a.diskId),"ATTACHING"===c.diskState&&"ATTACHED"===a.diskState&&b.$set("portCloudDiskLength",b.portCloudDiskLength+1),"DETACHING"===c.diskState&&"UNATTACHED"===a.diskState&&g.push(a.diskId),void b.allDataDisks.$set(d,Object.assign({},c,{diskState:a.diskState}))):void 0})}),g.length){var h=[];b.allDataDisks.forEach(function(a,b){g.indexOf(a.diskId)<=-1&&h.push(a)}),b.$set("allDataDisks",h),b.$set("portCloudDiskLength",b.portCloudDiskLength-g.length)}if(f.length){var h=[];b.allDataDisks.forEach(function(a,b){f.indexOf(a.diskId)<=-1&&h.push(a)}),i.error("磁盘"+f.join(",")+"挂载失败"),b.$set("allDataDisks",h)}e?b.checkTask(a):(a&&a(),b.clearCheckTask())})},500))},clearCheckTask:function(){clearTimeout(this.waitingTime)},clearCheckInsTask:function(){clearTimeout(this.insWaitingTime)}}),d(".jiagou-bd-box").append(c.diskBee.$el);(new Date).getTime();b.itemId&&0!==b.itemId&&this.getImagesDetail(b)},getNetworkInterfaces:function(a,b){return new Promise(function(b,c){a.vpc&&a.vpc.vpcId?l.getNetworkInterfaces2({regionId:a.regionId,data:{filters:[{name:"attachment.instance-id",values:[a.instanceId]}]}}).then(function(a){b(a.response.networkInterfaceSet)},function(){b([])}):b([])})},getCIDR:function(a,b){return new Promise(function(c,d){a.vpc&&a.vpc.vpcId?n.apiRequest({serviceType:"vpc",action:"DescribeVpcs",data:{filters:[{name:"vpc-id",values:[a.vpc.vpcId]}]},regionId:a.regionId},b).then(function(a){c(a.response.vpcSet&&a.response.vpcSet.length?{cidrBlock:a.response.vpcSet[0].cidrBlock}:{cidrBlock:null})},function(a){a=a||{},a.isCam=w.isCamRefused(a),c({error:a})})["catch"](function(a){console.warn(a)}):c({cidrBlock:null})})},operatedCallback:function(){var a=this;setTimeout(function(){a.diskBee&&a.diskBee.checkInsTask()},200)},initCopy:function(a){var b=a.find(".viewIpCopyWrap"),c=b.find("[data-clipboard-text]");new j({handle:c,container:b})},initEvents:function(a,b){var c=this;c.container.find(".item-wip").mouseenter(function(){d(this).addClass("item-wip-hover")}).mouseleave(function(){d(this).removeClass("item-wip-hover")})},getImagesDetail:function(a){var b=d("#paramOsField").html("...");e.getImagesDetail({itemId:[a.itemId]},function(a){if(a&&a.length){var c=a&&a[0],e=c.productName,f=c.productId,g=c.unImgId||"-",h="http://market.qcloud.com/detail.php?productId="+f;b.html('<a href="'+h+'" target="_blank" title="'+e+'">'+e+"</a>"),d("#paramUnImgId").text(g)}else b.html(a.osName)})},getDiskData:function(a){return a.length?o.queryDisks({regionId:this.regionId,diskIds:a}):Promise.resolve({response:null})},getEipQuotaData:function(a){return l.getEipQuota({regionId:g.getRegionId()},a)},destroy:function(){this.container&&this.container.off("click.eip")}}}),define("cvm/detail/viewUtil",function(a,b,c){function d(a,b){e.request({name:"getFlowCscResult",global:!1,data:{taskId:a},success:function(c){var e=c.status;if(0===e)b();else if(2===e)g[a].timeOut=setTimeout(function(){d(a,b)},3e3);else{var h="操作状态查询失败";f.error(h),b(h)}},fail:function(a){f.error("操作状态查询失败"),b(a)}})}var e=(a("appUtil"),a("models/loadbalance")),f=a("tips");c.exports={checkTask:function(a,b){return b=b||function(){},g[a]={},d(a,function(c){delete g[a],b(c)}),{clear:function(){clearTimeout(g[a]&&g[a].timeOut)}}}};var g={}}),define("cvm/eip2/bindEip",function(a,b,c){function d(a,b,c){return new Promise(function(d,e){!function f(){v.apiRequest({regionId:a,action:"QueryTask",serviceType:"vpc",data:{Version:"2017-03-12",TaskId:b}}).then(function(a){var b=a.Response,g=b.Status;switch(g){case"SUCCESS":d(b);break;case"FAILED":t.error("查询流程失败"),e(new Error({message:"查询流程失败"}));break;default:setTimeout(f,c)}},e)}()})}var e=a("qccomponent"),f=a("appUtil"),g=a("dialog"),h=a("widget/selectors/ListSelector"),i=a("cvm/common/components/CvmSelector"),j=a("widget/selectors/NatSelector"),k=a("widget/selectors/EniSelector"),l=a("widget/baseInfo/validator"),m=a("cvm/common/model"),n=a("./data"),o=a("cvm/eip2/common/util"),p=a("cvm/cvm/data"),q=a("cvm/common/constants"),r=a("util"),s=a("manager"),t=a("tips"),u=new l,v=seajs.require("models/iaas"),w=a("constants"),x=a("./common/config"),y=function(){var a=null;return function(){return a?a:a=new Promise(function(b,c){s.queryWhiteList({whiteKey:["HAVIP"]},function(a){b(!0),a&&a.HAVIP&&a.HAVIP.length?b(!0):c({message:"not havip user"})},function(b){a=null,c(b)})})}}(),z=e.extend({$tpl:'  <div>    <div class="tc-15-option-hd mb10" style="margin-bottom: 10px;">      <h4>请选择"弹性公网IP:{{eip.id}}"要绑定的实例</h4>      <div class="tc-15-list-det-wrap">        <span class="tc-15-list-det" style="float:none;">          <span b-repeat="res in resources">            <label class="tc-15-radio-wrap" data-title="{{res.type == \'nat\' ? natDisableText : \'\'}}">              <input type="radio" class="tc-15-radio" b-model="resType" value="{{res.type}}" disabled?="res.type == \'nat\' && natDisable"              /> {{res.label}}            </label>          </span>        </span>      </div>    </div>    <div>      <cvm-selector b-ref="cvm" region-id="{{regionId}}" isNetworkShiftUpUser="{{eip.isNetworkShiftUpUser}}" is-anycast-eip="{{eip.addressType == \'AnycastEIP\'}}"        search-placeholder="请输入名称, ID或IP" b-if="resType == \'cvm\'"></cvm-selector>      <nat-selector b-ref="nat" region-id="{{regionId}}" isNetworkShiftUpUser="{{eip.isNetworkShiftUpUser}}" search-placeholder="请输入名称或ID"        b-if="resType == \'nat\'"></nat-selector>      <eni-selector b-ref="eni" region-id="{{regionId}}" isNetworkShiftUpUser="{{eip.isNetworkShiftUpUser}}" search-placeholder="请输入名称或ID"        b-if="resType == \'eni\'"></eni-selector>      <div b-if="resType == \'havip\'">        <div class="tc-15-msg">          <div class="tip-info">            <p>如果HAVIP              <span class="text-warning">没有绑定实例</span>              ，绑定此HAVIP的EIP会处于              <span class="text-warning">闲置状态</span>，按              <span class="text-warning">                <strong>{{toI18nMoney(eip.regionPrice, \'words\')}}</strong>/小时</span>              收取闲置费用。请正确配置高可用应用，确保绑定成功。              <a href="#" class="guide-link">查看详情                <b class="external-link-icon"></b>              </a>            </p>          </div>          <a href="" class="tc-icon-btn">            <i class="close-icon"></i>          </a>        </div>        <havip-selector b-ref="havip" region-id="{{regionId}}" isNetworkShiftUpUser="{{eip.isNetworkShiftUpUser}}" search-placeholder="请输入名称或ID"></havip-selector>      </div>    </div>  </div>',$afterInit:function(){var a=this;y().then(function(){a.$set("resources",a.resources.concat({label:"高可用虚拟IP",type:"havip"}))})}},{defaults:{resType:"cvm",resources:[{label:"实例",type:"cvm"},{label:"NAT网关",type:"nat"},{label:"弹性网卡",type:"eni"}]}});z.tag("cvm-selector",i.extend({$beforeInit:function(){var a=this,b=this.getData,c=n.operateCVMRunflag,d=this.isnetworkshiftupuser,e=this.isAnycastEip;this.getData=function(f){return new Promise(function(g,h){p.getProjects().then(function(h){var i=r.getUin(),j=r.getOwnerUin(),k=[];(h||[]).forEach(function(a){k.push(a.projectId)}),f.filters=f.filters||[],i!=j&&k.length>0&&f.filters.push({name:"project-id",values:k}),b.call(a,f).then(function(a){a.list.forEach(function(a,b){a.$index=b,a.eip&&a.eip.ip?(a.$disable=!0,a.$disableTips="请先解绑此实例上现有的弹性IP再进行绑定"):a.deviceWanIp&&d?(a.$disable=!0,a.$disableTips="当前实例已存在公网IP"):c.indexOf(a.runflag)<0?(a.$disable=!0,a.$disableTips="当前实例处于无法绑定状态"):a.internetAccessible.internetChargeType!=q.NETWORKPAYMODE.BANDWIDTH_PREPAID&&a.internetAccessible.internetChargeType!=q.NETWORKPAYMODE.BANDWIDTH_POSTPAID_BY_HOUR||!e||(a.$disable=!0,a.$disableTips="anycast eip 不支持绑定按固定带宽计费的机器"),a.placement.zoneName=w.ZONEIDV3TONAMEMAP[a.placement.zone]||"-"}),g(a)})})})}},parseData:function(a){return a}},{defaults:$.extend({},i.defaults,{colums:[{name:"实例ID/名称",key:"uInstanceId",tdTpl:'  <p class="text-overflow">{{item.uInstanceId}}</p>  <p class="text-overflow" title="{{item.alias}}">{{item.alias}}</p>'},{name:"可用区",key:"zone",tdTpl:'  <p class="text-overflow">{{item.placement.zoneName}}</p>'},{name:"当前带宽",key:"bandwidth",width:"100px",tdTpl:"  <p>{{(item.bandwidth || 0) + \"Mbps\"}}</p>  <div b-if=\"item[checkKey]===$checked && !item.bandwidth\" class=\"tc-15-bubble\" b-class=\"{'tc-15-bubble-bottom': 'item.$index', 'tc-15-bubble-top': '!item.$index'}\"    style=\"margin:15px 5px;width:395px;left:-50px;\" b-style=\"'top:' + (item.$index ? '-60px': '10px')\">    <div class=\"tc-15-bubble-inner\">      您所绑定的实例外网带宽为0Mbps，将导致无法对外访问，请调整带宽    </div>  </div>"},{name:"内网IP",key:"deviceLanIp"},{name:"已绑定公网IP",key:"deviceWanIp"}]})})),z.tag("nat-selector",j.extend({parseData:function(a){return a.list.forEach(function(a){a.eips="<p>"+a.eipSet.join("</p></p>")+"</p>"}),a}},{defaults:$.extend({},j.defaults,{colums:[{name:"NAT网关ID/名称",key:"natId",tdTpl:'  <p class="text-overflow">{{item.natId}}</p>  <p class="text-overflow" title="{{item.natName}}">{{item.natName}}</p>'},{name:"已绑定弹性IP",key:"eips"}]})})),z.tag("eni-selector",k.extend({parseData:function(a){var b=[],c=this.isnetworkshiftupuser;return a.list.forEach(function(a){a.privateIpAddressesSet.forEach(function(d){var e=$.extend({},a,d);e._key=a.networkInterfaceId+"-"+d.privateIpAddress,b.push(e),e.eipId&&(e.$disable=!0,e.$disableTips="请先解绑此弹性网卡上现有的 EIP 再进行绑定"),c&&d.wanIp&&(e.$disable=!0,e.$disableTips="当前弹性网卡已存在公网IP")})}),a.list=b,a}},{defaults:$.extend({},k.defaults,{checkKey:"_key",colums:[{name:"弹性网卡ID/名称",key:"networkInterfaceId",tdTpl:'  <p class="text-overflow">{{item.networkInterfaceId}}</p>  <p class="text-overflow" title="{{item.eniName}}">{{item.eniName}}</p>'},{name:"内网IP",key:"privateIpAddress"},{name:"已绑定公网IP",key:"wanIp"}]})})),z.tag("havip-selector",h.extend({havipStateMap:{UNBIND:{text:"未绑定云主机","class":"text-danger"},AVAILABLE:{text:"已绑定云主机","class":"text-success"}},getData:function(a){a=a||{};var b=this,c=a.count||this.count,d=a.page||this.page,e={limit:c,offset:c*(d-1)},g=[];return a.searchKey&&(/^havip-\w{8}$/.test(a.searchKey)?g.push({name:"havip-id",values:[a.searchKey]}):f.isValidIp(a.searchKey)?g.push({name:"address-ip",values:[a.searchKey]}):g.push({name:"havip-name",values:[a.searchKey]})),v.gqlRequest(Object.assign({regionId:this.regionId},{variables:e,operationName:"DescribeHavipsEx",query:"query DescribeHavipsEx ($filters: [Filter], $offset: Int, $limit: Int){\n                    resource{\n                      havips(filters: $filters ,limit: $limit, offset: $offset) {\n                          nodes {\n                              id\n                              name\n                              state\n                              vpcId\n                              vpc{\n                                id\n                                name\n                              }\n                              subnetId\n                              subnet {\n                                id\n                                name\n                              }\n                              instanceId\n                              addressIp\n                              address{\n                                id\n                                addressIp\n                              }\n                              virtualIpAddress\n                              createdTime\n                          }\n                          totalCount\n                        }\n                    }\n                  }"}),{camTipsType:"dialog"}).then(function(b){var c=b.data,d=b.errors;if(void 0!=b.code&&b.message)throw v.errorHandler({camTipsType:"dialog"})(b),b;var e=["resource","havips"],f=v.getGqlError(e,d);if(f){var g=f.data.Response?{code:f.data.Response.Error.Code,message:f.data.Response.Error.Message}:f.data;return v.errorHandler(a)(g),Promise.reject(g)}var h=e.reduce(function(a,b){return a[b]},c);return{data:h,errors:d}}).then(function(a){var c=a.data;return{list:c.nodes.map(function(a){return a._state=b.havipStateMap[a.state]&&b.havipStateMap[a.state].text||a.state,a.addressIp&&(a.$disable=!0,a.$disableTips="该HAVIP已绑定其他弹性公网IP"),a}),totalNum:c.totalCount}})}},{defaults:{multipleSearch:!1,checkType:"radio",checkKey:"id",colums:[{name:"ID/名称",key:"id",tdTpl:'<p><a href="/vpc/havip/detail?rid={{regionId}}&id={{item.id}}">{{item.id}}</a></p><p class="text-overflow">{{item.name}}</p>'},{name:"IP地址",key:"virtualIpAddress"},{name:"状态",key:"_state"},{name:"所属网络",key:"vpcId",tdTpl:'<div><p><a href="/vpc/vpc?rid={{regionId}}&unVpcId={{item.vpcId}}">{{item.vpcId}}</a></p><p b-if="item.vpc" class="text-overflow">{{item.vpc.name}}</p></div>'},{name:"所属子网",key:"subnetId",tdTpl:'<div><p><a href="/vpc/vpc?rid={{regionId}}&subnetId={{item.subnetId}}">{{item.subnetId}}</a></p><p b-if="item.subnet" class="text-overflow">{{item.subnet.name}}</p></div>'}]}})),c.exports={exec:function(b){var c=this,d=!1,e="";b.isNetworkShiftUpUser&&!b.isTraffic&&b.payMode!==n.payMode["package"]?(d=!0,e="带宽类EIP不支持绑定nat网关"):b.isNetworkShiftUpUser||b.internetServiceProvider!=x.EIP_ISP_TYPE.CTCC&&b.internetServiceProvider!=x.EIP_ISP_TYPE.CUCC&&b.internetServiceProvider!=x.EIP_ISP_TYPE.CMCC||(d=!0,e="三网 EIP 暂时不支持绑定NAT网关");var f=new z({$data:{eip:b,natDisable:d,natDisableText:e,regionId:b.regionId,toI18nMoney:a("widget/i18n").toI18nMoney}});g.create(f.$el,720,"",{preventResubmit:!0,title:"绑定资源",defaultCancelCb:function(){f.$destroy()},button:{" 确定 ":function(a){var d=f.$refs[f.resType],e=d.currentItem;return e?void("cvm"===f.resType?c.bindCvm(b,e):"eni"===f.resType?c.bindEni(b,e):"nat"===f.resType?c.bindNat(b,e):"havip"==f.resType&&c.bindHaVip(b,e)):(u.btn=a,u.showTips($(d.$el).find(".tc-15-table-panel")[0],"请选择一个资源"),void g.toggleBtnDisable(!1))}}})},bindCvm:function(a,b){var c="请确认弹性公网IP："+a.ip+"<br>绑定实例："+b.uInstanceId+"("+b.alias+")的操作!";a.isNetworkShiftUpUser||!b.deviceWanIp||b.eip||(c+="<br>绑定后，原来的公网IP："+b.deviceWanIp+' 将被释放回腾讯云，<span style="color: red;">无法找回！</span>'),o.getConfirm({title:"绑定弹性公网IP",content:c},function(){n.bindEip({data:{AddressId:a.id,InstanceId:b.uInstanceId},regionId:a.regionId}).then(function(b){g.hide(),t.success("绑定中..."),n.checkTask({taskId:b.response.taskId,regionId:a.regionId})})["catch"](function(a){"InvalidInstanceId.NotSupported"==a&&g.confirm("S4系列、M4系列、GN6s系列、SN3ne系列、S2ne系列为新机型，暂不兼容Anycast等功能。您可在云主机“调整配置”功能中更改机型。")})})},bindEni:function(a,b){o.getConfirm({title:"绑定弹性公网IP",content:"请确认弹性公网IP："+a.ip+"<br>绑定弹性网卡："+b.networkInterfaceId+"("+b.eniName+")的操作"},function(){n.bindEip({data:{AddressId:a.id,NetworkInterfaceId:b.networkInterfaceId,PrivateIpAddress:b.privateIpAddress},regionId:a.regionId}).then(function(b){g.hide(),t.success("绑定中..."),n.checkTask({taskId:b.response.taskId,regionId:a.regionId})})})},bindNat:function(a,b){o.getConfirm({title:"绑定弹性公网IP",content:"请确认弹性公网IP："+a.ip+"<br>绑定NAT网关："+b.natId+"("+b.natName+")的操作"+(a.isNetworkShiftUpUser?"<br>绑定NAT网关后，EIP的带宽上限为5000Mbps":"")},function(){m.apiDelegate({regionId:a.regionId,serviceType:"vpc",cmd:"EipBindNatGateway",data:{natId:b.natId,vpcId:b.vpcId,assignedEipSet:[a.ip],autoAllocEipNum:0}}).then(function(b){g.hide(),t.success("绑定中..."),n.checkTask({taskId:b.taskId||b.data&&b.data.taskId,regionId:a.regionId})})})},bindHaVip:function(a,b){o.getConfirm({title:"绑定弹性公网IP",content:"请确认弹性公网IP："+a.ip+"<br>绑定HAVIP："+b.id+"("+b.name+")的操作"},function(){return v.apiRequest({regionId:a.regionId,action:"HaVipAssociateAddressIp",serviceType:"vpc",data:{Version:"2017-03-12",HaVipId:b.id,addressIp:a.addressIp}},{classicResponse:!1}).then(function(b){var c=b.Response;g.hide(),t.success("绑定中...");var e=c.RequestId;d(a.regionId,e,2e3).then(function(){n.refreshList()},function(){t.error("操作执行失败！"),n.refreshList()})})})}}}),define("cvm/eip2/common/config",function(a,b,c){var d={EIP_STATUS_MAP:{BIND:{isBind:!0,desc:"已绑定",className:"text-success",tip:"已绑定资源，若操作请先解绑",unbindTip:"绑定的实例当前状态不支持解绑",canUnbind:!0,canUpgradeBandwidth:!0,canDirectConnect:!0},BIND_ENI:{isBindEni:!0,desc:"已绑定",className:"text-success",tip:"已绑定弹性网卡",canUnbind:!0,canUpgradeBandwidth:!0},UNBIND:{isUnbind:!0,desc:"未绑定，扣费中",className:"text-danger",tip:"未绑定云资源",canBind:!0,canRelease:!0,canUpgradeBandwidth:!0},CREATING:{isCreating:!0,desc:"申请中",tip:"正在申请IP资源，暂不能执行相关操作"},BINDING:{isBinding:!0,desc:"绑定中",tip:"正在绑定资源中"},UNBINDING:{isUnbinding:!0,desc:"解绑中",tip:"正在解绑资源中"},OFFLINING:{isOfflining:!0,desc:"下线中",tip:"当前状态不能执行该操作"},CREATE_FAILED:{isCreateFailed:!0,desc:"申请失败",className:"text-danger",tip:"当前状态不能执行该操作",canRelease:!0}},EIP_BINED_RESOURCE_MAP:{ins:{type:"cvm",typeDesc:"实例",link:function(a){return"/cvm/detail/"+a+"/"}},eni:{type:"eni",typeDesc:"弹性网卡",link:function(a){return"/vpc/eni/detail?rid="+a+"&tab=1&id="}},nat:{type:"nat",typeDesc:"NAT网关",link:function(a){return"/vpc/nat?rid="+a+"&detailId="}},havip:{type:"havip",typeDesc:"HAVIP",link:function(a){return"/vpc/havip/detail?rid="+a+"&id="}}},EIP_PAY_MODE:{BANDWIDTH_PREPAID_BY_MONTH:{desc:"包月带宽",maxBandwidth:{BIND_PREPAID_INSTANCE:200,BIND_POSTPAID_INSTANCE:100,DEFAULT:200}},TRAFFIC_POSTPAID_BY_HOUR:{desc:"按流量",maxBandwidth:{BIND_PREPAID_INSTANCE_CPU_LT_8:200,BIND_PREPAID_INSTANCE_CPU_BETWEEN_8_AND_24:400,BIND_PREPAID_INSTANCE_CPU_GT_24:400,BIND_POSTPAID_INSTANCE:100,NAT:5e3,DEFAULT:100}},BANDWIDTH_POSTPAID_BY_HOUR:{desc:"按小时带宽",maxBandwidth:{NAT:5e3,DEFAULT:100}},BANDWIDTH_PACKAGE:{desc:"共享带宽包",maxBandwidth:{DEFAULT:1e3}}},EIP_ADDRESS_TYPE_MAP:{AnycastEIP:"加速IP",EIP:"普通IP"},ANYCAST_ZONE_DESC:{ANYCAST_ZONE_A:"发布域A",ANYCAST_ZONE_B:"发布域B"},EIP_RENEWAL_TIME_OPTIONS:[{name:"1个月",
value:"1"},{name:"2个月",value:"2"},{name:"3个月",value:"3"},{name:"半年",value:"6",ico:"icon-hui",iconVal:"88折"},{name:"1年",value:"12",active:!0,ico:"ico ico_join icon-hui",iconVal:"83折"},{name:"2年",value:"24",ico:"ico ico_join icon-hui",iconVal:"7折"},{name:"3年",value:"36",ico:"ico ico_join icon-hui",iconVal:"5折"}],EIP_REGION_PRICE:{1:{name:"华南地区-广州",price:"0.20"},4:{name:"华东地区-上海",price:"0.20"},5:{name:"东南亚地区-香港",price:"0.30"},6:{name:"北美地区-多伦多",price:"0.25"},7:{name:"华东地区-上海金融",price:"0.20"},8:{name:"华北地区-北京",price:"0.20"},9:{name:"东南亚地区-新加坡",price:"0.30"},11:{name:"华南地区-深圳金融",price:"0.20"},12:{name:"华南地区-Open专区",price:"0.20"},15:{name:"美国西部-硅谷",price:"0.25"},16:{name:"西南地区-成都",price:"0.20"},17:{name:"欧洲地区-法兰克福",price:"0.20"},18:{name:"亚太地区-首尔",price:"0.20"},19:{name:"西南地区-重庆",price:"0.20"},21:{name:"亚太南部-印度",price:"0.25"},22:{name:"美东地区-弗吉尼亚",price:"0.25"},23:{name:"亚太地区-曼谷",price:"0.25"},24:{name:"欧洲地区-莫斯科",price:"0.25"},25:{name:"亚太地区-东京",price:"0.25"},31:{name:"华东地区-济南",price:"0.20"},32:{name:"华东地区-杭州",price:"0.20"},33:{name:"华东地区-南京",price:"0.20"}},EIP_BANDWIDTH_SLIDER_SECTION:{100:[{value:5,width:100},{value:20,width:200},{value:100,width:300}],200:[{value:10,width:100},{value:40,width:200},{value:200,width:300}],400:[{value:20,width:100},{value:80,width:200},{value:400,width:300}],1e3:[{value:500,width:150},{value:1e3,width:300}],5e3:[{value:500,width:30},{value:2e3,width:120},{value:5e3,width:300}]},EIP_ISP_TYPE:{CTCC:"中国电信",CUCC:"中国联通",CMCC:"中国移动",BGP:"腾讯CAP"},EIP_BANDWIDTH_QUOTA_CONFIG:[{networkPayMode:["TRAFFIC_POSTPAID_BY_HOUR"],cvmPayMode:["POSTPAID_BY_HOUR"],bandwidthUpper:100,bandwidthLimit:1},{networkPayMode:["TRAFFIC_POSTPAID_BY_HOUR"],cvmPayMode:["PREPAID"],cpu:[1,8],bandwidthUpper:200,bandwidthLimit:1},{networkPayMode:["TRAFFIC_POSTPAID_BY_HOUR"],cvmPayMode:["PREPAID"],cpu:[9,23],bandwidthUpper:400,bandwidthLimit:1},{networkPayMode:["TRAFFIC_POSTPAID_BY_HOUR"],cvmPayMode:["PREPAID"],cpu:[24,-1],bandwidthUpper:400,bandwidthLimit:0},{networkPayMode:["TRAFFIC_POSTPAID_BY_HOUR"],cvmPayMode:["CDHPAID"],bandwidthUpper:1e3,bandwidthLimit:1},{networkPayMode:["TRAFFIC_POSTPAID_BY_HOUR"],bandwidthUpper:100,bandwidthLimit:1},{networkPayMode:["BANDWIDTH_POSTPAID_BY_HOUR"],cvmPayMode:["POSTPAID_BY_HOUR"],bandwidthUpper:100,bandwidthLimit:1},{networkPayMode:["BANDWIDTH_POSTPAID_BY_MONTH"],cvmPayMode:["PREPAID"],zoneId:[100001,100002,200001,300001,400001],bandwidthUpper:200,bandwidthLimit:1},{networkPayMode:["BANDWIDTH_POSTPAID_BY_MONTH"],cvmPayMode:["PREPAID"],bandwidthUpper:200,bandwidthLimit:1},{networkPayMode:["BANDWIDTH_PACKAGE"],cvmPayMode:["CDHPAID"],bandwidthUpper:1e3,bandwidthLimit:1},{networkPayMode:["BANDWIDTH_PACKAGE"],bandwidthUpper:1e3,bandwidthLimit:0}]};c.exports=d}),define("cvm/eip2/common/util",function(a,b,c){var d=a("appUtil"),e=a("dialog"),f=(a("cvm/cvm/cvmutil"),a("../common/config"));f.EIP_PAY_MODE;c.exports={getCountDownDesc:function(a){if(!a)return"";var a=d.formatDate(new Date(a),"yyyy-MM-dd hh:mm:ss"),b=864e5,c=7*b,e=new Date(a.replace(/\-/g,"/")),f=0,g="-",h=(new Date).getTime();if(f=h-e.getTime(),"0000-00-00 00:00:00"!=a)if(c>f){f=f.toFixed(2)-0;var i=(7-f/b).toFixed(2).split("."),j="";if(i[1]){var j=(i[1]/100*24).toFixed(0)-0;j=j>0?j+"小时":""}g=0==i[0]&&0==j?"小于1小时销毁":i[0]+"天"+j+"后销毁"}else g="已销毁";return g},getConfirm:function(a,b){a=a||{};var c=a.content||"确认执行该操作吗？",d=a.title||"操作确认";e.create('<i class="ico ico-warn"></i><div style="width: 350px; margin-left: 10px; vertical-align: middle; display: inline-block;">'+c+"</div>",480,"",{title:d,preventResubmit:!0,button:{" 确定 ":function(){b&&b()}}});e.center()},getEipMaxBandwidth:function(a,b){var c=["bindNat","networkPayMode","cvmPayMode","cpu","zoneId"],d=a.map(function(a){return a.zoneId&&(a.zoneId=a.zoneId.map(function(a){return String(a)})),a.cpu&&(a.cpu=a.cpu.map(function(a){return Number(a)})),a}),e=function(a){var e=c[a];if(!b.hasOwnProperty(e))return"continue";var f=null;if("bindNat"===e&&b.bindNat){if("TRAFFIC_POSTPAID_BY_HOUR"===b.networkPayMode||"BANDWIDTH_POSTPAID_BY_HOUR"===b.networkPayMode)return{v:{bandwidthLimit:1,bandwidthUpper:5e3,cpu:[],cvmPayMode:[],networkPayMode:[],zoneId:[]}};if("BANDWIDTH_PACKAGE"===b.networkPayMode)return{v:{bandwidthLimit:1,bandwidthUpper:1e3,cpu:[],cvmPayMode:[],networkPayMode:[],zoneId:[]}}}else f="cpu"==e?d.filter(function(a){return a.cpu?-1==a.cpu[1]?b.cpu>=a.cpu[0]:b.cpu>=a.cpu[0]&&b.cpu<=a.cpu[1]:!0}):d.filter(function(a){return a[e]&&a[e].length&&-1==a[e].indexOf(String(b[e]))?!1:!0});return f.length?void(d=f):"break"};a:for(var f=0;f<c.length;f++){var g=e(f);switch(g){case"continue":continue;case"break":break a;default:if("object"===("undefined"==typeof g?"undefined":_typeof(g)))return g.v}}return d[0]}}}),define("cvm/eip2/createEip",function(a,b,c){var d=a("dialog"),e=(a("widget/pills/pills"),a("widget/range/range"),a("widget/region/regionSelector"),a("widget/region/regionAreaSelector"),a("widget/form/NumberStepInput"),a("widget/popover/HelpTips")),f=a("appUtil"),g=(a("util"),a("tips")),h=a("./data"),i=a("./ispSelector"),j=(a("constants"),a("manager")),k={main:'  <div class="coin-alert">    <style>      #regionList button {        width: 140px;        padding: 0px 5px;      }    </style>    <ul class="form-list">      <li>        <div class="form-label"><label for="">选择地域</label></div>        <div class="form-input" id="regionList">          <region-area-selector            on-change=""            b-model="regionId"            region-list="{{regionSelectorData}}"          ></region-area-selector>          <div class="form-unit is-success">            <p class="form-input-help">弹性公网IP只支持该地域的腾讯云资源</p>          </div>        </div>      </li>      <li        b-style="{display: (isAnycastUser || isSingleIspUser) ? \'table-row\' : \'none\'}"      >        <div class="form-label"><label for="">IP地址类型</label></div>        <div class="form-input">          <div class="form-unit">            <label class="form-ctrl-label">              <input                type="radio"                name="eipTypeSelector"                class="tc-15-radio"                value="1"                b-model="eipType"              />普通IP地址</label            >            <label class="form-ctrl-label" b-if="isAnycastUser">              <input                type="radio"                name="eipTypeSelector"                class="tc-15-radio"                value="2"                b-model="eipType"                disabled?="!isAnycastRegion"              />加速IP地址              <help-tips                >加速IP地址以Anycast方式同时在多地域发布，实现就近接入，优化体验</help-tips              >            </label>            <label class="form-ctrl-label" b-if="isSingleIspUser && isZoneUser">              <input                type="radio"                name="eipTypeSelector"                class="tc-15-radio"                value="3"                b-model="eipType"              />              三网IP地址            </label>          </div>        </div>      </li>      <li b-if="isAnycastUser && eipType == \'2\'">        <div class="form-label"><label for="">发布域</label></div>        <div class="form-input">          <div class="form-unit">            <label class="form-ctrl-label">              <input                type="radio"                name="anycastZone"                class="tc-15-radio"                value="anycast_zone_a"                b-model="anycastZone"                disabled?="!isAnycastZoneARegion"              />              发布域A              <help-tips b-if="isAnycastZoneARegion"                >IP将同时在{{ anycastZoneRegionsDesc[0] }}发布</help-tips              >              <help-tips b-if="!isAnycastZoneARegion"                >该地域不支持发布域A</help-tips              >            </label>            <label class="form-ctrl-label">              <input                type="radio"                name="anycastZone"                class="tc-15-radio"                value="anycast_zone_b"                b-model="anycastZone"                disabled?="!isAnycastZoneBRegion"              />              发布域B              <help-tips b-if="isAnycastZoneBRegion"                >IP将同时在{{ anycastZoneRegionsDesc[1] }}发布</help-tips              >              <help-tips b-if="!isAnycastZoneBRegion"                >该地域不支持发布域B</help-tips              >            </label>          </div>        </div>      </li>      <li b-if="isZoneUser && (eipType == \'1\' || eipType == \'3\')">        <div class="form-label"><label>可用区</label></div>        <div class="form-input">          <div class="form-unit">            <select b-model="zone" class="tc-15-select m">              <option                b-repeat="item in zoneList"                value="{{item.id}}"                disabled?="item.status == 0 ? true : false"                >{{ item.zoneName }}</option              >            </select>          </div>        </div>      </li>      <li b-if="isSingleIspUser && eipType == \'3\'">        <div class="form-lable"><label>运营商</label></div>        <div class="form-input">          <div class="form-unit {{selectedIsp ? \'\' : \'is-error\'}}">            <isp-selector              b-model="selectedIsp"              region-id="{{regionId}}"              zone-id="{{zone}}"            ></isp-selector>          </div>        </div>      </li>      <li b-if="isNetworkShiftUpUser">        <div class="form-label"><label for="">计费模式</label></div>        <div class="form-input">          <div class="form-unit">            <qc-segment              list="{{payModeList}}"              b-model="selectedPayMode"            ></qc-segment>          </div>        </div>      </li>      <li b-if="isNetworkShiftUpUser">        <div class="form-label"><label for="">带宽上限</label></div>        <div class="form-input">          <p            style="margin-bottom: 10px; display: {{eipType == 2 ? \'block\' : \'none\'}}"          >            <label class="form-ctrl-label">              <input                type="radio"                name="hasBandwidthLimit"                class="tc-15-radio"                value="1"                b-model="hasBandwidthLimit"                checked="true"              />有上限            </label>            <label class="form-ctrl-label">              <input                type="radio"                name="hasBandwidthLimit"                class="tc-15-radio"                value="2"                b-model="hasBandwidthLimit"              />无上限            </label>          </p>          <!-- 带宽包模式下，允许无上限 -->          <div b-if="hasBandwidthLimit == 1">            <div style="display: inline-block">              <slider-range                b-model="bandWidth"                max="{{maxBandWidth}}"                min="{{1}}"                step="{{1}}"                value="{{1}}"                section="{{[{value: maxBandWidth * 0.05, offset: 0.33}, {value: maxBandWidth * 0.2, offset: 0.66}]}}"              ></slider-range>            </div>            <span>Mbps</span>            <p b-if="eipType == 2" class="form-input-help">              各地域均按此上限限速，不是总速度，出入均生效            </p>          </div>        </div>      </li>      <li>        <div class="form-label"><label for="">数量</label></div>        <div class="form-input cont-numselect">          <div class="form-unit">            <qc-number-step              min="1"              init-val="1"              limit-max="{{true}}"              max="{{(quotaData.quotaLimit - quotaData.quotaCurrent) || \'1\'}}"              unit=""              b-model="eipNum"            ></qc-number-step>            <p class="form-input-help" id="quotaDesc">              最多可开通 {{ quotaData.quotaLimit }}个弹性公网IP，已开通              {{ quotaData.quotaCurrent }}个            </p>          </div>        </div>      </li>      <li b-if="payMode===\'BANDWIDTH_PREPAID_BY_MONTH\'">        <div class="form-label"><label for="">购买时长</label></div>        <div class="form-input">          <qc-segment list="{{timeList}}" b-model="periodSelected"></qc-segment>        </div>      </li>      <li b-if="payMode===\'BANDWIDTH_PREPAID_BY_MONTH\'">        <div class="form-label"><label for="">自动续费</label></div>        <div class="form-input">          <p>            <label class="orm-ctrl-label-stacked"              ><input                type="checkbox"                b-model="autoRenew"                class="mr-5"              />账户余额足够时，实例到期后按月自动续费</label            >          </p>        </div>      </li>      <li b-if="isNetworkShiftUpUser">        <div class="form-label"><label for="">费用</label></div>        <div class="form-input">          <div class="form-unit">            <p>              <span class="cost">                <strong id="price">{{ priceDesc }}</strong>                <span                  b-if="isDiscount"                  style="text-decoration: line-through; margin: 0 5px;font-size: 0.7em;color:#000"                  >{{ originalPriceDesc }}</span                >              </span>            </p>            <p              b-if="payMode ==\'TRAFFIC_POSTPAID_BY_HOUR\' || eipType == 3"              class="form-input-help"            >              每个按流量计费的弹性公网IP闲置时会收费              <strong class="text-warning">                {{ toI18nMoney(regionPrice, \'words\') }}</strong              >/小时            </p>            <p b-if="eipType == 2" class="form-input-help">              按各地域实际使用的总带宽进行结算，空置时收费              <strong>{{ toI18nMoney(regionPrice, \'words\') }}</strong              >/小时              <a                href="https://cloud.tencent.com/document/product/644/12617"                target="_blank"                >查看计费规则</a              >            </p>          </div>        </div>      </li>      <li b-if="!isNetworkShiftUpUser">        <div class="form-label required"><label for="">费用</label></div>        <div class="form-input">          <div class="form-unit is-success">            <span class="cost">              <strong class="field-regionprice">{{                toI18nMoney(regionPrice, \'words\')              }}</strong              >/小时</span            >            <p class="form-input-help">空置时收费，绑定资源后不收费</p>          </div>        </div>      </li>    </ul>  </div>'},l=h.payMode.prepaid,m=h.payMode.traffic,n=h.payMode.hour,o=h.payMode["package"],p=a("./common/config"),q=[{label:"按流量",value:m,$checked:!0},{label:"包月带宽",value:l},{label:"按小时带宽",value:n}],r=[{label:"按95削峰方式后付费月结",value:o,$checked:!0}],s=[{label:"按95削峰方式后付费月结",value:o,$checked:!0}];c.exports={exec:function(b){var c=this;c.isI18n=f.isI18n(),b=b||{};var g=b.regionId||f.getRegionId();c.isNetworkShiftUpUser=b.isNetworkShiftUpUser,j.queryWhiteList({whiteKey:["anycast_eip","vpc_zone","singleisp"]},function(a){var b=Boolean(a.anycast_eip&&a.anycast_eip.length),d=Boolean(a.vpc_zone&&a.vpc_zone.length),e=Boolean(a.singleisp&&a.singleisp.length);c.isAnycastUser=b,c.isZoneUser=d,c.isSingleIspUser=e,c.dialogContent&&c.dialogContent.$set({isAnycastUser:b,isZoneUser:d,isSingleIspUser:e})},function(a){c.isAnycastUser=!1,c.isZoneUser=!1}),Promise.all([h.getRegionList(),h.getEipQuota({regionId:g},{camTipsType:"dialog"})]).then(function(b){var f={};b[0].map(function(a){f[a.value]={label:a.name}});var j=b[1].response.quotaSet[0],l=h.timeData.map(function(a,b){return{label:a.name,value:a.value,ico:a.ico,iconVal:a.iconVal,$checked:0==b}});Bee.tag("help-tips",e),Bee.tag("isp-selector",i),c.dialogContent=new Bee({$tpl:k.main,toI18nMoney:a("widget/i18n").toI18nMoney,$afterInit:function(){this.$watch("[regionId, anycastZoneRegions, selectedIsp]",function(a){var b=this,d=_slicedToArray(a,2),e=d[0];d[1];c.getEipQuota(e),c.showPrice(),this.$set("isAnycastRegion",c.isAnycastRegion(e,this.anycastZoneRegions)),this.isAnycastRegion||"2"!=this.eipType||this.$set("eipType","1"),this.$set("isAnycastZoneARegion",c.isAnycastZoneRegion(e,this.anycastZoneRegions,"anycast_zone_a")),this.$set("isAnycastZoneBRegion",c.isAnycastZoneRegion(e,this.anycastZoneRegions,"anycast_zone_b")),this.isAnycastZoneARegion||this.$set("anycastZone","anycast_zone_b"),this.isAnycastZoneBRegion||this.$set("anycastZone","anycast_zone_a"),c.isZoneUser&&h.getZoneList(e).then(function(a){b.$set("zoneList",a),a.length&&a.find(function(a){return a.status})&&b.$set("zone",a.find(function(a){return a.status}).id)})}),c.getAnycastZoneRegions(g).then(function(a){c.dialogContent.$set("anycastZoneRegions",a),c.dialogContent.$set("anycastZoneRegionsDesc",a.map(function(a){return a.map(function(a){return a.regionName}).join(",")}))}),this.$watch("eipNum",function(a){c.showPrice()}),c.isNetworkShiftUpUser&&(this.$watch("selectedPayMode",function(a){var b=a[0].value;this.$set("payMode",b),this.$set("maxBandWidth",p.EIP_PAY_MODE[b]?p.EIP_PAY_MODE[b].maxBandwidth.DEFAULT:100),c.showPrice()}),this.$watch("eipType",function(a){var b=[];switch(a){case"1":b=q;break;case"2":b=r;break;case"3":b=s}var c=b.filter(function(a){return a.$checked});this.$set({payModeList:b,selectedPayMode:c})}),this.$watch("periodSelected",function(a){this.$set({period:a[0].value}),c.showPrice()}),this.$watch("bandWidth",function(a){c.showPrice()}),this.$watch("hasBandwidthLimit",function(a){"2"==String(a)&&this.$set("bandWidth",65535)}))},$data:{quotaData:j,regionId:g,regionSelectorData:f,regionPrice:h.regionPrice[g].price,eipType:"1",payMode:m,payModeList:q,maxBandWidth:p.EIP_PAY_MODE.TRAFFIC_POSTPAID_BY_HOUR.maxBandwidth.DEFAULT,bandWidth:1,priceDesc:"正在查询",isDiscount:!1,timeList:l,isNetworkShiftUpUser:c.isNetworkShiftUpUser,isAnycastUser:c.isAnycastUser,anycastZoneRegions:[[],[]],isAnycastRegion:!1,anycastZone:"anycast_zone_a",isAnycastZoneARegion:!1,isAnycastZoneBRegion:!1,isZoneUser:c.isZoneUser,isSingleIspUser:c.isSingleIspUser,selectedIsp:null,zoneList:[],autoRenew:!0}}),c.showPrice(),d.create(c.dialogContent.$el,580,"",{title:"申请弹性公网IP",button:{" 确定 ":function(){c.submit()}}})})},submit:function(){var a=this,b=a.dialogContent,c=b.payMode,e=b.regionId,i=b.period,j=b.bandWidth,k=b.eipNum,m="2"==b.eipType?"AnycastEIP":"EIP",n=b.anycastZone,p=Boolean(b.autoRenew);if(a.checkIfQuotaNumber(k)&&("3"!=b.eipType||b.selectedIsp)){if(c&&c==l)return void h.toPay2(h.getPrepaidParams({regionId:e,number:k,payMode:c,bandwidth:j,period:i,autoRenewFlag:p?1:2}));var q={AddressCount:k,InternetMaxBandwidthOut:j,AddressType:m};a.isNetworkShiftUpUser?q.InternetChargeType=c:q.InternetChargeType=o,"AnycastEIP"==m?q.AnycastZone=n:a.isZoneUser&&(q.zone=a.dialogContent.zone,a.isSingleIspUser&&"3"==b.eipType&&(q.internetServiceProvider=a.dialogContent.selectedIsp)),h.createEip({data:q,regionId:e},{camTipsType:"dialog"}).then(function(a){d.hide(),g.success("申请中"),f.setRegionId(e),h.checkTask({taskId:a.response.taskId})})}},getEipQuota:function(a){var b=this;h.getEipQuota({regionId:a},{camTipsType:"dialog"}).then(function(a){var c=a.response.quotaSet[0];b.dialogContent.$set("quotaData",c)})},getRegionPrice:function(a){var b=this;b.dialogContent.$set("regionPrice",h.regionPrice[a].price)},showPrice:function(a){var b=this,c=b.isI18n;if(b.dialogContent){var d=parseInt(b.dialogContent.eipNum||1,10);if(0==d)return void b.createEipBee.$set("priceDesc",0+(c?"美元":"元"));if(b.isNetworkShiftUpUser){var e=function(){b.dialogContent.$set("priceDesc","查询失败")},f=b.dialogContent.payMode,g=b.dialogContent.bandWidth,i=b.dialogContent.regionId,j={AddressCount:d,InternetChargeType:f,InternetMaxBandwidthOut:g,AddressType:"2"==b.dialogContent.eipType?"AnycastEIP":"EIP",AddressChargePrepaid:f===l?{Period:b.dialogContent.period}:void 0};(a||f!=m)&&b.dialogContent.$set("priceDesc","正在查询"),"2"==b.dialogContent.eipType&&(j.AnycastZone=b.dialogContent.anycastZone),"3"==b.dialogContent.eipType&&(j.InternetServiceProvider=b.dialogContent.selectedIsp||"CMCC"),b.dialogContent.$set("isDiscount",!1),h.queryCreateEipPrice({param:j,regionId:i},{camTipsType:"dialog"}).then(function(a){if(a=a.response&&a.response.price,!a||!a.addressPrice||f!=b.dialogContent.payMode)return void e();var d,g="",i=a.addressPrice;if(f==l){var j=i.originalPrice,k=i.discountPrice,m=j>k;d=m?k:j,m&&b.dialogContent.$set("originalPriceDesc",j+(c?"美元":"元")),b.dialogContent.$set("isDiscount",m)}else d=i.unitPrice;return void 0==d?void b.dialogContent.$set("priceDesc","查询失败"):(g=d.toFixed(2)+h.unitDescMap[f],void b.dialogContent.$set("priceDesc",g))},e)}else{var i=b.dialogContent.regionId,k=(h.regionPrice[i].price*d).toFixed(2);b.dialogContent.$set("regionPrice",k)}}},checkIfQuotaNumber:function(a){var b=this,c=b.dialogContent.$get("quotaData");return a=isNaN(a)?0:parseInt(a,10),0>=a?(c.quotaLimit<=c.quotaCurrent?g.error("该地域开通数量已达上限，如需更多，请提交工单申请"):g.error("数量不能为0"),!1):!0},isAnycastRegion:function(a,b){return b.map(function(b){return b.find(function(b){return b.regionId==a})}).some(function(a){return a})},isAnycastZoneRegion:function(a,b,c){return"anycast_zone_a"==c?Boolean(b[0].find(function(b){return b.regionId==a})):Boolean(b[1].find(function(b){return b.regionId==a}))},getAnycastZoneRegions:function(a){return h.getAllAnycastRegionList(a)}}}),define("cvm/eip2/data",function(a,b,c){var d=a("appUtil"),e=a("cvm/common/model"),f=a("manager"),g=a("constants"),h=a("config/regionconfig"),i={};for(var j in h.data)i[h.data[j].id]=j;var k,e=a("cvm/common/model"),l=a("cvm/cvm/event/operate_base"),m=new l,n=a("util"),o=a("tips"),p=(a("dialog"),a("cvm/cvm/data"),a("widget/i18n"),a("./common/config")),q=a("./common/util"),r=a("models/iaas");c.exports={getNetworkInterfaces:function(a){return a=a||{},e.apiDelegate({action:"DescribeNetworkInterfaces",serviceType:"vpc",data:a,regionId:a.regionId||d.getRegionId()},{camTipsType:"dialog"})},getNetworkInterfaces2:function(a){return new Promise(function(b,c){e.apiRequest({action:"DescribeNetworkInterfaces",serviceType:"vpc",data:a.data,regionId:a.regionId||d.getRegionId()}).then(function(a){b(a)})["catch"](function(a){c(a.message)})})},getEipQuota:function(a,b){return new Promise(function(c,d){e.apiRequest({action:"DescribeAddressQuota",serviceType:"vpc",data:{},regionId:a.regionId},b).then(function(a){c(a)})["catch"](function(a){d(a.message)})})},createEip:function(a,b){return new Promise(function(c,f){e.apiRequest({action:"AllocateAddresses",serviceType:"vpc",data:a.data,regionId:a.regionId||d.getRegionId()},b).then(function(a){c(a)})["catch"](function(a){f(a.message)})})},bindEip:function(a,b){return new Promise(function(c,f){e.apiRequest({action:"AssociateAddress",serviceType:"vpc",data:a.data,regionId:a.regionId||d.getRegionId()},b).then(function(a){c(a)})["catch"](function(a){"InvalidInstanceId.NotSupported"==a.code&&f(a.code),f(a.message)})})},unbindEip:function(a,b){return new Promise(function(c,f){e.apiRequest({action:"DisassociateAddress",serviceType:"vpc",data:{AddressId:a.id,ReallocateNormalPublicIp:!!a.reallocAddress},regionId:a.regionId||d.getRegionId()},b).then(function(a){c(a)})["catch"](function(a){f(a.message)})})},releaseEip:function(a,b){return new Promise(function(c,f){e.apiRequest({action:"ReleaseAddresses",serviceType:"vpc",data:{AddressIds:a.ids},regionId:a.regionId||d.getRegionId()},b).then(function(a){c(a)})})},returnEip:function(a,b){return new Promise(function(c,f){e.apiRequest({action:"ReleaseAddresses",serviceType:"vpc",data:{AddressIds:a.ids},regionId:a.regionId||d.getRegionId()},b).then(function(a){c(a)})["catch"](function(a){f(a.message)})})},wipToEip:function(a,b){return new Promise(function(c,f){e.apiRequest({action:"TransformAddress",serviceType:"vpc",data:{instanceId:a.unInstanceId},regionId:a.regionId||d.getRegionId()},b).then(function(a){c(a)})})},modifyEip:function(a,b){return new Promise(function(c,f){e.apiRequest({action:"ModifyAddressAttribute",serviceType:"vpc",data:{AddressId:a.id,AddressName:a.name,EipDirectConnection:a.directConnect},regionId:a.regionId||d.getRegionId()},b).then(function(a){c(a)})["catch"](function(a){f(a.message)})})},returnWanIp:function(a,b){return new Promise(function(c,f){e.apiRequest({action:"ReturnNormalAddresses",serviceType:"vpc",data:{AddressIps:a.ips},regionId:a.regionId||d.getRegionId()},b).then(function(a){c(a)})})},upgradeBandwidth:function(a,b){return new Promise(function(c,f){e.apiRequest({action:"ModifyAddressesBandwidth",serviceType:"vpc",data:{AddressIds:a.ids,InternetMaxBandwidthOut:a.bandwidth},regionId:a.regionId||d.getRegionId()},b).then(function(a){c(a)})["catch"](function(a){f(a.message)})})},checkIfCanAllocWanIp:function(a,b,c){var e=this,f=a.regionId||b.regionId||d.regionId;return new Promise(function(d,g){if(void 0!==a.canAllocWanIp)d(a.canAllocWanIp);else if(void 0!==b.canAllocWanIp)d(b.canAllocWanIp);else if(c)a.canAllocWanIp=!1,b.canAllocWanIp=!1,d(!1);else if(a.bindResource&&a.bindResource.isVpc&&b.unVpcId){var h=function(b){if(!b.length)return!1;var c=!1;return b.forEach(function(b){a.networkInterfaceId==b.networkInterfaceId&&b.primary&&b.privateIpAddressesSet.forEach(function(b){b.primary&&b.wanIp==a.eip&&(c=!0)})}),c};Promise.all([e.getNetworkInterfaces({instanceId:eipItem.instanceId,regionId:f}),e.getEipQuota({regionId:f})]).then(function(b){var c=b[0]&&b[0].data,e=b[1]&&b[1].response;if(c&&e&&e.quotaSet[2]){if(e.quotaSet[2].quotaCurrent<e.quotaSet[2].quotaLimit){var f=c.data||[];a.canAllocWanIp=h(f)}else a.canAllocWanIp=!1;d(a.canAllocWanIp)}d(!1)})}else a.canAllocWanIp=!0,b.canAllocWanIp=!0,d(!0)})},getRegionList:function(){var a=g.REGIONNAMES;return new Promise(function(b,c){k&&setTimeout(function(){b(k)},0),f.queryRegion(function(c){var e=d.getRegionOrderHackObj(c),f=[];$.each(e,function(b,c){var d=b.replace("_","");f.push({value:d,name:a[d]})}),k=f,b(k)},function(){})})},getZoneList:function(a){return new Promise(function(b,c){f.queryZone(a,function(a){b(a.map(function(a){return a.id=g.ZONEIDMAP[a.zoneId],a}))},function(a){c(a)})})},getAllAnycastRegionList:function(a){return Promise.all([this.getAnycastRegionList(a,"anycast_zone_a"),this.getAnycastRegionList(a,"anycast_zone_b")])},getAnycastRegionList:function(a,b){function c(a){if(Number(a))return a;var b=Object.keys(h.data).find(function(b){return h.data[b].id==a});return b||null}var d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return e.apiRequest({action:"DescribeAnycastRegionV3",serviceType:"eip",data:{anycastZone:b}},Object.assign({v3:!0},d)).then(function(a){return a.response.regionSet.map(function(a){return a.regionId=c(a.region),a})})},getPrepaidParams:function(a){var b=[{type:"ip_with_network",goodsNum:a.number||1,regionId:+a.regionId||d.getRegionId(),payMode:1,uin:n.getUin(),ownerUin:n.getOwnerUin(),appId:d.getAppId(),goodsCategoryId:100212,goodsDetail:{timeUnit:"m",timeSpan:a.period,bandwidth:a.bandwidth||1,chargeType:a.payMode,autoRenewFlag:a.autoRenewFlag,pid:11392,launchSource:"cvmPage",purchaseSource:"MC",productInfo:[{name:"地域",value:g.REGIONNAMES[a.regionId]},{name:"计费模式",value:p.EIP_PAY_MODE[a.payMode]?p.EIP_PAY_MODE[a.payMode].desc:"-"},{name:"带宽上限",value:a.bandwidth+" Mbps"},{name:"购买时长",value:a.period+"个月"},{name:"购买数量",value:a.number}]}}];return b},getIspList:function(a){return r.apiRequest({serviceType:"vpc",cmd:"DescribeSingleIspRegion",regionId:a},{v3:!0}).then(function(a){return a.response})},formatList:function(a,b){function c(a){if(!a.createdTime)return null;var b={};return b.createdDesc=d.formatDate(new Date(a.createdTime),"yyyy-MM-dd hh:mm:ss"),b.deadline=a.deadlineDate?d.formatDate(new Date(a.deadlineDate),"yyyy-MM-dd hh:mm:ss"):null,b.deadlineDesc=a.deadlineDate?d.formatDate(new Date(a.deadlineDate),"yyyy-MM-dd"):null,b.countDownDesc=q.getCountDownDesc(a.deadlineDate),b}function e(a){if(!a.addressStatus)return null;var b=p.EIP_STATUS_MAP,c=Object.assign({},b[a.addressStatus]);return"UNBIND"==a.addressStatus&&"BANDWIDTH_PREPAID_BY_MONTH"==a.payMode&&(c.desc="未绑定"),c}function f(a){if(!a.status)return null;var b=p.EIP_BINED_RESOURCE_MAP,c=a.instanceId?a.instanceId:a.networkInterfaceId?a.networkInterfaceId:"";if((a.status.isBind||a.status.isBindEni)&&c){var d=Object.assign({},b[c.match(/^(.*)-\w{8}$/)[1]]);return d.id=c,d.link=d.link(j)+c,d="cvm"==d.type&&a.cvm?$.extend({},d,a.cvm):d,"cvm"==d.type&&a.cvm?d=$.extend({},d,a.cvm):"nat"==d.type&&a.nat&&(d=$.extend({},d,a.nat)),"cvm"==d.type&&a.cvm&&(d=$.extend({},d,a.cvm),d.instanceStatus&&28==d.instanceStatus.runFlag&&(d.link="/cvm/recycle/cvm?instanceId="+d.id),d.isInVPC=!(!d.vpc||!d.vpc.vpcId)),d}return{}}function h(a){return a.isNetworkShiftUpUser?p.EIP_PAY_MODE[a.payMode]?p.EIP_PAY_MODE[a.payMode].desc:"-":a.status&&(a.status.isUnbind||a.status.isBindEni)?"按小时计费":a.status&&a.status.isBind?"停止计费":""}var i=this;b=b||{};var j=b.regionId||d.getRegionId();return a.forEach(function(a,d){a.isNetworkShiftUpUser=b.isNetworkShiftUpUser,a.isDirectConnectionUser=b.isDirectConnectionUser,a.index=d,a.ip=a.eip||a.addressIp,a.id=a.eipId||a.addressId,a.name=a.eipName||a.addressName,a.regionId=j,a.regionPrice=i.regionPrice[j]&&i.regionPrice[j].price,a.time=c(a),a.status=e(a),a.bindResource=f(a),a.payMode=a.payMode||a.internetChargeType,a.payModeDesc=h(a),a.addressTypeDesc=p.EIP_ADDRESS_TYPE_MAP[a.addressType]||"-",a.anycastZoneDesc=i.anycastZoneDesc[a.anycastZone],a.zoneDesc=g.ZONEIDV3TONAMEMAP[a.zone]||"-",a.isAnycastIP="AnycastEIP"==a.addressType,a.internetServiceProviderDesc=a.internetServiceProvider?p.EIP_ISP_TYPE[a.internetServiceProvider]||"-":"-",a.canBind=!a.isArrears&&!a.isBlocked&&a.status&&a.status.canBind,a.canUnbind=!a.isArrears&&!a.isBlocked&&a.status&&a.status.canUnbind,a.canRelease=!a.isBlocked&&a.status&&a.status.canRelease,a.isNetworkShiftUpUser&&(a.ipTypeDesc=a.isEip?"弹性公网IP":"普通公网IP",a.isPrepaid="BANDWIDTH_PREPAID_BY_MONTH"===a.payMode,a.isTraffic="TRAFFIC_POSTPAID_BY_HOUR"===a.payMode,a.isHour="BANDWIDTH_POSTPAID_BY_HOUR"===a.payMode,65535==a.bandwidth?a.bandwidthDesc="不限制":a.bandwidthDesc=a.bandwidth>=0?a.bandwidth+" Mbps":"",a.canUpgradeBandwidth=!a.isArrears&&!a.isBlocked&&a.status&&a.status.canUpgradeBandwidth),a.isDirectConnectionUser&&(a.canDirectConnect=!1,!a.isArrears&&!a.isBlocked&&a.status&&a.status.canDirectConnect?a.isEipDirectConnection?a.directConnectTip="已直通":"cvm"==a.bindResource.type&&a.bindResource.isInVPC?(a.canDirectConnect=!0,a.directConnectTip=""):a.directConnectTip="绑定私有网络的实例才能直通":(a.canDirectConnect=!1,a.directConnectTip=a.status&&a.status.tip))}),a},getEipList:function(a,b){return new Promise(function(c,f){a=a||{};var g={limit:a.limit||20,offset:a.offset||0,filters:a.filters||[]},h=a.query||"query eips($filters:[Filter], $limit:Int, $offset: Int){\n                 eips(filters:$filters, limit: $limit, offset: $offset){\n                    totalCount\n                    nodes {\n                        addressId:id\n                        addressName:name\n                        addressIp\n                        addressStatus\n                        addressType\n                        anycastZone\n                        zone\n                        instanceId\n                        networkInterfaceId\n                        privateAddressIp\n                        isArrears\n                        isBlocked\n                        createdTime\n                        isEip\n                        payMode\n                        bandwidth\n                        deadlineDate\n                        updatedTime\n                        isEipDirectConnection\n                        internetServiceProvider\n                        cvm {\n                          id\n                          name\n                          cpu\n                          memory\n                          instanceChargeType\n                          instanceStatus {\n                            instanceState\n                            runFlag\n                          }\n                          osName\n                          vpc{\n                            vpcId: id\n                            vpcName: name\n                          }\n                        }\n                        nat {\n                          id,\n                          name\n                        }\n                    }\n                }\n            }";if(b&&b.withoutDefaultFilter);else{var i={
name:"is-arrears",values:["FALSE"]},j=g.filters.find(function(a){return a.name==i.name});j||g.filters.push(i)}e.graphql({query:h,variables:g,regionId:a.regionId||d.getRegionId()},b).then(function(a){c(a)})})},queryEip:function(a,b){return new Promise(function(c,f){e.apiRequest({action:"DescribeAddresses",serviceType:"vpc",data:a.data,regionId:a.regionId||d.getRegionId()},b).then(function(a){c(a)})})},queryCreateEipPrice:function(a,b){return new Promise(function(c,f){e.apiRequest({action:"InquiryPriceAllocateAddresses",serviceType:"vpc",data:a.param,regionId:a.regionId||d.getRegionId()},b).then(function(a){c(a)})})},queryUpgradeEipBandwidthPrice:function(a,b){return new Promise(function(c,f){e.apiRequest({action:"InquiryPriceModifyAddressesBandwidth",serviceType:"vpc",data:{AddressIds:a.ids,InternetMaxBandwidthOut:a.bandwidth},regionId:a.regionId||d.getRegionId()},b).then(function(a){c(a)},function(a){f(a)})})},queryRenewEipPrice:function(a,b){return new Promise(function(c,f){e.apiRequest({action:"InquiryPriceRenewAddresses",serviceType:"vpc",data:{AddressIds:a.ids,AddressChargePrepaid:{Period:a.time}},regionId:a.regionId||d.getRegionId()},b).then(function(a){c(a)})})},queryHangingEipPrice:function(a){return new Promise(function(b,c){e.apiDelegate({action:"InquiryPriceVacancyAddresses",serviceType:"eip",regionId:a||d.getRegionId()},{v3:!0}).then(function(a){return a.response.price.addressPrice})})},getEipNumber:function(){return e.apiRequest({action:"DescribeEipStatistics",serviceType:"vpc"},{v3:!0}).then(function(a){return a.response.eipStatisticsSet.map(function(a){return a.regionNumberId=i[a.region],a})})},toPay2:function(a){m.toPay2(a)},getAnalyseValue:function(a){var b=/^eip-\w{8}$/,c=null;return a&&(c={},a=a.trim(),d.isValidIp(a)?c.vagueIp=a:b.test(a)?c.id=a:c.name=a),c},checkTask:function(a,b,c){var d=this,f=a.taskId;return new Promise(function(a,b){function c(f){e.apiRequest({action:"DescribeTaskResult",serviceType:"vpc",data:{taskId:f}},{v3:!0}).then(function(e){var g=e.response.result;switch(g){case"SUCCESS":d.refreshList(),a(e);break;case"FAILED":o.error("操作执行失败！"),d.refreshList(),b(e);break;case"RUNNING":d.timeOut=setTimeout(function(){c(f)},3e3)}})}f&&c(f),setTimeout(function(){d.refreshList()},50)})},clearCheckTask:function(){clearTimeout(this.timeOut)},refreshList:function(){var a=this;a.eipListThis&&(a.eipListThis.renderList(),a.eipListThis.updateEipRegionNumber())},UNLIMITED_BANDWIDTH:65535,unitDescMap:function(){var a=d.isI18n(),b=a?"美元":"元";return{BANDWIDTH_PREPAID_BY_MONTH:b,TRAFFIC_POSTPAID_BY_HOUR:b+"/GB",BANDWIDTH_POSTPAID_BY_HOUR:b+"/小时",BANDWIDTH_PACKAGE:b+"/Mbps/月"}}(),payMode:{prepaid:"BANDWIDTH_PREPAID_BY_MONTH",hour:"BANDWIDTH_POSTPAID_BY_HOUR",traffic:"TRAFFIC_POSTPAID_BY_HOUR","package":"BANDWIDTH_PACKAGE"},regionPrice:p.EIP_REGION_PRICE,operateCVMRunflag:[1,2,4,6,7,8,9,11,13,14,17,18,37],timeData:p.EIP_RENEWAL_TIME_OPTIONS,anycastZoneDesc:p.ANYCAST_ZONE_DESC,describeBandwidthAttribute:function(){return e.apiRequest({action:"DescribeBandwidthAttribute",serviceType:"vpc"},{v3:!0}).then(function(a){var b=a.response.bandwidthAttribute;return b})["catch"](function(a){return p.EIP_BANDWIDTH_QUOTA_CONFIG})}}}),define("cvm/eip2/directConnectEip",function(a,b,c){var d=a("dialog"),e=a("util"),f=a("tips"),g=a("./data"),h=a("cvm/eip2/common/util");c.exports={exec:function(a){d.create(e.tmpl('  <div class="tip_box" id="eip-connect">    <style>      #eip-connect ul li {        padding: 4px 0;        list-style-type: disc;        margin-left: 20px;      }    </style>    <p>执行直通后会导致网络中断，需私有网络内配置路由恢复网络连接：</p>    <ul class="swapnotes">      <li>主网卡可通过脚本进行网络配置，配置脚本可在        <a href="//www.qcloud.com/document/product/215/12539" target="_blank">弹性公网IP直通步骤          <i class="external-link-icon"></i>        </a> 中下载。</li>      <li>非主网卡可参考脚本进行配置。</li>      <li>目前脚本仅支持OS为Windows、Ubuntu或CentOs 6以上版本的实例。</li>    </ul>    <p class="text-danger">注意：网络中断后无法下载，需要在直通前下载并上传到实例内</p>  </div>'),600,"",{title:"弹性公网IP直通",button:{" 确定 ":function(){h.getConfirm({title:"弹性公网IP直通",content:"请确认弹性公网IP："+a.ip+' 的直通操作。<br>直通后网络将会中断，需要对路由进行配置以恢复网络连接，详情请参考<a href="//www.qcloud.com/document/product/215/12539" target="_blank">弹性公网IP直通步骤 <i class="external-link-icon"></i></a><br>直通后，您的服务可能会受到影响，请提前做好准备！'},function(){g.modifyEip({id:a.id,directConnect:"TRUE"},{camTipsType:"dialog"}).then(function(a){d.hide(),f.success("直通中..."),g.checkTask({taskId:a.response.taskId},"直通中")})})}}})}}}),define("cvm/eip2/eip",function(a,b,c){var d=a("$"),e=a("pageManager"),f=a("manager"),g=a("constants"),h=a("util"),i=a("appUtil"),j=(a("widget/region/region2"),a("search"),a("panel"),a("widget/pills/pills")),k=(a("pagination"),a("tips")),l=(a("dialog"),a("event")),m=a("router"),n=a("widget/errorTips/errorTips"),o=a("widget/fieldsManager/gridView"),p=a("widget/validator/validatorV2"),q=a("qccomponent"),r=a("widget/popover/popConfirm"),s=a("./data"),t=(a("cvm/cvm/data"),a("./createEip")),u=a("./releaseEip"),v=a("./unbindEip"),w=a("./bindEip"),x=a("lib/monitor-sdk-importer"),y=a("./monitorConfig"),z=a("./upgradeBandwidth"),A=a("cvm/recycle/eip/renew_eip"),B=a("./directConnectEip"),C=a("cvm/eip2/common/config"),D={main:'  <div class="manage-area">    <style>      .eip-oper-cell a.disabled,      .eip-oper-cell a.disabled:hover {        color: #999;        cursor: default;      }      .eip-oper-cell a.disabled:hover {        text-decoration: none;      }      /* .netword-ip .cvm-area-wrap {        margin: 0 20px 16px;      } */    </style>    <div class="manage-area-title">      <h2>弹性公网IP</h2>      <div class="manage-area-title-right">        <a          href="https://cloud.tencent.com/document/product/213/5733"          target="_blank"        >          <b class="links-icon"></b>弹性公网IP帮助文档</a        >      </div>    </div>    <div class="manage-area-main">      <div class="manage-area-full-inner">        <!-- <p class="tc-15-msg elastic-network-msg" style="margin-bottom: 15px;">          弹性公网 IP（Elastic IP）是专为动态云计算设计的静态 IP 地址，在 腾讯云          系统中 EIP 地址与您的账户而非特定的资源（CVM实例）关联。 <br />          弹性公网IP 地址同时适用于 基础网络 和 私有网络 的 CVM          实例，随时可以解绑、再分配到其他 CVM 实例，从而快速切换屏蔽实例故障。          <br />        </p> -->        <div class="cvm-area-wrap" role="radiogroup" id="regionWrapper"></div>        <div class="tc-15-action-panel">          <button data-event="createEip" class="tc-15-btn m mr10">申请</button>          <button            class="tc-15-btn weak m download"            data-event="exportEip"            title="下载"          ></button>          <button            class="tc-15-btn weak m setting"            data-grid-setting            title="设置列表显示字段"          ></button>          <span id="eip-search"></span>          <!--            <qc-search              id="qcSearch"              placeholder="请输入ID、名称或IP地址"            ></qc-search>          -->        </div>        <div class="elastic-network-wrap" id="eipList"></div>      </div>    </div>  </div>',editEipName:'  <div>    <input      name="eipName"      type="text"      class="input-txt"      b-model="eipName"      maxlength="{{ maxLength }}"    />    <p class="ash" style="white-space: normal">      还能输入{{        maxLength - eipName.length      }}个字符，英文、汉字、数字、连接线"-"或下划线"_"    </p>  </div>',idName:'  <div>    <div>{{ item.id }}</div>    <div>      <span class="text-overflow m-width" title="{{ item.name || \'未命名\' }}">{{        item.name || \'未命名\'      }}</span>      <i        data-event="editEipName"        class="pencil-icon hover-icon"        style="cursor:pointer"      ></i>    </div>  </div>',ip:"  <div>    <span> {{ item.ip || '-' }} </span>  </div>",monitor:'  <a    class="icon-monitor"    data-operate="checkMonitor"    style="vertical-align: top"  ></a>',status:'  <span class="{{ item.status.className }}" style="vertical-align: middle">    {{ item.status.desc }}    <i      b-if="item.isBlocked"      class="icon-alarm"      qc-popover=" 此IP关联实例由于有安全风险外网已被隔离，请尽快处理安全风险，解除风险后<a data-event=\'nav\' href=\'//console.qcloud.com/workorder/category?level1_id=6&level2_id=7&source=0&data_title=实例%20CVM&step=1\'>提交工单</a>给我们确认执行结果。"      qc-popover-style="width:350px;"    ></i>  </span>',payMode:'  <div b-if="item.isNetworkShiftUpUser">    <div>      {{ item.payModeDesc || \'-\' }}      <i        b-if="item.isTraffic && item.addressStatus ===\'UNBIND\'"        class="plaint-icon"        data-title="未绑定云资源的按流量计费弹性公网IP将按小时收取闲置费用<span style=\'color:#ff7800\'>{{          item.regionPrice        }}</span>元/小时"      ></i>      <i        b-if="item.isTraffic && item.addressStatus ===\'BIND_ENI\'"        class="plaint-icon"        data-title="弹性网卡未绑定实例时，该网卡上绑定的弹性公网IP收取闲置费用<span style=\'color:#ff7800\'>{{          item.regionPrice        }}</span>元/小时"      ></i>    </div>    <div b-if="item.isPrepaid && item.time.deadlineDesc">      <span class="text-overflow m-width"        >{{ item.time.deadlineDesc }} 到期</span      >    </div>  </div>  <div b-if="!item.isNetworkShiftUpUser">    <span      class="{{        item.status.isBindEni ? \'text-danger\' : item.status.className      }}"      >{{ item.payModeDesc || \'-\' }}</span    >    <i      b-if="item.status && item.status.isBindEni"      class="plaint-icon"      data-title="弹性网卡未绑定实例时，该网卡上绑定的弹性公网IP收取闲置费用<span style=\'color:#ff7800\'>{{        item.regionPrice      }}</span>元/小时"    ></i>  </div>',bindId:'  <div>    <span b-if="!item.bindResource.id">-</span>    <a      b-if="item.bindResource.id"      data-event="nav"      href="{{ item.bindResource.link }}"      >{{ item.bindResource.id || \'-\' }}</a    >    <div      b-if="item.bindResource.type == \'cvm\' || item.bindResource.type == \'nat\' && item.bindResource.name"    >      <span        class="text-overflow m-width"        title="{{ item.bindResource.name }}"        >{{ item.bindResource.name }}</span      >    </div>  </div>',bindType:"  {{ item.bindResource.typeDesc || '-' }}",operate:'  <!-- 带宽上移操作列表 -->  <div b-if="item.isNetworkShiftUpUser" class="eip-oper-cell">    <a      class="{{ item.canUpgradeBandwidth ? \'\' : \'disabled\' }}"      href="javascript:;"      data-operate="upgradeBandwidth"      data-title="{{ item.canUpgradeBandwidth ? \'\' : item.status.tip }}"      >调整带宽</a    >    <div class="tc-15-dropdown tc-15-menu-disabled">      <a        href="javascript:;"        class="tc-15-dropdown-link tc-15-dropdown-link-special"        >更多 <i class="caret"></i>      </a>    </div>    <div      class="tc-15-dropdown tc-15-menu-active {{        item.isMoreListUp ? \'tc-15-dropup\' : \'\'      }}"      style="display: none;"    >      <a        href="javascript:"        class="tc-15-dropdown-link tc-15-dropdown-link-special"        >更多 <i class="caret"></i>      </a>      <div class="tc-15-dropdown-menu-box">        <ul class="tc-15-dropdown-menu" role="menu">          <li>            <a              b-if="item.canUnbind"              class="{{ item.canUnbind ? \'\' : \'disabled\' }}"              href="javascript:;"              data-operate="unbindEip"              data-title="{{ item.canUnbind ? \'\' : item.status.tip }}"              >解绑</a            >          </li>          <li>            <a              b-if="item.canBind"              class="{{ item.canBind ? \'\' : \'disable\' }}"              href="javascript:void(0);"              data-operate="bindEip"              data-title="{{ item.canBind ? \'\' : item.status.tip }}"              >绑定</a            >          </li>          <li b-if="!item.isPrepaid">            <a              b-if="item.canRelease"              class="{{ item.canRelease ? \'\' : \'disable\' }}"              href="javascript:void(0);"              data-operate="releaseEip"              data-title="{{ item.canRelease ? \'\' : item.status.tip }}"              >释放</a            >          </li>          <li b-if="item.isPrepaid">            <a href="javascript:void(0);" data-operate="renewEip">续费</a>          </li>          <li>            <a              b-if="item.isDirectConnectionUser"              class="{{ item.canDirectConnect ? \'\' : \'disable\' }}"              href="javascript:void(0);"              data-operate="directConnectEip"              data-title="{{                item.canDirectConnect ? \'\' : item.directConnectTip              }}"              >直通</a            >          </li>        </ul>      </div>    </div>  </div>  <!-- 默认操作列表 -->  <div b-if="!item.isNetworkShiftUpUser" class="eip-oper-cell">    <a      b-if="item.canBind"      class="{{ item.canBind ? \'\' : \'disable\' }}"      href="javascript:void(0);"      data-operate="bindEip"      data-title="{{ item.canBind ? \'\' : item.status.tip }}"      >绑定</a    >    <a      b-if="item.canUnbind"      class="{{ item.canUnbind ? \'\' : \'disabled\' }}"      href="javascript:void(0);"      data-operate="unbindEip"      data-title="{{ item.canUnbind ? \'\' : item.status.tip }}"      >解绑</a    >    <a      b-if="item.canRelease"      class="{{ item.canRelease ? \'\' : \'disable\' }}"      href="javascript:void(0);"      data-operate="releaseEip"      data-title="{{ item.canRelease ? \'\' : item.status.tip }}"      >释放</a    >    <a      b-if="item.isDirectConnectionUser"      class="{{ item.canDirectConnect ? \'\' : \'disable\' }}"      href="javascript:void(0);"      data-operate="directConnectEip"      data-title="{{ item.canDirectConnect ? \'\' : item.directConnectTip }}"      >直通</a    >  </div>',createTime:"  {{ item.time.createdDesc || '-' }}",anycastZone:"  <div>    <div      data-title=\"{{        item.addressType == 'AnycastEIP'          ? item.anycastZone == 'ANYCAST_ZONE_A'            ? anycastZoneRegions[0]            : anycastZoneRegions[1]          : ''      }}\"    >      {{ item.addressType == 'AnycastEIP' ? item.anycastZoneDesc : '-' }}    </div>  </div>"},E=a("cvm/common/components/SmartHelper");c.exports={_render:function(a){i.isI18n()||E.show();var b=this;s.eipListThis=this,b.maxFreshCount=100,b.$appArea=e.appArea,b.$appArea.html(D.main);var c=q.components["qc-search"];b.qcSearch=new c({$data:{placeholder:"请输入ID、名称或IP地址"},$el:document.getElementById("eip-search"),search:function(a){b.renderList({page:1})}}),b.regionWrapperEl=d("#regionWrapper"),b.$listEl=b.$appArea.find("#eipList"),b.regionId=i.getRegionId(),f.queryRegion(function(a){for(var c=[],d=g.REGIONORDER,e=g.REGIONNAMES,f=0;f<d.length;f++){var h=d[f];a[h]&&c.push({name:e[h],value:h})}b.regionSelector=new j({renderTo:b.regionWrapperEl,data:c,newMode:!0,change:function(d){var e=b.regionSelector.val();a[e]||(e=c[0].value),i.setRegionId(e),b.regionId=e,b.isZoneUser?s.getZoneList(e).then(function(a){b.updateListHeadZone(a),b.renderList({regionId:b.regionId})}):b.renderList({regionId:b.regionId})}}),b.regionSelector.val(b.regionId),b.updateEipRegionNumber()}),b.initGridView(),b.bindEvents(),b.renderList(a)},updateEipRegionNumber:function(){var a=this;s.getEipNumber().then(function(b){var c=a.regionSelector.options.data;c=c.map(function(a){return a.regionName?a:(a.regionName=a.name,a)}),a.regionSelector.setData(c.map(function(a){var c=b.find(function(b){return b.regionNumberId==a.value});return c&&c.totalCount>=0&&(a.name=a.regionName+"("+c.totalCount+")"),a}))})},initGridView:function(){var b=this,c=function(){var a={};return a.statusDesc=Object.keys(C.EIP_STATUS_MAP).map(function(a){return{label:"UNBIND"===a?"未绑定":C.EIP_STATUS_MAP[a].desc,value:a}}).filter(function(a){return"BIND_ENI"!==a.value}),a.payModeDesc=Object.keys(C.EIP_PAY_MODE).map(function(a){return{label:C.EIP_PAY_MODE[a].desc,value:a}}),a.addressTypeDesc=Object.keys(C.EIP_ADDRESS_TYPE_MAP).map(function(a){return{label:C.EIP_ADDRESS_TYPE_MAP[a],value:a}}),a}(),e={events:{"click tr .tc-15-dropdown":function(a){a.stopPropagation(),b.$listEl.find(".tc-15-menu-active").hide(),b.$listEl.find(".tc-15-menu-disabled").show(),d(a.target).closest("td").find(".tc-15-menu-active").show(),d(a.target).closest("td").find(".tc-15-menu-disabled").hide()},"click tr:not(.disable) [data-operate]":function(a){a.stopPropagation();var c=this,e=d(a.target),f=e.closest("tr"),g=c.list[f[0].$index],h=e.attr("data-operate");e.hasClass("disable")||e.hasClass("disabled")||!b[h]||b[h](g,e)}},$data:{hasFirst:!1,initGetData:!1,canResizeColum:!1,selectedHighlight:!1,list:[],colums:b.getColums(),canSelectTotal:!1,autoMaxHeight:!0,maxHeightOffset:10,autoCheckWidth:!1,showState:!0,showPagination:!0,totalNum:0,trackKey:"id",toI18nMoney:a("widget/i18n").toI18nMoney},$mixins:[o("eip2_grid_fields","#appArea [data-grid-setting]")],setTrAttr:function(a,b){a={"data-eipId":b.id,"data-eipName":b.name||""};var c={CREATING:!0,BINDING:!0,UNBINDING:!0,OFFLINING:!0};return c[b.addressStatus]&&(a["data-isLoading"]=!0),a},getData:function(a,c){b.renderList({page:a.page,count:a.count})},getHeadContent:function(a){switch(a.key){case"statusDesc":return'<grid-view-header-filter b-ref="statusFilter" b-with="{ ready: filterReady(\'address-status\').bind(this.$root),filterOptions: statusFilterOptions, col: col,change: filterchange.bind(this.$root)}"></grid-view-header-filter>';case"payModeDesc":return'<grid-view-header-filter b-ref="payModeFilter" b-with="{ ready: filterReady(\'charge-type\').bind(this.$root),filterOptions: payModeFilterOptions, col: col,change: filterchange.bind(this.$root)}"></grid-view-header-filter>';case"addressTypeDesc":return'<grid-view-header-filter b-ref="addressTypeFilter" b-with="{ ready: filterReady(\'address-type\').bind(this.$root),filterOptions: addressTypeFilterOptions, col: col,change: filterchange.bind(this.$root)}"></grid-view-header-filter>';case"zoneDesc":return'<grid-view-header-filter b-ref="zoneFilter" b-with="{ ready: filterReady(\'zone\').bind(this.$root),filterOptions: zoneOptions, col: col,change: filterchange.bind(this.$root)}"></grid-view-header-filter>'}},statusFilterOptions:c.statusDesc,payModeFilterOptions:c.payModeDesc,addressTypeFilterOptions:c.addressTypeDesc,zoneOptions:[],filterReady:function(a){return function(b){this[a]=b}},filterchange:function(){b.renderList({page:1,searchKey:b.qcSearch.getKeyword()})}},g=q.getComponent("grid-view");b.gridView=new g(e),f.queryWhiteList({whiteKey:["anycast_eip","vpc_zone","singleisp"]},function(a){var c=Boolean(a.anycast_eip&&a.anycast_eip.length),d=Boolean(a.vpc_zone&&a.vpc_zone.length),e=Boolean(a.singleisp&&a.singleisp.length);b.gridView.$set({isAnycastUser:c,isZoneUser:d,isSingleIspUser:e}),b.isAnycastUser=c,b.isZoneUser=d,b.isSingleIspUser=e,b.isZoneUser&&s.getZoneList(b.regionId).then(function(a){b.updateListHeadZone(a)}),b.gridView.$set("colums",b.getColums())},function(a){b.gridView.$set("isAnycastUser",!1),b.isAnycastUser=!1,b.gridView.$set("colums",b.getColums())}),s.getAllAnycastRegionList(b.regionId).then(function(a){b.gridView.$set("anycastZoneRegions",a.map(function(a){return a.map(function(a){return a.regionName}).join(",")}))}),this.$listEl.append(b.gridView.$el)},updateListHeadZone:function(a){var b=this.gridView.zone.$data.filterOptions;this.gridView.zone.filterResult=null,b&&b.splice.apply(b,[0,b.length].concat(a.map(function(a){return{label:a.zoneName,value:a.id}})))},getColums:function(){var a=[{name:"ID/名称",key:"id",required:!0,tdTpl:D.idName},{name:"监控",width:50,minWidth:50,key:"monitor",tdTpl:D.monitor},{name:"状态",key:"statusDesc",tdTpl:D.status},{name:"弹性IP地址",key:"ip",tdTpl:D.ip},{name:"计费模式",key:"payModeDesc",tdTpl:D.payMode},{name:"绑定资源",key:"bindResource",tdTpl:D.bindId},{name:"绑定资源类型",key:"bindResourceTypeDesc",tdTpl:D.bindType}].concat(this.isAnycastUser?[{name:"IP类型",key:"addressTypeDesc"},{name:"发布域",key:"anycastZoneDesc",tdTpl:D.anycastZone}]:[]).concat(this.isZoneUser?[{name:"可用区",key:"zoneDesc"}]:[]).concat(this.isSingleIspUser?[{name:"运营商",key:"internetServiceProviderDesc"}]:[]).concat([{name:"申请时间",key:"createdTimeDesc",tdTpl:D.createTime},{name:"操作",key:"operate",required:!0,tdTpl:D.operate}]),b=[{name:"ID/名称",key:"id",required:!0,tdTpl:D.idName},{name:"监控",width:50,minWidth:50,key:"monitor",tdTpl:D.monitor},{name:"状态",key:"statusDesc",tdTpl:D.status},{name:"IP地址",key:"ip",tdTpl:D.ip},{name:"计费模式",key:"payModeDesc",tdTpl:D.payMode},{name:"带宽",key:"bandwidthDesc"}].concat(this.isAnycastUser?[{name:"IP类型",key:"addressTypeDesc"},{name:"发布域",key:"anycastZoneDesc",tdTpl:D.anycastZone}]:[]).concat(this.isZoneUser?[{name:"可用区",key:"zoneDesc"}]:[]).concat([{name:"绑定资源",key:"bindResource",tdTpl:D.bindId},{name:"绑定资源类型",key:"bindResourceTypeDesc",tdTpl:D.bindType}]).concat(this.isSingleIspUser?[{name:"运营商",key:"internetServiceProviderDesc"}]:[]).concat([{name:"申请时间",key:"createdTimeDesc",tdTpl:D.createTime},{name:"操作",key:"operate",required:!0,tdTpl:D.operate}]);return this.isNetworkShiftUpUser?b:a},bindEvents:function(){var a=this;l.bindCommonEvent(a.$appArea.children()[0],"click",{createEip:function(){t.exec({regionId:a.regionId,isNetworkShiftUpUser:a.isNetworkShiftUpUser})},exportEip:function(){var b=d.extend(a.lastParams,{t:Date.now(),uin:h.getUin(),csrfCode:h.getACSRFToken(),regionId:i.getRegionId()});window.open("/cgi/eip?action=exportEipList&"+d.param(b))},editEipName:function(b){var c,e=d(b.target).closest("tr"),f=e.attr("data-eipId"),g=e.attr("data-eipname")||"",h=d(a.gridView.$el).find("[data-grid-body]"),i=new p({rules:{eipName:function(a){return a&&a.length>=1&&a.length<=20?!1:"请输入符合规则的名称"}}}),j=new q(D.editEipName,{$data:{eipName:g,maxLength:20}});e.offset().top+140>h.offset().top+h.height()&&(c=-140),r({content:j.$el,el:d(b.target).prev("span")[0],confirm:function(){return i.validate(this.$el.find("input")[0])?void s.modifyEip({id:f,name:j.eipName},{camTipsType:"dialog"}).then(function(b){k.success("更新成功"),a.renderList()}):!1}},{position:"none",style:{width:300,top:c}}),d(j.$el).find("input")[0].select()}}),d(document).on("click",function(){a.$listEl.find(".tc-15-menu-active").hide(),a.$listEl.find(".tc-15-menu-disabled").show()})},getQueryParam:function(a){var b=this,c=a.page>0?a.page:b.gridView.page,d=a.count>0?a.count:b.gridView.count,e=(c-1)*d,f=[],g=b.qcSearch,h=g?g.getKeyword():"";a.searchKey=h;var j=s.getAnalyseValue(h)||{};a.filters&&(f=f.concat(a.filters)),j.id&&f.push({name:"address-id",values:[j.id]}),j.name&&f.push({name:"address-name",values:[j.name]}),j.vagueIp&&f.push({name:"address-ip",values:[j.vagueIp]}),a.instanceId&&(a.searchKey=a.instanceId,f.push({name:"instance-id",values:[a.instanceId]}));var k=a.rid||a.regionId||i.getRegionId();return b.regionId=k,{searchKey:a.searchKey,page:c,count:d,limit:d,offset:e,filters:f.filter(function(a){return null!=a.values}),regionId:k}},getFilters:function(){var a=this,b=["address-status","charge-type","address-type","zone"];return b.map(function(b){var c=a.gridView[b]&&a.gridView[b].filterResult;return c&&c.indexOf("BIND")>-1&&-1===c.indexOf("BIND_ENI")&&c.push("BIND_ENI"),{name:b,values:c}}).filter(function(a){return null!=a.values})},renderList:function(a){a=a||{};var b=this;a.filters=b.getFilters();var c=a.queryParam||b.getQueryParam(a);b.lastParams=c,s.getEipList(c).then(function(a){if(a&&a.eips&&a.eips.nodes){var d=s.formatList(a.eips.nodes,{regionId:c.regionId,isNetworkShiftUpUser:!!b.isNetworkShiftUpUser,isDirectConnectionUser:!!b.isDirectConnectionUser}).map(function(a,b,c){return a.isMoreListUp=Boolean(a.index&&a.index+3>c.length),a}),e=a.eips.totalCount;b.gridView.setData({list:d,totalNum:e,page:c.page,count:c.count}),b.showTableTips(e,c.searchKey,c.filters),b.checkEipTask()}else{if(a.errors&&a.errors.length){b.gridView.setData({list:[]});for(var f=0;f<a.errors.length;f++){var g=a.errors[f];n.isCamRefused(g)?b.gridView.showTips("<div><cam-tips>"+g.message+"</cam-tips></div>"):b.gridView.showTips("<div><error-tips>"+g.message+"</error-tips></div>");break}return}b.gridView.setData({list:[]})}})},showTableTips:function(a,b,c){var e=this;a?b&&e.gridView.showTips('<span class="text">搜索<strong>"'+b+'"</strong>找到'+a+'条结果，<a data-event="eip2nav" href="javascript:void(0);">返回列表</a></span>'):b||c.some(function(a){return"is-arrears"!==a.name})?e.gridView.showTips('<span class="text">抱歉，没有找到相关弹性公网IP，请尝试其他搜索条件。<a data-event="eip2nav" href="javascript:void(0);">返回列表</a></span>'):(e.gridView.showTips('<span class="text">当前地域下弹性公网IP列表为空，您可以<a href="javascript:void(0);" data-event="createEip" id="tableCreateEip">点击申请</a>弹性公网IP</span>'),d("#tableCreateEip").unbind().click(function(){t.exec({regionId:e.regionId,isNetworkShiftUpUser:e.isNetworkShiftUpUser})})),d("[data-event=eip2nav]").unbind().click(function(){e.gridView.page=1,e.gridView.count=20,m.navigate("/cvm/eip")})},checkEipTask:function(a){var b=this,c=this.$listEl.find("tr");b.isLoading=!1,c.each(function(a,c){var e=d(c);return e.attr("data-isLoading")?(b.isLoading=!0,!1):void 0}),this.clearCheckTask(),a||b.isLoading?this.timeOut=setTimeout(function(){b.maxFreshCount&&(b.renderList({queryParam:b.lastParams}),b.maxFreshCount--)},a?200:5e3):b.setMaxFreshCount(100)},clearCheckTask:function(){clearTimeout(this.timeOut)},setMaxFreshCount:function(a){this.maxFreshCount=a},_destroy:function(){s.clearCheckTask(),this.clearCheckTask(),this.setMaxFreshCount(0),i.isI18n()||E.destroy()},releaseEip:function(a){u.exec(a)},unbindEip:function(a){v.exec(a)},upgradeBandwidth:function F(a){var b=this,F=new z({listIns:b,selectedItems:[]});F.exec(a,a.bindResource)},renewEip:function(a){A.exec([a])},bindEip:function(a){w.exec(a)},directConnectEip:function(a){B.exec(a)},checkMonitor:function(a){var b=this;x.ready().then(function(c){c.MonitorPanelBuilder.build(y.eip(b.regionId,a))})}}}),define("cvm/eip2/ispSelector",function(a,b,c){var d=a("./data"),e=a("./common/config"),f=a("qccomponent");c.exports=f.extend({$tpl:'  <select class="tc-15-select m" b-on="{change: changeIsp}">    <option b-repeat="item in ispList" value="{{item.val}}">{{      item.name    }}</option>  </select>',$valuekey:"selectedIsp",$afterInit:function(){var a=this;this.updateIspZoneMap(),this.$watch("[zoneId, ispZoneMap]",function(b){var c=_slicedToArray(b,2);c[0],c[1];a.updateIspList()}),this.$watch("[regionId]",function(b){var c=_slicedToArray(b,1);c[0];a.updateIspZoneMap()}),this.updateIspList()},updateIspZoneMap:function(){var a=this;d.getIspList(this.regionId).then(function(b){var c=b.singleIspZone,d={};c.map(function(a){d[a.zone]=a.singleisp}),a.$set("ispZoneMap",d)})},updateIspList:function(){var a=(this.ispZoneMap[this.zoneId]||[]).map(function(a){return{val:a,name:e.EIP_ISP_TYPE[a]}});a&&a.length||(a=[{val:null,name:"无可用运营商"}]),this.$set({ispList:a,selectedIsp:a[0].val})},changeIsp:function(a){this.$set("selectedIsp",a.target.value||null)}},{defaults:{ispList:[],ispZoneMap:{},selectedIsp:null}})}),define("cvm/eip2/monitorConfig",function(a,b,c){c.exports={eip:function(a,b){var c="AnycastEIP"==b.addressType?{namespace:"qce/ceip_summary",policyViewName:"AnycastEIP"}:{namespace:"qce/lb",policyViewName:"EIP"};return Object.assign(c,{regionId:a,metrics:[{metricName:"vip_inpkg",metricCname:"外网入包量",dimensions:["eip"],unit:"count/s",unitCname:"count/s"},{metricName:"vip_outpkg",metricCname:"外网出包量",dimensions:["eip"],unit:"count/s",unitCname:"count/s"},{metricName:"vip_intraffic",metricCname:"外网入带宽",dimensions:["eip"],unit:"Mbps",unitCname:"Mbps"},{metricName:"vip_outtraffic",metricCname:"外网出带宽",dimensions:["eip"],unit:"Mbps",unitCname:"Mbps"}],getData:function(a){return new Promise(function(a,c){a({instance:{eip:b.addressIp},subTitle:b.name,title:b.id})})}})}}}),define("cvm/eip2/releaseEip",function(a,b,c){var d=a("dialog"),e=(a("util"),a("tips")),f=a("./data"),g=a("cvm/eip2/common/util"),h={main:'  <div class="coin-alert">    <p b-if="isNetworkShiftUpUser" class="tc-15-msg">弹性公网IP释放后不可找回，请谨慎操作！</p>    <p b-if="!isNetworkShiftUpUser" class="tc-15-msg">确定将该弹性公网IP:      <strong>{{id}}({{name || \'未命名\'}})</strong> 释放？</p>    <ul class="form-list">      <div b-template>        <li b-if="status.isCreateFailed">          <div class="form-label">            <label for="">ID</label>          </div>          <div class="form-input">            {{id}}          </div>        </li>        <li b-if="status.isCreateFailed">          <div class="form-label">            <label for="">状态</label>          </div>          <div class="form-input">            {{status.desc}}          </div>        </li>        <li b-if="!status.isCreateFailed">          <div class="form-label">            <label for="">IP地址</label>          </div>          <div class="form-input">            {{ip}}          </div>        </li>        <li b-if="!status.isCreateFailed">          <div class="form-label">            <label for="">计费模式</label>          </div>          <div class="form-input">            {{payModeDesc}}          </div>        </li>        <li b-if="isPrepaid">          <div class="form-label">            <label for="">到期时间</label>          </div>          <div class="form-input" id="deadline">            {{time.deadlineDesc}}          </div>        </li>        <li b-if="isPrepaid">          <div class="form-label">            <label for="">退还费用</label>          </div>          <div class="form-input">            <div class="form-unit is-success">              <span class="cost">                <strong class="price">{{returnPirce}}</strong>元</span>            </div>          </div>        </li>      </div>      <!-- 只有加速 IP 释放时需要额外验证 -->      <li b-if="isAnycastIP">        <div class="form-label">          <lable for="">确认IP</lable>        </div>        <div class="form-input">          <div class="form-unit">            <input class="tc-15-input-text m" placeholder="请输入IP地址，确认释放" b-model="ipConfirm" />          </div>        </div>      </li>    </ul>  </div>'};c.exports={exec:function(a){this.renderReleaseDialog(a)},renderReleaseDialog:function(a){var b=this,c=new Bee({$tpl:h.main,$data:a});d.create(c.$el,580,"",{title:"释放弹性公网IP",button:{" 确定 ":function(){g.getConfirm({title:"释放弹性公网IP",content:"请确认弹性公网IP："+a.ip+" 的释放操作。<br>释放后，弹性公网IP将无法被找回！"},function(){b.sendReleaseRequest(a)})}}}),a.isAnycastIP&&(d.toggleBtnDisable(!0),c.$watch("ipConfirm",function(b){d.toggleBtnDisable(!(b==a.ip))}))},sendReleaseRequest:function(a){a.isNetworkShiftUpUser?f.returnEip({ids:[a.id]},{camTipsType:"dialog"}).then(function(a){d.hide(),e.success("释放中..."),f.checkTask({taskId:a.response.taskId})}):f.releaseEip({ids:[a.id]},{camTipsType:"dialog"}).then(function(a){d.hide(),e.success("释放中..."),f.checkTask({taskId:a.response.taskId})})}}}),define("cvm/eip2/selectedShow/selectedShow",function(a,b,c){var d=a("$"),e=a("util"),f=a("event"),g=a("dialog"),h={main:'<div class="act-outline" id="selectedShowWrap"><style>    .dev-bold {        font-weight: bold;    }    .dev-title-col {            margin-bottom: 0px !important;            border-bottom: none !important;    }    .dev-content-col {            margin-top: 0px !important;    }</style>    <div class="act-summary">您已选<strong><%-allLength%>个IP</strong><% if (noPermItems.length) { %>，其中<strong><%-noPermItems.length%>个IP</strong>将不能执行<%=actionName%>操作，<% } %></div>    <div class="act-details dev-title-col" id="selectedShowDetail">        <table class="act-details-tb">            <tbody><tr><td>No.</td><!-- <td><span class="entity-name dev-bold">IP名称</span>                    </td> --><td><span class="entity-name dev-bold">IP地址</span>                    </td><td><span class="entity-name dev-bold">当前带宽上限</span>                    </td><td><span class="act-result dev-bold">操作</span>                    </td></tr>            </tbody>        </table>        </div>        <div class="act-details dev-content-col" id="selectedShowDetail">        <table class="act-details-tb">            <tbody>            <% for (var i = 0, item; item = allItems[i]; i++) { %><tr><td><%=i+1%></td><!-- <td><span class="entity-name" title="<%=item.id%>"><%=item.name%></span>                    </td> --><td><span class="entity-name" title="<%=item.ip%>"><%=item.ip%></span>                    </td><td><span class="entity-name entity-name2" title="<%=item.bandwidth%>"><%=item.bandwidth%></span>                    </td><td><% if (item.reason) { %><span class="act-result text-danger" title="<%=item.reason%>"><%=item.reason%></span><% } else { %><% if (actionName) { %><span class="act-result">可<%=actionName%></span><% } else { %><span class="act-result">可操作</span><% } %><% } %>                    </td></tr><% } %>            </tbody>        </table>    </div></div>'
},i={render:function(a){var b=a.hasPermItems||[],c=a.noPermItems||[],f=[];f=f.concat(c).concat(b);var i=e.tmpl(h.main,{actionName:a.actionName||"",allItems:f,allLength:f.length,hasPermItems:b,noPermItems:c});b.length||g.toggleBtnDisable(1),a.renderTo?d(a.renderTo).html(i):g.el&&g.el.find(".dialog_layer_cont").prepend(i),g.center(),this.bindEvt()},bindEvt:function(){var a=this;f.addCommonEvent("click",{s_show_detail:function(){a._toggleBox()}})},_toggleBox:function(){var a=d("#selectedShowDetail"),b=d("#selectedShowIconArr");a.toggle(),a.is(":visible")?b.removeClass("icon-arrow-down").addClass("icon-arrow-up"):b.removeClass("icon-arrow-up").addClass("icon-arrow-down"),g.center()}};c.exports=i}),define("cvm/eip2/unbindEip",function(a,b,c){function d(a,b,c){return new Promise(function(d,e){!function g(){j.apiRequest({regionId:a,action:"QueryTask",serviceType:"vpc",data:{Version:"2017-03-12",TaskId:b}}).then(function(a){var b=a.Response,h=b.Status;switch(h){case"SUCCESS":d(b);break;case"FAILED":f.error("查询流程失败"),e(new Error({message:"查询流程失败"}));break;default:setTimeout(g,c)}},e)}()})}var e=(a("widget/popover/popConfirm"),a("appUtil"),a("util"),a("dialog")),f=a("tips"),g=a("cvm/common/model"),h=a("./data"),i=a("cvm/eip2/common/util"),j=a("models/iaas"),k=a("cvm/cvm/data"),l={main:'  <div>    <div class="tip_box">      <p>        确定将该弹性公网IP：        <strong>{{ip}}</strong> 与绑定的{{bindResource.typeDesc}}：        <strong>{{bindResource.id}}</strong> 解绑？        <br>解绑后，可能会影响您的业务，请提前做好准备。        <span b-if="bindResource.type === \'nat\'">          <br>该EIP与NAT网关解绑后，带宽默认设置为1 Mbps          <span>      </p>    </div>    <ul class="form-list">      <li class="pure-text-row">        <div class="form-label">          <label for="">费用</label>        </div>        <div class="form-input" style="padding">          <span>{{payModeDesc}}计费的弹性公网IP解绑后，</span>          <span b-if="isTraffic || payMode == payModeMap.package">将收取闲置费用            <span class="cost">              <strong>{{toI18nMoney(regionPrice, \'words\')}}</strong>/小时</span>          </span>          <span b-if="!(isTraffic || payMode == payModeMap.package)">不收取闲置费用</span>        </div>      </li>    </ul>    <div b-if="bindResource.type === \'cvm\'">      <label class="form-ctrl-label-stacked" style="padding-top: 10px;">        <input type="checkbox" b-model="releaseAddress" class="tc-15-checkbox">立即释放弹性公网ip</label>    </div>  </div>',"default":'  <div>    <div class="tip_box">      <p>        确定将该弹性公网IP：        <strong>{{ip}}</strong> 与绑定的{{bindResource.typeDesc}}：        <strong>{{bindResource.id}}</strong> 解绑？        <br>解绑后，可能会影响您的业务，请提前做好准备。      </p>    </div>    <ul class="form-list">      <li class="pure-text-row">        <div class="form-label">          <label for="" style="padding-top: 3px;">费用</label>        </div>        <div class="form-input">          该弹性公网IP解绑后将收取闲置费用          <span class="cost">            <strong>{{toI18nMoney(regionPrice, \'words\')}}</strong>/小时</span>        </div>      </li>      <li b-if="canAllocWanIp">        <label class="form-ctrl-label-stacked" style="padding-top: 10px;">          <input type="checkbox" b-model="allocWanIp" class="tc-15-checkbox">解绑后免费分配公网IP（注意，该公网IP随机分配，且无法与实例解绑）</label>      </li>    </ul>    <div b-if="bindResource.type === \'cvm\'">      <label class="form-ctrl-label-stacked" style="padding-top: 10px;">        <input type="checkbox" b-model="releaseAddress" class="tc-15-checkbox">立即释放弹性公网ip</label>    </div>  </div>'};c.exports={exec:function(a){var b=this,c=a.regionPrice;k.queryHangingEipPrice({regionId:a.regionId}).then(function(a){var b=a.response;c=b&&b.price&&b.price.addressPrice.discountPrice})["catch"](function(){})["finally"](function(){b.renderUnbindDialog(Object.assign(a,{regionPrice:c}))})},renderUnbindDialog:function(b){var c=this,d=new Bee({$tpl:c.getDialogTpl(b),$data:b,toI18nMoney:a("widget/i18n").toI18nMoney,payModeMap:h.payMode});c.bee=d,e.create(d.$el,600,"",{title:"解绑弹性公网IP",button:{" 确定 ":function(){i.getConfirm({title:"解绑弹性公网IP",content:"请确认弹性公网IP："+b.ip+" 的解绑操作！"},function(){c.sendUnbindRequest(b)})}}})},getDialogTpl:function(a){return a.isNetworkShiftUpUser?l.main:l["default"]},sendUnbindRequest:function(a){var b=this;"cvm"===a.bindResource.type?b.unbindCvm(a).then(function(){if(b.bee.releaseAddress){var c=a.isNetworkShiftUpUser?h.returnEip({ids:[a.id]},{camTipsType:"dialog"}):h.releaseEip({regionId:a.regionId,ids:[a.id]},{camTipsType:"dialog"});c.then(function(a){f.success("释放中..."),h.checkTask({taskId:a.response.taskId})})}}):"eni"===a.bindResource.type?b.unbindEni(a):"nat"===a.bindResource.type?b.unbindNat(a):"havip"===a.bindResource.type&&b.unbindHaVip(a)},unbindCvm:function(a){return h.unbindEip({regionId:a.regionId,id:a.id},{camTipsType:"dialog"}).then(function(a){return e.hide(),f.success("解绑中..."),h.checkTask({taskId:a.response.taskId})})},unbindEni:function(a){h.unbindEip({regionId:a.regionId,id:a.id},{camTipsType:"dialog"}).then(function(a){e.hide(),f.success("解绑中..."),h.checkTask({taskId:a.response.taskId})})},unbindNat:function(a){j.apiRequest({cmd:"DescribeNatGateway",serviceType:"vpc",data:{natId:a.bindResource.id,offset:0,limit:1},regionId:a.regionId},{camTipsType:"dialog"}).then(function(b){var c=b.data&&b.data[0];return c?g.apiDelegate({cmd:"EipUnBindNatGateway",serviceType:"vpc",data:{natId:a.bindResource.id,vpcId:c.vpcId,assignedEipSet:[a.addressIp]},regionId:a.regionId},{camTipsType:"dialog"}).then(function(b){e.hide(),f.success("解绑中..."),h.checkTask({taskId:b.taskId||b.data&&b.data.taskId,regionId:a.regionId})}):(e.hide(),void f.error("找不到关联的NAT网关"))})["catch"](function(){e.toggleBtnDisable(!1)})},unbindHaVip:function(a){return j.apiRequest({regionId:a.regionId,action:"HaVipDisassociateAddressIp",serviceType:"vpc",data:{Version:"2017-03-12",HaVipId:a.bindResource.id}},{classicResponse:!1}).then(function(b){var c=b.Response;e.hide(),f.success("解绑中...");var g=c.RequestId;d(a.regionId,g,2e3).then(function(){h.refreshList()},function(){f.error("操作执行失败！"),h.refreshList()})})["catch"](function(){e.toggleBtnDisable(!1)})}}}),define("cvm/eip2/upgradeBandwidth",function(a,b,c){var d=a("$"),e=a("qccomponent"),f=a("dialog"),g=a("widget/range/range"),h=a("cvm/eip2/selectedShow/selectedShow"),i=a("cvm/cvm/event/operate_base"),j=a("tips"),k=a("widget/popover/HelpTips"),l=a("util"),m=a("constants"),n=a("appUtil"),o=(a("cvm/cvm/cvmutil"),a("cvm/common/model"),a("./data")),p=a("./common/util"),q={month:'  <div class="form-wrap" id="upgradeBandwidthWrap">    <style>      .hasDatepicker .dialog_layer_main {        overflow: visible;      }    </style>    <ul class="form-list">      <li>        <div class="form-label">          <label>计费模式</label>        </div>        <div class="form-input">          包月带宽          <!-- <a href="javascript:void(0);"  id="chooseFlow" style="display:none;">  切换按流量计费</a>                                    <span id="leftChangeCount" style="display:none;">(转换后将消耗一次转换机会)</span> -->        </div>      </li>      <li>        <div class="form-label">          <label>当前带宽</label>        </div>        <div class="form-input">          {{bandwidthNow}}Mbps        </div>      </li>      <li>        <div class="form-label">          <label>目标带宽</label>        </div>        <div class="form-input">          <div class="bandwidth-choose-area" id="bandwidthChooseArea" style="width:450px"></div>          <!-- <p class="datetime-tips">调整带宽必须大于本次升级时间段内最大带宽</p> -->        </div>      </li>      <li>        <div class="form-label">          <label>生效时间</label>        </div>        <div class="form-input">          <!-- <qc-date-picker id="bandwidthDateInput"></qc-date-picker> -->          <p class="text-primary" id="bandwidthDatePtxt">带宽调整实时设定，实时生效</p>        </div>      </li>      <li b-if="!isRefund">        <div class="form-label">          <label>费用</label>        </div>        <div class="form-input">          <span class="cost">            <strong>{{priceDesc}}</strong>            <span b-if="isDiscount" style="text-decoration: line-through; margin: 0 5px;font-size: 0.7em;color:#000">{{originalPriceDesc}}</span>          </span>        </div>      </li>      <li b-if="isRefund">        <div class="form-label">          <label>退还费用</label>        </div>        <div class="form-input">          <span class="cost" style="color:red">            <strong>{{priceDesc}}</strong>          </span>        </div>      </li>    </ul>  </div>',hour:'  <div class="form-wrap adjust-band-max bandwidth-limit-wrapper" id="upgradeBandwidthWrap">    <ul class="form-list">      <li>        <div class="form-label">          <label>计费模式</label>        </div>        <div>          按小时计费          <!-- <a href="javascript:void(0);" id="changeMode" style="display:none;">&nbsp;&nbsp;切换成带宽计费</a>                    <span id="leftChangeCount" style="display:none;">(转换后将消耗一次转换机会)</span> -->        </div>      </li>      <li>        <div class="form-label">          <label>当前带宽</label>        </div>        <div class="">          {{bandwidthNow}}Mbps        </div>      </li>      <li>        <div class="form-label">          <label>目标带宽</label>        </div>        <div class="">          <div class="rerange-wrapper" id="bandwidthChooseArea" style="width:440px"></div>        </div>      </li>      <li>        <div class="form-label">          <label>生效时间</label>        </div>        <div class="">          <p class="text-primary">带宽调整实时设定，实时生效</p>        </div>      </li>      <li>        <div class="form-label">          <label>费用</label>        </div>        <div class="form-input">          <span class="cost">            <strong>{{priceDesc}}</strong>          </span>        </div>      </li>    </ul>  </div>',traffic:'  <div class="form-wrap adjust-band-max bandwidth-limit-wrapper" id="upgradeBandwidthWrap">    <ul class="form-list">      <li>        <div class="form-label">          <label>计费模式</label>        </div>        <div>          按流量计费          <!-- <a href="javascript:void(0);" id="changeMode" style="display:none;">&nbsp;&nbsp;切换成带宽计费</a>                <span id="leftChangeCount" style="display:none;">(转换后将消耗一次转换机会)</span> -->        </div>      </li>      <li>        <div class="form-label">          <label>当前带宽</label>        </div>        <div class="">          {{bandwidthNowDesc}}        </div>      </li>      <li>        <div class="form-label">          <label>目标带宽</label>        </div>        <div class="">          <p b-if="isShowNoLimitSelect" class="radio-line">            <label>              <input type="radio" class="tc-15-radio is-bandwidth-unlimited" b-model="isLimited" name="bw_limit_type" value="0">              <span style="cursor:pointer">无上限</span>            </label>            <label>              <input type="radio" class="tc-15-radio is-bandwidth-limited" b-model="isLimited" name="bw_limit_type" value="1">              <span style="cursor:pointer">有上限</span>            </label>          </p>          <div b-if="isLimited == 1" class="rerange-wrapper" style="width:500px">            <div id="bandwidthChooseArea"></div>            <p b-if="bindNat" class="text-weak" style="font-size:12px;">NAT网关流量将按五元组原则hash至EIP，如果EIP带宽小于NAT网关，有可能导致丢包。</p>          </div>        </div>      </li>      <li>        <div class=" form-label">          <label>生效时间</label>        </div>        <div class="">          <p>带宽调整实时设定，实时生效</p>        </div>      </li>      <li>        <div class="form-label">          <label>费用</label>        </div>        <div class="form-input">          <span class="cost">            <strong>{{priceDesc}}</strong>          </span>        </div>      </li>    </ul>  </div>',refund:'  <div class="act-outline">    <div style="text-indent:2em;">      </span>    </div>    <div style="margin-top:20px;font-weight:bold;">您是否确定要操作？</div>  </div>  <div class="act-outline">    <div class="act-details">      <table class="act-details-tb">        <tbody>          <tr>            <td style="width:200px;">              <div>                <span class="text-overflow">退款账号</span>              </div>            </td>            <td>              <div>                <span class="text-overflow">退款金额(元)</span>              </div>            </td>          </tr>          <tr>            <td style="border-top:1px solid #E6EBF2">              <div>                <span class="text-overflow">                  <%=refundUin%>                </span>              </div>            </td>            <td style="border-top:1px solid #E6EBF2">              <div>                <span class="text-overflow">                  <%=refundPrice%>                </span>              </div>            </td>          </tr>        </tbody>      </table>    </div>  </div>  <div class="act-outline">    <div style="text-indent:2em;">      <p>注意：如果用代金券购买，代金券部分不退回。如果重新切换成带宽计费，可能造成费用增加。        <span class="text-danger">退款算法详见          <a href="https://cloud.tencent.com/document/product/555/7440" target="_blank">退款规则            <b class="external-link-icon"></b>          </a>        </span>      </p>    </div>  </div>',"package":'  <div class="form-wrap adjust-band-max bandwidth-limit-wrapper" id="upgradeBandwidthWrap">    <ul class="form-list">      <li>        <div class="form-label">          <label>计费模式</label>        </div>        <div>          按95削峰方式后付费月结          <help-tips>后付费-95消峰计费结算时削去前5%的带宽峰值计费</help-tips>          <!-- <a href="javascript:void(0);" id="changeMode" style="display:none;">&nbsp;&nbsp;切换成带宽计费</a>                    <span id="leftChangeCount" style="display:none;">(转换后将消耗一次转换机会)</span> -->        </div>      </li>      <li>        <div class="form-label">          <label>当前带宽</label>        </div>        <div class="">          {{bandwidthNow == UNLIMITED_BANDWIDTH ? \'不限制\' : (bandwidthNow + \'Mbps\')}}        </div>      </li>      <li>        <div class="form-label">          <label>目标带宽</label>        </div>        <div class="">          <div style="margin-bottom: 10px;">            <lable class="form-ctrl-label">              <input type="radio" name="hasBandwidthLimit" class="tc-15-radio" value="1" b-model="hasBandwidthLimit" />有上限            </lable>            <lable class="form-ctrl-label">              <input type="radio" name="hasBandwidthLimit" class="tc-15-radio" value="0" b-model="hasBandwidthLimit" />无上限            </lable>          </div>          <div style="display: {{hasBandwidthLimit==1 ? \'block\' : \'none\'}}" class="rerange-wrapper" id="bandwidthChooseArea" style="width:440px"></div>        </div>        <p class="text-weak" b-if="isAnycastIp">          注：带宽发布域的每个城市均按此上限限制，因此IP在各地域的总带宽有可能大于设置的带宽限制        </p>      </li>      <li>        <div class="form-label">          <label>费用</label>        </div>        <div class="form-input">          <span class="cost">            <strong>{{priceDesc}}</strong>          </span>          <p class="text-weak">按各地域实际使用的总带宽进行结算，空置收费 0.2元/小时。            <a href="https://cloud.tencent.com/document/product/644/12617" target="_blank">查看计费规则</a>          </p>          <p class="text-weak">            出入带宽将按1：1限速          </p>        </div>      </li>    </ul>  </div>'},r=o.payMode.prepaid,s=o.payMode.traffic,t=o.payMode.hour,u=o.payMode["package"],v=function(a){i.call(this,a)},w=a("./common/config"),x=w.EIP_BANDWIDTH_QUOTA_CONFIG;o.describeBandwidthAttribute().then(function(a){x=a})["catch"](function(a){}),v.prototype=new i,v.prototype.exec=function(a,b){var c=this;c.eipItem=a||c.selectedItems&&c.selectedItems[0].eipInfo,c.cvmItem=b||c.selectedItems&&c.selectedItems[0],c.selectedShowOptions={actionName:"调整带宽",hasPermItems:[{ip:c.eipItem.ip,bandwidth:c.eipItem.bandwidth==o.UNLIMITED_BANDWIDTH?"无上限":c.eipItem.bandwidth+" Mbps"}]},c.eipItem.payMode==r?c.upgradeBandwidthByMonth():c.eipItem.payMode==s?c.upgradeBandwidthByTraffic():c.eipItem.payMode==t?c.upgradeBandwidthByHour():c.eipItem.payMode==u&&c.upgradeBandwidthByPackage(),!c.eipItem.payMode==u&&h.render(c.selectedShowOptions)},v.prototype.bindEvent=function(){},v.prototype.upgradeBandwidthByMonth=function(a){var b=this,c=b.eipItem,d=b.cvmItem;c.deadlineDate;b.upgradeBandwidthBee=new e({$tpl:q.month,$data:{bandwidthNow:c.bandwidth,isDiscount:!1,isRefund:!1,priceDesc:"0.00"+(n.isI18n()?"美元":"元"),originalPrice:0}}),b.showDialog(b.upgradeBandwidthBee.$el,function(){var a=c.bandwidth,d=b.bandWidthRange.val();if(a>d){var e=b.upgradeBandwidthBee.$get("refundInfo"),g=l.tmpl(q.refund,e);f.create(g,580,"",{title:"确认退款",button:{" 确定 ":function(){b.upgradeBandwidth()}}})}else o.toPay2(b.collectData(d))});var g={};g.max=p.getEipMaxBandwidth(x,{networkPayMode:"BANDWIDTH_PREPAID_BY_MONTH",cvmPayMode:d&&d.instanceChargeType}).bandwidthUpper,b.renderBandwidthRange(g,function(a){a<c.bandwidth?b.upgradeBandwidthBee.$set("isRefund",!0):b.upgradeBandwidthBee.$set("isRefund",!1)})},v.prototype.upgradeBandwidthByTraffic=function(a){var b=this,c=b.eipItem,d=b.cvmItem,f=!1,g=o.UNLIMITED_BANDWIDTH,h=c.nat?5e3:p.getEipMaxBandwidth(x,{networkPayMode:"TRAFFIC_POSTPAID_BY_HOUR",bindNat:c.bindResource&&"nat"==c.bindResource.type,cvmPayMode:d&&d.instanceChargeType,cpu:d&&d.cpu}).bandwidthUpper;c.bandwidth==g&&(f=!0),b.upgradeBandwidthBee=new e({$afterInit:function(){this.$watch("isLimited",function(a){a&&b.renderBandwidthRange({min:1,max:h,vale:1})})},$tpl:q.traffic,$data:{bindNat:"nat"==c.bindResource.type,isLimited:c.bandwidth==g?0:1,bandwidthNowDesc:c.bandwidth==o.UNLIMITED_BANDWIDTH?"无上限":c.bandwidth>=1e3?c.bandwidth/1e3+"Gbps":c.bandwidth+"Mbps",isShowNoLimitSelect:f,priceDesc:"0.80"+(n.isI18n()?"美元":"元")+"/GB"}}),b.showDialog(b.upgradeBandwidthBee.$el,function(){b.upgradeBandwidth()}),b.renderBandwidthRange({min:1,max:h,val:c.bandwidth>h?h:c.bandwidth}),b.bindEvent()},v.prototype.upgradeBandwidthByHour=function(){var a=this,b=a.eipItem,c=a.cvmItem;a.upgradeBandwidthBee=new e({$tpl:q.hour,$data:{bandwidthNow:b.bandwidth}}),a.showDialog(a.upgradeBandwidthBee.$el,function(){a.upgradeBandwidth()});var d=b.nat?5e3:p.getEipMaxBandwidth(x,{networkPayMode:"BANDWIDTH_POSTPAID_BY_HOUR",cvmPayMode:c&&c.instanceChargeType}).bandwidthUpper;a.renderBandwidthRange({min:1,max:d,val:b.bandwidth>d?d:b.bandwidth})},v.prototype.upgradeBandwidthByPackage=function(){var a=this,b=a.eipItem,c=a.cvmItem,d=b.nat?1e3:p.getEipMaxBandwidth(x,{networkPayMode:"BANDWIDTH_PACKAGE",cvmPayMode:c&&c.instanceChargeType}).bandwidthUpper;e.tag("help-tips",k),a.upgradeBandwidthBee=new e({$tpl:q["package"],$data:{bandwidthNow:b.bandwidth,hasBandwidthLimit:b.bandwidth==o.UNLIMITED_BANDWIDTH?"0":"1",UNLIMITED_BANDWIDTH:o.UNLIMITED_BANDWIDTH,isAnycastIp:"AnycastEIP"==o.addressType}}),a.upgradeBandwidthBee.$watch("hasBandwidthLimit",function(){f.toggleBtnDisable(!1),a.refreshPrice()}),a.showDialog(a.upgradeBandwidthBee.$el,function(){a.upgradeBandwidth()}),a.renderBandwidthRange({min:1,max:d,val:b.bandwidth>d?d:b.bandwidth})},v.prototype.renderBandwidthRange=function(a,b){var c=this;c.bandWidthRange=new g({renderTo:d("#bandwidthChooseArea"),value:a.val||c.eipItem.bandwidth,min:a.min||1,max:a.max||100,unit:"Mbps",section:w.EIP_BANDWIDTH_SLIDER_SECTION[a.max]||[{value:a.max||100,width:300}],change:function(a){a==c.eipItem.bandwidth?f.toggleBtnDisable(!0):f.toggleBtnDisable(!1),b&&b(a),c.refreshPrice()}}),c.refreshPrice(!0)},v.prototype.showDialog=function(a,b){f.create(a,"680","",{title:"调整带宽","class":"dialog_layer_v2 hasDatepicker",preventResubmit:!0,buttonDisable:[1,0],button:{" 确定 ":b}})},v.prototype.refreshPrice=function(a){var b=this,c=this.eipItem,d=c.payMode,e=d==s&&0==b.upgradeBandwidthBee.$get("isLimited")?o.UNLIMITED_BANDWIDTH:b.bandWidthRange.val();a&&d==r||d==s||b.upgradeBandwidthBee.$set("priceDesc","正在查询"),b.upgradeBandwidthBee.$set("isDiscount",!1),o.queryUpgradeEipBandwidthPrice({ids:[c.id],bandwidth:e},{camTipsType:"dialog"}).then(function(a){if(a.response.price){a=a.response.price;var e,f="";if(d==r)if(b.upgradeBandwidthBee.$get("isRefund"))e=a.refundPrice,b.upgradeBandwidthBee.$set("refundInfo",a);else{var g=a.addressPrice.originalPrice,h=a.addressPrice.discountPrice,i=g>h;e=i?h:g,i&&b.upgradeBandwidthBee.$set("originalPriceDesc",g+(n.isI18n()?"美元":"元")),b.upgradeBandwidthBee.$set("isDiscount",i)}else e=a.addressPrice.unitPrice;if(void 0==e)return void b.upgradeBandwidthBee.$set("priceDesc","查询失败");f=e.toFixed(2)+o.unitDescMap[c.payMode],b.upgradeBandwidthBee.$set("priceDesc",f)}else b.upgradeBandwidthBee.$set("priceDesc","查询失败")},function(a){b.upgradeBandwidthBee.$set("priceDesc","查询失败")})},v.prototype.upgradeBandwidth=function(){var a=this,b=a.eipItem,c=a.upgradeBandwidthBee.hasBandwidthLimit,d="0"===String(c)?o.UNLIMITED_BANDWIDTH:a.bandWidthRange.val();o.upgradeBandwidth({ids:[b.id],bandwidth:d,regionId:b.regionId},{camTipsType:"dialog"}).then(function(a){f.hide(),j.success("调整带宽中"),o.checkTask({taskId:a.response.taskId})})},v.prototype.collectData=function(a){var b=this,c=b.eipItem;c.curDeadline=n.formatDate(new Date(c.deadlineDate),"yyyy-MM-dd hh:mm:ss");var d=[{type:"ip_with_network",goodsNum:1,regionId:+c.regionId||n.getRegionId(),payMode:1,uin:l.getUin(),ownerUin:l.getOwnerUin(),appId:n.getAppId(),goodsCategoryId:100214,goodsDetail:{resourceId:c.id,newConfig:{bandwidth:a,chargeType:c.payMode,pid:11392,modifyMode:a<c.bandwidth?"down":void 0},oldConfig:{bandwidth:c.bandwidth,chargeType:c.payMode,pid:11392},curDeadline:c.curDeadline,pid:11392,launchSource:"cvmPage",purchaseSource:"MC",productInfo:[{name:"地域",value:m.REGIONNAMES[c.regionId]},{name:"弹性公网ID",value:c.id},{name:"计费模式",value:w.EIP_PAY_MODE[c.payMode]?w.EIP_PAY_MODE[c.payMode].desc:"-"},{name:"带宽",value:c.bandwidth+"=>"+a+" (Mbps)"}]}}];return d},c.exports=v}),define("cvm/image/cacher",function(a,b,c){var d=a("widget/cacher/Cacher"),e=a("cvm/image/hub");c.exports=new d([{host:e,fnName:"shareImage",isModify:!0,ns:"image-share.$0.$1.$2"},{host:e,fnName:"cancelShareImage",isModify:!0,ns:"image-share.$0.$1.$2"},{host:e,fnName:"getImageShare",ns:"image-share.$0.$1.ALL"}])}),define("cvm/image/copy",function(a,b,c){var d=a("$"),e=(a("pageManager"),a("manager"),a("util")),f=a("appUtil"),g=(a("event"),a("dialog")),h=a("tips"),i=a("reporter"),j=a("qccomponent"),k=(a("models/api"),a("cvm/common/constants")),l=a("cvm/common/components/columsWidth/ColumsWidth"),m=k.OVERSEA_REGION_ID_LIST,n=k.FINANCE_REGIONS,o=a("cvm/cvm/data"),p=a("cvm/common/model"),q=a("cvm/image/util"),r=function(a){this.options=a;var b=this,c=a.imgIds,f=a.imgMap,h=a.listObj,j=a.regionId,k=!1,l=!1,p=h.isSyncGlobalImageUser,q=n,r=m;q.indexOf(j+"")>-1&&(k=!0),r.indexOf(j+"")>-1&&(l=!0),o.queryRegion().then(function(a){var h=[];for(var i in a)if(i!=j){var m=q.find(function(a){return a==i}),n=r.find(function(a){return a==i});k?q.indexOf(i)>-1&&h.push(i):l?m||!p&&!n||h.push(i):m||!p&&n||h.push(i)}if(!h.length)return void b.showNotSupport(j);var o=0;c.forEach(function(a){var b=f[a];o+=parseInt(b.size,10)});var s=e.tmpl('  <style type="text/css">    .mirror-list .tc-15-page {      display: none    }    .mirror-list .tc-15-table-fixed-head {      position: absolute;      top: 108px;      width: 480px!important;    }  </style>  <div class="mirror-list">    <div class="mirror-clear">      <div class="mirror-copy-title">复制        <%=num%>个镜像（共          <%=allsize%>GB）到：</div>      <!-- <div class="mirror-copy-date mirror-gray-text">今日剩余操作次数:          <span class="mirror-red-text">            N次</span>        </div> -->    </div>    <div id="copyTable"></div>  </div>',{num:c.length,allsize:o});g.create(s,520,"",{title:"跨地域复制镜像",preventResubmit:!0,button:{" 确定 ":function(){b.sendCopyReq()}}}),b.$copyTable=d("#copyTable"),b.initCopyTable()}),i.click("jingxiang.copy")};r.prototype={sendCopyReq:function(){var a=this,b=this.options,c=b.imgIds,e=b.imgMap,i=b.listObj,j=b.regionId,l=(k.REGIONMAP[j+""],this.gridView.getSelected()),m=[];return l.length?(l.forEach(function(a){m.push(k.REGIONIDMAP[a.rid+""])}),g.hide(),void p.apiRequest({action:"SyncImages",serviceType:"image",regionId:j||f.getRegionId(),data:{imageIds:c,destinationRegions:m}}).then(function(b){if(b=b.response,b.taskId){g.hide(),c.forEach(function(a){var b=d("#imageList").find('tr[data-imgid="'+a+'"]'),c=b.attr("data-index");i.gridView.$refs.list[c].$set({$loading:!0,$selected:!1,statusDesc:"同步中"}),e[a].statusDesc="同步中"});var f=function k(){o.queryTaskFlow({taskId:b.taskId,regionId:j}).then(function(b){var c=b.response.status;"SUCCESS"==c?(i.getList(),h.success("复制镜像成功")):"FAILED"==c?(i.getList(),setTimeout(function(){h.error("复制镜像失败")},0)):a.timeOut=setTimeout(k,5e3)})};f(),i.selectedChange()}})["catch"](function(a){console.warn(a)})):(f.restoreDialogBtn(),h.error("请选择地域!"))},getColums:function(){var a=[{key:"rName",name:"地域",_minWidth:96,_maxWidth:132},{key:"imgShowNum",name:"已有镜像",_minWidth:48,_maxWidth:60}],b=520;return a=l(a,null,b,!1)},initCopyTable:function(){var a=this,b={$data:{selectedHighlight:!1,colums:a.getColums(),minHeight:0,showState:!1,showPagination:!1},getData:function(b,c){a.getCopyTable()},setTrAttr:function(a,b){}},c=j.getComponent("grid-view");a.gridView=new c(b),a.$copyTable.append(a.gridView.$el)},getCopyTable:function(){var a=this,b=this.options,c=b.listObj,d=b.regionId,h=[31,32,39],i=[],j=[],l=[],r=[],s=0,t=!1,u=!1,v=n,w=m,x=c.isSyncGlobalImageUser;v.find(function(a){return a==d})&&(t=!0),w.find(function(a){return a==d})&&(u=!0),p.apiRequest({regionId:d,serviceType:"image",action:"DescribeImageQuota",data:{}}).then(function(c){s=c.response.imageNumQuota,o.queryRegion().then(function(c){for(var m in c){var n=v.find(function(a){return a==m}),o=w.find(function(a){return a==m});m!=d&&(h.find(function(a){return a==m})?j.push(m):t?n?i.push(m):j.push(m):u?n||!x&&!o?j.push(m):i.push(m):n||!x&&o?j.push(m):i.push(m))}i.forEach(function(a){l.push(function(b){p.graphql({query:"query regionImages($filters: [Filter], $limit: Int, $offset: Int, $region: String){\n                                    images(filters: $filters, limit: $limit, offset: $offset, region: $region) {\n                                        totalCount\n                                        nodes {\n                                            id\n                                            unImgId\n                                            imageName\n                                            name\n                                            imageDescription\n                                            osName\n                                            imageType\n                                            createTime\n                                            creator\n                                            status\n                                        }\n                                    }\n                                }",variables:{filters:[{name:"image-type",values:[q.TYPES.PRIVATE]}],limit:100,offset:0},regionId:a}).then(function(d){if(d&&d.images){var e={imageSet:d.images.nodes,totalCount:d.images.totalCount};d=e,d.rid=a,d.rName=c[a],b(d)}})})}),f.parallel(l,function(d){if(d&&d.length){d.forEach(function(a){r.push({rid:a.rid,rName:a.rName,imgNum:a.totalCount,imgShowNum:a.totalCount+"/"+s,$disable:b.imgIds.length+a.totalCount>s})}),a.gridView.setData({list:r});var f=a.$copyTable,h=!1;r.forEach(function(a,b){if(a.$disable){var c=f.find('tr[data-index="'+b+'"]');c.find("td").eq(2).find("span").append('<i class="mirror-gray-text"> (每个地域暂只支持'+s+"个镜像)</i>")}else h=!0}),h||g.toggleBtnDisable(!0);for(var i=0,l=j.length;l>i;i++){var m=j[i];c[m]&&f.find("tbody").append(e.tmpl('  <tr>    <td>      <div class="tc-15-first-checkbox">        <input type="checkbox" class="tc-15-checkbox" disabled>      </div>    </td>    <td colspan="2">      <div class="mirror-gray-text">        <%= regionName %>地区          <i>(暂不支持复制到            <%= regionName %>地区)</i>      </div>    </td>  </tr>',{regionName:k.REGIONNAMES[m]}))}a.gridView.resize(),g.center()}})})})["catch"](function(a){console.warn(a)})},showNotSupport:function(a){g.confirm(e.tmpl('  <strong style="font-size:18px">暂不支持将    <%= regionName %>地区的镜像复制到其它地域</strong>',{regionName:k.REGIONNAMES[a]}),function(){g.hide()},null,"","","确定",!1)},destroy:function(){clearTimeout(this.timeOut)}},c.exports=r}),define("cvm/image/data_package",function(a,b,c){var d=a("cvm/image/util"),e=a("appUtil"),f={CREATING:"创建中",CREATEFAILED:"创建失败",NORMAL:"正常",USING:"被使用中",SYNCING:"同步中",IMPORTING:"导入中",IMPORTFAILED:"导入失败",DELETING:"删除中"},g=["NORMAL","USING","SYNCING"],h=function(a){var b=this,c=a.data,d=a.regionId;this.options=a;for(var f,h=0;f=c[h];h++)b.statusDesc(f),f.createTime&&(f.createTime=e.formatDate(new Date(f.createTime),"yyyy-MM-dd hh:mm:ss")),f.regionId=d,f.isInstanceImage="InstanceImage"==f.imageClass,f.content=f.isInstanceImage&&f.snapshotSet&&f.snapshotSet.length&&f.snapshotSet.some(function(a){return"DATA"==a.diskUsage})?"系统盘数据+数据盘数据":"系统盘数据",f.snapshotSet&&f.snapshotSet.length&&(f.size=0,f.snapshotSet.forEach(function(a){f.size+=a.diskSize})),f.disksize=f.size?f.size+"GB":"-",f.descOsName=f.osName,f.imageId=f.id||f.unImgId,f.unImgId=f.unImgId||f.id,f.canGotoDetail=g.includes(f.status);return c};h.prototype={statusDesc:function(a){a.statusDesc=f[a.status]||"未知","SYNCING"==a.status&&(a.$loading=!0,a.statusDesc=f[a.status],a.syncProgress=a.syncProgress?parseFloat(a.syncProgress):.1),"IMPORTING"==a.status&&(a.$loading=!0),a.imageType===d.TYPES.SHARED&&(a.$readonly=!0)},diskInfo:function(a){a.disksize=a.size?a.size+"GB":"-"}},c.exports=h}),define("cvm/image/detail",function(a,b,c){var d,e,f=a("$"),g=(a("manager"),a("util"),a("appUtil")),h=a("pageManager"),i=a("cvm/image/data_package"),j=a("dataManager"),k=a("cvm/image/hub"),l=a("widget/errorTips/errorTips"),m=a("cvm/common/components/columsWidth/ColumsWidth"),n=a("cvm/snapshot2/data"),o=a("cvm/common/model"),p=a("router"),q=a("qccomponent"),r=a("dialog"),s=a("widget/fieldsManager/gridView"),t=a("widget/grid/Action"),u=a("widget/grid/LocalGrid"),v=a("cvm/image/share"),w=(a("cvm/image/cacher"),a("cvm/image/util")),x=function(){var a=[{key:"accountId",name:"对端账号唯一ID",required:!0},{key:"createdTime",name:"共享时间"},{key:"_action",name:"操作",tdTpl:'  <cell-action text="取消共享" act="cancel"></cell-action>',required:!0}];return a=m(a)};d=q.extend({$tpl:'  <div>    <div class="tc-g">      <div class="tc-g-u-1-2">        <div class="tc-panel">          <!-- 参数列表 开始 -->          <div class="param-box">            <div class="param-hd"><h3>镜像信息</h3></div>            <div class="param-bd">              <ul class="item-descr-list">                <li>                  <span class="item-descr-tit">名称</span>                  <span class="item-descr-txt">{{ image.imageName }}</span>                </li>                <li>                  <span class="item-descr-tit">镜像ID</span>                  <span class="item-descr-txt">{{ image.unImgId }}</span>                </li>                <li>                  <span class="item-descr-tit">状态</span>                  <span                    class="item-descr-txt"                    data-title="{{ image.statusDesc }}"                    >{{ image.statusDesc }}</span                  >                </li>                <li>                  <span class="item-descr-tit">镜像类型</span>                  <span class="item-descr-txt">{{                    TYPE_NAMES[image.imageType] || \'未知#\' + image.imageType                  }}</span>                </li>                <li>                  <span class="item-descr-tit">操作系统</span>                  <span class="item-descr-txt">{{ image.descOsName }}</span>                </li>                <li b-if="image.creator">                  <span class="item-descr-tit">创建者</span>                  <span class="item-descr-txt">{{ image.creator }}</span>                </li>                <!--                  <li b-if="image.imageType !== TYPES.PUBLIC">                    <span class="item-descr-tit">Disk</span>                    <span class="item-descr-txt">{{image.target}}</span>                  </li>                -->                <li b-if="image.imageType !== TYPES.PUBLIC">                  <span class="item-descr-tit">镜像包含数据</span>                  <span class="item-descr-txt">{{ image.content }}</span>                </li>                <li b-if="image.imageType !== TYPES.PUBLIC">                  <span class="item-descr-tit">镜像硬盘大小</span>                  <span class="item-descr-txt">{{ image.disksize }}</span>                </li>                <li b-if="image.imageType !== TYPES.PUBLIC">                  <span class="item-descr-tit">{{                    image.imageType === TYPES.SHARED ? \'共享时间\' : \'创建时间\'                  }}</span>                  <span class="item-descr-txt">{{ image.createTime }}</span>                </li>                <li>                  <span class="item-descr-tit">镜像描述</span>                  <span class="item-descr-txt" style="white-space: pre-wrap;">{{                    image.imageDescription || \'无\'                  }}</span>                </li>              </ul>            </div>          </div>        </div>      </div>      <div b-if="snapshotList && snapshotList.length" class="tc-g-u-1-2">        <div class="tc-panel">          <div class="tc-panel-hd">            <h3 class="title">关联的快照</h3>          </div>          <div class="tc-panel-bd">            <div class="tc-15-table-panel">              <div class="tc-15-table-fixed-head">                <table class="tc-15-table-box">                  <colgroup>                    <col />                    <col />                    <col style="width:100px;" />                    <col style="width:80px;" />                  </colgroup>                  <thead>                    <tr>                      <th>                        <div><span class="text-overflow">ID</span></div>                      </th>                      <th>                        <div><span class="text-overflow">名称</span></div>                      </th>                      <th>                        <div><span class="text-overflow">属性</span></div>                      </th>                      <th>                        <div>                          <span class="text-overflow">大小</span>                        </div>                      </th>                    </tr>                  </thead>                </table>              </div>              <div class="tc-15-table-fixed-body">                <table class="tc-15-table-box tc-15-table-rowhover">                  <colgroup>                    <col />                    <col />                    <col style="width:100px;" />                    <col style="width:80px;" />                  </colgroup>                  <tbody>                    <tr b-repeat="snapshotItem in snapshotList">                      <td>                        <div>                          <span class="text-overflow"                            ><a                              data-event="nav"                              href="{{ snapshotItem.snapshotDetailLink }}"                              >{{ snapshotItem.snapshotId }}</a                            ></span                          >                        </div>                      </td>                      <td>                        <div>                          <span class="text-overflow">{{                            snapshotItem.snapshotName                          }}</span>                        </div>                      </td>                      <td>                        <div>                          <span class="text-overflow">{{                            snapshotItem.diskUsageDesc                          }}</span>                        </div>                      </td>                      <td>                        <div>                          <span class="text-overflow">{{                            snapshotItem.diskSizeDesc                          }}</span>                        </div>                      </td>                    </tr>                  </tbody>                </table>              </div>            </div>          </div>        </div>      </div>    </div>    <!-- 参数列表 -->    <div class="tc-panel mt-20" b-if="canShare">      <div class="param-box" data-mod="share">        <div class="param-hd"><h3>镜像共享</h3></div>        <div class="param-bd">          <div class="tc-15-action-panel">            <qc-action-button              label="共享镜像"              disabled="{{ !canShareMore }}"              b-with="{action:share.bind(this)}"            ></qc-action-button>            <qc-action-button              label="取消共享"              disabled="{{ !hasSelected }}"              b-with="{action:cancel.bind(this)}"              attr="{{{\'data-title\':hasSelected?\'\':\'请选择要取消共享的账号\'}}}"            ></qc-action-button>            <!--              <qc-action-button float="right" class-name="weak setting" b-with="{action:setColumns.bind(this)}"></qc-action-button>            -->            <!--              <qc-search float="right" placeholder="搜索关键词" multiline="false" b-with="{search:search.bind(this)}" keyword="{{keyword}}"></qc-search>            -->          </div>          <share-grid            b-ref="grid"            b-with="gridCfg"            region-id="{{ regionId }}"            un-img-id="{{ image.unImgId }}"          ></share-grid>        </div>      </div>    </div>  </div>',
$beforeInit:function(){var a=this;a.gridCfg={_watchGrid:function(b){g.beeBind(b,a,"selectedNum"),g.beeBind(b,a,"totalNum")},doCancel:a.doCancel.bind(a)},d.__super__.$beforeInit.apply(a,arguments),g.beeBind(a,a,'image.imageType === TYPES.PRIVATE && !image.isInstanceImage && image.status === "NORMAL"',"canShare"),g.beeBind(a,a,"selectedNum>0","hasSelected"),g.beeBind(a,a,"totalNum<MAX_COUNT","canShareMore")},share:function(){var a=this;v({regionId:a.regionId,image:a.image}).done(function(){a.$refs.grid.bufferReload()})},cancel:function(a){var b=this,c=b.$refs.grid;b.doCancel(c.getSelected(),a.$el,b.$el)},doCancel:function(a,b,c){var d=this,e=d.$refs.grid;r.create('  <div class="coin-alert">    <table class="ui-popmsg">      <tbody>        <tr>          <td height="72" class="i"><i class="ico ico-warn mr10"></i></td>          <td height="72" class="t">            <span class="info">              <span class="tit">确定取消共享？</span> <br />            </span>          </td>        </tr>      </tbody>    </table>  </div>',480,"",{title:"取消共享",button:{" 确定 ":function(){k.cancelShareImage(d.regionId,d.image.unImgId,a.map(function(a){return a.accountId}),function(){r.hide(),e.bufferReload()})}}})}},{defaults:{MAX_COUNT:20,TYPES:w.TYPES,TYPE_NAMES:w.TYPE_NAMES}}),e=u.extend({$mixins:[s("cvm_image_share_columns_v20151215")],$afterInit:function(){var a,b=this;e.__super__.$afterInit.apply(b,arguments),b._watchGrid(b),a=b.bufferReload.bind(b),["regionId","unImgId"].forEach(function(c){b.$watch(c,a)}),a()},onRowCancel:function(a,b,c){this.doCancel([a],f(c.currentTarget),this.$gridBody)},getData:function(){var a=this,b=a.regionId,c=a.unImgId;a.showLoading("加载中..."),k.getImageShare(b,c,function(b){var c=b.response.sharePermissionSet;c.forEach(function(a){a.createdTime=g.formatDate(new Date(a.createdTime),"yyyy-MM-dd hh:mm:ss")}),a.setData({totalNum:c.length,list:c}),a.hideLoading()})}},{defaults:{colums:x(),outerPaging:!1,showPagination:!1,hasFirst:!0,emptyTips:"此镜像还没有共享给其它用户"}}),e.tag("cell-action",t),d.tag("share-grid",e),c.exports={title:"镜像-控制台",pageClass:"",render:function(a,b,c,d){(arguments.length<=2||3===arguments.length&&"object"===("undefined"==typeof c?"undefined":_typeof(c)))&&(d=c,c=b,b=w.TYPES.PRIVATE),h.appArea.html("");var e=this;e.regionId=a;var f,g=j.get("imagePackData");if(g)for(var k,l=0;k=g[l];l++)if(k.unImgId==c){f=k;break}f?e.renderUi(f,d):o.graphql({query:"query imageDetail($filters: [Filter], $limit: Int, $offset: Int){\n                        images(filters: $filters, limit: $limit, offset: $offset) {\n                            totalCount\n                            nodes {\n                                id\n                                unImgId\n                                imageName\n                                name\n                                imageDescription\n                                osName\n                                imageType\n                                createTime\n                                creator\n                                status\n                                size:imageSize\n                                snapshotSet {\n                                  snapshotId\n                                  diskUsage\n                                  diskSize\n                                }\n                                imageClass\n                            }\n                        }\n                    }",variables:{filters:[{name:"image-id",values:[c]}],limit:100,offset:0}},{tipErr:!1}).then(function(a){if(!a||!a.images)return void(a&&a.errors&&a.errors.length>0&&e.renderUi({error:a.errors[0]},d));var b={imageSet:a.images.nodes,totalCount:a.images.totalCount,error:a.error};a=b;for(var g,h=new i({data:a.imageSet}),j=0;g=h[j];j++)if(g.unImgId==c){f=g;break}f?e.renderUi(f,d):e.renderDetailNoData()},function(){e.renderDetailNoData()})},renderUi:function(a,b){a.unImgId=a.unImgId||"";var c=this;if(c.bee=new(q.extend({$tpl:'  <div class="manage-area">    <div class="manage-area-title secondary-title">      <a href="javascript:;" class="back-link" b-on-click="goBack()">        <i class="btn-back-icon"></i>返回</a      >      <span class="line-icon">|</span>      <h2>{{ unImgId }}（{{ imageName }}）</h2>    </div>    <div class="manage-area-main secondary-main">      <div class="manage-area-full-inner" id="detailInfo"></div>    </div>  </div>'}))({$data:{unImgId:a.unImgId,imageName:a.imageName},goBack:function(){for(var a=f(".qc-aside-level-1"),b="/",c=0;c<a.length;c++)if(a.eq(c).hasClass("qc-aside-select")){b=a.eq(c).attr("href");break}var d=location.search.match(/backfrom=(\w+)/);d&&d[1]?p.navigate(b+"?backfrom="+d[1]):p.navigate(b)}}),c.$el=f(c.bee.$el).appendTo(h.appArea.html("")),a&&a.error){var e=l.isCamRefused(a.error)?new l.CamTips("<div><cam-tips>"+a.error.message+"</cam-tips></div>"):new l.ErrorTips("<div><error-tips>"+a.error.message+"</error-tips></div>");return void f("#detailInfo").append(e.$el)}var g=new d({$data:{regionId:c.regionId,image:a}});f("#detailInfo").append(g.$el),a.snapshotSet&&a.snapshotSet.length&&n.querySnapshots({data:{SnapshotIds:a.snapshotSet.map(function(a){return a.snapshotId})},regionId:c.regionId}).then(function(a){var b=n.formatSnapshotList(a.response.snapshotSet);g.$set("snapshotList",b)});var i;b&&"unshare"in b&&(i=c.$el.find('[data-mod="share"]'),i[0]&&i[0].scrollIntoView({behavior:"smooth",block:"start"}))},renderDetailNoData:function(){var a='<div style="padding: 100px;text-align: center;">未查询到指定镜像，此镜像已下线或已被删除， <a href="/cvm/image" data-event="nav">返回列表</a></div>';h.appArea.html(a)},destroy:function(){this.$el&&this.$el.remove()}}}),define("cvm/image/hub",function(a,b,c){var d=(a("manager"),a("cvm/common/model")),e=function(a,b,c,e,f,g){return d.apiRequest({action:"ModifyImageSharePermission",serviceType:"image",data:{imageId:b,accountIds:c,permission:e},regionId:a},{tipErr:!1}).then(function(){f&&f()})["catch"](function(a){g&&g(a)})};c.exports={shareImage:function(a,b,c,d,f){return e(a,b,[c],"SHARE",d,f)},cancelShareImage:function(a,b,c,d,f){c&&c.length>0&&e(a,b,c,"CANCEL",d,f)},getImageShare:function(a,b,c,e){d.apiRequest({action:"DescribeImageSharePermission",serviceType:"image",data:{imageId:b},regionId:a}).then(function(a){c&&c(a)})["catch"](function(){e&&e()})}}}),define("modules/cvm/image/image",function(a,b,c){var d=a("$"),e=a("pageManager"),f=a("manager"),g=a("util"),h=a("appUtil"),i=a("event"),j=a("router"),k=a("panel"),l=a("cvm/image/detail"),m=a("dialog"),n=a("tips"),o=a("lengthlimiter"),p=a("validator"),q=a("reporter"),r=a("cvm/image/operate_auth"),s=a("cvm/image/copy"),t=a("cvm/image/data_package"),u=a("dataManager"),v=a("cvm/cvm/cvmutil"),w=a("cvm/cvm/data"),x=a("cvm/common/constants"),y=76,z=a("cvm/common/model"),A=a("cvm/image/search_box"),B=a("widget/grid/Action"),C=a("qccomponent"),D=a("widget/grid/LocalGrid"),E=a("cvm/image/share"),F=a("cvm/image/util"),G=a("widget/detail/detail"),H=a("widget/step/steps"),I=a("widget/baseInfo/validator"),J=a("cvm/common/components/SmartHelper"),K=a("cvm/common/components/columsWidth/ColumsWidth"),L=a("widget/mfa/mfa"),M=(a("cvm/common/components/regionPills"),new I({errClass:"is-error",rules:{name:function(a){var b;return 0==a.length?b="镜像名称不能为空":a.length>60?b="镜像名称不能超过60个字符":/^[0-9a-zA-Z-\u4e00-\u9fa5]{1,60}$/.test(a)||(b="请输入格式正确的名称"),b},version:function(a){var b;return b=/\S+/.test(a)?!1:"系统版本不能为空"},regionId:function(a){var b;return""==a&&(b="请选择地域"),b},osBits:function(a){var b;return""==a&&(b="请选择系统架构"),b},osName:function(a){var b;return""==a&&(b="请选择系统平台"),b}}})),N=["1","4","5","6","7","8","9","11","15","16","17","18","19","21","22","23","24","25","33","36","37","39","46"],O=Object.keys(x.REGIONNAMES||{}).reduce(function(a,b){var c=x.REGIONNAMES[b],e={};return e[b]=c,N.indexOf(b+"")>-1?d.extend(a,e):a},{}),P={0:"非导入",1:"导入"},Q=null,R={},S=null,T={main:'  <div class="manage-area" id="imgAllWrap">    <style>      .oper-cell .tc-15-dropdown {        font-size: 12px;      }      .oper-cell .tc-15-dropdown .tc-15-dropdown-link {        height: 19px;        line-height: 19px;      }      .tc-select-tags-search {        float: right;      }    </style>    <div class="manage-area-title">      <h2>镜像</h2>      <div id="regionWrapper" class="tc-select-box">        <cvm-region-pill b-ref="regionPill" b-model="regionId">        </cvm-region-pill>      </div>    </div>    <div class="manage-area-main">      <div class="tc-15-tab tc-15-tab-alt trash-tab tc-special-tab">        <ul role="tablist" class="tc-15-tablist" style="border-top:1px solid #ccc">          <li b-repeat="tab in imageTypeTabs" class="{{imageType == tab.type ? \'tc-cur\' : \'\'}}">            <a href="/cvm/image?rid={{regionId}}&imageType={{tab.type}}" data-event="nav" role="tab">{{tab.name}}</a>          </li>        </ul>        <div class="tc-15-msg msg-dot">          <div class="tip-info">            <p>温馨提示：</p>            <ol>              <li class="num-item">                <p>                  <span class="num">1</span>                  腾讯云预计在2020第一季度对未计费的自定义镜像按照实际占据的快照容量计费，届时您可前往<a href="/cvm/snapshot"                    data-event="nav">快照列表页</a>和镜像详情页查看更新后的镜像关联快照信息。                </p>              </li>              <li class="num-item">                <p>                  <span class="num">2</span>                  镜像的底层数据存储使用了云硬盘快照服务，                  <span b-if="!isI18n" class="text-danger">云硬盘快照已于2019年1月22日0点启动正式商业化</span>                  <span b-if="isI18n" class="text-danger">云硬盘快照（国际站）将于2019年3月1日启动正式商业化</span>                  ，保留自定义镜像会产生一定的快照费用。详细可见                  <a href="{{ isI18n ? \'//intl.cloud.tencent.com/document/product/213/30265\' : \'//cloud.tencent.com/document/product/362/17935\'}}"                    target="_blank" class="guide-link" rel="noopener noreferrer">快照商业化FAQ<i                      class="external-link-icon"></i></a>                </p>              </li>              <li class="num-item">                <p>                  <span class="num">3</span>                  您可以根据使用规划来调整使用策略，减少可能的开销：                </p>                <ul>                  <li class="dot-item">创建自定义镜像的同时系统默认会创建相关快照，删除此快照之前需要先删除关联的镜像。您可在镜像详情中查看镜像关联的快照信息。</li>                  <li class="dot-item">共享镜像只收取当前账号的快照费用，被共享镜像的账号不收费。</li>                  <li class="dot-item">镜像产生的快照按照实际容量收费，您可在快照概览中查看快照总容量。</li>                </ul>              </li>              <li class="num-item" b-if="!isI18n && imageType == TYPES.PRIVATE && isImportVisible">                <p>                  <span class="num">4</span>                  导入镜像目前只支持大小在50G以内的镜像，若您需要导入的镜像大小超过50G，可通过离线迁移的方式导入。详细可见<a                    href="//cloud.tencent.com/document/product/213/19233" target="_blank" class="guide-link">服务迁移文档<i                      class="external-link-icon"></i></a>                </p>              </li>              <li class="num-item"                b-if="!isI18n && imageType == TYPES.PRIVATE && isImportVisible && hasImportFailedImage">                <p>                  <span class="num">5</span>                  若镜像导入失败，请在站内信中查看具体原因。或考虑采用<a href="//console.cloud.tencent.com/cvm/csm" data-event="nav"                    class="guide-link">服务迁移</a>的方式来导入                </p>              </li>            </ol>          </div>        </div>        <div class="tab-panel">          <div class="manage-area-full-inner">            <div class="tc-15-action-panel" id="imgOperWrap">              <button class="tc-15-btn m disabled" data-name="add" data-event="img_oper">创建实例</button>              <button b-if="imageType == TYPES.PRIVATE && regionId != 31 && regionId != 32 && regionId != 39"                class="tc-15-btn m weak disabled" data-name="copy" data-event="img_oper">跨地域复制</button>              <button b-if="imageType == TYPES.PRIVATE && isImportVisible" class="tc-15-btn m weak" data-name="import"                data-event="img_oper">导入镜像</button>              <button b-if="imageType == TYPES.PRIVATE" class="tc-15-btn m weak disabled" data-name="del"                data-event="img_oper">删除</button>              <div id="searchArea" style="width:400px;float: right;"></div>              <!-- <button b-if="imageType == TYPES.PRIVATE" class="tc-15-btn m disabled" data-name="mod" data-event="img_oper">修改</button> -->            </div>            <div id="imageList"></div>          </div>        </div>      </div>    </div>  </div>',delDialog:'  <div class="coin-alert">    <table class="ui-popmsg">      <tbody>        <tr>          <td height="72" class="i">            <i class="ico ico-warn mr10"></i>          </td>          <td height="72" class="t">            <span class="info">              <span class="tit">确定删除选中的镜像？</span>              <br>            </span>          </td>        </tr>      </tbody>    </table>  </div>',modDialog:'  <div class="edit_form_wrap">    <ul class="edit_psword">      <li>        <label class="txt" for="">镜像ID:</label>        <span id="imageId"></span>      </li>      <li>        <label class="txt" for="">镜像名称:</label>        <input type="text" id="imageName" data-lenLimit=\'60\' relTipId=\'imageNameTip\' maxlength=\'60\'          class="tc-15-input-text m">        <p><span class="tip">支持中文、字母、数字、连接符号，</span><span class="tip" id="imageNameTip"></span></p>      </li>      <li>        <label class="txt" for="">镜像描述:</label>        <textarea id="imageDesc" class="tc-15-input-textarea"></textarea>      </li>    </ul>  </div>',importDialogHeader:'  <div class="manage-area-title secondary-title">    <a href="javascript:;" b-on-click="back()" class="back-link">      <i class="btn-back-icon"></i>镜像</a>    <span class="line-icon">|</span>    <h2>导入镜像</h2>  </div>',importDialogContent:'  <div class="manage-area-main secondary-main mirror-import-wrap">    <add-steps options="{{options}}" steps="{{steps}}" b-ref="steps" back="{{back.bind(this)}}"      confirm="{{confirm.bind(this)}}" _download-cfg="{{_downloadCfg.bind(this)}}" cancel="{{cancel.bind(this)}}">    </add-steps>  </div>',importDialogFOOTER:'  <div class="create-2-btn-ground" b-if="showBtns" style="margin-bottom: 1.5em;overflow:hidden">    <button b-ref="prev" b-if="curStep" type="button" class="tc-15-btn weak {{disable ? \'disabled\' : \'\'}}"      disabled?="disable" b-on-click="prev()">{{prevBtn}}</button>    <button b-ref="next" type="button" class="tc-15-btn {{disable ? \'disabled\' : \'\'}}" disabled?="disable"      b-on-click="next()">{{curStep      == steps.length -1 ? confirmBtn : nextBtn}}</button>    <button b-ref="cancel" b-if="cancel" type="button" class="tc-15-btn weak"      b-on-click="_cancel()">{{cancelBtn}}</button>  </div>',importDialogSTEP1:'  <div class="system-select-wrap">    <div class="system-select">      <span>您准备导入的镜像操作系统</span>      <select name="osType" class="tc-15-select m">        <option value="linux" <% if(osType=="Linux" ){ %>selected="selected" <%}%> >Linux        </option>        <option value="windows" <% if(osType=="Windows" ){ %>selected="selected" <%}%> >Windows        </option>      </select>    </div>    <div class="mirroring-inf">      <ul class="mirroring-inf-ul">        <li>          <i class="num">1</i>          <strong>准备镜像文件</strong>          <p class="limit-txt text-label">您制作的镜像必须符合镜像导入限制：</p>          <table class="import-limit">            <tbody>              <tr>                <td class="tit">                  <strong>操作系统</strong>                </td>                <td>                  <ul>                    <% for (var item in osName) { %> <li>          <%= osName[item] %>          </li>          <% } %>          </ul>          </td>          </tr>          <tr>            <td class="tit">              <strong>镜像格式</strong>            </td>            <td>              <ul>                <li>RAW格式</li>                <li>QCOW2格式</li>                <li>VHD格式</li>                <li>VMDK格式</li>              </ul>            </td>          </tr>          <tr>            <td class="tit">              <strong>文件系统</strong>            </td>            <td>              <%= fs %>            </td>          </tr>          <tr>            <td class="tit">              <strong>限制</strong>            </td>            <td>              <ul>                <% for (var i=0, item; item = limit[i]; i++) { %>                <li>                  <%= item %>                </li>                <% } %>                <li>支持镜像强制导入，需要预先对镜像进行配置，详细请见                  <a href="https://cloud.tencent.com/document/product/213/12849" target="_blank">强制导入镜像                    <i class="external-link-icon"></i>                  </a>                </li>                <li>若镜像大于50G，可通过过离线迁移的方式导入。详细请见                  <a href="//cloud.tencent.com/document/product/213/19233" target="_blank">离线迁移                    <i class="external-link-icon"></i>                  </a>                </li>                <li>更多限制，详细请见                  <a href="https://cloud.tencent.com/document/product/213/4945" target="_blank">导入镜像                    <i class="external-link-icon"></i>                  </a>                </li>              </ul>            </td>          </tr>          </tbody>          </table>          </li>          <li>            <i class="num">2</i>            <strong>开通              <a href="https://console.qcloud.com/cos5" target="_blank">对象存储服务                <i class="external-link-icon"></i>              </a>            </strong>          </li>          <li>            <i class="num">3</i>            <strong>创建              <a href="https://console.cloud.tencent.com/cos5" target="_blank">bucket                <i class="external-link-icon"></i>              </a>            </strong>          </li>          <li>            <i class="num">4</i>            <strong>上传镜像文件到bucket，并获取              <a href="https://www.qcloud.com/document/product/213/4945" target="_blank">镜像文件URL                <i class="external-link-icon"></i>              </a>            </strong>          </li>          </ul>          <div class="ok-select">            <input id="ready" name="ready" type="checkbox" class="tc-15-checkbox">            <label for="ready" style="cursor:pointer">我已做好以上准备</label>          </div>    </div>  </div>  <div class="line-partition"></div>',importDialogSTEP2:'  <div class="system-select-wrap">    <ul class="form-list">      <li>        <div class="form-label required">          <label for="">镜像文件URL</label>        </div>        <div class="form-input">          <div class="form-unit">            <input id="imgCosUrl" type="text" class="tc-15-input-text m" placeholder="镜像所在COS的对象地址URL">            <b class="icon-valid-flag"></b>            <span id="validLoadingTip" class="valid-result"></span>            <p class="form-input-help" style="display:none">请输入正确的URL地址</p>          </div>        </div>      </li>      <li>        <div class="form-label required">          <label for="">镜像名称</label>        </div>        <div class="form-input">          <div class="form-unit">            <input id="imgName" type="text" class="tc-15-input-text m" maxlength=\'60\' data-validate="name"              placeholder="导入镜像后显示的名称">            <b class="icon-valid-flag"></b>          </div>        </div>      </li>      <li>        <div class="form-label required">          <label for="">地域</label>        </div>        <div class="form-input">          <div class="form-unit">            <select id="regionId" class="tc-15-select m" data-validate="regionId">              <option value="">请选择地域</option>              <% for(var item in region){ %>              <option value="<%= item%>">                <%= region[item]%>              </option>              <% } %>            </select>            <b class="icon-valid-flag"></b>          </div>        </div>      </li>      <li>        <div class="form-label required">          <label for="">操作系统</label>        </div>        <div class="form-input">          <p>            <%= osType %>          </p>        </div>      </li>      <li>        <div class="form-label required">          <label for="">系统架构</label>        </div>        <div class="form-input">          <div class="form-unit">            <select id="osBits" class="tc-15-select m" data-validate="osBits">              <option value="">请选择系统架构</option>              <option value="x86_64">64位</option>              <option value="i386">32位</option>            </select>            <b class="icon-valid-flag"></b>          </div>        </div>      </li>      <li>        <div class="form-label required">          <label for="">系统平台</label>        </div>        <div class="form-input">          <div class="form-unit">            <select id="osName" class="tc-15-select m" data-validate="osName">              <option value="">请选择系统平台</option>              <% for(var item in osName) {%>              <option value="<%= osName[item] %>">                <%= osName[item] %>              </option>              <% } %>            </select>            <b class="icon-valid-flag"></b>          </div>        </div>      </li>      <li>        <div class="form-label">          <label for="">系统版本</label>        </div>        <div class="form-input">          <div class="form-unit">            <select id="osVersion" class="tc-15-select m" data-validate="version">              <option value="">请选择系统版本</option>            </select>            <b class="icon-valid-flag"></b>          </div>        </div>      </li>      <li>        <div class="form-label">          <label for="">镜像描述(选填)</label>        </div>        <div class="form-input">          <textarea id="imgDesc" class="mirror-txt"></textarea>          <b class="icon-valid-flag"></b>        </div>      </li>      <li>        <div class="form-label">          <label for="">导入方式</label>        </div>        <div class="form-input">          <select id="importMode" class="tc-15-select m" data-validate="version">            <option value="normal">正常</option>            <option value="force">强制</option>          </select>          <span class="text-danger" id="forceImportTip" style="display:none">强制导入的镜像须按照指引进行配置，否则该镜像创建的实例将无法正常初始化，参考            <a href="https://cloud.tencent.com/document/product/213/12849" target="_blank">强制导入镜像              <i class="external-link-icon"></i>            </a>          </span>        </div>      </li>    </ul>  </div>  <div class="line-partition"></div>',importTip:'  <div class="dialog_layer_cont">    <div class="coin-alert">      <table class="ui-popmsg">        <tbody>          <tr>            <td height="72" class="i">              <i class="ico ico-warn mr10"></i>            </td>            <td height="72" class="t">              <span class="info">导入过程将持续一段时间，请耐心等待。导入结果将以站内信和邮件的方式通知。若导入失败，可以采用服务迁移的方式来导入，详细可见                <a href="//cloud.tencent.com/document/product/213/19233" className="tc-external-link-btn black"                  target="_blank" rel="noopener noreferrer">                  服务迁移文档<i class="external-link-icon"></i>                </a>。</span>            </td>          </tr>        </tbody>      </table>    </div>  </div>',creDialog:'  <div class="coin-alert">    <table class="ui-popmsg">      <tbody>        <tr>          <td height="72" class="i">            <i class="ico ico-warn mr10"></i>          </td>          <td height="72" class="t">            <span class="info">              <span class="tit">确定使用选择的镜像创建实例？</span>              <br>              <span b-if="isInstanceImage">注意：整机镜像不支持本地盘创建，请选择支持云盘的机型。</span>            </span>          </td>        </tr>      </tbody>    </table>  </div>'},U=F.TYPES,V=[U.PUBLIC,U.PRIVATE,U.SHARED],W=V.map(function(a){return{type:a,name:F.TYPE_NAMES[a]}}),X=["del","add","mod","import","copy","share","unshare"],Y=function(a){var b=d("#imageList");b.find(".current").removeClass("current"),d(a).addClass("current")},Z=function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];L.verify({api:"cvm:DeleteImages"}).then(function(){var b=a.map(function(a){return a.unImgId});m.create(T.delDialog,480,"",{title:"删除镜像",button:{" 确定 ":function(){m.hide();for(var c=0;c<b.length;c++)ja.setLoading(d("tr[data-imgid="+b[c]+"]"),"删除中");var e=h.getRegionId();z.apiRequest({action:"DeleteImages",serviceType:"cvm",data:{imageIds:b},regionId:a[0]&&a[0].regionId}).then(function(a){var b=function c(){w.queryTaskFlow({taskId:a.response.taskId,regionId:e}).then(function(a){var b=a.response.status;"SUCCESS"==b?(ja.refresh(),n.success("删除镜像成功")):"FAILED"==b?(ja.refresh(),n.error("删除镜像失败")):setTimeout(c,1e3)})};b()},function(){ja.refresh()})["catch"](function(a){console.warn(a)})}}})}),q.click("jingxiang.delete")},$=function(){var a,b,c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=c[0]||{};m.create(T.modDialog,550,"",{title:"修改镜像",preventResubmit:!0,button:{" 确定 ":function(){var c=a.val(),d=b.val(),f=function(a,b){var c={tip:a};return p.showErr(b,c)};if(0==c.length||c.length>60||d.length>60){if(0==c.length)return f("镜像名称不能为空",a);if(c.length>60)return f("镜像名称不能超过60个字符",a);if(d.length>60)return f("镜像描述不能超过60个字符",b)}else{if(!/^[0-9a-zA-Z-\u4e00-\u9fa5]{1,60}$/.test(c))return f("请输入格式正确的名称",a);z.apiRequest({action:"ModifyImageAttribute",serviceType:"image",data:{imageId:e.unImgId,imageName:c,imageDescription:d},regionId:e.regionId}).then(function(a){m.hide(),ja.refresh()})["catch"](function(a){console.warn(a)})}}}}),a=d("#imageName").val(e.imageName),b=d("#imageDesc").val(e.imageDescription),d("#imageId").text(e.unImgId),o.trigger(60),q.click("jingxiang.revise")},_=G.extend({$afterInit:function(){_.__super__.$afterInit.call(this);var a=this.$refs.steps;a.$watch("curStep",function(b){a.$set({confirmBtn:"开始导入",cancel:!1,nextBtn:1==b?"完成":"下一步"})}),d(a.$refs.next).prop("disabled",!0).addClass("disabled"),d(document).on("change",'[name="ready"]',function(){var b=d(this).prop("checked");b?d(a.$refs.next).removeAttr("disabled").removeClass("disabled"):d(a.$refs.next).attr("disabled","disabled").addClass("disabled")})},back:function(a){var b=this;a?(b.$refs.steps.$set({curStep:0}),history.back()):m.confirm("配置内容尚未完成，你要离开此页吗？",function(){b.$refs.steps.$set({curStep:0}),history.back()},function(){},"配置未完成","","离开此页")}},{defaults:{title:"导入镜像",headerTpl:T.importDialogHeader,content:T.importDialogContent,ClassName:"manage-area"}}),aa=H.extend({footerTpl:T.importDialogFOOTER});_.tag("add-steps",aa);var ba=function(){this.$importImgEl=e.appArea,this.data={linux:{osType:"Linux",osName:{},fs:"MBR分区的ext3或ext4文件系统，不支持GPT分区",limit:["镜像大小不超过50G","最好是原生内核，如果有修改可能会导致虚拟机无法导入"],region:O},windows:{osType:"Windows",osName:{},fs:"MBR分区的ntfs 文件系统，不支持GPT分区",limit:["镜像大小不超过50G"],region:O}};var a=this;this.GetExternalImageOs().done(function(b){b.response&&b.response.importImageOsListSupported&&(a.data.linux.osName=b.response.importImageOsListSupported.linux,a.data.windows.osName=b.response.importImageOsListSupported.windows,a.importImageOsListSupported=v.toUpperCaseFL(b.response.importImageOsVersionSupported)),a.render(),a.bindEvt()})};ba.prototype.render=function(){var a=this;this.importVm=new _({steps:[{title:"导入镜像前准备",content:g.tmpl(T.importDialogSTEP1,a.data.linux)},{title:"导入镜像",content:g.tmpl(T.importDialogSTEP2,a.data.linux),confirm:function(b,c){var e=+d("#regionId").val(),f={ImageUrl:d.trim(d("#imgCosUrl").val()),ImageName:d.trim(d("#imgName").val()).toLowerCase(),Architecture:d("#osBits").val(),OsType:d("#osName").val(),OsVersion:d.trim(d("#osVersion").val()),ImageDescription:d.trim(d("#imgDesc").val()),Force:"force"==d.trim(d("#importMode").val())?!0:void 0},g=this.$refs.next;a.checkAll(g,function(){a.exec(e,f)})}}]}),this.$importImgEl.html(this.importVm.$el)},ba.prototype.bindEvt=function(){var a=this;a.$importImgEl.off("change.importimg").on("change.importimg",'[name="osType"]',function(b){var c=d(this).val();a.selectedChange(c)}),a.$importImgEl.off("blur.imgCosUrl").on("blur.imgCosUrl","#imgCosUrl",function(b){a.checkCosUrl()}),a.$importImgEl.off("blur.imgName").on("blur.imgName","#imgName",function(a){M.validate(this,{noTips:!0})||setTimeout(function(){M.showErr(d("#imgName")[0],"请输入格式正确的名称")},100)}),a.$importImgEl.on("change","#regionId",function(a){var b=d(this).val();h.setRegionId(b)}),a.$importImgEl.on("change","#osName",function(b){var c=d(b.target).val(),e=a.importImageOsListSupported[c]||[],f='<option value="">请选择系统版本</option>';e.forEach(function(a,b){f+='<option value="'+a+'">'+a+"</option>"}),d("#osVersion").html(f)}),a.$importImgEl.on("change","#importMode",function(a){var b=d(a.target).val(),c=d("#forceImportTip");"force"==b?c.show():c.hide()})},ba.prototype.selectedChange=function(a){var b=this.importVm.$refs.steps.$refs,c=b.steps;d(c[0].$el).html(g.tmpl(T.importDialogSTEP1,this.data[a])),d(c[1].$el).html(g.tmpl(T.importDialogSTEP2,this.data[a])),d(b.next).prop("disabled",!0).addClass("disabled")},ba.prototype.GetExternalImageOs=function(a){var b=d.Deferred();return z.apiRequest({cmd:"DescribeImportImageOs",serviceType:"image",data:a,regionId:h.getRegionId()},{camTipsType:"dialog"}).then(function(a){b.resolve(a)},function(a){b.reject(a)})["catch"](function(a){console.warn(a)}),b},ba.prototype.checkAll=function(a,b){var c=this;this.checkCosUrl(function(){M.btn=a,M.validateAll(c.$importImgEl[0])&&b&&b()})},ba.prototype.checkCosUrl=function(a){var b=d.trim(d("#imgCosUrl").val()),c=/^((http|https|ftp):\/\/)?(\w(\:\w)?@)?([0-9a-z_-]+\.)*?([a-z0-9-]+\.[a-z]{2,6}(\.[a-z]{2})?(\:[0-9]{2,6})?)((\/[^?#<>\/\\*":]*)+(\?[^#]*)?(#.*)?)?$/i;return c.test(b)?(d("#imgCosUrl").addClass("loading"),d("#validLoadingTip").html("URL验证中...").show(),void z.apiRequest({serviceType:"image",action:"ImportImage",data:{OsType:"CentOS",Architecture:"x86_64",OsVersion:"6",ImageUrl:b,ImageName:"testImageUrl",DryRun:!0},regionId:h.getRegionId()},{tipErr:!1}).then(function(b){b.response&&b.response.error?(M.showErr(d("#imgCosUrl")[0],"镜像文件URL错误"),d("#imgCosUrl").removeClass("loading"),d("#validLoadingTip").hide()):(M.hideErr(d("#imgCosUrl")[0]),d("#imgCosUrl").removeClass("loading"),d("#validLoadingTip").html("URL验证成功！").fadeOut(2e3),a&&a())},function(a){M.showErr(d("#imgCosUrl")[0],"镜像文件URL错误"),d("#imgCosUrl").removeClass("loading"),d("#validLoadingTip").hide()})["catch"](function(a){console.warn(a)})):void setTimeout(function(){M.showErr(d("#imgCosUrl")[0],"输入的镜像文件URL不合法")},100)},ba.prototype.exec=function(a,b){z.graphql({query:"query imageList($filters: [Filter], $limit: Int, $offset: Int){\n                images(filters: $filters, limit: $limit, offset: $offset) {\n                    totalCount\n                    nodes {\n                        imageName:name\n                    }\n                }\n            }",variables:{filters:[{name:"image-type",values:[F.TYPES.PRIVATE]}],limit:100,offset:0}}).then(function(c){if(c&&c.images){var e={imageSet:c.images.nodes,totalCount:c.images.totalCount};c=e;for(var f,g=0;f=c.imageSet[g];g++)if(b.imgName==f.imageName.toLowerCase())return void M.showErr(d("#imgName")[0],"输入的名称已经存在");z.apiRequest(_defineProperty({regionId:a,serviceType:"image",cmd:"ImportImage",data:b},"regionId",a),{camTipsType:"dialog"}).then(function(a){m.create(T.importTip,"550","",{title:"正在导入",preventResubmit:!1,defaultCancelBtn:!1,button:{" 确定 ":function(a){j.navigate("/cvm/image")}}})})["catch"](function(a){console.warn(a)})}})};var ca=function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],b=a[0]||{},c={tab:"custom",imageId:b.imageId,osfrom:b.imageSource&&"EXTERNAL_IMPORT"===b.imageSource?"externalimg":{PRIVATE_IMAGE:"osimg",PUBLIC_IMAGE:"system",SHARED_IMAGE:"shareimg"}[b.imageType],regionId:b.regionId},d=new C({$tpl:T.creDialog,$data:{isInstanceImage:b.isInstanceImage}});m.create(d.$el,480,"",{title:"创建云主机",button:{" 确定 ":function(){m.hide(),b.imageType===U.PUBLIC?(c.osName=b.osKey,c.osDesc=b.descOsName):c.imgId=b.deviceImageId,window.open("https://buy.qcloud.com/cvm?"+Object.keys(c).map(function(a){return encodeURIComponent(a)+"="+encodeURIComponent(c[a])}).join("&"))}}}),q.click("jingxiang.new")},da=function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],b=a[0]||{};
E({regionId:b.regionId,image:b})},ea=function(a,b){var c=[{key:"idName",name:"ID/名称",_minWidth:84,priority:1},{key:"statusDesc",name:"状态",_minWidth:24,_maxWidth:96,priority:3},{key:"imageType",name:"类型",tdTpl:'{{TYPE_NAMES[item.imageType]}} {{item.imageSource=="EXTERNAL_IMPORT" ? "[导入]" :""}}',_minWidth:48,_maxWidth:120,priority:7},{key:"disksize",name:"容量",_minWidth:36,_maxWidth:96,priority:6},{key:"descOsName",name:"操作系统",_minWidth:90,priority:5},{key:"createTime",name:a===U.SHARED?"共享时间":"创建时间",_minWidth:120,_maxWidth:196,priority:4,tdTpl:'{{item.createTime || "-"}}'},{key:"_action",name:"操作",_minWidth:152,priority:2,tdTpl:'  <div class="oper-cell">    <div b-template b-repeat="action in getActions(item, $parent.$index, $parent.$parent.list.length)">      <cell-action b-with="action"></cell-action>    </div>  </div>'}];return c=K(c,null,b,!0)},fa=function(a,b){return a={"data-imgId":b.unImgId},b.$loading&&(a["data-isLoading"]=!0),a},ga=function(a,b,c){return"idName"==c.key?g.tmpl('  <p>    <% if (item.canGotoDetail) { %>    <a data-event="nav" href="/cvm/image/detail/<%- regionId %>/<%- item.imageType %>/<%- item.unImgId %>">      <%= item.unImgId || "" %>    </a>    <% } else { %>    {{ item.unImgId }}    <% } %>  </p>  <p>    <span class="m-width" title="<%=item.imageName%>">      <%=item.imageName%>    </span>  </p>',{item:b,regionId:ja.getRegionId()}):"statusDesc"==c.key?g.tmpl('  <% if (item.status === "SYNCING") { %>  <div>    <span class="status-col">      <span class="text-overflow">        <%=item.statusDesc%>      </span>    </span>  </div>  <table style="width:100%;">    <tbody>      <tr>        <!-- <td class="item-dd-bar" style="border-bottom-width:0px;padding:0px;height:inherit;width:75%;"> -->        <!-- <div class="mod-progress"> -->        <!-- <span class="mod-bar" style="width:<%=item.syncProgress%>%;"></span> -->        <!-- </div> -->        <!-- </td> -->        <td class="item-dd" style="border-bottom-width:0px;padding:0px;height:inherit;width:25%;">          <div class="cell-box" style="padding: 0px;">            <!-- <%=item.syncProgress%>% -->          </div>        </td>      </tr>    </tbody>  </table>  <% } else if(item.status === "IMPORTFAILED"){ %>  <span class="text-danger">    <%=item.statusDesc%>    <a class="text-danger" title="查看导入失败原因" target="_blank"      href="//cloud.tencent.com/document/product/213/4945#.E5.AF.BC.E5.85.A5.E5.A4.B1.E8.B4.A5">      <i class="n-error-icon"></i>    </a>  </span>  <% } else if(item.status === "CREATEFAILED"){ %>  <span class="text-danger">    <%=item.statusDesc%>  </span>  <% } else { %>  <span class="text-overflow m-width">    <i b-if="item.status === \'CREATING\'" class="n-loading-icon"></i>    <%=item.statusDesc%>  </span>  <% } %>',{item:b,regionId:ja.getRegionId()}):void 0},ha=null,ia=function(){ha=null},ja={title:"镜像-控制台",render:function(){h.isI18n()||J.show(),ia(),ha&&ha.hottag("renderImageData","beforeRender");var a=this;if("detail"===arguments[0])return l.render.apply(l,[].slice.call(arguments,1));if("import"===arguments[0])return new ba;this.queryStr=arguments[0];var b=this.getRegionId(),c=new C(T.main,{regionId:b,imageType:this.getImageType(),imageTypeTabs:W,TYPES:U,isImportVisible:!1,isI18n:h.isI18n()});nmc.render(c.$el,"cvm"),a.pageBee=c,a.imgListEl=d("#imageList"),a.needSpeedReport=!0,a.initWidget(),a.bindEvt(),A.init({callback:function(b){a.getList(void 0,d.extend(!0,{},b,{page:1}))}}),f.queryWhiteList({whiteKey:["import-image","image_global_sync","under_security_control","serviceMigrate","Image_50gCrossRegionReplication"]},function(d){var e=d["import-image"],f=d.image_global_sync,g=d.under_security_control;a.whiteListMap=d,a.isUnderSecurityControlUser=!!g,a.isImportImageUser=!!e,a.isSyncGlobalImageUser=!!f,c.$set({isServiceMigrateUser:!!d.serviceMigrate,isImportVisible:a.isImportImageUser&&!a.isUnderSecurityControlUser&&O[b]})})},initWidget:function(){this.initGridView()},bindEvt:function(){var a=this,b=this.imgListEl;b.on("click",'input[type="checkbox"]',function(b){setTimeout(function(){a.selectedChange()},0)}),i.bindCommonEvent(d("#imgAllWrap")[0],"click",{img_oper:function(){var b=d(this);b.hasClass("disabled")||a.exec(b.attr("data-name"))}}),this.pageBee.$refs.regionPill.$on("selected",function(b){var c=b.regionId;a.pageBee.$set("regionId",c),a.getList({regionId:c})})},exec:function(a,b){var c=this,d=[];switch(b?d=b.map(function(a){return a.unImgId}):(b=c.gridView.getSelected()||[],b.forEach(function(a){d.push(a.unImgId)})),a){case"del":Z(b);break;case"mod":$(b);break;case"import":j.navigate("/cvm/image/import"),q.click("jingxiang.import");break;case"add":ca(b);break;case"share":da(b);break;case"unshare":b[0]&&j.navigate("/cvm/image/detail/"+b[0].regionId+"/"+b[0].imageType+"/"+b[0].unImgId+"?unshare");break;case"copy":c.copyImg=new s({imgIds:d,imgMap:R,listObj:c,regionId:b[0]&&b[0].regionId||c.pageBee.$refs.regionPill.regionId})}},selectedChange:function(){var a=S&&S.getSelected();a&&this.toggleBtnStatus(a,d("#imgOperWrap"))},displayOperMenu:function(a,b){this.toggleBtnStatus([R[d(b).attr("data-imgid")]],a)},toggleBtnStatus:function(a,b){var c=this.whiteListMap,d=new r({dataItems:a,operAction:X,whiteListMap:c}),e=d.getAuth();X.forEach(function(a){var c=b.find('[data-name="'+a+'"]');0==e[a].code?h.enableBtn(c):h.disableBtn(c,e[a].tip)})},getRegionId:function(){return this.queryStr&&this.queryStr.rid?this.queryStr.rid:h.getRegionId()},getImageType:function(){return this.queryStr&&this.queryStr.imageType?this.queryStr.imageType:U.PRIVATE},getList:function(a,b){R={},b=d.extend({page:S&&S.page||1,count:S&&S.count||20,regionId:this.pageBee.$refs.regionPill.regionId||this.getRegionId()},b);var c=this,e=A.getState()&&A.getState().filter(function(a){return a.attr}).map(function(a){return{Name:a.attr.key,Values:a.values.map(function(a){return a.name})}}),f=[c.getImageType()||U.PRIVATE];c.getImageType()==U.PRIVATE&&f.push(U.IMPORTING),b.Filters=(b.Filters||e||[]).reduce(function(a,b){return a.concat({name:b.Name,values:b.Values})},[{name:"image-type",values:f}]),z.graphql({query:"query imageList($filters: [Filter], $limit: Int, $offset: Int, $language: String){\n                    images(filters: $filters, limit: $limit, offset: $offset, language: $language) {\n                        totalCount\n                        nodes {\n                            id\n                            unImgId\n                            imageName\n                            name\n                            imageDescription\n                            osName\n                            osKey\n                            deviceImageId\n                            imageType\n                            createTime\n                            creator\n                            status\n                            size:imageSize\n                            operateAuth:operationMask\n                            syncProgress\n                            imageSource\n                            snapshotSet {\n                              snapshotId\n                              diskUsage\n                              diskSize\n                            }\n                            imageClass\n                        }\n                    }\n                }",variables:{filters:b.Filters,limit:b.count||20,offset:(b.page-1)*(b.count||20),innerSearch:b.innerSearch},regionId:b.regionId},{tipErr:!1}).then(function(a){if(ha&&ha.hottag("renderImageData","afterRender"),a.errors&&a.errors.length>0&&(!a.images||!a.images.nodes||0==a.images.nodes.length)){S.setData({list:[]});for(var e=0;e<a.errors.length;e++){var f=a.errors[e];c.gridView.showTips('<span class="text" style="word-wrap:break-word;">'+f.message+'<a data-event="imagenav" href="javascript:void(0);">返回列表</a></span>');break}return void d("[data-event=imagenav]").unbind().click(function(){j.navigate("/cvm/image")})}var g={imageSet:a.images.nodes,totalCount:a.images.totalCount};a=g;var i=a.imageSet,k=a.totalCount;c.imgList=new t({data:i,regionId:b.regionId}),d.each(c.imgList,function(a,b){R[b.unImgId]=b}),u.set("imagePackData",c.imgList),c.pageBee.$set("hasImportFailedImage",c.imgList.some(function(a){return"IMPORTFAILED"==a.status})),S&&S.setData({list:c.imgList,totalNum:k}),S&&S.$set("page",b.page),c.needSpeedReport&&(h.speedReport("image"),c.needSpeedReport=!1),c.detailImgId&&Y(d("#imageList").find('tr[data-imgid="'+c.detailImgId+'"]')),c.checkTask(),c.selectedChange()})},refresh:function(){this.gridView.refresh()},checkTask:function(){var a=this,b=this.imgListEl.find("tr");this.isWating=!1,b.each(function(b,c){var e=d(c);return e.attr("data-isLoading")?(a.isWating=!0,!1):void 0}),this.clearCheckTask(),this.isWating&&(this.watingTime=setTimeout(function(){b.find(":checkbox:checked").length||h.isContextMenuShow()||B.isMenuActivated(a.imgListEl)?a.checkTask():a.refresh()},5e3))},clearCheckTask:function(){clearTimeout(this.watingTime)},setLoading:function(a,b){var c=a.attr("data-index");S.$refs.list[c].$set({$loading:!0,loadingText:b,$selected:!1}),this.selectedChange()},initGridView:function(){var a=this,b=d("#imageList").width()-y,c={handleAction:function(b,c){a.exec(b,[c])},$data:{initGetData:!0,hasFirst:!0,outerPaging:!1,TYPE_NAMES:F.TYPE_NAMES,EXTERNALMAP:P,electedHighlight:!1,colums:ea(a.getImageType(),b),trackKey:"unImgId",emptyTips:"<span>暂无相关数据！</span>",searchItemName:"镜像"},getData:function(b,c){a.getList(void 0,b)},getCellContent:function(a,b,c){return ga(a,b,c)},setTrAttr:function(a,b){return fa(a,b)},getActions:function(b,c,d){var e=a.getRegionId(),f=new r({dataItems:[b],operAction:X,whiteListMap:a.whiteListMap}),g=f.getAuth(),h="CREATING"===b.status;return"CREATEFAILED"===b.status?[{text:"删除",act:"del",disabled:g.del.code,title:g.del.tip||""}]:[{text:"创建实例",act:"add",disabled:g.add.code,title:g.add.tip||""},{text:"共享",act:"share",disabled:g.share.code,title:g.share.tip||""},{text:"更多",disabled:g.copy.code&&g.share.code&&g.mod.code,up:h?null:c>3&&3>d-c,menu:h?null:[{text:"跨地域复制",act:"copy",hidden:31==e||32==e||39==e,disabled:g.copy.code,title:g.copy.tip||""},{text:"取消共享",act:"unshare",disabled:g.unshare.code,title:g.unshare.tip||""},{text:"修改",act:"mod",disabled:g.mod.code,title:g.mod.tip||""},{text:"删除",act:"del",disabled:g.del.code,title:g.del.tip||""}]}]}},e=D.extend();e.tag("cell-action",B),this.gridView=S=new e(c),this.imgListEl.append(S.$el)},destroy:function(){k.hide(),Q=null,R={},S=null,this.copyImg&&this.copyImg.destroy&&this.copyImg.destroy(),this.clearCheckTask(),h.isI18n()||J.destroy()}};c.exports=ja}),define("cvm/image/operate_auth",function(a,b,c){var d=a("cvm/image/util"),e="0x0001",f="0x0002",g="0x0004",h=function(a){this.options=a};h.prototype={getAuth:function(){var a=this.options,b=a.dataItems,c=a.operAction;c=c||[];for(var d,e={},f=0;d=c[f];f++){var g=this.judgment[d];g?e[d]=g.call(this,b):e[d]={code:0}}return e},judgment:{del:function(a){return a.length>0?this.isReadOnly(a)?this.disable("只能删除自定义镜像"):this.isOperable(a,e)?this.enable():this.disable("选择的镜像无法删除，请重新选择"):this.disable("请选择你需要删除的镜像")},add:function(a){return a.length>0?1==a.length?this.isOperable(a,g)?this.enable():this.disable("选择镜像无法用于创建实例，请重新选择"):this.disable("请选择创建实例的唯一镜像"):this.disable("请选择你需要创建实例的镜像")},mod:function(a){return a.length>0?1==a.length?this.isReadOnly(a)?this.disable("只能修改自定义镜像"):this.isOperable(a,f)?this.enable():this.disable("选择镜像无法修改，请重新选择"):this.disable("请选择需要修改的唯一镜像"):this.disable("请选择你需要修改的镜像")},"import":function(){return this.enable()},copy:function(a){var b=50,c=this.options&&this.options.whiteListMap||{};return a.length>0?a.length>1?this.disable("暂不支持批量跨地域复制镜像"):this.isInstanceImage(a)?this.disable("整机镜像无法复制"):a.some(function(a){return a.imageType===d.TYPES.PUBLIC})?this.disable("公共镜像无法复制"):a.some(function(a){return a.imageType===d.TYPES.SHARED})?this.disable("共享镜像无法复制"):this.isOverSize(a,b)&&!c.Image_50gCrossRegionReplication?this.disable("大于"+b+"GB的自定义镜像暂不支持跨地域复制"):this.isOperable(a,g)||this.isOperable(a,f)?this.enable():this.disable("镜像无法复制, 请重新选择"):this.disable("请选择你需要复制的镜像")},share:function(a){return a.length>0?1==a.length?this.isInstanceImage(a)?this.disable("整机镜像无法共享"):this.isOperable(a,g)&&a[0].imageType===d.TYPES.PRIVATE?this.enable():this.disable("选择镜像无法共享，请重新选择"):this.disable("请选择需要共享的唯一镜像"):this.disable("请选择你需要共享的镜像")},unshare:function(a){return a.length>0?1==a.length?this.isInstanceImage(a)?this.disable("整机镜像无法共享"):this.isOperable(a,g)&&a[0].imageType===d.TYPES.PRIVATE?this.enable():this.disable("选择镜像无法共享，请重新选择"):this.disable("请选择需要取消共享的唯一镜像"):this.disable("请选择你需要取消共享的镜像")}},enable:function(){return{code:0}},disable:function(a){return{code:a.code?a.code:1,tip:a.tip?a.tip:a}},isOperable:function(a,b){for(var c,e=[],f=0;c=a[f];f++)c&&(c.operateAuth&b||b===g&&c.imageType===d.TYPES.PUBLIC)&&"CREATING"!==c.status||e.push(c);return e.length?!1:!0},isReadOnly:function(a){return a.some(function(a){return a.imageType===d.TYPES.SHARED||a.imageType===d.TYPES.PUBLIC})},isOverSize:function(a,b){return a.some(function(a){return(parseInt(a.size)||0)>b})},isInstanceImage:function(a){return a.some(function(a){return a.isInstanceImage||"InstanceImage"==a.imageClass})}},c.exports=h}),define("cvm/image/search_box",function(a,b,c){function d(a){if(h){for(var b in h){var c=h[b],d=k.find(function(a){return a.key==b});if(d){var e=[];c.forEach(function(a){var b=d.values.find(function(b){return b.value==a});b&&e.push({value:a,name:b.name})}),e.length&&l.push({values:e,attr:d})}}f&&f.setState({value:l}),h=null}}function e(a){a=a||[];for(var b={},c=0;c<a.length;c++){var d=a[c];if(null!=d.attr)d.attr=d.attr||{},"input"==d.attr.type&&(b[d.attr.key]=b[d.attr.key]||[],b[d.attr.key]=b[d.attr.key].concat(d.values.map(function(a){return a.name})));else{var e="innerSearch";m.test(d.values[0].name)&&(e="image-id"),b[e]=b[e]||[],b[e]=b[e].concat(d.values[0].name.split("|"))}}if(b.innerSearch){if(b.innerSearch.length>1)return j.error("暂不支持批量模糊搜索"),null;b.innerSearch=b.innerSearch[0]}var f={},g=[];return Object.keys(b).forEach(function(a){if("innerSearch"==a)f.innerSearch=b[a];else{var c;if("tag"==a){var d=b[a];d=d.map(function(a){return a.indexOf(":")>-1?{key:a.split(":")[0],value:a.split(":")[1]}:{key:a}}),c={Name:"tag",Values:d}}else c={Name:a,Values:b[a]};g.push(c)}}),g.length&&(f.Filters=g),f}var f,g,h,i=a("config/reactSupport"),j=(a("appUtil"),a("tips")),k=[{key:"image-name",name:"名称",type:"input"},{key:"image-id",name:"ID",type:"input"},{key:"platform",name:"操作系统",type:"input"}],l=[],m=/^img-/;b.init=function(a){var b=a.callback;g=[];var c=function(a){var c=e(a);g=a,c&&b&&b(c)};i.useTea(function(){var a=window.tea.component.TagSearchBox,b=React.__SECRET_DOM_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,d=300,e=React.createClass({displayName:"TSearchBox",getInitialState:function(){return{value:l}},onChange:c,render:function(){return React.createElement(a,{attributes:k,minWidth:d,value:this.state.value,onChange:c})}});null!=document.getElementById("searchArea")&&(f=b.render(React.createElement(e,null),document.getElementById("searchArea")))})},b.setData=d,b.getState=function(){return g},b.setDefaultData=function(a){l=[],a=a||{};var b=a.Filters||[],c=a.innerSearch;c&&l.push({values:[{name:c}],attr:null}),b.length&&b.forEach(function(a){h=h||{},h[a.Name]=a.Values})}}),define("cvm/image/share",function(a,b,c){var d,e=a("qccomponent"),f=a("appUtil"),g=(a("cvm/image/cacher"),a("dialog")),h=a("cvm/image/hub"),i=a("widget/popover/HelpTips");d=e.extend({$tpl:'    <div>        <div class="tc-15-msg">            您可以通过对端账号唯一ID将此镜像共享给其他用户，每个自定义镜像最多可以共享给{{maxCount}}个账号。        </div>        <ul class="form-list mirror-sharing">            <li>                <div class="form-label">                    <label for="">对端账号唯一ID</label>                </div>                <div class="form-input">                    <div class="form-unit {{initialized && !accountFocused && accountInvalid && \'is-error\'}}">                        <input                                b-on-focus="$set({initialized:true, accountFocused:true})"                                b-on-blur="$set(\'accountFocused\', false)"                               type="text" b-model="account" class="tc-15-input-text m" placeholder="请输入对方对端账号唯一ID">                       <help-tips>在用户中心的个人信息中查看,                           <a target="_blank" href="https://www.qcloud.com/doc/product/213/4944#.E8.8E.B7.E5.8F.96.E5.AF.B9.E7.AB.AF.E5.B8.90.E5.8F.B7.E5.94.AF.E4.B8.80id">点击查看操作指南</a>                       </help-tips>                        <div b-if="initialized && !accountFocused && accountInvalid" class="tc-15-bubble tc-15-bubble-top valid-bubble">                            <div class="tc-15-bubble-inner">{{accountInvalid}}</div>                        </div>                    </div>                    <p class = "text-danger tips-error"></p>                </div>            </li>            <li>                <div class="form-label">                    <span class="label">已用限额</span>                </div>                <div class="form-input">                    <div class="share-counter" b-if="loaded">{{usedCount}} / {{maxCount}}</div>                </div>            </li>        </ul>    </div>',$beforeInit:function(){var a=this;d.__super__.$beforeInit.apply(a,arguments);var b=a._validAccount=function(b){a.$set("accountInvalid",a.validAccount(b))};a.$watch("account",f.bufferFn(b,500)),b(a.account),f.beeBind(a,a,"accountInvalid || usedCount>maxCount || !loaded","invalid"),a.$watch("image.unImgId",function(b){a.$set("loaded",!1),h.getImageShare(a.regionId,b,function(b){a.$set({usedCount:(b.response.sharePermissionSet||[]).length,maxCount:b.response.maxSharePermission,loaded:!0})})},!0)},validAccount:function(a){return a=$.trim(a),a?/^\d{5,12}$/.test(a)?void 0:"QQ号码格式不正确":"不能为空"},isValid:function(){var a=this;return a._validAccount(a.account),!a.invalid}},{defaults:{loaded:!1,maxCount:50,usedCount:0,initialized:!1}}),d.tag("help-tips",i),c.exports=function(a){var b,c=$.Deferred();return b=new d(a),g.create(b.$el,"600","",{title:"共享镜像",preventResubmit:!0,onload:function(){b.$watch("invalid",function(a){g.toggleBtnDisable(!!a)},!0)},defaultCancelCb:function(){b.$destroy(),c.reject()},button:{"共享":function(a){b.isValid()&&(g.freeze(!0).toggleBtnLoading(!0),h.shareImage(b.regionId,b.image.unImgId,b.account,function(){g.hide(),b.$destroy(),c.resolve()},function(a){g.el.find(".tips-error").html(a.message),g.freeze(!1).toggleBtnLoading(!1).toggleBtnDisable(!1),c.reject()}))}}}),c}}),define("cvm/image/util",function(a,b,c){var d={1:"PRIVATE_IMAGE",2:"PUBLIC_IMAGE",4:"SHARED_IMAGE"},e={PRIVATE:"PRIVATE_IMAGE",PUBLIC:"PUBLIC_IMAGE",MARKET:"MARKET_IMAGE",SHARED:"SHARED_IMAGE",IMPORTING:"IMPORT_IMAGE"},f={};[[e.PRIVATE,"自定义镜像"],[e.PUBLIC,"公共镜像"],[e.MARKET,"镜像市场"],[e.SHARED,"共享镜像"]].forEach(function(a){f[a[0]]=a[1]}),c.exports={TYPES:e,TYPE_NAMES:f,BEFORE_V3_TYPES:d}}),define("modules/cvm/index/index",function(a,b,c){var d=a("$"),e=a("cvm/cvm/main"),f=a("router"),g=(a("util"),a("manager"),a("sdk"));g.use("iaas-sdk");var h={title:"实例-控制台",pageClass:"",render:function(a){d("#appArea").html('<div style="text-align: center;padding: 100px;">加载中……</div>');var b=a?"?"+d.param(a):"";return f.navigate("/cvm/instance/index"+b)},destroy:function(){var a=f.fragment;"/cvm"===a||/\/cvm\/index/.test(a)||e.destroy()}};c.exports=h}),define("cvm/overview/cvmstate",function(a,b,c){var d=a("$"),e=a("util"),f=(a("Highcharts"),{main:'    <div class="mod-console">        <div class="mod-console-hd">            <h3>实例状态</h3>        </div>        <div class="mod-console-bd">            <div class="dashboard">                <div class="dashboard-chart">                    <div id="statechart" style="width:200px;height:200px;"></div>                </div>                <div class="dashboard-text">                    <div class="status-box">                        <% if(data.safeIsolateNum) {%>                        <div class="status-item">                            <i class="flag-danger"></i> <span data-title="存在安全风险的实例">安全隐患实例</span><br><strong class="text-danger num-font"><%= data.safeIsolateNum %></strong> 台                        </div>                        <% } %>                        <% if(data.toRenewNum) {%>                        <div class="status-item">                            <i class="flag-warning"></i> <span data-title="7天内到期实例">7天内到期实例</span><br><strong class="text-warning num-font"><%= data.toRenewNum %></strong> 台                        </div>                        <% } %>                        <% if(data.recycleNum) {%>                        <div class="status-item">                            <i class="flag-warning"></i> <span data-title="回收站实例">回收站实例</span><br><strong class="text-warning num-font"><%= data.recycleNum %></strong> 台                        </div>                        <% } %>                        <div class="status-item">                            <i class="flag-success"></i> <span>正常实例</span><br><strong class="text-success num-font"><%= data.normalNum %></strong> 台                        </div>                    </div>                </div>            </div>        </div>    </div>'});c.exports={render:function(a){var b=this,c=b.data=a.cvmData;b.$container=a.container;var d=c.safeIsolateNum+c.toRenewNum+c.normalNum+c.recycleNum;b.$container.html(e.tmpl(f.main,{data:c})),b.renderChart({id:"statechart",total:d,recyclePrc:c.recycleNum/d,safeIsolatePrc:c.safeIsolateNum/d,toRenewPrc:c.toRenewNum/d,normalPrc:c.normalNum/d})},renderChart:function(a){var b=1==a.normalPrc?'<div class="graph-txt"><span class="graph-txt-span"><span class="text-success">正常</span></span></div>':'<div class="graph-txt"><span class="graph-txt-span">您共有<br><strong>'+a.total+"</strong> 台实例</span></div>",c={chart:{plotBackgroundColor:null,plotBorderWidth:0,plotShadow:!1},title:{text:b,useHTML:!0,floating:!0,style:{display:"block",position:"static",fontFamily:'"Hiragino Sans GB",Tahoma,"microsoft yahei",simsun'}},tooltip:{pointFormat:"",enabled:!1},plotOptions:{pie:{dataLabels:{enabled:!1,style:{fontWeight:"bold",color:"white",textShadow:"0px 1px 2px black"}},size:"120%",startAngle:0,endAngle:360,center:["50%","50%"]}},series:[{type:"pie",name:"cvmstate",innerSize:"83%",data:[{name:"安全故障类",color:"#e1504a",y:a.safeIsolatePrc},{name:"回收站实例",color:"#e1101a",y:a.safeIsolatePrc},{name:"待续费",color:"#ffb800",y:a.toRenewPrc},{name:"正常",color:"#06c290",y:a.normalPrc}]}],credits:{enabled:!1}},e=d("#"+a.id);e.highcharts(c)}}}),define("cvm/overview/globalSearch",function(a,b,c){var d=a("$"),e=a("qccomponent"),f=a("cvm/common/constants"),g=(a("appUtil"),a("router")),h=a("models/iaas"),i=a("reporter"),j=e.extend({$tpl:'  <div class="search-box m">        <style>            .global-search-current {                background-color:#EAF3FD            }            .global-search-li strong em {                font-weight: inherit            }        </style>        <div class="search-input-wrap" data-title="{{hoverTips}}" >            <textarea b-if="multipleSearch" b-model="keyword" class="tc-15-input-text search-input" placeholder="{{placeholder}}"></textarea>            <input b-if="!multipleSearch" b-model="keyword" b-ref="input" b-on-click="reporterClick(\'yunzhuji.overallsearch.printtimes\')" type="text" class="tc-15-input-text search-input" style="padding-left:10px" maxLength="{{maxInputLength}}" placeholder="{{placeholder}}" />            <a href="javascript:;" b-on-click="clearSearch()" b-if="keyword" role="button" class="btn-rm-txt" title="清空">清空</a>        </div>        <input class="search-btn" type="button" b-on-click="search(keyword)" value="搜索">        <div b-if="showDrop" class="dropdown-menu">            <ul class="dropdown-menu-list" b-style="ulStyle" b-ref="ul" b-on="{scroll:onScroll}">                <li b-repeat="item in list" data-index="{{$index}}" class="global-search-li {{$index == currentIndex ? \'global-search-current\': \'\'}}">                    <a href="javascript:(0)" b-on-click="jumpToDetail(item)">                        <i class="{{item.icon}}"></i>{{>item.desc}}                    </a>                </li>            </ul>            <div class="links">                <a b-if="showMore" href="javascript:;" b-on-click="searchMore()">查看更多结果</a>                <div b-if="isSearching"><i class="n-loading-icon"></i><span class="text">正在搜索</span></div>                <div b-if="isLoading"><i class="n-loading-icon"></i><span class="text">正在加载</span></div>                <div b-if="noResource"><span class="text">没有相关资源！</span></div>                <div b-if="isAll"><span class="text">以上共 <strong>{{totalCount}} </strong> 条搜索结果</span></div>            </div>        </div>        </div>',$afterInit:function(){var a=this;a.$watch("keyword",function(b,c){b=b.trim(),c=c&&c.trim(),b!=c&&(clearTimeout(a.timer),a.timer=setTimeout(function(){a.search(b)},a.searchDelay))})},formatList:function(a){var b=this,c=function(a){var b;return d.each(f.REGIONIDMAP,function(c,d){d==a.region&&(b=c)}),b},e=function(a){var b=f.REGIONNAMES[a.regionId];return b},g=function(a){var b={ins:"pd-cloud",eip:"pd-eip",img:"pd-monitor",sg:"pd-safe",skey:"pd-ssh",vpc:"pd-vpc",disk:"pd-cbs"};return b[a.resourceType]},h=function(a){var b="/cvm/overview";switch(a.resourceType){case"ins":b="/cvm/detail/"+a.regionId+"/"+a.resourceId;break;case"eip":b="/cvm/eip?rid="+a.regionId+"&eipId="+a.resourceId;break;case"img":b="/cvm/image/detail/"+a.regionId+"/"+a.resourceId;break;case"skey":b="/cvm/sshkey/detail/"+a.resourceId;break;case"sg":b="/cvm/securitygroup/detail/"+a.resourceId+"?rid="+a.regionId;break;case"disk":b="/cvm/cbs/detail?storageId="+a.resourceId+"&rid="+a.regionId;break;case"vpc":b="/vpc/vpc?rid="+a.regionId+"&unVpcId="+a.resourceId}return b},i=function(a){var c={ins:"实例",eip:"弹性公网IP已绑定实例",img:"镜像所生成实例",sg:"安全组内实例",skey:"密钥已绑定实例",vpc:"私有网络内实例",disk:"云硬盘挂载实例"},d={ins:"实例",eip:"弹性公网IP",img:"镜像",sg:"安全组",skey:"密钥",vpc:"私有网络",disk:"云硬盘"},e="skey"==a.resourceType?"":a.regionName+"/",f=("<strong>"+e+a.resourceId+"</strong>").replace(b.keyword,"<em>"+b.keyword+"</em>"),g=a.searchWord.replace(b.keyword,"<em>"+b.keyword+"</em>"),h=c[a.resourceType]+g,i=d[a.resourceType]+"(<strong>"+a.resourceId+"</strong>)详情",j=f+" - "+h+" - "+i;return j};return a.forEach(function(a,b){a.regionId=c(a),a.regionName=e(a),a.resourceType=a.resourceId.substring(0,3),a.icon=g(a),a.link=h(a),a.desc=i(a)}),a},getList:function(a){var b=this,c=1==a.page?0:(a.page-1)*a.count-b.firstCount,d=a.count;return new Promise(function(e,f){h.apiRequest({regionId:b.regionId,serviceType:"cvm",action:"SearchUserInstance",data:{keyword:a.keyword,offset:c,limit:d},keyword:a.keyword},{v3:!0,camTipsType:"dialog"}).then(function(a){a=a&&a.response||{},e(a)},function(){e({resourceSet:[],totalCount:0,remain:!1})})})},renderList:function(a,b){var c=this;c.page=a.page,c.count=a.count,c.getList(a).then(function(a){var d=c.formatList(a.resourceSet),e=a.totalCount,f=a.remain;return c.hideAllTips(),!e||b.replace&&!d.length?void c.showNoResource():(b.replace?c.$set("list",d):c.list.splice.apply(c.list,[c.list.length,0].concat(d)),c.$set("totalCount",c.list.length),void(f&&d.length==c.count?c.showMoreResult():c.showIsAll()))})},search:function(a){var b=this;return b.hideAllTips(),a?(b.showDropDown(),b.$set("list",[]),b.showIsSearching(),b.keyword=a,void b.renderList({page:b.defaultPage,count:b.firstCount,keyword:a},{replace:!0})):void b.clearSearch()},searchMore:function(){var a=this;a.hideAllTips(),a.showIsLoading(),a.renderList({page:a.page+1,count:a.defaultCount,keyword:a.keyword},{replace:!1})},onScroll:function(a){var b=this,c=d(b.$refs.ul),e=c[0].scrollHeight,f=c.height(),g=c[0].scrollTop;e-f==g&&!b.isLoading&&b.$get("showMore")&&b.searchMore()},onKeyDown:function(a){var b=this,c=38,d=40,e=13,f=a.keyCode;(f==c||f==d)&&(f==c&&b.currentIndex>0?b.$set("currentIndex",b.currentIndex-1):f==d&&b.currentIndex<b.list.length-1&&b.$set("currentIndex",b.currentIndex+1)),f==e&&g.navigate(this.list[b.currentIndex].link)},jumpToDetail:function(a){var b=this;b.reporterClick("yunzhuji.overallsearch."+a.resourceType),window.open(a.link)},reporterClick:function(a){i.click(a)},clearSearch:function(){this.$set("keyword",""),this.$set("list",[]),this.$set("totalCount",0),this.$set("page",this.defaultPage),this.$set("pageCount",this.firstCount),this.$set("currentIndex",0),this.hideAllTips(),this.hideDropDown()},showDropDown:function(){this.$set("showDrop",!0)},showIsLoading:function(){this.$set("isLoading",!0)},showIsSearching:function(){this.$set("isSearching",!0)},showMoreResult:function(){this.$set("showMore",!0)},showNoResource:function(){this.$set("noResource",!0)},showIsAll:function(){this.$set("isAll",!0)},hideDropDown:function(){this.$set("showDrop",!1)},hideAllTips:function(){this.$set("isLoading",!1),this.$set("isSearching",!1),this.$set("showMore",!1),this.$set("noResource",!1),this.$set("isAll",!1)},_events:{},$data:{currentClass:"global-search-current",ulStyle:{"max-height":"300px",overflow:"auto"},regionId:1,searchDelay:500,currentIndex:0,defaultPage:1,firstCount:5,defaultCount:10,maxInputLength:60,placeholder:"可跨地域搜索云资源，支持搜索实例ID、IP或名称"}});e.tag("global-search",j),c.exports=j}),define("cvm/overview/netflow",function(a,b,c){var d=a("$"),e=a("util"),f=a("manager"),g=a("router"),h={main:'    <div class="mod-console">        <div class="mod-console-hd">            <h3>公网流量监控</h3>        </div>        <div class="mod-console-bd">            <div id="netflowchart" class="flow-monitor">              <!--   <p>2016-05-24 20:30实时数据:</p>                <p><strong class="num-font text-primary">6.053</strong> <span class="text-weak">Mbps</span></p>                <div class="chart-box">                    <img src="css/img/line-chart.png" alt="" style="height:100%; width:100%;">                </div> -->            </div>        </div>    </div>',legend:'  <style>  .netflow-legend{    position: absolute;    font-size: 12px;    color:#454a51;    right: 0;    top:5px;  }  .legend-item{    float: left;    margin-right:10px;  }  .legend-item div{    width:20px;    height:2px;    float: left;    margin-right:4px;    margin-top:3px;  }  </style>  <div class="netflow-legend">    <div class="legend-item">      <div style="background-color:#0272CE"></div>      实时    </div>    <div class="legend-item">      <div style="background-color:#BCDAF2"></div>      上周同天    </div>  </div>'};c.exports={render:function(a){function b(){var a=d.Deferred();return f.getNetworkFlow(function(b){b.peakFlow;a.resolve(b)},function(){a.resolve(null)}),a}var c=this;c.$container=a.container,c.$container.html(e.tmpl(h.main,{}));var i=b();i.then(function(a){return a?void c.renderChart({data:a,id:"netflowchart",click:function(){g.navigate("/monitor/flow")}}):void d("#netflowchart").html('<div style="margin: auto; width: 200px; padding-top: 50px;">暂无数据</div>')})},renderChart:function(a){var b=a.data,c=b.category||[],e=b.data1||{},f=b.data2||{},g=a.click,i={chart:{backgroundColor:"rgba(0,0,0,0)",events:{click:function(){g&&g()}},style:{cursor:"pointer"}},credits:{enabled:!1},title:{text:"",align:"center",y:16,style:{color:"#454a51",fontSize:"14px",fontWeight:"bold",fontFamily:"Hiragino Sans GB,Tahoma,microsoft yahei,simsun"}},subtitle:{text:"subtitle",style:{color:"#fff"}},xAxis:{lineWidth:1,gridLineWidth:1,gridLineColor:"#E2E5EB",lineColor:"#E2E5EB",tickInterval:48,tickColor:"#fff",categories:c,labels:{style:{color:"#7f90a0",textOverflow:"none"},formatter:function(){return this.value}}},yAxis:{title:{text:""},lineWidth:1,gridLineWidth:0,gridLineColor:"#e6e8ed",lineColor:"#fff",tickPixelInterval:30,min:0,labels:{enabled:!1,style:{color:"#7f90a0"}}},tooltip:{enabled:!0,crosshairs:{width:1,color:"#333"},formatter:function(){var a="<b>"+this.x+"</b>";return d.each(this.points,function(b,c){a+='<br/><span style="color:'+c.series.color+'">●</span> '+c.series.name.substr(5)+': <span style="color:#e1504a">'+c.y+"Mbps</span>"}),a},positioner:function(a,b,c){var e=d("#contChartNetflow").width(),f=c.plotX,g=c.plotY;
return a>=f?f+=20:f>=e-a?f-=a:f+=20,{x:f,y:g}},borderColor:"#aaa",shadow:!1,shared:!0},legend:{enabled:!1},plotOptions:{spline:{states:{hover:{enabled:!1,lineWidth:1}},marker:{enabled:!1,states:{hover:{enabled:!1}}}},areaspline:{states:{hover:{enabled:!1,lineWidth:1}},marker:{enabled:!1,states:{hover:{enabled:!1}}}}},series:[{name:f.name,data:f.data,type:"spline",color:"#BCDAF2",lineWidth:1.4},{name:e.name,data:e.data,type:"spline",lineColor:"#0272CE",lineWidth:1.4}]},j=d("#"+a.id);j.highcharts(i),j.append(h.legend)}}}),define("modules/cvm/overview_useless/overview",function(a,b,c){var d=a("$"),e=a("util"),f=(a("appUtil"),a("pageManager")),g=a("manager"),h=a("dialog"),i=(a("models/api"),a("./cvmstate"),a("./netflow"),a("./unnormal"),a("./globalSearch")),j=(a("router"),a("cvm/common/components/SmartHelper")),k=a("cvm/common/model"),l=a("widget/popover/popTips"),m=a("cvm/common/constants"),n=a("cvm/common/components/arrearsTip/arrearsTip"),o=a("cvm/cbs2/data"),p={main:'  <div class="manage-area dev-container">    <div class="manage-area-title">      <h2>概览</h2>      <div class="manage-area-title-right">        <a href="javascript:;" class="guide-link dev-customHomepage">定制首页</a>      </div>    </div>    <div class="manage-area-main">      <arrears-tip></arrears-tip>      <div class="cvm-dashboard-box dev-resourceOverview"></div>    </div>  </div>',empty:'  <div class="tc-panel mt-20 panel-full"    style="display: block; z-index: 10; height: 531px; width: 1659px; position: relative; left: 0px; right: 0px;">    <div class="tc-blank-page media">      <div class="media-left media-middle">        <div class="media-object no-machine-media">          <div class="inner"><span class="img-gif"></span></div>        </div>      </div>      <div class="media-body media-middle">        <h4 class="media-heading">您还没有云服务器实例</h4>        <p class="mb-15 normal-text">          云服务器（Cloud Virtual          Machine，CVM）为您提供安全可靠的弹性计算服务。<br />          只需几分钟，您就可以在云端获取和启用CVM，来实现您的计算需求        </p>        <div class="op-area">          <button class="tc-15-btn" id="dev-buy-cvm">立即购买</button>          <div class="mt-15 normal-text">            <a href="//cloud.tencent.com/act/group/amdv2/index?from=11228" target="_blank" rel="noopener noreferrer">AMD 服务器15元/月，拼团最高额外获赠40月时长</a>            <span class="text-weak ml-10 mr-10">|</span>            <a href="//cloud.tencent.com/act/southwest?from=11033" target="_blank"              rel="noopener noreferrer">云服务器钜惠，助力中小微企业发展</a>          </div>          <div class="mt-15 normal-text">            <i class="tc-badge warning-dark mr-10">活动</i>            <a class="text" href="//cloud.tencent.com/act/seckill?from=11102" target="_blank"              rel="noopener noreferrer">新用户专享：云服务限时秒杀，99元/年起</a>          </div>        </div>      </div>    </div>  </div>',resourceList:'  <% for (var i = 0; i < data.regionSourceList.length; i++) { var regionSource =  data.regionSourceList[i]; var snapshotCapacityProgress =  regionSource.snapShotQuota.totalCapacity == 0 ? 0 : Math.min(100,  regionSource.snapShotQuota.usedCapacity * 100 /  (regionSource.snapShotQuota.totalCapacity * 1024) * 100) + "%"; var  snapshotQuotaProgress = regionSource.snapShotQuota.totalQuota == 0 ? 0 :  Math.min(100, regionSource.snapShotQuota.usedQuota /  regionSource.snapShotQuota.totalQuota * 100) + "%"; var imageQuotaProgress =  regionSource.imageQuota.totalQuota == 0 ? 0 : Math.min(100,  regionSource.imageQuota.usedQuota / regionSource.imageQuota.totalQuota * 100)  + "%"; %>  <div key="<%=regionSource.region.toString()%>" class="tc-g-u-1-2">    <div class="area-box">      <div class="area-box-hd">        <%=regionSource.regionName%>      </div>      <div class="area-box-bd">        <h3 class="til mb-10">          <i class="pd-cloud"></i>          云服务器        </h3>        <div class="tc-g">          <div class="tc-g-u-1-5">            <p class="text-weak">数量</p>            <p>              <a class="big-text" href="https://console.cloud.tencent.com/cvm/index?rid=<%- regionSource.regionId %>">                <%=regionSource.resourceDetail.totalCount || 0%>              </a>              <em class="text-weak"></em>            </p>          </div>          <div class="tc-g-u-1-5">            <p class="text-weak">运行中</p>            <p>              <em class="big-text text-success">                <%=regionSource.resourceDetail.runningCount%>              </em>              <em class="text-weak"></em>            </p>          </div>          <div class="tc-g-u-1-5">            <p class="text-weak">已隔离</p>            <p>              <em class="big-text text-error">                <%=regionSource.resourceDetail.unSecurityCount%>              </em>              <em class="text-weak"></em>            </p>          </div>          <div class="tc-g-u-1-5">            <p class="text-weak">已过期</p>            <p>              <a class="big-text"                href="https://console.cloud.tencent.com/cvm/recycle/cvm?rid=<%- regionSource.regionId %>">                <%=regionSource.resourceDetail.expiredInstanceCount%>              </a>              <em class="text-weak"></em>            </p>          </div>          <div class="tc-g-u-1-5">            <p class="text-weak">将到期</p>            <p>              <a class="big-text text-warning"                href="https://console.cloud.tencent.com/account/renewal?rid=<%- regionSource.regionId %>">                <%=regionSource.resourceDetail.dueInstanceCount%>              </a>              <em class="text-weak"></em>            </p>          </div>        </div>        <div class="tc-g mt-15">          <div class="tc-g-u-1-2 border-right">            <h3 class="til">包年包月云服务器配额              <div class="tc-15-bubble-icon">                <i class="tc-icon icon-what"></i>                <div class="tc-15-bubble tc-15-bubble-bottom">                  <div class="tc-15-bubble-inner">                    包年包月配额为当月配额，不累计                  </div>                </div>              </div>            </h3>            <div class="tc-g">              <div class="tc-g-u-1-2">                <p class="text-weak">当月已有配额</p>                <p>                  <em class="big-text text-error">                    <%=regionSource.prePayQuota.totalUsedQuota%>                  </em>                  <em class="text-weak"></em>                </p>              </div>              <div class="tc-g-u-1-2">                <p class="text-weak">剩余配额</p>                <div>                  <em class="big-text text-error">                    <%=(regionSource.prePayQuota.totalQuota -                    regionSource.prePayQuota.totalUsedQuota)%>                  </em>                  <div class="tc-15-bubble-icon">                    <i class="tc-icon icon-what"></i>                    <div class="tc-15-bubble tc-15-bubble-top">                      <div class="tc-15-bubble-inner">                        <p>剩余配额</p>                        <% for(var index = 0, item; item =                        regionSource.prePayQuota.quotaForZones[index]; index++)                        { %>                        <p>                          <%= item.zoneName %>，<%= item.totalQuota -                          item.usedQuota %>台                        </p>                        <% } %>                      </div>                    </div>                  </div>                  <em class="text-weak"></em>                </div>              </div>            </div>          </div>          <div class="tc-g-u-1-2">            <h3 class="til">按量计费云服务器配额</h3>            <div class="tc-g">              <div class="tc-g-u-1-2">                <p class="text-weak">累计已有配额</p>                <p>                  <em class="big-text text-error">                    <%=regionSource.postPayQuota.totalUsedQuota%>                  </em>                  <em class="text-weak"></em>                </p>              </div>              <div class="tc-g-u-1-2">                <p class="text-weak">剩余配额</p>                <div>                  <em class="big-text text-error">                    <%=(regionSource.postPayQuota.totalQuota -                    regionSource.postPayQuota.totalUsedQuota)%>                  </em>                  <div class="tc-15-bubble-icon">                    <i class="tc-icon icon-what"></i>                    <div class="tc-15-bubble tc-15-bubble-top">                      <div class="tc-15-bubble-inner">                        <p>剩余配额</p>                        <% for(var index = 0, item; item =                        regionSource.postPayQuota.quotaForZones[index]; index++)                        { %>                        <p>                          <%= item.zoneName %>，<%= item.totalQuota -                          item.usedQuota %>台                        </p>                        <% } %>                      </div>                    </div>                  </div>                  <em class="text-weak"></em>                </div>              </div>            </div>          </div>        </div>        <h3 class="til mb-10 mt-20">          <i class="pd-snap"></i>          快照        </h3>        <div class="tc-15-progress">          <div aria-valuemax="100" aria-valuemin="0" aria-valuenow="30" style="width: <%=snapshotCapacityProgress%>"            class="tc-15-progress-value">            <div class="value-detail" aria-valuetext="运行中">              快照容量：              <em class="text-weak">已用</em>              <%=regionSource.snapShotQuota.usedCapacity%>              <em class="text-weak">GB</em>            </div>          </div>        </div>        <div class="tc-15-progress mt-40">          <div aria-valuemax="100" aria-valuemin="0" aria-valuenow="30" style="width: <%=snapshotQuotaProgress%>"            class="tc-15-progress-value">            <div class="value-detail" aria-valuetext="运行中">              配额：              <em class="text-weak">已用</em>              <%=regionSource.snapShotQuota.usedQuota%>              <em class="text-weak">个</em>，              <em class="text-weak">共</em>              <%=regionSource.snapShotQuota.totalQuota%>              <em class="text-weak">个</em>            </div>          </div>        </div>        <h3 class="til mb-10 mt-40">          <i class="pd-monitor"></i>          自定义镜像        </h3>        <div class="tc-15-progress">          <div aria-valuemax="100" aria-valuemin="0" aria-valuenow="30" style="width: <%=imageQuotaProgress%>"            class="tc-15-progress-value">            <div class="value-detail" aria-valuetext="运行中">              配额：              <em class="text-weak">已用</em>              <%=regionSource.imageQuota.usedQuota%>              <em class="text-weak">个</em>，              <em class="text-weak">共</em>              <%=regionSource.imageQuota.totalQuota%>              <em class="text-weak">个</em>            </div>          </div>        </div>      </div>    </div>  </div>  <%}%>',overview:'  <div class="tc-g">    <div class="tc-g-u-2-3">      <div class="tc-panel">        <div class="tc-panel-hd">          <h3 class="title">资源概览</h3>        </div>        <div class="tc-panel-bd">          <div class="tc-g monit">            <div class="tc-g-u-1-5">              <h4 class="til">您共有云服务器</h4>              <p>                <em class="big-text">                  <%=data.resourceOverview.totalCount%>                </em>                <em class="text-weak">台</em>              </p>            </div>            <div class="tc-g-u-1-5">              <h4 class="til">                运行中              </h4>              <p>                <em class="big-text text-success">                  <%=data.resourceOverview.runningCount || 0%>                </em>                <em class="text-weak">台</em>              </p>            </div>            <div class="tc-g-u-1-5">              <h4 class="til">安全隔离</h4>              <p>                <em class="big-text text-warning">                  <%=data.resourceOverview.unSecurityCount%>                </em>                <em class="text-weak">台</em>              </p>            </div>            <div class="tc-g-u-1-5">              <h4 class="til">                已过期                <div class="tc-15-bubble-icon">                  <i class="tc-icon icon-info"></i>                  <div class="tc-15-bubble tc-15-bubble-bottom">                    <div class="tc-15-bubble-inner">                      <p>过期但未销毁实例，续费可以继续使用</p>                    </div>                  </div>                </div>              </h4>              <p>                <em class="big-text text-danger">                  <%=data.resourceOverview.expiredInstanceCount%>                </em>                <em class="text-weak">台</em>              </p>            </div>            <div class="tc-g-u-1-5">              <h4 class="til">                将到期                <div class="tc-15-bubble-icon">                  <i class="tc-icon icon-info"></i>                  <div class="tc-15-bubble tc-15-bubble-bottom">                    <div class="tc-15-bubble-inner">                      <p>7天内到期实例</p>                    </div>                  </div>                </div>              </h4>              <p>                <em class="big-text text-danger">                  <%=data.resourceOverview.dueInstanceCount%>                </em>                <em class="text-weak">台</em>              </p>            </div>          </div>          <div class="tc-g monit">            <div class="tc-g-u-1-5">              <h4 class="til">云硬盘</h4>              <p>                <em class="big-text">                  <%=data.resourceOverview.diskNumberTotal%>                </em>                <em class="text-weak">个</em>              </p>            </div>            <div class="tc-g-u-1-5">              <h4 class="til">已过期云硬盘</h4>              <p>                <em class="big-text text-danger">                  <%=data.resourceOverview.expiredNumberTotal%>                </em>                <em class="text-weak">个</em>              </p>            </div>            <div class="tc-g-u-1-5">              <h4 class="til">将到期云硬盘</h4>              <p>                <em class="big-text text-danger">                  <%=data.resourceOverview.diskNumberExpireIn7days%>                </em>                <em class="text-weak">个</em>              </p>            </div>            <div class="tc-g-u-1-5">              <h4 class="til">快照数量</h4>              <p>                <em class="big-text">                  <%=data.resourceOverview.snapshotNumberUsedTotal%>                </em>                <em class="text-weak">个</em>              </p>            </div>            <div class="tc-g-u-1-5">              <h4 class="til">快照容量</h4>              <p>                <% if                (Math.ceil(data.resourceOverview.snapshotCapacityUsedTotal) <                100000) { %>                <em class="big-text">                  <%=Math.ceil(data.resourceOverview.snapshotCapacityUsedTotal)%>                </em>                <em class="text-weak">GB</em>                <% } else { %>                <em class="big-text">                  <%=Math.ceil(data.resourceOverview.snapshotCapacityUsedTotal /                  1000)%>                </em>                <em class="text-weak">TB</em>                <% } %>              </p>            </div>          </div>          <div class="tc-g details">            <% if (data.securityOverview.securityIntrusions) { %>            <div class="tc-g-u-1-3">              <p class="til">入侵检测</p>              <% if              (data.securityOverview.securityIntrusions.instrusionsDetectionResult)              { %>              <p class="text-weak">                <i class="n-success-icon"></i>&nbsp;入侵检测防护正常              </p>              <%} else { if              (data.securityOverview.securityIntrusions.instrusionsDetectionDetail.bruteForceNum              > 0) { %>              <div class="text-weak">                <i class="n-error-icon"></i>                <a href="https://console.cloud.tencent.com/yunjing/manage/crack">                  &nbsp;发现                  <em class="text-danger">                    <%=data.securityOverview.securityIntrusions.instrusionsDetectionDetail.bruteForceNum%>                  </em>                  次暴力破解</a>                <div style="margin-top:-68px" class="tc-15-bubble tc-15-bubble-bottom black">                  <div class="tc-15-bubble-inner">                    您有实例的密码被破解，点击查看详情                  </div>                </div>              </div>              <%} if              (data.securityOverview.securityIntrusions.instrusionsDetectionDetail.nonlocalLoginNum              > 0) {%>              <div class="text-weak">                <i class="n-error-icon"></i>                <a href="https://console.cloud.tencent.com/yunjing/manage/loginLog">                  &nbsp;发现                  <em class="text-danger">                    <%=data.securityOverview.securityIntrusions.instrusionsDetectionDetail.nonlocalLoginNum%>                  </em>                  次异地登录行为</a>                <div style="margin-top:-68px" class="tc-15-bubble tc-15-bubble-bottom black">                  <div class="tc-15-bubble-inner">                    您有实例发现有异地登录行为，点击查看详情                  </div>                </div>              </div>              <%} if              (data.securityOverview.securityIntrusions.instrusionsDetectionDetail.trojanFileNum              > 0) {%>              <div class="text-weak">                <i class="n-error-icon"></i>                <a href="https://console.cloud.tencent.com/yunjing/manage/trojanFile">                  &nbsp;发现                  <em class="text-danger">                    <%=data.securityOverview.securityIntrusions.instrusionsDetectionDetail.trojanFileNum%>                  </em>                  个木马文件</a>                <div style="margin-top:-68px" class="tc-15-bubble tc-15-bubble-bottom black">                  <div class="tc-15-bubble-inner">                    您有实例发现木马文件，点击去处理                  </div>                </div>              </div>              <%} if              (data.securityOverview.securityIntrusions.instrusionsDetectionDetail.vulNum              > 0) {%>              <div class="text-weak">                <i class="n-error-icon"></i>                <a href="https://console.cloud.tencent.com/yunjing/app-vul">                  &nbsp;发现                  <em class="text-danger">                    <%=data.securityOverview.securityIntrusions.instrusionsDetectionDetail.vulNum%>                  </em>                  个漏洞</a>                <div style="margin-top:-68px" class="tc-15-bubble tc-15-bubble-bottom black">                  <div class="tc-15-bubble-inner">                    您有实例发现安全漏洞，点击查看详情                  </div>                </div>              </div>              <%} }%>            </div>            <% } %>            <div class="tc-g-u-1-3">              <p class="til">DDos防护</p>              <% if (!data.securityOverview.dDoSAttack) {%>              <p class="text-weak">                <i class="n-success-icon"></i>&nbsp;DDos防护正常              </p>              <%} else {%>              <div class="text-weak">                <i class="n-error-icon"></i>                <a href="https://console.cloud.tencent.com/dayu/basic">                  &nbsp;DDos防护异常</a>                <div style="margin-top:-68px" class="tc-15-bubble tc-15-bubble-bottom black">                  <div class="tc-15-bubble-inner">                    DDos防护异常，Web业务可能遭到攻击                  </div>                </div>              </div>              <%}%>            </div>            <div class="tc-g-u-1-3">              <p class="til">Web应用防火墙</p>              <% if (data.securityOverview.firewallStatus) {%>              <p class="text-weak">                <i class="n-success-icon"></i>                <a href="https://console.cloud.tencent.com/guanjia">                  &nbsp;已启用Web应用防火墙（WAF）</a>              </p>              <div style="margin-top:-68px" class="tc-15-bubble tc-15-bubble-bottom black">                <div class="tc-15-bubble-inner">                  前往Web应用防火墙（WAF）了解Web业务安全状态                </div>              </div>              <% } else { %>              <div class="text-weak">                <i class="n-error-icon"></i>                <a href="https://console.cloud.tencent.com/guanjia">                  &nbsp;未启用Web应用防火墙（WAF）</a>                <div style="margin-top:-68px" class="tc-15-bubble tc-15-bubble-bottom black">                  <div class="tc-15-bubble-inner">                    Web应用防火墙（WAF）未启用，Web业务可能遭到攻击威胁                  </div>                </div>              </div>              <%}%>            </div>          </div>        </div>      </div>      <div class="tc-panel area-box-wrap">        <div class="tc-panel-hd">          <div class="col">            <h3 class="title">各地域资源</h3>          </div>          <div class="col">            <label class="form-ctrl-label">              <input                type="checkbox"                checked="checked"                class="tc-15-checkbox dev-btn-show-all"                checked="<%=isOnlyShowHasResourceRegion == 1%>"              />只显示有资源的地域</label>              <a                href="https://console.cloud.tencent.com/workorder/category?level1_id=6&level2_id=7&source=0&data_title=云服务器 CVM&level3_id=156&radio_title=云服务器购买配额提升申请&queue=1&scene_code=12701&step=2">申请配额</a>            </div>          </div>          <div class="tc-panel-bd">            <div class="dev-globalSearch" style="margin-bottom: 20px;"></div>            <div class="tc-g dev-resourceList"></div>          </div>        </div>      </div>      <div class="tc-g-u-1-3">        <div class="tc-panel">          <div class="tc-panel-hd">            <h3 class="title">产品动态</h3>          </div>          <div class="tc-panel-bd">            <ul class="news-list">              <li>                <a href="//cloud.tencent.com/act/event/cvm5" target="_blank">全新一代云服务器 现已开放内测                </a>              </li>              <li>                <a href="https://cloud.tencent.com/solution/pai"                  target="_blank">小程序云服务器（PAI实例）体验官邀测活动<br>默认域名，一键部署，5分钟快速搭建基于WebSocket的实时高效通讯服务</a>              </li>              <li>                <a href="https://cloud.tencent.com/developer/post/1060" target="_blank">[通知] 公有镜像CentOS 6.5 64位下线通知</a>              </li>              <li>                <a href="//cloud.tencent.com/act/southwest?from=consolecvm1"                  target="_blank">云服务器3折特惠，最新机型全行业计算提速，高性价比首选</a>              </li>              <li>                <a href="//www.qcloud.com/act/event/bid.html" target="_blank">竞价实例开启公测， 中断容忍场景最高降低90%开销                </a>              </li>              <li>                <a href="//cloud.tencent.com/document/product/362/17935" target="_blank">云硬盘快照 即将正式商业化</a>              </li>              <li>                <a href="https://cloud.tencent.com/act/event/25g-network-card.html" target="_blank">25G网卡云服务器震撼发布</a>              </li>            </ul>          </div>        </div>        <div class="tc-panel mt-20">          <div class="tc-panel-hd">            <h3 class="title">热点问题</h3>          </div>          <div class="tc-panel-bd">            <ul class="news-list">              <li>                <a href="https://cloud.tencent.com/document/product/213" target="_blank">快速了解云服务器</a>              </li>              <li>                <a href="https://cloud.tencent.com/document/product/213/16918" target="_blank">云服务器常用操作指南</a>              </li>              <li>                <a href="https://cloud.tencent.com/document/product/213/10339" target="_blank">无法登录云服务器？</a>              </li>              <li>                <a href="https://cloud.tencent.com/document/product/213/4933" target="_blank">如何重装系统？</a>              </li>              <li>                <a href="https://cloud.tencent.com/document/product/213/2178" target="_blank">如何调整实例配置？</a>              </li>              <li>                <a href="https://cloud.tencent.com/document/product/213/16566" target="_blank">如何重置实例密码？</a>              </li>            </ul>          </div>        </div>      </div>    </div>',notice:'  <% if(data.length){ %>  <div class="dev-noticeBox tc-15-msg mb20">    <div class="tc-15-msg-txt">      <% for(var i=0,item; item=data[i]; i++){ %>      <p class="notice-item" data-ntime="<%=item.addTime%>">        <%= (i+1)+"." %> <%= item.content %> <% if (item.globalUrl) { %>        <a href="<%=item.globalUrl%>" class="guide-link" target="_blank">查看详情          <b class="external-link-icon"></b>        </a>        <% } %>      </p>      <% } %>    </div>    <a class="notice-btn-close" href="javascript:;" title="关闭">关闭</a>  </div>  <% } %>',globalTip:"  <div>    <ul>      <li>1.支持实例ID 、IP地址、名称的精确/模糊搜索</li>      <li>2.支持跨地域精确/模糊搜索与实例相关联的镜像和弹性公网IP</li>      <li>3.更多关联资源，请期待功能升级</li>    </ul>  </div>"},q=Bee.extend({$tpl:p.main});q.tag("arrears-tip",n),c.exports={title:"概览-控制台",pageClass:"",$container:null,render:function(){var a=this;a.mainBee=new q,nmc.render(a.mainBee.$el,"cvm"),a.$container=d(f.appArea).find(".dev-container");var b=a.$container.find(".dev-resourceOverview");this.getData().then(function(c){var d=c.cvmOverview.resourceOverview&&c.cvmOverview.resourceOverview.totalCount;if(!d)return void b.html(p.empty);var f=a.getShowAllRegionConfig(),g=a.format(c,f),h=e.tmpl(p.overview,{data:g,isOnlyShowHasResourceRegion:f});b.html(h),a.data=c,a.renderResourceList(c),a.renderGlobalSearch()})["catch"](function(a){b.html(p.empty)}),this.bindEvent(),j.show()},renderResourceList:function(a){var b=this;a=a||b.data;var c=b.getShowAllRegionConfig(),d=b.format(a,c),f=e.tmpl(p.resourceList,{data:d}),g=b.$container.find(".dev-resourceList");g.html(f)},renderGlobalSearch:function(){var a=this,b=new i;this.globalSearch=b,a.$container.find(".dev-globalSearch").html(b.$el),a.renderGlobalSearchTips(b)},renderGlobalSearchTips:function(a){var b=this,c=10,e=parseInt(localStorage.getItem("showGlobalSearchCount"));if(e=isNaN(e)?c:e,a&&e>0){var f=d(a.$el);b.getGlobalSearchPopTips({target:f,defaultShow:!0,hideCloseIcon:!1,onHide:function(){var a=parseInt(localStorage.getItem("showGlobalSearchCount"));a=isNaN(a)?c:a;try{localStorage.setItem("showGlobalSearchCount",--a)}catch(b){console.warn(b)}}})}},getGlobalSearchPopTips:function(a){var b=l({target:a.target,title:"跨地域搜索云资源，现在上线！",content:p.globalTip,defaultShow:a.options,hideDelay:a.hideDelay||5e3,hideCloseIcon:a.hideCloseIcon,persist:!0,onHide:a.onHide},{style:{"max-width":450,width:450,top:-155,left:300},position:"auto"});return b},bindEvent:function(){var a=this;a.$container.on("change",".dev-btn-show-all",function(){a.setShowAllRegionConfig(event.target.checked),a.renderResourceList()}),a.$container.on("click",".dev-customHomepage",function(){a.customizeHomePage()}),a.$container.on("click","#dev-buy-cvm",function(){var a=QCBUY_HOST?"//"+QCBUY_HOST+"/cvm":"//buy.qcloud.com/cvm";window.open(a)})},getData:function(){return Promise.all([k.apiRequest({serviceType:"cvm",cmd:"DescribeResourcesOverview",regionId:"1"}),o.queryUserDiskResources()]).then(function(a){var b=_slicedToArray(a,2),c=b[0],d=b[1];return{cvmOverview:c.response,cbsOverview:d.response}})},format:function(a,b){var c={},d=a.cvmOverview.resourceOverview;d.diskNumberTotal=a.cbsOverview.diskOverview.diskNumberTotal,d.expiredNumberTotal=a.cbsOverview.diskOverview.expiredNumberTotal,d.diskNumberExpireIn7days=a.cbsOverview.diskOverview.diskNumberExpireIn7days,d.snapshotNumberUsedTotal=a.cbsOverview.snapOverview.snapshotNumberUsedTotal,d.snapshotCapacityUsedTotal=a.cbsOverview.snapOverview.snapshotCapacityUsedTotal,c.resourceOverview=d;var e=a.cvmOverview.securityOverview,f=e.securityIntrusions;e.securityIntrusions=f&&f.instrusionsDetectionResult||f&&f.instrusionsDetectionDetail&&(f.instrusionsDetectionDetail.bruteForceNum>0||f.instrusionsDetectionDetail.nonlocalLoginNum>0||f.instrusionsDetectionDetail.trojanFileNum>0||f.instrusionsDetectionDetail.vulNum>0)?f:null,c.securityOverview=e;var g=[],h=function(){if(!m.REGIONAREAMAP[i])return"continue";var c=a.cvmOverview.resourceDetailOverview[i];if(!c.resourceDetail||"1"===b&&!c.resourceDetail.totalCount)return"continue";var d={};d.region=i,d.regionId=Object.keys(m.REGIONIDMAP).find(function(a){return m.REGIONIDMAP[a]===i})||"",d.regionName=m.REGIONAREAMAP[i].area+"("+m.REGIONAREAMAP[i].name+")";var e=c.resourceDetail;e.dueInstanceCount=e.dueInstanceCount||0,e.expiredInstanceCount=e.expiredInstanceCount||0,e.totalCount=e.totalCount||0,e.unSecurityCount=e.unSecurityCount||0,e.runningCount=e.runningCount||0,d.resourceDetail=e;var f=c.imageQuota;f.totalQuota=f.totalQuota||0,f.usedQuota=f.usedQuota||0,d.imageQuota=f;var h=c.snapShotQuota;h.totalQuota=h.totalQuota||0,h.usedQuota=h.usedQuota||0,h.totalCapacity=h.totalCapacity||0,h.usedCapacity=h.usedCapacity||0,d.snapShotQuota=h;var j=c.postPayQuota;j.totalQuota=c.postPayQuota.totalQuota||0,j.totalUsedQuota=c.postPayQuota.totalUsedQuota||0,j.quotaForZones=Object.keys(c.postPayQuota).filter(function(a){return a in m.ZONEV3TOZONEIDMAP}).map(function(a){return{zoneId:a,zoneName:m.ZONEIDV3TONAMEMAP[a],totalQuota:c.postPayQuota[a].totalQuota,usedQuota:c.postPayQuota[a].usedQuota}}),d.postPayQuota=j;var k=c.prePayQuota;k.totalQuota=k.totalQuota||0,k.totalUsedQuota=k.totalUsedQuota||0,k.quotaForZones=Object.keys(c.prePayQuota).filter(function(a){return a in m.ZONEV3TOZONEIDMAP}).map(function(a){return{zoneId:a,zoneName:m.ZONEIDV3TONAMEMAP[a],totalQuota:c.prePayQuota[a].totalQuota,usedQuota:c.prePayQuota[a].usedQuota}}),d.prePayQuota=k,g.push(d)};for(var i in a.cvmOverview.resourceDetailOverview){h()}return c.regionSourceList=g,c},customizeHomePage:function(){var a=window.localStorage.getItem("cvm_homepage"+e.getUin());h.create(['<div class="tc-15-rich-dialog-bd">','<div class="tc-15-msg">','<div class="tip-info">进入实例业务时，您可以选择默认显示的页面</div>',"</div>",'<ul class="form-list">','<li class=" ">','<div class="form-label">','<label for="homepage">默认展示页面</label>',"</div>",'<div class="form-input">','<div class="form-unit">','<select name="homepage" class="tc-15-select m">',"<option","cvm"==a?" selected":"",' value="overview">概览</option>',"<option","overview"==a?" selected":"",' value="cvm">实例</option>',"<option","cdh"==a?" selected":"",' value="cdh">专用宿主机</option>',"<option","image"==a?" selected":"",' value="image">镜像</option>',"<option","cbs"==a?" selected":"",' value="cbs">云硬盘</option>',"</select>","</div>","</div>","</li>","</ul>","</div>"].join(""),520,"",{title:"定制首页",defaultCancelBtn:!1,button:{" 确定 ":function(){var a=h.contentEl.find("option:selected").val();try{window.localStorage.setItem("cvm_homepage"+e.getUin(),a)}catch(b){console.warn(b)}h.hide()}}})},getShowAllRegionConfig:function(){return window.localStorage.getItem("is_show_all_region_in_cvm_overview")||1},setShowAllRegionConfig:function(a){a=a?1:0;try{window.localStorage.setItem("is_show_all_region_in_cvm_overview",a)}catch(b){console.warn(b)}this.isOnlyShowHasResourceRegion=a},renderNotice:function(){var a=this,b="",c=null,f=this.$container.find(".manage-area-main");g.getCVMNotice(function(g){a.pageActive&&g.length&&!d("#noticeBox").length&&(g=a.filterNoticeData(g),b=e.tmpl(p.notice,{data:g}),f.prepend(b),c=d("#noticeBox"),c.on("click",".notice-btn-close",function(b){c.find(".notice-item").each(function(b,c){a.setIgnoreNoticeData(d(c).attr("data-ntime"))}),c.remove()}))})},filterNoticeData:function(a){a=a||[];var b=this.getIgnoreNoticeData();return a.filter(function(a){return!b[a.addTime]})},getIgnoreNoticeData:function(){var a=localStorage.getItem("CVM_NOTICE_IGNORE")||"{}";return d.parseJSON(a)},setIgnoreNoticeData:function(a){var b=this,c=b.getIgnoreNoticeData();c[a]=1;try{localStorage.setItem("CVM_NOTICE_IGNORE",JSON.stringify(c))}catch(d){console.warn(d)}},destroy:function(){j.destroy()}}}),define("cvm/overview/unnormal",function(a,b,c){
var d=a("$"),e=a("util"),f=a("appUtil"),g=a("cvm/common/constants"),h=a("manager"),i=a("models/iaas"),j={main:'    <% if(unsafe && renew){ %>     <div class="tc-g-u-1-3">        <div class="mod-console">            <div class="mod-console-hd">                <h3><span data-title="存在实例安全风险的实例">安全风险隐患云服务器</span></h3>                <div class="more-info">                    <a href="https://console.qcloud.com/workorder/category" target="_blank" data-title="云服务器由于安全风险外网已被隔离，请尽快处理安全风险<br>解除风险后提交工单给我们确认执行结果。">提交工单</a> <a href="javascript:void(0);" data-title="电话联系：4009-100-100">联系客服</a>                </div>            </div>            <div id="unsafeCvmList" class="mod-console-bd">            </div>        </div>    </div>    <div class="tc-g-u-2-3">        <div class="mod-console">            <div class="mod-console-hd">                <h3><span data-title="7天内到期实例">待续费云服务器</span></h3>                <div class="more-info">                    <a href="https://console.qcloud.com/account/renewal" target="_blank">续费管理</a>                </div>            </div>            <div id="renewCvmList" class="mod-console-bd">            </div>        </div>    </div>    <% }else if(unsafe){ %>      <div class="tc-g-u-1">          <div class="mod-console">              <div class="mod-console-hd">                  <h3><span data-title="存在实例安全风险的实例">安全风险隐患云服务器</span></h3>                  <div class="more-info">                      <a href="https://console.qcloud.com/workorder/category" target="_blank" data-title="云服务器由于安全风险外网已被隔离，请尽快处理安全风险<br>解除风险后提交工单给我们确认执行结果。">提交工单</a> <a href="javascript:void(0);" data-title="电话联系：4009-100-100">联系客服</a>                  </div>              </div>              <div id="unsafeCvmList" class="mod-console-bd">              </div>          </div>      </div>    <% }else if(renew){ %>      <div class="tc-g-u-1">        <div class="mod-console">            <div class="mod-console-hd">                <h3><span data-title="7天内到期实例">待续费云服务器</span></h3>                <div class="more-info">                    <a href="https://console.qcloud.com/account/renewal" target="_blank">续费管理</a>                </div>            </div>            <div id="renewCvmList" class="mod-console-bd">            </div>        </div>      </div>    <% } %>'},k={renew:{main:a("modules/cvm2/event/renew/renew"),name:"续费"}},l=e.tmpl('    <div class="id-name-cell">        <p>            <% if (item.uInstanceId) { %>                <a data-event="nav" href="/cvm/index?rid=<%- item.regionId %>&instanceId=<%- item.uInstanceId %>"><%- item.uInstanceId%></a>            <% } %>        </p>        <p>            <span class="text-overflow" title="<%= item.alias%>">                <%= item.alias %>            </span>        </p>    </div>',null),m=e.tmpl('    <div class="cvm-oper-cell" style="white-space:nowrap">        <a data-name="renew" data-event="cvm_oper_action" href="/cvm/index?rid=<%- item.regionId %>&instanceId=<%- item.uInstanceId %>">续费</a>    </div>',null);c.exports={render:function(a){var b=this;b.$container=a.container,this.initGridView(),this.bindEvent(),this.renderList(a)},renderList:function(a){var b=a.cvmData.safeIsolateNum||0,c=a.cvmData.toRenewNum||0;this.$container.html(e.tmpl(j.main,{unsafe:b>0,renew:c>0})),b>0&&(this.unsafeCvmListEl=d("#unsafeCvmList"),this.renderUnsafeList(a)),c>0&&(this.renewCvmListEl=d("#renewCvmList"),this.renderRenewList(a))},renderUnsafeList:function(a){var b=this;d.when(b.getData({appId:f.getAppId(),deviceType:"safeIsolate",count:+a.count,page:+a.page}),b.getCvmWhiteList(["PrepaidForCVM","CVM_bandwidtd"])).done(function(c,d){var e=d.PrepaidForCVM&&d.PrepaidForCVM.length>0;c=c.data,b.isPrepaidUser=e,b.unsafeListData=b.dataformat(c.deviceList),b.unsafeCvmListEl.append(b.unsafeGridView.$el),b.unsafeGridView.checkCellWidth(),b.unsafeGridView.setData({list:b.unsafeListData,totalNum:c.totalNum,page:+a.page,count:+a.count,orderField:a.orderField||"addTimeStamp",order:a.order}),b.unsafePromise.resolve()})},renderRenewList:function(a){var b=this;d.when(b.getData({appId:f.getAppId(),deviceType:"toRenew",count:+a.count,page:+a.page}),b.getCvmWhiteList(["PrepaidForCVM","CVM_bandwidtd"])).done(function(c,d){var e=d.PrepaidForCVM&&d.PrepaidForCVM.length>0;c=c.data,b.isPrepaidUser=e,b.renewListData=b.dataformat(c.deviceList),b.renewCvmListEl.append(b.renewGridView.$el),b.renewGridView.checkCellWidth(),b.renewGridView.setData({list:b.renewListData,totalNum:c.totalNum,page:+a.page,count:+a.count,orderField:a.orderField||"addTimeStamp",order:a.order}),b.renewPromise.resolve()})},getData:function(a){var b=+a.count,c=+a.page,e=b*(c-1),g=d.Deferred();return i.apiRequest({serviceType:"cvm",cmd:"GetAppCvmOverviewDeviceList",data:{appId:f.getAppId(),deviceType:a.deviceType,startNum:e,endNum:e+b-1}}).then(function(a){g.resolve(a)},function(a){g.reject(a)}),g},getCvmWhiteList:function(a){var b=d.Deferred();return h.getAllWhiteList(function(a){b.resolve(a)},function(a){b.reject(a)}),b},exec:function(a){new k[a].main({listIns:this})},initGridView:function(){var a=Bee.getComponent("grid-view");this.unsafeGridView=new a(this.getGridViewOPtions("unsafe")),this.unsafePromise=d.Deferred(),this.renewGridView=new a(this.getGridViewOPtions("renew")),this.renewPromise=d.Deferred()},getGridViewOPtions:function(a){var b=this;return{$data:{hasFirst:!1,order:1,initGetData:!1,minHeight:"auto",autoMaxHeight:!1,colums:this.getColumns(a)},getCellContent:function(a,c,d){return b.getCellContent(a,c,d)},getData:function(c,d){var e="unsafe"==a?b.renderUnsafeList:b.renderRenewList;e.call(b,c)}}},getColumns:function(a){var b,c=[];b="unsafe"==a?{idName:{name:"ID/实例名",minWidth:200,required:!0},regionName:{name:"地域",required:!0}}:{idName:{name:"ID/实例名",minWidth:200,required:!0},regionName:{name:"地域",required:!0},cvmPayModeDesc:{name:"实例计费模式",defaults:!0},_operCol:{name:"操作",required:!0}};for(var d in b){var e=b[d],f={key:d,name:e.name,width:e.width,order:e.sort,orderField:e.orderField,locked:e.locked,hide:!e.defaults&&!e.required,required:e.required,minWidth:e.minWidth};c.push(f)}return c},getCellContent:function(a,b,c){switch(c.key){case"idName":return l({item:b});case"regionName":return g.REGIONNAMES[b.regionId];case"cvmPayModeDesc":return"<div><p>"+b.cvmPayModeDesc+"</p><p>"+b.cvmPayModeTimeDesc+"</p></div>";case"_operCol":return m({item:b});default:return'<span class="text-overflow" title="'+a+'">'+(a||"")+"</span>"}},dataformat:function(a){var b=this;return d(a).each(function(a,c){b.cvmPayModeDesc(c)}),a},cvmPayModeDesc:function n(a){var n="包年包月",b=[];if(a.cvmPayMode===g.CVMPAYMODE.CDHPAID)n="不计费",b.push('<p><span class="text-overflow" >到期时间: 无</span></p>');else if(a.cvmPayMode===g.CVMPAYMODE.POSTPAID_BY_HOUR)n="按量计费",a.addTimeStamp&&b.push("<p>"+f.formatDate(f.getDate(a.addTimeStamp),"yyyy-MM-dd")+"创建</p>");else if(this.isPrepaidUser){var c=this.deadlineInfoAndStatus(a);"-"!=c&&(0==a.deadlineStatus?b.push(c+"到期"):b.push(c))}else n="后付费";a.cvmPayModeDesc=n,a.cvmPayModeTimeDesc=b.join("")},deadlineInfoAndStatus:function(a,b){var c=a.deadline||"0000-00-00 00:00:00",d=864e5,e=7*d,g=new Date(c.replace(/\-/g,"/")),h=0,i="",j=b&&!isNaN(b)?b:(new Date).getTime();h=j-g.getTime();var k=0;if("0000-00-00 00:00:00"==c)i="-",k=3;else if(h>0){var l=Math.floor(h/d);i=1>l?'<span class="text-overflow status-recover error">已过期1天</span>':'<span class="text-overflow status-recover error">已过期'+l+"天</span>",k=1}else if(-e>h)i=f.formatDate(f.getDate(c),"yyyy-MM-dd"),k=0;else{var l=Math.floor(Math.abs(h/d));i=1>l?'<span class="text-overflow warning">小于1天到期</span>':'<span class="text-overflow warning">'+l+"天后到期</span>",k=2}return a.deadlineStatus=k,a.deadlineInfo=i},setEqualHeight:function(){var a=this,b=0;d.when(a.unsafePromise,a.renewPromise).done(function(){if(a.unsafeCvmListEl.length&&a.renewCvmListEl.length){var c=a.unsafeGridView.$gridBody,d=a.renewGridView.$gridBody;b=Math.max(c.height(),d.height()),b&&(c.height(b),d.height(b))}})},bindEvent:function(){var a=this;a.setEqualHeight()}}}),define("cvm/recycle/cbs/cbs",function(a,b,c){var d=a("$"),e=(a("pageManager"),a("manager")),f=a("util"),g=a("appUtil"),h=(a("event"),a("projectsSelector")),i=a("widget/fieldsManager/gridView"),j=a("cvm/cbs2/data"),k=a("cvm/cvm/data"),l=(a("tips"),a("cvm/recycle/renew_cbs")),m=(a("modules/cvm/cbs/cbsutil"),a("modules/cvm/cbs/cbs")),n=a("widget/errorTips/errorTips"),o=(a("models/api"),a("search"),a("router"),a("reporter"),a("qccomponent")),p=a("cvm/cbs2/event/export"),q=a("cvm/cbs2/event/destroycbs"),r=a("cvm/cbs2/event/createsnapshot"),s=a("cvm/cbs2/data"),t=a("constants"),u=(a("cvm/common/components/regionPills"),{param:{},title:"云硬盘-控制台",pageClass:"",render:function(a,b){var c=this;this.pageBee=new o('    <div>      <div class="manage-area">        <div class="manage-area-title with-bottom-border">          <h2>云硬盘</h2>          <div id="projectsWrapper" class="tc-select-box"></div>        </div>        <div class="manage-area-main">          <div class="manage-area-full-inner">            <div  class="mb-10"><cvm-region-pill b-ref="regionPill" b-model="regionId"></cvm-region-pill></div>            <div class="tc-15-msg with-margin">              到期7天后仍未续费的云硬盘，会在回收站中保留7天，这期间您可以续费进行恢复。7天后，这些云硬盘会被彻底释放，不可恢复。            </div>            <div id="operArea">              <div class="tc-15-action-panel">                <button class="tc-15-btn weak m download" data-event="cbs_recycel_oper_action" title="导出"></button>                <button type="button" class="tc-15-btn m disabled" data-event="renew" data-hot="yunzhuji.recyle.renew_more">批量恢复</button>                <button type="button" class="tc-15-btn m weak disabled" data-event="destroy">批量释放</button>                <button class="tc-15-btn weak m setting" data-event="set_Fields" title="设置列表显示字段" data-hot="yunzhuji.setfields"                  data-grid-setting="true">                </button>                <div id="searchArea" class="pull-right"></div>              </div>              <div id="cbsList" style="position:relative"></div>            </div>          </div>          <!-- </div> -->          <!-- </div> -->        </div>      </div>    </div>  ',{}),nmc.render(this.pageBee.$el,"cvm"),this.getProjectId=g.getProjectId.bind(g),this.getRegionId=g.getRegionId.bind(g),b&&b.storageIds&&(b.storageIds=b.storageIds.split(",")),this.param=Object.assign({page:1,count:20,projectId:this.getProjectId(),regionId:this.pageBee.regionId,storageIds:""},b),this.projectsAreaEl=d("#projectsArea"),this.searchAreaEl=d("#searchArea"),this.projectsWrapperEl=d("#projectsWrapper"),this.cbsListEl=d("#cbsList"),this.projectsSelector=new h({renderTo:this.projectsWrapperEl,selectedId:g.getProjectId(),change:function(){c.renderList()}}),this.pageBee.$refs.regionPill.$on("selected",function(a){c.renderList({regionId:a.regionId})}),this.bindEvent(),this.renderBtnGroup(),this.initGridView(),this.renderList(this.param),this.renderRegionNumber(),new Promise(function(a,b){e.queryWhiteList({whiteKey:["ASYNC_EXPORT_CBS"]},function(b){a(b)},function(){b({})})}).then(function(a){c.isAsyncExport=a.ASYNC_EXPORT_CBS&&a.ASYNC_EXPORT_CBS.length>0})["catch"](function(){})},renderRegionNumber:function(){var a=this;s.queryUserDiskResources().then(function(b){var c=a.pageBee.$refs.regionPill,d=c.list||[],e=c.regionId,f=b&&b.response.resourcesDetailSet||[];f&&f.length&&(d.forEach(function(a){var b=f.find(function(b){for(var c in t.REGIONIDMAP)if(t.REGIONIDMAP[c]==b.region){b.regionId=c;break}return a.regionId==b.regionId});b&&(b.diskNumberIsolated||0==b.diskNumberIsolated)&&(a.label=a.regionName+"("+b.diskNumberIsolated+")"),a.active=a.value==e?1:void 0}),c.$set("list",d),c.toggle({regionId:c.regionId}))})},resetTr:function(a){for(var b=d(a).attr("data-index"),c=this.gridView,e=0,f=c.list.length;f>e;e++)c.$refs.list[e].$set({$selected:!1});c.$refs.list[b].$set({$selected:!0})},bindEvent:function(){var a=this;d("#operArea").on("click","[data-event=cbs_recycel_oper_action]",function(){var b=new p({listIns:a,isFromRecycle:!0});b.exec()}),d("#operArea").on("click","[data-event=renew]",function(){var b=a.gridView.getSelected();b.length>0&&l.init(b,{len:b.length})}),d("#operArea").on("click","[data-event=destroy]",function(){var b=a.gridView.getSelected();b.length>0&&q.init(b,{callback:function(){setTimeout(function(){a.renderRegionNumber.call(a)},2e3),a.refresh.call(a)}},!0)}),d("#operArea").find("[data-event=set_Fields]").click(function(){a.gridView.showFieldsManager()})},refresh:function(){this.renderBtnGroup(),this.renderList(),this.checkEvent()},checkEvent:function(){var a=d.extend(!0,[],this.gridView.getSelected());a.length?(d('#operArea [data-event="renew"]').removeClass("disabled"),d('#operArea [data-event="destroy"]').removeClass("disabled")):(d('#operArea [data-event="renew"]').addClass("disabled"),d('#operArea [data-event="destroy"]').addClass("disabled"))},initGridView:function(){var a=this,b={$data:{hasFirst:!0,initGetData:!1,canResizeColum:!0,selectedHighlight:!1,colums:a.getColumns(),list:[],canSelectTotal:!1,autoMaxHeight:!0,maxHeightOffset:10,autoCheckWidth:!1,showState:!0,showPagination:!0,totalNum:0,trackKey:"uuid",searchItemName:"云硬盘"},$mixins:[i("recycle_cbs_fields_201806071510")],getCellContent:function(b,c,d){return a.getCellContent(b,c,d)},setTrAttr:function(a,b){return{"data-diskId":b.diskId}},getSlectItem:function(b){var c=[];return d(a.gridView.list).each(function(a,e){d(b).each(function(a,b){var f=d(b).closest("tr").data("diskid");e.diskId==f&&c.push(e)})}),c.length>0?c:void 0},events:{"click tr [data-event=renew]":function(b){a.resetTr(d(b.target).parents("tr")),a.checkEvent();var c=a.gridView.getSlectItem(b.target);l.init(c,{len:1})},"click tr [data-event=destroy]":function(b){a.resetTr(d(b.target).parents("tr")),a.checkEvent();var c=a.gridView.getSlectItem(b.target);q.init(c,{callback:function(){setTimeout(function(){a.renderRegionNumber.call(a)},2e3),a.refresh.call(a)}},!0)},"click tr [data-event=createsnapshot]":function(b){if(a.resetTr(d(b.target).parents("tr")),a.checkEvent(),!(b.target.className.indexOf("disable")>-1)){var c=a.gridView.getSlectItem(b.target);r.init(c,{projectId:a.getProjectId(),regionId:a.getRegionId(),callback:a.refresh.bind(a)})}},"click tr :checkbox:eq(0)":function(b){setTimeout(function(){a.checkEvent()},0)},"click tr[data-diskid] input[type=checkbox]":function(b){setTimeout(function(){a.checkEvent()},0)}},getData:function(b,c){this.page=b.page,this.count=b.count,a.renderList()}},c=o.getComponent("grid-view");a.gridView=new c(b),a.cbsListEl.append(a.gridView.$el),this.param.storageIds&&this.search.$set("keyword",this.param.storageIds.join("\n"))},renderBtnGroup:function(){var a=this;this.searchAreaEl=d("#searchArea");var b=o.components["qc-search"],c=this.search=new b({$data:{keyword:"",searchEmpty:!0,multiple:!0,placeholder:"请输云硬盘ID(换行分隔)"},search:function(){a.gridView.page=1,a.gridView.count=20,a.renderList()}});this.searchAreaEl.html("").append(c.$el)},getFilter:function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},b=this.search.getKeyword().replace(/\s+/,"\n").split("\n"),c=[];b=d(b).each(function(a,b){b&&c.push(b)});var e=a&&a.page>0?a.page:this.gridView.page,f=a&&a.count>0?a.count:this.gridView.count,g={offset:(e-1)*f,limit:f,regionId:a.regionId||this.getRegionId()},h=[{name:"disk-state",Values:["TORECYCLE"]},{name:"disk-usage",Values:["DATA_DISK"]},{name:"disk-charge-type",Values:["PREPAID"]}];c&&c.length&&h.push({name:"disk-id",Values:c});var i=this.getProjectId();return-1!=i&&h.push({name:"project-id",Values:[i]}),g.Filters=h,g},renderList:function(a){var b=this;b.queryInstanceParams=this.getFilter(a),a=this.getFilter(a),Promise.all([j.queryDisks(a),k.queryZone(this.getRegionId({}))]).then(function(c){var d=c[0],e=c[1],f=m.formatData(d.response.diskSet,e);b.gridView.checkCellWidth(),b.gridView.setData({list:f,totalNum:d.response.totalCount,page:Math.floor(a.offset/a.limit)+1,count:a.limit})},function(a){b.gridView.setData({list:[],totalNum:0}),n.isCamRefused(a)?b.gridView.showTips("<cam-tips>"+a.message+"</cam-tips>"):b.gridView.showTips('<span class="text" style="word-wrap:break-word;">'+a.message+"</span>")})},getCellContent:function(a,b,c){return"diskId"==c.key?f.tmpl('<div><p><%=diskId%></p><p><span class="text-overflow m-width"><%=diskName%></span></p></div>',b):"diskState"==c.key?'<div><span class="text-overflow m-width text-'+b.statusDesClass+'">'+b.statusDesc+"</span></div>":"instanceId"==c.key?b.instanceId?'<div><a data-event="nav" href="/cvm/detail/'+g.getRegionId()+"/"+b.instanceId+'">'+b.instanceId+"</a></div>":"<div>-</div>":"_operCol"==c.key?f.tmpl('    <div>      <a href="javascript:void(0);" data-event="renew">恢复</a>      <a href="javascript:;" data-event="destroy">释放</a>      <a href="javascript:;" data-event="createsnapshot"        class="<%= (!item.isSnapAbility ? "disabled": "" ) %>"        title="<%= (!item.isSnapAbility ? "无法创建快照": "" ) %>"        >        创建快照      </a>    </div>  ',{item:b}):"<div>"+(a||"")+"</div>"},getColumns:function(){var a=[{key:"diskId",name:"ID/名称",minWidth:150,required:!0},{key:"diskState",name:"状态",width:60,required:!0},{key:"storageSizeDesc",name:"容量",required:!0},{key:"zoneName",name:"可用区",required:!0},{key:"storageTypeDesc",name:"硬盘种类"},{key:"diskTypeDesc",name:"硬盘属性",minWidth:150},{key:"instanceId",name:"隔离前挂载的实例",width:150},{key:"payModeDesc",name:"计费模式",width:160},{key:"deadlineTimeDesc",name:"释放倒计时",width:60},{key:"_operCol",name:"操作",required:!0,minWidth:100}];return a}});c.exports=u}),define("cvm/recycle/cdh/cdh",function(a,b,c){function d(a){var b=7,c=864e5,d=c*b,e=new Date(a.replace(/\-/g,"/")),f=0,g="-",h=(new Date).getTime();if(f=h-e.getTime(),"0000-00-00 00:00:00"!=a)if(d>f){f=f.toFixed(2)-0;var i=(b-f/c).toFixed(2).split("."),j="";if(i[1]){var j=(i[1]/100*24).toFixed(0)-0;j>=24&&(j=0,i[0]=parseInt(i[0])+1),j=j>0?j+"小时":""}g='<span class="text-overflow text-danger">'+i[0]+"天"+j+"后释放</span>"}else g='<span class="text-overflow status-recover">即将释放</span>';return g}var e=a("$"),f=(a("pageManager"),a("manager")),g=a("util"),h=(a("cvm/cdh/util"),a("appUtil")),i=a("projectsSelector"),j=a("widget/fieldsManager/gridView"),k=(a("tips"),a("qccomponent")),l=a("dialog"),m=a("cvm/cdh/dialog/renew"),n=(a("models/api"),a("validator"),a("cvm/cdh/data")),o=a("widget/errorTips/errorTips"),p=a("cvm/cdh/dialog/export"),q={main:'  <div>    <div class="manage-area">      <div class="manage-area-title with-bottom-border">        <h2>专用宿主机</h2>        <div id="projectsWrapper" class="tc-select-box"></div>        <div id="regionWrapper" class="tc-select-box">            <cvm-region-pill b-ref="regionPill" b-model="regionId"></region-pill>        </div>      </div>      <div class="manage-area-main">        <!-- <div class="tc-15-tab tc-15-tab-alt trash-tab"> -->        <!-- <div class="tab-panel"> -->        <div class="manage-area-full-inner">          <div class="tc-15-msg with-margin">            到期仍未续费的专用宿主机，会在回收站中保留7天，这期间您可以续费进行恢复。7天后，这些宿主机会被彻底释放，不可恢复。          </div>          <div id="operArea">            <div class="tc-15-action-panel">              <button class="tc-15-btn weak m download" data-event="cdh_recycel_oper_action" title="导出"></button>              <button type="button" class="tc-15-btn m " id="cdhRenewBtn" data-event="cvm_oper_action">批量恢复</button>              <button class="tc-15-btn weak m setting" data-event="set_Fields" title="设置列表显示字段" data-hot="yunzhuji.setfields" data-grid-setting="true">              </button>              <div id="searchArea" class="pull-right"></div>            </div>            <div id="cdhList" style="position:relative"></div>          </div>        </div>        <!-- </div> -->        <!-- </div> -->      </div>    </div>  </div>',idName:'  <div class="id-name-cell">    <span class="text-overflow m-width">{{item.uHostId}}</span>    <div>      <span class="text-overflow m-width" title="{{item.hostAlias}}"> {{item.hostAlias ? item.hostAlias : \'未命名\'}}      </span>    </div>  </div>'},r=a("cvm/common/model"),s={title:"专用宿主机-控制台",pageClass:"",render:function(a,b){var c=this;this.pageBee=new k('  <div>    <div class="manage-area">      <div class="manage-area-title with-bottom-border">        <h2>专用宿主机</h2>        <div id="projectsWrapper" class="tc-select-box"></div>        <div id="regionWrapper" class="tc-select-box">            <cvm-region-pill b-ref="regionPill" b-model="regionId"></region-pill>        </div>      </div>      <div class="manage-area-main">        <!-- <div class="tc-15-tab tc-15-tab-alt trash-tab"> -->        <!-- <div class="tab-panel"> -->        <div class="manage-area-full-inner">          <div class="tc-15-msg with-margin">            到期仍未续费的专用宿主机，会在回收站中保留7天，这期间您可以续费进行恢复。7天后，这些宿主机会被彻底释放，不可恢复。          </div>          <div id="operArea">            <div class="tc-15-action-panel">              <button class="tc-15-btn weak m download" data-event="cdh_recycel_oper_action" title="导出"></button>              <button type="button" class="tc-15-btn m " id="cdhRenewBtn" data-event="cvm_oper_action">批量恢复</button>              <button class="tc-15-btn weak m setting" data-event="set_Fields" title="设置列表显示字段" data-hot="yunzhuji.setfields" data-grid-setting="true">              </button>              <div id="searchArea" class="pull-right"></div>            </div>            <div id="cdhList" style="position:relative"></div>          </div>        </div>        <!-- </div> -->        <!-- </div> -->      </div>    </div>  </div>',{}),nmc.render(this.pageBee.$el,"cvm"),this.projectsAreaEl=e("#projectsArea"),this.searchAreaEl=e("#searchArea"),this.projectsWrapperEl=e("#projectsWrapper"),this.regionWrapperEl=e("#regionWrapper"),this.cdhListEl=e("#cdhList"),this.searchAreaEl=e("#searchArea"),this.projectsSelector=new i({renderTo:this.projectsWrapperEl,selectedId:h.getProjectId(),change:function(a){c.renderList({projectId:this.val()})}}),this.pageBee.$refs.regionPill.$on("selected",function(a){c.renderList({regionId:a.regionId})}),this.bindEvent(),this.renderBtnGroup();var d=this,g=function(a){var e=d.getColumns(),f=e.filter(function(b){return!b.cageIdOnly||a});d.initGridView(f),c.cdhListEl.html(c.gridView.$el),d.renderList(b)};r.apiDelegate({cmd:"GetProductUsageInfo",serviceType:"cage",regionId:h.getRegionId(),data:{}}).then(function(a){g(a&&a.data&&a.data.isOpen?!0:!1)},function(a){g(!1)}),new Promise(function(a,b){f.queryWhiteList({whiteKey:["ASYNC_EXPORT_CDH"]},function(b){a(b)},function(){b({})})}).then(function(a){c.isAsyncExport=a.ASYNC_EXPORT_CDH&&a.ASYNC_EXPORT_CDH.length>0})["catch"](function(){})},bindEvent:function(){var a=this;a.cdhListEl.on("click",'input[type="checkbox"]',function(b){setTimeout(function(){a.updateRenewBtn(a.gridView.getSelected())},0)}),e("#operArea").find("[data-event=cvm_oper_action]").click(function(b){if(!e("#cdhRenewBtn").hasClass("disabled")){var c=a.gridView.getSelected();c.length>0&&a.showRenewDia(c)}}),e("#operArea").on("click","[data-event=cdh_recycel_oper_action]",function(){var b=new p({listIns:a,isFromRecycle:!0});b.exec()}),e("#operArea").find("[data-event=set_Fields]").click(function(){a.gridView.showFieldsManager()})},initGridView:function(a){var b=this,c={$data:{hasFirst:!0,orderField:"addTimeStamp",order:1,initGetData:!1,canResizeColum:!0,selectedHighlight:!1,colums:a,list:[],canSelectTotal:!1,autoMaxHeight:!0,maxHeightOffset:10,autoCheckWidth:!1,showState:!0,showPagination:!0,totalNum:0,trackKey:"uHostId",searchItemName:"专用宿主机",trAttr:{"data-uHostId":"uHostId"}},$mixins:[j("recycle_cdh_fields")],getCellContent:function(a,c,d){return b.getCellContent(a,c,d)},getHeadContent:function(a){return"cageId"===a.key?'<grid-view-header-filter b-ref="cageFilter" b-with="{ ready: cageFilterReady.bind(this.$root),filterOptions: cagelist, col: col, change: cageChange.bind(this.$root) }"></grid-view-header-filter>':void 0},cageFilterReady:function(a){b.cageFilter=a},cageChange:function(a){var c;a&&a.length>0&&(c=a.join(",")),b.gridView.getData({cageId:c?encodeURIComponent(c):""})},events:{"click tr [data-event=renew]":function(a){var c=e(a.target).closest("tr"),d=c.attr("data-index");b.showRenewDia([b.gridView.list[d]])}},getData:function(a,c){b.renderList(a)}},d=k.getComponent("grid-view");b.gridView=new d(c)},renderBtnGroup:function(){var a=this;this.searchAreaEl=e("#searchArea");var b=k.components["qc-search"],c=this.search=new b({$data:{keyword:"",searchEmpty:!0,multiple:!1,placeholder:"请输独立宿主机ID搜索"},search:function(b){a.renderList({searchKey:b})}});this.searchAreaEl.html("").append(c.$el)},updateRenewBtn:function(a){if(a&&a.length>0){var b=[],c=[],d=[],f=[];a.forEach(function(a){var e=a.cageId||"common";c.indexOf(e)<0&&c.push(e),b.indexOf(a.externalHostType)<0&&b.push(a.externalHostType),d.indexOf(a.zoneId)<0&&d.push(a.zoneId),f.indexOf(a.projectId)<0&&f.push(a.projectId)}),c.length>1?(e("#cdhRenewBtn").addClass(" disabled"),e("#cdhRenewBtn").attr("title","不支持不同围笼内的专用宿主机同时恢复")):(e("#cdhRenewBtn").attr("title",""),e("#cdhRenewBtn").removeClass(" disabled"))}else e("#cdhRenewBtn").attr("title",""),e("#cdhRenewBtn").removeClass(" disabled")},showRenewDia:function(a){var b=new m({selectedItem:a});l.create(b.$el,"700","",{title:"续费","class":"dialog_layer_v2 tc-15-rich-dialog new-gateway",preventResubmit:!0,button:{" 确定 ":function(a){b.doAction(l)}}})},getQueryParam:function(a){var b=this,c=a.page>0?a.page:b.page,d=a.count>0?a.count:b.count,e=(c-1)*d,f=[{Name:"host-state",Values:["EXPIRED"]},{Name:"host-charge-type",Values:["PREPAID"]}];return a.searchKey&&(0==a.searchKey.indexOf("host-")?f.push({Name:"host-id",Values:[a.searchKey]}):f.push({Name:"host-name",Values:[a.searchKey]})),a.projectId>=0&&f.push({Name:"project-id",Values:[a.projectId]}),{limit:d,offset:e,Filters:f,page:c,count:d}},renderList:function(a){var b=this;a=e.extend({},{projectId:h.getProjectId(),regionId:h.getRegionId()},a);var c=b.getQueryParam(a);b.queryInstanceParams=c,n.queryCdhList(c,{camTips:!1}).then(function(d){if(d&&d.response&&d.response.hostSet){var e=n.formatList(d.response.hostSet,{regionId:a.regionId}),f=d.response.totalCount;b.gridView.setData({list:e,totalNum:f,searchKey:a.searchKey||!1,page:c.page||1,count:c.count||20})}else{if(d.errors&&d.errors.length){b.gridView.setData({list:[]});for(var g=0;g<d.errors.length;g++){var h=d.errors[g];o.isCamRefused(h)?b.gridView.showTips("<div><cam-tips>"+h.message+"</cam-tips></div>"):b.gridView.showTips("<div><error-tips>"+h.message+"</error-tips></div>");break}return}b.gridView.setData({list:[]})}},function(a){b.gridView.setData({list:[]}),b.gridView.showTips("<div><error-tips>"+a.message+"</error-tips></div>")})},getCellContent:function(a,b,c){var e;switch(c.key){case"cpuTotal":return a+"核";case"memTotal":return a+"GB";case"cageId":return e=b.cageId?"<div><p>"+(a||"-")+'</p><p><span class="text-overflow restart">'+(b.cageAlias||"未命名")+"</span></p></div>":'<span class="text-overflow">-</span>';case"diskTotal":return a+"GB";case"idAndName":return e=q.idName;case"cvmNumber":return isNaN(a)?"-":a;case"_operCol":return g.tmpl('  <div>    <a href="javascript:void(0);" data-event="renew">恢复</a>  </div>',b);case"deadlineTimeDesc":var f=d(b.expiredTimeDesc);return"<div>"+(f||"-")+"</div>";default:return"<div>"+(a||"")+"</div>"}},getColumns:function(){var a=[{key:"idAndName",name:"ID/宿主机名",required:!0},{name:"机型",key:"externalHostType",required:!0},{cageIdOnly:!0,name:"所属围笼",key:"cageId"},{name:"实例",key:"cvmNumber",required:!0},{key:"cpuTotal",name:"总CPU",required:!0},{key:"memTotal",name:"总内存"},{key:"diskTotal",name:"总硬盘容量"},{key:"deadlineTimeDesc",name:"释放倒计时",required:!0},{key:"_operCol",name:"操作",required:!0}];return a}};c.exports=s}),define("cvm/recycle/cvm/cvm",function(a,b,c){var d=a("$"),e=a("util"),f=a("appUtil"),g=a("cvm/common/constants"),h=a("cvm/cvm/cvmutil"),i=a("widget/pills/pills"),j=(a("event"),a("projectsSelector")),k=a("widget/fieldsManager/gridView"),l=e.tmpl('  <div class="id-name-cell">    <p>      <% if (item.uuid && item.uInstanceId) { %>      <%- item.uInstanceId%>      <% } %>    </p>    <div>      <span class="text-overflow m-width" title="<%= item.alias%>"        <% if (item.canUpgradeToKvm || item.autoRenewFlag) { %> style="max-width: 70%;" <% } %>>        <%= item.alias %>      </span>    </div>  </div>',null),m=e.tmpl('  <div class="ip-cell">    <p>      <span class="text-overflow m-width" title="公网IP: <%= deviceWanIp %>">        <%= deviceWanIp %>        <% if (deviceWanIp && deviceWanIp!="-") { %>        <i class="net-type">(公)</i>        <% } %>      </span>      <i class="copy-icon" data-clipboard-text="<%=deviceWanIp%>" style="display:none; cursor:pointer;"        title="复制公网IP"></i>    </p>    <p>      <span class="text-overflow m-width" title="内网IP: <%= deviceLanIp %>">        <%= deviceLanIp %>        <% if (deviceLanIp && deviceLanIp!="-") { %>        <i class="net-type">(内)</i>        <% } %>      </span>      <i class="copy-icon" data-clipboard-text="<%=deviceLanIp%>" style="display:none; cursor:pointer;"        title="复制内网IP"></i>    </p>  </div>',null),n=e.tmpl('  <span class="text-overflow" title="<%- createdTimeStr %>">    <%- createdTimeStr %>  </span>',null),o=(a("search"),a("reporter"),a("qccomponent")),p=a("cvm/cvm/data"),q=a("cvm/cvm/format"),r=a("widget/errorTips/errorTips"),s=a("cvm/cvm/event/export/export"),t=a("cvm/cvm/event/operate_auth"),u=a("cvm/cvm/event/operate_entry"),v=u.getModuleArr(),w=u.getModuleMap(),x={main:'  <div>    <style type="text/css">      .cvm-oper-cell .disabled {        color: #999;        cursor: default;        text-decoration: none !important      }    </style>    <div class="manage-area">      <div class="manage-area-title with-bottom-border">        <h2>实例</h2>        <div id="projectsWrapper" class="tc-select-box"></div>        <div id="regionWrapper" class="tc-select-box"></div>      </div>      <div class="manage-area-main">        <!-- <div class="tc-15-tab tc-15-tab-alt trash-tab"> -->        <!-- <div class="tab-panel"> -->        <div class="manage-area-full-inner">          <div class="tc-15-msg with-margin">            <p>到期后仍未续费的实例，会在回收站中保留7天，这期间您可以续费进行恢复。7天后，这些实例会被彻底释放，不可恢复。</p>            <p>实例进入回收站后不会主动解除与负载均衡、弹性云盘、基础网络互通的挂载关系。</p>          </div>          <div id="operArea">            <div class="tc-15-action-panel">              <button class="tc-15-btn weak m download" title="导出" data-event="cvm_recycel_oper_action"></button>              <button type="button" class="tc-15-btn m disabled" data-name="RenewInstances" data-event="cvm_oper_action"                data-hot="yunzhuji.recyle.renew_more">批量恢复</button>              <button type="button" class="tc-15-btn m weak disabled" data-name="TerminateInstances"                data-event="cvm_oper_action">批量释放</button>              <button class="tc-15-btn weak m setting" data-event="set_Fields" title="设置列表显示字段"                data-hot="yunzhuji.setfields" data-grid-setting="true">              </button>              <div id="searchArea" class="pull-right"></div>            </div>          </div>          <div id="cvmList" style="position:relative"></div>        </div>        <!-- </div> -->        <!-- </div> -->      </div>    </div>  </div>',idName:'  <div class="id-name-cell">    <p>      <% if (item.uuid && item.uInstanceId) { %>      <%- item.uInstanceId%>      <% } %>    </p>    <div>      <span class="text-overflow m-width" title="<%= item.alias%>"        <% if (item.canUpgradeToKvm || item.autoRenewFlag) { %> style="max-width: 70%;" <% } %>>        <%= item.alias %>      </span>    </div>  </div>'},y=null,z=function(){y=null},A={title:"实例",pageClass:"",render:function(a,b){z(),y&&y.hottag("renderRecycleCvmData","beforeRender");var c=this;f.getRegionId()>0?"":f.setRegionId(1),nmc.render(e.tmpl(x.main,{}),"cvm"),this.projectsAreaEl=d("#projectsArea"),this.searchAreaEl=d("#searchArea"),this.projectsWrapperEl=d("#projectsWrapper"),this.regionWrapperEl=d("#regionWrapper"),this.cvmListEl=d("#cvmList"),this.projectsSelector=new j({renderTo:this.projectsWrapperEl,
selectedId:f.getProjectId(),change:function(){c.renderList()}}),p.getValidRegions().then(function(a){c.regionIds=a.regionIds;var b=f.getRegionId();a.regionMap[b]||(b=a.regionList[0].value,f.setRegionId(b)),c.regionId=b,c.regionPills=new i({renderTo:c.regionWrapperEl,data:a.regionList,newMode:!0,change:function(){var b=c.regionPills.val();a.regionMap[b]||(b=a.regionList[0].value,f.setRegionId(b)),f.setRegionId(b),c.regionId=b,c.renderList()}}),c.regionPills.val(c.regionId),c.renderRegionOverview(a.regionList)}),this.renderBtnGroup(),this.initGridView(),this.bindEvent(),this.renderList(b)},renderRegionOverview:function(a){var b=this;b.getInstanceStatistics(b.regionIds).then(function(a){var c=a&&a.response.instanceStatisticsSet||[];d(c).each(function(a,c){b.setRegionNum(c,"overview")})})},setRegionNum:function(a,b){a.regionId=h.getRegionNum(a.regionId||a.region);var c=this.regionPills&&this.regionPills.$el.find("button[data-value="+a.regionId+"]"),d=g.REGIONNAMES[a.regionId];("overview"!=b||0!=c.data("validflag"))&&c.html(d+"("+a.expiredInstanceCount+")")},getInstanceStatistics:function(a){var b=[];return a.forEach(function(a,c,d){var e=h.getRegion(a);e&&b.push(e)}),p.describeInstanceStatistics({filters:[{Name:"region",Values:b}],regionId:1},{camTips:!1})},resetTr:function(a){for(var b=d(a).attr("data-index"),c=this.gridView,e=0,f=c.list.length;f>e;e++)c.$refs.list[e].$set({$selected:!1});c.$refs.list[b].$set({$selected:!0})},getSelectItem:function(){var a=this,b=this.gridView.getSelected()||[];return d.each(b,function(b,c){var e=d(a.gridView.$el).find('[data-id="'+c.instanceId+'"]');c.el=e}),b},exec:function(a,b){var c=new w[a].module({listIns:this}),e=w[a].name;if(c){var b=d.extend(!0,[],this.getSelectItem());c.operateAuth=new t({whiteList:this.whiteList,dataItems:b,operAction:v,operActionModuleMap:u.getModuleArr(),listIns:this}),c.hasPermItems=b;var f=c.resolvePerm(b,a,e);c.permResult=f,c.selectedItems=f.hasPermItems,c.selectedShowOptions=f.selectedShowOptions,c.isRecycle=!0,c.exec&&c.exec()}},operatedCallback:function(){var a=this;setTimeout(function(){a.refresh.call(a)},1e3)},bindEvent:function(){var a=this;d("#operArea").on("click","[data-event=cvm_recycel_oper_action]",function(){var b=a.gridView.list;if(a.gridViewOptions=a.gridView,0!==b.length){var c=[].concat(a.gridViewOptions.$data.colums);c.splice(0,1,{name:"ID",key:"InstanceId",defaults:!0,hide:!1,required:!0,miniWidth:134},{name:"实例名",key:"InstanceName",defaults:!0,hide:!0,required:!0,miniWidth:134});var d=new s({selectedItems:b,columns:c,expired:!0,listIns:a});d.exec()}}),d("#operArea").on("click","[data-event][data-name]",function(b){if(!d(b.target).hasClass("disabled")){var c=a.gridView.getSelected(),e=d(this).data("name");c.length>0&&a.exec(e,d(this).closest("tr"))}}),d("#operArea").find("[data-event=set_Fields]").click(function(){a.gridView.showFieldsManager()})},checkOperAction:function(a){var b=this,c=b.gridView.getSelected();a=a||c||[];var e=new t({whiteList:this.whiteList,dataItems:a,operAction:u.getModuleArr(),operActionModuleMap:u.getModuleArr(),listIns:this}),f=u.getModuleMap();for(var g in f){var h=f[g],i=d("#operArea").find('[data-event=cvm_oper_action][data-name="'+g+'"]');if(i){var j=new h.module({listIns:this,button:i,selectedItem:[]});j.refresh&&j.refresh(a,g,e)}}},refreshItemOperAction:function(a){a=a||[];var b=this;a.forEach(function(a){var c=new t({whiteList:b.whiteList,dataItems:[a],operAction:u.getModuleArr(),operActionModuleMap:u.getModuleArr(),listIns:b}),e=u.getModuleMap();for(var f in e){var g=e[f],h=d("tr[data-uinstanceid="+a.instanceId+"]").find('[data-event=cvm_oper_action][data-name="'+f+'"]');if(h){var i=new g.module({listIns:b,button:h,selectedItem:[a]});i.refresh&&i.refresh([a],f,c)}}})},refreshBtnStatus:function(a,b){var c=this,e=new t({whiteList:c.whiteList,dataItems:b,operAction:u.getModuleArr(),operActionModuleMap:u.getModuleArr(),listIns:c}),f=u.getModuleMap();for(var g in f){var h=f[g],a=d("tr[data-uinstanceid="+item.instanceId+"]").find('[data-event=cvm_oper_action][data-name="'+g+'"]');if(a){var i=new h.module({listIns:c,button:a,selectedItem:[item]});i.refresh&&i.refresh([item],g,e)}}},initGridView:function(){var a=this,b={$data:{hasFirst:!0,orderField:"addTimeStamp",order:1,initGetData:!1,canResizeColum:!0,selectedHighlight:!1,colums:a.getColumns(),list:[],canSelectTotal:!1,autoMaxHeight:!0,maxHeightOffset:10,autoCheckWidth:!1,showState:!0,showPagination:!0,totalNum:0,trackKey:"uuid",searchItemName:"实例"},$mixins:[k("recycle_fields")],getCellContent:function(b,c,d){return a.getCellContent(b,c,d)},events:{"click tr [data-event=cvm_oper_action]":function(b){if(!d(b.target).hasClass("disabled"))if(a.resetTr(d(b.target).parents("tr")),b=d(b.target).closest("[data-name][data-event]"),b.hasClass("disabled"));else{var c=d(b).data("name");a.exec(c)}},"click tr :checkbox:eq(0)":function(b){setTimeout(function(){a.checkOperAction()},0)},"click tr[data-id] input[type=checkbox]":function(b){setTimeout(function(){a.checkOperAction()},0)}},getData:function(b,c){a.renderList(b)},setTrAttr:function(a,b){return{"data-id":b.instanceId,"data-uinstanceid":b.instanceId}}},c=o.getComponent("grid-view");a.gridView=new c(b),a.cvmListEl.append(a.gridView.$el),a.gridView.checkCellWidth()},renderBtnGroup:function(){var a=this,b=o.components["qc-search"],c=this.search=new b({$data:{keyword:"",searchEmpty:!0,multiple:!0,placeholder:"请输入IP(换行分隔)或实例名"},search:function(){a.renderList()}});this.searchAreaEl.html("").append(c.$el)},formatQueryInstanceParams:function(a){var b={},c=a.filters||[];c.push({name:"restrict-state",values:["EXPIRED"]}),-1!=a.pid&&c.push({name:"project-id",values:[a.pid]}),a.instanceId&&c.push({name:"instance-id",values:[a.instanceId]}),b={filters:c,offset:a.offset||0,limit:a.limit||20,regionId:a.regionId||f.getRegionId()};for(var d in a)["vagueIpAddress","vagueInstanceName"].indexOf(d)>-1&&(b[d]=a[d]);return["ips","subnetIds","vpcId"].forEach(function(c){if(a[c]){var d={ips:"ipAddresses",subnetIds:"innerSubnetIds"}[c];d?b[d]=a[c]:(d={vpcId:"innerVpcIds"}[c],d&&(b[d]=[a[c]]))}}),b},renderList:function(a){var b=this,c=this.search.getKeyword(),e=f.getCvmAnalyseValue(c)||{};a=d.extend({},{pid:f.getProjectId(),regionId:f.getRegionId()},a);var g=void 0===a.page?1:a.page;a.limit=a.count||20,a.offset=a.limit*(g-1),a.subnetIdList&&(a.subnetIds=a.subnetIdList),e.alias&&(a.vagueInstanceName=e.alias),e.vagueIp&&(a.vagueIpAddress=e.vagueIp),e.ipList&&e.ipList.length>0&&(a.ips=e.ipList);var h=b.formatQueryInstanceParams(a);b.queryInstanceParams=h,Promise.all([p.queryCvmList2(h,{}),p.getProjects(),p.getCvmWhiteList(),p.queryCVMActions({CloudProductList:[{ProductName:"cvm",ProductVersion:"2017-03-12"},{ProductName:"vpc",ProductVersion:"2017-03-12"}]})]).then(function(c){var d=c[0]&&c[0].response||{},e=d.instanceSet||[],f=c[1],h=b.whiteList=c[2],i=c[3]||{},j=[];if(e&&e.length)b.isPrepaidUser=h.PrepaidForCVM&&h.PrepaidForCVM.length>0,b.isBandwidthPackageUser=h.CVM_bandwidtd&&h.CVM_bandwidtd.length>0?!0:!1,b.isAsyncExport=h.ASYNC_EXPORT_CVM&&h.ASYNC_EXPORT_CVM.length>0,e.forEach(function(c){c.isBandwidthPackageUser=b.isBandwidthPackageUser,c.isPrepaidUser=b.isPrepaidUser,c.regionId=a.regionId,j.push(c.instanceId)}),e=q.get(e,{whiteList:h,projectData:f,regionId:a.regionId,cloudAPIActionNameMap:i}),b.gridView.setData({list:e,totalNum:d.totalCount,page:g,count:a.limit}),b.aliasIndex=0,b.isBandwidthPackageUser&&b.cvmListEl.find('[data-orderfield="bandwidthInfo"]').find(".text-overflow").text("带宽上限"),b.refreshItemOperAction(e),b.checkOperAction();else if(d.error&&d.error.length){b.gridView.setData({list:[]});for(var k=0;k<d.errors.length;k++){var l=d.errors[k];r.isCamRefused(l)?b.gridView.showTips("<div><cam-tips>"+l.message+"</cam-tips></div>"):b.gridView.showTips("<div><error-tips>"+l.message+"</error-tips></div>");break}}else b.gridView.setData({list:[],totalNum:0}),b.gridView.showTips('<span class="text">当前过滤条件下的回收站列表为空</span>');y&&y.hottag("renderRecycleCvmData","afterRender")})},refresh:function(){this.renderList()},getCellContent:function(a,b,c){switch(c.key){case"idName":return l({item:b});case"statusText":return e.tmpl('<p><span class="dev-status text-overflow <%-statusColorClass%>" <%if (statusDesc) {%> <%- statusDesc%><%}%>>\n            <%if (statusClass) {%><i class="<%- statusClass%>">\n            </i><%}%><span class="status-col<%if (statusColorClass == "text-danger") {%> text-danger-und<%}%>"><%- statusTitle%></span></span>\n            </p>\n            <% if (operationTitle) {%>\n            <p><span class="dev-status text-overflow <%-operationColorClass%>" <%if (operationDesc) {%> <%- operationDesc%><%}%>>\n            <%if (operationClass) {%><i class="<%- operationClass%>">\n              </i><%}%><span class="status-col<%if (operationColorClass == "text-danger") {%> text-danger-und<%}%>"><%- operationTitle%></span></span>\n            </p> <% } %>',b);case"ip":var d=b.deviceLanIp||"-",g=b.deviceWanIp||"-";return m({deviceLanIp:d,deviceWanIp:g});case"diskInfo":var i="";return b.dataDisks&&b.dataDisks.length>0?b.dataDisks.map(function(a){var b=a.diskTypeName+"("+a.diskSize+"G)";i+='<span class="text-overflow" title='+b+">"+b+"</span><br>"}):i="<span>-</span>",i;case"sysDiskInfo":if(b.systemDisk){var j=b.systemDisk.diskTypeName+"("+b.systemDisk.diskSize+"G)";return i='<span class="text-overflow" title='+j+">"+j+"</span><br>"}break;case"deadlineInfo":return'  <span class="text-overflow" title="{{item.isolatedTimeStr }}释放，逾期无法恢复">    {{> item.cvmPayModeTimeDesc }}  </span>';case"addTimeStamp":return n({createdTimeStr:b.createdTime&&f.formatDate(new Date(b.createdTime),"yyyy-MM-dd")||"-"});case"_operCol":return e.tmpl('  <div class="cvm-oper-cell" style="white-space:nowrap">    <% if (isSecondPayMode && isArrear) { %>    <a href="//console.cloud.tencent.com/expense/recharge" target="_blank">充值</a>    <% }else{%>    <a href="javascript:;" data-name="RenewInstances" data-event="cvm_oper_action">恢复</a>    <% } %>    <a href="javascript:;" data-name="CreateImage" data-event="cvm_oper_action">制作镜像</a>    <a href="javascript:;" data-name="TerminateInstances" data-event="cvm_oper_action">释放</a>  </div>',{isSecondPayMode:h.isSecondPayMode(b.instanceChargeType),isArrear:"ARREAR"===b.isolatedSource});default:return'<span class="text-overflow" title="'+a+'">'+(a||"")+"</span>"}},getColumns:function(){var a=[{key:"idName",name:"ID/实例名",width:"",minWidth:150,required:!0},{key:"statusText",name:"状态",width:100,required:!0},{key:"projectName",name:"所属项目",width:100,required:!0},{key:"netName",name:"所属网络",width:90,required:!0},{key:"ip",name:"IP地址",width:180,minWidth:180,required:!0},{key:"zoneName",name:"可用区",width:90,hide:!0},{key:"cvmPayModeDesc",name:"实例计费模式",width:150,minWidth:150,hide:!0},{key:"networkPayModeDesc",name:"网络计费模式",width:150,hide:!0},{key:"osName",name:"操作系统",width:160,hide:!0},{key:"cpuInfo",name:"CPU",width:60,hide:!0},{key:"memInfo",name:"内存",width:60,hide:!0},{key:"sysDiskInfo",name:"系统盘",width:150,hide:!0},{key:"diskInfo",name:"数据盘",width:150,hide:!0},{key:"bandwidthInfo",name:"公网带宽",width:70,hide:!0},{key:"unImgIdInfo",name:"镜像ID",width:80,hide:!0},{key:"addTimeStamp",name:"创建时间",width:100,hide:!0},{key:"deadlineInfo",name:"释放倒计时",width:140,required:!0,locked:!0,hide:!0},{key:"_operCol",name:"操作",required:!0,width:200,minWidth:200,locked:!0,hide:!0}];return a}};c.exports=A}),define("cvm/recycle/data_package",function(a,b,c){var d=a("cvm/common/constants"),e=a("appUtil"),f=a("manager"),g=a("cvm/cbs2/cbsutil"),h=null,i=function(a){var b=this,c=a.data;this.options=a;for(var d,f=0;d=c[f];f++)d.operateAuth=d.operateAuth||0,d.opsAvailable=e.getOperationTag(d.operateAuth,d.runflag),b.netNameInfo(d),b.addTimeStampInfo(d),b.statusDesc(d),b.cvmPayModeDesc(d),b.deadlineInfo(d),b.diskInfo(d),b.cpuInfo(d),b.memInfo(d),b.canUpgradeToKvm(d),b.projectName(d),b.bandwidthInfo(d),b.deviceImageIdInfo(d);return c};i.prototype={statusDesc:function(a){var b=a.statusDesc;a.$loading=!1,"故障"!==b&&"运行中"!==b&&"已退还"!==b&&"已关机"!==b&&"待回收"!==b&&"已关机"!==b&&(a.$loading=!0);var c="";c="运行中"===b||"已关机"===b?"succeed":"故障"===b?"warning":"待回收"===b?"error":"restart",a.statusText='<span class="text-overflow '+c+'">'+b,1==a.isSafeIsolated&&(a.statusText='<span class="text-overflow warning">'+b,a.statusText+='<i class="ico-warning" title="实例由于有安全风险外网已被隔离，请尽快处理安全风险，解除风险后提交工单给我们确认执行结果；&#10;具体安全风险：'+a.safeIsolatedInfo+'"></i>'),a.statusText+="</span>"},cvmPayModeDesc:function j(a){var j="包年包月";a.cvmPayMode===d.CVMPAYMODE.POSTPAID_BY_HOUR?j="按量计费":this.options.isPrepaidUser?a.cvmPayMode===d.CVMPAYMODE.SPOTPAID&&(j="按量计费-竞价"):j="后付费",a.cvmPayModeDesc=j},netNameInfo:function(a){return a.netName&&!a.netName__graphql_error?a.netName:a.vpc||a.vpc__graphql_error?void 0:a.netName="基础网络"},deadlineInfo:function(a){a.deadlineInfo=a.expiredTimeStr,a.deadline=e.formatDate(new Date(a.expiredTime),"yyyy-MM-dd hh:mm:ss")},canUpgradeToKvm:function k(a){var b=d.HYPERVISOR,c=100001,k=!1,e=this.options.isPrepaidUser;e&&b&&b.ENABLE&&a.opsAvailable.XENTOKVM&&(a.zoneId!=c||!a.cbsList.length)&&(k=!0,b.ENABLE_WINDOWS||"windows"!==a.osType?!b.ENABLE_CBS&&a.cbsList&&a.cbsList.length&&(k=!1):k=!1),a.canUpgradeToKvm=k},addTimeStampInfo:function(a){a.addTimeStamp=e.formatDate(new Date(a.createdTime),"yyyy-MM-dd hh:mm:ss")},diskInfo:function l(a){if(a.sysDisk?(a.sysDiskInfo=a.sysDisk.diskSize+"GB",a.sysDisk.diskType&&(a.sysDiskInfo+="("+g.getDiskTypeNameByDiskType(a.sysDisk.diskType)+")")):a.sysDiskInfo="-",a.dataDisk&&a.dataDisk.length){var l=[];a.dataDisk.forEach(function(a){l.push({size:a.diskSize+"GB",type:"("+g.getDiskTypeNameByDiskType(a.diskType)+")"})}),a.diskInfo=l}},cpuInfo:function(a){a.cpuInfo=!a.deviceClass||"v1.0.5"!=a.deviceClass.toLowerCase()&&"v1.1"!=a.deviceClass.toLowerCase()?a.cpu+"核":"共享核"},memInfo:function(a){a.memInfo=a.deviceClass&&"v1.0.5"==a.deviceClass.toLowerCase()?a.mem+"MB":a.mem+"GB"},projectName:function(a){var b="默认项目";h?a.projectName=h[a.projectId]||b:f.getProjects(function(c){var d=c.data;h={};for(var e,f=0;e=d[f];f++)h[e.projectId]=e.name;a.projectName=h[a.projectId]||b})},bandwidthInfo:function(a){a.bandwidthInfo=a.bandwidth+"Mbps",this.options.isBandwidthPackageUser&&65535==a.bandwidth&&(a.bandwidthInfo="无限制")},deviceImageIdInfo:function(a){a.deviceImageIdInfo=a.deviceImageId,a.unImgIdInfo=a.unImgId,0==a.deviceImageId&&(a.deviceImageIdInfo="-"),a.unImgId||(a.unImgIdInfo="-")}},c.exports=i}),define("cvm/recycle/eip/eip",function(a,b,c){var d=a("$"),e=a("pageManager"),f=a("manager"),g=(a("util"),a("qccomponent")),h=g.components["qc-search"];a("widget/region/regionSelector");var i=(a("event"),a("./eipList")),j=a("cvm/recycle/eips/export"),k={main:'  <div>    <div class="manage-area">      <div class="manage-area-title with-bottom-border">        <h2>弹性公网IP</h2>        <region-selector b-model="regionId"></region-selector>      </div>      <div class="manage-area-main">        <!-- <div class="tc-15-tab tc-15-tab-alt trash-tab"> -->        <!-- <div class="tab-panel"> -->        <div class="manage-area-full-inner">          <div class="tc-15-msg with-margin">            到期仍未续费的包月带宽模式弹性公网IP，会在回收站中保留7天，在这期间您可以续费进行恢复。7天后，这些IP会被彻底释放，不可恢复。          </div>          <div id="operArea">            <div class="tc-15-action-panel">              <button class="tc-15-btn weak m download" title="导出" data-event="eips_recycel_oper_action" b-on-click="download.bind(this)()"></button>              <button type="button" class="{{ \'tc-15-btn m\' + (selectedEip.length ? \'\' : \' disabled\') }}" data-oper="eip-oper" data-event="renew"                b-on-click="renew.bind(this)()">批量恢复</button>              <button type="button" class="{{ \'tc-15-btn m weak\' + (selectedEip.length ? \'\' : \' disabled\') }}" data-oper="eip-oper" data-event="release"                b-on-click="release.bind(this)()">批量释放</button>              <button class="tc-15-btn weak m setting" data-event="setFields" title="设置列表显示字段" data-grid-setting="true" b-on-click="showFieldsManager.bind(this)()"></button>              <div id="searchArea" class="pull-right"></div>              <qc-search placeholder="请输入弹性公网IP或名称搜索" search-empty="{{true}}" search="{{search.bind(this)}}"></qc-search>            </div>            <eip-list b-ref="eipList" on-selected-change="{{onSelectedChange.bind(this)}}" region-id="{{regionId}}" is-network-shift-up-user="{{isNetworkShiftUpUser}}"></eip-list>          </div>        </div>        <!-- </div> -->        <!-- </div> -->      </div>    </div>  </div>',operate:'  <div class="eip-oper-cell">    <a href="javascript:void(0)" data-event="renew">恢复</a>    <a href="javascript:void(0)" data-event="release" class="{{item.canRelease ? \'\':\'disable\'}}" data-title="{{item.canRelease ? \'\' : item.status.tip}}">释放</a>  </div>',idName:"  <div>    <div>      {{item.id}}    </div>    <div>      <span class=\"text-overflow m-width\">{{item.name||'未命名'}}</span>    </div>  </div>",counDown:'  <div>    <span class="text-overflow text-danger" data-title="{{item.deadlineDateDesc}}">{{item.time.countDownDesc || \'-\'}}</span>  </div>  </div>',bindId:'  <div>    <a href="{{item.bindResource.link}}" data-event="nav">{{item.bindResource.id || \'-\'}}</a>  </div>'},l={renew:a("cvm/recycle/eip/renew_eip"),release:a("cvm/recycle/eip/release_eip")},m=g.extend({$tpl:k.main,$afterInit:function(){var a=this;m.__super__.$afterInit.call(a),a.eipListBee=a.$refs.eipList,f.queryWhiteList({whiteKey:["network_shift_up"]},function(b){a.$set({isNetworkShiftUpUser:Boolean(b.network_shift_up&&b.network_shift_up.length)})})},onSelectedChange:function(a){this.$set("selectedEip",a)},renew:function(){this.selectedEip.length>0&&l.renew.exec(this.selectedEip)},release:function(){this.selectedEip.length>0&&l.release.exec(this.selectedEip)},download:function(){var a=this.eipListBee.list;if(a&&a.length){var b=new j({selectedItems:a});b["export"]()}},showFieldsManager:function(){this.eipListBee.showFieldsManager()},search:function(a){this.eipListBee.$set({page:1}),this.eipListBee.getData({searchkey:a})}},{defaults:{selectedEip:[],isNetworkShiftUpUser:!1}});m.tag("eip-list",i),m.tag("qc-search",h),c.exports={render:function(a,b){var c=this;c.pageBee=new m,c.listBee=c.pageBee.$refs.eipList,c.$appArea=e.appArea,d(c.pageBee.$el).appendTo(e.appArea.html(""))}}}),define("cvm/recycle/eip/eipList",function(a,b,c){function d(a){return[{name:"ID/名称",key:"id",required:!0,tdTpl:l.idName},{name:"IP地址",key:"ip"}].concat(a?[{name:"带宽",key:"bandwidthDesc"}]:[]).concat([{name:"绑定资源",key:"bindResource",tdTpl:l.bindId},{name:"释放到倒计时",key:"countDownDesc",tdTpl:l.counDown}]).concat(a?[{name:"操作",key:"operate",required:!0,tdTpl:l.operate}]:[])}function e(a){a=a||{};var b=a.page,c=a.count,d=(b-1)*c,e=[{name:"is-arrears",values:["TRUE"]}],g=f.getAnalyseValue(a.searchkey)||{};return g.name&&e.push({name:"address-name",values:[g.name]}),g.vagueIp&&e.push({name:"address-ip",values:[g.vagueIp]}),{page:b,count:c,limit:c,offset:d,filters:e,regionId:h.getRegionId()}}var f=a("cvm/eip2/data"),g={renew:a("cvm/recycle/eip/renew_eip"),release:a("cvm/recycle/eip/release_eip")},h=a("appUtil"),i=a("qccomponent"),j=i.getComponent("grid-view"),k=a("widget/fieldsManager/gridView"),l=(a("tips"),{operate:'  <div class="eip-oper-cell">    <a href="javascript:void(0)" data-event="renew">恢复</a>    <a href="javascript:void(0)" data-event="release" class="{{item.canRelease ? \'\':\'disable\'}}" data-title="{{item.canRelease ? \'\' : item.status.tip}}">释放</a>  </div>',idName:"  <div>    <div>      {{item.id}}    </div>    <div>      <span class=\"text-overflow m-width\">{{item.name||'未命名'}}</span>    </div>  </div>",counDown:'  <div>    <span class="text-overflow text-danger" data-title="{{item.deadlineDateDesc}}">{{item.time.countDownDesc || \'-\'}}</span>  </div>  </div>',bindId:'  <div>    <a href="{{item.bindResource.link}}" data-event="nav">{{item.bindResource.id || \'-\'}}</a>  </div>'}),m=j.extend({$mixins:[k("ip_fields")],setTrAttr:function(a,b){return{"data-id":b.id}},$afterInit:function(){var a=this;m.__super__.$afterInit.call(a),a.$watch("getSelected(list)",function(b){a.onSelectedChange(b)}),a.$watch("regionId",function(b){a.getData({page:a.page,count:a.count})}),a.$set("hasFirst",a.isNetworkShiftUpUser),a.setColums(d(a.isNetworkShiftUpUser)),a.$watch("isNetworkShiftUpUser",function(b){a.$set("hasFirst",b),a.setColums(d(b)),a.getData({page:a.page,count:a.count})})},events:{"click tr [data-event]":function(a){var b=$(a.target),c=b.closest("tr").data("index"),d=b.data("event");g[d].exec([this.list[c]])}},getData:function(a,b){var c=this,d=e({page:a.page>0?a.page:c.page,count:a.count>0?a.count:c.count,searchkey:a.searchkey||""});f.getEipList(d,{withoutDefaultFilter:!0}).then(function(a){if(a&&a.eips&&a.eips.nodes){var b=f.formatList(a.eips.nodes,{regionId:d.regionId,isNetworkShiftUpUser:c.$get("isNetworkShiftUpUser")}),e=a.eips.totalCount;c.setData({list:b,totalNum:e,page:d.page,count:d.count})}else{if(a.error&&a.error.length){c.setData({list:[]});for(var g=0;g<a.errors.length;g++){var h=a.errors[g];errorTips.isCamRefused(h)?c.showTips("<div><cam-tips>"+h.message+"</cam-tips></div>"):c.showTips("<div><error-tips>"+h.message+"</error-tips></div>");break}return}c.setData({list:[]})}})}},{defaults:{hasFirst:!0,order:1,initGetData:!0,canResizeColum:!0,selectedHighlight:!1,colums:d(!1),list:[],autoMaxHeight:!0,maxHeightOffset:10,autoCheckWidth:!1,totalNum:0,trackKey:"id"}});c.exports=m}),define("cvm/recycle/eips/export",function(a,b,c){function d(a){a.rk=[e.getUin(),(new Date).getTime(),Math.round(1e4*Math.random())].join("-");var b=e.objectToParams(a),c="//"+g+"/cgi/eip?action=exportEips&"+b;location.href=c}var e=a("util"),f=a("appUtil"),g=location.hostname.indexOf("cloud.tencent.com")>-1?"iaas.cloud.tencent.com":"iaas.qcloud.com",h=function(a){this.selectedItems=a.selectedItems};h.prototype["export"]=function(){for(var a,b=[],c=0;c<this.selectedItems.length;c++)a=this.selectedItems[c],b.push(a.addressId);var g={t:(new Date).getTime(),uin:e.getUin(),csrfCode:e.getACSRFToken(),projectId:f.getProjectId(),regionId:f.getRegionId(),addressIds:b,expired:!0};d(g)},c.exports=h}),define("cvm/recycle/eip/release_eip",function(a,b,c){var d=a("dialog"),e=a("util"),f=(a("appUtil"),a("cvm/eip2/data")),g=a("tips"),h={main:'  <div class="coin-alert">    <p class="tc-15-msg">弹性公网IP释放后不可找回，请谨慎操作！</p>    <div class="renewal-hints">      <p><strong>下列共<%=releaseNum%>个IP将进行释放操作</strong></p>    </div>    <div id="releaseList" style="position:relative;"></div>  </div>',idName:'  <div>    <div>      {{item.id}}    </div>    <div><span class="text-overflow m-width">{{item.name}}</span></div>  </div>',deadline:'  <div>    <span class="text-overflow text-danger">{{item.time.deadlineDesc}}</span>  </div>'};c.exports={exec:function(a){var b=this,c=e.tmpl(h.main,{releaseNum:a.length});d.create(c,580,"",{title:"释放弹性公网IP",button:{" 释放 ":function(){var b=[];a.forEach(function(a){b.push(a.id)}),f.returnEip({ids:b},{camTipsType:"dialog"}).then(function(a){d.hide(),g.success("释放中..."),eip_common.checkTask({taskId:a.response.taskId},"释放中")})}}}),b.renderList(a)},renderList:function(a){var b=this,c={$data:{showPagination:!1,showState:!1,canSelectTotal:!1,selectedHighlight:!1,canResizeColum:!0,hasFirst:!1,maxHeight:150,minHeight:"auto",colums:[{key:"id",name:"ID/名称",minWidth:200,tdTpl:h.idName},{key:"ip",name:"IP地址",minWidth:200},{key:"deadlineDateDesc",name:"到期时间",width:150,tdTpl:h.deadline}],autoMaxHeight:!1,maxHeightOffset:10},getCellContent:function(a,b,c){},events:{},getData:function(a){}},d=Bee.getComponent("grid-view");b.gridView=new d(c),$("#releaseList").append(b.gridView.$el),b.gridView.setData({list:a})}}}),define("cvm/recycle/eip/renew_eip",function(a,b,c){var d=a("$"),e=a("manager"),f=a("dialog"),g=a("util"),h=a("appUtil"),i=(a("cvm/cvm/cvmutil"),a("widget/range/range"),a("widget/pills/pills")),j=a("constants"),k=a("qccomponent"),l=a("cvm/eip2/data"),m={main:'  <div>    <div class="tc-15-msg"> 您需要通过续费来恢复公网IP，恢复后将保持原配置。      <br> 续费恢复后，与IP绑定的资源：负载均衡、实例、弹性网卡将不恢复，需要您重新配置      <br> 支付成功后，以下IP将恢复到左侧【弹性公网IP】栏目    </div>    <div class="renewal-wrap" style="margin-top: 20px;">      <ul class="form-list renewal-form">        <li>          <div class="form-label">            <span class="label">购买时长</span>          </div>          <div class="form-input">            <span class="renewals"></span>          </div>        </li>      </ul>    </div>    <div class="renewal-hints">      <p><strong>下列共{{renewNum}}个IP将进行续费操作</strong></p>    </div>    <div id="renewList" style="position:relative;"></div>    <div class="justify-grid">      <div class="col" style="">        <label class="form-ctrl-label"></label>      </div>      <div class="col">        <div class="total-price-wrap">          <span class="total-price-label">总计费用</span>          <span class="state-caculating" id="ctips">正在计算价格...</span>          <span class="cost" style="display:none;">¥<strong id="realcost"></strong></span>        </div>      </div>    </div>    <p>      <label class="orm-ctrl-label-stacked"><input type="checkbox" b-model="autoRenew" class="mr-5" />账户余额足够时，实例到期后按月自动续费</label>    </p>  </div>',idName:'  <div>    <div>      {{item.id}}    </div>    <div><span class="text-overflow m-width">{{item.name||"未命名"}}</span></div>  </div>',deadline:'  <span class="text-overflow m-width">{{item.time.deadlineDesc}}</span>'};c.exports={exec:function(a){var b=this;b.ipItems=a;var c=new k({$tpl:m.main,$data:{renewNum:a.length,autoRenew:!0}});f.create(c.$el,"800","",{title:"恢复公网IP",preventResubmit:!0,button:{" 确定 ":function(){l.toPay2(b.collectData(c.autoRenew))}}}),this.wrapper=f.el.find(".renewal-wrap"),this.renewals=this.wrapper.find(".renewals"),b.timePills=new i({renderTo:b.renewals,data:l.timeData,newMode:!0,change:function(){b.refreshList()}}),b.renderList()},renderList:function(){var a=this,b={$data:{showPagination:!1,showState:!1,canSelectTotal:!1,selectedHighlight:!1,canResizeColum:!1,hasFirst:!1,maxHeight:150,minHeight:"auto",colums:[{key:"id",name:"ID/名称",minWidth:200,tdTpl:m.idName},{key:"ip",name:"IP地址",minWidth:200},{key:"deadlineDateDesc",name:"到期时间",width:150,tdTpl:m.deadline},{key:"nextLine",name:"续费后到期时间",width:200,minWidth:150}],autoMaxHeight:!1,maxHeightOffset:10},getCellContent:function(b,c,d){return"nextLine"==d.key?'<div class="text-warning">'+e.getNextDate(c.deadlineDate,parseInt(a.timePills.val()))+"</div>":void 0},events:{},getData:function(a){}},c=k.getComponent("grid-view");a.gridView=new c(b),d("#renewList").append(a.gridView.$el),a.refreshList()},refreshList:function(){var a=this;a.gridView.setData({list:a.ipItems}),a.setPrice()},setPrice:function(){var a=this,b=a.ipItems,c=a.timePills.val(),e=b.map(function(a){return a.id});l.queryRenewEipPrice({ids:e,time:c,regionId:b[0].regionId},{camTipsType:"dialog"}).then(function(a){var b=a.response.price,c=b.addressPrice&&+b.addressPrice.originalPrice||0,e=b.addressPrice&&+b.addressPrice.discountPrice||0,f=Math.min(c,e);d("#ctips").hide(),d("#realcost").text(f).parent().show()})},collectData:function(a){var b=this,c=[],d=b.timePills.val();return b.ipItems.forEach(function(b){var e={type:"ip_with_network",goodsNum:1,regionId:+b.regionId||h.getRegionId(),payMode:1,uin:g.getUin(),ownerUin:g.getOwnerUin(),appId:h.getAppId(),goodsCategoryId:100213,goodsDetail:{pid:11392,curDeadline:b.time.deadline,currentDeadline:b.time.deadline,timeSpan:d,timeUnit:"m",bandwidth:b.bandwidth,resourceId:b.id,autoRenewFlag:a?1:2,productInfo:[{name:"地域",value:j.REGIONNAMES[b.regionId]},{name:"弹性公网Id",value:b.id},{name:"带宽上限",value:b.bandwidth+" Mbps"},{name:"续费时长",value:d+"个月"}]}};c.push(e)}),c}}}),define("modules/cvm/recycle/recycle",function(a,b,c){var d=(a("$"),a("router")),e=a("cvm/common/components/SmartHelper"),f={cvm:a("cvm/recycle/cvm/cvm"),cdh:a("cvm/recycle/cdh/cdh"),cbs:a("cvm/recycle/cbs/cbs")},g={render:function(a,b){var c=arguments.length;return 1==c&&a instanceof Object&&(b=a,a=""),a?(e.show(),void f[a].render(a,arguments[3])):void d.navigate("/cvm/recycle/cvm")},destroy:function(){e.destroy()}};c.exports=g}),define("cvm/recycle/renew_cbs",function(a,b,c){function d(a,b){return b-=0,a?j.getNextDate(a,parseInt(b)):""}function e(a){var b=r.diskIds.length;for(r.prepaids=[];b>0;)r.prepaids.push({period:a}),b--;var c=r.items[0].regionId;l.queryRenewDiskPrice({regionId:c,diskIds:r.diskIds,diskChargePrepaids:r.prepaids}).then(function(a){var b=a&&a.response||{},c=b&&b.diskPrice&&b.diskPrice,d={originPrice:c.originalPrice&&c.originalPrice.toFixed(2),discountPrice:c.discountPrice&&c.discountPrice.toFixed(2)},e=k.el.find('[data-field="cost"]'),f=k.el.find("[data-discount]");e.html(d.discountPrice),d.originPrice&&d.originPrice!==d.discountPrice?(k.el.find('[data-field="origin-cost"]').html(d.originPrice+" 元 "),k.el.find("[data-field=pricetitle]").text("优惠价:"),f.show()):f.hide()})}function f(){var a={$data:{showPagination:!1,showState:!1,canSelectTotal:!1,selectedHighlight:!1,hasFirst:!1,maxHeight:150,minHeight:"auto",colums:[{key:"alias",name:"待续费项",minWidth:200,tdTpl:'<div><div><p class="text-overflow">云硬盘：{{item.diskId}}</p></div></div>'},{key:"deadline",name:"到期时间",width:150},{key:"nextLine",name:"续费后到期时间",width:200,minWidth:150}],autoMaxHeight:!1,maxHeightOffset:10},getCellContent:function(a,b,c){return"deadline"==c.key?"<div>"+m.formatDate(new Date(b.deadlineTime.replace(/\-/g,"/")),"yyyy-MM-dd")+"</div>":"nextLine"==c.key?'<div class="text-warning">'+b.nextDeadline+"</div>":void 0},events:{},getData:function(a){}},b=Bee.getComponent("grid-view");r.gridView=new b(a),h("#renewList").append(r.gridView.$el)}function g(a){var b=a||i.DEFAULT_PERIOD;r.items.forEach(function(a){a.nextDeadline=d(a.deadlineTime,b)}),r.gridView.setData({list:r.items}),e(b)}var h=a("$"),i=(a("router"),a("pageManager"),a("cvm/common/constants")),j=(a("reporter"),a("manager")),k=a("dialog"),l=(a("lengthlimiter"),a("cvm/cbs2/data")),m=a("appUtil"),n=(a("widget/range/range"),a("util")),o=(a("tips"),a("modules/cvm/cbs/cbsutil"),a("cvm/common/components/TimePill/timePill")),p=a("cvm/common/common"),q={renew:'  <div class="renewal-wrap" style="margin-top: 20px;">    <ul class="form-list">      <li>        <div class="form-label">          <label for="">续费时长</label>        </div>        <div class="form-input">          <div class="timetype"></div>        </div>      </li>    </ul>    <div class="renewal-hints">      <p>        <strong>下列设备（共          <%=len%>项）将进行续费操作</strong>      </p>    </div>    <div id="renewList" style="position:relative;"></div>    <div class="justify-grid">      <div class="col">        <label class="form-ctrl-label"></label>      </div>      <div class="col">        <div class="total-price-wrap">          <span class="total-price-label" data-field="pricetitle">总计费用</span>          <span class="state-caculating" id="ctips" style="display:none;">正在计算价格...</span>          <span class="cost">            <span class="price"><span data-field="cost"></span><em>元</em></span>            <span data-discount style="display: none">              <span data-field="origin-cost" class="original-cost"></span>            </span>          </span>        </div>      </div>    </div>  </div>'},r={},s=function(a,b){r.items=a,r.diskIds=r.items.map(function(a){return a.diskId});var c=a[0].regionId;k.create(n.tmpl(q.renew,b),720,"",{title:"恢复云硬盘",preventResubmit:!1,button:{" 确定 ":function(){var a=r.timeTypePills.val();l.getRenewDiskOrderParams({regionId:c,diskIds:r.diskIds,diskChargePrepaids:r.diskIds.map(function(b){return{period:a}})}).then(function(a){a.response&&a.response.diskOrder&&l.toPay2(a.response.diskOrder),k.hide()}),b&&b.callback&&b.callback()}}}),f();var d=p.showDiscountIcon(r.items[0].regionId);r.timeTypePills=new o({renderTo:k.el.find(".timetype"),showDiscountIcon:d,defaultTriggerChange:!1,showOtherTime:!0,change:function(a){g(a)}}),g()};c.exports={init:function(a,b){r={},s(a,b)}}}),define("cvm/recycle/renew_cvm",function(a,b,c){var d=a("$"),e=a("manager"),f=a("cvm/cvm/event/renew/renew_base"),g=a("dialog"),h=a("util"),i=a("appUtil"),j=a("widget/range/range"),k=a("cvm/common/constants"),l=a("qccomponent"),m=a("cvm/cvm/cvmutil"),n=a("cvm/common/components/BandwidthRangePopover"),o=a("cvm/common/components/TimePill/timePill"),p=a("cvm/common/common"),q={
main:'    <div class="tc-15-msg">       <p>您需要通过续费来恢复实例，恢复后将保持原配置。</p>       <p>续费恢复后，与实例关联的负载均衡、弹性云盘、基础网络互通将不恢复，需要您重新配置。</p>       <p>支付成功后，以上设备将恢复到左侧【实例】栏目</p>       <p>显示的时长折扣只代表当前所有实例里的最高折扣。</p>    </div>  </p>  <div class="renewal-wrap" style="margin-top: 20px;">    <% if(!cdhOnly){ %>    <ul class="form-list renewal-form">      <li>        <div class="form-label">          <span class="label">购买时长</span>        </div>        <div class="form-input">          <span class="renewals">          </span>          <p id="payCbsDiff" style="display: none;">              <label class="form-ctrl-label"><input type="checkbox" checked class="tc-15-checkbox">同时续费实例挂载的云硬盘<i class="plaint-icon" data-title="为避免预付费（包年包月）的实例与云硬盘到期时间不一致，导致欠费隔离时影响实例运行，建议您启用实例关联云硬盘的关联续费功能，将自动为您对齐实例与云硬盘的到期时间。"></i></label>          </p>          <p id="payCbsDiffWarn" class="text-weak text-danger" style="display: none;">当实例与云硬盘的到期回收时间不一致时，云硬盘欠费时会被隔离，中断业务。</p>        </div>      </li>    </ul>    <% if (canUpgradeBandwidth) { %>    <ul class="form-list renewal-form">      <li>        <div class="form-label">          <span class="label">调整带宽</span>        </div>        <div class="form-input rerange-ctrl">          <a href="javascript:;" class=\'label set-bandwidth\'>调整带宽</a>        </div>        <div class="form-input rerange-wrapper" style="display:none">          <div class="rerange-inner-wrapper"></div>        </div>        <p class="tip"></p>      </li>    </ul>    <% } %>    <% } %>    <div class="renewal-hints">      <p><strong>下列设备（共<%=len%>项）将进行续费操作</strong></p>    </div>    <div id="renewList" style="position:relative;"></div>    <!-- 总价 -->    <% if(!cdhOnly){ %>    <div class="justify-grid">      <div class="col" style="">        <label class="form-ctrl-label"></label>      </div>      <div class="col">        <div class="total-price-wrap">          <span class="total-price-label" data-field="pricetitle">总计费用</span>          <span class="state-caculating" id="ctips" style="display:none;">正在计算价格...</span>          <span class="cost">            <span class="price"><span data-field="cost"></span><em>元</em></span>            <span data-discount style="display: none">              <span data-field="origin-cost" class="original-cost"></span>            </span>          </span>        </div>      </div>    </div>    <% } %>  </div>',act99:'  <li id="actLink99" style="display:none">    <span style="color:red;">参加9.9店庆抽奖，赢取iPad mini，</span>    <a href="http://www.qcloud.com/anniversary/5th/index.php?from=cvm_renewal" target="_blank" title="前往抽奖">立即参与</a>  </li>',act15:'  <li id="actLink99" style="display:none">    <a style="color:red;" href="http://www.qcloud.com/anniversary/5th/index.php?from=cvm_renewal" target="_blank">      9.9店庆, 全民狂欢, 续费半年以上即享85折    </a>  </li>'},r=function(a){f.call(this,a)},s=function(){};s.prototype=f.prototype,r.prototype=new s,r.prototype.constructor=r,r.prototype.superclass=f,r.prototype.exec=function(){var a=this;a.cdhOnly=!0,a.canUpgradeBandwidth=!a.listIns.isBandwidthPackageUser,a.hasPermItems.forEach(function(b){b.uHostId||(a.cdhOnly=!1),m.isBandwidthPrepaidPayMode(b.internetAccessible.internetChargeType)||(a.canUpgradeBandwidth=!1)});var b=h.tmpl(q.main,{cdhOnly:a.cdhOnly,canUpgradeBandwidth:a.canUpgradeBandwidth,bandwidth:a.hasPermItems[0].bandwidth,len:this.hasPermItems.length});if(g.create(b,"800","",{title:"恢复实例",preventResubmit:!0,button:{" 确定 ":function(){if(a.cdhOnly){var b=[];a.hasPermItems.forEach(function(a){a.uHostId&&b.push(a.uuid)}),b.length>0&&null!==a.diskOrderParams&&e.restoreCdhCvm({regionId:i.getRegionId(),uuidList:b},function(b){a.diskOrderParams.length&&a.toRenew(a.diskOrderParams)})}else{var c=function(){null!==a.orderParams&&a.toRenew(a.orderParams)};g.create("在您完成支付后，可以在控制台导航栏目【实例】列表找到恢复的CVM。",402,"",{title:" 恢复实例",defaultCancelBtn:!1,preventResubmit:!0,button:{"我知道了，去支付":c}})}}}}),this.wrapper=g.el.find(".renewal-wrap"),this.renewals=this.wrapper.find(".renewals"),this.cbsDiff=g.el.find("#payCbsDiff"),this.renderDeviceList(),this.bindEvt(),this.cbsDiff.find("input").click(function(){a.setPrice()}),!this.cdhOnly){var c=p.showDiscountIcon(this.hasPermItems[0].regionId),d=(this.hasPermItems||[]).map(function(a){return a.instanceFamily});this.timePills=new o({renderTo:this.renewals,showDiscountIcon:c,defaultTriggerChange:!1,showOtherTime:!0,change:function(b){a.refreshDevice(b)},discountHandler:function(b,c){return c.call(this,{list:b,regionId:a.hasPermItems[0].regionId,instanceFamilies:d})}}),this.refreshDevice()}},r.prototype.renderDeviceList=function(){var a={$data:{showPagination:!1,showState:!1,canSelectTotal:!1,hasFirst:!1,maxHeight:150,minHeight:"auto",colums:[{key:"alias",name:"待续费项",minWidth:200,tdTpl:'<div><div><p class="text-overflow">实例：{{item.alias}}</p><p class="text-overflow text-weak">所属网络：{{item.netName}}，内网IP：{{item.deviceLanIp}}</p></div></div>'},{key:"deadline",name:"到期时间",width:150},{key:"nextLine",name:"续费后到期时间",width:200,minWidth:150}],autoMaxHeight:!1,maxHeightOffset:10},getCellContent:function(a,b,c){return"deadline"==c.key?b.uHostId?"<div>不计费</div>":"<div>"+i.formatDate(new Date(b.deadline.replace(/\-/g,"/")),"yyyy-MM-dd")+"</div>":"nextLine"==c.key?b.uHostId?"<div>不计费</div>":'<div class="text-warning">'+b.nextDeadline+"</div>":void 0},events:{},getData:function(a){}},b=l.getComponent("grid-view");this.gridView=new b(a),d("#renewList").append(this.gridView.$el)},r.prototype.refreshDevice=function(a){var b=this,c=a||k.DEFAULT_PERIOD;this.hasPermItems.forEach(function(a){a.nextDeadline=b.getExpires(a.expiredTime,c)}),this.gridView.setData({list:this.hasPermItems}),this.cdhOnly||this.setPrice(),g&&g.center()},r.prototype.bindEvt=function(){var a=this;if(this.canUpgradeBandwidth){var b=a.wrapper.find(".rerange-ctrl"),c=b.find(".set-bandwidth");c.on("click",function(){var c=a.wrapper.find(".rerange-wrapper"),d=c.find(".rerange-inner-wrapper");a.bandWidthRange=new j({renderTo:d,value:a.hasPermItems[0].bandwidth,min:0,max:200,unit:"Mbps",section:[{value:20,width:75},{value:50,width:150},{value:100,width:225},{value:200,width:300}],step:1,change:function(b){0==b&&n.show({range:a.bandWidthRange}),a.setPrice()}}),b.hide(),c.show()})}else this.bandWidthRange=null},r.prototype.setPrice=function(){this.orderParams=null,this.diskOrderParams=null;var a=this;this.queryPrice(function(b){var c=a.cbsDiff.find("input").is(":checked");b.needAlign?(a.cbsDiff.show(),c?g.el.find("#payCbsDiffWarn").hide():g.el.find("#payCbsDiffWarn").show()):(a.cbsDiff.hide(),g.el.find("#payCbsDiffWarn").hide()),d("#ctips").hide();var e=b,f=g.el.find('[data-field="cost"]'),h=g.el.find("[data-discount]");f.html(e.discountPrice),e.originPrice&&e.originPrice!==e.discountPrice?(g.el.find('[data-field="origin-cost"]').html(e.originPrice+" 元 "),g.el.find("[data-field=pricetitle]").text("优惠价:"),h.show()):h.hide(),a.orderParams=b.orderParams,a.diskOrderParams=b.diskOrderParams,g.toggleBtnDisable(!1)})},c.exports=r}),define("cvm/snapshot2/autoPolicy/autoSnapshotPolicyDetail",function(a,b,c){var d=a("$"),e=a("util"),f=a("pageManager"),g=(a("dataManager"),a("appUtil")),h=a("qccomponent"),i=h.getComponent("grid-view"),j=a("cvm/cbs2/data"),k=a("cvm/common/common"),l=a("cvm/cbs2/constants"),m=a("cvm/snapshot2/util"),n=a("cvm/snapshot2/data"),o={modify:a("cvm/snapshot2/autoPolicy/event/modify/modify"),"switch":a("cvm/snapshot2/autoPolicy/event/switch/switch"),bindDisk:a("cvm/snapshot2/autoPolicy/event/bindDisk/bindDisk"),unbindDisk:a("cvm/snapshot2/autoPolicy/event/unbindDisk/unbindDisk")},p={id:'  <p>    <a href="/cvm/cbs/detail?diskId={{item.diskId}}&regiondId={{item.regionId}}" data-event="nav">{{item.diskId}}</a>  </p>  <p>    <span class="text-overflow m-width" title="{{item.diskName}}">{{item.diskName || \'未命名\'}}</span>  </p>',main:'  <div class="manage-area">    <div class="manage-area-title secondary-title">      <a href="/cvm/snapshot/asp{{urlParams}}" data-event="nav" class="back-link">        <i class="btn-back-icon"></i>定期快照策略</a>      <span class="line-icon">|</span>      <h2>{{item.aspId}}        <span b-if="item">(          <span class="ellipsis cvm-entry-name">{{item.aspName}}</span>)</span>详情</h2>    </div>    <div class="manage-area-main secondary-main">      <div class="manage-area-full-inner">        <div class="terminal-snapshot-box">          <!-- <div class="tc-15-tab tc-15-tab-alt"> -->          <div class="tc-panel">            <!-- <div class="manage-area-full-inner"> -->            <div class="param-box">              <div class="param-hd">                <h3>基本信息</h3>              </div>              <div class="param-bd">                <ul class="item-descr-list">                  <li>                    <span class="item-descr-tit">名称</span>                    <span class="item-descr-txt">{{item.aspName}}</span>                  </li>                  <li>                    <span class="item-descr-tit">ID</span>                    <span class="item-descr-txt">{{item.aspId}}</span>                  </li>                  <li>                    <span class="item-descr-tit">地域</span>                    <span class="item-descr-txt">{{item.regionName}}</span>                  </li>                  <li>                    <span class="item-descr-tit">策略详情</span>                    <span class="item-descr-txt" b-if="item">{{item.policyDesc}}                      <a class="link-edit" href="javascript:;" b-on-click="modify([item])">                        <i class="pencil-icon"></i> 修改</a>                    </span>                  </li>                  <li>                    <span class="item-descr-tit">定期快照</span>                    <span b-if="item">                      <label class="tc-15-switch" b-attr="{ title: item.isActivated ? \'停用定期快照\' : \'开启定期快照\' }">                        <input type="checkbox" class="tc-15-switch-input" checked?="item.isActivated" disabled?="switchToggling" b-on-click="switch([item])">                        <span class="tc-15-switch-helper">开启</span>                      </label>                    </span>                  </li>                  <li>                    <span class="item-descr-tit">创建时间</span>                    <span class="item-descr-txt">{{item.createTime}}</span>                  </li>                </ul>              </div>            </div>            <!-- </div> -->          </div>          <div class="tc-panel">            <div class="tc-panel-hd">              <div class="col">                <h3 class="title">                  定期创建快照的云硬盘                </h3>              </div>            </div>            <!-- <p class="til-text" style="margin-bottom: 20px;">定期创建快照的云硬盘</p> -->            <div class="tc-panel-bd">              <div class="tc-action-grid">                <div class="justify-grid">                  <div class="col">                    <button class="tc-15-btn m" b-ref="bindDisk" b-on-click="bindDisk([item])">关联云硬盘</button>                    <button class="tc-15-btn m weak disabled" b-ref="unbindDisk" b-on-click="unbindDisk([])">移出</button>                  </div>                </div>              </div>              <cbs-gridview b-ref="grid"></cbs-gridview>            </div>          </div>          <!-- </div> -->        </div>      </div>    </div>  </div>',cvm:'  <p b-if="!item.instanceId">-</p>  <div b-if="item.instanceId">    <p>      <a href="/cvm/detail/{{item.regionId}}/{{item.instanceId}}" data-event="nav">{{item.instanceId}}</a>    </p>    <p b-if="item.instanceName">      <span class="text-overflow m-width" title="{{item.instanceName}}">{{item.instanceName}}</span>    </p>  </div>',actions:'  <span style="white-space:nowrap">    <a href="javascript:;" b-on-click="unbindDisk([item])">移出</a>  </span>'},q=h.extend({$tpl:p.main,modify:function(a){r.exec("modify",a)},"switch":function(a){var b=this;return b.$set({switchToggling:!0}),r.exec("switch",a,null,function(){b.$set({switchToggling:!1})}),!1},bindDisk:function(a){r.exec("bindDisk",a)},unbindDisk:function(a){a&&a.length||(a=r.diskGrid.getSelected()),a.length&&r.exec("unbindDisk",[r.aspItem],{diskList:a,callback:function(){r.renderAspInfo()}})}});q.tag("cbs-gridview",i.extend({getData:function(a){r.renderGrid()},unbindDisk:function(a){r.exec("unbindDisk",[r.aspItem],{diskList:a,callback:function(){r.renderAspInfo()}})},events:{"change input[type=checkbox]":function(){r.toggleCheckbox()}}},{defaults:{canResizeColum:!1,colums:[{name:"ID/名称",key:"cbsId",required:!0,tdTpl:p.id},{name:"硬盘总容量",key:"diskSizeDesc",required:!0},{name:"硬盘类型",key:"diskTypeDesc",required:!0},{name:"硬盘属性",key:"diskUsageDesc",required:!0},{name:"关联实例",key:"instance",required:!0,tdTpl:p.cvm},{name:"操作",key:"actions",required:!0,tdTpl:p.actions}],emptyTips:"当前过滤条件下没有相应的云硬盘",searchItemName:"云硬盘",initGetData:!1,hasFirst:!0}}));var r={init:function(a,b,c){this.detailBee=new q({urlParams:c?"?"+e.objectToParams(c):""}),c?(this.queryobj=c,this.queryobj.regionId=c.regionId||c.rid||g.getRegionId()):this.queryobj={regionId:g.getRegionId()},this.regionId=this.queryobj.regionId,this.aspId=this.queryobj.aspId=b,this.diskGrid=this.detailBee.$refs.grid,f.appArea.html(this.detailBee.$el),this.renderAspInfo(),this.bindEvents()},bindEvents:function(){},toggleCheckbox:function(){var a=this.diskGrid.selectedNum;return a?void d(this.detailBee.$refs.unbindDisk).removeClass("disabled"):void d(this.detailBee.$refs.unbindDisk).addClass("disabled")},getRegionId:function(){var a=this.queryobj&&this.queryobj.rid?this.queryobj.rid:g.getRegionId();return a},renderGrid:function(){var a=this.detailBee.$get("item"),b=a.diskIdSet;this.renderDiskList(b)},renderDiskList:function(a){var b=this;if(!a||!a.length){var c={list:[],totalNum:0};return void b.diskGrid.setData(c)}this.getyDiskList(a,function(a){var c={list:a.datalist,totalNum:a.total};b.diskGrid.setData(c)})},getAspQueryParam:function(a){a=a||{};var b={},c=a.regionId||a.rid||g.getRegionId();return b.limit=1,b.offset=0,b.filters=[{name:"auto-snapshot-policy-state",values:["NORMAL"]},{name:"auto-snapshot-policy-id",values:[a.aspId]}],{data:b,regionId:c}},renderAspInfo:function(){var a=this,b=a.getAspQueryParam(this.queryobj);n.queryAutoSnapshotPolicies({data:b.data,regionId:b.regionId}).then(function(c){if(c.response&&c.response.autoSnapshotPolicySet&&1==c.response.autoSnapshotPolicySet.length){var d=n.formatAspList(c.response.autoSnapshotPolicySet,{regionId:b.regionId});a.aspItem=d[0],a.detailBee.$set({item:a.aspItem}),a.renderDiskList(a.aspItem.diskIdSet)}else a.renderDetailNoData()})},getyDiskList:function(a){var b=this;this.diskGrid.page=this.diskGrid.page||1,this.diskGrid.count=this.diskGrid.count||20,j.queryDisks({regionId:b.regionId,diskIds:a,offset:(this.diskGrid.page-1)*this.diskGrid.count,limit:this.diskGrid.count}).then(function(a){if(a.response&&a.response.diskSet){var c=a.response.diskSet,d=a.response.totalCount,e=[];c.forEach(function(a){a.instanceId&&e.push(a.instanceId)}),b.getInstances(e).then(function(a){c=b.formatDiskList(c,a),b.diskGrid.setData({list:c,totalNum:d})})}else if(b.diskGrid.setData({list:[],totalNum:0}),a.errors&&a.errors.length)for(var f=0;f<a.errors.length;f++){var g=a.errors[f];m.showGridTips(g,b.diskGrid);break}},function(a){b.diskGrid.setData({list:[]}),m.showGridTips(a,b.diskGrid)})},getInstances:function(a){var b=this;return new Promise(function(c,d){n.queryInstances({instanceIds:a,regionId:b.regionId,limit:a.length,offset:0}).then(function(a){c(a.response.instanceSet)})},function(a){resolve([])})},formatDiskList:function(a,b){var c=this,d={};return b.forEach(function(a){d[a.instanceId]=a}),a.forEach(function(a){a.regionId=c.regionId,a.instanceName=d[a.instanceId]?d[a.instanceId].instanceName:null,a.diskTypeDesc=l.DISKTYPE[a.diskType],a.diskUsageDesc=l.DISK_USAGE_MAP[a.diskUsage],a.diskSizeDesc=a.diskSize+"GB"}),a},exec:function(a,b,c,e){var f=this;c=d.extend({regionId:f.regionId,callback:function(){f.renderAspInfo(),e&&e()}},c),o[a]&&o[a].exec(b,c)},renderDetailNoData:function(){k.renderDetailNoData("快照策略","/cvm/snapshot/asp")},destroy:function(){}};c.exports=r}),define("cvm/snapshot2/autoPolicy/autoSnapshotPolicyList",function(a,b,c){var d=a("$"),e=(a("pageManager"),a("router")),f=(a("util"),a("appUtil")),g=(a("tips"),a("qccomponent")),h=g.getComponent("grid-view"),i=a("widget/projects/projectSelector"),j=a("cvm/common/components/regionPills"),k=(a("cvm/cvm/data"),a("widget/fieldsManager/gridView")),l=(a("widget/grid/Action"),a("cvm/snapshot2/util")),m=a("cvm/snapshot2/data"),n=a("cvm/snapshot2/constants"),o=a("cvm/common/common"),p=a("cvm/cbs2/data"),q={create:a("cvm/snapshot2/autoPolicy/event/create/create"),"delete":a("cvm/snapshot2/autoPolicy/event/delete/delete"),modify:a("cvm/snapshot2/autoPolicy/event/modify/modify"),"switch":a("cvm/snapshot2/autoPolicy/event/switch/switch"),exports:a("cvm/snapshot2/autoPolicy/event/exports/exports"),bindDisk:a("cvm/snapshot2/autoPolicy/event/bindDisk/bindDisk"),unbindDisk:a("cvm/snapshot2/autoPolicy/event/unbindDisk/unbindDisk")},r={main:'  <div class="manage-area">    <style>      .style-dot::before {        content: \'\';        background-color: #006eff;        width: 4px;        height: 4px;        border-radius: 8px;        margin-right: 10px;        margin-left: 10px;        display: inline-block;        vertical-align: middle;      }    </style>    <div class="manage-area-title">      <h2>定期快照策略</h2>      <div class="manage-area-title-right">        <a href="https://cloud.tencent.com/document/product/362/8191" target="_blank" class="guide-link">          定期快照使用指南          <b class="external-link-icon"></b>        </a>      </div>    </div>    <div class="manage-area-main">      <div class="manage-area-full-inner">        <div class="mb-10">          <region-pill b-ref="regionPill" b-model="regionId" short="{{true}}" global="{{true}}" reset="{{true}}"></region-pill>        </div>        <div class="tc-15-msg">          <p class="tip-info">            <strong>温馨提示：</strong><br>            1. 您可指定云硬盘关联到定期快照策略，周期性地定时创建、删除快照，为您的业务保驾护航。详情可见            <a href="https://cloud.tencent.com/document/product/362/8191" target="_blank">定期快照</a>。<br/>            2. 建议您对核心业务、数据类业务设置定期快照，以加强数据保护。<br/>            3. 请您注意：账户欠费时快照的相关操作都将被禁止。账户欠费时间达到 30 天时，账户下的所有快照都将被删除。          </p>        </div>        <div class="tc-15-msg" b-if="showArrearsTip">          <p class="tip-info">您已欠费，所有定期快照策略已暂停，如需继续使用，请前往续费</p>        </div>        <div id="operArea">          <div class="tc-15-action-panel">            <button type="button" class="tc-15-btn m" b-ref="addBtn" b-on-click="create()">新建</button>            <button type="button" class="tc-15-btn m weak disabled" b-ref="deleteBtn" data-title="请选择您要删除的快照策略"              b-on-click="batchDelete()">删除</button>            <button class="tc-15-btn weak m download" b-ref="exports"></button>            <button b-ref="setting" class="tc-15-btn weak m setting"></button>            <div id="searchArea" class="pull-right"></div>          </div>        </div>        <div id="aspList">          <asp-grid b-ref="grid"></asp-grid>        </div>      </div>    </div>  </div>  </div>',id:'  <p>    <span b-if="item.autoSnapshotPolicyState == \'ISOLATED\'">{{item.aspId}}</span>    <a b-if="item.autoSnapshotPolicyState != \'ISOLATED\'" href="{{item.aspDetailLink}}" data-event="nav"      target="_blank">{{item.aspId}}</a>  </p>  <p>    <span class="text-overflow m-width" title="{{item.aspName}}">{{item.aspName}}</span>  </p>',diskNumber:'  <a href="{{item.aspDetailLink}}" data-event="nav" target="_blank">{{item.diskNumber}} 个</a>',actions:'  <span>    <span b-if="item.autoSnapshotPolicyState == \'ISOLATED\'" data-title="已隔离状态的定期快照策略不支持该操作"      class="text-weak">修改策略</span>    <a b-if="item.autoSnapshotPolicyState != \'ISOLATED\'" href="javascript:;" b-on-click="modify([item])">修改策略</a>    <i class="black-seperate-line-icon" role="separator"></i>    <span b-if="item.autoSnapshotPolicyState == \'ISOLATED\'" data-title="已隔离状态的定期快照策略不支持该操作"      class="text-weak">关联云硬盘</span>    <a b-if="item.autoSnapshotPolicyState != \'ISOLATED\'" href="javascript:;" b-on-click="bindDisk([item])">关联云硬盘</a>    <i class="black-seperate-line-icon" role="separator"></i>    <a href="javascript:;" b-on-click="delete([item])">删除</a>  </span>',switchStatus:'  <label class="tc-15-switch" title="开启定期快照" b-if="!item.isActivated">    <input type="checkbox" class="tc-15-switch-input" b-on-click="switch([item])">    <span class="tc-15-switch-helper">开启</span>  </label>  <label class="tc-15-switch tc-15-switch-checked" title="停用定期快照" b-if="item.isActivated">    <input type="checkbox" checked="" class="tc-15-switch-input" b-on-click="switch([item])">    <span class="tc-15-switch-helper">开启</span>  </label>',state:"  <p>    <span      class=\"text-overflow {{item.autoSnapshotPolicyState == 'NORMAL' ? 'text-success' :item.autoSnapshotPolicyState == 'ISOLATED' ?'text-danger':''}}\"      title=\"{{item.autoSnapshotPolicyStateDesc}}\">{{item.autoSnapshotPolicyStateDesc}}</span>  </p>"},s=["delete","modify","bindDisk","exports","switch"],t=n.SNAPSHOT_REGION_LIST,u=g.extend({create:function(){w.exec("create")},batchDelete:function(){var a=w.grid.getSelected();a.length&&w.exec("delete",a)}});u.tag("project-selector",i);var v=j.extend({whiteList:t});u.tag("region-pill",v),u.tag("asp-grid",h.extend({$mixins:h.prototype.$mixins.concat([k("asp_grid_fields","#appArea [data-grid-setting]")]),events:{"change .tc-15-first-checkbox input[type=checkbox]":function(){w.toggleCheckbox()}},modify:function(a){w.exec("modify",a)},"switch":function(a){w.exec("switch",a)},bindDisk:function(a){w.exec("bindDisk",a)},"delete":function(a){w.exec("delete",a)},getData:function(a){w.queryAspList(a)},getSelectItem:function(a){var b=[];return d(w.grid.list).each(function(c,e){d(a).each(function(a,c){var f=d(c).closest("tr").data("aspId");e.aspId==f&&b.push(e)})}),b}},{defaults:{initGetData:!1,canResizeColum:!1,colums:[{name:"ID/名称",key:"aspIdName",required:!0,tdTpl:r.id},{name:"状态",key:"state",tdTpl:r.state},{name:"关联硬盘数量",key:"diskNumber",tdTpl:r.diskNumber},{name:"策略详情",key:"policyDesc"},{name:"定期快照",key:"switchStatus",tdTpl:r.switchStatus},{name:"创建时间",key:"createTime"},{name:"操作",key:"action",required:!0,tdTpl:r.actions}],emptyTips:"当前过滤条件下没有相应的快照策略",searchItemName:"快照策略",urlParams:"",page:1}}));var w={init:function(a,b,c){var h=this;l.aspListIns=this,this.queryobj=c||{},this.queryobj.regionId=c?c.regionId||c.rid:f.getRegionId(),this.queryobj.projectId=c?c.projectId||c.pid:f.getProjectId(),null!=this.queryobj.projectId&&void 0!=this.queryobj.projectId&&f.setProjectId(parseInt(this.queryobj.projectId));var i=this.aspBee=new u(r.main,{isI18n:f.isI18n()});this.grid=i.$refs.grid,this.regionSelector=i.$refs.regionPill,this.grid.urlParams="?regionId="+this.queryobj.regionId;var j=!1;this.regionSelector.list.forEach(function(a){a.regionId==h.queryobj.regionId&&(j=!0)}),j&&this.aspBee.$set("regionId",this.queryobj.regionId),this.loop=null;var k=g.components["qc-search"],m=this.search=new k({$data:{keyword:"",searchEmpty:!0,multiple:!1,placeholder:"支持快照策略ID、名称搜索"},search:function(){var a=h.search.getKeyword(),b=d.extend(h.opts,{page:1,searchKey:a});h.queryAspList(b)}});p.queryWhiteList().then(function(a){return h.whiteListMap=a,o.queryAccountBalance().then(function(a){h.margin=a,h.aspBee.$set({showArrearsTip:h.margin<0})}),h.whiteListMap.cbs_auto_snap?(nmc.render(i.$el,"cvm"),h.queryAspList(h.queryobj),h.bindEvents(),void d("#searchArea").html("").append(m.$el)):h.whiteListMap.CBS_snapshorts_WHITELIST?void e.navigate("/cvm/snapshot"):void e.navigate("/cvm/cbs")})},bindEvents:function(){var a=this;this.regionSelector.$on("selected",function(){a.queryAspList({regionId:a.regionSelector.selected[0].regionId})}),d(this.aspBee.$refs.setting).click(function(){a.grid.showFieldsManager()}),d(this.aspBee.$refs.exports).click(function(){var b=a.grid.list.map(function(a){return a});a.exec("exports",b)})},toggleCheckbox:function(){var a=this.grid.selectedNum;return a?(d(this.aspBee.$refs.deleteBtn).removeClass("disabled"),void this.stopLoop()):(d(this.aspBee.$refs.deleteBtn).addClass("disabled"),void this.startLoop())},getQueryParam:function(a){var b=this;a=a||{};var c={},d=(a.projectId||a.pid||f.getProjectId(),a.regionId||a.rid||f.getRegionId()),e=a.page>0?a.page:b.grid.page;c.limit=a.count>0?a.count:b.grid.count,c.offset=(e-1)*c.limit;var g=[];return a.searchKey&&(/^asp-\w{8}$/.test(a.searchKey)?g.push({name:"auto-snapshot-policy-id",values:[a.searchKey]}):g.push({name:"auto-snapshot-policy-name",values:[a.searchKey]})),c.filters=g,{data:c,regionId:d,page:e,count:c.limit,searchKey:a.searchKey||void 0}},queryAspList:function(a){var b=this,c=b.getQueryParam(a);b.regionId=l.regionId=c.regionId,m.queryAutoSnapshotPolicies({data:c.data,regionId:c.regionId},{camTips:!1}).then(function(a){if(a.response&&a.response.autoSnapshotPolicySet){var d=m.formatAspList(a.response.autoSnapshotPolicySet,{regionId:c.regionId}),e=a.response.totalCount;b.grid.setData({list:d,totalNum:e,page:c.page,count:c.count,searchKey:c.searchKey})}else if(b.grid.setData({list:[]}),a.errors&&a.errors.length)for(var f=0;f<a.errors.length;f++){var g=a.errors[f];l.showGridTips(g,b.grid);break}},function(a){b.grid.setData({list:[]}),l.showGridTips(a,b.grid)})},exec:function(a,b,c){var e=this;b||(b=e.grid.getSelected()),c=d.extend({regionId:e.regionId,callback:function(){setTimeout(function(){e.startLoop(!0)},500)}},c),q[a]&&q[a].exec(b,c)},selectedChange:function(){var a=this.grid.getSelected();this.toggleBtnStatus(a,d("#operArea"))},displayOperMenu:function(a,b){var c=this.grid.getSelectItem(b);this.toggleBtnStatus(c,a)},toggleBtnStatus:function(a,b){s.forEach(function(a){var c=b.find('[data-name="'+a+'"]');f.enableBtn(c)})},execContextMenu:function(a,b){w.execRowMenuItem(a,b)},execRowMenuItem:function(a,b){for(var c=d(a).attr("data-index"),e=this.grid,f=0,g=e.list.length;g>f;f++)e.$refs.list[f].$set({$selected:!1});e.$refs.list[c].$set({$selected:!0}),this.selectedChange(),this.exec(b.attr("data-name"))},startLoop:function(a){var b=this,c=a?1:5e3;this.loop&&clearTimeout(this.loop),this.loop=setTimeout(function(){b.queryAspList(b.queryobj)},c)},stopLoop:function(){clearTimeout(this.loop)},destroy:function(){clearTimeout(this.loop)}};c.exports=w}),define("cvm/snapshot2/autoPolicy/event/bindDisk/bindDisk",function(a,b,c){var d=(a("$"),a("qccomponent")),e=a("dialog"),f=a("cvm/snapshot2/util"),g=a("cvm/snapshot2/data"),h=a("cvm/cbs2/constants"),i=a("cvm/cbs2/data"),j=d.getComponent("device-selector"),k=(a("reporter"),a("appUtil")),l=a("tips");c.exports={exec:function(a,b){if(a&&1==a.length){var c=this;c.option=b||{},c.aspItem=a[0],c.deviceSelectorBee=new j({$tpl:'  <div data-role="device-selector" class="tc-15-mod-selector">    <div class="tc-15-msg">      <div class="tip-info">        <p class="text-danger">          <span b-if="!isI18n">云硬盘快照已于2019年1月22日0点启动正式商业化，</span>          <span b-if="isI18n">云硬盘快照（国际站）将于2019年3月1日启动正式商业化，</span>          查看快照用量和预估费用请前往          <a href="//console.cloud.tencent.com/cvm/snapshot/overview"  target="_blank">快照概览</a>，详细请查看          <a          href="{{ isI18n ? \'//intl.cloud.tencent.com/document/product/213/30265\' : \'//cloud.tencent.com/document/product/362/17935\'}}"          target="_blank">商业化公告</a>        </p>      </div>    </div>    <div b-on="events" class="tc-15-mod-selector-tb">      <div class="tc-15-option-cell options-left">        <div class="tc-15-option-hd">          <h4>{{ title }}</h4>        </div>        <div class="tc-15-option-bd">          <div class="search-box {{multipleSearch ? \'multi-search-box\' : \'\'}}">            <div class="search-input-wrap">              <input                b-if="!multipleSearch"                style="padding-left: 10px;"                data-search                type="text"                placeholder="{{searchPlaceHolder}}"                b-model="keyword"                class="tc-15-input-text search-input"              />              <textarea                b-if="multipleSearch"                data-search                type="text"                placeholder="{{searchPlaceHolder}}"                b-model="keyword"                class="tc-15-input-text search-input"              ></textarea>              <a                title="清空"                b-on-click="searchReset()"                class="btn-rm-txt"                role="button"                href="javascript:;"                >清空</a              >            </div>            <input              type="button"              data-search-btn              value="搜索"              class="search-btn"            />          </div>          <div class="tc-15-option-box">            <div class="info-row" b-if="list.length && searchKey">              {{> searchTipTpl }}，<a                b-on-click="backList()"                href="javascript:;"                >返回列表</a              >            </div>            <div class="tc-15-table-panel" data-list>              <div class="tc-15-table-fixed-head">                <table class="tc-15-table-box">                  <colgroup>                    <col width="30px" />                    <col />                    <col  width="80px"/>                    <col />                  </colgroup>                  <thead>                    <tr>                      <th><div class="tc-15-first-checkbox"></div></th>                      <th>                        <div><span class="text-overflow">ID/名称</span></div>                        <i class="resize-line-icon"></i>                      </th>                      <th>                        <div><span class="text-overflow">硬盘信息</span></div>                        <i class="resize-line-icon"></i>                      </th>                      <th>                        <div><span class="text-overflow">关联云主机</span></div>                      </th>                    </tr>                  </thead>                </table>              </div>              <div class="tc-15-table-fixed-body">                <table class="tc-15-table-box tc-15-table-rowhover">                  <colgroup>                    <col width="30px" />                    <col  />                    <col width="80px"/>                    <col />                  </colgroup>                  <tbody>                    <tr                      data-item                      b-repeat="item in list"                      class="{{item.selected ? \'selected\' : \'\'}} {{item.disabled ? \'disabled\' : \'\'}}"                      data-title?="item.$title"                    >                      <td>                        <div>                          <input                            type="checkbox"                            disabled?="item.disabled"                            class="tc-15-checkbox"                            b-model="item.selected"                          />                        </div>                      </td>                      <td>                        <div class="">                          <p class="text-overflow">                            <a href="javascript:void(0)">{{ item.diskId }}</a>                          </p>                          <p>                            <span class="text-overflow" data-title="{{item.diskName}}">                              {{ item.diskName }}                           </span>                          </p>                        </div>                      </td>                      <td>                        <div class="">                          <p class="text-overflow">{{                            item.diskUsageDesc                          }}</p>                          <p class="text-overflow">                            {{                              item.diskSizeDesc                            }}                          </p>                        </div>                      </td>                      <td>                        <div class="">                         <p class="text-overflow">                            <a href="javascript:void(0)">{{ item.instanceId || \'-\' }}</a>                         </p>                         <p b-if="item.instanceId">                           <span class="text-overflow" data-title="{{item.instanceName}}">{{ item.instanceName || \'-\'}}</span>                          </p>                        </div>                      </td>                    </tr>                  </tbody>                </table>              </div>            </div>            <div class="info-row" b-if="loading">              <b class="n-loading-icon"></b>正在加载...            </div>            <div class="info-row" b-if="!list.length && !loading">              <b class="n-error-icon"></b              >{{ emptyTips || \'未找到匹配\' + deviceName }}              <a b-if="searchKey" b-on-click="backList()" href="javascript:;"                >返回列表</a              >            </div>          </div>        </div>      </div>      <div class="tc-15-option-cell separator-cell">        <i class="icon-sep"></i>      </div>      <div class="tc-15-option-cell options-right">        <div class="tc-15-option-hd">          <h4>已选择({{ selected.length }})</h4>        </div>        <div class="tc-15-option-bd">          <div class="tc-15-option-box">            <div class="tc-15-table-panel">              <div class="tc-15-table-fixed-head">                <table class="tc-15-table-box">                  <colgroup>                    <col />                    <col style="width: 130px"/>                    <col style="width: 80px" />                  </colgroup>                  <thead>                    <tr>                      <th>                        <div><span class="text-overflow">ID/名称</span></div>                        <i class="resize-line-icon"></i>                      </th>                      <th>                        <div><span class="text-overflow">硬盘信息</span></div>                        <i class="resize-line-icon"></i>                      </th>                      <th></th>                    </tr>                  </thead>                </table>              </div>              <div class="tc-15-table-fixed-body">                <table class="tc-15-table-box tc-15-table-rowhover">                  <colgroup>                    <col />                    <col style="width: 130px" />                    <col style="width: 80px" />                  </colgroup>                  <tbody data-selected>                    <tr b-repeat="item in selected">                      <td>                        <div class="">                          <p class="text-overflow">                            <a href="javascript:void(0)">{{ item.diskId }}</a>                          </p>                          <p>                            <span class="text-overflow">{{                              item.diskName.length == 0                                ? \'未命名\'                                : item.diskName                            }}</span>                          </p>                        </div>                      </td>                      <td>                        <div class="">                          <p class="text-overflow">{{                            item.diskTypeDesc                          }}</p>                          <p class="text-overflow">                            <span>{{item.diskUsageDesc }} </span>                            <span>({{item.diskSizeDesc}})</span>                          </p>                        </div>                      </td>                      <td>                        <div class="">                          <span class="text-overflow">                            <a                              href="javascript:;"                              class=""                              b-on="{click: _delSelected}"                              ><i class="icon-del"></i                            ></a>                          </span>                        </div>                      </td>                    </tr>                  </tbody>                </table>                <div class="info-row" b-if="!selected.length">                  {{ selectedEmptyTips || \'没有选择数据\' }}                </div>              </div>            </div>          </div>        </div>      </div>    </div>  </div>',
$data:{title:"选择云硬盘",alias:{id:"diskId"},isI18n:k.isI18n(),deviceName:"云硬盘",searchPlaceHolder:"搜索云硬盘ID或名称",initGetData:!0,scrollPager:!0,searchTipTpl:"共找到 {{size || list.length}} 块云硬盘"},$afterInit:function(){},initGetData:!1,scrollPager:!0,multipleSearch:!0,getData:function(a,b){var d=this,e=a.searchKey,f=[{name:"disk-state",values:["ATTACHED","UNATTACHED"]}];e&&(/^disk-\w{8}$/.test(e)?f.push({name:"disk-id",values:[e]}):f.push({name:"disk-name",values:[e]})),i.queryDisks({regionId:c.aspItem.regionId,returnBindAutoSnapshotPolicy:!0,filters:f,offset:20*(a.page-1),limit:20}).then(function(a){var e=a.response&&a.response.diskSet,f=a.response&&a.response.totalCount;if(e){var g=[];e.forEach(function(a){a.instanceId&&g.push(a.instanceId)}),d.queryInstanceSet({instanceIds:g,regionId:c.aspItem.regionId}).then(function(a){var c=d.formatDiskData(e,a);b(null,{list:c,size:f})})}else b(null,{list:[],size:0})})},queryInstanceSet:function(a){var b=a.instanceIds,c=a.regionId;return new Promise(function(a,d){var e=[];b.length>0?g.queryInstances({instanceIds:b,regionId:c,limit:b.length,offset:0}).then(function(b){e=b&&b.response&&b.response.instanceSet||[],a(e)},function(b){a(e)}):a(e)})},formatDiskData:function(a,b){return a.forEach(function(a){if(a.diskTypeDesc=h.DISKTYPE[a.diskType],a.diskUsageDesc=h.DISK_USAGE_MAP[a.diskUsage],a.diskSizeDesc=a.diskSize+"GB",a.attached||(a.$title="由于该硬盘未挂载到实例上，定期快照策略暂不生效。当硬盘挂载到实例上后将正常生效"),a.instanceId){var c=b&&b.find(function(b){return b.instanceId==a.instanceId});a.instanceName=c&&c.instanceName}}),a}}),f.createDialog(c.deviceSelectorBee.$el,"关联云硬盘",800,function(){c.bindDisk()})}},bindDisk:function(a,b){var c=this,d=[];c.deviceSelectorBee.selected.forEach(function(a){d.push(a.diskId)}),g.bindAutoSnapshotPolicy({regionId:c.aspItem.regionId,aspId:c.aspItem.aspId,diskIds:d}).then(function(a){l.success("关联成功"),e.hide(),c.option.callback&&c.option.callback()});var f=e.el.find(".dialog_layer_ft").find(".btn:eq(0)");f.length&&f.html('<i class="ico ico_loading"></i><span>处理中...</span>')}}}),define("cvm/snapshot2/autoPolicy/event/create/create",function(a,b,c){var d=a("cvm/snapshot2/autoPolicy/event/modify/modify");c.exports={exec:function(a,b){d.exec([],b)}}}),define("cvm/snapshot2/autoPolicy/event/delete/delete",function(a,b,c){var d=a("qccomponent"),e=a("dialog"),f=a("cvm/snapshot2/data"),g=a("cvm/snapshot2/util"),h=a("reporter"),i=a("tips"),j=a("widget/mfa/mfa");c.exports={exec:function(a,b){if(a.length){b=b||{};j.verify({api:"cvm:DeleteAutoSnapshotPolicies"}).then(function(){var c=new d({$tpl:'    <div>        <snapshot-selected-show list="{{list}}" event-name="删除" resource-type-name="快照策略" resource-type-value="autoSnapshotPolicy"></snapshot-selected-show>        <div>            <p style="margin-top:10px;">删除的快照策略创建的快照不会被删除</p>        </div>    </div>',$data:{list:a},$afterInit:function(){}});g.createDialog(c.$el,"删除",700,function(){var c=a.map(function(a){return a.aspId});f.deleteAutoSnapshotPolicies({regionId:a[0].regionId,aspIds:c}).then(function(a){i.success("删除成功！",3e3),e.hide(),b.callback&&b.callback()}),h.click("Asp.click.delete")})}),h.click("Asp.dialog.delete")}}}}),define("cvm/snapshot2/autoPolicy/event/exports/exports",function(a,b,c){var d=(a("$"),a("appUtil")),e=a("util");c.exports={exec:function(a){var b={t:(new Date).getTime(),uin:e.getUin(),csrfCode:e.getACSRFToken(),projectId:d.getProjectId(),regionId:a[0]&&a[0].regionId||d.getRegionId(),autoSnapshotPolicyIds:a.map(function(a){return a.autoSnapshotPolicyId})},c=e.objectToParams(b);location.href="//"+window.QCBASE_HOST+"/cgi/snapshot?action=exportAutoSnapshotPolicies&"+c}}}),define("cvm/snapshot2/autoPolicy/event/modify/modify",function(a,b,c){var d=(a("$"),a("qccomponent")),e=a("dialog"),f=a("cvm/snapshot2/data"),g=a("cvm/snapshot2/util"),h=a("cvm/common/constants"),i=a("reporter"),j=a("tips"),k=a("appUtil");c.exports={exec:function(a,b){a=a||[];var c=this;c.aspItem=a[0]||null,b=b||{};var l=!!c.aspItem,m=l?"modify":"create",n=l?{title:"修改快照策略",action:"modifyAutoSnapshotPolicyAttribute",regionName:c.aspItem.regionName,newAspName:c.aspItem.aspName,newBackupDays:g.getDays(c.aspItem.policy[0].dayOfWeek),newBackupHours:g.getHours(c.aspItem.policy[0].hour),newRetentionDays:c.aspItem.retentionDays,isPermanent:c.aspItem.isPermanent?1:0,firstBackupTime:c.aspItem.nextTriggerTime}:{title:"新建快照策略",action:"createAutoSnapshotPolicy",regionName:h.REGIONNAMES[b.regionId],newAspName:"",newBackupDays:g.getDays(),newBackupHours:g.getHours(),newRetentionDays:f.DEFAULT_RETENTION_DAYS,isPermanent:0,firstBackupTime:""},o=new d({$tpl:'  <div>    <style>      input::-webkit-outer-spin-button,      input::-webkit-inner-spin-button {        -webkit-appearance: none !important;      }      input[type=\'number\'] {        -moz-appearance: textfield;      }    </style>    <div b-if="isModifyAspMode">      <snapshot-selected-show        list="{{ list }}"        event-name="修改"        resource-type-name="快照策略"        resource-type-value="autoSnapshotPolicy"      ></snapshot-selected-show>    </div>    <ul class="form-list terminal-snapshot-box">      <li>        <div class="form-label">          <label for="">名称</label>        </div>        <div class="form-input">          <div class="form-unit">            <input              type="text"              class="tc-15-input-text m"              placeholder=""              b-model="aspOption.newAspName"              maxlength="60"            />            <b class="icon-valid-flag"></b>            <p class="form-input-help"></p>          </div>        </div>      </li>      <li class="pure-text-row">        <div class="form-label">          <label for="">所属地域</label>        </div>        <div class="form-input">          <p>{{ aspOption.regionName }}</p>        </div>      </li>      <li class="pure-text-row">        <div class="form-label">          <label for="">备份日期</label>        </div>        <div class="form-input">          <div>            <label              class="form-ctrl-label"              b-repeat="day in aspOption.newBackupDays"            >              <input                type="checkbox"                b-model="day.selected"                name="newBackupDays"                class="tc-15-checkbox"                value="{{ day[\'value\'] }}"              />{{ day[\'text\'] }}            </label>          </div>        </div>      </li>      <li class="pure-text-row">        <div class="form-label">          <label for="">备份时间点</label>        </div>        <div class="form-input">          <div>            <label              class="form-ctrl-label"              b-repeat="hour in aspOption.newBackupHours"            >              <input                type="checkbox"                b-model="hour.selected"                name="newBackupHours"                value="{{ hour[\'value\'] }}"                class="tc-15-checkbox"              />{{ hour[\'text\'] }}            </label>          </div>        </div>      </li>      <li class="pure-text-row">        <div class="form-label">          <label for="">快照保留时间</label>        </div>        <div class="form-input">          <div>            <p>              <label class="form-ctrl-label">                <input                  type="radio"                  b-model="aspOption.isPermanent"                  name="isPermanent"                  class="tc-15-radio"                  value="0"                />保留                <input                  type="number"                  min="{{ minRetentionDay }}"                  max="{{ maxRetentionDay }}"                  maxlength="5"                  b-model="aspOption.newRetentionDays"                  b-on="{keyup: parseIntRetentionDay.bind(this), input: sliceRetentionDay.bind(this)}"                  class="tc-15-input-text m"                  style="width: 60px;"                />                天后自动删除              </label>            </p>            <label class="form-ctrl-label">              <input                type="radio"                b-model="aspOption.isPermanent"                name="isPermanent"                class="tc-15-radio"                value="1"              />永久保留</label            >          </div>        </div>      </li>      <li class="pure-text-row">        <div class="form-label">          <label for="">首次备份时间</label>        </div>        <div class="form-input" b-if="aspOption.firstBackupTime">          <p>            关联硬盘后，首次备份将于 {{ aspOption.firstBackupTime }} 自动开始          </p>        </div>      </li>    </ul>    <div class="tc-15-msg">      <div class="tip-info">        <p>          1.          <span b-if="isI18n"            >云硬盘快照（国际站）将于2019年3月1日启动正式商业化，</span          >          <span b-if="!isI18n"            >云硬盘快照已于2019年1月22日0点启动正式商业化，</span          >          查看快照用量和预估费用请前往<a            href="//console.cloud.tencent.com/cvm/snapshot/overview"            target="_blank"            >快照概览</a          >，详细请查看          <a            href="{{              isI18n                ? \'//intl.cloud.tencent.com/document/product/213/30265\'                : \'//cloud.tencent.com/document/product/362/17935\'            }}"            target="_blank"            >商业化公告</a          >。快照有配额限制，超出配额时自动快照策略将无法执行。请合理的设置快照备份周期和保留时间，避免自动备份失败。          <br />          2.          设定的定时快照任务时间和实际创建快照时间可能存在一定差异，快照数据以实际创建的时间为准        </p>      </div>    </div>  </div>',$data:{list:a,aspItem:c.aspItem,aspOption:n,isModifyAspMode:l,minRetentionDay:1,maxRetentionDay:65536,isI18n:k.isI18n()},$afterInit:function(){var a=this;this.$watch("aspOption.newBackupDays",function(){a.updateFirstBackupTime()}),this.$watch("aspOption.newBackupHours",function(){a.updateFirstBackupTime()}),this.$watch("aspOption.newRetentionDays",function(a){})},sliceRetentionDay:function(a){a.target.value=a.target.value.slice(0,5),this.$set("aspOption.newRetentionDays",a.target.value)},parseIntRetentionDay:function(a){a.target.value=parseInt(a.target.value),this.$set("aspOption.newRetentionDays",a.target.value)},updateFirstBackupTime:function(){var a=this;this.getFirstBackupTime(this.aspOption).then(function(b){a.$set("aspOption.firstBackupTime",b||"")})},getFirstBackupTime:function(a){var b=a.newBackupDays,c=a.newBackupHours,d=b.reduce(function(a,b){return b.selected&&a.push(b.value),a},[]),e=c.reduce(function(a,b){return b.selected&&a.push(b.value),a},[]);return d.length>0&&e.length>0?f.createAutoSnapshotPolicy({data:{Version:"2017-03-12",Policy:[{DayOfWeek:d,Hour:e}],DryRun:!0}}).then(function(a){return a.response.nextTriggerTime}):Promise.resolve("")}});g.createDialog(o.$el,n.title,540,function(){var a=o.aspOption;if(!c.checkAspOption(a))return void e.toggleBtnDisable();var d=c.getAspParam(a,l);f[a.action](d).then(function(a){var c=l?"修改快照策略成功":"新建快照策略成功";j.success(c,3e3),e.hide(),b.callback&&b.callback()},function(){e.toggleBtnDisable(!1)}),i.click("Asp.click."+m)}),i.click("Asp.dialog."+m)},checkAspOption:function(a){if(a.newAspName.length>60)return j.error("名称不能超过60个字符",3e3),!1;var b=a.newBackupDays.some(function(a){return a.selected});if(!b)return j.error("请选择至少一个备份日期",3e3),!1;var c=a.newBackupHours.filter(function(a){return a.selected});return c.length?0==a.isPermanent&&(a.newRetentionDays<=0||a.newRetentionDays>65536)?(j.error("请输入合法的快照保留时间(1-65536)",3e3),!1):!0:(j.error("请选择至少一个备份时间点",3e3),!1)},getAspParam:function(a,b){var c=this,d=[];a.newBackupDays.forEach(function(a){a.selected&&d.push(Number(a.value))});var e=[];a.newBackupHours.forEach(function(a){a.selected&&e.push(Number(a.value))});var f={autoSnapshotPolicyId:b?c.aspItem.autoSnapshotPolicyId:void 0,autoSnapshotPolicyName:a.newAspName?a.newAspName:void 0,policy:[{dayOfWeek:d,hour:e}],isPermanent:1==a.isPermanent,retentionDays:1==a.isPermanent?void 0:a.newRetentionDays};return{data:f,regionId:g.regionId}}}}),define("cvm/snapshot2/autoPolicy/event/switch/switch",function(a,b,c){var d=a("qccomponent"),e=a("dialog"),f=a("cvm/snapshot2/data"),g=a("cvm/snapshot2/util"),h=a("tips"),i='  <div class="act-outline">    <p>定期快照策略暂停后，将不再自动创建快照。以前自动生成的快照到期后依然会自动删除，根据需要，您可以手动将其转为永久保留</p>    <div class="form-input" style="padding-top:20px;">      <div>        <label class="form-ctrl-label">          <input type="checkbox" b-model="isNotShowConfirmAgain" value="1" class="tc-15-checkbox">不再提示        </label>      </div>    </div>  </div>';c.exports={exec:function(a,b){if(a&&1==a.length){b=b||{};var c=a[0],j=c.isActivated;return"ISOLATED"==c.autoSnapshotPolicyState?void h.error("已隔离状态的定期快照策略不支持该操作"):void f.modifyAutoSnapshotPolicyAttribute({data:{autoSnapshotPolicyId:c.autoSnapshotPolicyId,isActivated:!c.isActivated},regionId:c.regionId}).then(function(a){if(j){var c=localStorage.getItem("asp_stop_confirm_status");if(1==c)h.success("该定期快照策略已暂停",3e3);else{var f=new d({$tpl:i,$data:{}});g.createDialog(f.$el,"删除",700,function(){if(f.isNotShowConfirmAgain)try{localStorage.setItem("asp_stop_confirm_status",1)}catch(a){console.warn(a)}e.hide()})}}else h.success("该定期快照策略已开启",3e3);b.callback&&b.callback()})}}}}),define("cvm/snapshot2/autoPolicy/event/unbindDisk/unbindDisk",function(a,b,c){var d=a("qccomponent"),e=a("dialog"),f=a("cvm/snapshot2/util"),g=a("cvm/snapshot2/data"),h=a("reporter"),i=a("tips");c.exports={exec:function(a,b){if(a.length&&1==a.length&&b&&b.diskList&&b.diskList.length){var c=a[0],j=b.diskList,k=new d({$tpl:'  <div>    <snapshot-selected-show list="{{diskList}}" event-name="移出" resource-type-name="云硬盘" resource-type-value="disk"></snapshot-selected-show>    <p style="margin-top:10px;">确定要移出选定的云硬盘？</p>  </div>',$data:{diskList:j},$afterInit:function(){}});f.createDialog(k.$el,"移出",750,function(){var a=j.map(function(a){return a.diskId});g.unbindAutoSnapshotPolicy({aspId:c.aspId,diskIds:a,regionId:c.regionId}).then(function(a){i.success("移出云硬盘成功！",3e3),e.hide(),b.callback&&b.callback()}),h.click("Asp.click.unbindDisk")}),h.click("Asp.dialog.unbindDisk")}}}}),define("cvm/snapshot2/constants",function(a,b,c){c.exports={SNAPSHOT_REGION_LIST:["1","4","5","6","7","8","9","11","12","15","16","17","18","19","21","22","23","24","25","33","36","37","39","46"],CROSS_REGION_COPY_BLACK_LIST:{"ap-guangzhou":["ap-guangzhou-open","ap-fuzhou-ec"],"ap-fuzhou-ec":["ap-guangzhou"],"ap-guangzhou-open":["ap-guangzhou"],"ap-jinan-ec":["ap-beijing"],"ap-beijing":["ap-jinan-ec"],"ap-hangzhou-ec":["ap-shanghai"],"ap-shanghai":["ap-hangzhou-ec"]}}}),define("cvm/snapshot2/data",function(a,b,c){var d=(a("manager"),a("appUtil")),e=a("cvm/common/model"),f=a("cvm/common/constants"),g=a("cvm/cbs2/data");a("cvm/common/common");c.exports={checkSnapshotAbility:function(a){return e.request("/cgi/snapshot?action=checkSnapshotAbility",{regionId:a})},rollbackSnapshot:function(a){return e.apiRequest({regionId:a.regionId,cmd:"ApplySnapshot",serviceType:"cbs",data:{SnapshotId:a.snapshotId,DiskId:a.diskId}},{camTipsType:"dialog"})},queryAutoSnapshotPolicies:function(a,b){return e.apiRequest({regionId:a.regionId,cmd:"DescribeAutoSnapshotPolicies",serviceType:"cbs",data:a.data},b)},describeDiskAssociatedAutoSnapshotPolicy:function(a,b){var c=a.regionId;return delete a.regionId,e.apiRequest({regionId:c,action:"DescribeDiskAssociatedAutoSnapshotPolicy",serviceType:"cbs",data:a},b)},modifySnapshot:function(a){return e.apiRequest({regionId:a.regionId,cmd:"ModifySnapshotAttribute",serviceType:"cbs",data:{SnapshotId:a.snapshotId,SnapshotName:a.snapshotName,IsPermanent:a.isPermanent}},{camTipsType:"dialog"})},querySnapshots:function(a,b){return e.apiRequest({regionId:a.regionId,cmd:"DescribeSnapshots",serviceType:"cbs",data:a.data},{v3:!0,opt:b})},getSnapshotDisks:function(a,b){return new Promise(function(c,d){g.queryDisks({regionId:b,diskIds:a,limit:a.length}).then(function(a){c(a.response&&a.response.diskSet?a.response.diskSet:[])},function(a){c([])})})},deleteSnapshot:function(a){return e.apiRequest({regionId:a.regionId,cmd:"DeleteSnapshots",serviceType:"cbs",data:{SnapshotIds:a.snapshotIds}},{camTipsType:"dialog"})},createImage:function(a){return e.apiRequest({regionId:a.regionId,action:"CreateImage",serviceType:"cvm",data:a.data},{camTipsType:"dialog"})},createAutoSnapshotPolicy:function(a){return e.apiRequest({regionId:a.regionId,cmd:"CreateAutoSnapshotPolicy",serviceType:"cbs",data:a.data},{camTipsType:"dialog"})},modifyAutoSnapshotPolicyAttribute:function(a){return e.apiRequest({regionId:a.regionId,cmd:"ModifyAutoSnapshotPolicyAttribute",serviceType:"cbs",data:a.data},{camTipsType:"dialog"})},bindAutoSnapshotPolicy:function(a){return e.apiRequest({regionId:a.regionId,cmd:"BindAutoSnapshotPolicy",serviceType:"cbs",data:{autoSnapshotPolicyId:a.aspId,diskIds:a.diskIds}},{camTipsType:"dialog"})},unbindAutoSnapshotPolicy:function(a){return e.apiRequest({regionId:a.regionId,cmd:"UnbindAutoSnapshotPolicy",serviceType:"cbs",data:{diskIds:a.diskIds,autoSnapshotPolicyId:a.aspId}},{camTipsType:"dialog"})},deleteAutoSnapshotPolicies:function(a){return e.apiRequest({regionId:a.regionId,cmd:"DeleteAutoSnapshotPolicies",serviceType:"cbs",data:{AutoSnapshotPolicyIds:a.aspIds}},{camTipsType:"dialog"})},queryInstances:function(a,b){return e.apiRequest({action:"DescribeInstances",serviceType:"cvm",data:{InstanceIds:a.instanceIds,Limit:a.limit||20,Offset:a.Offset||0},regionId:a.regionId||d.getRegionId()},b)},describeUserTotalResources:function(a,b){return e.apiRequest({regionId:a.regionId,action:"DescribeUserTotalResources",serviceType:"cbs",data:a.data},b)},copySnapshotCrossRegions:function(a,b){return e.apiRequest({regionId:a.regionId,action:"CopySnapshotCrossRegions",serviceType:"cbs",data:a.data},b)},formatAspList:function(a,b){var c=this;a=a||[],b=b||{};var e=function(a){if(!a.policy||a.policy.length<1)return"";var b=a.policy[0],d=[];return d.push("每周"),b.dayOfWeek.forEach(function(a,e){d.push(c.DAY_MAP[a]),e==b.dayOfWeek.length-1?d.push("，"):d.push("、")}),b.hour.forEach(function(a,c){d.push(a>=10?a:"0"+a),d.push(":00"),c==b.hour.length-1?d.push("，"):d.push("、")}),d.push("自动创建快照，"),0==a.isPermanent?d.push("保留"+a.retentionDays+"天后自动删除"):d.push("永久保留"),d.join("")};return a.forEach(function(a,g){var h=a.policy[0];a.index=g,a.regionId=b.regionId||d.getRegionId(),a.regionName=f.REGIONNAMES[a.regionId],a.aspId=a.autoSnapshotPolicyId,a.aspName=a.autoSnapshotPolicyName||"未命名",a.autoSnapshotPolicyName=a.aspName,a.autoSnapshotPolicyStateDesc=c.autoSnapshotPolicyStateDescMap[a.autoSnapshotPolicyState]||a.autoSnapshotPolicyState,a.aspDetailLink="/cvm/snapshot/asp_detail/"+a.aspId+"?regionId="+a.regionId,a.diskNumber=a.diskIdSet.length,a.isActivated=!!a.isActivated,a.isPermanent=!!a.isPermanent,a.policyDesc=e(a),a.dayOfWeekDesc=h.dayOfWeek.map(function(a){return c.dayOfWeekMap[a]}).join("、"),a.hourDesc=h.hour.map(function(a){return a+":00"}).join("、"),a.retentionDaysDesc=a.isPermanent?"永久保留":"保留"+a.retentionDays+"天后自动删除",a.label=a.autoSnapshotPolicyName+"|"+c.dayOfWeekMap[h.dayOfWeek[0]]+(h.dayOfWeek.length>1?"...":"")+"|"+(h.hour.length>1?h.hour[0]+":00...":h.hour[0]+":00")+"|"+(a.isPermanent?"永久保留":"保留"+a.retentionDays+"天后自动删除"),a.tip=a.autoSnapshotPolicyId+"，"+h.dayOfWeek.map(function(a){return c.dayOfWeekMap[a]}).join("、")+"，"+h.hour.map(function(a){return a+":00"}).join("、")+" 自动创建快照"}),a},formatSnapshotList:function(a,b){var c=this,d=f.REGIONAREAMAP;return a=a||[],b=b||{},a.forEach(function(a,b){var e={NORMAL:"正常",CREATING:"创建中",ROLLBACKING:"回滚中",COPYING_FROM_REMOTE:"跨地域复制中",TORECYCLE:"待回收",CHECKING_COPIED:"复制校验中"},g={NORMAL:"text-success",CREATING:"",ROLLBACKING:"",COPYING_FROM_REMOTE:"",CHECKING_COPIED:""},h={SYSTEM_DISK:"系统盘",DATA_DISK:"数据盘"};a.placement&&(a.projectId=a.placement.projectId,a.zone=a.placement.zone,a.zoneId=f.ZONEV3TOZONEIDMAP[a.zone],a.zoneName=f.ZONEIDV3TONAMEMAP[a.zone],a.regionId=f.ZONETOREGIONMAP[a.zoneId],a.regionName=f.REGIONNAMES[a.regionId]),a.index=b,a.snapshotName=a.snapshotName||"未命名",a.stateDesc=e[a.snapshotState]||a.snapshotState,a.stateClass=g[a.snapshotState]||"",a.snapshotDetailLink="/cvm/snapshot/detail/"+a.snapshotId+"?regionId="+a.regionId,a.diskSizeDesc=a.diskSize>=0?a.diskSize+"G":"",a.diskLink=a.diskId?"/cvm/cbs/detail/?diskId="+a.diskId+"&regionId="+a.regionId:"",a.diskUsageDesc=h[a.diskUsage],a.deadlineDesc=c.getDeadline(a.deadlineTime),a.encryptDesc=a.encrypt?"是":"否",a.copyingToRegions&&a.copyingToRegions.length&&(a.crossRegionCopyTip="当前快照正在向"+a.copyingToRegions.map(function(a){var b=d[a];return b?(b.area||"")+"("+(b.name||"")+")":""}).join(",")+"复制,如果要删除快照,请在复制完成后操作"),a.desc="["+a.diskSize+"GB] "+a.snapshotId+" | "+(a.snapshotName||"未命名"),("CREATING"==a.snapshotState||"ROLLBACKING"==a.snapshotState||"COPYING_FROM_REMOTE"==a.snapshotState||"CHECKING_COPIED"==a.snapshotState)&&(a.$loading=!0,a.$disable=!0,a.$selected=!1,a.$class="disable")}),a},getDeadline:function(a){a=a||"0000-00-00 00:00:00";var b=864e5,c=7*b,e=new Date(a.replace(/\-/g,"/")),f="",g=d.getSystemTime(),h=g-e.getTime();if("0000-00-00 00:00:00"==a)f='<span class="text-overflow">永久保留</span>';else{var i;h>0?(i=Math.floor(h/b),f=1>i?'<span class="text-overflow status-recover text-error">已过期1天</span>':'<span class="text-overflow status-recover text-error">已过期'+i+"天</span>"):-c>h?(i=a.substring(0,10),f='<span class="text-overflow">将于'+i+"</br>自动删除</span>"):(i=Math.floor(Math.abs(h/b)),f=1>i?'<span class="text-overflow text-warning">小于1天 自动删除</span>':'<span class="text-overflow text-warning">'+i+"天后 自动删除</span>")}return f},modifySnapshotsSharePermission:function(a,b){var c=a.data;return e.apiRequest({regionId:a.regionId,serviceType:"cbs",cmd:"ModifySnapshotsSharePermission",data:{Permission:c.Permission,AccountIds:c.AccountIds,SnapshotIds:c.SnapshotIds}},b)},queryShareSnapshots:function(a,b){var c=a.data;return c.Filters||(c.Filters=[]),c.Filters.push({Name:"snapshot-type",Values:["SHARED_SNAPSHOT"]}),e.apiRequest({regionId:a.regionId,cmd:"DescribeSnapshots",serviceType:"cbs",data:a.data},b)},describeSnapshotSharePermission:function(a,b){return e.apiRequest({regionId:a.regionId,serviceType:"cbs",cmd:"DescribeSnapshotSharePermission",data:a.data},b)},MAX_SNAPSHOT_NAME_LENGTH:60,DEFAULT_RETENTION_DAYS:30,DAY_MAP:{1:"一",2:"二",3:"三",4:"四",5:"五",6:"六",0:"日"},dayOfWeekMap:{1:"星期一",2:"星期二",3:"星期三",4:"星期四",5:"星期五",6:"星期六",0:"星期日"},autoSnapshotPolicyStateDescMap:{NORMAL:"正常",ISOLATED:"已隔离"}}}),define("modules/cvm/snapshot/snapshot",function(a,b,c){var d=(a("$"),a("cvm/snapshot2/list/snapshotList")),e=a("cvm/snapshot2/list/snapshotDetail"),f=a("cvm/snapshot2/autoPolicy/autoSnapshotPolicyList"),g=a("cvm/snapshot2/autoPolicy/autoSnapshotPolicyDetail"),h=a("cvm/snapshot2/overview/overview"),i={detail:e,asp:f,asp_detail:g,overview:h},j={title:"快照-控制台",render:function(a,b,c){return this.path=a,i[a]?void i[a].init(a,b,c):("object"===("undefined"==typeof a?"undefined":_typeof(a))&&(c=a),void d.init(this.path,b,c))},destroy:function(){return i[this.path]?void i[this.path].destroy():void d.destroy()}};c.exports=j}),define("cvm/snapshot2/list/event/createDisk/createDisk",function(a,b,c){var d=a("cvm/cbs2/event/buy");c.exports={exec:function(a,b){d.init({projectId:a[0].projectId,regionId:a[0].regionId,snapshotId:a[0].snapshotId,snapshotSize:a[0].diskSize,snapshot:a[0],zoneList:b.zoneList,projectList:b.projectList,whiteListMap:b.whiteListMap,callback:b.callback})}}}),define("cvm/snapshot2/list/event/createImage/createImage",function(a,b,c){var d=a("$"),e=(a("appUtil"),a("qccomponent")),f=a("dialog"),g=a("cvm/snapshot2/util"),h=a("cvm/snapshot2/data"),i=a("tips"),j=a("validator"),k=a("cvm/cbs2/event/SnapshotListSelector/snapshotListSelector");c.exports={exec:function(a,b){var c=this;c.createImageBee=new e({$tpl:'  <div>    <snapshot-selected-show      list="{{ list }}"      event-name="创建自定义镜像"    ></snapshot-selected-show>    <div class="edit_form_wrap">      <ul class="form-list mt-20 edit_psword">        <li>          <div class="form-label ">            <label for="">镜像名称</label>          </div>          <div class="form-input">            <input              type="text"              class="tc-15-input-text l"              placeholder="请输入名称"              b-model="imageName"              maxlength="60"              b-ref="imageNameInput"            />            <p class="tip">支持中文、字母、数字、连接符号</p>          </div>        </li>        <li>          <div class="form-label ">            <label for="">镜像描述</label>          </div>          <div class="form-input">            <div class="form-unit">              <textarea                class="tc-15-input-textarea"                b-model="imageDescription"                maxlength="60"              ></textarea>            </div>          </div>        </li>        <li>          <div class="form-label ">            <label for=""></label>          </div>          <div class="form-input">            <div class="form-unit">              <p>                <label class="form-ctrl-label">                  <input                    b-model="showSnapshotSelectorList"                    type="checkbox"                    class="tc-15-checkbox"                  />添加数据盘快照                </label>              </p>            </div>          </div>        </li>      </ul>    </div>    <div>      <ul class="form-list mt-20">        <li          style="display: {{ showSnapshotSelectorList ? \'table-row\' : \'none\' }}"        >          <div class="form-label ">            <label for="">快照详情</label>          </div>          <div class="form-input">            <div>              <ul                class="mod-bg-gray-config"                id="create-image-snapshot-selectors"              ></ul>              <div                b-if="snapshotSelectorNumber < maxSnapshotSelectorNumber"                class="add-btn mt-10"              >                <a href="javaScript:;" b-on-click="addSnapshotSelector()"                  >添加</a                >              </div>            </div>          </div>        </li>      </ul>    </div>  </div>',$data:{regionId:a[0].regionId,zoneId:a[0].zoneId,zone:a[0].zone,list:a,imageName:void 0,imageDescription:void 0,dataSnapshotIdMap:{},snapshotSelectorMap:{},snapshotSelectorIndex:0,snapshotSelectorNumber:0,maxSnapshotSelectorNumber:10},$afterInit:function(){this.addSnapshotSelector()},validateImageName:function(){var a=this,b=function(b){return j.showErr(d(a.$refs.imageNameInput),{tip:b}),!1},c=this.imageName;return c?c.length>60?b("镜像名称不能超过60个字符"):/^[0-9a-zA-Z-\u4e00-\u9fa5]{1,60}$/.test(c)?!0:b("请输入格式正确的名称"):b("请输入镜像名称")},addSnapshotSelector:function(){var a=this,b=d(this.$el).find("#create-image-snapshot-selectors"),c=new k({$data:{regionId:this.regionId,zone:this.zone,index:this.snapshotSelectorIndex}});a.snapshotSelectorMap[c.index]=c,c.$watch("selectedItem",function(d){if(f.toggleBtnDisable(!1),b.find("#create-image-snapshot-selector-tip-"+c.index).css("visibility","hidden"),d){var e=!0,g=!1,h=void 0;try{for(var i,j=Object.entries(a.dataSnapshotIdMap)[Symbol.iterator]();!(e=(i=j.next()).done);e=!0){var k=i.value,l=_slicedToArray(k,2),m=l[0],n=l[1];m!=c.index&&n==d.snapshotId&&(b.find("#create-image-snapshot-selector-tip-"+c.index).css("visibility","visible"),f.toggleBtnDisable(!0))}}catch(o){g=!0,h=o}finally{try{!e&&j["return"]&&j["return"]()}finally{if(g)throw h}}a.$set("dataSnapshotIdMap",Object.assign({},a.dataSnapshotIdMap,_defineProperty({},c.index,d.snapshotId)))}}),b.append('<li class="config-item" id="create-image-snapshot-selector-'+c.index+'"><a href="javaScript:;" class="rubbish-icon delete-create-image-snapshot-selector" title="删除" data-index="'+c.index+'"></a></li>'),b.find("#create-image-snapshot-selector-"+c.index).append(c.$el),b.find("#create-image-snapshot-selector-"+c.index).append('<span class="ml-10 text-danger" style="visibility:hidden" id="create-image-snapshot-selector-tip-'+c.index+'">此快照已被勾选</span>'),this.snapshotSelectorIndex++,this.$set("snapshotSelectorNumber",this.snapshotSelectorNumber+1)},deleteSnapshotSelector:function(a){this.dataSnapshotIdMap[a]=null,this.$set("snapshotSelectorNumber",this.snapshotSelectorNumber-1);var b=d(this.$el).find("#create-image-snapshot-selectors");b.find("#create-image-snapshot-selector-"+a).remove(),this.isDuplicateSnapshotId()?f.toggleBtnDisable(!0):f.toggleBtnDisable(!1)},isDuplicateSnapshotId:function l(){var a={},l=!1;return Object.values(this.dataSnapshotIdMap).forEach(function(b){a[b]?l=!0:a[b]=!0}),l},createImage:function(){if(this.validateImageName()){var c=[a[0].snapshotId];this.showSnapshotSelectorList&&(c=c.concat(Object.values(this.dataSnapshotIdMap).filter(function(a){return!!a})));var d=this.imageName,e=this.imageDescription;h.createImage({data:{snapshotIds:c,imageName:d,imageDescription:e},regionId:a[0].regionId}).then(function(a){i.success("创建成功！",3e3),f.hide(),b.callback&&b.callback()},function(a){f.toggleBtnDisable(!1)})}}}),g.createDialog(c.createImageBee.$el,"创建自定义镜像",650,function(){c.createImageBee.createImage()}),d("#create-image-snapshot-selectors").on("click",".delete-create-image-snapshot-selector",function(a){var b=a.target.dataset.index;c.createImageBee.deleteSnapshotSelector(b)})}}}),define("cvm/snapshot2/list/event/crossRegionCopy/crossRegionCopy",function(a,b,c){var d=a("qccomponent"),e=a("dialog"),f=(a("cvm/snapshot2/util"),a("cvm/snapshot2/data")),g=a("reporter"),h=a("tips"),i=(a("cvm/snapshot2/selectedShow/selectedShow"),a("util")),e=a("dialog"),j=a("cvm/common/constants"),k=a("config/regionconfig"),l=a("cvm/cbs2/data"),m=a("cvm/cvm/data"),n=a("cvm/snapshot2/constants"),o=k.getData(),p=j.REGIONAREAMAP,q=n.CROSS_REGION_COPY_BLACK_LIST,r={initCopyTable:function(){var a=this,b={$data:{hasFirst:!1,selectedHighlight:!1,colums:[{key:"radio",name:" ",width:40,minWidth:40,maxWidth:50,required:!0},{key:"region",name:"地域",width:150},{key:"hasSnapshotNum",name:"已有快照"}],minHeight:200,showState:!1,showPagination:!1},events:{"click tr":function(b){var c=$(b.target).closest("tr").find(":radio").prop("disabled");c||($(this.$el).find(":radio").prop("checked",!1),$(b.target).closest("tr").find(":radio").prop("checked",!0),setTimeout(function(){a.checkEvent()},0))}},getCellContent:function(a,b,c){return"radio"==c.key?'<div class="tc-15-first-radio"><input type="radio" class="tc-15-radio"></div>':void 0},getData:function(b,c){a.getCopyTable()},setTrAttr:function(a,b){return{"data-regionid":b.regionId}}},c=d.getComponent("grid-view");a.$copyTable=$("#copyTable"),a.gridView=new c(b),a.$copyTable.append(a.gridView.$el)},checkEvent:function(){var a=this;a.beeIns.$set("buttonStatus",!0)},formatData:function(a,b){var c=this,d=[],e=[],f=[],g=b.regionList,h=o[c.snapshot.regionId].id;e=e.concat(q[h]&&q[h].filter(function(a){return g.find(function(b){return b.region===a})})||[]),a.filter(function(a){return g.find(function(b){return b.region===a.region})}).forEach(function(a){var b,c=a.region;if(c!=h)if(a.snapshotSupportCrossCopy){if(e.includes(c))return;b={regionId:c,region:p[c].area+"("+p[c].name+")",hasSnapshotNum:a.snapshotNumberUsed+"/"+a.snapshotNumberTotal,snapshotNumIsFull:a.snapshotNumberUsed>a.snapshotNumberTotal},b.snapshotNumIsFull?f.push(b):d.push(b)}else e.push(c)}),c.gridView.setData({list:d});for(var j=0,k=f.length;k>j;j++){var l=f[j];c.$copyTable.find("tbody").append(i.tmpl('  <tr>    <td>      <div class="tc-15-first-radio">        <input type="radio" class="tc-15-radio" disabled>      </div>    </td>    <td colspan="1" class="text-left">      <div class="mirror-gray-text">        <span class="text-overflow" title="地域: <%=region%>">          <%=region%>        </span>      </div>    </td>    <td colspan="1" class="text-left">      <div class="mirror-gray-text">        <span class="text-overflow <%if(snapshotNumIsFull) {%> red <%}%>" title="已有快照: <%=hasSnapshotNum%>">          <%=hasSnapshotNum%>        </span>      </div>    </td>  </tr>',{region:l.region,hasSnapshotNum:l.hasSnapshotNum,snapshotNumIsFull:l.snapshotNumIsFull}))}for(var j=0,k=e.length;k>j;j++){var m=e[j];p[m]&&c.$copyTable.find("tbody").append(i.tmpl('  <tr>    <td>      <div class="tc-15-first-radio">        <input type="radio" class="tc-15-radio" disabled>      </div>    </td>    <td colspan="2">      <div class="mirror-gray-text">        <%= region %>地区          <i>(暂不支持复制到            <%= region %>地区)</i>      </div>    </td>  </tr>',{
region:p[m].name}))}},execCrossRegionCopy:function(){var a=this,b=$(a.gridView.$el).find(":radio:checked"),c=[].concat(b.closest("tr").data("regionid")),d=a.snapshot.regionId,g=a.snapshot.snapshotId,i={snapshotId:g,destinationRegions:c},j=a.beeIns.$get("snapshotNewName"),k=a.option;""!==j&&(i.snapshotName=j),f.copySnapshotCrossRegions({regionId:d,data:i},{tipErr:!1}).then(function(a){var b=a.response.snapshotCopyResultSet,c=b[0],d=[],e="";"Success"!=c.code&&d.push(c.message),d.length&&(e+=d.join(","),h.error(e)),k.callback&&k.callback()})["catch"](function(b){if(b.data.Response&&b.data.Response.Error)if("UnsupportedOperation.SnapshotNotSupportCopy"==b.data.Response.Error.Code){var c="快照"+a.snapshot.snapshotId+"("+a.snapshot.snapshotName+")暂不支持跨地域复制",d="快照跨地域复制功能目前处于灰度测试阶段，部分快照暂不支持";e.create(d,720,"",{title:c,preventResubmit:!1,button:{" 确定 ":function(){e.hide()}}})}else h.error(b.message)})},getCopyTable:function(){var a=this;Promise.all([m.queryConsoleRegion(),l.queryUserDiskResources()]).then(function(b){var c=_slicedToArray(b,2),d=c[0],e=c[1];a.formatData.call(a,e.response.resourcesDetailSet,{regionList:d})})}};c.exports={exec:function(a,b){b=b||{};var c=a[0];r.snapshot=c,r.option=b;var f=new d({$tpl:'  <div>    <style type="text/css">      .mirror-list .tc-15-page {        display: none      }      .mirror-list .tc-15-table-fixed-head {        position: absolute;        top: 108px;        /* width: 480px!important; */      }      #snapshot {        clear: left;      }      .red {        color: red;      }    </style>    <div class="mirror-list">      <div class="mirror-clear">      <div class="tc-15-msg warning" style="margin:0px 0px 10px 0px">          <div class="tip-info">            <p>请您注意跨地域复制镜像产生的费用：</p>            <p>1. 不同地域间的数据传输流量费。目前未对这部分流量计费，具体计费时间以腾讯云公告为准。</p>            <p>                2. 跨地域复制后的快照按照目标地域快照价格计费，详细计费可见              <a              href="//cloud.tencent.com/document/product/362/2413#.E5.BF.AB.E7.85.A7.E4.BB.B7.E6.A0.BC.E6.80.BB.E8.A7.88"              target="_blank"> 快照价格总览</a>。              </p>          </div>        </div>        <ul class="form-list" id="create_snapshot_dialog">          <li>            <div class="form-label">              <label>快照名称/ID</label>            </div>            <div class="form-input">              <p>{{snapshotName}} ({{snapshotId}})</p>            </div>          </li>          <li>            <div class="form-label">              <label>快照类型</label>            </div>            <div class="form-input">              <p>{{diskUsageDesc}}</p>            </div>          </li>          <li>            <div class="form-label">              <label>关联磁盘名称/ID</label>            </div>            <div class="form-input">              <p>{{diskName}} ({{diskId}})</p>            </div>          </li>          <li>            <div class="form-label">              <label>快照大小</label>            </div>            <div class="form-input">              <p>{{diskSizeDesc}}</p>            </div>          </li>          <li>            <div class="form-label">              <label>新快照名称</label>            </div>            <div class="form-input">              <div class="tc-15-input-text-wrap m">                <input type="text" class="tc-15-input-text" b-model="snapshotNewName" maxlength="60" id="snapshotAlias">                <div class="tc-15-input-tips" b-if="isShowLess">你还可以输入{{less}}个字符</span>                </div>              </div>            </div>          </li>        </ul>      </div>      <div id="copyTable"></div>    </div>  </div>',$beforeInit:function(){var a=this;c.diskId&&l.queryDisks({regionId:c.regionId,diskIds:[c.diskId]}).then(function(b){var c=b.response.diskSet;c.length&&a.$set("diskName",c[0].diskName)})},$afterInit:function(){this.$watch("buttonStatus",function(a){e.toggleBtnDisable(!a)})},$data:{snapshotId:c.snapshotId,snapshotName:c.snapshotName,diskId:c.diskId||"-",diskName:c.diskName||"-",diskUsageDesc:c.diskUsageDesc,diskSizeDesc:c.diskSizeDesc,buttonStatus:!1,snapshotNewName:"Copied "+c.snapshotId+" from "+o[c.regionId].id,isShowLess:!0}});f.$set("less",60-f.$get("snapshotNewName").length),f.$watch("snapshotNewName",function(a){f.$set("less",60-a.length)}),r.beeIns=f,e.create(f.$el,"550","",{title:"跨地域复制快照",preventResubmit:!0,buttonDisable:[1],button:{" 确定 ":function(){r.execCrossRegionCopy(),e.hide()}}}),r.initCopyTable(),g.click("Snapshot.dialog.crossRegionCopy")}}}),define("cvm/snapshot2/list/event/delete/delete",function(a,b,c){var d=a("qccomponent"),e=a("dialog"),f=a("cvm/snapshot2/util"),g=a("cvm/snapshot2/data"),h=a("reporter"),i=a("tips"),j=a("widget/mfa/mfa");c.exports={exec:function(a,b){var c=[];b=b||{},a.forEach(function(a){c.push(a.snapshotId)}),j.verify({api:"cvm:DeleteSnapshots"}).then(function(){var j=new d({$afterInit:function(){},$data:{list:a},$tpl:'        <div>            <snapshot-selected-show list="{{list}}" event-name="删除"></snapshot-selected-show>            <div>                <p>快照删除后将不可恢复，请谨慎操作！</p>            </div>        </div>'});f.createDialog(j.$el,"删除快照",650,function(){g.deleteSnapshot({snapshotIds:c,regionId:a[0].regionId}).then(function(a){i.success("删除成功！",3e3),e.hide(),b.callback&&b.callback()}),h.click("Snapshot.click.delete")})}),h.click("Snapshot.dialog.delete")}}}),define("cvm/snapshot2/list/event/exports/exports",function(a,b,c){var d=a("appUtil"),e=a("util");c.exports={exec:function(a){var b={t:(new Date).getTime(),uin:e.getUin(),csrfCode:e.getACSRFToken(),projectId:d.getProjectId(),regionId:a[0]&&a[0].regionId||d.getRegionId(),snapshotIds:a.map(function(a){return a.snapshotId})},c=e.objectToParams(b);location.href="//"+window.QCBASE_HOST+"/cgi/snapshot?action=exportSnapshots&"+c}}}),define("cvm/snapshot2/list/event/rename/rename",function(a,b,c){var d=a("qccomponent"),e=a("dialog"),f=a("cvm/snapshot2/util"),g=a("cvm/snapshot2/data"),h=a("reporter"),i=(a("cvm/snapshot2/selectedShow/selectedShow"),a("tips"));c.exports={exec:function(a,b){var c=a[0],j=g.MAX_SNAPSHOT_NAME_LENGTH;if(!("NORMAL"!=c.snapshotState||a.length<=0)){var k=new d({$afterInit:function(){this.$watch("newName",function(){var a=j-this.newName.length;this.$set("remainLength",a),e.toggleBtnDisable(0>a)})},$data:{list:a,newName:"",remainLength:j},$tpl:'<div class="form-wrap">    <snapshot-selected-show list="{{list}}" event-name="改名"></snapshot-selected-show>    <ul class="form-list">        <li>            <div class="form-label">            <label>新名称</label>            </div>            <div class="form-input">                <div class="tc-15-input-text-wrap m">                    <input type="text" class="tc-15-input-text" b-model="newName" maxlength="60" />                    <div class="tc-15-input-tips">还可以输入{{remainLength}}个字符</div>                </div>            </div>        </li>    </ul></div>'});f.createDialog(k.$el,"改名",650,function(){return 0==k.newName.trim().length?(i.error("名称不能为空",3e3),void e.toggleBtnDisable()):k.newName.length>j?(i.error("名称不能超过"+j+"个字符",3e3),void e.toggleBtnDisable()):(g.modifySnapshot({regionId:c.regionId,snapshotId:c.snapshotId,snapshotName:k.newName}).then(function(a){i.success("改名成功！"),e.hide(),b.callback&&b.callback()}),void h.click("Snapshot.click.rename"))}),h.click("Snapshot.dialog.rename")}}}}),define("cvm/snapshot2/list/event/rollback/rollback",function(a,b,c){var d=a("qccomponent"),e=a("dialog"),f=a("cvm/snapshot2/util"),g=a("cvm/snapshot2/data"),h=a("reporter"),i=a("tips"),j=a("widget/mfa/mfa"),k=a("appUtil");c.exports={exec:function(a,b){var c=a[0];b=b||{},j.verify({api:"cvm:ApplySnapshot"}).then(function(){var j=new d({$afterInit:function(){},$data:{list:a,item:c,isI18n:k.isI18n()},$tpl:'  <div>    <div class="tc-15-msg">      <div class="tip-info">           <p class="text-danger">             <span b-if="!isI18n">云硬盘快照已于2019年1月22日0点启动正式商业化，</span>             <span b-if="isI18n">云硬盘快照（国际站）将于2019年3月1日启动正式商业化，</span>             查看快照用量和预估费用请前往             <a href="//console.cloud.tencent.com/cvm/snapshot/overview" target="_blank">快照概览</a>，详细请查看             <a             href="{{ isI18n ? \'intl.cloud.tencent.com/document/product/213/30265\': \'//cloud.tencent.com/document/product/362/17935\'"             target="_blank">商业化公告</a></p>      </div>    </div>    <snapshot-selected-show list="{{list}}" event-name="回滚"></snapshot-selected-show>    <div class="rollback-box">      <div class="d-itb">        <div class="d-tbc">          <div class="current-disk">            <i class="icon-disk"></i>            <p>当前</p>          </div>          <div class="arrow-cell">            <!-- <p class="ta-c">回滚</p> -->            <i class="icon-transfer-arrow"></i>          </div>          <div class="old-disk">            <i class="icon-disk icon-disk-old"></i>            <p>{{item.createTime}}</p>          </div>        </div>      </div>    </div>    <div class="rollback-text">      <p>{{item.diskUsageDesc}}        <a href="{{item.diskLink}}" data-event="nav" target="_blank">{{item.diskId}}</a> 的数据将回滚到        <strong>{{item.createTime}}</strong>      </p>      <p>此时刻之后的数据将被清除，请谨慎操作！</p>    </div>  </div>'});f.createDialog(j.$el,"回滚数据",650,function(){g.rollbackSnapshot({regionId:c.regionId,snapshotId:c.snapshotId,diskId:c.diskId}).then(function(a){i.loading("回滚中"),e.hide(),b.callback&&b.callback()}),h.click("Snapshot.click.rollback")})}),h.click("Snapshot.dialog.rollback")}}}),define("cvm/snapshot2/list/event/savePermanent/savePermanent",function(a,b,c){var d=a("tips"),e=a("cvm/snapshot2/data");c.exports={exec:function(a,b){b=b||{};var c=a[0];e.modifySnapshot({regionId:c.regionId,snapshotId:c.snapshotId,isPermanent:!0}).then(function(a){d.success("快照已被设置为永久保留！",3e3),b.callback&&b.callback()})}}}),define("cvm/snapshot2/shareSnap/shareSnap",function(a,b,c){var d=a("qccomponent"),e=a("appUtil"),f=a("dialog"),g=a("widget/popover/HelpTips"),h=a("cvm/snapshot2/data"),i=d.extend({$tpl:'    <div>        <div class="tc-15-msg">            您可以通过对端账号唯一ID将此快照共享给其他用户，每个快照最多可以共享给{{maxCount}}个账号。        </div>        <ul class="form-list mirror-sharing">            <li>                <div class="form-label">                    <label for="">对端账号唯一ID</label>                </div>                <div class="form-input">                    <div class="form-unit {{initialized && !accountFocused && accountInvalid && \'is-error\'}}">                        <input                                b-on-focus="$set({initialized:true, accountFocused:true})"                                b-on-blur="$set(\'accountFocused\', false)"                               type="text" b-model="account" class="tc-15-input-text m" placeholder="请输入对方对端账号唯一ID">                        <help-tips>在用户中心的个人信息中查看,                            <a target="_blank" href="https://www.qcloud.com/doc/product/213/4944#.E8.8E.B7.E5.8F.96.E5.AF.B9.E7.AB.AF.E5.B8.90.E5.8F.B7.E5.94.AF.E4.B8.80id">点击查看操作指南</a>                        </help-tips>                        <div b-if="initialized && !accountFocused && accountInvalid" class="tc-15-bubble tc-15-bubble-top valid-bubble">                            <div class="tc-15-bubble-inner">{{accountInvalid}}</div>                        </div>                    </div>                    <p class = "text-danger tips-error"></p>                </div>            </li>            <li>                <div class="form-label">                    <span class="label">已用限额</span>                </div>                <div class="form-input">                    <div class="share-counter" >{{shareReference}} / {{maxCount}}</div>                </div>            </li>        </ul>    </div>',$beforeInit:function(){var a=this;i.__super__.$beforeInit.apply(a,arguments);var b=a._validAccount=function(b){a.$set("accountInvalid",a.validAccount(b))};a.$watch("account",e.bufferFn(b,500)),b(a.account),h.describeSnapshotSharePermission({regionId:this.regionId,data:{SnapshotId:this.snapshotId}}).then(function(b){var c=b.response.sharePermissionSet;a.$set({shareReference:c.length})}),e.beeBind(a,a,"accountInvalid || shareReference>maxCount","invalid")},$beforeDestroy:function(){this.$set({snapshotId:"",account:""})},validAccount:function(a){return a=$.trim(a),a?/^\d{5,12}$/.test(a)?void 0:"唯一ID格式不正确":"不能为空"},isValid:function(){var a=this;return a._validAccount(a.account),!a.invalid}},{defaults:{maxCount:50,initialized:!1}});i.tag("help-tips",g),c.exports={exec:function(a,b){var c,d=$.Deferred();if(0!=a.length){var e=a[0];return c=new i({$data:Object.assign({},e,{shareReference:void 0})}),f.create(c.$el,"600","",{title:"共享快照",preventResubmit:!0,onload:function(){c.$watch("invalid",function(a){f.toggleBtnDisable(!!a)},!0)},defaultCancelCb:function(){c.$destroy(),d.reject()},button:{" 共享 ":function(a){if(c.isValid()){f.freeze(!0).toggleBtnLoading(!0);var e=c.$data,g=e.regionId,i=e.account,j=e.snapshotId;h.modifySnapshotsSharePermission({regionId:g,data:{Permission:"SHARE",AccountIds:[i.trim()],SnapshotIds:[j]}}).then(function(a){f.hide(),c.$destroy(),d.resolve(),b&&b.callback&&b.callback()},function(a){f.el.find(".tips-error").html(a.message),f.freeze(!1).toggleBtnLoading(!1).toggleBtnDisable(!1),d.reject()})}}}}),d}}}}),define("cvm/snapshot2/list/operate_auth",function(a,b,c){var d=a("cvm/cvm/cvmutil"),e=function(a){this.options=a};e.prototype={getAuth:function(){var a=this.options,b=a.dataItems,c=a.operAction;c=c||[];for(var d,e={},f=0;d=c[f];f++){var g=this.judgment[d];g?e[d]=g.call(this,b):e[d]={code:0}}return e},judgment:{rollback:function(a){var b;return a.length>0?1==a.length?(b=a[0],"SHARE"==b.snapshotType?this.disable("共享快照不支持该功能"):"NORMAL"==b.snapshotState?b.copyFromRemote?this.disable("被复制出的快照无法回滚"):b.disk?b.disk.migrating?this.disable("关联的云硬盘正在类型调整中，暂不支持回滚操作"):b.instance?d.isStopped(b.instance.instanceState)?this.enable():this.disable("关联硬盘挂载的子机处于未关机状态，无法执行回滚操作"):this.enable():this.disable("关联硬盘已被隔离或删除，无法执行回滚操作"):this.disable("任务中无法操作")):this.disable("请选择回滚的唯一快照"):this.disable("请选择你需要回滚的快照")},"delete":function(a){var b=[];if(a.length>0){for(var c,d=0;c=a[d];d++)(c.copyingToRegions.length>0||c.imageCount||c.shareReference)&&b.push(c);if(1==a.length){if("SHARE"==a[0].snapshotType)return this.disable("共享快照不支持该功能");if(a[0].imageCount)return this.disable("该快照创建了自定义镜像，请先删除对应镜像");if(a[0].shareReference>0)return this.disable("快照已被共享，取消共享后方可删除")}return b.length?this.disable("选择的快照无法删除，请重新选择"):this.enable()}return this.disable("请选择你需要删除的快照")},crossRegionCopy:function(a){var b;return a.length>0?1==a.length?(b=a[0],"SHARE"==b.snapshotType?this.disable("共享快照不支持该功能"):"NORMAL"==b.snapshotState?this.enable():this.disable("任务中无法操作")):this.disable("请选择需要复制的唯一快照"):this.disable("请选择你需要复制的快照")},rename:function(a){var b;return a.length>0?1==a.length?(b=a[0],"NORMAL"==b.snapshotState?this.enable():this.disable("任务中无法操作")):this.disable("请选择需要修改的唯一快照"):this.disable("请选择你需要改名的快照")},createDisk:function(a){var b;return a.length>0?1==a.length?(b=a[0],"NORMAL"==b.snapshotState&&"DATA_DISK"==b.diskUsage?this.enable():"SYSTEM_DISK"==b.diskUsage?this.disable("系统盘无法新建云硬盘"):this.disable("任务中无法操作")):this.disable("请选择需要修改的唯一快照"):this.disable("请选择你需要新建云硬盘的快照")},createImage:function(a){var b=void 0;return a.length>0?1==a.length?(b=a[0],"NORMAL"==b.snapshotState&&"SYSTEM_DISK"==b.diskUsage?this.enable():"DATA_DISK"==b.diskUsage?this.disable("数据盘无法创建自定义镜像"):this.disable("任务中无法操作")):this.disable("请选择需要创建自定义镜像的唯一快照"):this.disable("请选择你需要创建自定义镜像的快照")},shareSnap:function(a){var b=void 0;return a.length>0?1==a.length?(b=a[0],"SHARE"==b.snapshotType?this.disable("共享快照不支持该功能"):"SYSTEM_DISK"==b.diskUsage?this.disable("系统盘快照不支持共享及取消共享"):b.encrypt?this.disable("加密快照不支持共享"):"NORMAL"!=b.snapshotState?this.disable("仅能共享状态为正常的快照"):b.imageCount>0?this.disable("快照已关联镜像，请前往镜像控制台操作共享镜像"):this.enable()):this.disable("请选择需要分享的唯一快照"):this.disable("请选择你需要分享的快照")},exports:function(a){var b=[];if(a.length>0){for(var c,d=0;c=a[d];d++)"NORMAL"!=c.snapshotState&&b.push(c);return b.length?this.disable("选择的快照无法导出信息，请重新选择"):this.enable()}return this.disable("请选择你需要导出信息的快照")}},enable:function(){return{code:0}},disable:function(a){return{code:a.code?a.code:1,tip:a.tip?a.tip:a}}},c.exports=e}),define("cvm/snapshot2/list/snapshotDetail",function(a,b,c){var d=a("$"),e=a("util"),f=a("pageManager"),g=a("models/manager"),h=a("models/iaas"),i=a("appUtil"),j=(a("tips"),a("qccomponent")),k=(j.getComponent("grid-view"),a("cvm/snapshot2/data")),l=a("cvm/common/components/columsWidth/ColumsWidth"),m=a("widget/grid/Action"),n=a("widget/grid/LocalGrid"),o=a("dialog"),p=a("widget/fieldsManager/gridView"),q=a("cvm/common/common"),r={savePermanent:a("cvm/snapshot2/list/event/savePermanent/savePermanent"),shareSnap:a("cvm/snapshot2/shareSnap/shareSnap")},s={main:'  <div class="manage-area">    <div class="manage-area-title secondary-title">      <a href="/cvm/snapshot{{ urlParams }}" data-event="nav" class="back-link">        <i class="btn-back-icon"></i>返回</a      >      <span class="line-icon">|</span>      <h2>        {{ item.snapshotId }}        <span b-if="item"          >( <span class="ellipsis cvm-entry-name">{{ item.snapshotName }}</span          >)</span        >详情      </h2>    </div>    <div class="manage-area-main secondary-main">      <div class="tc-15-tab tc-15-tab-alt tc-special-tab">        <ul role="tablist" class="tc-15-tablist">          <li            class="tc-cur"            b-attr="tab_detail"            b-style="a1"            b-on-click="tab(\'detail\')"          >            <a href="javascript:;" role="tab">参数</a>          </li>          <li b-attr="tab_optlog" b-on-click="tab(\'optlog\')">            <a href="javascript:;" href="javascript:;" role="tab">操作日志</a>          </li>        </ul>        <!-- 参数 -->        <div class="param-panel" b-if="isShowInfo">          <div class="tc-g">            <div class="tc-g-u-1-2">              <div class="tc-panel">                <div class="param-box">                  <div class="param-hd">                    <h3>快照信息</h3>                  </div>                  <div class="param-bd">                    <ul class="item-descr-list">                      <li>                        <span class="item-descr-tit">名称</span>                        <span class="item-descr-txt">{{                          item.snapshotName                        }}</span>                      </li>                      <li>                        <span class="item-descr-tit">快照ID</span>                        <span class="item-descr-txt">{{                          item.snapshotId                        }}</span>                      </li>                      <li>                        <span class="item-descr-tit">地域</span>                        <span class="item-descr-txt">{{                          item.regionName                        }}</span>                      </li>                      <li>                        <span class="item-descr-tit">大小</span>                        <span class="item-descr-txt"                          >{{ item.diskSize }}GB</span                        >                      </li>                      <li>                        <span class="item-descr-tit">关联硬盘</span>                        <span class="item-descr-txt">                          <a b-if="item.disk"                            href="{{ item.diskLink }}"                            data-event="nav"                            target="_blank"                            >{{ item.diskId }}</a                          >                          <span b-if="!item.disk">{{item.diskId}}</span>                          <span b-if="item.disk"                            >（{{ item.disk.diskName }}）</span                          >                        </span>                      </li>                      <li>                        <span class="item-descr-tit">快照类型</span>                        <span class="item-descr-txt">{{                          item.diskUsageDesc                        }}</span>                      </li>                      <li>                        <span class="item-descr-tit">保留时间</span>                        <span class="item-descr-txt"                          >{{>item.deadlineDesc}}                          <a                            href="javascript:;"                            data-title="把该快照设置为永久保留"                            b-if="item.deadlineTime"                            b-on-click="savePermanent(item)"                            >长期保存</a                          >                        </span>                      </li>                      <li>                        <span class="item-descr-tit">创建时间</span>                        <span class="item-descr-txt">{{                          item.createTime                        }}</span>                      </li>                    </ul>                  </div>                </div>              </div>            </div>            <div class="tc-g-u-1-2" b-if="imageList">              <div class="tc-panel">                <div class="tc-panel-hd"><h3 class="title">关联的镜像</h3></div>                <div class="tc-panel-bd">                  <span b-if="!imageList.length">无关联镜像</span>                  <div class="tc-15-table-panel b-if="imageList.length">                    <div class="tc-15-table-fixed-head" b-if="imageList.length">                      <table class="tc-15-table-box">                        <colgroup>                          <col style="width:100px;" />                          <col style="width:80px;" />                        </colgroup>                        <thead>                          <tr>                            <th>                              <div><span class="text-overflow">ID</span></div>                            </th>                            <th>                              <div><span class="text-overflow">名称</span></div>                            </th>                          </tr>                        </thead>                      </table>                    </div>                    <div class="tc-15-table-fixed-body" b-if="imageList.length">                      <table class="tc-15-table-box tc-15-table-rowhover">                        <colgroup>                          <col style="width:100px;" />                          <col style="width:80px;" />                        </colgroup>                        <tbody>                          <tr b-repeat="imageItem in imageList">                            <td>                              <div>                                <span class="text-overflow"                                  ><a                                    data-event="nav"                                    href="{{                                      imageDetailLink + imageItem.imageId                                    }}"                                    >{{ imageItem.imageId }}</a                                  ></span                                >                              </div>                            </td>                            <td>                              <div>                                <span class="text-overflow">{{                                  imageItem.imageName                                }}</span>                              </div>                            </td>                          </tr>                        </tbody>                      </table>                    </div>                  </div>                </div>              </div>            </div>          </div>          <div class="tc-panel mt-20" b-if="canShare">            <div class="param-box" data-mod="share">              <div class="param-hd"><h3>快照共享</h3></div>              <div class="param-bd">                <div class="tc-15-action-panel">                  <qc-action-button                    label="共享快照"                    disabled="{{ !canShareMore }}"                    b-with="{action:share.bind(this)}"                  ></qc-action-button>                  <qc-action-button                    label="取消共享"                    disabled="{{ !hasSelected }}"                    b-with="{action:cancel.bind(this)}"                    attr="{{{\'data-title\':hasSelected?\'\':\'请选择要取消共享的账号\'}}}"                  ></qc-action-button>                </div>                <share-grid                  b-ref="grid"                  b-with="gridCfg"                  region-id="{{ regionId }}"                  snapshot-id="{{ item.snapshotId }}"                ></share-grid>              </div>            </div>          </div>        </div>        <!-- 日志 -->        <div class="tab-panel log-panel" b-if="isShowLog">          <div class="manage-area-full-inner">            <logs-grid b-ref="grid" data="{{item}}"></logs-grid>          </div>        </div>      </div>    </div>  </div>',optResult:'  <span class="text-success" b-if="item.status === 0">成功</span>  <span class="text-danger" b-if="item.status === 1">失败</span>  <span b-if="item.status === 2">进行中</span>',actionTd:'  <cell-action text="取消共享" act="cancel"></cell-action>',logsGrid:'  <div class="log-param snap-log-param">    <div class="justify-grid">      <div class="col">        <!-- TODO: 如何处理? -->        <!--<a class="link" href="javascript:void(0);" id="exportLogBtn">导出列表</a>-->        <qc-date-picker b-ref="datePicker">          <script type="text/json" data>            {              "showCalendar": true,              "tabs": [                { "label": "今天", "from": "%TODAY", "to": "%TODAY"},                { "label": "近7天", "from": "%TODAY-6", "to": "%TODAY"},                { "label": "近15天", "from": "%TODAY-14", "to": "%TODAY"},                { "label": "近30天", "from": "%TODAY-29", "to": "%TODAY"}              ],              "selected": {                "from": "%TODAY-29",                "to": "%TODAY"              },              "range": {                "min": null,                "max": "%TODAY",                "maxLength": 29              }            }          </script>        </qc-date-picker>      </div>    </div>    <div data-role="grid-view">      <div class="tc-15-table-panel">        <div class="tc-15-table-fixed-head">          <table class="tc-15-table-box">            <colgroup>              <col style="width: 15%" />              <col />              <col style="width: 20%" />              <col style="width: 20%" />              <col style="width: 15%" />              <col style="width: 10%" />            </colgroup>            <thead>              <tr>                <th>                  <div><span class="text-overflow">操作时间</span></div>                </th>                <th>                  <div><span class="text-overflow">操作名称</span></div>                </th>                <th>                  <div><span class="text-overflow">Action</span></div>                </th>                <th>                  <div><span class="text-overflow">操作者</span></div>                </th>                <th>                  <div><span class="text-overflow">操作结果</span></div>                </th>                <th>                  <div><span class="text-overflow">详情</span></div>                </th>              </tr>            </thead>          </table>        </div>        <div class="tc-15-table-fixed-body">          <table class="tc-15-table-box tc-15-table-rowhover">            <colgroup>              <col style="width: 15%" />              <col />              <col style="width: 20%" />              <col style="width: 20%" />              <col style="width: 15%" />              <col style="width: 10%" />            </colgroup>            <tbody>              <tr b-repeat="event in events">                <td>                  <div>                    <span class="text-overflow">                      {{event[\'EventTime\']}}                    </span>                  </div>                </td>                <td>                  <div>                    <span class="text-overflow">                      {{event[\'EventNameCn\']}}                    </span>                  </div>                </td>                <td>                  <div>                    <span class="text-overflow">                      {{event[\'EventName\']}}                    </span>                  </div>                </td>                <td>                  <div>                    <span class="text-overflow">                      {{event[\'Username\']}}                    </span>                  </div>                </td>                <td>                  <div>                    <span class="text-overflow">                      <span class="text-success" b-if="event.success">成功</span>                      <span class="text-danger" b-if="!event.success">失败</span>                    </span>                  </div>                </td>                <td>                  <div>                    <a data-event="nav" href="{{event.detailsUrl}}">详情</a>                  </div>                </td>              </tr>              <tr b-if="loading" tabindex="0">                <td class="text-center" colspan="6">                  <div style="padding: 20px 0;">                    <i class="n-loading-icon"></i> <span>加载中...</span>                  </div>                </td>              </tr>              <tr b-if="!loading && pageToken" tabindex="0">                <td class="text-center" colspan="6">                  <div style="padding: 20px 0;">                    <a href="javascript:void(0);" b-on-click="loadMore()">点击加载更多</a>                  </div>                </td>              </tr>              <tr b-if="!loading && !pageToken && !events.length" tabindex="0">                <td class="text-center" colspan="6">                  <div style="padding: 20px 0;">                    <span class="text">抱歉，暂无相关日志！</span>                  </div>                </td>              </tr>            </tbody>          </table>        </div>      </div>    </div>  </div>',cancelShare:'  <div class="coin-alert">    <table class="ui-popmsg">      <tbody>        <tr>          <td height="72" class="i"><i class="ico ico-warn mr10"></i></td>          <td height="72" class="t">            <span class="info">              <span class="tit">确定取消共享？</span> <br />            </span>          </td>        </tr>      </tbody>    </table>  </div>'},t=j.extend({$tpl:s.main,$beforeInit:function(){var a=this;t.__super__.$beforeInit.apply(a,arguments),a.gridCfg={_watchGrid:function(b){i.beeBind(b,a,"selectedNum"),i.beeBind(b,a,"totalNum")},doCancel:a.doCancel.bind(a)},i.beeBind(a,a,'item.snapshotState == "NORMAL" && item.diskUsage=="DATA_DISK" && item.encrypt==false',"canShare"),i.beeBind(a,a,"selectedNum>0","hasSelected"),i.beeBind(a,a,"totalNum<MAX_COUNT","canShareMore")},tab:function(a){w.tab(a)},savePermanent:function(a){w.exec("savePermanent",a)},share:function(){w.exec("shareSnap",{regionId:this.regionId,snapshotId:this.item.snapshotId,shareReference:this.item.shareReference})},cancel:function(a){var b=this,c=b.$refs.grid;b.doCancel(c.getSelected(),a.$el,b.$el)},doCancel:function(a){var b=this,c=b.$refs.grid,d=this.regionId,e=this.item.snapshotId;o.create(s.cancelShare,480,"",{title:"取消共享",button:{" 确定 ":function(){k.modifySnapshotsSharePermission({regionId:d,data:{Permission:"CANCEL",AccountIds:a.map(function(a){return a.accountId}),SnapshotIds:[e]}}).then(function(a){o.hide(),c.bufferReload()},function(a){o.el.find(".tips-error").html(a.message)})}}})}},{defaults:{MAX_COUNT:50}}),u=j.extend({$tpl:s.logsGrid,$afterInit:function(){var a=this;a.initDatePicker(),a.refresh()},initDatePicker:function(){var a=this,b=a.$refs.datePicker;b.setAllowRange("%TODAY-29","%TODAY",29),b.$on("datepick",function(){a.dateChange()})},dateChange:function(){var a=this;a.refresh()},refresh:function(){var a=this,b=a.$refs.datePicker;a.$set({loading:!0,events:[],pageToken:null}),a.getData({snapshotId:a.$data.data.snapshotId,startTime:i.getDate(b.selected.from+" 00:00:00"),endTime:i.getDate(i.getDate(b.selected.to+" 00:00:00").getTime()+864e5)
}).then(function(b){a.$set({loading:!1,events:b.events,pageToken:b.pageToken})})},loadMore:function(){var a=this,b=a.$refs.datePicker;a.$set({loading:!0}),a.getData({snapshotId:a.$data.data.snapshotId,startTime:i.getDate(b.selected.from+" 00:00:00"),endTime:i.getDate(i.getDate(b.selected.to+" 00:00:00").getTime()+864e5)},a.pageToken).then(function(b){a.$set({loading:!1,events:a.events.concat(b.events),pageToken:b.pageToken})})},getData:function(a,b){return h.apiRequest({serviceType:"cloudaudit",action:"LookUpEvents",regionId:1,data:{Version:"2019-03-19",StartTime:Math.floor(a.startTime.getTime()/1e3),EndTime:Math.floor(a.endTime.getTime()/1e3),LookupAttributes:[{AttributeKey:"ReadOnly",AttributeValue:"false"},{AttributeKey:"ResourceType",AttributeValue:"cvm"},{AttributeKey:"ResourceName",AttributeValue:"snapshot/"+a.snapshotId}],NextToken:b}}).then(function(b){return{events:(b.Response&&b.Response.Events?b.Response.Events:[]).map(function(b){var c=null;try{c=JSON.parse(b.CloudAuditEvent)}catch(d){}return b.success=Boolean(c&&!c.apiErrcode),b.detailsUrl="https://console.cloud.tencent.com/cloudaudit?"+["attributeKey=EventId","attributeValue="+b.EventId,"startTime="+a.startTime.getTime(),"endTime="+a.endTime.getTime(),"from=cvm"].join("&"),b}),pageToken:b.Response&&b.Response.NextToken&&!b.Response.ListOver?b.Response.NextToken:null}})}},{defaults:{}});j.tag("logs-grid",u);var v=n.extend({$mixins:[p("cvm_image_share_columns_v20151215")],$afterInit:function(){v.__super__.$afterInit.apply(this,arguments);var a=this,b=a.bufferReload.bind(a);a._watchGrid(a),a.$watch("regionId",b),a.$watch("snapshotId",b),b()},onRowCancel:function(a,b,c){this.doCancel([a],d(c.currentTarget),this.$gridBody)},getData:function(){var a=this;a.showLoading("加载中...");var b=a.snapshotId;k.describeSnapshotSharePermission({regionId:a.regionId,data:{SnapshotId:b}}).then(function(b){var c=b.response.sharePermissionSet;a.setData({totalNum:c.length,list:c}),a.hideLoading()})}},{defaults:{colums:l([{key:"accountId",name:"对端账号唯一ID",required:!0},{key:"createdTime",name:"共享时间"},{key:"_action",name:"操作",tdTpl:s.actionTd,required:!0}]),outerPaging:!1,showPagination:!1,hasFirst:!0,emptyTips:"此快照还没有共享给其它用户"}});v.tag("cell-action",m),t.tag("share-grid",v);var w={init:function(a,b,c){c?(this.queryobj=c,this.queryobj.regionId=c.regionId||c.rid||i.getRegionId()):this.queryobj={regionId:i.getRegionId()},this.detailBee=new t({regionId:this.queryobj.regionId,urlParams:c?"?"+e.objectToParams(c):""}),this.queryobj.snapshotId=b,f.appArea.html(this.detailBee.$el),this.renderInfo()},tab:function(a){this.detailBee.$set({tab_detail:{"class":""},tab_optlog:{"class":""}}),this.detailBee.$set("tab_"+a,{"class":"tc-cur"}),this.detailBee.$set({isShowInfo:"detail"===a?!0:!1,isShowLog:"optlog"===a?!0:!1})},initOptlog:function(){var a=this;this.datePicker=this.detailBee.$refs.datePicker,this.grid=this.detailBee.$refs.grid,this.renderGrid(),this.datePicker.$off("datepick"),this.datePicker.$on("datepick",function(b){a.renderGrid()})},getQueryParam:function(a){a=a||{};var b={},c=a.projectId||a.pid,d=a.regionId||a.rid||i.getRegionId();b.limit=1,b.offset=0;var e=[];return e.push({name:"snapshot-id",values:[a.snapshotId]}),c>=0&&(i.setProjectId(c),e.push({name:"project-id",values:[c]})),b.filters=e,{data:b,regionId:d}},renderInfo:function(){var a=this,b=a.getQueryParam(this.queryobj);k.querySnapshots({data:b.data,regionId:b.regionId}).then(function(c){if(c.response&&c.response.snapshotSet&&1==c.response.snapshotSet.length){var d=k.formatSnapshotList(c.response.snapshotSet),e=d[0];a.regionId=e.regionId,a.projectId=e.projectId,a.snapshotId=e.snapshotId,a.detailBee.$set({item:e,isShowInfo:!0,isShowLog:!1,imageDetailLink:"/cvm/image/detail/"+e.regionId+"/",imageList:e.images||[]}),e.diskId?k.getSnapshotDisks([e.diskId],b.regionId).then(function(b){1==b.length&&(e.disk=b[0],a.detailBee.$set({item:e}))}):a.detailBee.$set({item:e})}else a.renderDetailNoData()},function(b){a.renderDetailNoData()})},renderGrid:function(){var a=this,b=this.datePicker.selected.from,c=this.datePicker.selected.to;this.queryLog(b,c,function(b){var c={list:b.datalist,totalNum:b.total};if(b.datalist.length>0){var d=[];b.datalist.forEach(function(a){d.push(a.operate_uin)}),g.getAccounts({uins:d},function(d){b.datalist.forEach(function(a){a.status=parseInt(a.status),a.process_detail&&a.process_detail[0]&&a.process_detail[0].process_desc?a.processDesc=a.process_detail[0].process_desc:a.processDesc="";for(var b=0;b<d.length;b++)if(d[b][a.operate_uin]){a.operate_uin=d[b][a.operate_uin];break}}),a.grid.setData(c)},function(){a.grid.setData(c)})}else a.grid.setData(c)})},exec:function(a,b){var c=this,d={callback:function(){c.renderInfo(!0),c.detailBee.$refs.grid.bufferReload()}};b&&r[a]&&r[a].exec([b],d)},queryLog:function(a,b,c){var d=this,e=(i.getProjectId(),{page:1,count:20,projectId:d.projectId,instance_id:d.snapshotId,begin_time:a,end_time:b,command:"",orderField:"",detail:!0,order:""});e.rid=d.queryobj.rid,g.getOperatelogList(e,function(a){c&&c(a)},function(a){},!0)},renderDetailNoData:function(){q.renderDetailNoData("快照","/cvm/snapshot")},destroy:function(){}};c.exports=w}),define("cvm/snapshot2/list/snapshotList",function(a,b,c){var d=a("$"),e=(a("pageManager"),a("router")),f=a("appUtil"),g=a("widget/i18n"),h=a("qccomponent"),i=a("reporter"),j=h.getComponent("grid-view"),k=a("widget/projects/projectSelector"),l=a("cvm/common/components/regionNumPills"),m=a("widget/fieldsManager/gridView"),n=a("cvm/snapshot2/list/operate_auth"),o=a("widget/grid/Action"),p=a("cvm/cbs2/data"),q=a("cvm/common/constants"),r=a("cvm/snapshot2/data"),s=a("cvm/snapshot2/constants"),t=a("cvm/snapshot2/util"),u=(a("cvm/common/components/SmartHelper"),a("cvm/common/common")),v=a("constants"),w={createDisk:a("cvm/snapshot2/list/event/createDisk/createDisk"),"delete":a("cvm/snapshot2/list/event/delete/delete"),exports:a("cvm/snapshot2/list/event/exports/exports"),rename:a("cvm/snapshot2/list/event/rename/rename"),rollback:a("cvm/snapshot2/list/event/rollback/rollback"),crossRegionCopy:a("cvm/snapshot2/list/event/crossRegionCopy/crossRegionCopy"),createImage:a("cvm/snapshot2/list/event/createImage/createImage"),shareSnap:a("cvm/snapshot2/shareSnap/shareSnap")},x={main:'  <div class="manage-area">    <style>      .style-dot::before {        content: \'\';        background-color: #006eff;        width: 4px;        height: 4px;        border-radius: 8px;        margin-right: 10px;        margin-left: 10px;        display: inline-block;        vertical-align: middle;      }    </style>    <div class="manage-area-title">      <h2>快照</h2>      <project-selector        b-ref="ProjectSelector"        b-model="projectId"        get-projects="{{ getProjects }}"        b-on-click="clickProjectSelector()"      ></project-selector>      <div class="manage-area-title-right">        <a          b-on-click="clickSnapshotGuide(\'https://cloud.tencent.com/document/product/362/5754\')"          href="javascript:;"          class="guide-link"          >快照使用指南 <b class="external-link-icon"></b>        </a>      </div>    </div>    <div class="manage-area-main">      <div class="manage-area-full-inner">        <div class="mb-10">          <snapshot-region-num-pill            b-ref="regionNumPill"            b-model="regionId"            short="{{ true }}"            global="{{ true }}"            reset="{{ true }}"          ></snapshot-region-num-pill>        </div>        <div class="tc-15-msg" b-if="showTopMsg && noMarginEnough">          <p class="tip-info">            您已欠费，为保证快照备份文件可长期保留，请尽快续费          </p>        </div>        <div class="tc-15-msg" b-if="showTopMsg && !noMarginEnough">          <div class="tip-info">            <p>              <strong>温馨提示：</strong><br />              1.              您可指定云硬盘关联到定期快照策略，周期性地定时创建、删除快照，为您的业务保驾护航，点击管理              <a href="//console.cloud.tencent.com/cvm/snapshot/asp"                >定期快照策略</a              >。<br />              2. 创建快照会产生费用，详细计费可见              <a                href="//cloud.tencent.com/document/product/362/2413#.E5.BF.AB.E7.85.A7.E4.BB.B7.E6.A0.BC.E6.80.BB.E8.A7.88"                target="_blank"                >快照价格总览</a              >。 目前对于符合条件的部分地域，腾讯云将赠送该地域下一定量的              <span class="text-warning">免费快照额度</span>              ，点击              <a                href="https://cloud.tencent.com/document/product/362/32361#.E8.B5.A0.E9.80.81.E9.A2.9D.E5.BA.A6"                target="_blank"                >快照计费概述-赠送额度</a              >              查看详情。<br />              3. 请您注意：账户欠费时快照的相关操作都将被禁止。账户欠费时间达到              30 天时，账户下的所有快照都将被删除。<br />            </p>            <P>              <strong>数量限制：</strong><br />              当前地域最多创建              <span class="text-warning">{{                diskNum * ration + baseConst              }}</span>              个快照，已创建              <span class="text-warning">{{ snapNum }} </span>个（数量配额 =              云硬盘数 * {{ ration }} + {{ baseConst }}）            </P>          </div>        </div>        <div>          <ul role="tablist" class="tc-15-tablist">            <li              class="tc-cur"              b-attr="tab_my_snap"              b-style="a1"              b-on-click="tab(\'my_snap\')"            >              <a href="javascript:;" role="tab">快照</a>            </li>            <li b-attr="tab_share_snap" b-on-click="tab(\'share_snap\')">              <a href="javascript:;" href="javascript:;" role="tab">共享快照</a>            </li>          </ul>          <div class="tc-action-grid" b-class="{\'none\': \'!isShowMySnap\'}">            <div id="operArea" class="justify-grid" b-ref="operArea">              <div class="col">                <button                  type="button"                  class="tc-15-btn m weak disabled"                  b-ref="deleteButton"                  data-name="delete"                  data-title="请选择您要删除的快照"                  b-on-click="batchDelete()"                >                  删除                </button>              </div>              <div class="col">                <span id="searchArea"></span>                <button                  type="button"                  class="tc-15-btn weak m refresh"                  qc-popover="刷新"                  data-position="top"                  b-ref="refresh"                >                  刷新                </button>                <button                  class="tc-15-btn weak m download"                  b-ref="exports"                  qc-popover="导出"                  data-position="top"                ></button>                <button                  b-ref="setting"                  class="tc-15-btn weak m setting"                  qc-popover="设 置"                  data-position="top"                ></button>              </div>            </div>          </div>          <div id="snapshotList" b-class="{\'none\': \'!isShowMySnap\'}">            <snapshot-grid b-ref="grid"></snapshot-grid>          </div>          <div id="shareSnapshotList" b-class="{\'none\': \'!isShowShareSnap\'}">            <share-snapshot-grid b-ref="shareGrid"></share-snapshot-grid>          </div>        </div>      </div>    </div>  </div>',id:'  <p>    <a href="javascript:;" b-on-click="clickSnapshotId(item)">{{      item.snapshotId    }}</a>  </p>  <p>    <span class="text-overflow m-width" title="{{ item.snapshotName }}">{{      item.snapshotName    }}</span>    <a      b-if="item.snapshotState == \'NORMAL\'"      href="javascript:;"      role="button"      b-on-click="rename([item])"      class="pencil-icon hover-icon"      data-title="改名"    ></a>  </p>',status:'  <span    title="{{      item.snapshotState == \'CREATING\'        ? item.stateDesc + item.percent + \'%\'        : item.stateDesc    }}"    class="text-overflow m-width {{ item.stateClass }}"  >    {{ item.stateDesc }}    <i      b-if="item.snapshotState == \'NORMAL\' && item.copyingToRegions.length"      class="plaint-icon"      data-title="{{ item.crossRegionCopyTip }}"    ></i>    <span b-if="item.snapshotState == \'CREATING\'"      >{{ item.percent }}%      <i class="plaint-icon" data-title="{{ migratingTip }}"></i>    </span>    <!--      <span b-if="item.snapshotState == \'COPYING_TO_REMOTE\'">        <i class="plaint-icon" data-title="{{item.copytoremoteTip}}"></i>      </span>    -->    <span b-if="item.snapshotState == \'COPYING_FROM_REMOTE\'"      >{{ item.percent }}%      <!-- <i class="plaint-icon" data-title=""></i> -->    </span>    <span b-if="item.snapshotState == \'CHECKING_COPIED\'"      >{{ item.percent }}%      <!-- <i class="plaint-icon" data-title=""></i> -->    </span>  </span>',diskInfo:'  <p class="text-overflow">{{ item.diskUsageDesc }}</p>  <p class="text-overflow">{{ item.diskSizeDesc || \'-\' }}</p>',actions:'  <span style="white-space:nowrap">    <span>      <a        href="javascript:;"        class="snapshot-action"        data-name="rollback"        b-on-click="rollback([item])"        >回滚</a      >      <i class="black-seperate-line-icon" role="separator"></i>    </span>    <span>      <a        href="javascript:;"        class="snapshot-action"        data-name="delete"        b-on-click="delete([item])"        >删除</a      >      <i class="black-seperate-line-icon" role="separator"></i>    </span>    <span b-if="crossRegionCopyWhite">      <a        href="javascript:;"        class="snapshot-action"        data-name="crossRegionCopy"        b-on-click="crossRegionCopy([item])"        >跨地域复制</a      >      <i class="black-seperate-line-icon" role="separator"></i>    </span>    <div class="tc-15-dropdown" b-if="!isI18n || !!whiteListMap.instance_image">      <a href="javascript:;" class="tc-15-dropdown-link snapshot-more-action"        >更多<i class="caret"></i      ></a>      <ul class="tc-15-dropdown-menu">        <li role="presentation" b-if="!isI18n">          <a            href="javascript:;"            class="snapshot-action"            data-name="createDisk"            b-on-click="createDisk([item])"            >新建云硬盘</a          >        </li>        <li role="presentation" b-if="!!whiteListMap.instance_image">          <a            href="javascript:;"            class="snapshot-action"            data-name="createImage"            b-on-click="createImage([item])"            >创建自定义镜像</a          >        </li>        <li role="presentation">          <a            href="javascript:;"            class="snapshot-action"            data-name="shareSnap"            b-on-click="shareSnap([item])"            >共享快照</a          >        </li>      </ul>    </div>  </span>',disklink:'  <a    b-if="item.diskId && item.disk"    href="javascript:;"    b-on-click="clickSnapshotDiskId(item)"    >{{ item.diskId }}</a  >  <span b-if="item.diskId && !item.disk">{{ item.diskId }}</span>  <i    b-if="item.diskId && !item.disk"    class="n-error-icon"    data-title="关联的硬盘已隔离或已删除"  >  </i>  <p b-if="item.diskName">    <span class="text-overflow m-width">{{ item.diskName || \'未命名\' }}</span>  </p>  <span b-if="!item.diskId" class="text-overflow">-</span>',instancelink:'  <a    b-if="item.instanceId"    href="javascript:;"    b-on-click="clickSnapshotInstanceId(item)"    >{{ item.instanceId }}</a  >  <p    b-if="item.instanceId && item.instanceName"    class="text-overflow m-width"    title="{{ item.instanceName }}"  >    {{ item.instanceName }}  </p>  <span b-if="!item.instanceId" class="text-overflow m-width">-</span>',encryptDesc:'  <span class="text-overflow">{{ item.encryptDesc }}</span>',deadline:"  {{>item.deadlineDesc}}",createTime:'  <span title="{{ item.createTime }}">{{ item.createTime }}</span>',shareId:'  <p>    <span>{{ item.snapshotId }}</span>  </p>  <p>    <span class="text-overflow m-width" title="{{ item.snapshotName }}">{{      item.snapshotName    }}</span>  </p>',shareState:"  <span> {{ item.shareReference }}/50 </span>",shareTime:"  <span>{{ item.timeStartShare }}</span>"},y=(s.SNAPSHOT_REGION_LIST,h.extend({batchDelete:function(){var a=C.grid.getSelected();a.length&&C.exec("delete",a)},clickSnapshotGuide:function(a){i.click("Snapshots.ListPage.Guide.Entry"),window.open(a,"_blank")},clickProjectSelector:function(){i.click("Snapshots.ListPage.Project.Entry")},tab:function(a){this.$set(Object.assign({tab_my_snap:{"class":""},tab_share_snap:{"class":""}},_defineProperty({},"tab_"+a,{"class":"tc-cur"}))),"my_snap"===a?C.grid.refresh():C.shareGrid.refresh(),this.$set({isShowMySnap:"my_snap"===a?!0:!1,isShowShareSnap:"share_snap"===a?!0:!1})}}));y.tag("project-selector",k);var z=l.extend({getNumData:function(){return new Promise(function(a,b){return p.queryUserDiskResources().then(function(b){var c=b&&b.response.resourcesDetailSet;if(c&&c.length){var d=c.map(function(a){for(var b in v.REGIONIDMAP)if(v.REGIONIDMAP[b]==a.region){a.regionId=b;break}return{regionId:a.regionId,value:a.snapshotNumberUsed}}).filter(function(a){return a.regionId});a(d||[])}})})}});y.tag("snapshot-region-num-pill",z);var A=[{name:"ID/名称",key:"snapshotId",required:!0,tdTpl:x.id},{name:"状态",key:"snapshotStatus",tdTpl:x.status},{name:"对应的云硬盘信息",key:"snapshotSize",tdTpl:x.diskInfo},{name:"关联硬盘",key:"storageId",tdTpl:x.disklink},{name:"硬盘挂载实例",key:"instanceId",tdTpl:x.instancelink},{name:"创建时间",key:"createTime",tdTpl:x.createTime},{name:"快照共享状态",key:"shareReference",tdTpl:x.shareState},{name:"保留时间",key:"deadlineDesc",tdTpl:x.deadline},{name:"操作",key:"action",width:240,required:!0,tdTpl:x.actions}];y.tag("snapshot-grid",j.extend(g.getBeeConfig()).extend({$mixins:j.prototype.$mixins.concat([m("snapshot_grid_fields","#appArea [data-grid-setting]")]),events:{"change input[type=checkbox]":function(){C.selectedChange()},"click .snapshot-more-action":function(a){d(".tc-15-menu-active").removeClass("tc-15-menu-active");var b=d(a.target).closest("div");b.hasClass("tc-15-menu-active")?b.removeClass("tc-15-menu-active"):b.addClass("tc-15-menu-active")}},clickSnapshotId:function(a){i.click("Snapshots.ListPage.Item.IDName"),e.navigate(a.snapshotDetailLink)},clickSnapshotDiskId:function(a){i.click("Snapshots.ListPage.Item.RelateDisk"),e.navigate(a.diskLink)},clickSnapshotInstanceId:function(a){i.click("Snapshots.ListPage.Item.RelateCVM"),e.navigate("/cvm/detail/"+a.regionId+"/"+a.instanceId)},rename:function(a){C.exec("rename",a)},rollback:function(a){i.click("Snapshots.ListPage.ItemOp.Rollback"),C.exec("rollback",a)},"delete":function(a){i.click("Snapshots.ListPage.ItemOp.Del"),C.exec("delete",a)},crossRegionCopy:function(a){C.exec("crossRegionCopy",a)},createDisk:function(a){i.click("Snapshots.ListPage.ItemOp.CreateDisk"),C.exec("createDisk",a)},createImage:function(a){C.exec("createImage",a)},shareSnap:function(a){C.exec("shareSnap",a)},getData:function(a){C.queryobj&&C.queryobj.searchKey?C.querySnapshotList(Object.assign({},a,{searchKey:C.queryobj.searchKey})):C.querySnapshotList(a)},backList:function(){C.queryobj.searchKey="",this.listFn({page:1,count:this.count,order:this.order,orderField:this.orderField,searchKey:!1})},setTrAttr:function(a,b){return a={"data-snapshotId":b.snapshotId,"data-diskId":b.diskId}},getSelectItem:function(a){var b=[];return d(C.grid.list).each(function(c,e){d(a).each(function(a,c){var f=d(c).closest("tr").data("snapshotid");e.snapshotId==f&&b.push(e)})}),b}},{defaults:{initGetData:!1,canResizeColum:!1,colums:A,emptyTips:"当前过滤条件下没有相应的快照",searchItemName:"快照",migratingTip:["1、块存储的快照制作，是使用COW(copy on write)、ROW(Redirect-On-Write）的方式实现的，无需关闭实例","2、当快照状态处于“搬迁中”时，说明云硬盘的快照拍摄已完成（元数据捕获、原块设备block已作标记），进入搬迁阶段","3、快照搬迁过程中，不影响云硬盘的正常使用，实例可对硬盘正常使用，可正常覆盖，修改，删除硬盘内文件，不影响快照数据搬迁，不会导致快照文件丢失","4、某云硬盘第一次制作快照时，需要全量搬迁数据，耗时较长。后续的快照为增量备份、差异备份","5、搬迁中，硬盘的IO性能会下降15%"].join("<br>"),urlParams:"",page:1}}));var B=[{name:"ID/名称",key:"snapshotId",required:!0,tdTpl:x.shareId},{name:"状态",key:"snapshotStatus",tdTpl:x.status},{name:"对应的云硬盘信息",key:"snapshotSize",tdTpl:x.diskInfo},{name:"共享时间",key:"shareTime",tdTpl:x.shareTime},{name:"操作",key:"action",width:240,required:!0,tdTpl:x.actions}];y.tag("share-snapshot-grid",j.extend(g.getBeeConfig()).extend({$mixins:j.prototype.$mixins.concat([m("snapshot_grid_fields","#appArea [data-grid-setting]")]),events:{"change input[type=checkbox]":function(){C.selectedChange()},"click .snapshot-more-action":function(a){d(".tc-15-menu-active").removeClass("tc-15-menu-active");var b=d(a.target).closest("div");b.hasClass("tc-15-menu-active")?b.removeClass("tc-15-menu-active"):b.addClass("tc-15-menu-active")}},createDisk:function(a){C.exec("createDisk",a,C.shareGrid)},createImage:function(a){a=a.map(function(a){return Object.assign({},a,{diskId:"-"})}),C.exec("createImage",a,C.shareGrid)},rollback:function(a){C.exec("rollback",a,C.shareGrid)},"delete":function(a){C.exec("delete",a,C.shareGrid)},crossRegionCopy:function(a){C.exec("crossRegionCopy",a,C.shareGrid)},shareSnap:function(a){C.exec("shareSnap",a,C.shareGrid)},setTrAttr:function(a,b){return a={"data-snapshotId":b.snapshotId,"data-diskId":b.diskId}},getData:function(a){C.queryShareSnapshotList(a)},getSelectItem:function(a){var b=[];return d(C.shareGrid.list).each(function(c,e){d(a).each(function(a,c){var f=d(c).closest("tr").data("snapshotid");e.snapshotId==f&&b.push(e)})}),b}},{defaults:{initGetData:!1,canResizeColum:!1,colums:B,emptyTips:"当前地域下没有共享快照",page:1}}));var C={init:function(a,b,c){var i=this;t.snapshotListIns=this;var j=c||{};j.regionId=c?c.regionId||c.rid:f.getRegionId(),j.projectId=c?c.projectId||c.pid:f.getProjectId(),null!=j.projectId&&void 0!=j.projectId&&f.setProjectId(parseInt(j.projectId));var k=this.listBee=new y(x.main,{$data:{isI18n:f.isI18n(),isShowMySnap:!0,isShowShareSnap:!1,tab_my_snap:"",tab_share_snap:""}});this.grid=k.$refs.grid,this.shareGrid=k.$refs.shareGrid,this.projectSelector=k.$refs.ProjectSelector,this.regionSelector=k.$refs.regionNumPill,this.grid.urlParams="?regionId="+j.regionId;var l=!1;this.regionSelector.list.forEach(function(a){a.regionId==j.regionId&&(l=!0)}),l&&this.listBee.$set("regionId",j.regionId),this.loop=null;var m=h.components["qc-search"],n=this.search=new m({$data:{keyword:"",searchEmpty:!0,multiple:!1,placeholder:"支持快照ID、名称搜索"},search:function(){var a=i.search.getKeyword();i.querySnapshotList({searchKey:a,page:1,regionId:i.regionId})}});Promise.all([p.queryWhiteList(),g.isI18n(),p.getProjects()]).then(function(a){var b=i.whiteListMap=a[0],c=a[1];i.projectList=a[2];return i.grid.whiteListMap=b,i.grid.isI18n=i.isI18n=c,i.grid.crossRegionCopyWhite=!!i.whiteListMap.CBS_SS_REGIONCOPY_WL,i.shareGrid.whiteListMap=b,i.shareGrid.isI18n=i.isI18n=c,b.CBS_snapshorts_WHITELIST?(nmc.render(k.$el,"cvm"),i.grid.resize(),i.querySnapshotList(j),i.bindEvents(),void d("#searchArea").html("").append(n.$el)):void e.navigate("/cvm/cbs")})},renderMaxSnapshotInfo:function(a){var b=this;u.queryAccountBalance().then(function(a){b.listBee.$set({noMarginEnough:0>a})}),b.getSnapAbilityInfo(a.regionId).then(function(a){var c=a;b.listBee.$set({showTopMsg:!0,autoSnapshotWhite:!!b.whiteListMap.cbs_auto_snap,diskNum:c.diskNum,snapNum:c.snapNum,ration:c.ration,baseConst:c.baseConst,snapshotLess:c.snapshotLess,maxSnapSize:c.maxSnapSize+" GB",snapshotSizeLess:c.snapshotSizeLess+" GB"})})},getSnapAbilityInfo:function(a){return new Promise(function(b,c){r.checkSnapshotAbility(a).then(function(a){a.diskNum=a.diskNum||0,a.snapNum=a.snapNum||0,a.ration=a.ration||0,a.baseConst=a.baseConst||0,a.maxSnapNum=a.maxSnapNum||0,a.snapshotLess=a.maxSnapNum-a.snapNum,a.snapSize=a.snapSize||0,a.maxSnapSize=a.maxSnapSize||0;var c=a.maxSnapSize-a.snapSize>0?a.maxSnapSize-a.snapSize:0;a.maxSnapSize=Math.round(a.maxSnapSize),a.snapshotSizeLess=0==a.snapSize?a.maxSnapSize:c,b(a)})})},bindEvents:function(){var a=this;this.projectSelector.$on("selected",function(){a.querySnapshotList({projectId:a.projectSelector.selected.projectId}),i.click("Snapshots.ListPage.Project.Switch")}),this.regionSelector.$on("selected",function(){var b=a.regionSelector.selected[0].regionId;a.querySnapshotList({regionId:b}),a.queryShareSnapshotList(),i.click("Snapshots.ListPage.Region."+b)}),d(this.listBee.$refs.deleteButton).click(function(){i.click("Snapshots.ListPage.MainOp.Del")}),d(this.listBee.$refs.setting).click(function(){a.grid.showFieldsManager()}),d(this.listBee.$refs.exports).click(function(){var b=a.grid.list.map(function(a){return a});a.exec("exports",b)}),d(this.listBee.$el).on("click",function(b){var c=d(b.target).closest(".snapshot-more-action");0==c.length&&(d(a.grid.$el).find(".tc-15-menu-active").removeClass("tc-15-menu-active"),d(a.shareGrid.$el).find(".tc-15-menu-active").removeClass("tc-15-menu-active"))}),d(this.listBee.$refs.refresh).click(function(){a.startLoop(!0)})},getQueryParam:function(a){var b=this;a=a||{};var c={},d=a.projectId||a.pid||(b.projectSelector.selected?b.projectSelector.selected.projectId:f.getProjectId()),e=a.regionId||a.rid||(b.regionSelector.selected?b.regionSelector.selected[0].regionId:f.getRegionId()),g=a.page>0?a.page:b.grid.page;b.regionId=e,b.projectId=d,c.limit=a.count>0?a.count:b.grid.count,c.offset=(g-1)*c.limit;var h=[];return a.searchKey&&(/^snap-\w{8}$/.test(a.searchKey)?h.push({name:"snapshot-id",values:[a.searchKey]}):/^disk-\w{8}$/.test(a.searchKey)?h.push({name:"disk-id",values:[a.searchKey]}):h.push({name:"snapshot-name",values:[a.searchKey]})),d>=0&&h.push({name:"project-id",values:[d]}),q.ZONEIDMAP[a.zoneId]&&h.push({name:"zone",values:[q.ZONEIDMAP[a.zoneId]]}),c.filters=h,{data:c,regionId:e,page:g,count:c.limit,searchKey:a.searchKey||void 0}},querySnapshotList:function(a){var b=this,c=a?b.getQueryParam(a):b.queryobj;t.regionId=c.regionId,b.renderMaxSnapshotInfo(c),Promise.all([r.querySnapshots({data:c.data,regionId:c.regionId},{camTips:!1}),new Promise(function(a,b){p.queryZone(c.regionId).then(function(b){a(b)},function(){a([])})})]).then(function(a){if(b.queryobj=c,b.zoneList=a[1]||[],a[0].response&&a[0].response.snapshotSet){var e=r.formatSnapshotList(a[0].response.snapshotSet);b.isDataLoading=e.some(function(a){return a.$loading}),b.checkCopyTask();var f=a[0].response.totalCount;if(e.length>0){var g=[];e.forEach(function(a){a.diskId&&g.push(a.diskId)}),r.getSnapshotDisks(g,c.regionId).then(function(a){if(a.length){var g={};a.forEach(function(a){g[a.diskId]=a}),e.forEach(function(a){a.disk=g[a.diskId],a.diskName=a.disk&&a.disk.diskName}),b.updateSnapshotInstanceInfo(e,a)}b.grid.setData({list:e,totalNum:f,page:c.page,count:c.count,searchKey:c.searchKey}),b.checkSnapshotListOperAuth(e,d(b.grid.$el))})}else b.grid.setData({list:[],totalNum:0,page:1,count:c.count,searchKey:c.searchKey})}else if(b.grid.setData({list:[]}),a[0].errors&&a[0].errors.length)for(var h=0;h<a[0].errors.length;h++){var i=a[0].errors[h];t.showGridTips(i,b.grid);break}},function(a){b.grid.setData({list:[]}),t.showGridTips(a,b.grid)})},queryShareSnapshotList:function(a){var b=this;a=a||{};var c=b.regionSelector.regionId,e=a.count>0?a.count:b.grid.count||20,f=a.page?(a.page-1)*e:(b.grid.page-1)*e||0;r.queryShareSnapshots({regionId:c,data:{limit:e,offset:f}}).then(function(c){if(c.response&&c.response.snapshotSet){var e=r.formatSnapshotList(c.response.snapshotSet);e=e.map(function(a){return Object.assign({},a,{snapshotType:"SHARE"})});var f=c.response.totalCount;b.shareGrid.setData({list:e,totalNum:f,page:a.page,count:a.count}),b.checkSnapshotListOperAuth(e,d(b.shareGrid.$el))}else if(b.shareGrid.setData({list:[],totalNum:0,page:1,count:a.count}),c.errors&&c.errors.length)for(var g=0;g<c.errors.length;g++){var h=c.errors[g];t.showGridTips(h,b.shareGrid);break}},function(a){b.shareGrid.setData({list:[]}),t.showGridTips(a,b.shareGrid)})},updateSnapshotInstanceInfo:function(a,b){var c=this,e=[];b.forEach(function(a){a.instanceId&&e.push(a.instanceId)}),e.length&&r.queryInstances({instanceIds:e,regionId:a[0].regionId,limit:e.length,offset:0}).then(function(b){var e=b.response.instanceSet,f={};e&&e.length&&(e.forEach(function(a){f[a.instanceId]=a}),a.forEach(function(a,b){var e=a.disk&&f[a.disk.instanceId];e&&(a.instance=e,a.instanceId=e.instanceId,a.instanceName=e.instanceName,c.grid.updateItem(b,a),c.checkSnapshotListOperAuth([a],d(c.grid.$el)))}))})},exec:function(a,b){var c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.grid,d=this,e=c.$el;b=b||c.getSelected();var f={projectId:d.projectId,regionId:d.regionId,zoneList:d.zoneList,projectList:d.projectList,whiteListMap:d.whiteListMap,callback:function(){setTimeout(function(){d.startLoop(!0)},1e3)}};a&&w[a]&&(d.checkEventIsDisabled(a,b,e)||w[a].exec(b,f))},checkEventIsDisabled:function(a,b,c){var e=this,f=!1;return f=1==b.length?d(c).find("[data-snapshotid="+b[0].snapshotId+"]").find("[data-name="+a+"]").hasClass("disable"):d(e.listBee.$refs.operArea).find("[data-name="+a+"]").hasClass("disable"),!!f},selectedChange:function(){var a=this.grid.getSelected();this.toggleBtnStatus(a,d("#operArea"))},displayOperMenu:function(a,b){var c=this.grid.getSelectItem(b);this.toggleBtnStatus(c,a)},checkSnapshotListOperAuth:function(a,b){var c=this;a.forEach(function(a){c.toggleBtnStatus([a],d(b).find("tr[data-snapshotid="+a.snapshotId+"]"))})},toggleBtnStatus:function(a,b){var c=Object.keys(w);this.whiteListMap.CBS_SS_REGIONCOPY_WL&&c.push("crossRegionCopy");var e=new n({dataItems:a,operAction:c}),f=e.getAuth();c.forEach(function(a){var c=b.find('[data-name="'+a+'"]');0==f[a].code?d(c).removeClass("disabled").removeClass("disable").attr("data-title",""):d(c).addClass("disable").addClass("disabled").attr("data-title",f[a].tip)})},execContextMenu:function(a,b){C.execRowMenuItem(a,b)},execRowMenuItem:function(a,b){for(var c=d(a).attr("data-index"),e=this.grid,f=0,g=e.list.length;g>f;f++)e.$refs.list[f].$set({$selected:!1});e.$refs.list[c].$set({$selected:!0}),this.selectedChange(),this.exec(b.attr("data-name"))},startLoop:function(a){var b=this,c=a?1:5e3;this.loop&&clearTimeout(this.loop),this.loop=setTimeout(function(){b.querySnapshotList(),b.queryShareSnapshotList()},c)},reportClick:function(a){a&&i.click(a)},stopLoop:function(){clearTimeout(this.loop)},destroy:function(){clearTimeout(this.loop),this.clearCheckTask()},checkCopyTask:function(){var a=this;this.clearCheckTask(),a.isDataLoading&&(a.watingTime=setTimeout(function(){var b=a.grid.getSelected().length;b||f.isContextMenuShow()||o.isMenuActivated(a.grid.list)?a.checkCopyTask():a.grid.refresh()},5e3))},clearCheckTask:function(){clearTimeout(this.watingTime)}};c.exports=C}),define("cvm/snapshot2/overview/components/charge",function(a,b,c){var d=a("appUtil"),e=(a("cvm/common/constants"),a("qccomponent")),f=a("cvm/snapshot2/overview/model"),g={main:'    <div>        <div class="tc-15-msg msg-dot">            <div class="tip-info dot-item">以地域内快照总容量为收费统计维度，每个地域独立统计，每小时进行一次结算。</div>            <div class="tip-info dot-item">一旦您的账户处于欠费状态，快照功能将被停止（创建、回滚等），同时所有存量快照将进入冻结状态，欠费30天后所有快照将自动释放。</div>        </div>        <ul class="form-list">            <li>                <div class="form-label">                    <label for="">地域</label>                </div>                <div class="form-input">                    <div class="form-unit">                        <select class="tc-15-select" b-model="regionId">                            <option b-repeat="item in regionList" title="{{item.regionName}}" value="{{item.regionId}}">{{item.regionName}}</option>                        </select>                    </div>                </div>            </li>            <li class="pure-text-row">                <div class="form-label">                    <label for="">快照总容量</label>                </div>                <div class="form-input">                    <div class="form-unit">                        <p class="form-text">{{snapOverview ? snapOverview.totalSize : \'-\' }}GB</p>                    </div>                </div>            </li>            <li class="pure-text-row">                <div class="form-label">                    <label for="">免费额度</label>                </div>                <div class="form-input">                    <div class="form-unit">                        <p class="form-text">{{snapOverview ? snapOverview.freeQuota: \'-\'}}GB</p>                    </div>                </div>            </li>            <li class="pure-text-row">                <div class="form-label">                    <label for="">按量计费单价</label>                </div>                <div class="form-input">                    <p>{{ toI18nMoney(price ? price.hourPrice : \'-\', \'words\')}}/GB/小时（参考月价格{{toI18nMoney(price ? price.monthPrice : \'-\', \'words\')}}/GB/月）</p>                </div>            </li>            <li>                <div class="form-label">                    <label for="">预计费用</label>                </div>                <div class="form-input">                    <span class="cost"><strong>{{toI18nMoney(price ? price.totalCost : \'-\', \'symbol\')}}/小时</strong></span>                    <p b-if="price.totalCost<0.005" class="text-weak text-vm">当前地域费用低于 0.005 元/小时，将不产生实际费用</p>                </div>            </li>        </ul>    </div>'
},h=e.extend({$tpl:g.main,toI18nMoney:a("widget/i18n").toI18nMoney,$afterInit:function(){this.$watch("regionId",function(){var a=this.regionId||d.getRegionId();this.getData({regionId:a})},!0)},getData:function(a){var b=this;return f.fetchSnapOverview(a.regionId).then(function(c){var d=c.response||{};b.$set("snapOverview",{totalNums:d.totalNums,totalSize:d.totalSize,realTradeSize:d.realTradeSize,freeQuota:d.freeQuota}),f.quirySnapPrice(a.regionId,{SnapSize:d.realTradeSize}).then(function(a){var c=a.response||{};b.$set("price",{hourPrice:c.price,monthPrice:Math.round(24*c.price*30*1e3)/1e3,totalCost:c.totalCost<.005?0:c.totalCost})})["catch"](function(){b.$set("price",null)})})["catch"](function(){b.$set("snapOverview",null)})}});c.exports=h}),define("cvm/snapshot2/overview/components/monitor",function(a,b,c){var d=a("qccomponent"),e=a("appUtil"),f=a("cvm/snapshot2/util"),g=a("lib/monitor-sdk-importer"),h={main:'    <div class="tc-15-data-graph" id="monitorRender">    </div>'},i={namespace:"qce/cbs",metrics:[{metricCName:"快照使用容量",metricName:"snapshot_capacity_usage",dimensions:["appId","region"],unit:"GB"},{metricCName:"快照使用数量",metricName:"snapshot_count_usage",dimensions:["appId","region"],unit:"个"}]},j=d.extend({$tpl:h.main,$afterInit:function(){var a=this;this.$watch("regionId",function(){var b=this.regionId||e.getRegionId();g.ready().then(function(c){var d=$.extend({regionId:b,getData:function(){return new Promise(function(c){c(a.formatData(b))})},isLargeChart:!0},i);c.MonitorDetailBuilder.build(d,document.getElementById("monitorRender"))})},!0)},formatData:function(a){return{instance:{appId:e.getAppId(),region:f.getInternalRegionId(a)}}}});c.exports=j}),define("cvm/snapshot2/overview/components/overview",function(a,b,c){var d=a("appUtil"),e=a("cvm/common/constants"),f=a("qccomponent"),g=a("dialog"),h=a("cvm/snapshot2/constants"),i=a("cvm/snapshot2/overview/model"),j=a("cvm/snapshot2/overview/components/charge"),k={main:'  <div class="tc-panel-bd">  <div class="tc-g tc-overflow-data">          <div class="tc-g-u-6-24 ">            <div class="tc-data-card">              <div class="tc-data-card-hd">                <div class="title">当前地域</div>              </div>              <div class="tc-data-card-bd">                <div class="tc-data-value">                  <span class="tc-data-num">{{regionName}}</span>                </div>              </div>            </div>          </div>          <div class="tc-g-u-6-24 ">            <div class="tc-data-card">              <div class="tc-data-card-hd">                <div class="title">快照总数量</div>              </div>              <div class="tc-data-card-bd">                <div class="tc-data-value">                  <span class="tc-data-num">{{snapOverview ? snapOverview.totalNums : \'-\'}}</span>                </div>              </div>            </div>          </div>          <div class="tc-g-u-6-24 ">            <div class="tc-data-card">              <div class="tc-data-card-hd">                <div class="title">快照总容量</div>              </div>              <div class="tc-data-card-bd">                <div class="tc-data-value">                  <span class="tc-data-num">{{snapOverview ? snapOverview.totalSize: \'-\'}}</span>                  <span class="tc-data-unit">GB</span>                </div>                <div class="tc-data-info">                  <div class="item">                    <a href="javascript:;" b-on="{click: clickHandler.bind(this)}">预估快照费用</a>                  </div>                </div>              </div>            </div>          </div>          <div class="tc-g-u-6-24">            <div class="tc-data-card">              <div class="tc-data-card-hd">                <div class="title">免费额度                    <div class="tc-15-bubble-icon">                        <i class="tc-icon icon-what"></i>                        <div class="tc-15-bubble tc-15-bubble-top">                            <div class="tc-15-bubble-inner">                            <p>当前地域赠送的免费额度，详细请<a href="//cloud.tencent.com/document/product/362/17935" target="_blank" class="tc-external-link-btn">查看快照计费说明</a></p>                            </div>                        </div>                    </div>                </div>              </div>              <div class="tc-data-card-bd">                <div class="tc-data-value">                  <span class="tc-data-num">{{snapOverview ? snapOverview.freeQuota: \'-\'}}</span>                  <span class="tc-data-unit">GB</span>                </div>              </div>            </div>          </div>        </div>      </div>'},l=f.extend({$tpl:k.main,$afterInit:function(){this.$watch("regionId",function(){var a=this.regionId||d.getRegionId();this.$set("regionName",e.REGIONNAMES[a]),this.getData({regionId:a})},!0)},clickHandler:function(){var a=h.SNAPSHOT_REGION_LIST||[],b=a.map(function(a){return{regionId:a,regionName:e.REGIONNAMES[a]||""}}),c=new j({$data:{regionList:b,regionId:this.regionId}});g.create(c.$el,560,"",{title:"预估快照费用",defaultCancelBtn:!1,button:{" 我知道了 ":function(){g.defaultCancel()}}})},getData:function(a){var b=this;return i.fetchSnapOverview(a.regionId).then(function(a){var c=a.response||{};b.$set("snapOverview",{totalNums:c.totalNums,totalSize:c.totalSize,realTradeSize:c.realTradeSize,freeQuota:c.freeQuota})})["catch"](function(){b.$set("snapOverview",null)})}});c.exports=l}),define("cvm/snapshot2/overview/model",function(a,b,c){var d=seajs.require("models/iaas");b.fetchSnapOverview=function(a,b){return d.apiRequest({serviceType:"cbs",cmd:"GetSnapOverview",regionId:a},Object.assign({v3:!0},b||{}))},b.quirySnapPrice=function(a,b,c){return d.apiRequest({serviceType:"cbs",cmd:"InquiryPriceSnapshots",regionId:a,data:b},Object.assign({v3:!0},c||{}))}}),define("cvm/snapshot2/overview/overview",function(a,b,c){var d=a("qccomponent"),e=a("cvm/common/components/regionPills"),f=a("appUtil"),g=a("cvm/snapshot2/constants"),h=a("cvm/snapshot2/overview/components/overview"),i=a("cvm/snapshot2/overview/components/monitor"),j=e.extend({whiteList:g.SNAPSHOT_REGION_LIST}),k={main:'   <div class="manage-area">        <div class="manage-area-title">            <h2>快照</h2>        </div>        <div class="manage-area-main">          <div class="mb-10">            <region-pill b-ref="regionPill" b-model="regionId" short="{{true}}" global="{{true}}" reset="{{true}}"></region-pill>          </div>          <div class="tc-15-msg">            <div class="tip-info">              <strong>数据保护：</strong>对重要业务做快照可以应对误操作、攻击或病毒等导致的数据丢失风险，也可将在业务升级、业务迁移等重大操作过程中出现问题的业务及时恢复至历史正常状态。<br>              <strong>灵活管理：</strong>推荐使用定期快照，针对不同业务类型制定不同的策略。您可指定云硬盘关联到定期快照策略，周期性地定时创建、删除快照，更方便地保护您的数据安全。<br>              <strong>节约成本：</strong>腾讯云快照采用增量快照机制，除首个快照为全量快照外，后续快照仅保存前一次快照后更改过的数据，最大限度地减少连续制作快照时的占据存储空间总容量，减少您的开销。<br>            </div>          </div>            <div class="manage-area-full-inner">                <div class="tc-panel">                  <overview b-ref="overview" region-id="{{regionId}}"/>                </div>                <div class="tc-panel">                    <div class="tc-panel-hd">                        <div class="col col-left">                            <h3 class="title">快照容量监控</h3>                        </div>                    </div>                    <div class="tc-panel-bd">                        <monitor b-ref="monitor" region-id="{{regionId}}">                    </div>                </div>            </div>        </div>    </div>'},l=d.extend({$tpl:k.main,$data:{isI18n:f.isI18n()}});l.tag("region-pill",j),l.tag("overview",h),l.tag("monitor",i),c.exports={title:"快照-控制台",init:function(a,b,c){var d=c?c.regionId||c.rid:f.getRegionId(),e=new l({$data:{regionId:d}});this.regionSelector=e.$refs.regionPill,this.overview=e.$refs.overview,this.monitor=e.$refs.monitor,nmc.render(e.$el,"cvm"),this.bindEvents()},bindEvents:function(){var a=this;this.regionSelector.$on("selected",function(){var b=a.regionSelector&&a.regionSelector.selected[0],c=b&&b.regionId;a.overview.$set({regionId:c}),a.monitor.$set({regionId:c})})},destroy:function(){this.overview.destroy&&this.overview.destroy()}}}),define("cvm/snapshot2/selectedShow/selectedShow",function(a,b,c){var d=a("qccomponent"),e=d.extend({$tpl:'  <div class="act-outline">    <div class="act-summary">      您已选 <strong>{{ list.length }}个{{ resourceTypeName }}</strong      >，      <a href="javascript:;" b-on-click="toggleShowDetail()"        >查看详情        <i class="blue-down-icon" b-if="isShowDetail"></i>        <i class="blue-up-icon" b-if="!isShowDetail"></i>      </a>    </div>    <div b-if="isShowDetail">      <style>        .dev-bold {          font-weight: bold;        }        .dev-title-col {          margin-bottom: 0px !important;          border-bottom: none !important;        }        .dev-content-col {          margin-top: 0px !important;        }      </style>      <div class="act-details dev-title-col">        <table class="act-details-tb">          <tbody b-if="resourceTypeValue == \'snapshot\'">            <tr>              <td>No.</td>              <td>                <span class="entity-name dev-bold">快照名称</span>              </td>              <td>                <span class="entity-name dev-bold">快照ID</span>              </td>              <td>                <span class="entity-name dev-bold">关联硬盘</span>              </td>              <!-- <td>                <span class="entity-name dev-bold">操作</span>              </td> -->            </tr>          </tbody>          <tbody b-if="resourceTypeValue == \'autoSnapshotPolicy\'">            <tr>              <td>No.</td>              <td>                <span class="entity-name dev-bold">快照策略名称</span>              </td>              <td>                <span class="entity-name dev-bold">快照策略ID</span>              </td>              <td>                <span class="entity-name dev-bold">关联硬盘数量</span>              </td>              <!-- <td>                <span class="entity-name dev-bold">操作</span>              </td> -->            </tr>          </tbody>          <tbody b-if="resourceTypeValue == \'disk\'">            <tr>              <td>No.</td>              <td>                <span class="entity-name dev-bold">硬盘名称</span>              </td>              <td>                <span class="entity-name dev-bold">硬盘ID</span>              </td>              <td>                <span class="entity-name dev-bold">硬盘类型</span>              </td>              <td>                <span class="entity-name dev-bold">硬盘属性</span>              </td>              <!-- <td>                <span class="entity-name dev-bold">操作</span>              </td> -->            </tr>          </tbody>        </table>      </div>      <div class="act-details dev-content-col">        <table class="act-details-tb">          <tbody b-if="resourceTypeValue == \'disk\'">            <tr b-repeat="item in list">              <td>{{ $index + 1 }}</td>              <td>                <span class="entity-name" title="{{ item.diskName }}">                  {{ item.diskName }}                </span>              </td>              <td>                <span class="entity-name" title="{{ item.diskId }}">                  {{ item.diskId }}                </span>              </td>              <td>                <span class="entity-name" title="{{ item.diskTypeDesc }}">                  {{ item.diskTypeDesc }}</span                >              </td>              <td>                <span class="entity-name" title="{{ item.diskUsageDesc }}">                  {{ item.diskUsageDesc }}</span                >              </td>              <!-- <td>                <span class="entity-name">可{{eventName}}</span>              </td> -->            </tr>          </tbody>          <tbody b-if="resourceTypeValue == \'autoSnapshotPolicy\'">            <tr b-repeat="item in list">              <td>{{ $index + 1 }}</td>              <td>                <span                  class="entity-name"                  title="{{ item.autoSnapshotPolicyName }}"                >                  {{ item.autoSnapshotPolicyName }}                </span>              </td>              <td>                <span                  class="entity-name"                  title="{{ item.autoSnapshotPolicyName }}"                >                  {{ item.autoSnapshotPolicyId }}                </span>              </td>              <td>                <span class="entity-name" title="{{ item.diskNumber }}">                  {{ item.diskNumber }} 个</span                >              </td>              <!-- <td>                <span class="entity-name">可{{eventName}}</span>              </td> -->            </tr>          </tbody>          <tbody b-if="resourceTypeValue == \'snapshot\'">            <tr b-repeat="item in list">              <td>{{ $index + 1 }}</td>              <td>                <span class="entity-name" title="{{ item.snapshotName }}">                  {{ item.snapshotName }}                </span>              </td>              <td>                <span class="entity-name" title="{{ item.snapshotId }}">                  {{ item.snapshotId }}                </span>              </td>              <td>                <span class="entity-name">                  <a                    b-if="item.disk"                    href="{{ item.diskLink }}"                    target="_blank"                    title="{{ item.diskId }}"                  >                    {{ item.diskId }}</a                  >                  <span b-if="!item.disk" title="{{ item.diskId }}">                    {{ item.diskId }}</span                  >                  <span                    class="text-overflow"                    b-if="item.diskName"                    title="{{ item.diskName }}"                  >                    / {{ item.diskName }}                  </span>                </span>              </td>              <!-- <td>                <span class="entity-name">可{{eventName}}</span>              </td> -->            </tr>          </tbody>        </table>      </div>    </div>  </div>',$afterInit:function(){},toggleShowDetail:function(){this.$set("isShowDetail",!this.isShowDetail)}},{defaults:{resourceTypeName:"快照",resourceTypeValue:"snapshot",list:[],eventName:"操作",isShowDetail:!0}});d.tag("snapshot-selected-show",e),c.exports=e}),define("cvm/snapshot2/util",function(a,b,c){var d=a("widget/errorTips/errorTips"),e=a("nmcConfig"),f=a("tips"),g=a("dialog"),h=a("cvm/snapshot2/data"),i=a("cvm/common/constants");c.exports={showGridTips:function(a,b){d.isCamRefused(a)?b.showTips("<div><cam-tips>"+a.message+"</cam-tips></div>"):a.message?b.showTips("<div><error-tips>"+a.message+"</error-tips></div>"):f.error(e.defaultReqErr)},createDialog:function(a,b,c,d){g.create(a,c,"",{title:b,preventResubmit:!0,defaultCancelCb:function(){},button:{" 确定 ":function(){d()}}})},getDays:function(a){a=a||[];var b=[];for(var c in h.DAY_MAP)h.DAY_MAP.hasOwnProperty(c)&&b.push({value:c,text:"每周"+h.DAY_MAP[c],selected:a.indexOf(Number(c))>-1});return b},getHours:function(a){a=a||[];for(var b=[],c=0;24>c;c++){var d=(10>c?"0"+c:c)+":00";b.push({value:c,text:d,selected:a.indexOf(c)>-1})}return b},getInternalRegionId:function(a){return i.REGIONMAP[a]}}}),define("cvm/sshkey/data",function(a,b,c){var d=(a("$"),a("appUtil")),e=(a("models/api"),a("manager"),a("cvm/common/model")),f=a("cvm/cvm/cvmutil");c.exports={queryKeyPairs:function(a,b){var c="query queryKeyPairs ($filters: [Filter], $keyIds: [String], $limit: Int, $offset: Int) {\n                keyPairs (filters: $filters,keyIds: $keyIds,limit: $limit, offset: $offset) {\n                    totalCount\n                    nodes {\n                        id\n                        name: key_name\n                        description\n                        publicKey\n                        associatedInstanceIds\n                        associatedInstanceCount\n                        associatedImageCount\n                        createTime\n                    }\n                }\n            }";return e.graphql({query:a.query||c,variables:{filters:a.filters,keyIds:a.keyIds,limit:a.limit||20,offset:a.offset||0},regionId:a.regionId},b)},importKeyPair:function(a){return e.apiRequest({action:"ImportKeyPair",serviceType:"cvm",data:a,regionId:d.getRegionId()})},createKeyPair:function(a,b){return e.apiRequest({action:"CreateKeyPair",serviceType:"cvm",data:a,regionId:d.getRegionId()},b)},modifyKeyPair:function(a,b){return e.apiRequest({action:"ModifyKeyPairAttribute",serviceType:"cvm",data:a,regionId:d.getRegionId()},b)},deleteKeyPair:function(a,b){return e.apiRequest({action:"DeleteKeyPairs",serviceType:"cvm",data:a,regionId:d.getRegionId()},b)},associateInstances:function(a,b){var c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:d.getRegionId();return e.apiRequest({action:"AssociateInstancesKeyPairs",serviceType:"cvm",data:a,regionId:c},b)},disassociateInstances:function(a,b){var c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:d.getRegionId();return e.apiRequest({action:"DisassociateInstancesKeyPairs",serviceType:"cvm",data:a,regionId:c},b)},formatKeyList:function(a){return a=a.map(function(a){var b=f.createMapAttr(a,a);return b("netName",["vpc","vpcName"],"基础网络"),a.statusDesc=d.getRunFlagDesc(a.instanceStatus.runFlag),a.isWindows=f.isWindows(a.osName),a.deviceLanIp=a.privateIpAddresses&&a.privateIpAddresses[0]||"-",(f.isWindows(a.osName)||!f.isStopped(a.instanceStatus.instanceState))&&(a.disabled=!0,a.$disable=!0),a})}}}),define("cvm/sshkey/detail",function(a,b,c){var d=a("$"),e=(a("manager"),a("appUtil")),f=a("util"),g=a("qccomponent"),h=a("dialog"),i=(a("dataManager"),a("pageManager")),j=a("cvm/sshkey/data"),k=a("cvm/cvm/data"),l=g.getComponent("grid-view"),m=a("cvm/sshkey/oper"),n=(a("cvm/cvm/cvmutil"),a("widget/pills/pills")),k=a("cvm/cvm/data"),o=a("cvm/common/common"),p={main:'  <style type="text/css">    .tc-15-table-rowhover tr.disable td a.id-link {      color: #0071ce;      cursor: pointer;    }  </style>  <div class="manage-area" id="sshDetailWrap">    <div class="manage-area-title secondary-title">      <a href="javascript:history.go(-1);" class="back-link">        <i class="btn-back-icon"></i>返回</a>      <span class="line-icon">|</span>      <h2>        <%= data.id %>(          <span class="ellipsis cvm-entry-name">            <%= data.name %>          </span>)</h2>    </div>    <div class="manage-area-main secondary-main">      <div class="manage-area-full-inner">        <div class="ssh-param">          <div class="param-box">            <div class="param-hd">              <h3>SSH密钥信息</h3>            </div>            <div class="param-bd">              <ul class="item-descr-list">                <li>                  <span class="item-descr-tit">名称</span>                  <span class="item-descr-txt">                    <%= data.name %>                  </span>                </li>                <li>                  <span class="item-descr-tit">密钥ID</span>                  <span class="item-descr-txt">                    <%= data.id %>                  </span>                </li>                <li>                  <span class="item-descr-tit">密钥描述</span>                  <span class="item-descr-txt">                    <%= data.description %>                  </span>                </li>                <li>                  <span class="item-descr-tit">公钥内容</span>                  <span class="item-descr-txt">                    <%= data.publicKey %>                  </span>                </li>                <li>                  <span class="item-descr-tit">创建时间</span>                  <span class="item-descr-txt">                    <%= data.createTime %>                  </span>                </li>              </ul>            </div>          </div>          <div class="param-box">            <div class="param-hd">              <h3>已绑定实例</h3>            </div>            <div class="param-bd">              <!-- <qc-tabs class-name="s"></qc-tabs> -->              <div class="cvm-area-wrap" role="radiogroup" id="regionGroup" style="margin-bottom: 15px"></div>              <div>                <div class="d-tb assign-status-row">                  <div class="d-tbc">                    <button disabled="disabled" data-multiunlink class="tc-15-btn disabled m">批量解绑</button>                  </div>                  <div class="d-tbc right-cell">                    <span class="assign-status">已绑定实例&nbsp;                      <strong></strong>&nbsp;台</span>                  </div>                </div>              </div>              <div id="bindCvmList" class=""></div>            </div>          </div>        </div>      </div>    </div>  </div>',action:'  <div>    <div class="d-tb assign-status-row">      <div class="d-tbc">        <button disabled="disabled" data-multiunlink class="tc-15-btn disabled m">批量解绑</button>      </div>      <div class="d-tbc right-cell">        <span class="assign-status">已绑定实例&nbsp;          <strong></strong>&nbsp;台</span>      </div>    </div>  </div>'},q={render:function(a){if(!a)return this.renderDetailNoData();i.appArea.html("");var b=this;b.keyId=a,Promise.all([b.getSshKeyData(a),k.getValidRegions()]).then(function(a){a[0]&&a[0].keyPairs&&a[0].keyPairs.totalCount>0?(b.regionData=a[1],b.renderUi(a[0].keyPairs.nodes[0])):b.renderDetailNoData()})["catch"](function(){b.renderDetailNoData()})},getSshKeyData:function(a,b){return j.queryKeyPairs({keyIds:[a],regionId:b||e.getRegionId()})},renderBtnGroup:function(a){var b=this,c=e.getRegionId();b.regionId=c,b.regionPills=new n({renderTo:d("#regionGroup"),data:b.regionData.regionList,newMode:!0,change:function(c){var d=b.regionPills.val();b.regionId=d,b.refresh(b.gridView,a.id)}}),b.regionPills.val(b.regionId)},renderUi:function(a){var b,c=this;a.createTime=e.formatDate(new Date(a.createTime),"yyyy-MM-dd hh:mm:ss"),i.appArea.html(f.tmpl(p.main,{data:a})),b=d("#sshDetailWrap"),b.on("click","button[data-multiunlink]",function(){var b=d(this);if(!b.hasClass("disabled")){var e=c.gridView;h.create('<h3 class="til">确定要解绑选中的实例?</h3>',480,"",{title:"解绑实例",button:{" 确定 ":function(){e.unLink(e.getSelected(),a.id),h.hide()}}})}}),c.bindCvmListEl=d("#bindCvmList"),c.renderBtnGroup(a),c.initGrid(c,{keyId:a.id}),c.refresh(c.gridView,a.id),b.find(".assign-status strong").text(a.associatedInstanceIds.length)},renderDetailNoData:function(){o.renderDetailNoData("SSH密钥","/cvm/sshkey")},refresh:function(a,b){var c=this,e=c.regionId;c.getSshKeyData(b,c.regionId).then(function(b){if(e==c.regionId){if(b&&b.keyPairs&&b.keyPairs.totalCount>0){var f=b.keyPairs.nodes[0];f.associatedInstanceIds=f.associatedInstanceIds.filter(function(a){return""!=a}),a.associatedInstanceIds=f.associatedInstanceIds,a.getData({page:1,regionId:c.regionId,associatedInstanceIds:f.associatedInstanceIds}).done(function(){a.loaded=!0})}else o.renderDetailNoData("SSH密钥","/cvm/sshkey");d("#sshDetailWrap").find(".assign-status strong").text(f.associatedInstanceIds.length)}})},initGrid:function(a,b){this.gridView=new l({$data:{keyId:b.keyId,maxHeightOffset:2,colums:[{name:"实例ID",key:"uInstanceId"},{name:"实例名称",key:"alias"},{name:"状态",key:"statusDesc",width:100},{name:"所属网络",key:"netName"},{name:"内网IP",key:"deviceLanIp"},{name:"操作",key:"_action",width:"100",cellTemplate:'<a href="javascript:;" data-title="{{item.$disable ? \'关机状态才可解绑密钥\' : \'\'}}" b-on="{click: getunLink([item], keyId)}">解绑</a>'}]},unLink:function(b,c){var d=this,e=[];b.forEach(function(a){var b=d.list.indexOf(a);d.updateItem(b,{$loading:!0,$selected:!1,$disable:!0,statusDesc:"解绑中..."}),e.push(a.uInstanceId)}),m.sendBindServerReq({keyId:c,unbindList:e},d.$get("regionId")).always(function(){a.refresh(d,c)})},events:{"change .tc-15-first-checkbox> input.tc-15-checkbox":function(){var a=this.getSelected(),b=d("button[data-multiunlink]");a.length?b.removeAttr("disabled").removeClass("disabled"):b.attr("disabled","disabled").addClass("disabled")}},getunLink:function(a,b){var c=this;return function(e){if(!this.$get("item.$disable")){var f=d(e.target),h=f.data("qcPopover")||new(g.getComponent("popup-confirm"))({handler:e.target,box:c.$gridBody[0],$data:{title:"确定解绑该密钥？",style:"width: 185px"},onConfirm:function(){c.unLink(a,b)}});h.show()}}},getData:function(a){var b=d.Deferred(),c=this,f=a.regionId||e.getRegionId();return c.associatedInstanceIds=a.associatedInstanceIds?a.associatedInstanceIds:c.associatedInstanceIds,c.associatedInstanceIds&&c.associatedInstanceIds.length?k.queryCvmList({query:"query instances ($filters: [Filter], $limit: Int, $offset: Int, $ipAddresses: [String], $innerSubnetIds: [String], $innerVpcIds: [String], $vagueIpAddress: String, $vagueInstanceName: String){\n                            instances(filters: $filters, limit: $limit, offset: $offset, ipAddresses: $ipAddresses, vagueIpAddress: $vagueIpAddress, innerSubnetIds: $innerSubnetIds, innerVpcIds: $innerVpcIds, vagueInstanceName: $vagueInstanceName) {\n                                totalNum: totalCount\n                                deviceList: nodes{\n                                    uInstanceId:id\n                                    alias:name\n                                    instanceStatus {\n                                        instanceState\n                                        operationMask\n                                        runFlag\n                                        hypervisor\n                                    }\n                                    instanceTypeDesc\n                                    osName\n                                    privateIpAddresses\n                                    vpc{\n                                        unVpcId: id\n                                        vpcName: name\n                                        cidrBlock: cidr\n                                    }\n                                    subnet{\n                                        subnetId: id\n                                        subnetName: name\n                                    }\n                                }\n                            }\n                        }",filters:[{name:"instance-id",values:c.associatedInstanceIds}],regionId:f,limit:a.count||20,offset:(a.page-1)*a.count}).then(function(a){if(a&&a.instances&&a.instances.deviceList){var b=j.formatKeyList(a.instances.deviceList);c.setData({totalNum:a.instances.totalNum,list:b,regionId:f})}else c.setData({totalNum:0,list:[],regionId:f})},function(a){c.setData({totalNum:0,list:[],regionId:f})}):c.setData({totalNum:0,list:[],regionId:f}),b.promise()},getCellContent:function(a,b,c){return"uInstanceId"==c.key?'<a class="id-link" data-event="nav" href="/cvm/detail/'+this.$get("regionId")+'/{{item.uInstanceId}}">{{item.uInstanceId}}</a>':c.cellTemplate}}),this.bindCvmListEl.append(this.gridView.$el)},destroy:function(){}};c.exports=q}),define("cvm/sshkey/oper",function(a,b,c){var d=a("$"),e=a("event"),f=a("tips"),g=a("util"),h=a("appUtil"),i=a("dialog"),j=(a("manager"),a("validator")),k=(a("regionSelector"),a("contextmenu"),a("reporter"),a("cvm/common/model"),a("cvm/sshkey/data")),l=a("cvm/cvm/data"),m=(a("cvm/cvm/cvmutil"),a("widget/errorTips/errorTips"),a("qccomponent"));a("widget/cvmList/cvmList");a("widget/region/regionSelector");var n={create:'  <div class="edit_form_wrap">    <ul class="edit_psword">      <li>        <label class="txt" for="">创建方式:</label>        <div class="mode">          <input type="radio" id="rdio-c-ssh-type1" class="radio" name="ssh_create_type" value="create" checked/>          <label for="rdio-c-ssh-type1">创建新密钥对</label>          <input type="radio" id="rdio-c-ssh-type2" class="radio" name="ssh_create_type" value="import" />          <label for="rdio-c-ssh-type2">使用已有公钥</label>        </div>      </li>      <li>        <label class="txt" for="">密钥名称:</label>        <input type="text" class="txt_input">        <p class="tip">只支持英文大小写、数字和下划线</p>      </li>      <!--<li>                <label class="txt" for="">密钥描述:</label>                <textarea class="textarea"></textarea>            </li>-->      <li class="public-key-input" style="display:none">        <label class="txt" for="">输入公钥:</label>        <textarea style="width:345px" class="textarea" placeholder="格式：ssh-rsa AAAKedvs...."></textarea>      </li>    </ul>  </div>',modify:'  <div class="edit_form_wrap">    <ul class="edit_psword">      <li>        <label class="txt" for="">密钥名称:</label>        <input type="text" class="txt_input" value="<%= keyName %>">        <p class="tip">只支持英文大小写、数字和下划线</p>      </li>      <li>        <label class="txt" for="">密钥描述:</label>        <textarea class="textarea" style="width:345px" value="<%= keyDesc %>"><%= keyDesc %></textarea>      </li>    </ul>  </div>',download:'  <div>    我们不会保管您的私钥信息，请您在10分钟内点击"下载"按钮获取私钥  </div>',del:'  <div class="act-outline" id="selectedShowWrap">    <div class="act-summary">您已选      <strong>        <%=detailList.length%>个密钥</strong>，      <% if (errorCnt > 0) {%>其中        <strong>          <%=errorCnt%>个密钥</strong>不能执行删除操作，        <% }%>          <a href="javascript:;" id="viewDetail">查看详情            <i id="arrowIcon" class="icon-arrow-down"></i>          </a>    </div>    <div class="act-details" id="selectedShowDetail">      <table class="act-details-tb">        <tbody>          <% for (var i = 0, item; item = detailList[i]; i++) { %>            <tr>              <td>                <%=i+1%>              </td>              <td>                <span class="entity-name" style="width:12em;" title="<%=item.name%>">                  <%=item.name%>                </span>                <span <% if (item.status==1 ) { %> style="color:red;"                  <% } %>>                    <%=item.statusDesc%>                </span>              </td>            </tr>            <% } %>        </tbody>      </table>    </div>  </div>  <strong class="tit" id="deleteConfirm" style="font-size:1.2em;">确定对选中密钥进行删除?</strong>',bindServer:'  <div>    <div id="bindServerWrapper">      <div class="tc-15-mod-selector-area">        <h4 class="run-in">选择地域</h4>        <region-selector b-model="regionId"></region-selector>      </div>    </div>    <device-selector init-get-data="{{false}}" scroll-pager="true" multiple-search="true" list-tpl="{{listTpl}}" selected-tpl="{{selectedTpl}}"      b-ref="ds" title="选择实例" device-name="实例" get-data="{{getData}}"></device-selector>  </div>',cvmItem:'  <% for ( var ip in data ) { isWindows = data[ip].osType === "windows"; isVpc = data[ip].vpcId > 0; %>    <% if (!isVpc) { %>      <li class="cvm-item <% if (isWindows) { %> disabled <%  } %>">        <input type="checkbox" class="tc-15-checkbox" data-ip="<%- ip %>" value="<%- data[ip].uuid %>" <% if (isWindows) { %> disabled        <%  } %>>          <label for="">            <%= data[ip].alias %> (              <%= ip %>)                <% if (isWindows) { %> 不支持windows                  <% } %>          </label>      </li>      <% } %>        <% } %>',listTpl:'  <input type="checkbox" disabled?="item.disabled" class="tc-15-checkbox" b-model="item.selected">  <span class="opt-txt">    <span class="opt-txt-inner">      <span class="item-name" style="max-width: 16em;">{{item[alias.name]}}</span>      <span class="item-descr" style="max-width: 16em;float:left">{{item[alias.network]}} | {{item[alias.ip]}}</span>    </span>    <span b-if="item.disabled" class="right-text">      {{item.isWindows ? \'暂不支持Windows\' : \'关机状态才可加载\'}}    </span>  </span>',selectedTpl:'  <span class="opt-txt">    <span class="opt-txt-inner">      <span class="item-name">{{item[alias.name]}}</span>      <span class="item-descr">{{item[alias.network]}} | {{item[alias.ip]}}</span>    </span>    <span b-if="item.disabled" class="right-text">      关机状态才可解绑    </span>  </span>  <a role="button" class="opt-act" href="javascript:;" b-if="!item.disabled">    <i b-on="{click: _delSelected}" class="icon-del">取消</i>  </a>'
},o=/^[\da-zA-Z\_]{1,25}$/,p={init:function(a){this.listMod=a,this.bindEvent(),this.selectedIds=[],this.selectedItems=[]},reset:function(){this.selectedIds=[]},bindEvent:function(){var a=this,b=this.listMod,c=b.sshListEl,f=b.operAreaEl;d(b.gridView.$el).on("change","input:checkbox",function(){a.selectedIds=b.gridView.getSelected().map(function(a){return a.id}),a.selectedItems=b.gridView.getSelected().map(function(a){return a});var c=a.selectedItems.length;switch(c){case 0:d("button[data-event='ssh_modify']").addClass("disabled").prop("disabled",!0),d("button[data-event='ssh_bind_server']").addClass("disabled").prop("disabled",!0),d("button[data-event='ssh_del']").addClass("disabled").prop("disabled",!0);break;case 1:d("button[data-event='ssh_modify']").removeClass("disabled").prop("disabled",!1),d("button[data-event='ssh_bind_server']").removeClass("disabled").prop("disabled",!1),d("button[data-event='ssh_del']").removeClass("disabled").prop("disabled",!1);break;default:d("button[data-event='ssh_modify']").addClass("disabled").prop("disabled",!0),d("button[data-event='ssh_bind_server']").addClass("disabled").prop("disabled",!0),d("button[data-event='ssh_del']").removeClass("disabled").prop("disabled",!1)}}),e.bindCommonEvent(f[0],"click",{ssh_add:function(){a.create()},ssh_bind_server:function(){a.bindServer()},ssh_modify:function(){a.modify()},ssh_del:function(){a.del()}}),e.bindCommonEvent(c[0],"click",{ssh_add:function(){a.create()}})},errTip:function(a,b){var c={tip:a};return j.showErr(b,c)},create:function(){var a=this;i.create(n.create,"540","",{title:"创建SSH密钥",preventResubmit:!0,isMaskClickHide:!1,button:{" 确定 ":function(){g()}}});var b=i.el.find('input[type="text"]').eq(0),c=i.el.find('input[name="ssh_create_type"]'),e=i.el.find(".public-key-input"),f=e.find("textarea");c.change(function(){var a=c.filter(":checked");"import"===a.val()?e.show():e.hide()});var g=function(){var e=d.trim(b.val()),g=c.filter(":checked").val(),h=d.trim(f.val()),j=a.listMod&&a.listMod.listData||[],k=!1;return""===e?a.errTip("请输入密钥名称",b):e.length>25?a.errTip("密钥名称不能超过25个字符",b):o.test(e)?"import"===g&&""===h?a.errTip("请输入公钥",f):(j.forEach(function(a){a.name==e&&(k=!0)}),k?a.errTip("密钥名称已存在",b):void("import"===g?a.sendImportReq(e,h):i.create(n.download,"500","",{title:"SSH密钥对已创建",preventResubmit:!0,button:{" 下载 ":function(){a.sendCreateReq(e)}}}))):a.errTip("密钥名称不符合规则",b)}},sendCreateReq:function(a){var b=this,c=Math.max(h.getProjectId(!0),0);k.createKeyPair({KeyName:a,ProjectId:c},{camTipsType:"dialog"}).then(function(c){f.success("创建密钥成功"),b.refreshList(function(){b.downLoadKey(a,c.response.keyPair.privateKey)})},function(a){i.toggleBtnDisable()})},downLoadKey:function(a,b){var c={t:(new Date).getTime(),uin:g.getUin(),csrfCode:g.getACSRFToken()},d="//"+window.QCBASE_HOST+"/cgi/sshkey?action=downloadKeypair&"+g.objectToParams(c);h.submitForm(d,{keyName:a,secretKey:b})},sendImportReq:function(a,b){var c=this;k.importKeyPair({KeyName:a,ProjectId:h.getProjectId(!0),PublicKey:b}).then(function(a){f.success("导入密钥成功"),c.refreshList()},function(a){i.toggleBtnDisable()})},refreshList:function(a){i.hide(),this.listMod.renderList(1,void 0,function(){a&&a()})},modify:function(){var a=this;if(0==this.selectedIds.length)return f.error("请选择一个密钥"),!1;if(this.selectedIds.length>1)return f.error("请选择单个密钥"),!1;var b=this.selectedItems[0];i.create(g.tmpl(n.modify,{keyName:b.name,keyDesc:b.description}),"516","",{title:"修改密钥",preventResubmit:!0,button:{" 确定 ":function(){c()}}});var c=function(){var c=i.el.find('input[type="text"]').eq(0),e=i.el.find("textarea"),f=d.trim(c.val()),g=d.trim(e.val());return""===f?a.errTip("请输入密钥名称",c):f.length>25?a.errTip("密钥名称不能超过25个字符",c):o.test(f)?g&&g.length>60?a.errTip("描述长度不能超过60个字符",e):void a.modifyReq(b.id,f,g):a.errTip("密钥名称不符合规则",c)}},modifyReq:function(a,b,c){var d=this,e={KeyId:a,KeyName:b,Description:c};k.modifyKeyPair(e,{camTipsType:"dialog"}).then(function(a){f.success("修改密钥成功"),d.refreshList()})},del:function(){var a=this;if(!this.selectedIds.length)return f.error("请选择密钥"),!1;for(var b,c=[],e=[],h="可删除",j="未绑定实例或自定义镜像的密钥才可删除",l=0,m=0;b=this.selectedIds[m];m++){var o=this.listMod.getCurData(b),p={id:b,name:o.name,statusDesc:h};0==o.bind_count&&0==o.image_count?e.push(b):(l++,p.status=1,p.statusDesc=j),c.push(p)}var q=g.tmpl(n.del,{detailList:c,errorCnt:l});i.create(q,"580","",{title:"删除密钥","class":"dialog_layer_v2",preventResubmit:!0,button:{" 确定 ":function(){k.deleteKeyPair({KeyIds:e},{camTipsType:"dialog"}).then(function(b){f.success("删除密钥成功"),a.refreshList()})}}}),0==e.length&&(i.getBtn(0).hide(),d("#deleteConfirm").hide());var r=d("#selectedShowDetail");d("#viewDetail").on("click",function(){r.toggle(),r.is(":visible")?d("#arrowIcon").removeClass("icon-arrow-down").addClass("icon-arrow-up"):d("#arrowIcon").removeClass("icon-arrow-up").addClass("icon-arrow-down"),i.center()})},bindServer:function(){var a=this;if(0==this.selectedIds.length)return f.error("请选择一个密钥"),!1;if(this.selectedIds.length>1)return f.error("请选择单个密钥"),!1;var b=this.selectedIds[0],c=this.selectedItems[0],d=new m(n.bindServer,{listTpl:n.listTpl,selectedTpl:n.selectedTpl,$afterInit:function(){var a=this;a.$watch("regionId",function(b){a.loadSelected({page:1,count:20,regionId:b},c);var d=a.$refs.ds;d.$set({searchKey:"",keyword:""}),d._getData({page:1,count:20,regionId:b})},!0)},getData:function(a,b){var c=h.getCvmAnalyseValue(a.searchKey),d={query:"query instances ($filters: [Filter], $limit: Int, $offset: Int, $ipAddresses: [String], $innerSubnetIds: [String], $innerVpcIds: [String], $vagueIpAddress: String, $vagueInstanceName: String){\n                            instances(filters: $filters, limit: $limit, offset: $offset, ipAddresses: $ipAddresses, vagueIpAddress: $vagueIpAddress, innerSubnetIds: $innerSubnetIds, innerVpcIds: $innerVpcIds, vagueInstanceName: $vagueInstanceName) {\n                                totalNum: totalCount\n                                deviceList: nodes{\n                                    uInstanceId:id\n                                    alias:name\n                                    uuid\n                                    instanceStatus {\n                                        instanceState\n                                        operationMask\n                                        runFlag\n                                        hypervisor\n                                    }\n                                    instanceTypeDesc\n                                    osName\n                                    image {\n                                        unImgId\n                                        imageName\n                                        osName\n                                        imageType\n                                    }\n                                    privateIpAddresses\n                                    vpc{\n                                        unVpcId: id\n                                        vpcName: name\n                                        cidrBlock: cidr\n                                    }\n                                }\n                            }\n                        }",regionId:a.regionId||h.getRegionId(),limit:a.count,offset:(a.page-1)*a.count};c&&(c.vagueIp&&(d.vagueIpAddress=c.vagueIp),c.alias&&(d.vagueInstanceName=c.alias)),d.filters=[],l.queryCvmList(d).then(function(a){var c=[],d=0;a&&a.instances&&a.instances.totalNum>0&&a.instances.deviceList.length>0&&(d=a.instances.totalNum,c=k.formatKeyList(a.instances.deviceList)),b(null,{list:c,size:d})})},initSelected:[],loadSelected:function(a,b){var c=b.id,d=this;d.$refs.ds.$set("selectedEmptyTips","加载中...");var e=[];k.queryKeyPairs({keyIds:[c],filters:e,regionId:h.getRegionId()}).then(function(b){var c=b.keyPairs.nodes||[],e=c.length>0&&c[0].associatedInstanceIds||[];if(e&&e.length>0){var f=[];e&&e.length&&f.push({name:"instance-id",values:e}),l.queryCvmList({query:"query instances ($filters: [Filter], $limit: Int, $offset: Int, $ipAddresses: [String], $innerSubnetIds: [String], $innerVpcIds: [String], $vagueIpAddress: String, $vagueInstanceName: String){\n                                      instances(filters: $filters, limit: $limit, offset: $offset, ipAddresses: $ipAddresses, vagueIpAddress: $vagueIpAddress, innerSubnetIds: $innerSubnetIds, innerVpcIds: $innerVpcIds, vagueInstanceName: $vagueInstanceName) {\n                                          totalNum: totalCount\n                                          deviceList: nodes{\n                                              uInstanceId:id\n                                              alias:name\n                                              uuid\n                                              instanceStatus {\n                                                  instanceState\n                                                  operationMask\n                                                  runFlag\n                                                  hypervisor\n                                              }\n                                              instanceTypeDesc\n                                              osName\n                                              image {\n                                                  unImgId\n                                                  imageName\n                                                  osName\n                                                  imageType\n                                              }\n                                              privateIpAddresses\n                                              vpc{\n                                                unVpcId: id\n                                                vpcName: name\n                                                cidrBlock: cidr\n                                              }\n                                          }\n                                      }\n                                  }",filters:f,regionId:a.regionId||h.getRegionId(),limit:a.count,offset:(a.page-1)*a.count}).then(function(a){d.$refs.ds.$set("selectedEmptyTips","");var b=a&&a.instances&&a.instances.deviceList||[];k.formatKeyList(b);d.initSelected=b.slice(),d.$refs.ds.replaceSelected(b)})}else d.$refs.ds.$set("selectedEmptyTips",""),d.initSelected=[],d.$refs.ds.replaceSelected([])})}}),e=d.$refs.ds;i.create(d.$el,"800","",{title:"绑定/解绑实例",preventResubmit:!0,button:{" 确定 ":function(){g()}}});var g=function(){var c=[],g=[];if(d.initSelected.forEach(function(a){var b=!0;e.selected.forEach(function(c){c.uuid==a.uuid&&(b=!1)}),b&&g.push(a)}),e.selected.forEach(function(a){var b=!0;d.initSelected.forEach(function(c){a.uuid==c.uuid&&(b=!1)}),b&&c.push(a)}),!c.length&&!g.length)return f.flash("无任何变更"),h.restoreDialogBtn(),i.hide(),!1;var j=b;c=c.map(function(a){return a.uInstanceId}),g=g.map(function(a){return a.uInstanceId});var k=i.el.find(".dialog_layer_ft").find(".btn:eq(0)");a.sendBindServerReq({keyId:j,bindList:c,unbindList:g}).done(function(){f.success("操作成功"),a.refreshList()}).fail(function(a){i.toggleBtnDisable(!1),k.length&&k.html('<i class="ico ico_loading"></i><span>确定</span>')}),k.length&&k.html('<i class="ico ico_loading"></i><span>处理中...</span>')}},sendBindServerReq:function(a){var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:h.getRegionId(),c=this,e=d.Deferred(),f=function i(a){l.queryTaskFlow({taskId:a,regionId:b}).then(function(b){var d=b.response.status;"SUCCESS"===d?e.resolve():"RUNNING"===d?c.timeOut=setTimeout(function(){i(a)},3e3):e.reject()})},g=[];return a.bindList&&a.bindList.length>0&&g.push(k.associateInstances({instanceIds:a.bindList,keyIds:[a.keyId]},{camTipsType:"dialog"},b)),a.unbindList&&a.unbindList.length>0&&g.push(k.disassociateInstances({instanceIds:a.unbindList,keyIds:[a.keyId]},{camTipsType:"dialog"},b)),Promise.all(g).then(function(a){a&&a[0].response.taskId&&f(a[0].response.taskId)})["catch"](function(a){e.reject(a)}),e.promise()},destroy:function(){}};c.exports=p}),define("modules/cvm/sshkey/sshkey",function(a,b,c){var d=a("$"),e=(a("pageManager"),a("manager"),a("util")),f=a("appUtil"),g=(a("event"),a("projectsSelector")),h=a("search"),i=(a("router"),a("cvm/sshkey/detail")),j=a("cvm/sshkey/oper"),k=(a("reporter"),a("dataManager"),a("qccomponent")),l=a("cvm/sshkey/data"),m=a("widget/errorTips/errorTips"),n=a("cvm/common/components/SmartHelper"),o={main:'  <style type="text/css">    .table-panel td a:hover {      text-decoration: underline;    }  </style>  <div class="manage-area">    <div class="manage-area-title">      <h2>SSH密钥</h2>      <div id="projectsArea" class="tc-select-box"></div>    </div>    <div class="manage-area-main">      <div class="manage-area-full-inner">        <div id="operArea">          <div class="tc-15-action-panel">            <button              type="button"              class="tc-15-btn m"              data-event="ssh_add"              data-hot="SSH.new"            >              创建密钥            </button>            <button              type="button"              class="tc-15-btn weak m disabled"              data-event="ssh_bind_server"              data-hot="SSH.bangding"              disabled="true"            >              绑定/解绑实例            </button>            <button              type="button"              class="tc-15-btn weak m disabled"              data-event="ssh_modify"              data-hot="SSH.revise"              disabled="true"            >              修改            </button>            <button              type="button"              class="tc-15-btn weak m disabled"              data-event="ssh_del"              data-hot="SSH.delete"              disabled="true"            >              删除            </button>            <div id="searchArea" class="pull-right"></div>          </div>        </div>        <div id="sshList"></div>      </div>    </div>  </div>',filterNodata:'  当前过滤条件下没有SSH密钥，  <a href="javascript:void(0);" data-event="ssh_add">点击新建</a>',idName:'  <p>    <a class="id-link" href="/cvm/sshkey/detail/{{ item.id }}" data-event="nav">      {{ item.id }}    </a>  </p>  <p>    <span class="text-overflow m-width" title="{{ item.name }}">{{      item.name    }}</span>  </p>'},p={title:"SSH密钥-控制台",pageClass:"",render:function(a){return f.isI18n()||n.show(),"detail"==arguments[0]?i.render(arguments[1]):(nmc.render(e.tmpl(o.main,{}),"cvm"),this.sshListEl=d("#sshList"),this.projectsAreaEl=d("#projectsArea"),this.searchAreaEl=d("#searchArea"),this.operAreaEl=d("#operArea"),this.needSpeedReport=!0,this.renderWidget(),void this.bindEvent())},renderWidget:function(){var a=this;this.projectsSelector=new g({renderTo:this.projectsAreaEl,change:function(){a.renderList(1)}}),this.search=new h({placeholder:"请输入密钥名",renderTo:this.searchAreaEl,listFun:function(b){a.renderList(1,b)}}),this.initGridView(),j.init(this)},initGridView:function(){var a=this,b={$data:{colums:[{key:"idName",name:"ID/名称",cellTemplate:o.idName},{key:"bind_count",name:"实例绑定情况"},{key:"image_count",name:"自定义镜像绑定情况"},{key:"create_time",name:"创建时间"}],trackKey:"display_id",emptyTips:o.filterNodata,searchItemName:"SSH密钥"},getCellContent:function(a,b,c){return c.cellTemplate},getData:function(b,c){a.renderList(b.page,b.searchKey,null,b)},setTrAttr:function(a,b){return{"data-id":b.key_id}},backList:function(){a.renderList(1)}},c=k.getComponent("grid-view");a.gridView=new c(b),a.sshListEl.append(a.gridView.$el)},renderList:function(a,b,c,d){a=void 0===a?1:a;var e=this,g=d&&d.count?d.count:20,h=g*(a-1),i=f.getProjectId(),k=[];-1!=i&&k.push({name:"project-id",values:[i]}),b&&k.push({name:"key-name",values:[b]}),l.queryKeyPairs({filters:k,offset:h,limit:g,regionId:f.getRegionId()}).then(function(d){if(d&&d.keyPairs){e.operAreaEl.show();var h=d.keyPairs.nodes||[];h.forEach(function(a,b,c){a.bind_count=a.associatedInstanceCount||0,a.associatedInstanceIds=a.associatedInstanceIds.filter(function(a){return""!=a&&null!=a}),a.image_count=a.associatedImageCount||0,a.create_time=f.formatDate(new Date(a.createTime),"yyyy-MM-dd hh:mm:ss"),c[b]=a}),e.listData=h,e.gridView.setData({list:e.listData,totalNum:d.keyPairs.totalCount,page:a,count:g,searchKey:b}),j.reset()}else if(d.error&&d.error.length||!d.keyPairs){e.gridView.setData({list:[]});for(var i=0;i<d.errors.length;i++){var k=d.errors[i];m.isCamRefused(k)?e.gridView.showTips("<div><cam-tips>"+k.message+"</cam-tips></div>"):e.gridView.showTips("<div><error-tips>"+k.message+"</error-tips></div>");break}return}c&&c(),e.needSpeedReport&&(f.speedReport("sshkey"),e.needSpeedReport=!1)})},bindEvent:function(){},getCurData:function(a){for(var b,c={},d=0;b=this.listData[d];d++)if(a==b.id){c=b;break}return c},_destroy:function(){i.destroy&&i.destroy(),j.destroy&&j.destroy()},destroy:function(){f.isI18n()||n.destroy()}};c.exports=p});