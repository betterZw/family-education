define("models/cdh",function(e,t,i){var a=e("nmc/main/model");i.exports=new a({getPrice:{url:"/cdh?action=getCdhPrice",method:"get"},getVpsHostList:{url:"/cdh?action=getCdhHostList",method:"get"},updateAlias:{url:"/cdh?action=updateAlias",method:"get"}},"/cgi")}),define("models/cvmHealth",function(e,t,i){var a=e("nmc/main/model");i.exports=new a({checkCvmConfig:{url:"/cvm?action=checkCvmConfig",method:"get"},getConfigHealth:{url:"/cvm?action=getConfigHealth",method:"get"}},"/cgi")}),define("models/deal",function(e,t,i){var a=e("nmc/main/model");i.exports=new a({getWechatPayCode:{url:"/deal?action=getWechatPayCode",method:"post"},getRechargeParms:{url:"/deal?action=getRechargeParms",method:"post"},getRechargeVouchers:{url:"/deal?action=getRechargeVouchers",method:"post"},activateVoucher:{url:"/deal?action=activateVoucher",method:"post"},rechargeVoucher:{url:"/deal?action=rechargeVoucher",method:"post"},getLastRechargeAmount:{url:"/deal?action=getLastRechargeAmount",method:"post"},getRechargeCommonInfo:{url:"/deal?action=getRechargeCommonInfo",method:"post"},getBillStatus:{url:"/deal?action=getBillStatus",method:"post"},getRenewAutoAmount:{url:"/deal?action=getRenewAutoAmount",method:"post"},generateDeals:{url:"/deal?action=generateDeals",method:"post"}},"/cgi")}),define("models/developer",function(e,t,i){var a=e("nmc/main/model");i.exports=new a({getLocationMap:{url:"/developer?action=getLocationMap",method:"get"},updateUserInfo:{url:"/developer?action=updateUserInfo",method:"post"},sendTelCode:{url:"/developer?action=sendTelCode",method:"post"},updateUserTel:{url:"/developer?action=updateUserTel",method:"post"},updateUserEmail:{url:"/developer?action=updateUserEmail",method:"post"},getTrade:{url:"/developer?action=getTrade",method:"post"},updateTrade:{url:"/developer?action=updateTrade",method:"post"},getSchoolData:{url:"/developer?action=getSchoolData",method:"get"},queryBankAuthInfo:{url:"/developer?action=queryBankAuthInfo",method:"get"},queryStudentAuditInfo:{url:"/developer?action=queryStudentAuditInfo",method:"get"},checkCollegesSupport:{url:"/developer?action=checkCollegesSupport",method:"get"},submitStudentAuditInfo:{url:"/developer?action=submitStudentAuditInfo",method:"post"},getBankAuthInfo:{url:"/developer?action=getBankAuthInfo",method:"post"},getAuthInfoFromTenpay:{url:"/developer?action=getAuthInfoFromTenpay",method:"post"},updateAuthBankAccount:{url:"/developer?action=updateAuthBankAccount",method:"post"},submitBankAuthCode:{url:"/developer?action=submitBankAuthCode",method:"post"},resetAuthAccount:{url:"/developer?action=resetAuthAccount",method:"post"},updateCooperatorInfo:{url:"/developer?action=updateCooperatorInfo",method:"post"},getComdata:{url:"/login?action=checkLogin&refreshSession=1",method:"get"},getPromotionMsgFlag:{url:"/developer?action=getPromotionMsgFlag",method:"post"},setPromotionMsgFlag:{url:"/developer?action=setPromotionMsgFlag",method:"post"},isUserUniversalCloudAccess:{url:"/developer?action=isUserUniversalCloudAccess",method:"post"},isSendBankAuthVoucher:{url:"/developer?action=isSendBankAuthVoucher",method:"post"},getTradeConf:{url:"/developer?action=getTradeConf",method:"get"},queryMbStat:{url:"/developer?action=queryMbStat",method:"get"},querySecondAuthSet:{url:"/developer?action=querySecondAuthSet",method:"get"},openSecondAuth:{url:"/developer?action=openSecondAuth",method:"post"},closeSecondAuth:{url:"/developer?action=closeSecondAuth",method:"post"},subAccountExit:{url:"/developer?action=subAccountExit",method:"post"},getAuthStatus:{url:"/developer?action=getAuthStatus",method:"get"},getCorpInfo:{url:"/login?action=getCorpInfo",method:"post"}},"/cgi")}),define("models/loadbalance",function(e,t,i){var a=e("nmc/main/model");i.exports=new a({queryLB:{url:"/lb?action=queryLB",method:"get"},updateLBInfo:{url:"/lb?action=updateLBInfo",method:"post"},queryLBHealthStatus:{url:"/lb?action=queryLBHealthStatus",method:"get"},queryLBHealth:{url:"/lb?action=queryLBHealth",method:"get"},updateLBHealth:{url:"/lb?action=updateLBHealth",method:"post"},deleteLB:{url:"/lb?action=deleteLB",method:"post"},migrateLB:{url:"/lb?action=migrateLB",method:"post"},queryLBCvmBinding:{url:"/lb?action=queryLBCvmBinding",method:"get"},deleteHost:{url:"/lb?action=deleteHost",method:"post"},addHost:{url:"/lb?action=addHost",method:"post"},queryLBHost:{url:"/lb?action=queryLBHost",method:"get"},editLBDevice:{url:"/lb?action=editLBDevice",method:"post"},queryLBPortInfo:{url:"/lb?action=queryLBPortInfo",method:"get"},updatePortInfo:{url:"/lb?action=updatePortInfo",method:"post"},addLBPortMap:{url:"/lb?action=addLBPortMap",method:"post"},queryTaskResult:{url:"/lb?action=queryTaskResult",method:"get"},getFlowCscResult:{url:"/com?action=getFlowCscResult",method:"get"},queryLBLimit:{url:"/lb?action=queryLBLimit",method:"get"}},"/cgi")}),define("models/sslvpn",function(e,t,i){var a=e("nmc/main/model");i.exports=new a({getPrice:{url:"/sslvpn?action=getPrice",method:"get"},payByCart:{url:"/sslvpn?action=payByCart",method:"get"},initVpnGw:{url:"/sslvpn?action=initVpnGw",method:"post"}},"/cgi")}),define("models/trade",function(e,t,i){var a=e("nmc/main/model");i.exports=new a({getCvmPartPrice:{url:"/trade?action=getCvmPartPrice",method:"post"},queryHourlyPrice:{url:"/trade?action=queryHourlyPrice",method:"post"},getPrice:{url:"/trade?action=getPrice",method:"post"},payByCart:{url:"/trade?action=payByCart",method:"post"},getDealsByCond:{url:"/trade?action=getDealsByCond",method:"post"}},"/cgi")}),define("widget/alg/AutoRefresher",function(e,t,i){var a=e("widget/alg/Locks"),s=e("widget/alg/Recent"),n=e("widget/alg/IntervalTask"),o=e("lib/Class"),r=e("widget/operatelog/emitter"),d=o.extend(r.prototype).extend({interval:3e4,recent:3e5,errorRate:.5,constructor:function(e){var t=this;$.extend(t,e),(t.locks||(t.locks=new a)).onChange=t._onLockChange.bind(t),t.doneRecents=new s(t.recent),t.failRecents=new s(t.recent),t.intervalTask=new n(t.task,t.interval,function(){t.doneRecents.push(1),t._ifErrorRateExceed()},function(){t.failRecents.push(1),t._ifErrorRateExceed()})},init:function(){this._onLockChange(this.locks.isLocked())},_onLockChange:function(e){e?this.intervalTask.stop():this.intervalTask.start()},lock:function(e){this.locks.lock(e)},unlock:function(e){this.locks.unlock(e)},wait:function(e){return this.intervalTask.wait(e)},until:function(e){this.intervalTask.until(e)},_ifErrorRateExceed:function(){var e=this.doneRecents.recent().length,t=this.failRecents.recent().length,i=t/(e+t);i>this.errorRate&&this.emit("unstable",i)},destroy:function(){this.intervalTask.stop(),this.lock("__destroyed")}});i.exports=d}),define("widget/alg/IntervalTask",function(e,t,i){i.exports=function(s,n,o,r){o=o||$.noop,r=r||$.noo;var d,l,t,c=0;function p(){return(new Date).getTime()}function u(i){var a;return t&&t.cancel(),i=i===undefined?Math.max(0,d-p()):i,(t=new Promise(function(e,t){a=setTimeout(e,i)}).then(function(){t=null,function a(){l&&l.cancel();var t=++c,e=function(e){return function(){if(t===c)return e.apply(null,arguments)}},i=function(){d=p()+n,l=null,u(n)};return(l=new Promise(function(e,t){s().then(e,t)}).then(e(function(e){i(),o(e)}),e(function(e){i(),r(e)}))).cancel=function(){l=null,t="never match"},l}()})).cancel=function(){clearTimeout(a),t=null},t}return{until:function(e){return d=e,t&&u(),this},wait:function(e){return this.until(p()+(e===undefined?n:e))},start:function(){if(!l&&!t)return u(),this},stop:function(){return l&&l.cancel(),t&&t.cancel(),this}}}}),define("widget/alg/Recent",function(e,t,i){function s(){return(new Date).getTime()}function n(e,t){var i;for(i=0;i<e.length&&!(e[i].time>t);i++);return e.slice(i)}i.exports=function(i){var a=[];return{push:function(e){var t=s();a.push({data:e,time:s()}),a=n(a,t-i)},recent:function(){return n(a,s()-i)}}}}),define("widget/bee/mixins/regionNameMap",function(e,t,i){var a=e("manager");i.exports={$beforeInit:function(){var t=this;a.queryRegion(function(e){t.$set("REGION_MAP",e)})}}}),define("widget/chart/DatetimeChart",function(e,t,i){e("Highcharts");var a=e("qccomponent"),d=e("appUtil"),l={chart:{zoomType:"x"},title:{text:""},yAxis:{title:{text:""},lineWidth:1,tickPixelInterval:45,min:0,labels:{style:{fontSize:"12px"}}},plotOptions:{line:{marker:{enabled:!0,lineWidth:2,lineColor:"#ff7a22",fillColor:"#FFFFFF",radius:3,states:{hover:{enabled:!0}}},lineWidth:1,color:"#ff7a22"},spline:{marker:{enabled:!1,radius:3,states:{hover:{enabled:!0}}},lineWidth:1,color:"#ff7a22"}},credits:{enabled:!1},legend:{enabled:!1},tooltip:{}},s="_loadToken",n="_bufferReload",o=i.exports=a.extend({$tpl:'    <div class="tc-15-data-graph-info" day-view="{{dayView}}" style="position:relative;">        <div style="height:100%" data-mod="chart"></div><span b-if="!data || noData" style="position:absolute;top:50%;left:50%;margin-top:-12px;margin-left:-24px;">            {{data ? \'没有数据\' : \'加载中...\'}}        </span>    </div>',$valuekey:"data",watchFields:["fromTime","toTime","dayView","composedId","hidden"],$beforeInit:function(){var i=this;o.__super__.$beforeInit.apply(i,arguments),i.$watch("["+i.watchFields.join(",")+"]",i[n]=d.bufferFn(function(){if(i.composedId&&i.fromTime&&i.toTime&&!i.hidden){i.$set("data","");var t=i[s]={};i.loadData().done(function(e){i[s]===t&&i.$set("data",e)})}},100),!0)},$afterInit:function(){o.__super__.$afterInit.apply(this,arguments);var t=this;t.$chart=$(t.$el).find('[data-mod="chart"]'),t.$watch("data",function(){if(t.data)t.showChart();else{var e=t.$chart.highcharts();e&&e.destroy()}},!0)},$beforeDestroy:function(){o.__super__.$beforeDestroy.apply(this,arguments);this[n]&&this[n].destroy()},loadData:function(e){return $.Deferred().resolve({x:["2016-04-06 14:57:00"],y:[10]})},showChart:function(){var e,t=this,i=t.data,a=t.unit,s=!!t.dayView,n=!0,o=t.$chart,r={xAxis:{type:"datetime",dateTimeLabelFormats:{hour:"%H:%M"},tickPixelInterval:80,title:{text:""}}};i.y.length&&($.extend(r,l),e=i.x?d.cgwTimeParse(i.x[0]):new Date(1e3*t.fromTime),r.series=[{pointStart:e.getTime()-6e4*e.getTimezoneOffset(),data:i.y}],r.tooltip.formatter=s?(r.series[0].pointInterval=864e5,r.xAxis.dateTimeLabelFormats.day="%m-%d",r.xAxis.dateTimeLabelFormats.week="%m-%d",function(){var e=new Date(this.x);return e=new Date(e.getTime()+6e4*e.getTimezoneOffset()),[d.formatDate(e,"MM-dd")," ","<b>",this.y,a,"</b>"].join("")}):(r.series[0].pointInterval=3e5,r.series[0].type="spline",r.xAxis.dateTimeLabelFormats.day="%H:%M",r.xAxis.maxZoom=36e5,function(){var e=new Date(this.x);return e=new Date(e.getTime()+6e4*e.getTimezoneOffset()),[d.formatDate(e,"hh:mm")," ","<b>",this.y,a,"</b>"].join("")}),o.highcharts(r),n=!1),this.$set("noData",n)}},{defaults:{unit:"",hidden:!1}})}),define("widget/chart/Recent",function(e,t,i){var o,a=e("qccomponent"),s=e("./DatetimeChart"),n=e("appUtil"),r=864e5,d=function(e){var t=e.getFullYear(),i=e.getMonth()+1,a=e.getDate();return[t,(i<10?"0":"")+i,(a<10?"0":"")+a].join("-")},l=function(e){var t=e.split("-"),i=new Date(0);return i.setFullYear(+t[0],+t[1]-1,+t[2]),i};(o=a.extend({$valuekey:"id",$beforeInit:function(){var t=this,e=new Date,i=new Date(e.getTime()-r),a=new Date(e.getTime()-7*r),s=new Date(e.getTime()-15*r),n=new Date(e.getTime()-30*r);t.datePickerConfig={showCalendar:!0,lang:"zh-cn",tabs:[{label:"实时",from:d(e),to:d(e)},{label:"近7天",from:d(a),to:d(i)},{label:"近15天",from:d(s),to:d(i)},{label:"近30天",from:d(n),to:d(i)}],range:{min:d(n),max:d(e)},selected:{from:d(e),to:d(e)}},t.$watch(t.composedIdExpression,function(e){t.isComposedIdAvailable(e)?(t.$set("notValid",!1),t.$set("composedId",e)):t.$set("notValid",!0)},!0),o.__super__.$beforeInit.apply(this,arguments)},$afterInit:function(){o.__super__.$afterInit.apply(this,arguments);var t=this,e=function(){var e=t.$refs.datePicker.selected;t.setRange(e.from,e.to)},i=t.$refs.datePicker;i.setSelectedRange(i.selected.from,i.selected.to),i.$on("datepick",e),e()},$tpl:'    <div class="charts-panel clue-customized {{cls}}" b-on="events" b-style="{display:hidden?\'none\':\'\'}">        <style>            .sidebar-panel-container .charts-panel.clue-customized .tc-15-calendar-select-wrap,            .sidebar-panel-container .charts-panel.clue-customized .external-toolbar{                margin: 0 0 15px 0;            }            .charts-panel.clue-customized .charts-not-valid{                text-align: center;                margin: 100px 0;            }            .sidebar-panel-container .charts-panel.clue-customized .chart-wrap{                top: 30px;            }            .clue-customized .tc-15-data-graph-title{                margin-top: 20px;            }            .clue-customized .line-partition {                padding-bottom: 0;                border-bottom: 1px solid #e5e8ee;            }        </style>        <qc-date-picker b-ref="datePicker" b-with="datePickerConfig"></qc-date-picker>        {{>externalToolTpl}}        <div class="chart-wrap">            <div class="tc-15-data-graph">                <ul b-if="!notValid">                    <li b-repeat="chart in charts" class="line-partition" b-style="{display:chart.hidden ? \'none\' : \'\'}">                        <div class="tc-15-data-graph-title"><strong>{{chart.title}}</strong><em>(单位：{{chart.unit}})</em></div>                        <datetime-chart b-with="chart" hidden="{{chart.hidden}}" from-time="{{fromTime}}" to-time="{{toTime}}" day-view="{{dayView}}" composed-id="{{composedId}}"></datetime-chart>                    </li>                </ul>                <div class="charts-not-valid" b-if="notValid">{{notValidText || \'没有可以显示的数据\'}}</div>            </div>        </div>    </div>',setRange:function(e,t){var i=n.toDayStart(l(e)),a=n.toDayEnd(l(t));this.$set("dayView",a.getTime()-i.getTime()>r),this.$set({fromTime:Math.round(i.getTime()/1e3),toTime:Math.round(a.getTime()/1e3),dataView:a.getTime()-i.getTime()>r})}},{defaults:{composedIdExpression:"{regionId:regionId, id:id}",externalToolTpl:"",notValid:!1,charts:[]}})).tag("datetime-chart",s),i.exports=o}),define("widget/chart/baradUtil",function(e,t,i){i.exports={processData:function(e,t){t=t||this;var i=(e||[]).slice(),a=t.kilo?1e3:1024,s=t.bit?8:1,n=t.toMb||t.toMB?a*a*s:t.toMbps?a*a*s/8:1;1<t.div&&(n*=t.div);for(var o=!1,r=0,d=i.length;r<d;r++)1<n&&i[r]&&(i[r]=1*(i[r]/n).toFixed(3),t.round&&(i[r]=Math.round(i[r]))),(i[r]||0===i[r])&&(o=!0);return o||(i=[]),i}}}),define("widget/csvToArray/csvToArray",function(e,t,i){i.exports=function(e,t){t=t||",";for(var i=new RegExp("(\\"+t+'|\\r?\\n|\\r|^)(?:"([^"]*(?:""[^"]*)*)"|([^"\\'+t+"\\r\\n]*))","gi"),a=[[]],s=null;s=i.exec(e);){var n,o=s[1];o.length&&o!==t&&a.push([]),n=s[2]?s[2].replace(new RegExp('""',"g"),'"'):s[3],a[a.length-1].push(n)}return a}}),define("widget/cvmList/alias/alias",function(e,t,i){var r=e("$"),d=e("manager"),a=e("widget/cvmList/operate_base"),l=e("dialog"),c=e("tips"),s=e("util"),n=e("lengthlimiter"),o=e("widget/selectedShow/selectedShow"),p='<div class="edit_form_wrap">        <ul class="edit_psword">            <li>                <label class="txt">新云主机名称:</label>                <input class="txt_input" style="width:260px" id="aliasIpt" data-lenLimit="60" maxlength="60" relTipId="nameTip" type="text"/>                <p class="tip" id="nameTip"></p>            </li>            \x3c!--<li class="mod">                <input type="checkbox" class="tc-15-checkbox" checked />                <span class="msg">批量改名时，自动添加序号</span>            </li>--\x3e        </ul>    </div>',u=function(e){a.call(this,e)};(u.prototype=new a).exec=function(){var e,t=this;e=this.hasPermItems[0],l.create(s.tmpl(p,{}),540,"",{title:"改名",preventResubmit:!0,button:{"确定":function(){t.sendReq()}},onload:function(e){}}),o.render(this.selectedShowOptions),n.trigger(),r("#aliasIpt").focus().val(e.alias),n.trigger()},u.prototype.sendReq=function(){var e=this,t=l.el.find('input[type="text"]'),i=r.trim(t.val());if(!i)return t.focus(),void this.restoreDialogBtn();for(var a,s=[],n=[],o=0;a=e.hasPermItems[o];o++)s.push(a.deviceLanIp),n.push(a.uuid);d.modifyCvmAliasBatch({alias:i,ipList:s,uuidList:n},function(){l.hide(),e.refreshList(!0),c.success("修改成功")})},i.exports=u}),define("widget/cvmList/bandwidthimit/bandwidthimit",function(e,t,i){var u=e("$"),h=e("util"),m=e("manager"),a=e("widget/cvmList/operate_base"),f=e("dialog"),v=e("widget/range/range"),g=e("widget/selectedShow/selectedShow"),d=e("reporter"),w=e("constants"),l=e("tips"),r=e("appUtil"),s=e("widget/cvmList/upgrade_common"),b='<div class="form-wrap adjust-band-max bandwidth-limit-wrapper">    <ul class="form-list">        <li>            <div class="form-label"><label>网络计费模式</label></div>            <div><%=networkPayModeDesc%>            <a href="javascript:void(0);" id="changeMode" style="display:none;">&nbsp;&nbsp;切换成带宽计费</a>            <span id="leftChangeCount" style="display:none;">(转换后将消耗一次转换机会)</span>            </div>        </li>        <li>            <div class="form-label"><label>原带宽上限</label></div>            <% if (trafficBandwidthUnLimitFlag === 0) { %> <div><%=bandwidth%> Mbps</div> <% } %>            <% if (trafficBandwidthUnLimitFlag === 1) { %> <div>无上限</div> <% } %>        </li>        <li>            <div class="form-label"><label>目标带宽上限</label></div>            <div class="form-input">                <% if (isShowNoLimitSelect) { %>                <p class="radio-line">                    <label for="bw_no_restrictions"><input type="radio" class="tc-15-radio is-bandwidth-unlimited" id="bw_no_restrictions" <% if (!isLimited) { %> checked <% } %> name="bw_limit_type" value="0">无上限</label>                    <label for="bw_set_limits"><input type="radio" class="tc-15-radio is-bandwidth-limited" id="bw_set_limits" <% if (isLimited) { %> checked <% } %> name="bw_limit_type" value="1">有上限</label>                </p>                <% } %>                <div class="rerange-wrapper" style="display:none; width:440px"></div>                <p class="text-primary">带宽调整实时设定，实时生效</p>                <p class="text-primary" <% if(networkPayModeDesc != "按流量计费"){%> style="display:none;" <%}%> >注意：流量费用每小时结算一次，当账户余额不足时，两小时内将被停止流量服务。</p>                <p class="datetime-tips" id="buyEipTips" style="display: none;"></p>            </div>        </li>    </ul></div>',c='<div class="act-outline">        <div style="text-indent:2em;">每台主机只允许在按带宽计费与按流量计费两种模式之间转换<%=maxCount%>次，<span style="color:red;">该主机已经转换<%=currCount%>次，转换次数用完后将无法再转换。</span></div>        <div style="margin-top:20px;font-weight:bold;">您是否确定要操作？</div></div><div class="act-outline">        <div class="act-details">            <table class="act-details-tb">                <tbody>                    <tr>                        <td style="width:200px;"><div><span class="text-overflow">退款账号</span></div></td>                        <td><div><span class="text-overflow">退款金额(元)</span></div></td>                    </tr>                    <% for (var i = 0, item; item = returnInfo[i]; i++) { %>                        <tr>                            <td style="border-top:1px solid #E6EBF2"><div><span class="text-overflow"><%=item.uin%></span></div></td>                            <td style="border-top:1px solid #E6EBF2"><div><span class="text-overflow"><%=item.amount%></span></div></td>                        </tr>                    <% } %>                </tbody>            </table>        </div>    </div>    <div class="act-outline">        <div style="text-indent:2em;">退款金额将退还至账号的赠送账户（无法提现）。对退款人及退款金额有疑问时，请勿点击确认切换，请提<a href="https://console.qcloud.com/workorder/category/create?level1_id=1&level2_id=2&level1_name=%E5%85%AC%E5%85%B1%E5%9F%BA%E7%A1%80%E7%B1%BB%E9%97%AE%E9%A2%98&level2_name=%E8%B4%A2%E5%8A%A1%E7%B1%BB" target="_blank">工单咨询</a></div>    </div>',I=null,y=!1,k=!1,x=65535;var n=function(e){a.call(this,e)};(n.prototype=new a).exec=function(){var i=this,t=this.hasPermItems[0],e=t.bandwidth;I=null;for(var a=0;a<this.hasPermItems.length;a++)this.hasPermItems[a].bandwidth!=x&&(I=!0,e=this.hasPermItems[a].bandwidth<e?this.hasPermItems[a].bandwidth:e);y=t.networkPayMode===w.NETWORKPAYMODE.FLOW;var s=t.uHostId&&y,n=t.networkPayModeDesc,o=b;(k=this.args&&"changeFlow"==this.args[2])&&(n="按流量计费",y=!0);var r=function(){if(!t.isPrepaidUser||t.isBandwidthPackageUser)return!0;if(s)return!1;for(var e=0;e<i.hasPermItems.length;e++)if(!(24<=i.hasPermItems[e].cpu&&1==i.hasPermItems[e].cvmPayMode))return!1;return!0}();r||(I=!0);var d=h.tmpl(o,{isLimited:I,networkPayModeDesc:n,bandwidth:t.bandwidth,trafficBandwidthUnLimitFlag:t.bandwidth===x?1:0,isShowNoLimitSelect:r});f.create(d,"680","",{title:"调整网络",preventResubmit:!0,button:{"确定":function(){k?i.showChangeModeConfirm():i.sendReq()}}}),g.render(this.selectedShowOptions),this.wrapper=f.el.find(".bandwidth-limit-wrapper"),this.rangeWrapper=this.wrapper.find(".rerange-wrapper");var l=I?e:10;if(t.isBandwidthPackageUser||t.bandwidth!=x||(l=0),k){!function p(e,t){m.getPriceForHour({pid:10303,parts:e},function(e){t(e)})}({cvm_traffic:"1"},function(e){var t=e[10303].money.toFixed(2)-0;i.wrapper.find('[data-field="cost"]').html(t)})}if(t.isBandwidthPackageUser){var c=function(){for(var e=1e3,t=0;t<i.hasPermItems.length;t++)if(!i.hasPermItems[t].uHostId){e=200;break}return e}();this.bandWidthRange=new v({renderTo:this.rangeWrapper,value:l,min:0,max:c,section:i.getSliderSection(c),change:function(){i.changeBandwidth()}})}else if(s)this.bandWidthRange=new v({renderTo:this.rangeWrapper,min:0,max:1e3,section:i.getSliderSection(1e3),value:t.bandwidth||0,change:function(){}});else{c=function(){for(var e=0;e<i.hasPermItems.length;e++)if(1!=i.hasPermItems[e].cvmPayMode)return 100;for(e=0;e<i.hasPermItems.length;e++)if(i.hasPermItems[e].cpu<=8)return 200;return 400}();this.bandWidthRange=new v({renderTo:this.rangeWrapper,value:l,min:0,max:c,section:i.getSliderSection(c),change:function(){i.changeBandwidth()}})}I?(u(".is-bandwidth-limited").prop("checked",!0),u(".is-bandwidth-unlimited").prop("checked",!1),this.rangeWrapper.show()):(u(".is-bandwidth-unlimited").prop("checked",!0),u(".is-bandwidth-limited").prop("checked",!1)),this.bindEvent(),this.showChangeModeInfo()},n.prototype.showChangeModeInfo=function(){var a=this;a.getChangeLimit().then(function(e){var t=(e=(a.changeLimitInfo=e)||{}).maxCount-e.currCount;if(k){var i='<p class="tc-15-msg warning" style="margin: 0 0 10px;"> <span class="tip-info">'+("每台主机只允许在按带宽计费与按流量计费两种模式之间转换"+e.maxCount+"次。该主机已经转换"+e.currCount+"次，转换次数用完后将无法再转换。")+"</span></p>";f.el.find(".dialog_layer_cont").prepend(i),f.el.find("#leftChangeCount").show()}else if(0<t){a.canChangeToYearMonth()&&u("#changeMode").show()}})},n.prototype.bindEvent=function(){var e=this,t=this.rangeWrapper,i=this.wrapper.find('input[name="bw_limit_type"]');i.change(function(){"1"==i.filter(":checked").val()?t.show():(t.hide(),e.changeBandwidth())}),u(".is-bandwidth-limited").click(function(){u(".is-bandwidth-unlimited").removeClass("checked"),u(this).addClass("checked"),t.show(),I=!0}),u(".is-bandwidth-unlimited").click(function(){u(".is-bandwidth-limited").removeClass("checked"),u(this).addClass("checked"),t.hide(),I=!1});var a=this;u("#changeMode").click(function(){a.upgrade.exec("changeFlow")})},n.prototype.canChangeToYearMonth=function(){if(1<this.hasPermItems.length)return!1;var e=this.hasPermItems[0];return e.networkPayMode===w.NETWORKPAYMODE.FLOW&&1==e.cvmPayMode},n.prototype.getChangeLimit=function(){if(this.changeLimitInfo)return(e=u.Deferred()).resolve(this.changeLimitInfo),e;var e,t=this.hasPermItems[0];return this.upgradeCommon=new s(this),e=this.upgradeCommon.getActionsLimit(r.getRegionId(),"SetCvmBandwidth",t.uInstanceId)},n.prototype.showChangeModeConfirm=function(){var s=this;f.hide();var e=s.hasPermItems[0],n=s.changeLimitInfo.currCount,o=s.changeLimitInfo.maxCount-s.changeLimitInfo.currCount,t={regionId:r.getRegionId(),deviceId:e.uuid};m.getBandwidthReturnFittingPrice(t,function(e){var t=[];for(var i in e.data)e.data.hasOwnProperty(i)&&t.push({uin:i,amount:(e.data[i]/100).toFixed(2)});var a=h.tmpl(c,{maxCount:s.changeLimitInfo.maxCount,currCount:n,leftCount:o,returnInfo:t});f.create(a,"580","",{title:"确认切换","class":"dialog_layer_v2",preventResubmit:!0,button:{"我知道了，确认切换":function(){s.sendReq()}}})})},n.prototype.changeBandwidth=function(){this.showBuyEipTips(this.bandWidthRange.val())},n.prototype.sendReq=function(){for(var e,a=this,t=[],i=[],s=0;e=this.hasPermItems[s];s++)t.push(e.deviceLanIp),i.push(e.uuid);var n=this.wrapper.find('input[name="bw_limit_type"]').filter(":checked");if(n&&0<n.length)var o="1"==n.val()?this.bandWidthRange.val():x;else o=this.bandWidthRange.val();if(I)var r={lanIpList:t,uuidList:i,bandwidth:o,trafficBandwidthUnLimitFlag:0};else r={lanIpList:t,uuidList:i,bandwidth:x,trafficBandwidthUnLimitFlag:1};y&&k&&(r.networkPayMode=w.NETWORKPAYMODE.FLOW),(y?m.setBandwidthLimitForFlow:m.setBandwidthLimit)(r,function(e){f.hide();try{e.data.cgwRet.taskId&&(f.hide(),a.checkTask({taskId:e.data.cgwRet.taskId},"调整网络中"))}catch(t){e.taskId&&(f.hide(),a.checkTask({taskId:e.taskId},"调整网络中"))}},function(e){var t=e&&e.data&&e.data.returnCode;100222==t?l.error("已退费设备不能重复退费"):101102==t?l.error("已退费设备不能重复退费"):101103==t?l.error("如果设备未调整成功 就发起退费"):101104==t?l.error("设备Id无可退费订单"):101105==t?l.error("订单冲突，设备有正在处理的 带宽升级 或者续费订单"):101106==t?l.error("调用cgw失败"):0!=t&&l.error(e.msg);try{e.data.data.cgwRet.taskId&&(f.hide(),a.checkTask({taskId:e.data.data.cgwRet.taskId},"调整网络中"))}catch(i){e&&e.data&&e.data.taskId&&(f.hide(),a.checkTask({taskId:e.data.taskId},"调整网络中"))}}),d.click("yunzhuji.btn.bandwidthimit")},n.prototype.getSliderSection=function(e){switch(e){case 100:return[{value:5,width:100},{value:20,width:200},{value:100,width:300}];case 200:return[{value:10,width:100},{value:40,width:200},{value:200,width:300}];case 400:return[{value:20,width:100},{value:80,width:200},{value:400,width:300}];case 1e3:return[{value:500,width:150},{value:1e3,width:300}]}},i.exports=n}),define("widget/cvmList/bindkeypair/bindkeypair",function(e,t,i){var d=e("$"),l=e("manager"),a=e("widget/cvmList/operate_base"),c=e("dialog"),s=e("util"),p=e("appUtil"),u=(e("event"),e("tips")),n=e("constants"),o=e("widget/selectedShow/selectedShow"),r='<div id="bindkeyWrapper">    <div class="mod-secret-key" style="margin-top:0">            <div class="mod-secret-key-tit">对选中云主机加载以下密钥：</div>            <div class="secret-key-list" style="min-height:250px">                <ul class="sshkey-list"></ul>            </div>          </div></div>',h='<% if (data.length) { %><% for (var i=0, item; item = data[i]; i++) { %><li><label class="tc-15-checkbox-wrap" style="display:block"><input type="checkbox" class="tc-15-checkbox" value="<%- item.key_id %>"><%= item.key_name %></label></li><% } %><% } else { %><li style="padding:20px; text-align:center">暂无密钥, <a href="/cvm/sshkey" data-event="nav">点击新建</a></li><style>.secret-key-list{min-height: 0!important}</style><% } %>',m=function(e){a.call(this,e)};(m.prototype=new a).exec=function(){var e=this,t=this.hasPermItems[0],i=s.tmpl(r,{powerOffWiki:n.POWEROFFWIKI});c.create(i,540,"",{title:"加载密钥",preventResubmit:!0,button:{"确定":function(){e.sendReq()}}}),o.render(this.selectedShowOptions),this.wrapper=d("#bindkeyWrapper"),this.keyList=this.wrapper.find(".sshkey-list"),this.keyListData=[],this.getKeyList(t.projectId,1)},m.prototype.getKeyList=function(i,a){var s=this,e=40*(a-1);l.queryKeypair({count:40,offset:e,projectId:i},function(e){var t=e.key_list||[];s.keyListData=s.keyListData.concat(t),s.renderListUi(t),s.keyListData.length<e.key_total&&s.getKeyList(i,a+1)})},m.prototype.renderListUi=function(e){var t=this.keyList,i=s.tmpl(h,{data:e});t.append(i)},m.prototype.sendReq=function(){var t=this,e=this.keyList;if(keyChecked=e.find('input[type="checkbox"]:checked'),!keyChecked.length)return u.error("请选择密钥!"),p.restoreDialogBtn(),!1;for(var i,a=[],s=[],n=[],o=0;i=this.hasPermItems[o];o++)s.push(i.deviceLanIp),n.push(i.uuid);keyChecked.each(function(e,t){t=d(t);var i={};i.keyId=t.val(),i.bindIpList=s,i.bindUuidList=n,a.push(i)});var r={actionType:2,reqList:a};l.manageCvmKey(r,function(e){c.hide(),t.checkTask(e,"下发密钥中","sshkey")})},i.exports=m}),define("widget/cvmList/boot/boot",function(e,t,i){e("$");var o=e("manager"),a=e("widget/cvmList/operate_base"),r=e("dialog"),d=e("widget/selectedShow/selectedShow"),l=(e("router"),'<span class="tit">确定选中主机进行开机</span><br>'),s=function(e){a.call(this,e)};(s.prototype=new a).exec=function(){this.showBootConfirm()},s.prototype.showBootConfirm=function(){var s=this,n=this.hasPermItems;r.confirm(l,function(){for(var e,t=[],i=[],a=0;e=n[a];a++)t.push(e.deviceLanIp),i.push(e.uuid);i.length&&o.cvmAction({actionType:1,deviceInfo:t,uuidList:i},function(e){s.checkTask(e,"开机中")})},null,{title:"开机",width:540,hideIcon:!0}),d.render(this.selectedShowOptions)},i.exports=s}),define("widget/cvmList/changeproject/changeproject",function(e,t,i){var r=e("$"),d=e("manager"),a=e("widget/cvmList/operate_base"),l=e("dialog"),s=e("util"),c=e("tips"),n=e("widget/selectedShow/selectedShow"),o='<div><div class="tc-15-msg" style="margin-bottom: 20px"><div class="tip-info">云主机迁移后需重新绑定安全组，点击<a href="//www.qcloud.com/document/product/213/5221#.E9.85.8D.E7.BD.AE-cvm-.E5.AE.9E.E4.BE.8B.E5.85.B3.E8.81.94.E5.AE.89.E5.85.A8.E7.BB.84" target="_blank">查看操作指南。</a></div></div><div class="table-panel host-table-panel" style="position:static; height:200px"><div class="tc-table-fixed"><div class="tc-table-fixed-head"><table class="tc-table tc-table-headcolor"><colgroup><col class="tc-table-col1"><col class="tc-table-col2"><col class="tc-table-col3"></colgroup><thead><tr><th></th><th><span>项目名称</span></th><th><span>项目说明</span></th></tr></thead></table></div><div class="tc-table-fixed-body def-scroll"><table class="tc-table tc-table-rowhover"><colgroup><col class="tc-table-col1"><col class="tc-table-col2"><col class="tc-table-col3"></colgroup><tbody><% for (var i=0, item; item = data[i]; i++ ) { %><tr class="select_project_row"><td><input type="radio" name="change_project_radio" value="<%- item.projectId %>" /></td><td><span><%= item.name %></span></td><td><span><%= item.info %></span></td></tr><% } %></tbody></table></div></div></div></div>',p=function(e){a.call(this,e)};(p.prototype=new a).exec=function(){var e=this,t=s.tmpl(o,{data:e.listIns.projectData});l.create(t,"540","",{title:"分配至项目",preventResubmit:!0,button:{"确定":function(){e.sendReq()}}}),n.render(this.selectedShowOptions),r(".select_project_row").click(function(e){if("radio"!==r(e.target).attr("type")){var t=r(this).find('input[type="radio"]');t.prop("checked")?t.prop("checked",!1):t.prop("checked",!0)}})},p.prototype.sendReq=function(){for(var e,t=this,i=[],a=[],s=0;e=t.hasPermItems[s];s++)a.push(e.uuid),i.push(e.deviceLanIp);var n=r('input[name="change_project_radio"]:checked');if(!n.length)return c.error("请选择项目!"),void t.restoreDialogBtn();var o={projectId:n.val(),ipList:i,uuidList:a};d.changeProject(o,function(e){l.hide(),t.refreshList(!0),c.success("修改成功")})},i.exports=p}),define("widget/cvmList/config",function(e,t,i){i.exports={fields:{idName:{name:"ID/主机名",width:"",minWidth:200,required:!0,sort:!0,orderField:"alias"},_monitor:{name:"监控",width:50,required:!0},statusDesc:{name:"状态",width:120,required:!0},netName:{name:"所属网络",width:90,defaults:!0},subnetName:{name:"所在子网",width:90,defaults:!0},ip:{name:"主IP地址",width:180,minWidth:180,defaults:!0},relatedVpc:{name:"关联私有网络"},zoneName:{name:"可用区",width:90,defaults:!0},cdHost:{name:"所属宿主机",width:150,defaults:!0},cvmPayModeDesc:{name:"主机计费模式",width:150,minWidth:150,sort:!0,orderField:"cvmPayMode",defaults:!0},deadlineInfo:{name:"到期时间",width:140,sort:!0,orderField:"deadline",defaults:!0},networkPayModeDesc:{name:"网络计费模式",width:150},osName:{name:"操作系统",width:160},cpuInfo:{name:"CPU",width:60},memInfo:{name:"内存",width:60},sysDiskInfo:{name:"系统盘",width:110},diskInfo:{name:"数据盘",width:120},bandwidthInfo:{name:"公网带宽",width:70},unImgIdInfo:{name:"镜像ID",width:80},projectName:{name:"所属项目",width:100},addTimeStamp:{name:"创建时间",sort:!0,orderField:"addTimeStamp",width:100},_operCol:{name:"操作",required:!0,width:150,minWidth:150,locked:!0}}}}),define("widget/cvmList/createimg/createimg",function(e,t,i){var h=e("$"),a=e("manager"),s=e("widget/cvmList/operate_base"),m=e("validator"),f=e("dialog"),n=e("tips"),v=e("util"),o=(e("appUtil"),e("event")),r=e("widget/cvmList/xentokvm/xentokvm"),d=e("widget/selectedShow/selectedShow"),g=e("models/api"),w=e("reporter"),l='    <style>.deci-ul li{list-style-type:decimal; margin-left: 20px}</style>    <div id="createImgWrapper">    <div class="tip_box">            <% if (osType == "linux") { %>            镜像制作过程约需10分钟。            <% } else if (osType == "windows" && sysprep) { %>            <ul class="deci-ul">            <li>镜像制作过程约需30分钟。</li>            <li><span style="color:red">执行sysprep需要云服务器启用administrator账户；基于windows 2008制作的镜像，无法保留administrator用户目录下的文件。</span>若不需要使用域账户登录windows，强烈建议选择 <a href="javascript:;" data-event="change_no_sysprep">不执行sysprep制作镜像</a>。</li>            <li>请务必确认<span style="color:red">QcloudService</span>服务已设置为自动启动，否则制作的镜像将不可用。镜像制作失败常见<a href="https://www.qcloud.com/document/product/213/2504" target="_blank"> 解决办法</a></li>            </ul>            <% } else if (osType == "windows" && !sysprep) { %>            <ul class="deci-ul">            <li>镜像制作过程约需30分钟。</li>            <li>若您需要使用域账号登陆windows，请选择<a href="javascript:;" data-event="change_sysprep"> 执行sysprep制作镜像</a>。</li>            <li>请务必确认<span style="color:red">QcloudService</span>服务已设置为自动启动，否则制作的镜像将不可用。镜像制作失败常见<a href="https://www.qcloud.com/document/product/213/2504" target="_blank"> 解决办法</a></li>            </ul>            <% } %>            <% if(isOnline && isPowerOn){ %>            <p id="norebootTips" style="color:#f00;display:none;">注意：未选择重启制作镜像时，运行中CVM的内存数据会有一定概率不被写入镜像。</p>            <% } %>                   </div>    <div class="edit_form_wrap">            <ul class="edit_psword">                <li>                    <label class="txt"><span style="color:#f00">*</span>镜像名称:</label>                    <input class="tc-15-input-text m" type="text"/>                                  <p class="tip">只支持字母、数字或连接符号</p>                </li>                <li>                    <label class="txt">镜像描述:</label>                    <textarea class="tc-15-input-textarea"> </textarea>                </li>                <% if(isOnline && isPowerOn){ %>                <li>                    <label class="txt"></label>                    <input type="checkbox" class="tc-15-checkbox" id="isreboot" checked="checked"><label for="isreboot">重启云主机，制作完整镜像</label>                </li>                <% } %>            </ul>        </div>    </div>',c='    <div style="padding:10px; font-size:14px">该服务器需要置换为新服务器才能制作自定义镜像。<a href="javascript:;" id="replaceServer">立即置换新服务器</a></div>',b="    <% if(!isReboot){ %>    <p>您现在用的是不重启制作镜像，即不用关机，有一定风险正在运行中的部分数据不会保留到制作好的自定义镜像内</p>    <% }else{ %>    <p>请确认关机并制作完整镜像，制作完成将重新启动，制作期间，云主机内服务将随关机而停止</p>          <% } %>    ",p=function(e){s.call(this,e)};(p.prototype=new s).exec=function(){if(1===this.hasPermItems[0].hypervisor)return this.showXenTip();var t=this;this.isPowerOn=this.hasFeature("NONSHUTDOWN"),a.getAllWhiteList(function(e){e&&e.windows2003_offline&&e.windows2003_offline.length&&(t.whiteList2003=!0),t.whiteList2003||!/windows2003/.test(t.hasPermItems[0].osValue)?(g.req({serviceType:"image",cmd:"DescribeImages",data:{status:0,imageType:1,limit:200}}).then(function(e){t.imgData=e}),e&&e.cvm_online_image&&e.cvm_online_image.length,t.isOnline=!0,t.showDialog()):n.error('不再支持windows 2003的云服务器制作自定义镜像 <a href="http://bbs.qcloud.com/thread-4937-1-2.html" target="_blank">了解原因</a>',6e3)})},p.prototype.showDialog=function(e){var t=this,i=t.hasPermItems[0].osType,a="制作自定义镜像",s=v.tmpl(l,{osType:i,sysprep:e,isOnline:this.isOnline,isPowerOn:this.isPowerOn});"windows"===i&&(a+=e?"(执行sysprep)":"(不执行sysprep)"),f.create(s,"550","",{title:a,preventResubmit:!0,button:{"确定":function(){t.sendReq(e)}}}),d.render(this.selectedShowOptions),t.bindEvent()},p.prototype.bindEvent=function(){var e=this;o.bindCommonEvent(h("#createImgWrapper")[0],"click",{change_sysprep:function(){e.showDialog(!0)},change_no_sysprep:function(){e.showDialog()}}),h("#isreboot").on("change",function(){h(this).prop("checked")?h("#norebootTips").hide():h("#norebootTips").show()})},p.prototype.showXenTip=function(){var e=this;f.create(c,"500","",{title:"制作镜像",button:{}}),h("#replaceServer").click(function(){r.render(e)})},p.prototype.sendReq=function(e){var t=this,i=this.hasPermItems[0],a=f.el.find('input[type="text"]'),s=f.el.find("textarea"),n=h.trim(a.val()),o=h.trim(s.val()),r=function(e,t){var i={tip:e};return m.showErr(t,i)};if(!n)return r("请输入镜像名称",a);if(20<n.length)return r("镜像名称不能超过20个字符",a);if(!/^[0-9a-zA-Z-]{1,20}$/.test(n))return r("请输入格式正确的名称",a);if(this.imgData)for(var d,l=0;d=this.imgData.imageSet[l];l++)if(n.toLowerCase()==d.imageName.toLowerCase())return r("输入的名称已经存在",a);if(o&&60<o.length)return r("描述长度不能超过60个字符",s);var c=h("#isreboot").prop("checked"),p={instanceId:i.uInstanceId,imageName:n,imageDescription:o,rebootFlag:c?1:0};"windows"==this.hasPermItems[0].osType&&(p.sysprep=e?1:0);var u=function(){g.req({serviceType:"image",cmd:"CreateImage",data:p}).then(function(e){f.hide(),t.checkTask({taskId:e.data.taskId},"制作镜像中")}),this.isOnline&&this.isPowerOn&&(c?w.click("yunzhuji.zzjingxiang.shutoff"):w.click("yunzhuji.zzjingxiang.noshutoff"))};this.isOnline&&this.isPowerOn?f.create(v.tmpl(b,{isReboot:c}),"500","",{title:"制作自定义镜像",button:{"我知道了":function(){u()}}}):u()},i.exports=p}),define("widget/cvmList/cvmList",function(e,t,i){var a,c=e("$"),d=e("pageManager"),f=e("manager"),l=e("util"),v=e("appUtil"),s=(e("event"),e("widget/region/region2")),n=e("projectsSelector"),g=(e("pagination"),e("search"),e("router")),p=e("dropdown"),u=e("tips"),w=e("widget/cvmList/operate_entry"),r=e("widget/cvmList/operate_base"),h=e("contextmenu"),m=e("reporter"),o=e("config/constants"),b=e("widget/cvmList/xentokvm/xentokvm"),I=e("widget/cvmList/config"),y=e("widget/cvmList/data_package"),k=e("widget/fieldsManager/gridView"),x=e("widget/cvmList/operate_auth"),P=e("widget/copy/copy"),C=e("qccomponent"),T=(e("modules/cvm/cdh/util"),e("dataManager")),S=(e("dialog"),'<style>#cvmList .tc-15-page {margin: 20px}.pencil-icon{visibility: hidden; cursor:pointer}.cvm-oper-cell a.disabled, .cvm-oper-cell a.disabled:hover{color: #999; cursor: default;}.cvm-oper-cell a.disabled:hover{text-decoration: none;}.renew_icon{background-color: #FFAA00;color: #fff;font-size: 12px;padding: 2px;width: 12px;display: inline-block;line-height: normal;}.ip-cell .net-type{color: #999; font-style: normal;}.ip-cell .m-width{max-width:85%!important; font-size: 12px}.tc-15-search{z-index: 4}#cvmRowDropdown{position: absolute;z-index: 100; background-color: #fff; font-size: 12px}#cvmRowDropdown .tc-15-dropdown-menu li a{height: 27px; line-height: 27px}#cvmRowDropdown .tc-15-dropdown-link {height: 22px; line-height: 22px; font-size: 14px}#cvmRowDropdown .tc-15-dropdown-link .caret{top:2px;}.manage-area{overflow:visible!important; height: auto!important;}    .convert-ip-icon, .convert-ip-ash-icon {display: none; cursor: pointer;}    .tr-hover .convert-ip-icon, .tr-hover .convert-ip-ash-icon {display: inline-block;}    .cont-eip-select ul.tc-15-simulate-option {width: 140px;}</style><div class="manage-area"><div class="manage-area-title">            <h2>云主机</h2>            <div id="projectsWrapper" class="tc-select-box"></div><div id="regionWrapper" class="tc-select-box"></div><div class="manage-area-title-right">                <a href="http://www.qcloud.com/doc/product/213/%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8CVM%E5%B8%AE%E5%8A%A9%E6%96%87%E6%A1%A3" target="_blank"><b class="links-icon"></b>云主机帮助文档</a>            </div></div><div class="manage-area-main">    <div style="margin: 0 20px" id="showTip"></div><div id="operArea"></div><div id="cvmList" style="position:relative"></div></div></div>'),D='<div class="tc-15-action-panel">  <button type="button" class="tc-15-btn m btn-add" data-event="add_cvm" data-hot="yunzhuji.new"><b class="icon-add"></b> 新建</button>  <button type="button" class="tc-15-btn m weak" data-event="cvm_oper_action" data-name="reboot">重启</button>  <button type="button" class="tc-15-btn m weak" data-event="cvm_oper_action" data-name="resetpwd">重置密码</button>  <div class="tc-15-dropdown tc-15-dropdown-btn-style">    <a href="javascript:;" class="tc-15-dropdown-link">更多操作<i class="caret"></i></a>    <ul class="tc-15-dropdown-menu">    <li data-event="cvm_oper_action" data-name="boot"><a href="javascript:;">开机</a></li>    <li data-event="cvm_oper_action" data-name="shutdown"><a href="javascript:;">关机</a></li>    <li data-event="cvm_oper_action" data-name="bindkeypair"><a href="javascript:;">加载密钥</a></li>    <li data-event="cvm_oper_action" data-name="changeproject" data-control="changeproject"><a href="javascript:;">分配至项目</a></li>    <li data-event="cvm_oper_action" data-name="alias"><a href="javascript:;">改名</a></li>    <li data-event="cvm_oper_action" data-name="upgradebandwidth"><a href="javascript:;">调整网络</a></li>    <% if (!isPrepaidUser) { %>  <li data-event="cvm_oper_action" data-name="returncvm"><a href="javascript:;">退还服务器</a></li>  <% } else { %>  <li data-event="cvm_oper_action" data-name="destroycvm"><a href="javascript:;">销毁</a></li>  <% } %>    <li data-event="cvm_oper_action" data-name="export"><a href="javascript:;">导出选中</a></li>    <li data-event="cvm_oper_action" data-name="exportall"><a href="javascript:;">导出全部</a></li>    </ul>    </div>    <button class="tc-15-btn weak m download" data-event="cvm_oper_action" data-name="exportall"></button>    <button class="tc-15-btn weak m setting" data-event="set_Fields" title="设置列表显示字段" data-hot="yunzhuji.setfields" data-grid-setting="true">    </button>    <div id="searchArea" class="pull-right"></div></div>',E='云主机列表为空，您可以<a href="javascript:void(0);" data-event="add_cvm" data-hot="yunzhuji.new">新建</a>一台云主机',L='您要查看的云主机不存在 <a href="/cvm/index" data-event="nav">返回列表</a>',_='<div style="position:absolute;z-index:99;font-size:12px;line-height:20px;right:140px;top:15px;padding:5px 8px;background:#fffee7;border:1px solid #f2ba23;color:#264663;box-shadow:0 1px 3px rgba(0,0,0,.1)">当前云服务器为后付费月结的购买方式，现在去<a href="https://console.qcloud.com/workorder/category/create?level1_id=6&level2_id=7&level1_name=%E8%AE%A1%E7%AE%97%E4%B8%8E%E7%BD%91%E7%BB%9C&level2_name=%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8%20CVM" class="">切换到预付费</a>购买方式，<a target="_blank" href="https://www.qcloud.com/doc/product/213/5041">详细说明</a></div>',A='<div class="id-name-cell"><p><a href="javascript:;" data-action="cvmCdh">{{item.uHostId}}</a></p><div><span class="text-overflow m-width" title="" >{{item.hostAlias}}</span></div></div>',M=l.tmpl('<div class="ip-cell"><p><span class="text-overflow m-width" title="<%if(eipInfo){%>弹性<%}%>公网IP: <%= deviceWanIp %>"><%= deviceWanIp %><% if (deviceWanIp && deviceWanIp!="-") { %><i class="net-type">(<% if(eipInfo){ %>弹性<% }else{ %>公<% } %>)</i><% } %></span><i class="copy-icon" data-clipboard-text="<%=deviceWanIp%>" style="display:none; cursor:pointer;" title="复制<%if(eipInfo){%>弹性<%}%>公网IP"></i>            <% if(deviceWanIp != "-" && !eipInfo && eipQuotaData){ %>                <% if(eipQuotaData.currentEipNum < eipQuotaData.eipNumQuota){ %>                <i class="convert-ip-icon" data-name="wipToEip" data-action="wipToEip" data-title="IP保持不变，转为弹性公网IP，您最多可开通<%=eipQuotaData.eipNumQuota%>个弹性公网IP，已开通<%=eipQuotaData.currentEipNum%>个。"></i>                <% }else{ %>                <i class="convert-ip-ash-icon" data-title="转为弹性公网IP，您的弹性公网IP已达到<%=eipQuotaData.eipNumQuota%>个上限。"></i>                <% } %>            <% } %></p><p><span class="text-overflow m-width" title="内网IP: <%= deviceLanIp %>"><%= deviceLanIp %><% if (deviceLanIp && deviceLanIp!="-") { %><i class="net-type">(内)</i><% } %></span><i class="copy-icon" data-clipboard-text="<%=deviceLanIp%>" style="display:none; cursor:pointer;" title="复制内网IP"></i></p>    </div>',null),B=l.tmpl('<span class="status-col"><%- item.statusDesc %></span>',null),R=l.tmpl('<span class="text-overflow" title="<%- item.deadline %>"><%- item.deadlineInfo %></span>',null),O=l.tmpl('<span class="text-overflow" title="<%- item.addTimeStamp %>"><%- item.addTimeStampFormated %></span>',null),N=l.tmpl('<div class="cvm-oper-cell" style="white-space:nowrap">        <a href="javascript:;" data-name="vnc" data-event="web_ssh" data-hot="yunzhuji.web">登录</a>        <% if (isPrepaidUser && !isSecondPayMode && !uHostId) { %>        <a href="javascript:;" data-name="renew" data-event="cvm_oper_action">续费</a>        <% } %>        <div class="tc-15-dropdown">        <a href="javascript:;" class="tc-15-dropdown-link">更多<i class="caret"></i></a>        </div></div>',null),z=l.tmpl('<div class="tc-15-dropdown" id="cvmRowDropdown">    <a href="javascript:;" class="tc-15-dropdown-link">更多<i class="caret"></i></a>            <ul class="tc-15-dropdown-menu" role="menu">                <li data-name="reboot" data-event="cvm_oper_action"><a href="javascript:;">重启</a></li>            <li data-name="boot" data-event="cvm_oper_action"><a href="javascript:;">开机</a></li>            <li data-name="shutdown" data-event="cvm_oper_action"><a href="javascript:;">关机</a></li>            <li data-name="resetpwd" data-event="cvm_oper_action"><a href="javascript:;">重置密码</a></li>            <li data-name="bindkeypair" data-event="cvm_oper_action"><a href="javascript:;">加载密钥</a></li>            <% if (!notShow_firewall) { %>            <li data-control="firewall" data-name="firewall" data-event="cvm_oper_action"><a href="javascript:;">配置安全组</a></li>            <% } %>            <% if (isPrepaidUser) { %>            <li data-name="upgradeconfig" data-event="cvm_oper_action"><a href="javascript:;">调整配置</a></li>            <li data-name="upgradedisk" data-event="cvm_oper_action"><a href="javascript:;">调整磁盘</a></li>            <% } %>            <li data-name="upgradebandwidth" data-event="cvm_oper_action"><a href="javascript:;">调整网络</a></li>            <li data-name="createimg" data-event="cvm_oper_action"><a href="javascript:;">制作镜像</a></li>            <li data-name="resetos" data-event="cvm_oper_action"><a href="javascript:;">重装系统</a></li>            <% if(isSnapAbility){ %>            <li data-name="snapshot" data-event="cvm_oper_action"><a href="javascript:;">创建快照</a></li>            <% } %>            <% if (!isPrepaidUser) { %>  <li data-event="cvm_oper_action" data-name="returncvm"><a href="javascript:;">退还服务器</a></li>  <% } else { %>  <li data-event="cvm_oper_action" data-name="destroycvm"><a href="javascript:;">销毁</a></li>  <% } %>            <% if (!notShow_changeproject) { %>            <li data-control="changeproject" data-name="changeproject" data-event="cvm_oper_action"><a href="javascript:;">分配至项目</a></li>            <% } %>            <li data-name="alias" data-event="cvm_oper_action"><a href="javascript:;">改名</a></li>            <li data-name="export" data-event="cvm_oper_action"><a href="javascript:;">导出信息</a></li>                <li data-name="bindEip" data-event="cvm_oper_action"><a href="javascript:;">绑定弹性IP</a></li>                <li data-name="unbindEip" data-event="cvm_oper_action"><a href="javascript:;">解绑弹性IP</a></li>            </ul>        </div>',null),$=l.tmpl('    <div class="id-name-cell">        <p>        <% if (item.uuid && item.uInstanceId) { %>        <a data-event="nav" href="/cvm/detail/<%- regionId %>/<%- item.uInstanceId %>"><%- item.uInstanceId%></a>        <% } %>        </p>        <div>        <% if (item.autoRenewFlag == 1) { %><em class="renew_icon" title="该主机已设置为自动续费">续</em><% } %><% if (item.canUpgradeToKvm) { %><i class="update-icon"><% if(i>=len-1 && i!=0){%><div class="tc-bubble tc-bubble-bottom" style="left:-17px;top:-47px;visibility:hidden;"><% }else{%><div class="tc-bubble tc-bubble-top" style="left:-17px;top:27px;visibility:hidden;"><% } %><div class="tc-bubble-inner"><p><a href="javascript:;" data-action="upgradeToKvm">置换为新服务器</a>后可用制作镜像等新特性</p></div></div></i>&nbsp;<% } %><span class="text-overflow m-width" title="<%= item.alias%>" <% if (item.canUpgradeToKvm || item.autoRenewFlag) { %> style="max-width: 70%;" <% } %> ><%= item.alias %></span><i class="pencil-icon" data-name="alias" data-action="editAlias"></i>        </div>    </div>',null),W=l.tmpl('<a href="javascript:;" data-action="cvm_view" class="icon-monitor" <% if (item.runflag == 3) { %> style="cursor:default" <% } %>>监控</a>',null),F=l.tmpl('<span class="text-overflow"><% if(item.relatedVpc) { %><span><%- item.relatedVpc.name %> (</span><a style="vertical-align: baseline" title="<%- item.relatedVpc.unVpcId %>" href="/vpc/vpc?unVpcId=<%- item.relatedVpc.unVpcId %>" data-event="nav"><%- item.relatedVpc.unVpcId %></a> <span title="<%- item.relatedVpc.vpcCIDR %>">| <%- item.relatedVpc.vpcCIDR %>)</span><% }else{  %><%- item.supportClassicLink ? "无" : "-" %><% } %></span>'),j=function(e,t){this.options=c.extend({},{perPageCount:20,renderMonitor:null,renderTo:null},e),this.entryObj=e.entryObj,this.render(t)};j.prototype={render:function(e,t){if((e=e||{}).alias)try{e.alias=decodeURIComponent(e.alias)}catch(i){}if(e.page||(e.page=1),e.instanceId&&(e.pid=-1),e.uHostIds)try{e.uHostIds=decodeURIComponent(e.uHostIds),this.curHostIdList=e.uHostIds.split(",")||[]}catch(i){}else this.curHostIdList=undefined;if(this.queryStr=e,this.needSpeedReport=!0,t)this.renderDataAfterInit();else{this.options.renderTo.html(l.tmpl(S,{})),this.cvmListEl=c("#cvmList"),this.projectsWrapperEl=c("#projectsWrapper"),this.regionWrapperEl=c("#regionWrapper"),this.operAreaEl=c("#operArea"),this.renderWidget(),this.bindEvent(),this.setmaxReqNum()}},renderWidget:function(){var e=this,t=this.queryStr;this.options;this.projectsSelector=new n({renderTo:this.projectsWrapperEl,selectedId:this.getProjectId(t),change:function(){e.navigate({page:1})}}),this.regionSelector=new s({renderTo:this.regionWrapperEl,selectedId:this.getRegionId(t),change:function(){e.navigate({page:1}),m.click("yunzhuji.locate")}});var i=localStorage&&localStorage.cvm_fields;i&&/deviceLanIp|deviceWanIp/.test(i)&&(localStorage.cvm_fields=i+",ip"),c(document).off("updateColumByField").on("updateColumByField",function(){e.initCopy()}),this.renderList(t)},renderList:function(e,t,i,a){var s=[].slice.call(arguments);this.gridView||this.initGridView(),this.getList.apply(this,s)},initGridView:function(){var a=this,e={$data:{hasFirst:!0,orderField:"addTimeStamp",order:1,initGetData:!1,canResizeColum:!0,selectedHighlight:!1,colums:a.getColumns(),list:[],canSelectTotal:!1,autoMaxHeight:!0,maxHeightOffset:10,autoCheckWidth:!1,showState:!0,showPagination:!0,totalNum:0,trackKey:"uuid",emptyTips:a.queryStr.instanceId?L:E,searchItemName:"云主机"},$mixins:[k("cvm_fields","#appArea [data-grid-setting]",7)],getCellContent:function(e,t,i){return a.getCellContent(e,t,i)},getData:function(e,t){g.navigate(a.getLinkPath(c.extend({},a.queryStr,e)))},setTrAttr:function(e,t){return a.setTrAttr(e,t)},backList:function(){a.navigate({page:1})}},t=C.getComponent("grid-view");a.gridView=new t(e),a.reportColumsView(a.gridView.$data.colums)},reportColumsView:function(e){setTimeout(function(){c(e).each(function(e,t){t&&t.key&&0==t.hide&&m.click("yunzhuji.colums.show."+t.key)})},2e3)},getColumns:function(){var e=[];for(var t in I.fields){var i=I.fields[t],a={key:t,name:i.name,width:i.width,order:i.sort,orderField:i.orderField,locked:i.locked,hide:!i.defaults&&!i.required,required:i.required,minWidth:i.minWidth,relatedVpc:i.relatedVpc};e.push(a)}return e},getCellContent:function(e,t,i){switch(i.key){case"idName":return $({item:t,regionId:this.getRegionId(this.queryStr),i:this.gridView.list.indexOf(t),len:this.listData.length});case"_monitor":return W({item:t});case"statusDesc":return B({item:t});case"ip":var a=t.deviceLanIp||"-",s=t.deviceWanIp||"-",n=t.eipInfo,o=this.eipQuotaData;return M({deviceLanIp:a,deviceWanIp:s,eipInfo:n,eipQuotaData:o});case"cdHost":return t.uHostId?A:'<span class="text-overflow" >-</span>';case"cvmPayModeDesc":return'<span class="text-overflow" title="'+(t.uHostId?"":e)+'">'+(t.uHostId?"不计费":e||"")+"</span>";case"deadlineInfo":return t.uHostId?'<span class="text-overflow" >无</span>':R({item:t});case"addTimeStamp":return t.addTimeStampFormated=v.formatDate(v.getDate(t.addTimeStamp),"yyyy-MM-dd"),O({item:t});case"relatedVpc":return F({item:t});case"_operCol":return N({uHostId:t.uHostId,isPrepaidUser:this.isPrepaidUser,isSecondPayMode:this.isSecondPayMode(t)});default:return'<span class="text-overflow" title="'+e+'">'+(e||"")+"</span>"}},isSecondPayMode:function(e){return e.cvmPayMode===o.CVMPAYMODE.SECOND},setTrAttr:function(e,t){e={"data-role":"cvm_row","data-deviceLanIp":t.deviceLanIp,"data-uuid":t.uuid,"data-href":this.getLinkPath(this.lastParams)+"&uuid="+t.uuid},t.$loading&&(e["data-isLoading"]=!0);var i=T.get("cvmPackData");for(var a in i){var s=i[a];s.uInstanceId==t.uInstanceId&&(s.$loadingDetail=t.$loading)}return e},getList:function(a,s,e,n,t){w.destroy&&w.destroy(),this.lastParams=a;var o=this,i=this.options,r=this.isViewMode(),d=a.count||i.perPageCount,l=i.renderMonitor,c=this.cvmListEl,p=this.operAreaEl,u=parseInt(a.page),h=d*(u-1),m=a.multiIp&&o.curIpList&&o.curIpList.length;a.pid=this.getProjectId(a),a.rid=this.getRegionId(a),f.getCvmList({count:d,offset:h,projectId:a.pid,regionId:a.rid,vpcId:a.vpcId,uuidList:a.uuid?[a.uuid]:undefined,uInstanceIdList:a.instanceId?[a.instanceId]:undefined,uHostIdList:o.curHostIdList||undefined,alias:a.alias,vagueIp:a.vagueIp,ipList:m?o.curIpList:undefined,method:m?"post":"get",orderField:a.orderField||"addTimeStamp",order:a.order,linkedVpc:1,subnetIdList:a.subnetIds?[a.subnetIds]:undefined},function(i){if(!o.entryObj||o.entryObj.pageActive)return n&&!t&&o.userIsDoing()?o.checkTask():void f.getProjects(function(){o.originalData=i,o.eipQuotaData=i.eipQuotaData,o.listData=new y({data:i.deviceList,isPrepaidUser:i.isPrepaidUser,isBandwidthPackageUser:i.isBandWidthPackageUser,serverTimestamp:i.serverTimestamp}),o.isBandwidthPackageUser=i.isBandWidthPackageUser,o.isPrepaidUser=i.isPrepaidUser;for(var e=0;e<o.listData.length;e++)o.listData[e].isPrepaidUser=o.isPrepaidUser,o.listData[e].isBandwidthPackageUser=o.isBandwidthPackageUser;var t;(T.set("cvmPackData",o.listData),p.html()||o.renderBtnGroup(i.isPrepaidUser,i.isBandWidthPackageUser),c.html()||(o.cvmListEl.append(o.gridView.$el),o.gridView.checkCellWidth()),o.aliasIndex=0,o.gridView.setData({list:o.listData,totalNum:i.totalNum,page:u,count:d,searchKey:o.getSearchStr(),orderField:a.orderField||"addTimeStamp",order:a.order}),o.queryStr.instanceId&&(o.listData&&0<o.listData.length?o.gridView.showTips('<span class="text"></span>结果如下，<a data-event="nav" href="/cvm/index">返回列表</a>'):o.gridView.showTips('<span class="text"></span>您查看的对象已不存在或没有权限查看，<a data-event="nav" href="/cvm/index">返回列表</a>')),o.isBandwidthPackageUser&&o.cvmListEl.find('[data-orderfield="bandwidthInfo"]').find(".text-overflow").text("带宽上限"),o.selectedRow(),o.initCopy(),o.initRowOper(),r)&&(s?(t=c.find('tr[data-role="cvm_row"]').eq(0))&&t.length?g.navigate(t.attr("data-href")):g.navigate(o.getLinkPath(a)):!n&&l&&l());o.checkTask(),w.refresh(),o.needSpeedReport&&(v.speedReport("cvm"),o.needSpeedReport=!1)})},function(){o.lastParams={}},e,n)},initCopy:function(){var e=this.cvmListEl.find(".ip-cell"),t=e.find("[data-clipboard-text]");new P({handle:t,container:e})},initRowOper:function(){var l=this;this.cvmListEl.find("tr").find(".tc-15-dropdown").each(function(e,t){var i=c(t),a=i.closest("tr");if(a.attr("data-isLoading")){var s=a.find(".cvm-oper-cell");return s.find("> a").addClass("disabled").attr("data-title","正在执行任务"),void s.find(".tc-15-dropdown-link").addClass("disabled").attr("data-title","正在执行任务")}var n,o=["vnc","renew"],r=new x({dataItems:[l.getSelectedItemData(a.attr("data-index"))],operAction:o,listIns:l}).getAuth();for(e=0;n=o[e];e++){var d=a.find('[data-name="'+n+'"]');r[n]&&d.length&&(0===r[n].code?d.removeClass("disabled").attr("data-title",""):d.addClass("disabled").attr("data-title",r[n].tip))}i.off("click").on("click",function(){return c(this).find(".disabled").length||l.showRowDropDown(this),!1})});var e=function(){var e=c("#cvmRowDropdown");e.length&&e.remove()};this.cvmListEl.find(".tc-15-table-fixed-body").off("scroll.cvmRowDropdown").on("scroll.cvmRowDropdown",function(){e()}),c(document).off("nmcDropdownHide").on("nmcDropdownHide",function(){e()})},showRowDropDown:function(e){var i=this,a=c(e),t=a.closest("tr"),s=i.getSelectedItemData(t.attr("data-index")),n=c("#cvmRowDropdown");n.remove(),n=c(z({isPrepaidUser:this.isPrepaidUser,isBandwidthPackageUser:this.isBandWidthPackageUser,notShow_changeproject:this.notShow_changeproject,notShow_firewall:this.notShow_firewall,isSnapAbility:s.isSnapAbility})).hide(),this.cvmListEl.append(n);var o=new p(n,{newMode:!0});n.data("dropdown",o),n.data("onTr",t);var r=function(){var e=a.offset(),t=i.cvmListEl.offset();n.css({left:e.left-t.left,top:e.top-t.top})};r(),n.show().data("dropdown").show(),setTimeout(function(){n.css("left").replace("px","")!=a.offset().left-i.cvmListEl.offset().left&&r()},50),c(window).off("resize.cvmRowDropdown").on("resize.cvmRowDropdown",r),w.displayOperMenu(n,t)},renderBtnGroup:function(e,t){var i=this,a=this.operAreaEl;a.html(l.tmpl(D,{isPrepaidUser:e,isBandwidthPackageUser:t,rId:this.lastParams.rid})),this.searchAreaEl=c("#searchArea");var s=C.components["qc-search"],n=this.search=new s({$data:{keyword:this.getSearchStr(),searchEmpty:!0,multiple:!0,placeholder:"请输IP(换行分隔)或主机名"},search:function(e){var t=i.getCvmAnalyseValue(e)||{};i.curIpList=t.ipList,i.curHostIdList=t.uHostIdList,t.ipList&&(i.lastParams.multiIp=undefined),t.uHostIdList&&(i.lastParams.uHostIds=undefined),i.navigate({page:1,alias:t.alias,multiIp:t.ipList,uHostIds:t.uHostIdList?encodeURIComponent(t.uHostIdList.join(",")):undefined,vagueIp:t.vagueIp,uHostId:t.uHostId}),m.click("yunzhuji.search")}});this.searchAreaEl.html("").append(n.$el),this.moreDropdown=new p(a.find(".tc-15-dropdown"),{newMode:!0}),w.init(this),e||c(".manage-area-title").append(_);var o=[{reboot:{name:"重启",callback:i.execContextMenu},boot:{name:"开机",callback:i.execContextMenu},shutdown:{name:"关机",callback:i.execContextMenu}},{renew:{name:"续费",callback:i.execContextMenu},upgradeconfig:{name:"调整配置",callback:i.execContextMenu},upgradedisk:{name:"调整磁盘",callback:i.execContextMenu},upgradebandwidth:{name:"调整网络",callback:i.execContextMenu},alias:{name:"改名",callback:i.execContextMenu},changeproject:{name:"分配至项目",callback:i.execContextMenu},bindkeypair:{name:"加载密钥",callback:i.execContextMenu},createimg:{name:"制作镜像",callback:i.execContextMenu},firewall:{name:"配置安全组",callback:i.execContextMenu}},{resetpwd:{name:"重置密码",callback:i.execContextMenu},resetos:{name:"重装系统",callback:i.execContextMenu},snapshot:{name:"创建快照",callback:i.execContextMenu},returncvm:{name:"退还服务器",callback:i.execContextMenu},destroycvm:{name:"销毁",callback:i.execContextMenu},"export":{name:"导出信息",callback:i.execContextMenu}},{bindEip:{name:"绑定弹性IP",callback:i.execContextMenu},unbindEip:{name:"解绑弹性IP",callback:i.execContextMenu}}];e?delete o[2].returncvm:(delete o[2].destroycvm,delete o[1].upgradeconfig,delete o[1].upgradedisk,delete o[1].renew),f.getProjects(function(e){var t=i.projectData=e.data;(!e.isShowAll||t.length<2)&&(delete o[1].changeproject,d.appArea.find('[data-control="changeproject"]').remove(),i.notShow_changeproject=!0),i.contextMenu=new h({object:i.cvmListEl,selector:"tbody tr",data:o,filterClass:"cvm-oper-cell",onShow:function(e,t,i){w.displayOperMenu(t,i)}})});var r="CVM_FIREWALL";f.getAllWhiteList(function(e){e&&e[r]&&e[r].length||(delete o[1].firewall,d.appArea.find('[data-control="firewall"]').remove(),i.notShow_firewall=!0)})},execContextMenu:function(e,t){w.execRowMenuItem(e,t)},getCvmAnalyseValue:function(e){var t=/^(?:(?:[1-9]?[0-9]|1[0-9]{2}|2(?:[0-4][0-9]|5[0-5]))\.){3}(?:[1-9]?[0-9]|1[0-9]{2}|2(?:[0-4][0-9]|5[0-5]))$/,i=null;if(e)if(i={},/\n/.test(e)){for(var a,s=e.replace(/\s+/,"\n").split("\n"),n=[],o=[],r=!1,d=0;a=s[d];d++)if(t.test(a)){if(0==d&&(r=!0),!r)return u.error("暂不支持批量模糊搜索,请检查输入");n.push(a)}else{if(r||0!=a.indexOf("host-"))return u.error("暂不支持批量模糊搜索,请检查输入");o.push(a)}n&&0<n.length?i.ipList=n:o&&0<o.length&&(i.uHostIdList=o)}else/^\d{1,3}((\.(\d{1,3})?)?){0,3}$/.test(e)?i.vagueIp=e:0==e.indexOf("host-")?i.uHostIdList=[e]:i.alias=e;return i},isViewMode:function(){return!!this.queryStr.uuid},renderDataAfterInit:function(){this.options;var e=this.lastParams,t=this.queryStr,i=!1,a=this.isViewMode(),s=["page","rid","alias","uHostIds","vagueIp","multiIp","count","orderField","order"];this.projectsSelector.selector&&s.push("pid");for(var n,o=0;n=s[o];o++)if(t[n]!=e[n]){i=!0;break}i?(this.projectsSelector.val(t.pid),this.regionSelector.val(t.rid),!t.multiIp&&this.search.$set("keyword",this.getSearchStr()),this.renderList(t)):(a?this.renderOnViewExisted():(this.cvmListEl.find("tbody").find(".current").removeClass("current"),this.gridView.$set("loading",!1)),this.lastParams&&(this.lastParams.uuid=t.uuid))},renderOnViewExisted:function(){var e=this.options.renderMonitor;e&&e(),this.selectedRow()},selectedRow:function(){var a=this.queryStr,e=this.cvmListEl.find("tr");e.removeClass("current"),e.each(function(e,t){var i=c(t);i.attr("data-uuid")!==a.uuid||i.addClass("current")})},navigate:function(e){this.isViewMode()?this.renderList(e,!0):g.navigate(this.getLinkPath(e))},refresh:function(e){this.renderList(this.lastParams,!1,!1,!0,e)},checkTask:function(){var i=this,e=this.cvmListEl.find("tr");this.isWating=!1,e.each(function(e,t){if(c(t).attr("data-isLoading"))return!(i.isWating=!0)}),this.clearCheckTask(),this.isWating?this.watingTime=setTimeout(function(){i.userIsDoing()?i.checkTask():a&&(i.refresh(),a--)},5e3):this.setmaxReqNum()},userIsDoing:function(){var e=this.cvmListEl;return e.find(":checkbox:checked").length||this.isContextMenuShow()||e.find(".tc-15-menu-active").length},isContextMenuShow:function(){var e=c("#contextMenu");return e.length&&e.is(":visible")},clearCheckTask:function(){clearTimeout(this.watingTime)},bindEvent:function(){var o=this,e=this.cvmListEl;e.on("click",'[data-action="cvmCdh"]',function(e){var t=c(this).closest("tr"),i=parseInt(t.attr("data-index")),a=o.gridView.$refs.list[i],s=v.getRegionId();o.lastParams&&(s=o.lastParams.rid);var n="/cvm/cdh/detail/"+s+"/"+a.uHostId+"/1";g.navigate(n)}),e.on("click",'[data-action="cvm_view"]',function(e){if(!v.getSelectedText()){var t=c(this).closest("tr");!t.attr("data-isLoading")||t.attr("data-deviceLanIp")?(g.navigate(t.attr("data-href")),m.click("yunzhuji.line"),m.collect({operId:1,operType:2,from:"cvmlist"})):t.blur()}}),e.on("mouseenter",".update-icon",function(e){c(this).find(".tc-bubble").css("visibility","visible")}).on("mouseleave",".update-icon",function(e){c(this).find(".tc-bubble").css("visibility","hidden")}),e.on("click",'[data-action="upgradeToKvm"]',function(e){var t=c(this).closest("tr"),i=parseInt(t.attr("data-index"));o.gridView.$refs.list[i].$set({$selected:!0});var a=new r({listIns:o,selectedItems:[{uuid:t.attr("data-uuid"),el:t}]});return b.render(a),m.click("yunzhuji.cvm_list_xen2kvm"),!1}),e.on("mouseenter",".id-name-cell",function(e){c(this).find(".pencil-icon").css("visibility","visible")}).on("mouseleave",".id-name-cell",function(e){c(this).find(".pencil-icon").css("visibility","hidden")}),e.on("click",'[data-action="editAlias"]',function(e){var t=c(this);return w.execRowMenuItem(t.closest("tr"),t),!1}),e.on("click",'[data-action="wipToEip"]',function(e){var t=c(this);return w.execRowMenuItem(t.closest("tr"),t),!1})},addCvm:function(){var e=o.BUY_HOST;this.lastParams&&(e+="cvm?regionId="+this.lastParams.rid+"&projectId="+this.lastParams.pid),window.open(e,"_blank")},showVnc:function(e){var t=c(e).closest("tr"),i="https://vnc.qcloud.com/?";i+="innerIp="+t.attr("data-deviceLanIp"),i+="&uuid="+t.attr("data-uuid"),i+="&regionId="+this.getRegionId(this.queryStr),window.open(i,"","width=830,height=630,location=no")},backList:function(){var e=this.lastParams,t=l.cloneObject(e,{ignore:"uuid"});g.navigate(this.getLinkPath(t))},getLinkPath:function(e){var t="/cvm/index?",i="";return this.projectsSelector.selector&&(t+="pid="+this.getProjectId(e),i="&"),t+=i+"rid="+this.getRegionId(e),t+="&page="+e.page,e.alias&&(t+="&alias="+encodeURIComponent(e.alias)),e.vagueIp&&(t+="&vagueIp="+e.vagueIp),e.vpcId&&(t+="&vpcId="+e.vpcId),e.instanceId&&(t+="&instanceId="+e.instanceId),e.uHostIds&&(t+="&uHostIds="+e.uHostIds),e.multiIp&&(t+="&multiIp=1"),e.count&&e.count!=this.options.perPageCount&&(t+="&count="+e.count),"addTimeStamp"==e.orderField&&1==e.order||(e.orderField&&(t+="&orderField="+e.orderField),"order"in e&&(t+="&order="+e.order)),t},getSelectedItemData:function(e){e=parseInt(e);var t={},i=this.listData;return i&&(t=i[e]),t},getProjectId:function(e){return e.pid!==undefined?e.pid:v.getProjectId()},getRegionId:function(e){return e.rid!==undefined?e.rid:v.getRegionId()},getSearchStr:function(){var e=this.queryStr,t="";return e.alias?t=e.alias:e.vagueIp?t=e.vagueIp:e.uHostId?t=e.uHostId:e.uHostIds&&(t="",this.curHostIdList&&0<this.curHostIdList.length&&(t=this.curHostIdList.join("\n"))),t},setmaxReqNum:function(){a=200},destroy:function(){this.clearCheckTask(),w.destroy&&w.destroy(),this.setmaxReqNum(),c(document).off("updateColumByField").off("nmcDropdownHide"),c(window).off("resize.cvmRowDropdown")}},i.exports=j}),define("widget/cvmList/data_package",function(e,t,i){var n=e("constants"),o=e("appUtil"),a=e("manager"),s=e("util"),r=null,d=n.DISKTYPE,l=function(e){for(var t,i=this,a=e.data,s=((this.options=e)&&e.ipBlocked,0);t=a[s];s++)t.operateAuth=t.operateAuth||0,t.opsAvailable=o.getOperationTag(t.operateAuth,t.runflag),i.statusDesc(t),i.cvmPayModeDesc(t),i.networkPayModeDesc(t),i.deadlineInfo(t),i.diskInfo(t),i.cpuInfo(t),i.memInfo(t),i.canUpgradeToKvm(t),i.projectName(t),i.bandwidthInfo(t),i.deviceImageIdInfo(t),i.checkSnapAbility(t);return a};l.prototype={statusDesc:function(e){var t=e.statusDesc;e.$loading=!1,"故障"!==t&&"运行中"!==t&&"已退还"!==t&&"已关机"!==t&&"待回收"!==t&&"重装失败"!==t&&(e.$loading=!0);var i="";if(i="运行中"===t||"已关机"===t?"succeed":"故障"===t?"warning":"待回收"===t?"error":"restart",e.statusDesc='<span class="text-overflow '+i+'">'+t+"</span>",1==e.isSafeIsolated){var a=e.safeIsolatedInfo;e.statusDesc='<span class="text-overflow warning">'+t,e.statusDesc+='<i class="ico-warning" qc-popover="服务器由于有安全风险外网已被隔离，请尽快处理安全风险，解除风险后'+s.tmpl("<%=text%>",{text:'<a data-event="nav" href="/workorder/create?level1_id=6&level2_id=7&level1_name=计算与网络&level2_name=云服务器%20CVM">提交工单</a>'})+"给我们确认执行结果；&#10;具体安全风险："+a+'"></i></span>'}else e.ipBlocked?(e.statusDesc='<span class="text-overflow warning">'+t,e.statusDesc+='<i class="ico-warning" qc-popover="服务器由于受到攻击被封堵。两个小时后自动解封，你也可购买'+s.tmpl("<%=text%>",{text:'<a href="https://buy.qcloud.com/bgp_sp">购买</a>BGP<a href="https://www.qcloud.com/document/product/297/8337">高防服务包</a>'})+'来应对攻击，恢复业务。"></i></span>'):34==e.runflag&&(e.statusDesc='<span class="text-overflow warning">'+t,e.statusDesc+='<i class="ico-warning" qc-popover="重装系统失败，请重新尝试，若多次失败，请 '+s.tmpl("<%=text%>",{text:'<a data-event="nav" href="/workorder/create?level1_id=6&level2_id=7&level1_name=计算与网络&level2_name=云服务器%20CVM">提交工单</a>'})+' 联系我们"></i></span>')},cvmPayModeDesc:function(e){var t="包年包月";e.uHostId?t="不计费":e.cvmPayMode===n.CVMPAYMODE.SECOND?t="按量计费":this.options.isPrepaidUser||(t="后付费"),e.cvmPayModeDesc=t},networkPayModeDesc:function(e){var t="按带宽包年包月计费";e.networkPayMode===n.NETWORKPAYMODE.FLOW?t="按流量计费":e.networkPayMode===n.NETWORKPAYMODE.SECOND?t="按带宽使用时长计费":this.options.isBandwidthPackageUser?t="共享带宽包":this.options.isPrepaidUser||(t="按带宽后付费月结"),e.networkPayModeDesc=t},deadlineInfo:function(e){e.deadlineInfo=function(e,t){var i,a,s=new Date(e.replace(/\-/g,"/")),n="";i=(t&&!isNaN(t)?t:(new Date).getTime())-s.getTime(),n="0000-00-00 00:00:00"==e?"-":0<i?(a=Math.floor(i/864e5))<1?'<span class="text-overflow status-recover error">已过期1天</span>':'<span class="text-overflow status-recover error">已过期'+a+"天</span>":i<-6048e5?o.formatDate(o.getDate(e),"yyyy-MM-dd"):(a=Math.floor(Math.abs(i/864e5)))<1?'<span class="text-overflow warning">小于1天到期</span>':'<span class="text-overflow warning">'+a+"天后到期</span>";return n}(e.deadline,this.options.serverTimestamp)},canUpgradeToKvm:function(e){var t=n.HYPERVISOR,i=n.ZONEID.GZ1,a=!1;this.options.isPrepaidUser&&t&&t.ENABLE&&e.opsAvailable.XENTOKVM&&(e.zoneId!=i||!e.cbsList.length)&&(a=!0,t.ENABLE_WINDOWS||"windows"!==e.osType?!t.ENABLE_CBS&&e.cbsList&&e.cbsList.length&&(a=!1):a=!1),e.canUpgradeToKvm=a},diskInfo:function(e){var t=d[e.rootType];e.sysDiskInfo=e.rootSize+"GB",t&&e.rootSize&&(e.sysDiskInfo+="("+t+")");var i=d[e.diskType];if(0<=$.inArray(+e.diskType,n.DISK_CATEGORY.cloud)&&0!=e.status){var a=0;if(e.cbsList&&0<e.cbsList.length)for(var s=0;s<e.cbsList.length;s++)e.cbsList[s].diskType&&"data"!==e.cbsList[s].diskType||(a+=e.cbsList[s].diskSize);e.diskInfo=a+"GB",i&&a&&(e.diskInfo+="("+i+")"),e.uHostId&&0==a&&(e.diskInfo="无")}else e.diskInfo=e.disk+"GB",i&&e.disk&&(e.diskInfo+="("+i+")")},cpuInfo:function(e){e.cpuInfo=!e.deviceClass||"v1.0.5"!=e.deviceClass.toLowerCase()&&"v1.1"!=e.deviceClass.toLowerCase()?e.cpu+"核":"共享核"},memInfo:function(e){e.memInfo=e.deviceClass&&"v1.0.5"==e.deviceClass.toLowerCase()?e.mem+"MB":e.mem+"GB"},projectName:function(s){r?s.projectName=r[s.projectId]||"已停用项目":a.getProjects(function(e){var t=e.data;r={};for(var i,a=0;i=t[a];a++)r[i.projectId]=i.name;s.projectName=r[s.projectId]||"已停用项目"})},bandwidthInfo:function(e){e.bandwidthInfo=e.bandwidth+"Mbps",65535==e.bandwidth&&(e.bandwidthInfo="无限制")},deviceImageIdInfo:function(e){e.deviceImageIdInfo=e.deviceImageId,e.unImgIdInfo=e.unImgId,0==e.deviceImageId&&(e.deviceImageIdInfo="-"),e.unImgId||(e.unImgIdInfo="-")},checkSnapAbility:function(e){for(var t=!1,i=0,a=e.cbsList.length;i<a;i++)if(1==e.cbsList[i].cbsSnap){t=!0;break}e.isSnapAbility=t}},i.exports=l}),define("widget/cvmList/destroycvm/destroycvm",function(e,t,i){var c=e("$"),p=e("manager"),o=e("constants"),u=e("util"),h=e("appUtil"),a=e("widget/cvmList/operate_base"),m=e("dialog"),s=e("validator"),f=e("widget/selectedShow/selectedShow"),v=e("modules/cvm/cdh/dialog/destroy"),g=(h=e("appUtil"),o.VCODEURL),n='    <div>        <style type="text/css">            .swapnotes li{padding:4px 0; list-style-type:disc; margin-left: 20px}            </style>            <div class="tc-15-option-hd">                <h3>销毁选中的云主机？</h3>            </div>            <div class="tip_box" style="margin-top:10px;">                <ul class="swapnotes">                    <li>销毁后所有数据将被清除且不可恢复,请提前备份数据。</li>                </ul>            </div>            <ul class="form-list" b-if="hasEip">                <li>                    <div class="form-label">                        <label for="">云主机绑定的弹性公网IP :</label>                    </div>                    <div class="form-input">                        <a href="https://console.qcloud.com/cvm/eip" target="_blank">查看弹性公网IP绑定情况  <i class="external-link-icon"></i></a>                    </div>                </li>            </ul>            <div b-if="hasEip">                <label class="form-ctrl-label-stacked">                    <input type="radio" class="tc-15-radio" b-model="isDeleteEip" value="0">保留。将先解绑弹性公网IP再销毁主机，解绑后的弹性公网IP可以给其他主机继续使用。                    <p class="text-danger" style="margin: 5px 0px 0px 15px;">（注意：解绑后的弹性公网IP属于闲置状态，会收取{{toI18nMoney(eipPrice, moneyFormat)}}/小时的闲置费用）</p>                </label>                <label class="form-ctrl-label-stacked">                        <input type="radio" class="tc-15-radio" b-model="isDeleteEip" value="1">弹性公网IP与主机连带删除。<span class="text-danger">以后将无法找回该弹性公网IP。</span>                </label>            </div>            <ul class="form-list">                <li>                    <div class="form-label">                        <label for="">请输入验证码</label>                    </div>                    <div class="form-input">                        <div class="tc-15-input-text-wrap">                            <input type="text" b-ref="vcodeInput" b-model="vcode" class="tc-15-input-text m" style="width: 126px;;">                            <a b-on-click="changeVcode()" href="javascript:;" class="captcha"><img src="{{vcodeUrl}}"></a>                            <div class="tc-15-input-tips captcha-tips"></div>                        </div>                    </div>                </li>            </ul>    </div>',r='<div>    <style type="text/css">            .swapnotes li{padding:4px 0; list-style-type:disc; margin-left: 20px}    </style>    <div class="tc-15-option-hd">        <h3>销毁选中的云主机？</h3>    </div>    <div class="tip_box" style="margin-top:10px;">        <ul class="swapnotes">            <li>销毁后所有数据将被清除且<span class="text-danger">不可恢复</span>，请提前备份数据。</li>            <li >如果含有弹性IP（含辅助网卡上的IP）和弹性云盘，机器退还后会继续保留，闲置IP会产生费用。如不需保留，请到对应资源管理页面进行释放。</li>            <li>资源删除后，剩余金额将自动返还到您的<strong>赠送账户</strong>，<span class="text-danger">不可提现</span>。<a href="https://www.qcloud.com/document/product/213/9711" target="_blank">退费规则  <i class="external-link-icon"></i></a></li>        </ul>    </div>    <ul class="form-list">        <li><div class="form-label">                <label for="">请输入验证码</label>            </div>            <div class="form-input">                <div class="tc-15-input-text-wrap">                    <input type="text" b-ref="vcodeInput" b-model="vcode" class="tc-15-input-text m" style="width: 126px;;">                    <a b-on-click="changeVcode()" href="javascript:;" class="captcha"><img src="{{vcodeUrl}}"></a>                    <div class="tc-15-input-tips captcha-tips"></div>                </div>            </div>         </li>    </ul>    <div style="margin-top:10px;">                <input type="checkbox" id="confirmEnter" b-model="confirm"/>                <label for="confirmEnter">我已清楚费用问题，如不需要我会退还挂载在该云主机上的资源</label>    </div></div>',w='<div>    <strong style="font-size:16px"><%- reason %><strong></div>',b=function(e){var a=e.hasPermItems[0],i=new(Bee.extend({$tpl:r,$afterInit:function(){this.$watch("confirm",function(e){m.toggleBtnDisable(!e)})},changeVcode:function(){this.$set("vcodeUrl",g+"&t="+(new Date).getTime())}},{defaults:{vcodeUrl:g+"&t="+(new Date).getTime()}}))({$data:{vcodeUrl:g+"&t="+(new Date).getTime()}});m.create(i.$el,"545","",{title:"销毁云主机",buttonDisable:[1],preventResubmit:!0,hideIcon:!0,defaultCancelCb:function(){i.$destroy()},button:{"确定":function(){var e=c.trim(i.$get("vcode")),t=i.$refs.vcodeInput;if(!e)return y("请输入验证码",t);i.$get("confirm")?p.verifyCode({vcode:e},function(e){if(e){var t={business:"cvm",regionId:h.getRegionId(),resourceIdList:[a.uInstanceId]};i={rawRefundList:[t]},h.submitForm("https://buy.qcloud.com/refund/check",i)}var i}):m.hide()}}}),f.render(e.selectedShowOptions)},I=Bee.extend({$tpl:n,toI18nMoney:e("widget/i18n").toI18nMoney,$afterInit:function(){this.$watch("isDeleteEip",function(e){m.toggleBtnDisable(!1)})},changeVcode:function(){this.$set("vcodeUrl",g+"&t="+(new Date).getTime())}},{defaults:{moneyFormat:"words",vcodeUrl:g+"&t="+(new Date).getTime()}});function y(e,t){var i={tip:e,errMode:1};return s.showErr(t,i),!1}var d=function(e){a.call(this,e)};(d.prototype=new a).exec=function(){var r=this,d=this.hasPermItems,t=!1,i=!1;d.forEach(function(e){e.uHostId&&(t=!0),e.eipInfo&&(i=!0)});var e=i?1:0;if(t){var a=new v({selectedItems:d});m.create(a.$el,"600","",{title:"销毁","class":"dialog_layer_v2 tc-15-rich-dialog",preventResubmit:!0,button:{"确定":function(e){a.doAction(m,null,function(e){r.checkTask(e,"销毁中")})}}})}else if(r.noReturn||1!==d.length||1!==d[0].cvmPayMode){var l=new I({$data:{hasEip:i,eipPrice:o.EIP_REGION_PRICE[h.getRegionId()].price,vcodeUrl:g+"&t="+(new Date).getTime()}});m.create(l.$el,"605","",{title:"销毁云主机",buttonDisable:[e],preventResubmit:!0,hideIcon:!0,defaultCancelCb:function(){l.$destroy()},button:{"确定":function(){var e=[],t=[],i=c.trim(l.$get("vcode")),a=l.$refs.vcodeInput;if(!i)return y("请输入验证码",a);for(var s,n=l.$get("isDeleteEip"),o=0;s=d[o];o++)e.push(s.uuid),t.push(s.uInstanceId);p.destroyCvm({resourceIds:t,uuidList:e,autoDeleteEipFlag:n,vcode:i},function(e){m.hide(),r.checkTask(e,"销毁中")})}}}),f.render(this.selectedShowOptions)}else{var s=d[0],n={goodsInfo:[{business:"cvm",regionId:s.regionId,resourceIdList:[s.uInstanceId]}]};p.canPrepaidReturn(n,function(e){var t=e.refundList[s.uInstanceId].allow,i=(e.refundList[s.uInstanceId].fiveday,e.refundList[s.uInstanceId].reason);t?b(r):function(e){var t="",i='<a href="https://cloud.tencent.com/document/product/213/9711" target="_blank">销毁包年包月实例规则</a>';switch(e){case 1:t="包年包月已升降配实例暂不支持销毁，敬请期待功能升级，具体详情请查看"+i;break;case 2:t="代理商客户购买包年包月实例不支持销毁，具体详情请查看"+i;break;case 3:t="包年包月实例已购买超过5天不支持销毁，具体详情请查看"+i;break;default:t="该实例暂不支持销毁，敬请期待功能升级，具体详情请查看"+i}var a=u.tmpl(w,{reason:t});m.confirm(a,function(){m.hide()},null,{title:"系统通知",width:420,mainBtnName:"确定",defaultCancelBtn:!1})}(i)})}},i.exports=d}),define("widget/cvmList/eip/bindEip",function(e,t,i){var n=e("$"),a=(e("manager"),e("widget/cvmList/operate_base")),o=e("dialog"),r=e("tips"),d=e("util"),l=e("appUtil"),c=(e("lengthlimiter"),e("widget/selectedShow/selectedShow"),e("modules/cvm/eip/common")),p=Bee.getComponent("qc-dropdown-list"),u='<ul class="form-list">    <li>        <div class="form-label required">            <label for="">云主机</label>        </div>        <div class="form-input">            <p><%=uInstanceId%><br>(<%=alias%>)</p>        </div>    </li>    <li>        <div class="form-label required">            <label for="">当前IP</label>        </div>        <div class="form-input">        <% if(deviceWanIp){ %>            <p><%=deviceWanIp%><span class="text-label text-danger" style="margin-left: 15px;">(此公网IP将被释放)</span></p>        <% }else{ %>            <p>-<span class="text-label" style="margin-left: 15px;">(该云主机没有公网IP)</span></p>        <% } %>        </div>    </li>    <li>        <div class="form-label required">            <label for="">新IP</label>        </div>        <div class="form-input" style="width: 480px;">            <div class="cont-eip-select"></div><span style="margin-left: 5px; color: red;" class="eip-select-tips"></span>        </div>    </li></ul>',h='<span>您还没有弹性公网IP，</span><a href="/cvm/eip" data-event="nav" data-hot="yunzhuji.createeip" class="btn-createeip">点此创建</a>。',s='<div class="tc-15-msg"><strong>检测到这台实例已有公网IP(<%=item.deviceWanIp%>)，是否将其转化为EIP？</strong>    <p class="txt">特性：IP将保持不变，直接转为弹性公网IP保持绑定，且不中断您的服务！</p>    <p class="txt">配额：您最多可开通 <%=eipQuotaData.eipNumQuota%> 个EIP，已开通 <%=eipQuotaData.currentEipNum%> 个。</p>    <p class="txt">计费：为保证IP资源有效利用，未绑定实例的EIP，将按小时收取少量费用。</p>    </div>',m=function(e){a.call(this,e)};(m.prototype=new a).wipToEip=function(e){var t,i=this;t=this.hasPermItems[0],o.create(d.tmpl(s,{eipQuotaData:e,item:t}),540,"",{title:"转换为弹性公网IP",defaultCancelBtn:!1,button:{"确定转换":function(){i.sendWipToEipReq()},"其他EIP":function(){i.bind()}}}).find(".btn_blue").eq(1).removeClass("btn_blue ").addClass("btn_white_2")},m.prototype.sendWipToEipReq=function(){var t=this,e=t.hasPermItems[0];c.wipToEip({regionId:l.getRegionId(),unInstanceId:e.uInstanceId}).done(function(e){o.hide(),t.checkTask({taskId:e.requestId},"转换中")}).fail(function(e){})},m.prototype.getEipQuota=function(){return c.getEipQuota({regionId:l.getRegionId()})},m.prototype.exec=function(){var t,i=this;t=this.hasPermItems[0],i.getEipQuota().then(function(e){t.deviceWanIp&&"-"!=t.deviceWanIp&&!t.eipInfo&&e&&e.currentEipNum<e.eipNumQuota?i.wipToEip(e):i.bind()})},m.prototype.bind=function(){var e,s=this;e=this.hasPermItems[0],o.create(d.tmpl(u,e),540,"",{title:"绑定弹性公网IP",button:{"确定":function(){s.sendReq()}},onload:function(e){}}),c.getEipList({regionId:l.getRegionId(),status:[4],page:1,count:60}).then(function(e){e.totalCount;var t=e.data.eipSet;if(0!=t.length){s.listData=t;var i=[{eipId:-1,arrears:0,label:"请选择弹性公网IP"}];n.each(t,function(e,t){i.push({eipId:t.eipId,eip:t.eip,label:t.eip,arrears:t.arrears})});var a=s.dropdown=new p({$data:{list:i,simulateSelect:!0}});a.$on("selected",function(e){1==e.arrears?(o.toggleBtnDisable(!0,0),o.el.find(".eip-select-tips").text("该EIP已欠费隔离中")):(o.toggleBtnDisable(!1,0),o.el.find(".eip-select-tips").text(""))}),o.el.find(".cont-eip-select").html(a.$el),o.el.find("ul.tc-15-simulate-option").css("width","140px"),o.el.find("ul.tc-15-simulate-option").width(140)}else o.el.find(".cont-eip-select").html(h)}),s.initEvent()},m.prototype.initEvent=function(){},m.prototype.sendReq=function(){var t=this,e=t.hasPermItems[0],i=t.dropdown&&t.dropdown.$get("selected");if(i&&-1!=i.eipId){var a=e.deviceWanIp,s="请确认弹性公网IP："+i.eip+" 的绑定操作。";a&&(s+="<br>绑定后，原来的公网IP："+a+' 将被释放回腾讯云，<span style="color: red;">无法找回！</span>'),c.getConfirm({title:"绑定弹性公网IP",content:s},function(){c.bindEip({regionId:l.getRegionId(),eipId:i.eipId,unInstanceId:e.uInstanceId}).done(function(e){o.hide(),t.checkTask({taskId:e.requestId},"绑定中")}).fail(function(e){})})}else r.error("请选择弹性公网IP")},i.exports=m}),define("widget/cvmList/eip/unbindEip",function(e,t,i){e("$"),e("manager");var a=e("widget/cvmList/operate_base"),s=e("dialog"),n=(e("tips"),e("util")),o=e("appUtil"),r=(e("lengthlimiter"),e("widget/selectedShow/selectedShow"),e("modules/cvm/eip/common")),d=e("modules/cvm/eip/data"),l='<div class="unwrap-ip"><p class="tc-15-msg">    <strong>确定将该弹性公网IP与绑定的云资源&nbsp<%=selectedItem.uInstanceId%>(<%=selectedItem.alias || "未命名"%>)&nbsp解绑？</strong>    <br>解绑后，可能会影响您的业务，请提前做好准备。</p><ul class="form-list">    <li>        <div class="form-label required">            <label for="">费用</label>        </div>        <div class="form-input">            <span class="price">                <span class="">￥<%=regionPrice.price%></span>                <em class="">/小时</em>                <em class="tit">解绑后，空置EIP将开始收费</em>            </span>        </div>    </li></ul><label class="form-ctrl-label-stacked" style="padding-top: 10px;"><input type="checkbox" id="allocWanIp" class="tc-15-checkbox">解绑后免费分配公网IP（注意，该公网IP随机分配，且无法与CVM解绑）</label></div>',c=function(e){a.call(this,e)};(c.prototype=new a).exec=function(){var e,t=this,i=((e=this.hasPermItems[0]).eipInfo,d.regionPrice[o.getRegionId()]||{});s.create(n.tmpl(l,{selectedItem:e,allocFlag:0,regionPrice:i}),540,"",{title:"解绑弹性公网IP",button:{"确定":function(){t.sendReq()}},onload:function(e){}})},c.prototype.sendReq=function(){var t=this,e=t.hasPermItems[0],i=e.eipInfo,a=s.el.find("#allocWanIp").prop("checked")?1:0;r.getConfirm({title:"解绑弹性公网IP",content:"请确认弹性公网IP："+i.eip+' 的解绑操作，<br>为保证资源有效利用，弹性公网IP空置状态将开始计费。<a href="http://www.qcloud.com/doc/product/213/%E5%BC%B9%E6%80%A7%E5%85%AC%E7%BD%91IP%EF%BC%88EIP%EF%BC%89#6.-弹性公网ip的计费"target="_blank">费用情况说明</a>。</strong><br>解绑后，您的服务可能会受影响，请提前做好准备！'},function(){r.unBindEip({regionId:o.getRegionId(),eipId:i.eipId,unInstanceId:e.uInstanceId,allocWanIp:a}).done(function(e){s.hide(),t.checkTask({taskId:e.requestId},"解绑中")}).fail(function(e){})})},i.exports=c}),define("widget/cvmList/eip/wipToEip",function(e,t,i){e("$"),e("manager");var a=e("widget/cvmList/operate_base"),s=e("dialog"),n=(e("tips"),e("util")),o=e("appUtil"),r=(e("lengthlimiter"),e("widget/selectedShow/selectedShow"),e("modules/cvm/eip/common")),d='<div class="tc-15-msg">    <p class="txt">特性：IP将保持不变，直接转为弹性公网IP保持绑定，且不中断您的服务！</p>    <p class="txt">配额：您最多可开通 <%=eipQuotaData.eipNumQuota%> 个EIP，已开通 <%=eipQuotaData.currentEipNum%> 个。</p>    <p class="txt">计费：为保证IP资源有效利用，未绑定实例的EIP，将按小时收取少量费用。</p>    <strong>确定将公网IP转换为弹性公网IP？</strong></div>',l=function(e){a.call(this,e)};(l.prototype=new a).exec=function(){var t=this;this.hasPermItems[0],t.getEipQuota().then(function(e){s.create(n.tmpl(d,{eipQuotaData:e}),540,"",{title:"转换为弹性公网IP",button:{"确定":function(){t.sendReq()}},onload:function(e){}})})},l.prototype.sendReq=function(){var t=this,e=t.hasPermItems[0];r.wipToEip({regionId:o.getRegionId(),unInstanceId:e.uInstanceId}).done(function(e){s.hide(),t.checkTask({taskId:e.requestId},"转换中")}).fail(function(e){})},l.prototype.getEipQuota=function(){return r.getEipQuota({regionId:o.getRegionId()})},i.exports=l}),define("widget/cvmList/firewall/firewall",function(e,t,i){var a,s=e("$"),n=e("reporter"),o=(e("manager"),e("widget/cvmList/operate_base")),r=e("dialog"),d=e("tips"),l=e("util"),c=(e("appUtil"),e("event")),p=e("search"),u=e("router"),h=e("widget/selectedShow/selectedShow"),m=e("models/api"),f='<div class="change-safe-rule" id="cvmFirewall">        <div class="til clearfix">            <span>选择您需要配置的安全组</span>            <div id="cvmFirewallSearch" style="float:right"></div>        </div>        <ul class="safe-rule-list def-scroll" id="cvmFirewallList"></ul>    </div><div class="tc-15-msg warning" id="firewall-select-tip" style="margin-top: 10px;"><div class="tip-info"> 每个云主机至少需要加入一个安全组，<a href="//console.qcloud.com/cvm/securitygroup" target="_blank"><span>新建或查看我的安全组详情 <b class="external-link-icon"></b>。</span></a></div></div>',v='<% if (data.length) { %><% for (var i=0, item; item = data[i]; i++ ) { %><li>                <input class="radio" type="checkbox" id="rd<%- i %>" value="<%= item.sgId %>" name="rd_test" <% if (item._checked) { %> checked <% } %>><em class="inf" for="rd<%- i %>">ID: <%= item.sgId %> </em>                <label class="label" title="<%= item.sgName %>" style="max-width: 300px;  overflow: hidden; text-overflow: ellipsis" for="rd<%- i %>"><%= item.sgName %></label>            </li><% } %><% } else { %><li style="color:#999"><%- nodataHtml %></li><% } %>',g='当前过滤条件下没有安全组，<a href="javascript:void(0);" data-event="cvm_firewall_add">点击新建</a>',w='抱歉，未找到匹配安全组，请尝试其他搜索条件。<a href="javascript:void(0);" data-event="cvm_firewall_list_back">返回列表</a>',b=function(e){o.call(this,e)};(b.prototype=new o).exec=function(){var t=this;r.create(f,"540","",{title:"配置安全组",button:{"确定":function(){t.sendReq()}},preventResubmit:!0}),h.render(this.selectedShowOptions),a=2,this.wrapper=s("#cvmFirewall"),this.searchWrapper=s("#cvmFirewallSearch"),this.listEl=s("#cvmFirewallList"),this.search=new p({placeholder:"搜索安全组名称或ID",renderTo:this.searchWrapper,dialogMode:2,width:250,listFun:function(e){t.renderFirewallList(e)}}),this.renderFirewallList(),this.bindEvent()},b.prototype.bindEvent=function(){var e=this;c.bindCommonEvent(this.wrapper[0],"click",{cvm_firewall_list_back:function(){e.renderFirewallList("")},cvm_firewall_add:function(){r.hide(),u.navigate("/cvm/firewall")}}),this.wrapper.on("change",function(){e._checkBinding()})},b.prototype._checkBinding=function(){var e=0===this._getCheckedSgIds().length;r.toggleBtnDisable(e,0)},b.prototype.renderFirewallList=function(e){var t=this;if(e!=undefined)return e?this._searchList(e):this._renderList(this.listData,g);m.req({cmd:"DescribeSecurityGroups",serviceType:"dfw",data:{projectId:this.hasPermItems[0].projectId}}).then(function(e){t.listData=e.data,t._requestComplete()});var i=this.hasPermItems[0].uInstanceId;m.req({cmd:"DescribeSecurityGroupsOfInstance",serviceType:"dfw",data:{instanceIds:[i]}}).then(function(e){t.usgInfo=e.data.filter(function(e){return e.instanceId==i})[0].sgInfo||[],t._requestComplete()})},b.prototype._requestComplete=function(){0==--a&&this._renderList(this.listData,g)},b.prototype._searchList=function(e){var t=this.listData,i=[],a=new RegExp(e);if(t&&e)for(var s,n=0;s=t[n];n++)(a.test(s.sgId)||a.test(s.sgName))&&i.push(s);this._renderList(i,w,e)},b.prototype._renderList=function(e,t,i){var a=this,s=e.filter(function(t){return!a.usgInfo.some(function(e){return t.sgId==e.sgId})});s=a.usgInfo.filter(function(t){return t._checked=!0,e.some(function(e){return t.sgId==e.sgId})}).concat(s),this.searchStr=i,this.listEl.html(l.tmpl(v,{data:s,searchStr:i,nodataHtml:t})),this._checkBinding()},b.prototype._getCheckedSgIds=function(){var e=this.wrapper.find('[name="rd_test"]:checked'),t=this.wrapper.find('[name="rd_test"]'),a=e.map(function(){return s(this).val()}).toArray();return this.searchStr&&(a=this.usgInfo.map(function(e){return e.sgId}),t.each(function(){var e=s(this).val(),t=a.indexOf(e),i=s(this).prop("checked");-1<t&&!i?a.splice(t,1):-1===t&&i&&a.push(e)})),a},b.prototype.sendReq=function(){var e=this,t=e._getCheckedSgIds();m.req({cmd:"ModifySecurityGroupsOfInstance",serviceType:"dfw",data:{instanceSet:[{sgIds:t,instanceId:this.hasPermItems[0].uInstanceId}]}}).then(function(){r.hide(),e.refreshList(!0),d.success("操作成功"),s("#dfwDetail").trigger("firewallFieldRefresh")}),n.click("SecurityGroup.cvmAttachSG")},i.exports=b}),define("widget/cvmList/format/format",function(e,t,i){e("$");var d=e("manager"),a=e("widget/cvmList/operate_base"),l=(e("validator"),e("dialog")),c=e("tips"),p=(e("util"),e("widget/selectedShow/selectedShow")),u='<div class="coin-alert"><table class="ui-popmsg"><tbody><tr><td height="72" class="i"><i class="ico ico-warn mr10"></i></td><td height="72" class="t"><span class="info"><span class="tit">确定对选中主机的数据盘进行格式化？</span><br>    <span class="txt"><dl class="notice-list"><dt>注意：</dt>    <dd>1.格式化需要先关机服务器，完成后再开启服务器</dd><dd>2.格式化耗时较长且所有数据将清除且不可恢复</dd><dd>3.格式化前请确保服务器已停止对外服务</dd><dd>4.大于2TB硬盘不支持自动格式化，请查看<a href="http://wiki.qcloud.com/wiki/Linux%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%95%B0%E6%8D%AE%E7%9B%98%E5%88%86%E5%8C%BA%E5%92%8C%E6%A0%BC%E5%BC%8F%E5%8C%96#1._.E6.89.8B.E5.8A.A8.E6.A0.BC.E5.BC.8F.E5.8C.96" target="_blank" title="手动指引">手动指引</a></dd></dl>    </span></span></td></tr></tbody></table></div>',s=function(e){a.call(this,e)};(s.prototype=new a).exec=function(){for(var e,t=this,i=[],a=[],s=[],n=[],o=!0,r=0;e=t.hasPermItems[r];r++)e.cbsList&&e.cbsList.length?(s.push(e.deviceLanIp),n.push(e.uuid)):(i.push(e.deviceLanIp),a.push(e.uuid)),2e3<parseInt(e.disk)&&(o=!1);o?(l.create(u,530,"",{title:"格式化数据盘",preventResubmit:!0,button:{"确定":function(){t.sendReq(i,a,s,n)}}}),p.render(this.selectedShowOptions)):c.error("格式化失败，云服务器存在大于2TB的数据盘，请采用手动格式化方式")},s.prototype.sendReq=function(e,t,i,a){var s=this,n=function(e,t,i,a){d.formatCvmDisk({target:i,fstype:"ext3",ipList:e,uuidList:t,autoPowerOffFlag:0},function(e){a&&a(e)})},o=function(){n(i,a,"xvde",r)},r=function(e){l.hide(),s.checkTask(e,"格式化中")};e.length||t.length?n(e,t,"xvdb",function(e){i.length||a.length?o():r(e)}):o()},i.exports=s}),define("widget/cvmList/jsformutil",function(e,t,i){e("$");i.exports={jsFormSender:function(e,t,i,a){i=i||"post",a=a||"_self";var s=document.createElement("form");for(var n in s.setAttribute("method",i),s.setAttribute("action",e),s.setAttribute("target",a),s.style.display="none",t){if(t.hasOwnProperty(n))if("[object Array]"!==Object.prototype.toString.apply(t[n]))(r=document.createElement("input")).setAttribute("type","hidden"),r.setAttribute("name",n),r.setAttribute("value",t[n]),s.appendChild(r);else for(var o in t[n]){var r;(r=document.createElement("input")).setAttribute("type","hidden"),r.setAttribute("name",n),r.setAttribute("value",t[n][o]),s.appendChild(r)}}document.body.appendChild(s),s.submit(),setTimeout(function(){document.body.removeChild(s)},2e3)}}}),define("widget/cvmList/operate_auth",function(e,t,i){var n=e("constants"),a=function(e){this.options=e,this.listIns=e.listIns,this.checkOpsAvailable()};a.prototype={checkOpsAvailable:function(){this.auth={},this.feature={},this.allFeature={},this.multiTypeCvm={hourCvm:!1,cdhCvm:!1};for(var e,t=this.options.dataItems,i=0;e=t[i];i++){var a=e.opsAvailable;e.cvmPayMode===n.CVMPAYMODE.YEARMONTH&&(this.feature.BATCHRETURN=!0),a.DELETE&&(this.auth.DELETE=!0),a.REBOOT&&(this.auth.REBOOT=!0),a.BOOT&&(this.auth.BOOT=!0),a.SHUTDOWN&&(this.auth.SHUTDOWN=!0),a.RESETPW&&(this.auth.RESETPW=!0),a.FORMAT&&(this.auth.FORMAT=!0),a.RENAME&&(this.auth.RENAME=!0),a.CREATEIMG&&(this.auth.CREATEIMG=!0),a.SETBANDWIDTH&&(this.auth.SETBANDWIDTH=!0),a.RESETOS&&(this.auth.RESETOS=!0),a.SNAPSHOT&&(this.auth.SNAPSHOT=!0),a.UPGRADEBANDWIDTH&&(this.auth.UPGRADEBANDWIDTH=!0),a.RENEW&&(this.auth.RENEW=!0),a.UPGRADECONFIG&&(this.auth.UPGRADECONFIG=!0),a.DELIVERKEY&&(this.auth.DELIVERKEY=!0),a.CONNECTVNC&&(this.auth.CONNECTVNC=!0),a.XENTOKVM&&(this.auth.XENTOKVM=!0),"linux"!==e.osType?this.feature.WINDOWS=!0:this.allFeature.WINDOWS=!1,0!==parseInt(e.disk)||e.cbsList.length?this.allFeature.NOSPACE=!1:this.feature.NOSPACE=!0,0<e.vpcId?this.feature.VPC=!0:this.allFeature.VPC=!1,28==e.runflag?this.feature.ISOLATION=!0:this.allFeature.ISOLATION=!1;var s=e.runflag;[1,5,6,19,21,23,24,25,28].indexOf(s)<0&&(this.auth.FIREWALL=!0),4!==e.runflag?this.feature.NONSHUTDOWN=!0:this.allFeature.NONSHUTDOWN=!1,34==e.runflag?this.feature.RESETSYSTEMFAIL=!0:this.allFeature.RESETSYSTEMFAIL=!1,e.cvmPayMode==n.CVMPAYMODE.SECOND?(this.multiTypeCvm.hourCvm=!0,this.feature.CVMSECONDPAY=!0):this.allFeature.CVMSECONDPAY=!1,e.uHostId?(this.multiTypeCvm.cdhCvm=!0,this.feature.CDH_MACHINE=!0):this.allFeature.CDH_MACHINE=!1;!e.ipBlocked&&0<=[0,2,4,6,8,9,13,14,15,17,19,21,23,25,27,29,31,33,35,37,39,41,43,45].indexOf(s)&&(e.eipInfo?this.auth.UNBIND_EIP=!0:this.auth.BIND_EIP=!0),0<e.vpcId&&(this.auth.BIND_ENI=!0,this.auth.UNBIND_ENI=!0)}this.multiTypeCvm.hourCvm&&this.multiTypeCvm.cdhCvm&&(this.feature.MULTI_CVM=!0)},getAuth:function(){var e=this.options,t=e.dataItems,i=e.operAction;i="string"==typeof i?[i]:i;for(var a,s={},n=0;a=i[n];n++){var o=this.judgment[a];if(o){if(0<t.length&&"destroycvm"!=a&&"resetos"!=a){var r=this.isResetSystemFail();if(void 0!==r){s[a]=r;continue}}s[a]=o.call(this,t)}else s[a]={code:0}}return s},judgment:{alias:function(e){return 0<e.length?this.isOperable("RENAME")?this.enable():this.disable():this.disable("请选择需要改名的服务器")},bandwidthimit:function(e){return e.length<1?this.disable("请选择需要调整网络的服务器"):this.isOperable("SETBANDWIDTH")?this.enable():this.disable()},upgradebandwidth:function(e){if(e.length<1)return this.disable("请选择需要调整网络的服务器");if(!this.listIns.isPrepaidUser||this.listIns.isBandwidthPackageUser)return this.isOperable("SETBANDWIDTH")?this.enable():this.disable();var t=this.getItemsNetworkPayMode();return t.isSame?t.mode==n.NETWORKPAYMODE.FLOW?this.isOperable("SETBANDWIDTH")?this.enable():this.disable():this.isOperableUpBandwith()?this.enable():this.disable():this.enable()},upgradeconfig:function(e){return 1!==e.length?this.disable("请选择需要调整的单台服务器"):this.isOperableUpConfig()?this.hasFeature("NONSHUTDOWN")?this.disable("关机状态的主机才可调整配置"):this.enable():this.hasCorrectConfig()?this.disable():this.disable("系统盘和数据盘均为云盘才可调整配置")},upgradedisk:function(e){return 1!==e.length?this.disable("请选择需要调整的单台服务器"):this.isOperableUpDisk()?this.hasFeature("NONSHUTDOWN")?this.disable("关机状态的主机才可调整磁盘"):this.enable():e[0].uHostId?this.disable("独享型云主机只有数据盘为本地盘才可调整磁盘"):this.hasCorrectDisk()?this.enable():this.disable("云硬盘（数据盘）支持磁盘扩容")},snapshot:function(e){return 0<e.length?e[0].isSnapAbility?this.enable():this.disable("无法创建快照，请重新选择"):this.disable("请选择需要创建快照的服务器")},destroycvm:function(e){return 0<e.length?this.isOperable("DELETE")?this.hasFeature("MULTI_CVM")?this.disable("不支持独享型云主机和按量计费云主机混合销毁"):this.hasFeature("CDH_MACHINE")?this.enable():1===e.length?this.hasFeature("CVMSECONDPAY")||this.listIns.isCvmRefundUser?this.enable():this.disable("包年包月主机不支持销毁"):this.hasFeature("BATCHRETURN")?this.disable("包年包月主机不支持批量销毁"):this.enable():this.disable():this.disable("请选择需要销毁的服务器")},bindkeypair:function(e){return 0<e.length?this.isOperable("DELIVERKEY")?this.hasAllFeature("WINDOWS")?this.disable("密钥仅支持linux主机"):this.hasAllFeature("VPC")&&!n.SSHKEY_VPC?this.disable("vpc内主机暂不支持密钥"):this.hasAllFeature("NONSHUTDOWN")?this.disable("关机状态的主机才可加载密钥"):this.enable():this.disable():this.disable("请选择需要加载密钥的服务器")},boot:function(e){return 0<e.length?this.isOperable("BOOT")?this.enable():this.hasAllFeature("ISOLATION")&&this.hasAllFeature("CVMSECONDPAY")?this.disable("欠费关机，请充值"):this.disable("关机状态的主机才可开机"):this.disable("请选择需要开机的服务器")},changeproject:function(e){return 0<e.length?this.hasAllFeature("ISOLATION")?this.disable():this.hasAllFeature("CDH_MACHINE")?this.disable("独享型云主机不支持分配项目"):this.enable():this.disable("请选择需要分配至项目的服务器")},createimg:function(e){if(1!==e.length)return this.disable("请选择需要制作镜像的单台服务器");if(this.isOperable("CREATEIMG")){if(this.isOperableOnlineCreateImage());else if(this.hasFeature("NONSHUTDOWN"))return this.disable("关机状态的主机才可制作镜像");return/windows2003/.test(e[0].osName)?this.disable("该服务器系统老旧不支持制作镜像"):this.enable()}return 1===e[0].hypervisor&&this.isOperable("XENTOKVM")&&this.listIns.isPrepaidUser?this.enable():this.disable("该服务器架构老旧不支持制作镜像")},"export":function(e){return 0<e.length?this.enable():this.disable("请选择需要导出的云服务器")},firewall:function(e){return 1==e.length?this.isOperable("FIREWALL")?this.enable():this.disable():this.disable("请选择需要配置安全组的单台服务器")},format:function(e){return 0<e.length?this.isOperable("FORMAT")?this.hasAllFeature("WINDOWS")?this.disable("仅可对linux子机格式化"):this.hasAllFeature("NOSPACE")?this.disable("无数据盘"):this.hasAllFeature("NONSHUTDOWN")?this.disable("关机状态的主机才可格式化"):this.enable():this.disable():this.disable("请选择需要格式化的服务器")},reboot:function(e){return e.length<1?this.disable("请选择需要重启的服务器"):this.isOperable("REBOOT")?this.enable():this.disable("运行中的主机才可重启")},renew:function(e){if(1!==e.length)return this.disable("请选择需要续费的单台服务器");if(this.hasAllFeature("CVMSECONDPAY"))return this.disable("按量计费主机不支持续费");var t=e[0];return n.ZONEID.GZ1!=t.zoneId||!t.deviceClass||"v1.0.5"!=t.deviceClass.toLowerCase()&&"v1.1"!=t.deviceClass.toLowerCase()?this.isOperable("RENEW")?this.enable():this.disable():this.disable("广州一区共享核机器已下架,请查看公告")},resetos:function(e){return 1===e.length?this.isOperable("RESETOS")?this.enable():this.disable():this.disable("请选择需要重装系统的单台服务器")},resetpwd:function(e){return 0<e.length?this.hasFeature("NONSHUTDOWN")?this.disable("关机状态的主机才可重置密码"):this.enable():this.disable("请选择需要重置密码的服务器")},returncvm:function(e){return 0<e.length?this.isOperable("DELETE")?this.enable():this.disable("运行中、已关机的服务器才可退还"):this.disable("请选择需要退还的服务器")},shutdown:function(e){return 0<e.length?this.isOperable("SHUTDOWN")?this.enable():this.disable("运行中的主机才可关机"):this.disable("请选择需要关机的服务器")},vnc:function(){return this.isOperable("CONNECTVNC")?this.enable():this.disable()},bindEip:function(e){return this.isOperable("BIND_EIP")?this.enable():e&&e[0]&&e[0].ipBlocked?this.disable("当前IP已被安全隔离"):this.disable("已绑定弹性IP，请先解绑")},unbindEip:function(e){return this.isOperable("UNBIND_EIP")?this.enable():e&&e[0]&&e[0].ipBlocked?this.disable("当前IP已被安全隔离"):this.disable("未绑定弹性IP")},bindEni:function(e){return 0<e.length?this.isOperable("BIND_ENI")?this.enable():this.disable("当前主机网络不支持绑定弹性网卡"):this.disable("请选择需要绑定弹性网卡的服务器")},unbindEni:function(e){return 0<e.length?this.isOperable("UNBIND_ENI")?this.enable():this.disable("当前主机网络不支持解绑弹性网卡"):this.disable("请选择需要解绑弹性网卡的服务器")}},isOperableUpBandwith:function(){return this.isOperable("UPGRADEBANDWIDTH")&&!this.listIns.isBandwidthPackageUser},isOperableUpConfig:function(){return this.isOperable("UPGRADECONFIG")&&this.hasCorrectConfig()},isOperableUpDisk:function(){return this.isOperable("UPGRADECONFIG")&&this.hasCorrectDisk()},isOperableOnlineCreateImage:function(){return this.isOperable("CREATEIMG")&&this.listIns.onlineImage},hasCorrectDisk:function(){var e=this.options.dataItems[0],t=!1;if(e.uHostId)return 0<=$.inArray(+e.diskType,n.DISK_CATEGORY.local);0<=$.inArray(+e.diskType,n.DISK_CATEGORY.local)?e.cbsList.length&&(t=!0):1<e.cbsList.length&&(t=!0);return t},hasCorrectConfig:function(){var e=this.options.dataItems[0];if(e.uHostId)return!0;var t=!1;if(e.cbsList)for(var i,a=0;i=e.cbsList[a];a++)"root"==i.diskType&&(t=!0);return t},getItemsNetworkPayMode:function(){var t=[],e=!0;return this.options.dataItems.forEach(function(e){t.indexOf(e.networkPayMode)<0&&t.push(e.networkPayMode)}),1<t.length&&(e=!1),e?{isSame:!0,mode:t[0]||n.NETWORKPAYMODE.YEARMONTH}:{isSame:!1}},enable:function(){return{code:0}},disable:function(e,t){return{code:1,tip:e=e||"当前状态不可进行该操作",reason:t||e}},isOperable:function(e){var t=!1;return!0===this.auth[e]&&(t=!0),t},hasFeature:function(e){var t=!1;return!0===this.feature[e]&&(t=!0),t},hasAllFeature:function(e){var t=!0;return!1===this.allFeature[e]&&(t=!1),t},isResetSystemFail:function(){if(this.hasFeature("RESETSYSTEMFAIL"))return this.disable("重装失败的云服务器仅支持重装操作")}},i.exports=a}),define("widget/cvmList/operate_base",function(y,e,t){var k=y("$"),x=y("manager"),P=y("tips"),a=(y("util"),y("appUtil")),C=y("widget/msg/msg"),r=y("widget/cvmList/operate_auth"),s=y("constants"),T=y("widget/operatelog/floattips"),i=function(e){e&&(this.listIns=e.listIns,this.button=e.button,this.selectedItems=e.selectedItems)};i.prototype={change:function(e,t,i){this.operateAuth=i;var a=this.operateAuth.getAuth();a[t]&&(0===a[t].code?this.enable():this.disable(a[t].tip))},exec:function(){},refresh:function(e,t,i){this.selectedItems=e||[],this.change(e,t,i)},refreshList:function(e){this.listIns.refresh(e)},disable:function(e,t){this.button.addClass("disabled"),this.setTitle(e),t&&t.call(this)},enable:function(e){this.button.removeClass("disabled"),this.setTitle(),e&&e.call(this)},setTitle:function(e){e=e||"",this.button.attr("data-title",e)},isOperable:function(e){return this.operateAuth.isOperable(e)},hasFeature:function(e){return this.operateAuth.hasFeature(e)},restoreDialogBtn:function(){a.restoreDialogBtn()},selectedItemIsExpire:function(){var e=!1;return 0<this.hasPermItems[0].deadlineInfo.indexOf("status-recover")&&(e=!0),e},isCvmSecondPay:function(){return this.hasPermItems[0].cvmPayMode==s.CVMPAYMODE.SECOND},isNetworkSecondPay:function(){return this.hasPermItems[0].networkPayMode==s.NETWORKPAYMODE.SECOND},isNetworkFlowPay:function(){return this.hasPermItems[0].networkPayMode==s.NETWORKPAYMODE.FLOW},toPay:function(e){var t=s.MANAGE_HOST+"deal/dealsConfirmDirect.php",i={itemDetails:{raw_goodsData:[e]}};a.submitForm(t,i)},toPay2:function(e){"[object Array]"!==Object.prototype.toString.call(e)&&(e=[e]);var t={itemDetails:{raw_goodsData:e}};a.submitForm("https://buy.qcloud.com/order/check",t)},getRootDiskPara:function(){var e=this.hasPermItems[0],t=e.rootType,i="";return 1==t?i="rootDisk":2==t?i="rootCbs":3==t&&(i="rootSsd"),{key:i,val:e.rootSize}},resolvePerm:function(e,i,t){var a=this,s=[],n=[],o={actionName:t,hasPermItems:[],noPermItems:[]};return e.forEach(function(e){var t=new r({dataItems:[e],operAction:i,listIns:a.listIns}).getAuth();t[i]&&(0===t[i].code?(s.push(e),o.hasPermItems.push({name:e.alias})):(n.push(e),o.noPermItems.push({name:e.alias,reason:t[i].reason})))}),{hasPermItems:s,noPermItems:n,selectedShowOptions:o}},checkTask:function(e,t,a){var s=this,i=e.taskId,n=this.listIns,o=n.gridView,r=n.cvmListEl;if(n.showTask){n.showTask(e,t,a,this)}else{i&&T.showTaskProcessTip({msg:t,business_id:1,task_id:i});var d=function(i){n.userIsDoing&&n.userIsDoing()?s.timeOut=setTimeout(function(){d(i)},3e3):x.getFlowCscResult({taskId:i},function(e){var t=e.status;0===t?(s.refreshList(),C.echo()):2===t?s.timeOut=setTimeout(function(){d(i)},3e3):(!k("#getFlowCscResultErrTip").length&&P.error("操作执行失败"),s.refreshList(),C.echo())},null,a)};if(i){var l='<span class="text-overflow restart">'+t+"</span>";r.find("[data-check-all]").prop("checked",!1);for(var c,p=this.permResult,u=p?p.hasPermItems:this.selectedItems,h=p?p.noPermItems:[],m=0;c=u[m];m++){if(I=c.el){var f=I.attr("data-index");o.$refs.list[f].$set({$loading:!0,$selected:!1}),I.find(".status-col").html(l),n.getSelectedItemData(f).statusDesc=l}else k(".status-tips").html(l);var v="正在执行任务";if(I){(g=n.cvmListEl.find('tr[data-index="'+f+'"]').find(".cvm-oper-cell")).find("> a").addClass("disabled").attr("data-title",v),g.find(".tc-15-dropdown-link").addClass("disabled").attr("data-title",v)}else{var g=k(".cvm-more-opt");k(".cvm-more-opt").attr("data-isloading",!0),g.find(">button").addClass("disabled").attr("data-title",v),k(".tc-15-dropdown-link").addClass("disabled").attr("data-title",v)}}for(var w,b=0;w=h[b];b++){var I;f=(I=w.el).attr("data-index");o.$refs.list[f].$set({$selected:!1})}y.async("widget/cvmList/operate_entry",function(e){e.refresh()}),d(i),this.listIns.clearCheckTask&&this.listIns.clearCheckTask()}}},clearQueryStatus:function(){clearTimeout(this.timeOut)},destroy:function(){this.clearQueryStatus()},showBuyEipTips:function(e){if(0!=e){for(var t,i=!1,a=0;t=this.hasPermItems[a];a++)if(!(0!=t.bandwidth||t.ipConfig&&t.ipConfig.deviceWanIp)){i=!0;break}if(i){var s="";s=1==this.hasPermItems.length?"该":"存在",s+='主机没有购买外网IP，您可绑定<a target="_blank" href="https://console.qcloud.com/cvm/eip">弹性公网IP</a>访问外网。弹性公网IP绑定主机后不收费。',0<k("#buyEipTips").length&&k("#buyEipTips").html(s).show()}}}},t.exports=i}),define("widget/cvmList/operate_entry",function(e,t,i){var d=e("$"),a=e("event"),l=e("tips"),c=(e("appUtil"),e("reporter")),p=e("widget/cvmList/operate_auth"),s=e("dataManager"),u={},h={reboot:{name:"重启",module:e("widget/cvmList/reboot/reboot"),hotTag:"yunzhuji.reboot"},boot:{name:"开机",module:e("widget/cvmList/boot/boot"),hotTag:"yunzhuji.turnon"},shutdown:{name:"关机",module:e("widget/cvmList/shutdown/shutdown"),hotTag:"yunzhuji.shutdown"},alias:{name:"重命名",module:e("widget/cvmList/alias/alias"),hotTag:"yunzhuji.rename"},resetpwd:{name:"重置密码",module:e("widget/cvmList/resetpwd/resetpwd"),hotTag:"yunzhuji.rekey"},format:{name:"格式化",module:e("widget/cvmList/format/format"),hotTag:"yunzhuji.geshi"},renew:{name:"续费",module:e("widget/cvmList/renew/renew"),hotTag:"yunzhuji.xufei"},createimg:{name:"制作镜像",module:e("widget/cvmList/createimg/createimg"),hotTag:"yunzhuji.zzjingxiang"},upgradebandwidth:{name:"调整带宽",module:e("widget/cvmList/upgradebandwidth/upgradebandwidth"),hotTag:"yunzhuji.upgradebandwidth"},upgradeconfig:{name:"调整配置",module:e("widget/cvmList/upgradeconfig/upgradeconfig"),hotTag:"yunzhuji.upgradeconfig"},upgradedisk:{name:"调整磁盘",module:e("widget/cvmList/upgradedisk/upgradedisk"),hotTag:"yunzhuji.upgradedisk"},resetos:{name:"重装系统",module:e("widget/cvmList/resetos/resetos"),hotTag:"yunzhuji.chongzhuang"},snapshot:{name:"创建快照",module:e("widget/cvmList/snapshot/snapshot"),hotTag:"yunzhuji.snapshot"},"export":{name:"导出",module:e("modules/cvm2/event/export/export"),hotTag:"yunzhuji.export"},exportall:{name:"导出全部",module:e("modules/cvm2/event/export/exportall"),hotTag:"yunzhuji.exportall"},bindkeypair:{name:"加载密钥",module:e("widget/cvmList/bindkeypair/bindkeypair"),hotTag:"yunzhuji.ssh"},returncvm:{name:"退还服务器",module:e("widget/cvmList/returncvm/returncvm"),hotTag:"yunzhuji.tuihuan"},destroycvm:{name:"销毁",module:e("widget/cvmList/destroycvm/destroycvm"),hotTag:"yunzhuji.destroy"},bandwidthimit:{name:"调整带宽",module:e("widget/cvmList/bandwidthimit/bandwidthimit"),hotTag:"yunzhuji.bandwidthimit"},changeproject:{name:"分配至项目",module:e("widget/cvmList/changeproject/changeproject"),hotTag:"yunzhuji.changeproject"},firewall:{name:"配置安全组",module:e("widget/cvmList/firewall/firewall"),hotTag:"yunzhuji.firewall"},wipToEip:{name:"转换为弹性公网IP",module:e("widget/cvmList/eip/wipToEip"),hotTag:"yunzhuji.wipToEip"},bindEip:{name:"绑定弹性公网IP",module:e("widget/cvmList/eip/bindEip"),hotTag:"yunzhuji.bindEip"},unbindEip:{name:"解绑弹性公网IP",module:e("widget/cvmList/eip/unbindEip"),hotTag:"yunzhuji.unbindEip"}},m=function(){var e=[];for(var t in h)e.push(t);return e},n={modules:h,init:function(e){this.listIns=e,this.initModules(),this.bindEvent()},initModules:function(){var e=this.listIns,t=e.operAreaEl;for(var i in h){var a=h[i];u[i]=new a.module({listIns:e,button:t.find('[data-name="'+i+'"]'),selectedItem:[]})}},refresh:function(e,t){var i=new p({dataItems:e=e||[],operAction:m(),listIns:this.listIns});for(var a in u)u[a].refresh&&u[a].refresh(e,a,i);if(t)return i},bindEvent:function(){var s=this,e=this.listIns,t=e.cvmListEl,i=e.gridView;t.on("click",'input[type="checkbox"]',function(e){setTimeout(function(){var e=t.find('input[type="checkbox"]').not("[data-check-all]").not("[disabled]").filter(":checked").closest("tr");s.selectedChange(e)},0)}),a.bindCommonEvent(e.options.renderTo[0],"click",{cvm_oper_action:function(){var e=d(this);if(!e.hasClass("disabled"))if(e.attr("data-disabled"))l.error(e.attr("data-title"));else{var t=e.attr("data-name"),i=e.closest("tr");if(!i.length){var a=e.closest("#cvmRowDropdown");a.length&&(i=a.data("onTr"))}i.length?s.execRowMenuItem(i,e):s.exec(t)}},set_Fields:function(){i.showFieldsManager(!0)},add_cvm:function(){e.addCvm()},web_ssh:function(){d(this).hasClass("disabled")||e.showVnc(this)}})},selectedChange:function(e){var i=this.listIns.gridView.getSelected();d(e).each(function(e){var t=d(this);i[e].el=t}),this.refresh(i)},exec:function(e,t,i){if(l.hideFlash(1),t){var a=this.listIns,s=new h[e].module({listIns:a,selectedItem:t});i&&(s.operateAuth=i)}else s=u[e];var n=h[e].name,o=h[e].hotTag;if(s){if(t)var r=s.resolvePerm(t,e,n);else r=s.resolvePerm(s.selectedItems,e,n);s.permResult=r,s.hasPermItems=r.hasPermItems,t&&(s.selectedItems=r.hasPermItems),s.selectedShowOptions=r.selectedShowOptions,s.args=arguments,s.exec&&s.exec()}o&&c.click(o)},displayOperMenu:function(n,o,r){var d=this;this.getWhiteList().then(function(e){if(e&&e.cvm_online_image&&e.cvm_online_image.length&&(d.listIns.onlineImage=!0),r)var t=new p({dataItems:[r],operAction:m(),listIns:d.listIns});else t=new p({dataItems:[d.listIns.getSelectedItemData(o.attr("data-index"))],operAction:m(),listIns:d.listIns});var i=t.getAuth();for(var a in u){var s=n.find('[data-name="'+a+'"]');i[a]&&s.length&&(0===i[a].code?s.removeClass("disabled").attr("data-title",""):s.addClass("disabled").attr("data-title",i[a].tip))}})},getWhiteList:function(){var t=d.Deferred(),e=s.get("allWhiteList");return e?t.resolve(e):d(document).on("allWhiteListLoaded",function(){var e=s.get("allWhiteList");t.resolve(e)}),t},execRowMenuItem:function(e,t){var i=this.listIns,a=e.closest("[data-locked]").length,s=d(e).attr("data-index");a&&(e=i.cvmListEl.find('tr[data-index="'+s+'"]').eq(0));if(e.attr("data-isLoading"))l.flash("正在执行任务");else if(e.find('input[type="checkbox"]').length||a){for(var n=i.gridView,o=(i.operAreaEl,0),r=n.list.length;o<r;o++)n.$refs.list[o].$set({$selected:!1});n.$refs.list[s].$set({$selected:!0}),this.selectedChange(e),this.exec(t.attr("data-name"))}else l.flash("无法执行操作")},getModuleArr:function(){return m()},destroy:function(){for(var e in u)u[e].destroy&&u[e].destroy()}};i.exports=n}),define("widget/cvmList/reboot/reboot",function(e,t,i){var n=e("$"),o=e("manager"),a=e("widget/cvmList/operate_base"),r=e("dialog"),d=e("util"),l=e("constants"),c=e("widget/selectedShow/selectedShow"),p='<span class="tit">确定选中主机进行重启？</span><br>    <span class="txt">    重启期间，主机将无法正常提供服务，请您做好准备，以免造成影响    </span>    <label for="rebootConfirmCheck" class="confirm-it">    <input type="checkbox" class="tc-15-checkbox" id="rebootConfirmCheck">    重启失败时进行<a href="<% if (powerOffWiki){ %> <%-powerOffWiki%> <% } else { %> javascript:; <% } %>" <% if (powerOffWiki){ %> target="_blank" <% } %>>强制关机</a>再启动</label>',s=function(e){a.call(this,e)};(s.prototype=new a).exec=function(){var a=this,e=d.tmpl(p,{powerOffWiki:l.POWEROFFWIKI}),s=this.hasPermItems;r.confirm(e,function(){for(var e,t=[],i=0;e=s[i];i++)t.push(e.uuid);t.length&&o.rebootCvm({uuidList:t,hardPowerOffFlag:n("#rebootConfirmCheck").prop("checked")?1:0},function(e){a.checkTask(e,"重启中")})},null,{title:"重启云主机",width:550,hideIcon:!0}),c.render(this.selectedShowOptions)},i.exports=s}),define("widget/cvmList/renew/renew",function(e,t,i){var d=e("$"),l=e("manager"),a=e("widget/cvmList/renew/renew_base"),c=e("dialog"),p=e("util"),u=(e("appUtil"),e("widget/range/range")),h=e("widget/pills/pills"),m=e("widget/selectedShow/selectedShow"),f='<div class="renew-wrapper"><div class="edit_form_wrap">    <ul class="edit_psword">        <li>            <label class="txt" for="">续费时长:</label>            <span class="renewals"></span>            <p class="tip">有效期至<span data-field="validity"><%-expires%></span></p>        </li>        <% if (upgradeBandwidth) { %>        <li>            <label class="txt" for="">调整带宽:</label>            <span class="rerange-ctrl">            <span class="inf">当前带宽<%-bandwidth%>Mbps</span>            <a href="javascript:;" class=\'set-bandwidth\'>调整带宽</a>        </span>            <div class="rerange-wrapper" style="display:none">            <div class="rerange-inner-wrapper"></div>            <span style="color:#ff7a22">调整后的带宽将于<%- deadlineNext %>之后生效</span>            </div>            <p class="tip"></p>        </li>        <% } %>        <li>            <label class="txt" for="" data-field="pricetitle">费用:</label>            <span class="price"><span data-field="cost"></span><em>元</em></span>  <span data-discount style="display: none;font-size: 1.2em;"> <span data-field="origin-cost" style="text-decoration: line-through; margin: 0 5px"></span></span>        </li>        <%-activity%>    </ul> </div></div>',v=[{name:"1个月",value:"1"},{name:"2个月",value:"2"},{name:"3个月",value:"3"},{name:"半年",value:"6"},{name:"1年",value:"12",active:!0,ico:"ico ico_join"},{name:"2年",value:"24",ico:"ico ico_join"},{name:"3年",value:"36",ico:"ico ico_join"}],s=function(e){a.call(this,e)},n=function(){};n.prototype=a.prototype,((s.prototype=new n).constructor=s).prototype.superclass=a,s.prototype.exec=function(){var t=this,e=this.hasPermItems[0],i=this.isOperable("UPGRADEBANDWIDTH")&&!this.listIns.isBandwidthPackageUser&&!this.isNetworkFlowPay(),a=(new Date,12),s=v;if(0==e.deviceClass.indexOf("VSHGPU")){for(var n=[],o=1;o<6;o++)n.push({name:o+"个月",value:o});n[2].active=!0,s=n,a=3}var r=p.tmpl(f,{expires:this.getExpires(this.hasPermItems[0].deadline,a),upgradeBandwidth:i,bandwidth:e.bandwidth,deadline:e.deadline,deadlineNext:this.getNextDay(),activity:""});c.create(r,"580","",{title:"主机续费",preventResubmit:!0,button:{"确定":function(){t.toRenew(t.collectData())}}}),m.render(this.selectedShowOptions),this.wrapper=c.el.find(".renew-wrapper"),this.renewals=this.wrapper.find(".renewals"),this.timePills=new h({renderTo:this.renewals,data:s,change:function(){var e=this.val();t.wrapper.find('[data-field="validity"]').html(t.getExpires(t.hasPermItems[0].deadline,parseInt(e))),t.setPrice()}}),i?(this.rerangeCtrl=this.wrapper.find(".rerange-ctrl"),this.setBandwidth=this.rerangeCtrl.find(".set-bandwidth"),this.rerangeWrapper=this.wrapper.find(".rerange-wrapper"),this.rerangeInnerWrapper=this.rerangeWrapper.find(".rerange-inner-wrapper"),1==e.networkPayMode?this.bandWidthRange=new u({renderTo:this.rerangeInnerWrapper,value:65535==e.bandwidth?0:e.bandwidth,min:0,max:200,unit:"Mbps",section:[{value:20,width:75},{value:50,width:150},{value:100,width:225},{value:200,width:300}],step:1,change:function(){t.setPrice()}}):this.bandWidthRange=new u({renderTo:this.rerangeInnerWrapper,value:65535==e.bandwidth?0:e.bandwidth,change:function(){t.setPrice()}})):this.bandWidthRange=null,this.bindEvt(),t.setPrice(),l.getComData(function(e){e.isAgentClient||e.isAgentClient||d("#actLink99").show()})},s.prototype.bindEvt=function(){var e=this;this.bandWidthRange&&this.setBandwidth.on("click",function(){e.rerangeCtrl.hide(),e.rerangeWrapper.show()})},s.prototype.setPrice=function(){var n=this,e=this.collectData();this.superclass.prototype.setPrice({goodsDetail:e},function(e){var t=e[0].totalCost/100,i=e[0].realTotalCost/100,a=n.wrapper.find('[data-field="cost"]'),s=n.wrapper.find("[data-discount]");a.html(i),t&&t!==i?(n.wrapper.find('[data-field="origin-cost"]').html(t+" 元 "),n.wrapper.find("[data-field=pricetitle]").text("优惠价:"),s.show()):(n.wrapper.find("[data-field=pricetitle]").text("费用:"),s.hide())})},i.exports=s}),define("widget/cvmList/renew/renew_base",function(e,t,i){var o=e("$"),a=e("manager"),s=e("widget/cvmList/operate_base"),r=e("appUtil"),n=function(e){e=o.extend({},{listIns:{},button:o(),selectedItems:[]},e),s.call(this,e)},d=function(){};d.prototype=s.prototype,((n.prototype=new d).constructor=n).prototype.setPrice=function(e,t){a.getPrice(e,t)},n.prototype.toRenew=function(e){this.toPay2(e)},n.prototype.getNextDay=function(){var e=this.hasPermItems[0].deadline;if(!e)return"";e=e.replace(/\-/g,"/");var t=new Date(new Date(e).getTime()+864e5);return r.formatDate(t,"yyyy-MM-dd")+" 00:00:00"},n.prototype.getExpires=function(e,t){return e?a.getNextDate(e,parseInt(t)):""},n.prototype.getInputData=function(){this.hasPermItems[0];var e,t=this.timePills.val();return this.bandWidthRange&&(e=this.bandWidthRange.val()),this.listIns.isBandwidthPackageUser&&(e=65535),{bandwidth:e&&parseInt(e),timespan:t}},n.prototype.collectData=function(a){var s=this,n=[];return a=a||this.getInputData(),!s.listIns.isBandwidthPackageUser&&200<a.bandwidth&&(a.bandwidth=200),o(this.hasPermItems).each(function(e,t){if(!t.uHostId){var i={goodsCategoryId:100020,appId:r.getAppId(),projectId:t.projectId,regionId:r.getRegionId(),zoneId:t.zoneId,goodsNum:1,payMode:t.cvmPayMode,goodsDetail:{productInfo:[{name:"项目",value:t.projectName},{name:"主机名",value:t.uInstanceId},{name:"内网IP",value:t.deviceLanIp},{name:"所属网络",value:t.netName},{name:"可用区",value:t.zoneName}],curDeadline:t.deadline,timeSpan:parseInt(a.timespan),timeUnit:"m",resourceId:t.uInstanceId}};1!=t.networkPayMode||s.listIns.isBandwidthPackageUser||(i.goodsDetail.oldBandwidth=t.bandwidth,"undefined"!=typeof a.bandwidth?i.goodsDetail.bandwidth=a.bandwidth:i.goodsDetail.bandwidth=t.bandwidth,i.goodsDetail.productInfo.push({name:"带宽",value:i.goodsDetail.oldBandwidth+"=>"+i.goodsDetail.bandwidth})),n.push(i)}}),n},i.exports=n}),define("widget/cvmList/resetos/resetos",function(e,t,i){var g=e("$"),w=e("manager"),a=e("widget/cvmList/operate_base"),b=e("dialog"),h=e("util"),I=e("appUtil"),y=e("tips"),k=(e("pagination"),e("reporter")),m=(e("validator"),e("widget/pills/pills")),s=e("widget/range/range"),x=e("config/constants"),n=e("models/api"),f=e("widget/getOsName/getOsName"),o=e("modules/cvm/image/util"),d=(e("router"),null),r='<div id="resetosWrapper"><ul class="form-list"><%#localdiskTips%><%#lastSetting%>    <textarea style="display: none"><%#normalTips%> </textarea><div id="resetosTips"><%#normalTips%></div></ul></div><div id="noSupportTips"></div>',l='<% if (data.length) { %><% for (var i=0, item; item = data[i]; i++) { %><% if(item._show){ %><option data-osSize="<%=parseInt(item.size)%>" data-osName="<%= item.osName %>"  data-sysprep="<%= item.sysprep %>" data-osimgId="<%= item.imageId %>" <% if(/windows2003/.test(item.osName) && !whiteList2003){ %> disabled data-title="不再支持基于windows 2003制作的自定义镜像用于重装系统" <% } %> value="<%= item.osType %>"><%= item.unImgId %> (<%= item.imageName %>)</option><% } %><% } %><% } else { %><option value="">您在当前地域没有适合此机器的镜像</option><% } %>',c='<% for (var i=0, item; item = data[i]; i++) { %><% if(item._show){ %><option value="<%-item.osType%>" data-osname="<%= item.name %>" data-osimgid="<%= item.unImgId %>"><%=item.desc%></option><% } %><% } %>',v='<div class="tip_box">注意：重装后，服务器系统盘内的所有数据将被清除，恢复到初始状态；服务器数据盘的数据不会丢失，但需要手动挂载才能使用，具体请参看<a data-event="just_for_hot" data-hot="yunzhuji.chongzhuang.page3_normal.guide" target="_blank" href="<%- wikiHref %>">操作指引</a></div>',p='<div id="localdisktips"><%  if(rootType != 2)  {%>    <div class="tip_box">检测到当前CVM系统盘为本地盘，暂不允许重装为<%= originOS==="linux" ? "Windows" : "Linux" %>，如有需求请<a href="https://console.qcloud.com/workorder">提交工单</a></div>   <%  }else{ %>           <% if(isOverseasRegion){ %>             <div class="tip_box">当前实例为<%= originOS==="linux" ? "Linux" : "Windows" %>操作系统，由于海外系统版权导致的价格差异，<span style="color:red">无法重装为<%= originOS==="linux" ? "Windows" : "Linux" %></span></div>          <% }else if(oldSysDiskFlag == true && originOS == "linux"){ %>                <div class="tip_box">因云盘架构升级，检测到当前CVM为Linux，<span style="color:#ff0000;">仅限重装为Linux</span>，重装为Windows需<a href="https://console.qcloud.com/workorder"></a>提工单</div>          <% }else if(zoneId == "100001"){ %>                <% if(originOS == "windows"){ %>                    <div class="tip_box">因云盘架构升级，检测到当前CVM为Windows，<span style="color:#ff0000;">仅限重装为Windows</span>，重装为Linux需<a href="https://console.qcloud.com/workorder"></a>提工单</div>                <% }else{ %>                    <div class="tip_box">因云盘架构升级，检测到当前CVM为Linux，<span style="color:#ff0000;">仅限重装为Linux</span>，重装为Windows需<a href="https://console.qcloud.com/workorder"></a>提工单</div>          <% }}else{ %>                   <% if(originOS == "windows" && targetOS == "linux"){ %>                         <div class="tip_box localTip">  <span style="color:#ff0000;">检测到您将Windows系统盘更换为Linux，该CVM系统盘ID将发生变化，系统盘关联快照将无法回滚、恢复数据，请慎重选择！</span> </div>                   <% }else if(originOS == "linux" && targetOS == "windows"){ %>                    <div class="tip_box localTip">  <span style="color:#ff0000;">检测到您将Linux系统盘更换为Windows，该CVM系统盘ID将发生变化，系统盘关联快照将无法回滚、恢复数据，请慎重选择！</span> </div>          <% }}} %>    </div>',u='<div class="tip_box"><%if(rootType == 2 && oldSysDiskFlag == true){%>检测到您的系统盘落在旧架构系统盘，暂不允许重装为Windows，如有需求请<a href="https://console.qcloud.com/workorder">提交工单</a>。<%}%></div>',P='<div class="form-wrap re-install" id="lastSettingWrap"><ul class="form-list"> <li>        <div class="form-label">            <label for="">镜像来源</label>        </div>        <div class="form-input">            <div class="tc-15-rich-radio" role="radiogroup" id="imageSet"></div>        </div>    </li>    <li class="curImg-li">        <div class="form-label lh-normal">            <label for="">镜像</label>        </div>        <div class="form-input"><div class="mirror-name"><%=osName%>         <% if(errTips){ %>(<%=errTips%>)        <% } %>                 </div><%#agent%></div>       </li>    <li class="commonImg-li">        <div class="form-label lh-normal">            <label for="">操作系统</label>        </div>             <div class="form-input">            <div class="tc-15-rich-radio" role="radiogroup" id="osSet"></div>        </div>    </li>    <li class="commonImg-li">        <div class="form-label lh-normal">            <label for="">系统版本</label>                    </div>           <div class="form-input"><select class="tc-15-select m" id="commonImageSelect"></select>        <%#agent%>        </div>         </li>    <li class="diyImg-li">        <div class="form-label lh-normal">            <label for="">镜像</label>        </div>        <div class="form-input">        <select class="tc-15-select m" id="customImageSelect"></select>           <%#agent%>        </div>              </li><li class="sharedImg-li"><div class="form-label lh-normal"><label for="">镜像</label></div><div class="form-input"><select class="tc-15-select m" id="sharedImageSelect"></select><%#agent%></div></li>    <li class="marketImg-li">        <div class="form-label lh-normal">            <label for="">镜像</label>        </div>           <div class="form-input">        <div class="tc-15-rich-radio" role="radiogroup" id="marketSet"></div>        <div id="marketImageList"></div>        <%#agent%>        </div>                 </li>    <li class="sysdiskoption-li"></li>   <li id="loginArea">        <div class="form-label">            <label for="">登录设置</label>        </div>        <div class="form-input">            <div class="tc-15-rich-radio" role="radiogroup" id="loginSet">            </div>        </div>    </li>    <li class="sshKey-li">        <div class="form-label">            <label for="">SSH密码</label>        </div>        <div class="form-input">            <select class="tc-15-select m" id="sshkeySelect"></select><a href="https://www.qcloud.com/document/product/213/6092" class="inline-help-text links" target="_blank">密钥使用说明</a>        </div>    </li>    <li class="pwd-li">        <div class="form-label lh-normal">            <label for="">用户名</label>        </div>        <div class="form-input">            <p id="loginUsername">root</p>        </div>    </li>    <li class="pwd-li">        <div class="form-label">            <label for="">密码</label>        </div>                <form onkeydown="if(event.keyCode==13){return false;}">        <div class="form-input">            <div class="form-unit">            <input type="password" id="resetPwd" class="tc-15-input-text m" placeholder="">            <b class="icon-valid-flag"></b>            <p class="form-input-help" id="r_errtips"></p>            </div>        </div>        </form>    </li>    <li class="pwd-confirm-li" style="display:none;">        <div class="form-label">            <label for="">确认密码</label>        </div>        <form onkeydown="if(event.keyCode==13){return false;}">        <div class="form-input">            <div class="form-unit">            <input type="password" id="resetConfirmPwd" class="tc-15-input-text m" placeholder="">            <b class="icon-valid-flag"></b>            <p class="form-input-help" id="c_errtips"></p>            </div>        </div>        </form>    </li>    <li class="reserved-image-li" style="display:none">            <div class="d-tbc form-label"><label></label></div>            <div class="d-tbc psw-cell">                <div class="auto-gen-tips" style="margin-top:0">重装后，您可使用自定义镜像内登录信息(密钥/密码)登录</div>                </div>            </li>            \x3c!-- 按量计费 --\x3e            <li class="payflow-li" style="display:none;">        <div class="form-label lh-normal">            <label for="">原配置费用</label>        </div>        <div class="form-input">            <span class="original-cost normal">¥ <span class="oCost"></span>/小时</span>        </div>    </li>    <li class="payflow-li" style="display:none;">        <div class="form-label lh-normal">            <label for="">新配置费用</label>        </div>        <div class="form-input">            <span class="cost">¥ <strong><span class="nCost"></span>/小时</strong></span>            <span class="inline-help-text text-weak">新的计费将在重装完成后开始</span>        </div>    </li>    \x3c!-- 补差价 --\x3e    <li class="payoff-li" style="display:none;">        <div class="form-label lh-normal">            <label for="">应付费用</label>        </div>        <div class="form-input">            <span class="cost">¥ <strong class="realCost"></strong></span>            <div class="inline-help-text text-weak">            调整后的系统盘将随云主机一起到期，您须补齐相应的差价            <div class="tc-15-bubble-icon tc-15-triangle-align-end">        <i class="tc-icon icon-info-red"></i>        <div class="tc-15-bubble tc-15-bubble-top">            <div class="tc-15-bubble-inner">                <p>云主机将在<span class="realDeadline"></span>到期，截止目前剩余<span class="realRestday"></span>天有效期，需补齐差价￥ <span class="realCost"></span></p>            </div>        </div>    </div>            </div>        </div>    </li>    \x3c!-- 退费 --\x3e            <li class="payback-li" style="display:none;">        <div class="form-label lh-normal">            <label for="">退还差价</label>        </div>        <div class="form-input">            <span class="cost">¥ <strong class="realCost"></strong></span>            <span class="inline-help-text text-weak">            差价将在重装完成后退回你的账户余额            \x3c!-- <div class="tc-15-bubble-icon tc-15-triangle-align-end">        <i class="tc-icon icon-info-red"></i>        <div class="tc-15-bubble tc-15-bubble-top">            <div class="tc-15-bubble-inner">                <p>您已在<span class="dealTime"></span>调整系统盘时新购<span class="dealSize"></span>GB容量，截至目前剩余<span class="dealRestday"></span>天有效期，应退差价¥ <strong class="realCost"></strong></p>            </div>        </div>    </div> --\x3e            </span>        </div>    </li></ul></div>',C='<% for (var i=0, item; item = data[i]; i++) { %><option value="<%-item.key_id%>"><%=item.key_name%></option><% } %>',T='<div class="tc-15-dropdown tc-15-dropdown-btn-style select-os-from-store">        <a href="javascript:;" class="tc-15-dropdown-link"><p id="marketSelectVal" style="overflow:hidden;text-overflow:ellipsis;">请选择</p><i class="caret"></i></a>        <ul class="tc-15-dropdown-menu" role="menu" id="marketSelect">        <% if(data.length){ %><% for (var i = 0, item; item = data[i]; i++){ %><% if (item.imgs.length) { %><li role="presentation" data-os=\'<%= (item.imgs[0].osType == 1 ? "linux" : "windows") %>\' data-osName="<%= item.imgs[0].os %>" data-ossize=\'<%= item.imgs[0].spaceRequire %>\' data-osimgId="<%= item.imgs[0].itemId %>" class=\'<%= i == 0 ? "selected" : ""%>\'>            <div class="store-os-item">            <div class="os-item-name"><%= item.productName %> <span class="mirror-space">(<%= item.imgs[0].spaceRequire %>GB)</span></div>            <div class="os-item-desc">            <p>操作系统：<%= item.imgs[0].imageName %></p>            <p>集成软件：<%= item.imgs[0].software %></p>            <p>提供商家：<%= item.developer?item.developer.companyName: ""%></p>            </div>            </div>            </li>            <% } %>            <% } %>                     <% }else{ %>        <li role="presentation">        <div class="os-item-name" style="padding:1em">您在当前地域没有适合的服务市场镜像</div>        </li>        <% } %>                </ul>    </div>',S='        <div class="option-line">    <label class="form-ctrl-label">        <input type="checkbox" id="securityAgentCk" class="tc-15-checkbox" checked="checked">免费开通DDos防护、WAF和云主机防护 <a href="https://www.qcloud.com/doc/product/213/500" target="_blank">云安全介绍</a></label>    </div>    <div class="option-line">    <label class="form-ctrl-label">        <input type="checkbox" id="monitorAgentCk" class="tc-15-checkbox" checked="checked">免费开通云产品监控、分析和实时告警 <a href="https://www.qcloud.com/doc/product/248" target="_blank">云监控介绍</a></label>    </div>',D='\x3c!-- 系统盘为云硬盘 --\x3e<% if(rootType == 2 || rootType == 5){ %><div class="form-label lh-normal"><label for="">系统盘</label>    </div><% if(targetOs == "windows"){ %><div class="form-input">50GB <span class="inline-help-text text-weak">（<%= rootName%>）</span><span><a href="http://www.qcloud.com/doc/product/213/%E7%B3%BB%E7%BB%9F%E7%9B%98%E6%89%A9%E5%AE%B9%E7%9B%B8%E5%85%B3%E9%97%AE%E9%A2%98" target="_blank">系统盘扩容介绍</a></span>        </div><% } %><% if(targetOs == "linux"){ %>\x3c!-- 云硬盘小于50G，才可调大小，否则为固定50G --\x3e<% if(!isWindows){ %><% if(cbsRootSize < 50 ){ %> <div class="form-input">            <div id="resetDiskRanger" style="display:inline-block;"></div>            <span><a href="http://www.qcloud.com/doc/product/213/%E7%B3%BB%E7%BB%9F%E7%9B%98%E6%89%A9%E5%AE%B9%E7%9B%B8%E5%85%B3%E9%97%AE%E9%A2%98" target="_blank">系统盘扩容介绍</a></span>        </div><% }else{ %><div class="form-input">50GB <span class="inline-help-text text-weak">（<%= rootName%>）</span><span><a href="http://www.qcloud.com/doc/product/213/%E7%B3%BB%E7%BB%9F%E7%9B%98%E6%89%A9%E5%AE%B9%E7%9B%B8%E5%85%B3%E9%97%AE%E9%A2%98" target="_blank">系统盘扩容介绍</a></span>        </div><% } %><% }else{%><% if(cbsRootSize < 50  ){ %> <div class="form-input">            <div id="resetDiskRanger" style="display:inline-block;"></div>            <span><a href="http://www.qcloud.com/doc/product/213/%E7%B3%BB%E7%BB%9F%E7%9B%98%E6%89%A9%E5%AE%B9%E7%9B%B8%E5%85%B3%E9%97%AE%E9%A2%98" target="_blank">系统盘扩容介绍</a></span>        </div><% }else{ %>    <% if(!rootSize || rootSize < 50 ){ %>                    <div class="form-input">            <div id="resetDiskRanger" style="display:inline-block;"></div>            <span><a href="http://www.qcloud.com/doc/product/213/%E7%B3%BB%E7%BB%9F%E7%9B%98%E6%89%A9%E5%AE%B9%E7%9B%B8%E5%85%B3%E9%97%AE%E9%A2%98" target="_blank">系统盘扩容介绍</a></span>            </div>    <% }else{ %><div class="form-input">50GB <span class="inline-help-text text-weak">（<%= rootName%>）</span><span><a href="http://www.qcloud.com/doc/product/213/%E7%B3%BB%E7%BB%9F%E7%9B%98%E6%89%A9%E5%AE%B9%E7%9B%B8%E5%85%B3%E9%97%AE%E9%A2%98" target="_blank">系统盘扩容介绍</a></span>        </div><% }}} %><% } %>\x3c!-- 系统盘为本地盘 --\x3e<% }else{ %>\x3c!-- 原系统为windows --\x3e<% if(isWindows){ %><% if(targetOs == "windows"){ %><div class="form-label lh-normal"><label for="">系统盘</label>    </div><div class="form-input">50GB <span class="inline-help-text text-weak">（<%= rootName%>）</span><span><a href="http://www.qcloud.com/doc/product/213/%E7%B3%BB%E7%BB%9F%E7%9B%98%E6%89%A9%E5%AE%B9%E7%9B%B8%E5%85%B3%E9%97%AE%E9%A2%98" target="_blank">系统盘扩容介绍</a></span>        </div><% } %><% if(targetOs == "linux"){ %><% } %>\x3c!-- 原系统为linux --\x3e<% }else{ %><% if(targetOs == "windows"){ %><% } %><% if(targetOs == "linux"){ %><div class="form-label lh-normal"><label for="">系统盘</label>    </div><div class="form-input"><%=localRootSize%>GB <span class="inline-help-text text-weak">（<%= rootName%>）</span><span><a href="http://www.qcloud.com/doc/product/213/%E7%B3%BB%E7%BB%9F%E7%9B%98%E6%89%A9%E5%AE%B9%E7%9B%B8%E5%85%B3%E9%97%AE%E9%A2%98" target="_blank">系统盘扩容介绍</a></span>        </div>        <% } %><% } %><% } %>',E='<div class="error_tip_box"><p style="margin: 4px 0"><span style="color:red">暂不支持由<%=originOs%>重装为<%=targetOs%></span>。如果您确认需要更换为<%=targetOs%>，请前往工单系统，选择<b>运维类 - 云服务器 - 更换系统平台</b>，发起工单，将由我们的工作人员为您操作。</p>通过工单申请，我们将为您分配一台全新并带有您选择的系统的云服务器，原有云服务器将立即做下线处理，原服务器上的数据将丢失。<% if (showRootDiskTip) {%><p style="color:red;margin-top:15px;">注意：系统检测到所选的CVM有公测功能，选购系统盘<%=rootSize%>GB，更换为Windows后，将【不予退还】付费购买部分的系统盘额度，请谨慎更换。</p><%}%></div>',L='  <style>.swapnotes li{padding:5px 0; list-style-type:disc; margin-left: 20px}</style><ul class="swapnotes"><li>系统盘大小将发生变化（Linux 20G，Windows 50G），实例内外网IP保持不变</li><li>分配成功后，原服务器将立即做下线处理，原服务器将数据不会保留</li><li>如果原服务器上绑定有负载均衡、云解析、移动加速等服务，请先解绑再操作，否则将互换失败</li><li>如果您服务器上部署有业务，请谨慎使用该操作</li></ul>',_='  <style>.swapnotes li{padding:5px 0; list-style-type:disc; margin-left: 20px}</style><ul class="swapnotes"><li>linux与windows的互换操作，实际是为您分配一台全新的云服务器</li><li>内外网ip将重新分配，系统盘大小将发生变化（linux 20G，windows 50G）</li><li>分配成功后，原服务器将立即做下线处理，原服务器将数据不会保留</li><li>如果原服务器上绑定有负载均衡、云解析、移动加速等服务，请先解绑再操作，否则将互换失败</li><li>如果您服务器上部署有业务，请谨慎使用该操作</li></ul>',A='<div class="error_tip_box"><p style="margin: 4px 0">该服务器技术架构老旧，要使用 <%=osName%> 重装系统，请先<a href="javascript:;" data-hot="yunzhuji.chongzhuang.page3_xen.switch_now" data-event="xenToKvm">置换为新服务器</a>。</p></div>',M='<div class="error_tip_box">该服务器暂不支持使用<%= osName %>重装系统。</div>',B='  <style>.confirmswapos li{padding:5px 0; list-style-type:disc; margin-left: 20px}</style><div id="resetosWrapper"><ul class="confirmswapos"><p>注意：CVM原系统盘为<%=originOs%>，重装为<%=targetOs%>后，请注意：</p><li>您的原【系统盘】数据会丢失，重装后环境将变为您所选新镜像环境；</li><li>关联的【数据盘】格式仍为<%=originOs%>系统格式，可使用工具读取【数据盘】数据后，再将盘格式化使用；</li><% if(originOs == "windows" && targetOs == "linux"){ %><li>相关工具的使用方式：<a href="http://www.qcloud.com/doc/product/213/Windows%E9%87%8D%E8%A3%85%E4%B8%BALinux%E5%90%8E%E8%AF%BB%E5%86%99%E5%8E%9FNTFS%E7%B1%BB%E5%9E%8B%E6%95%B0%E6%8D%AE%E7%9B%98" target="_blank">工具链接</a>；</li><% } %><% if(originOs == "linux" && targetOs == "windows"){ %><li>相关工具的使用方式：<a href="http://www.qcloud.com/doc/product/213/Linux%E9%87%8D%E8%A3%85%E4%B8%BAWindows%E5%90%8E%E8%AF%BB%E5%8F%96%E5%8E%9FEXT%E7%B1%BB%E5%9E%8B%E6%95%B0%E6%8D%AE%E7%9B%98" target="_blank">工具链接</a>；</li><% } %></ul></div><div id="noSupportTips"></div>',R="()`~!@#$%^&*-+=_|{}[]:;'<>,.?/",O=[],N="https://www.qcloud.com/doc/product/213/2042",z="https://www.qcloud.com/doc/product/213/2158",$=function(i,a){var e=40*(a-1);1==a&&(O=[]),w.queryKeypair({count:40,offset:e,projectId:i},function(e){var t=e.key_list||[];1!=a||t.length||g("#sshkeySelect").parent().replaceWith('<span>您当前没有可选的ssh密钥, <a href="/cvm/sshkey" data-event="nav">现在创建</a></span>'),O=O.concat(t),W(t),O.length<e.key_total&&$(i,a+1)})},W=function(e){var t=h.tmpl(C,{data:e});g("#sshkeySelect").append(t)},F=function(e){a.call(this,e)},j={},U=[],q={1:"本地磁盘",2:"云硬盘",3:"本地SSD盘",5:"SSD云硬盘"},H=0;(F.prototype=new a).setSelectImage=function(e){var t,i=this.hasPermItems[0],a=e;a&&a[0]?"SELECT"==a[0].nodeName?(t=a.find("option:selected"),this.selectedImage={osType:t.val(),rootSize:t.data("ossize"),osName:t.data("osname"),imgId:t.data("osimgid")},t.attr("data-sysprep")&&(this.selectedImage.sysprep=t.attr("data-sysprep"))):(t=a.find("li.selected"),this.selectedImage={osType:t.data("os"),rootSize:t.data("ossize"),osName:t.data("osname"),imgId:t.data("osimgid")}):this.selectedImage={osType:i.osType,rootSize:i.rootSize,osName:i.osName,imgId:i.itemId}};var V=null,G=null,Y=null;F.prototype.exec=function(){var i=this,e=this.hasPermItems[0];this.isWindows=this.hasFeature("WINDOWS"),this.wikiHref=this.isWindows?N:z,this.imageType="",Y=this.hasPermItems[0].cbsList?this.hasPermItems[0].cbsList:[];for(var t=0;t<Y.length;t++)"xvde"==Y[t].target&&(V=Y[t].hostBlockSize,G=Y[t].vmBlockSize);if(this.oldSysDiskFlag=4096==V&&4096==G||512==V&&4096==G,this.selectedItemIsExpire())return y.error("服务器已过期，请续费");this.checkOs().done(function(){var t=h.tmpl(r,{osName:e.osName,wikiHref:i.wikiHref,errTips:i.errTips,rootType:e.rootType,originOS:e.osType,oldSysDiskFlag:i.oldSysDiskFlag,regionId:I.getRegionId(),isOverseasRegion:I.isOverseasRegion(),zoneId:e.zoneId,rootSize:20,targetOS:null},{normalTips:v,localdiskTips:p,lastSetting:P,agent:S,oldClouddiskTips:u});i.getOs().done(function(){var e=i.hasPermItems[0];i.$dialog=b.create(t,"730","",{title:"重装系统",preventResubmit:!0,button:{"开始重装":function(){i.reset(),k.click("yunzhuji.chongzhuang")}},defaultCancelCb:function(){i.noSupportActive=!1}}),setTimeout(function(){b.center()},0),i.wrapper=g("#resetosWrapper"),i.lastSettingWrap=g("#lastSettingWrap"),i.initOs(),i.initImageRes(),i.initPills(!0),i.bindEvent(),I.isOverseasRegion()&&2==e.rootType?("linux"==e.osType?g("#osSet [data-value=Windows]").prop("disabled",!0).addClass("disabled"):g("#osSet [data-value!=Windows]").prop("disabled",!0).addClass("disabled"),i.osPills.select(g("#osSet [data-value]").not(".disabled").first()),i.osPills.change()):1==i.oldSysDiskFlag&&g("#osSet [data-value=Windows]").prop("disabled",!0).addClass("disabled"),"2"!=e.rootType&&"5"!=e.rootType||"100001"!=e.zoneId||("windows"==e.osType?g("#osSet [data-value!=Windows]").prop("disabled",!0).addClass("disabled"):g("#osSet [data-value=Windows]").prop("disabled",!0).addClass("disabled"))})})},F.prototype.initPills=function(e){this.loginSetPills&&(g("#loginSet").html(""),this.loginSetPills=null);var t,i=[{name:"密码",active:!0,value:1},{name:"SSH密钥",value:2},{name:"保留镜像设置",value:3}];t=("windows"==this.selectedImage.osType&&(i.splice(1,1),i[0].active=!0),1);var a=this.hasPermItems[0];e&&$(a.projectId,1);var s=this.lastSettingWrap,n=s.find(".sshKey-li"),o=s.find(".pwd-li"),r=s.find(".pwd-confirm-li"),d=s.find(".reserved-image-li"),l=function(e){n.hide(),o.hide(),r.hide(),d.hide(),1==e?(g("#resetPwd").val()&&r.show(),o.show()):2==e?n.show():3==e&&d.show()};this.loginSetPills=new m({renderTo:g("#loginSet"),data:i,newMode:!0,change:function(){var e=this.val();l(e)}}),l(t);var c=this.selectedImage.osType,p="root";"windows"==c?p="Administrator":/ubuntu/i.test(this.selectedImage.osName)&&(p="ubuntu"),g("#loginUsername").text(p);var u=g("#loginSet").find('[data-value="3"]');u.hide().prev().addClass("last"),3!=this.imageSetPills.val()&&5!=this.imageSetPills.val()||"windows"==c&&0!=this.selectedImage.sysprep||u.show().prev().removeClass("last")},F.prototype.renderSysdiskUi=function(e){var t=this.hasPermItems[0];if(e&&e.targetOs){if(2!=t.rootType){var i=t.rootSize;e.localRootSize=20<i?i:20}else{var a=t.rootSize;e.cbsRootSize=a}var s=h.tmpl(p,{rootType:t.rootType,rootSize:20,originOS:t.osType,targetOS:e.targetOs,zoneId:t.zoneId,oldSysDiskFlag:this.oldSysDiskFlag,regionId:I.getRegionId(),isOverseasRegion:I.isOverseasRegion()});g("#localdisktips").html(s);var n,o,r=h.tmpl(D,e);if(g(".sysdiskoption-li").html(r),"100001"==t.zoneId&&e.isWindows&&(e.targetOs="windows"),2!=e.rootType&&5!=e.rootType||"linux"!=e.targetOs||(n=e.rootSize,o=t.rootSize,n=n?n<o?o:n:o,this.renderResetDiskRanger(n)),!this.isWindows&&"windows"==e.targetOs,d=this.isWindows&&"linux"==e.targetOs,(2==e.rootType||5==e.rootType)&&d)if(n=20,e.rootSize){if(e.rootSize<50)n=20<e.rootSize?e.rootSize:20,this.renderResetDiskRanger(n);else if(50==e.rootSize){r=h.tmpl(D,e);g(".sysdiskoption-li").html(r)}}else n=20,this.renderResetDiskRanger(n);this.getPrice(n)}},F.prototype.clearStatus=function(){g("#resetPwd").val(""),g("#resetConfirmPwd").val(""),g(".pwd-confirm-li").hide(),g(".payflow-li").hide(),g(".payback-li").hide(),g(".payoff-li").hide(),g(".payflow-li").find(".oCost").text(""),g(".payflow-li").find(".nCost").text(""),g(".payback-li").find(".realCost").text(""),g(".payoff-li").find(".realCost").text(""),g(".payoff-li").find(".realDeadline").text(""),g(".payoff-li").find(".realRestday").text("")},F.prototype.initImageRes=function(){var s=this,e=[{name:"当前镜像",active:!0,value:1},{name:"公共镜像",value:2},{name:"自定义镜像",value:3},{name:"共享镜像",value:5},{name:"服务市场",value:4}];if(I.isOverseasRegion()){for(var t=[],i=0;i<e.length;i++){var a=e[i];4!=a.value&&t.push(a)}e=t}var n=this.lastSettingWrap,o=n.find(".curImg-li"),r=n.find(".commonImg-li"),d=n.find(".diyImg-li"),l=n.find(".sharedImg-li"),c=n.find(".marketImg-li"),p=this.hasPermItems[0],u=function(e,t){o.hide(),r.hide(),d.hide(),l.hide(),c.hide(),!t&&s.clearStatus(),!t&&g("#resetosTips").html(h.tmpl(v,{wikiHref:s.wikiHref}));var i={rootName:q[p.rootType],isWindows:s.isWindows,rootType:p.rootType};if(b.toggleBtnDisable(!1),1==e)s.errTips&&b.toggleBtnDisable(!0),H=0,o.show(),s.setSelectImage(),s.targetOs=s.isWindows?"windows":"linux";else{if((H=2)==e){s.imageType="common";var a=g("#commonImageSelect");r.show()}else if(3==e){s.imageType="custom",s.checkXen();a=g("#customImageSelect");d.show()}else if(5==e){s.imageType="custom";a=g("#sharedImageSelect");l.show()}else if(4==e){s.imageType="market",s.checkXen();a=g("#marketSelect");c.show()}s.setSelectImage(a),s.targetOs=s.selectedImage.osType,i.rootSize=s.selectedImage.rootSize}i.targetOs=s.targetOs,!t&&s.initPills(),s.renderSysdiskUi(i)};this.imageSetPills=new m({renderTo:g("#imageSet"),data:e,newMode:!0,change:function(){var e=this.val();u(e)}}),u(1,!0)},F.prototype.initOs=function(e){var t,n=this,o=this.hasPermItems[0];if(0==o.deviceClass.indexOf("VSHGPU"))t=[{name:"CentOS",active:!0,value:"CentOS"},{name:"Ubuntu",value:"Ubuntu"},{name:"Windows",value:"Windows"}];else{t=[{name:"CentOS",active:!0,value:"CentOS"},{name:"Debian",value:"Debian"},{name:"SUSE",value:"SUSE"},{name:"openSUSE",value:"openSUSE"},{name:"Ubuntu",value:"Ubuntu"},{name:"Windows",value:"Windows"}];for(var i=0;a=U[i];i++)if(/^FreeBSD/i.test(a.desc)){t.push({name:"FreeBSD",value:"FreeBSD"});break}var a;for(i=0;a=U[i];i++)if(/^CoreOS/i.test(a.desc)){t.splice(1,0,{name:"CoreOS",value:"CoreOS"});break}}var s=function(e,t){for(var i,a=[],s=0;i=U[s];s++){new RegExp("^"+e).test(i.desc)&&a.push(i)}n.renderCommonImage(a),n.setSelectImage(g("#commonImageSelect")),n.targetOs=n.selectedImage.osType,t||(n.clearStatus(),n.initPills(),n.renderSysdiskUi({rootName:q[o.rootType],isWindows:n.isWindows,targetOs:n.selectedImage.osType,rootType:o.rootType,rootSize:n.selectedImage.rootSize})),t&&g("#commonImageSelect").on("change",function(){n.clearStatus(),n.setSelectImage(g("#commonImageSelect")),n.initPills(),n.renderSysdiskUi({rootName:q[o.rootType],isWindows:n.isWindows,targetOs:n.selectedImage.osType,rootType:o.rootType,rootSize:n.selectedImage.rootSize})})};this.osPills=new m({renderTo:g("#osSet"),data:t,newMode:!0,change:function(){var e=this.val();s(e)}}),s("CentOS",!0)},F.prototype.renderCommonImage=function(e){var t=this.hasPermItems[0],i=[];if(("2"==t.rootType||"5"==t.rootType)&&"windows"==t.osType&&"100001"==t.zoneId){for(var a=0,s=e.length;a<s;a++)"windows"==e[a].osType&&i.push(e[a]);e=i}var n=h.tmpl(c,{data:e});g("#commonImageSelect").html(n)},F.prototype.initMarket=function(e,t){for(var d=this,i=[],a=0;a<e.length;a++){var s={};0==a&&(s.active=!0),s.name=e[a],s.value=t[a],i.push(s)}var l=this.hasPermItems[0],c=l.deviceClass&&("v1.1"==l.deviceClass.toLowerCase()||"v1.0.5"==l.deviceClass.toLowerCase()),n=function(e,s,n){var o,r=4096==V&&4096==G||512==V&&4096==G,t={categoryId:e,regionId:I.getRegionId(),cputype:l.cpu,memtype:l.mem,count:999,startIndex:0};if(c&&(t.osType="linux"==l.osType?1:2),I.isOverseasRegion()&&2==l.rootType&&(o="linux"==l.osType?1:2),!n&&d.clearStatus(),g(s).data("loaded")&&s){var i=g(s).data("detail");p(i,n)}else g(s).data("loaded",!0),w.getImageProductsDetail(t,function(e){var t=[];if(g(s).data("detail",e),o){for(var i=0,a=e.list.length;i<a;i++)e.list[i]&&e.list[i].imgs&&e.list[i].imgs[0].osType!==o&&t.push(e.list[i]);e.list=t}else if(r){for(i=0,a=e.list.length;i<a;i++)e.list[i]&&e.list[i].imgs&&"1"==e.list[i].imgs[0].osType&&t.push(e.list[i]);e.list=t}else if(("2"==l.rootType||"5"==l.rootType)&&"100001"==l.zoneId){if("windows"==l.osType)for(i=0,a=e.list.length;i<a;i++)e.list[i]&&e.list[i].imgs&&"2"==e.list[i].imgs[0].osType&&t.push(e.list[i]);else for(i=0,a=e.list.length;i<a;i++)e.list[i]&&e.list[i].imgs&&"1"==e.list[i].imgs[0].osType&&t.push(e.list[i]);e.list=t}p(e,n)})},p=function(e,t){for(var i,a=0;i=e.list[a];a++){if(i.imgs&&i.imgs.length)for(var s,n=0;s=i.imgs[n];n++)s.imageName=j[s.os]||s.os;i._size_not_enough=!1;var o="linux"==l.osType?1:2;l.rootSize<i.imgs[0].spaceRequire&&o==i.imgs[0].osType&&(i._size_not_enough=!0)}g("#marketImageList").html(h.tmpl(T,{data:e.list,curOsType:l.osType,curOs:l.osValue,rootSize:l.rootSize,isMiniCvm:c,deviceImageId:l.deviceImageId}));var r=g("#marketImageList").find("li").first();g("#marketSelectVal").text(r.find(".os-item-name").text()),t||(d.setSelectImage(g("#marketSelect")),d.initPills(),d.renderSysdiskUi({rootName:q[l.rootType],isWindows:d.isWindows,targetOs:d.selectedImage.osType,rootType:l.rootType,rootSize:d.selectedImage.rootSize})),g("#marketImageList").find(".tc-15-dropdown").on("click",function(){g(this).hasClass("tc-15-menu-active")?g(this).removeClass("tc-15-menu-active"):g(this).addClass("tc-15-menu-active")}),g("#marketSelect").off("click").on("click","li",function(){d.clearStatus();var e=g(this);g("#marketSelect").find("li").removeClass("selected"),e.addClass("selected"),g("#marketSelectVal").text(e.find(".os-item-name").text()),d.setSelectImage(g("#marketSelect")),d.initPills(),d.renderSysdiskUi({rootName:q[l.rootType],isWindows:d.isWindows,targetOs:d.selectedImage.osType,rootType:l.rootType,rootSize:d.selectedImage.rootSize})})};this.marketPills=new m({renderTo:g("#marketSet"),data:i,newMode:!0,change:function(e){var t=this.val();n(t,e)}}),n(i[0].value,null,!0)},F.prototype.checkOs=function(){var i=this,a=g.Deferred();return w.getAllWhiteList(function(e){e&&e.windows2003_offline&&e.windows2003_offline.length&&(i.whiteList2003=!0)}),this.hasPermItems[0].hypervisor&&0<this.hasPermItems[0].deviceImageId?(this.errTips="xen子机自定义镜像直接不支持按当前重装",a.resolve()):w._cacheRequest("checkResetSys",[{regionId:I.getRegionId(),uuid:this.hasPermItems[0].uuid},function(e){if(!e.checkResult){var t="当前镜像"+(0<i.hasPermItems[0].deviceImageId?"已删除":"已下架");i.errTips=t}a.resolve()},a.reject]),a.promise()},F.prototype.getOs=function(){var s=this,a=this.hasPermItems[0],n=a.deviceClass&&("v1.1"==a.deviceClass.toLowerCase()||"v1.0.5"==a.deviceClass.toLowerCase()),o=s.whiteList2003,r=a.osType,d=a.hypervisor&&!(s.isOperable("XENTOKVM")&&s.listIns.isPrepaidUser),l=/(32位|32bit)/i,c=g.Deferred();return this.queryOs().done(function(e){e.forEach(function(e){if(e._show=!0,0==a.deviceClass.indexOf("VSHGPU")){if("centos"!=e.osClass.toLowerCase()&&"ubuntu"!=e.osClass.toLowerCase()&&"windows"!=e.osClass.toLowerCase())return void(e._show=!1);if("centos"==e.osClass.toLowerCase()){if(e.osVersion1<6||6==e.osVersion1&&(2==e.osVersion2||3==e.osVersion2))return void(e._show=!1);if(-1!=e.desc.indexOf("32位"))return void(e._show=!1)}if("ubuntu"==e.osClass.toLowerCase()&&"Ubuntu Server 16.04.1 LTS 64位"!=e.desc&&"Ubuntu Server 14.04.1 LTS 64位"!=e.desc)return void(e._show=!1);if("windows"==e.osClass.toLowerCase()){if("2012"!=e.osVersion1&&"2008"!=e.osVersion1)return void(e._show=!1);if(-1!=e.desc.indexOf("32位"))return void(e._show=!1)}}if(!s.isWindows&&4<a.mem&&l.test(e.desc))e._show=!1;else{var t=!1;1==e.flag&&(!/windows2003/.test(e.name)||/windows2003/.test(e.name)&&o)&&(n&&(!n||r!==e.osType)||d||(t=!0)),e._show=t}});for(var t,i=0;t=e[i];i++)j[t.name]=t.desc;U=e,w.getMarketWhiteList(function(e){e.length&&(w.getImageCategories(function(e){for(var t=[],i=[],a=0;a<e.length;a++)t.push(e[a].name),i.push(e[a].categoryId);s.initMarket(t,i)}),s.getImage(U),s.getImage(U,!0),c.resolve())})}),c.promise()},F.prototype.queryOs=function(){return w._cacheRequest("queryOs",[{uuid:this.hasPermItems[0].uuid}])},F.prototype.getImage=function(d,l){var c=this.hasPermItems[0],p=4096==V&&4096==G||512==V&&4096==G,u="";I.isOverseasRegion()&&2==c.rootType&&(u="linux"===c.osType?"windows":"linux");var h=this;if(0===c.hypervisor){this.customImage;var m=/32位|32bit/i;n.req({serviceType:"image",cmd:"DescribeImages",data:{status:[2,3],imageType:l?o.TYPES.SHARED:o.TYPES.PRIVATE,limit:200}}).then(function(r){f.promise["catch"](function(e){}).then(function(){for(var e=r.imageSet||[],t=0;n=e[t];t++){n.descOsName=f.getOsName(n.osName);for(var i,a=0;i=d[a];a++)if(n.osName===i.name){n._ositem=i;break}n._ositem&&n._ositem.osType?n.osType=n._ositem.osType:/Xserver|windows/.test(n.osName)?n.osType="windows":n.osType="linux",n._show=!0,!h.isWindows&&4<c.mem&&(n._ositem&&m.test(n._ositem.desc)||m.test(n.descOsName))&&(n._show=!1),c.rootSize<parseInt(n.size,10)&&c.osType==n.osType&&(n._show=!1)}var s=[];if(u){for(t=0;t<e.length;t++)(n=e[t]).osType!==u&&s.push(n);e=s}else if(p){for(t=0;t<e.length;t++)"linux"==(n=e[t]).osType&&s.push(n);e=s}else if(("2"==c.rootType||"5"==c.rootType)&&"100001"==c.zoneId){if("windows"==c.osType)for(t=0;t<e.length;t++)"windows"==(n=e[t]).osType&&s.push(n);else{var n;for(t=0;t<e.length;t++)"linux"==(n=e[t]).osType&&s.push(n)}e=s}var o=g(l?"#sharedImageSelect":"#customImageSelect");o.html(h.getCustomImageUi(e,c.osValue,c.osType,c.deviceImageId,c.rootSize,h.whiteList2003)),o.on("change",function(){h.clearStatus(),h.setSelectImage(o),h.initPills(),h.renderSysdiskUi({rootName:q[c.rootType],isWindows:h.isWindows,targetOs:h.selectedImage.osType,rootType:c.rootType,rootSize:h.selectedImage.rootSize})})})})}},F.prototype.getCustomImageUi=function(e,t,i,a,s,n){return h.tmpl(l,{data:e,curOs:t,curOsType:i,deviceImageId:a,rootSize:s,whiteList2003:n})},F.prototype.renderResetDiskRanger=function(e){var t=this;this.hasPermItems[0];e<20&&(e=20),this.resetDiskRanger=new s({renderTo:g("#resetDiskRanger"),value:e,min:e,max:50,unit:"GB",section:[{value:e,width:5},{value:Math.round((e+50)/2),width:150},{value:50,width:300}],change:function(e){t.getPrice(e)}})},F.prototype.getAgentList=function(){var e={},t=g("#securityAgentCk"),i=g("#monitorAgentCk");return e.security=t.prop("checked")?1:0,e.monitor=i.prop("checked")?1:0,e},F.prototype.getCbsDiskPara=function(){for(var e,t,i,a,s,n=this.hasPermItems[0],o=0;s=n.cbsList[o];o++)"root"===s.diskType&&(e=s.target,i=s.diskSize),"data"===s.diskType&&(t=s.target,a=s.diskSize);return{targetRoot:e,targetData:t,sizeRoot:i,sizeData:a}},F.prototype.getImgIdPara=function(){var e="";return"market"===this.imageType?e="itemId":"custom"===this.imageType&&(e="deviceImageId"),{key:e,val:"2"==H?1*this.selectedImage.imgId:undefined}},F.prototype.getRootSize=function(){var e,t,i,a=this.hasPermItems[0];return this.isWindows&&"windows"==this.selectedImage.osType&&(e=50),!this.isWindows&&"linux"==this.selectedImage.osType&&(e=20<(t=a.rootSize)?t:20),2!=a.rootType?i=e:"windows"==this.selectedImage.osType?i=50:"linux"==this.selectedImage.osType&&(i=this.resetDiskRanger.val()),i<20&&(i=20),i},F.prototype.collectData=function(){var e=this.hasPermItems[0],t=this.selectedImage,i=this.getRootDiskPara(),a=this.getCbsDiskPara(),s=this.getImgIdPara(),n=this.getRootSize(),o={modifyMode:"reinstall_os",isWinOs:"windows"==t.osType?1:0,change_root:{resetFlag:H,osName:t.osName,agentList:this.getAgentList(),rootSize:n},diskInfo:{root:{target:a.targetRoot,type:e.rootType,size:n},data:[{target:a.targetData,type:e.diskType,size:a.sizeData}]}};return o[i.key]=parseInt(n),s.key&&(o.change_root[s.key]=parseInt(s.val)),3==ie&&(o.change_root.keepImageSetting=1),[{goodsCategoryId:100021,appId:I.getAppId(),projectId:e.projectId,regionId:I.getRegionId(),zoneId:e.zoneId,payMode:e.cvmPayMode,goodsNum:1,goodsDetail:{productInfo:[{name:"项目",value:e.projectName},{name:"主机名",value:e.uInstanceId},{name:"内网IP",value:e.deviceLanIp},{name:"所属网络",value:e.netName},{name:"可用区",value:e.zoneName},{name:"磁盘",value:e.rootSize+"=>"+n},{name:"镜像",value:e.osName+"=>"+t.osName}],newConfig:o,curDeadline:e.deadline,resourceId:e.uInstanceId}}]},F.prototype.collectRefundData=function(){var e=this.hasPermItems[0],t=this.selectedImage,i=this.getCbsDiskPara(),a=this.getRootSize();return[{goodsCategoryId:78,appId:I.getAppId(),projectId:e.projectId,regionId:I.getRegionId(),zoneId:e.zoneId,payMode:e.cvmPayMode,goodsNum:1,goodsDetail:{type:"cvm",subType:"cvmBasicConfig",action:"upgradeCvm",zoneId:e.zoneId,curDeadline:e.deadline,returnParts:{rootCbs:e.rootSize},uuid:e.uuid,parts:{os:t.osName,bandwidth:e.bandwidth,cpu:e.cpu,mem:e.mem,diskInfo:{root:{target:i.targetRoot,type:e.rootType,size:a},data:[{target:i.targetData,type:e.diskType,size:i.sizeData}]}},lanIp:e.deviceLanIp,vpcId:e.vpcId,subnetId:e.subnetId,isVpcGateway:e.isVpcGateway,networkPayMode:e.networkPayMode}}]},F.prototype.getPrice=function(e,t){var i,a=this,s=this.hasPermItems[0],n=s.cvmPayMode,o=!this.isWindows&&"windows"==this.selectedImage.osType;if(n==x.CVMPAYMODE.YEARMONTH)2!=s.rootType&&5!=s.rootType||!o?(i=this.collectData(),w.getPrice({goodsDetail:i},function(e){a.renderPrice(s,e[0])})):(i=this.collectRefundData(),w.getPrice({goodsDetail:i},function(e){a.renderPrice(s,e[0],!0)}));else if(n==x.CVMPAYMODE.SECOND){for(var r,d,l,c=0,p=0,u=0;r=s.cbsList[u];u++)r.diskType&&"data"!==r.diskType||(c+=r.diskSize),"data"===r.diskType&&(p+=r.diskSize);"windows"==s.osType?d=0:"linux"==s.osType&&(d=0<=s.rootSize-20?s.rootSize-20:0),"windows"==this.selectedImage.osType?l=0:"linux"==this.selectedImage.osType&&(l=0<=e-20?e-20:0);var h={cbsSize:c,cpu:s.cpu,disk:p,mem:s.mem,ssd:0,rootDisk:0,rootCbs:d,rootSsd:"0",cbsSsd:"0",cbsPremium:0};w.getPriceForHour({pid:10304,parts:h},function(t){t[10304].money&&(h.rootCbs=l,w.getPriceForHour({pid:10304,parts:h},function(e){a.renderPrice(s,t[10304],!1,e[10304])}))})}},F.prototype.renderPrice=function(e,t,i,a){var s,n=e.cvmPayMode,o=new Date;if(!i){s=new Date(e.deadline);var r=Math.floor((s.getTime()-o.getTime())/864e5)}g(".payback-li").hide(),g(".payflow-li").hide(),g(".payoff-li").hide(),n==x.CVMPAYMODE.YEARMONTH?i?(g(".payback-li").show(),g(".payback-li").find(".realCost").text(Math.abs(t.realTotalCost/100))):(g(".payoff-li").show(),g(".payoff-li").find(".realCost").text(t.realTotalCost/100),g(".payoff-li").find(".realDeadline").text(I.formatDate(s,"yyyy-MM-dd")),g(".payoff-li").find(".realRestday").text(r)):n==x.CVMPAYMODE.SECOND&&(g(".payflow-li").show(),g(".payflow-li").find(".oCost").text(t.money.toFixed(2)),g(".payflow-li").find(".nCost").text(a.money.toFixed(2)))},F.prototype.bindEvent=function(){function e(e){g("#resetPwd").val()?(g("#noPwdNotice").hide(),g(".pwd-confirm-li").show()):(g("#resetConfirmPwd").closest(".tc-15-input-text-wrap").removeClass("error"),g("#resetConfirmPwd").next(".tc-15-input-tips").hide(),g("#noPwdNotice").show(),g("#resetConfirmPwd").val(""),g(".pwd-confirm-li").hide())}g("#resetPwd").on("change",e),g("#resetPwd").on("input",e),g("#resetPwd").on("keyup",e),g("#resetPwd").on("paste",e)},F.prototype.renderNoSupport=function(e){g("#resetosWrapper").hide(),g("#noSupportTips").html(h.tmpl(E,e))},F.prototype.checkXen=function(){var e,t,i=this.hasPermItems[0];"custom"==this.imageType?e="自定义镜像":"market"==this.imageType&&(e="服务市场镜像"),i.hypervisor&&(t=!this.isOperable("XENTOKVM")||!this.listIns.isPrepaidUser||i.zoneId==x.ZONEID.GZ1&&i.cbsList.length?h.tmpl(M,{osName:e}):h.tmpl(A,{osName:e}),g("#resetosTips").html(t),b.toggleBtnDisable(!0))};var K=null,Q=null,Z=null,X=null,J=null,ee=null,te=null,ie=null;F.prototype.checkPassword=function(){this.hasPermItems[0];if(K=g("#sshkeySelect"),Q=g("#resetPwd"),Z=g("#resetConfirmPwd"),X=K.val(),J=g.trim(Q.val()),ee=g.trim(Z.val()),te=this.selectedImage.osType,2==(ie=this.loginSetPills.val())){if(!X)return I.restoreDialogBtn(),y.error("未选择任何密钥"),!1}else if(1==ie){if(g("#r_errtips").text(""),g("#c_errtips").text(""),Q.parent().removeClass("is-error"),Z.parent().removeClass("is-error"),!J)return Q.parent().addClass("is-error"),I.restoreDialogBtn(),g("#r_errtips").text("请输入登录密码"),!1;if(!ee)return Z.parent().addClass("is-error"),I.restoreDialogBtn(),g("#c_errtips").text("请输入确认密码"),!1;if(ee!==J)return Z.parent().addClass("is-error"),I.restoreDialogBtn(),g("#c_errtips").text("两次密码不一致"),!1;if(!function(e,t){var i=R.split("").map(function(e){return"\\"+e}).join("");if("windows"==t){if(!(o=new RegExp("^[\\da-zA-Z"+i+"]{12,16}$")).test(e))return!1;for(var a=[/[a-z]+/,/[A-Z]+/,/[0-9]+/,new RegExp("["+i+"]+")],s=0,n=0;o=a[n];n++)e.match(o)&&s++;return 3<=s}if(!(o=new RegExp("^[\\da-zA-Z"+i+"]{8,16}$")).test(e))return!1;var o;for(a=[/[a-zA-Z]+/,/[0-9]+/,new RegExp("["+i+"]+")],s=0,n=0;o=a[n];n++)e.match(o)&&s++;return 2<=s}(J,te))return Q.parent().addClass("is-error"),"windows"==this.selectedImage.osType?(I.restoreDialogBtn(),g("#r_errtips").text("windows机器密码需12到16位，至少包括三项（[a-z],[A-Z],[0-9]和[()`~!@#$%^&*-+=_|{}[]:;'<>,.?/]的特殊符号）")):(I.restoreDialogBtn(),g("#r_errtips").text("linux机器密码需8到16位，至少包括两项（[a-z,A-Z],[0-9]和[()`~!@#$%^&*-+=_|{}[]:;'<>,.?/]的特殊符号）")),!1;if("/"==J[0])return Q.parent().addClass("is-error"),I.restoreDialogBtn(),g("#r_errtips").text("不支持“/”置于密码首位"),!1}return!0},F.prototype.reset=function(){var e=this,t=this.hasPermItems[0],i=t.rootSize,a=("linux"==t.osType?20:50)<i,s=this.isWindows&&"linux"==this.selectedImage.osType,n=!this.isWindows&&"windows"==this.selectedImage.osType;this.isWindows&&this.selectedImage.osType,!this.isWindows&&this.selectedImage.osType;if(this.checkPassword())if(2!=t.rootType?(s||n)&&(this.renderNoSupport({rootType:t.rootType,originOs:t.osType,targetOs:this.selectedImage.osType,rootSize:i,showRootDiskTip:a}),this.noSupportActive=!0):1==this.oldSysDiskFlag&&n&&(this.renderNoSupport({rootType:t.rootType,originOs:t.osType,targetOs:this.selectedImage.osType,rootSize:i,showRootDiskTip:a}),this.noSupportActive=!0),e.noSupportActive)e.noSupportActive=!1,b.create(2!=t.rootType?L:_,"520","",{title:"linux与windows互换须知",button:{"去提工单":function(){window.open("https://console.qcloud.com/workorder"),b.hide()}}});else if(s||n){var o=h.tmpl(B,{originOs:this.hasPermItems[0].osType,targetOs:this.selectedImage.osType});b.create(o,"580","",{title:"确认重装",preventResubmit:!0,button:{"确定":function(){e.sendReq(),k.click("yunzhuji.chongzhuang")}}})}else e.sendReq()},F.prototype.sendReq=function(){var t=this,e=this.hasPermItems[0],i=this.isWindows&&"linux"==this.selectedImage.osType,a=!this.isWindows&&"windows"==this.selectedImage.osType,s=this.isWindows&&"windows"==this.selectedImage.osType,n=!this.isWindows&&"linux"==this.selectedImage.osType,o=e.cvmPayMode;if(!this.selectedImage.osType)return I.restoreDialogBtn(),y.error("请选择合适的镜像");i&&k.click("yunzhuji.chongzhuang.windowstolinux"),a&&k.click("yunzhuji.chongzhuang.linuxtowindows"),g("#payback-li").is(":visible")&&k.click("yunzhuji.chongzhuang.payback");var r=this.getRootSize(),d=(2==e.rootType||5==e.rootType)&&n&&(e.rootSize==r||e.rootSize<20),l=(2==e.rootType||5==e.rootType)&&a&&e.rootSize<=20,c=this.getAgentList(),p=this.getImgIdPara();if(o==x.CVMPAYMODE.SECOND||o==x.CVMPAYMODE.POSTPAID||2!=e.rootType||(2==e.rootType||5==e.rootType)&&s||d||l){var u={resetFlag:H,osName:"2"==H?this.selectedImage.osName:undefined,deviceLanIp:e.deviceLanIp,uuid:e.uuid,rootSize:r};if(p.key&&(u[p.key]=p.val),1==ie?J&&ee&&(u.passwd=ee):2==ie?u.keyid=X:3==ie&&(u.keepImageSetting=1),u.agentList=c,null===u.osName)return I.restoreDialogBtn(),y.error("请选择合适的镜像");w.resetCvmSystem(u,function(e){b.hide(),t.checkTask(e,"重装操作系统中")})}if(!(2!=e.rootType&&5!=e.rootType||s||d||l)&&e.cvmPayMode==x.CVMPAYMODE.YEARMONTH){var h=this.getCbsDiskPara(),m={};if(a){var f={type:"cvm",subType:"cvmBasicConfig",action:"upgradeCvm",zoneId:e.zoneId,curDeadline:e.deadline,uuid:e.uuid,lanIp:e.deviceLanIp,vpcId:e.vpcId,subnetId:e.subnetId,isVpcGateway:e.isVpcGateway,networkPayMode:e.networkPayMode,rootSize:r,productInfo:[{name:"系统盘",value:h.sizeRoot+"=>"+r}]};m.os=this.selectedImage.osName,m.bandwidth=e.bandwidth,m.cpu=e.cpu,m.mem=e.mem,m.diskInfo={root:{target:h.targetRoot,type:e.rootType,size:r}},f.parts=m,f.returnParts={rootCbs:e.rootSize},h.targetData!=undefined&&h.sizeData!=undefined&&(m.diskInfo.data=[{target:h.targetData,type:e.diskType,size:h.sizeData}]),p.key&&(f[p.key]=p.val),1==ie?J&&ee&&(f.passwd=ee):2==ie?f.keyid=1*X:3==ie&&(f.keepImageSetting=1),f.resetFlag=parseInt(H),f.agentList=c,w.payByCartCvm({categoryId:78,goodsDetail:JSON.stringify(f)},function(e){b.create("<p>您对该CVM的重装系统请求已经提交，订单系统正在处理，您可到订单系统查看详细信息。</p>","480","",{title:"重装系统",button:{"查看订单":function(){location.href="https://console.qcloud.com/deal"}},closeIcon:!1})})}else{var v=this.collectData();t.toPay2(v)}}},i.exports=F}),define("widget/cvmList/resetpwd/resetpwd",function(e,t,i){var g=e("$"),w=e("manager"),a=e("widget/cvmList/operate_base"),b=e("validator"),I=e("dialog"),p=(e("tips"),e("util")),u=e("constants"),h=e("widget/selectedShow/selectedShow"),m='    <div class="form-wrap">        <ul class="form-list">            <li>                <div class="d-tbc form-label"><label>用户名</label></div>                <div class="d-tbc">                    <div class="tc-15-select-wrap m">                        <select class="tc-15-select" id="pwdUserSelect">                            <option value="0">系统默认</option>                            <option value="1">指定用户名</option>                        </select>                    </div>                    <div class="tc-15-input-text-wrap m usr-name">                        <input id="pwdUserIptDefault" class="tc-15-input-text disabled" type="text" disabled="disabled" value="">                        <input id="pwdUserIptCustom" class="tc-15-input-text" type="text" style="display:none">                        <div id="pwdUserIptCustomTip" class="tc-15-input-tips" style="display:none">仅可对系统中已存在的用户进行重置密码操作</div>                    </div>                </div>            </li>            <li>                <div class="d-tbc form-label"><label>新密码</label></div>                <div class="d-tbc">                    <div class="tc-15-input-text-wrap m">                        <input type="password" class="tc-15-input-text">                        <div class="tc-15-input-tips">                            <% if (osSet == 1) { %>                                <%=passwordTip%>                            <% } else if(osSet == 2 || osSet == 4){ %>                                <%=passwordTip%>                            <% } else { %>密码需要12-16个字符，至少包含[a-z]，[A-Z]，[0-9]，[!@#] 中的3种<% } %>                        </div>                    </div>                </div>            </li>            <li>                <div class="d-tbc form-label"><label>确认密码</label></div>                <div class="d-tbc">                    <div class="tc-15-input-text-wrap m">                        <input type="password" class="tc-15-input-text">                    </div>                </div>            </li>            <li>                <div class="d-tbc form-label"><label>验证码</label></div>                <div class="d-tbc">                    <div class="tc-15-input-text-wrap m">                        <input type="text" class="tc-15-input-text">                        <a id="changePwdVcode" href="javascript:;" class="captcha"><img src="<%-vcodeUrl%>"></a>                        <div class="tc-15-input-tips captcha-tips"></div>                    </div>                </div>            </li>        </ul>    </div>',f=u.VCODEURL,y="()`~!@#$%^&*-+=_|{}[]:;'<>,.?/",s=function(e){a.call(this,e)};(s.prototype=new a).exec=function(){for(var e,t=this,i=[],a=[],s=!1,n=0,o="",r=this.hasPermItems,d=0;e=r[d];d++)i.push(e.deviceLanIp),a.push(e.uuid),o="windows"===e.osType?(s=!0,n|=1,"windows机器密码需12到16位，至少包括三项（[a-z],[A-Z],[0-9]和[()`~!@#$%^&*-+=_|{}[]:;'<>,.?/]的特殊符号）"):(!0,/ubuntu/i.test(e.osName)?(!0,n|=4):n|=2,"linux机器密码需8到16位，至少包括两项（[a-z,A-Z],[0-9]和[()`~!@#$%^&*-+=_|{}[]:;'<>,.?/]的特殊符号）");var l=p.tmpl(m,{hasWindows:s,osSet:n,passwordTip:o,powerOffWiki:u.POWEROFFWIKI,vcodeUrl:f+"&t="+(new Date).getTime()});I.create(l,540,"",{title:"重置密码",preventResubmit:!0,button:{"确认重置":function(){t.sendReq(i,a,n)}}}),h.render(this.selectedShowOptions);var c="root/ubuntu/Administrator";1==n?c="Administrator":4==n?c="ubuntu":2==n&&(c="root"),g("#pwdUserIptDefault").val(c),this.bindEvent()},s.prototype.bindEvent=function(){var e=this;g("#changePwdVcode").click(function(){e.changePwdVcode()}),g("#pwdUserSelect").change(function(){var e=g(this).val(),t=g("#pwdUserIptDefault"),i=g("#pwdUserIptCustom"),a=g("#pwdUserIptCustomTip");"0"==e?(t.show(),i.hide(),a.hide(),a.closest(".tc-15-input-text-wrap").removeClass("error"),a.html("仅可对系统中已存在的用户进行重置密码操作")):(t.hide(),i.show(),a.show())})},s.prototype.changePwdVcode=function(){g("#changePwdVcode").find("img").attr("src",f+"&t="+(new Date).getTime())},s.prototype.sendReq=function(e,t,i){var a=this,s=I.el.find("input"),n=g("#pwdUserSelect"),o=s.eq(1),r=s.eq(2),d=s.eq(3),l=s.eq(4),c=n.val(),p=g.trim(o.val()),u=g.trim(r.val()),h=g.trim(d.val()),m=g.trim(l.val()),f=function(e,t){var i={tip:e,errMode:1};return b.showErr(t,i),!1};if("1"==c&&!p)return f("请输入用户名",o);if(!u)return f("请输入新密码",r);if(!h)return f("请输入确认密码",d);if(h!==u)return f("两次密码不一致",d);if(!function(e,t){var i=y.split("").map(function(e){return"\\"+e}).join("");if(1==t){if(!(o=new RegExp("^[\\da-zA-Z"+i+"]{12,16}$")).test(e))return!1;for(var a=[/[a-z]+/,/[A-Z]+/,/[0-9]+/,new RegExp("["+i+"]+")],s=0,n=0;o=a[n];n++)e.match(o)&&s++;return 3<=s}if(2==t||4==t){if(!(o=new RegExp("^[\\da-zA-Z"+i+"]{8,16}$")).test(e))return!1;for(a=[/[a-zA-Z]+/,/[0-9]+/,new RegExp("["+i+"]+")],n=s=0;o=a[n];n++)e.match(o)&&s++;return 2<=s}if(!/^[\da-zA-Z\!\@\#]{12,16}$/.test(e))return!1;var o;for(a=[/[a-z]+/,/[A-Z]+/,/[0-9]+/,/[\!\@\#]+/],s=0,n=0;o=a[n];n++)e.match(o)&&s++;return 3<=s}(u,i))return f("密码不符合规范",r);if("/"==u[0])return f("不支持“/”置于密码首位",r);if(!m)return f("请输入验证码",l);var v={passwd:u,ipList:e,uuidList:t,vcode:m};"1"==c&&(v.user=p),w.resetCvmPasswd(v,function(e){I.hide(),a.checkTask(e,"密码重置中","password")},function(e){40==e.code&&(l.val("").focus(),a.changePwdVcode())})},i.exports=s}),define("widget/cvmList/returncvm/returncvm",function(e,t,i){e("$");var o=e("manager"),a=e("widget/cvmList/operate_base"),r=e("dialog"),d=e("widget/selectedShow/selectedShow"),l='<span class="tit">确定退还服务器？</span><br>    <span class="txt"><dl class="notice-list"><dt>注意：</dt>    <dd>1．退还后所有数据将会被清除且不可恢复，下次刷新无法查看已退还服务器</dd><dd>2．为避免您的服务发生异常，退还前请确保服务器已停止对外服务</dd><dd>3．已冻结的费用将会在月结日时统一返还，届时可在费用中心中查询</dd></dl>    </span>',s=function(e){a.call(this,e)};(s.prototype=new a).exec=function(){var s=this,n=this.hasPermItems;r.confirm(l,function(){for(var e,t=[],i=[],a=0;e=n[a];a++)t.push({deviceLanIp:e.deviceLanIp,deviceWanIp:e.deviceWanIp,deviceClass:e.deviceClass}),i.push(e.uuid);o.returnCvm({deviceInfo:t,uuidList:i,regionId:s.listIns&&s.listIns.regionId||appUtil.getRegionId()},function(e){s.checkTask(e,"退还中")})},null,{title:"退还服务器",width:620,hideIcon:!0}),d.render(this.selectedShowOptions)},i.exports=s}),define("widget/cvmList/shutdown/shutdown",function(e,t,i){var o=e("$"),r=e("manager"),a=e("widget/cvmList/operate_base"),d=e("dialog"),l=(e("util"),e("constants"),e("widget/selectedShow/selectedShow")),c='<span class="tit">确定选中主机进行关机</span><br><label for="shutdownConfirmCheck" class="confirm-it">    <input type="checkbox" class="tc-15-checkbox" id="shutdownConfirmCheck">关机失败时进行强制关机</label><div class="tc-15-msg" style="margin:10px 10px 10px 0">        强制关机的效果等同于关闭物理计算机的电源开关。强制关机可能会导致数据丢失或文件系统损坏，请仅在服务器不能正常关机时使用。    </div>',s=function(e){a.call(this,e)};(s.prototype=new a).exec=function(){var s=this,e=c,n=this.hasPermItems;d.confirm(e,function(){for(var e,t=[],i=[],a=0;e=n[a];a++)t.push(e.deviceLanIp),i.push(e.uuid);i.length&&r.cvmAction({actionType:2,deviceInfo:t,hardPowerOffFlag:o("#shutdownConfirmCheck").prop("checked")?1:0,uuidList:i},function(e){s.checkTask(e,"关机中")})},null,{title:"关机",width:540,hideIcon:!0}),l.render(this.selectedShowOptions)},i.exports=s}),define("widget/cvmList/snapshot/snapshot",function(e,t,i){var n=e("$"),a=(e("manager"),e("widget/cvmList/operate_base")),o=e("dialog"),r=e("qccomponent"),s=e("util"),d=e("appUtil"),l=e("tips"),c=e("reporter"),p=(e("widget/range/range"),e("constants")),u=e("lengthlimiter"),h=(e("widget/selectedShow/selectedShow"),e("modules/cvm/cbs/cbs/data")),m=e("modules/cvm/cbs/cbsutil"),f=p.CBS_META_LIST,v='<div id="upgradeSelectWrap" class="login-cvm-dialog"><div class="tc-15-table-panel">            <div class="tc-15-option-hd">                <h4>请选择磁盘</h4>            </div>            <div class="tc-15-table-panel">            <div id="dialog_cbsList"></div>            </div>    </div><div class="edit_form_wrap snapshot-box">        <ul class="edit_psword">            <li>                <label class="txt">快照名称:</label>                <input class="txt_input" style="width:260px" id="aliasIpt" data-lenLimit="60" maxlength="60" relTipId="nameTip" type="text"/>                <p class="tip" id="nameTip"></p>            </li>        </ul></div></div>',g=function(e){a.call(this,e)};(g.prototype=new a).exec=function(){var e=this,t=(this.hasPermItems[0],s.tmpl(v,{}));o.create(t,"600","",{title:"调整磁盘",preventResubmit:!0,button:{"确定":function(){e.execSnapShot()}}}),c.click("yunzhuji.CBS.createSnapshotDialog"),this.wrapper=n("#upgradeSelectWrap"),this.renderSelectGrid(),u.trigger()},g.prototype.renderSelectGrid=function(){var i,s=this,e=(this.hasPermItems[0],r.getComponent("grid-view"));s.cbsList=this.filterSnapAbility(),s.gridView=new e({$data:{hasFirst:!1,initGetData:!1,canResizeColum:!1,selectedHighlight:!1,maxHeight:290,minHeight:172,autoMaxHeight:!1,maxHeightOffset:10,count:5,colums:[{key:"radio",name:"",width:"",minWidth:50,required:!0},{key:"cbsInstanceId",name:"ID/云硬盘名",width:"",minWidth:153,required:!0},{key:"diskSize",name:"磁盘容量",width:153,required:!0},{key:"volumeType",name:"磁盘类型",width:153,required:!0}],list:[],showState:!1,showPagination:!1},diskTypeFilterOptions:(i=[],f=f||[],n.each(f,function(e,t){i.push({label:t.name,value:t.medium})}),i),getHeadContent:function(e){if("volumeType"===e.key)return'<grid-view-header-filter b-ref="diskTypeFilter" b-with="{filterOptions: diskTypeFilterOptions, col: col, change: filterchange.bind(this.$root)}"></grid-view-header-filter>'},getCellContent:function(e,t,i){return"radio"==i.key?'<div class="tc-15-first-radio"><input type="radio" class="tc-15-radio">'+(s.gridView.sUInstanceId==t.cbsInstanceId?"checked   ":"")+"</div>":"diskSize"===i.key?"<div><p>"+t.diskSize+"G</p></div>":"cbsInstanceId"===i.key?"<div><p>"+t.cbsInstanceId+'</p><p><span class="text-overflow m-width">'+t.alias+"</span></p></div>":"volumeType"===i.key?"<div><p>"+m.getCbsMetaByMedium(t.volumeType).name+"</p></div>":void 0},filterchange:function(i){var a=[];n(s.cbsList).each(function(e,t){-1!=i.indexOf(t.volumeType)&&a.push(t)}),s.renderGrid(a,1,5,s.gridView)},setTrAttr:function(e,t){return{"data-cbsinstanceid":t.cbsInstanceId}},events:{"click tr":function(e){n(e.target).closest("tr").find(":radio").prop("disabled")||(n(this.$el).find(":radio").prop("checked",!1),n(e.target).closest("tr").find(":radio").prop("checked",!0))}},getData:function(e){e.count,e.page;s.renderGrid(s.cbsList,s.gridView)}}),n("#dialog_cbsList").append(s.gridView.$el),s.renderGrid(s.cbsList,s.gridView)},g.prototype.renderGrid=function(e,t){var i=e;t.setData({list:i})},g.prototype.execSnapShot=function(e){var t=(_self=this).hasPermItems[0],i=n(_self.gridView.$el).find(":radio:checked"),a=n("#upgradeSelectWrap").find('input[type="text"]').eq(0);if(!i.length)return l.error("请选择磁盘"),void o.toggleBtnDisable();var s=n(a).val();_self.gridView.sUInstanceId=i.closest("tr").data("cbsinstanceid"),h.createSnapshot({storageId:_self.gridView.sUInstanceId,snapshotName:s,regionId:d.getRegionId(),projectId:t.projectId}).done(function(){o.hide(),l.success("快照创建中！",3e3)}),c.click("yunzhuji.CBS.createSnapshotBtn")},g.prototype.filterSnapAbility=function(){for(var e=this.hasPermItems[0].cbsList,t=[],i=0,a=e.length;i<a;i++)1==e[i].cbsSnap&&t.push(e[i]);return t},i.exports=g}),define("widget/cvmList/upgrade_common",function(e,t,i){var o=e("manager"),a=e("tips"),d=e("appUtil"),l=e("dialog"),s=e("router"),n=e("reporter"),r=function(e){this.ins=e,this.selectedItem=e.hasPermItems[0],this.yearmonthPriceData={},this.hourPriceData={}},c={windows:50,linux:20};r.prototype={getInputData:function(){var e=this.selectedItem,t=this.ins,i=t.cpuPills?t.cpuPills.val():e.cpu,a=t.memPills?t.memPills.val():e.mem,s=t.cbsRange?t.cbsRange.val():this.getCbsSize(),n=t.bandWidthRange?parseInt(t.bandWidthRange.val()):undefined,o=e.disk,r=e.diskType,d=e.deviceWanIp?1:0,l=0;3==e.diskType&&(l=o,o=0);var c={cpu:parseInt(i),mem:parseInt(a),cbsSize:parseInt(s),bandwidth:n,diskType:r,disk:o,wanIp:d,ssd:l};return this.setRootPara(c),c},getCbsSize:function(e){var t=this.selectedItem,i=0;if(e){for(var a=0;s=t.cbsList[a];a++)if(s.cbsInstanceId==e){i=s.diskSize;break}}else{var s;for(a=0;s=t.cbsList[a];a++)s.diskType&&"data"!==s.diskType||1==s.portable||(i+=s.diskSize)}return i},setRootPara:function(e){var t=this.ins,i=this.selectedItem,a=t.getRootDiskPara();if(a.key){var s=c[i.osType];e[a.key]=a.val-s<0?0:a.val-s}for(var n=["rootDisk","rootCbs","rootSsd"],o=0,r=n.length;o<r;o++)n[o]!=a.key&&(e[n[o]]=0)},getPrice:function(e){var t=this;o.getPrice({goodsDetail:e},function(e){t.setPriceUI(e,{})})},getPriceForHour:function(t,e,i){var a=this;o.getPriceForHour({pid:t,parts:e},function(e){a.setPriceUIForHour(t,e,i),a.hourPriceData[t]=e[t]||{}})},setPriceUI:function(e,t){var i=this.ins.wrapper||$("body"),a=e[0].totalCost/100,s=e[0].realTotalCost/100,n=i.find('[data-field="cost"]'),o=i.find("[data-discount]");if($(".cost-li").show(),n.html(Math.abs(s)),$(".deadline-li").hide(),e[0].newDeadline){$(".cost-li").hide(),$(".deadline-li").show(),$(".curDeadline").html(this.selectedItem.deadline),$(".targetDeadline").html(e[0].newDeadline),$(".oldC").html(this.selectedItem.cpu),$(".oldM").html(this.selectedItem.mem),$(".newC").html(t.cpu),$(".newM").html(t.mem);var r=(e[0].downGradeCvmCost/100).toFixed(2);0<r?($(".realCost").html("补差价"+r),$(".payback-tag").hide(),$(".payoff-tag").show()):($(".realCost").html("退差价"+Math.abs(r)),$(".payback-tag").show(),$(".payoff-tag").hide(),$(".oldDate").html(this.getYearMonthDay(this.selectedItem.deadline)),$(".newDate").html(this.getYearMonthDay(e[0].newDeadline))),this.getActionsLimit(d.getRegionId(),"upgradecvm",this.selectedItem.uInstanceId).then(function(e){var t=(e=e||{maxCount:0,currCount:0}).maxCount-e.currCount;$(".maxCount").html(e.maxCount),$(".leftCount").html(t),0==t?l.toggleBtnDisable(!0):l.toggleBtnDisable(!1)})}else l.toggleBtnDisable(!1);a&&a!==s?(i.find('[data-field="origin-cost"]').html(a),i.find('[data-field="pricetitle"]').text("优惠价"),o.show()):(i.find('[data-field="pricetitle"]').text("需支付费用"),o.hide())},getYearMonthDay:function(e){return-1!=e.indexOf(" ")&&(e=e.split(" ")[0]),/(\-)/.exec(e),e.replace(RegExp.$1,"年").replace(RegExp.$1,"月").concat("日")},setPriceUIForHour:function(e,t,i){var a=this.ins.wrapper||$("body"),s=(t=t[e]||{}).money.toFixed(2),n=a.find('[data-field="cost"]'),o=a.find('[data-field="orig-config-cost"]');i&&o.html(s),n.html(s)},getPriceParaForReduce:function(e,t){for(var i,a,s,n,o,r=this.selectedItem,d=(this.getInputData(),{}),l=0;o=r.cbsList[l];l++)"root"===o.diskType&&(i=o.target,s=o.diskSize),"data"===o.diskType&&(a=o.target,n=o.diskSize);return d.os=r.osValue,d.bandwidth=r.bandwidth,d.cpu=e,d.mem=t,d.diskInfo={root:{target:i,type:r.rootType,size:s||r.rootSize},data:[{target:a,type:r.diskType,size:n||r.diskSize}]},{type:"cvm",subType:"cvmBasicConfig",action:"upgradeCvm",lanIp:r.deviceLanIp,uuid:r.uuid,curDeadline:r.deadline,vpcId:r.vpcId,subnetId:r.subnetId,isVpcGateway:r.isVpcGateway,networkPayMode:r.networkPayMode,returnParts:{cpu:r.cpu,mem:r.mem},parts:d}},getPriceParaForConfig:function(e){var t,i=this.selectedItem,a=this.getInputData(),s={};s.upgradeCpu=a.cpu,s.oldCpu=i.cpu,s.upgradeCvmConfig=1,s.upgradeMem=a.mem,s.oldMem=i.mem,s.upgradeCvmConfig=1;for(var n,o=0;n=i.cbsList[o];o++)if("data"===n.diskType&&1!=n.portable){t=n.target;break}return s.upgradeDiskInfo={data:[{target:t,type:i.diskType,size:a.cbsSize}]},s.oldDiskInfo={data:[{target:t,type:i.diskType,size:this.getCbsSize(e)}]},s.upgradeCvmConfig=1,{type:"cvm",subType:"cvmBasicConfig",action:"upgradeCvm",lanIp:i.deviceLanIp,uuid:i.uuid,curDeadline:i.deadline,vpcId:i.vpcId,subnetId:i.subnetId,isVpcGateway:i.isVpcGateway,networkPayMode:i.networkPayMode,parts:s}},getBandwidthPricePid:function(){return 1e4},getConfigPricePid:function p(){var e=$.Deferred();return e.resolve(10578),Promise.resolve(e.promise())},checkSecondModeEnoughPay:function(){var s=this,t=new Promise(function(i){o.getMargin(function(e){var t=e.realBalance;i(t/100)})}),i=new Promise(function(i){s.getConfigPricePid().then(function(t){if(s.hourPriceData[t])i(s.hourPriceData[t].money);else{var e=s.getInputData();e.bandwidth=undefined,o.getPriceForHour({pid:t,parts:e},function(e){e=e[t]||{},i(e.money)})}})}),n=new Promise(function(t){var i=s.getBandwidthPricePid();if(s.hourPriceData[i])t(s.hourPriceData[i].money);else{var e=s.getInputData();o.getPriceForHour({pid:i,parts:{bandwidth:e.bandwidth||s.selectedItem.bandwidth}},function(e){e=e[i]||{},t(e.money)})}});return new Promise(function(a){var e=[t,i];s.ins.isNetworkSecondPay()&&e.push(n),Promise.all(e).then(function(e){var t=e[0],i=e[2]?e[1]+e[2]:e[1];a(i<=t)})})},showNotEnoughPay:function(e,t){e=e||'<span class="tit">您的余额不足以支撑所有按量付费资源一个小时的消耗，请先充值!</span>',t=t||"余额不足",l.confirm(e,function(){s.navigate("/account/recharge"),n.click("yunzhuji.btn.recharge")},null,{title:t,width:540,mainBtnName:"立即充值"})},toUpgrade:function(e){if(0==this.ins.wrapper.find('[data-field="cost"]').text()&&("undefined"==typeof this.ins.upgradePrice||0==this.ins.upgradePrice))return a.error("该升级方案总计费用为0元, 请重新选择"),this.ins.restoreDialogBtn();this.ins.toPay2(e)},getActionsLimit:function(e,t,i){var a=$.Deferred(),s={action:t,instanceIds:[i]};return o.delegateCApi(e,"cvm","DescribeCvmActionsLimit",s,function(e){e.data&&0<e.data.length?a.resolve(e.data[0]):a.resolve({maxCount:0,currCount:0})},function(e){a.reject(e)}),a}},i.exports=r}),define("widget/cvmList/upgradebandwidth/upgradebandwidth",function(e,t,i){var u=e("$"),r=e("manager"),a=e("widget/cvmList/operate_base"),d=e("dialog"),h=e("util"),m=e("appUtil"),l=e("tips"),o=e("widget/range/range"),s=(e("datepicker"),e("widget/selectedShow/selectedShow")),f=e("constants"),n=e("widget/cvmList/upgrade_common"),v=e("qccomponent"),c=e("reporter"),p=e("widget/cvmList/bandwidthimit/bandwidthimit"),g=65535,w='<div style="font-weight:bold; font-size:18px; margin-bottom:15px; color:#404a58"><%=title%></div><div class="act-outline"><div class="act-details">        <table class="act-details-tb">            <tbody>            <% for (var i = 0, item; item = allItems[i]; i++) { %><tr><td><%=i+1%></td><td><span class="entity-name" title="<%=item.alias%>"><%=item.alias%></span><span class="act-result"><%=item.networkPayModeDesc%></span>                    </td></tr><% } %>            </tbody>        </table>    </div></div>',b='<style>.hasDatepicker .dialog_layer_main{overflow: visible;}</style><div class="form-wrap"  id="upgradeBandwidthWrap">        <ul class="form-list">            <li>                <div class="form-label"><label>网络计费模式</label></div>                <div><%=networkPayModeDesc%>                    <a href="javascript:void(0);"  id="chooseFlow" style="display:none;">  切换按流量计费</a>                    <span id="leftChangeCount" style="display:none;">(转换后将消耗一次转换机会)</span>                </div>            </li>        <li data-filed="origconfig">                <div class="form-label"><label>当前带宽</label></div>                <div class="form-input">                    <p><%-bandwidth%>Mbps</p>                </div>            </li>            <li>                <div class="form-label"><label>目标带宽</label></div>                <div class="form-input">                    <div class="bandwidth-choose-area" id="bandwidthChooseArea" style="width:450px"></div>                    <p class="datetime-tips">升级带宽必须大于本次升级时间段内最大带宽</p>                    <p class="datetime-tips" id="buyEipTips" style="display: none;"></p>                </div>            </li>            <li>                <div class="form-label"><label>生效时间</label></div>                <div class="form-input">            <qc-date-picker id="bandwidthDateInput"></qc-date-picker>                    <p class="datetime-tips">结束时间不能超过服务器到期时间，当前有效期至<%-deadline%></p>                    <p class="text-primary" id="bandwidthDatePtxt"></p>                </div>            </li>            <li>                <div class="form-label"><label data-field="pricetitle">需支付费用</label></div>                <div class="form-input">                    <span class="cost" ><strong data-field="cost"></strong>元</span><span data-discount style="display:none;font-size:1.2em;"> <span data-field="origin-cost" style="text-decoration:line-through; margin:0 5px"></span>元</span>                </div>            </li>                    </ul>    </div>',I='<div class="form-wrap" id="upgradeBandwidthWrap">        <ul class="form-list">            <li>                <div class="form-label"><label>网络计费模式</label></div>                <div><%=networkPayModeDesc%></div>            </li>            <li>                <div class="form-label"><label>原配置</label></div>                <div class="form-input">                    <p class="normal-txt"><span><%-bandwidth%>Mbps</span><span class="cost"><strong data-field="orig-config-cost"></strong>元/小时</span></p>                </div>            </li>            <li>                <div class="form-label"><label>目标带宽</label></div>                <div class="form-input">                    <div class="bandwidth-choose-area" id="bandwidthChooseArea" style="width:450px"></div>                    <p class="text-primary">带宽调整实时设定，实时生效</p>                    <p class="datetime-tips" id="buyEipTips" style="display: none;"></p>                </div>            </li>            <li>                <div class="form-label"><label data-field="pricetitle">调整后单价</label></div>                <div class="form-input">                    <span class="cost" ><strong data-field="cost"></strong>元/小时</span>                </div>            </li>        </ul>    </div>',y='<div class="act-outline">        <div style="text-indent:2em;">每台主机只允许在按带宽计费与按流量计费两种模式之间转换<%=maxCount%>次，<span style="color:red;">该主机已经转换<%=currCount%>次，转换次数用完后将无法再转换。</span></div>        <div style="text-indent:2em;">流量计费切换带宽计费实时生效。切换后带宽费<span style="color:red;">从切换当天0点开始算。带宽费用按原价计算，不享受折扣</span></div>        <div style="margin-top:20px;font-weight:bold;">您是否确定要操作？</div></div>',k=function(e){a.call(this,e)};(k.prototype=new a).exec=function(e){if(this.isChangeMode=e,!this.listIns.isPrepaidUser||this.listIns.isBandwidthPackageUser)return this.execBandwidthLimit();var t=this.operateAuth.getItemsNetworkPayMode();if(t.isSame){var i=t.mode;if(i==f.NETWORKPAYMODE.FLOW&&!e)return this.execBandwidthLimit();if(this.isSingle()){if(this.selectedItemIsExpire())return l.error("服务器已过期，请续费");this.oldBandwidth=null,this.upgradeCommon=new n(this),i==f.NETWORKPAYMODE.SECOND?this.execSecond():this.execMonthYear(),s.render(this.selectedShowOptions)}else{var a=this.hasPermItems[0].cvmPayModeDesc;this.tipCantBatchUpgrade("网络"+a+"模式无法批量调整")}}else this.tipCantBatchUpgrade("网络计费模式不同, 无法批量调整")},k.prototype.tipCantBatchUpgrade=function(e){var t=h.tmpl(w,{allItems:this.selectedItems,title:e});this.showDialog(t,function(){d.hide()}),d.getBtn(0).hide()},k.prototype.execBandwidthLimit=function(e){var t=new p({listIns:this.listIns,button:this.button,selectedItems:this.selectedItems});t.permResult=this.permResult,t.hasPermItems=this.hasPermItems,t.selectedItems=this.selectedItems,t.selectedShowOptions=this.selectedShowOptions,t.args=["bandwidthimit",this.selectedItems,e],t.upgrade=this,t.exec&&t.exec()},k.prototype.execMonthYear=function(){var i=this,e=this.hasPermItems[0],t=e.deadline||"",a=m.formatDate(m.getDate(t),"yyyy-MM-dd");t=t.replace(/\-/g,"/");var s=e.networkPayModeDesc;this.isChangeMode&&(s="按带宽包年包月计费");var n=h.tmpl(b,{bandwidth:e.bandwidth,deadline:a,networkPayModeDesc:s});this.showDialog(n,function(){i.toUpgrade()}),this.wrapper=u("#upgradeBandwidthWrap");var o=this.datepicker=v.mount("bandwidthDateInput",{$data:{tabs:[]}}),r=new Date(m.getSystemTime()),d=new Date(t)<r?r:new Date(t),l=m.formatDate(r,"yyyy-MM-dd"),c=m.formatDate(d,"yyyy-MM-dd");o.setAllowRange(l,c),o.setSelectedRange(l,c),this.isChangeMode&&(o.disabled=!0,u(".tc-15-calendar2-hook").attr("data-title","流量转带宽暂不支持修改生效时间"));var p=l.split("-");this.wrapper.find("#bandwidthDatePtxt").text("带宽升级将在"+p[0]+"年"+(p[1]-0)+"月"+(p[2]-0)+"日生效"),o.$on("datepick",function(e){var t=e.from.split("-");l==e.from?i.wrapper.find("#bandwidthDatePtxt").text("带宽升级将在"+t[0]+"年"+(t[1]-0)+"月"+(t[2]-0)+"日生效"):i.wrapper.find("#bandwidthDatePtxt").text("带宽升级将在"+t[0]+"年"+(t[1]-0)+"月"+(t[2]-0)+"日00:00:00生效"),i.renderBandwidthRange(!0)}),this.renderBandwidthRange(),e.networkPayMode!==f.NETWORKPAYMODE.MONTHYEAR&&e.networkPayMode!==f.NETWORKPAYMODE.FLOW||this.showChangeModeInfo()},k.prototype.showChangeModeInfo=function(){var s=this,t=m.getRegionId();(function(){for(var e=0;e<f.NOT_SUPPORT_HOURLY_REGION.length;e++)if(t==f.NOT_SUPPORT_HOURLY_REGION[e])return!1;return!0})()&&s.getChangeLimit().then(function(e){e=e||{};var t=(s.changeLimitInfo=e).maxCount-e.currCount;if(s.isChangeMode){d.el.find("#leftChangeCount").show();var i="每台主机只允许在按带宽计费与按流量计费两种模式之间转换"+e.maxCount+"次。该主机已经转换"+e.currCount+"次，转换次数用完后将无法再转换。</br>",a='<p class="tc-15-msg warning" style="margin: 0 0 10px;"> <span class="tip-info">'+(i+='流量计费切换带宽计费实时生效。切换后带宽费<strong style="color:#DF9500;">从切换当天0点</strong>开始算。带宽费用<strong style="color:#DF9500;">按原价计算，不享受折扣</strong>')+"</span></p>";d.el.find(".dialog_layer_cont").prepend(a)}else 0<t&&u("#chooseFlow").show().click(function(){s.execBandwidthLimit("changeFlow")})})},k.prototype.getChangeLimit=function(){if(this.changeLimitInfo)return(e=u.Deferred()).resolve(this.changeLimitInfo),e;var e,t=this.hasPermItems[0];return e=this.upgradeCommon.getActionsLimit(m.getRegionId(),"SetCvmBandwidth",t.uInstanceId)},k.prototype.renderBandwidthRange=function(a){var s=this,n=this.hasPermItems[0];if(this.isNetworkSecondPay())s.bandWidthRange=new o({renderTo:u("#bandwidthChooseArea"),value:n.bandwidth,change:function(){s.changeBandwidth()}}),s.changeBandwidth(!0);else if(s.isChangeMode){var e=n.bandwidth==g||200<n.bandwidth?0:n.bandwidth;s.bandWidthRange=new o({renderTo:u("#bandwidthChooseArea"),value:e,min:1,max:200,unit:"Mbps",section:[{value:20,width:75},{value:50,width:150},{value:100,width:225},{value:200,width:300}],step:1,change:function(){s.changeBandwidth()}}),s.changeBandwidth(!0)}else this.getBandwidthHistory(function(e){var t=s.getMaxMinBandWidthByTimeSpan(e,s.datepicker.selected.from,s.datepicker.selected.to);if(a)s.bandWidthRange.setMaxMin("min",t.max),s.bandWidthRange.val()<t.max&&s.bandWidthRange.val(t.max);else if(1==n.cvmPayMode&&1==n.networkPayMode){var i=n.bandwidth==g||200<n.bandwidth?t.max:n.bandwidth;s.bandWidthRange=new o({renderTo:u("#bandwidthChooseArea"),value:i,min:t.max,max:200,unit:"Mbps",section:[{value:20,width:75},{value:50,width:150},{value:100,width:225},{value:200,width:300}],step:1,change:function(){s.changeBandwidth()}})}else s.bandWidthRange=new o({renderTo:u("#bandwidthChooseArea"),value:n.bandwidth==g?0:n.bandwidth,min:t.max,change:function(){s.changeBandwidth()}});s.changeBandwidth(!0)})},k.prototype.getMaxMinBandWidthByTimeSpan=function(e,t,i){for(var a,s=0,n=100,o=0;a=e[o];o++)Date.parse(a.startTime.replace(/-/g,"/"))<=Date.parse(i.replace(/-/g,"/"))&&Date.parse(a.endTime.replace(/-/g,"/"))>=Date.parse(t.replace(/-/g,"/"))&&(a.bandwidth!=g&&(s=Math.max(a.bandwidth,s)),n=Math.min(a.bandwidth,n));return{min:n,max:s}},k.prototype.getBandwidthHistory=function(t){var i=this,e=this.hasPermItems[0],a=m.getSystemTime();a-=5184e6,this.oldBandwidth?t(this.oldBandwidth):r.getBandwidthHistory({deviceLanIp:e.deviceLanIp,uuid:e.uuid,startTime:m.formatDate(new Date(a),"yyyy-MM-dd"),regionId:i.listIns&&i.listIns.regionId||m.getRegionId()},function(e){i.oldBandwidth=e,t(e)})},k.prototype.collectData=function(){var e=this.hasPermItems[0],t=this.getInputData();return[{goodsCategoryId:100021,appId:m.getAppId(),projectId:e.projectId,regionId:m.getRegionId(),zoneId:e.zoneId,payMode:e.cvmPayMode,goodsNum:1,goodsDetail:{productInfo:[{name:"项目",value:e.projectName},{name:"主机名",value:e.uInstanceId},{name:"内网IP",value:e.deviceLanIp},{name:"所属网络",value:e.netName},{name:"可用区",value:e.zoneName},{name:"带宽",value:e.bandwidth+"=>"+t.bandwidth}],newConfig:{uuid:e.uuid,networkPayMode:e.networkPayMode,modifyMode:"network",bandwidthStartTime:t.sTime,bandwidthEndTime:t.eTime,bandwidth:t.bandwidth,network:{networkPayMode:this.isChangeMode?1:e.networkPayMode,isBandwidthPackage:e.isBandwidthPackageUser,bandwidth:t.bandwidth,bandwidthStartTime:t.sTime,bandwidthEndTime:t.eTime}},curDeadline:e.deadline,resourceId:e.uInstanceId}}]},k.prototype.changeBandwidth=function(e){this.showBuyEipTips(this.bandWidthRange.val()),this.setPrice(e)},k.prototype.setPrice=function(e){var t=this;if(this.isNetworkSecondPay()){var i=this.upgradeCommon.getBandwidthPricePid();if(e){var a=this.getPriceParaForHour(!0);this.upgradeCommon.getPriceForHour(i,a,!0)}else{var s=this.getPriceParaForHour();this.upgradeCommon.getPriceForHour(i,s)}}else{var n=this.collectData();r.getPrice({goodsDetail:n},function(e){t.upgradeCommon.setPriceUI(e,{})})}},k.prototype.getPricePara=function(){var e=this.hasPermItems[0],t=this.getInputData(),i={};i.newBandwidth=t.bandwidth;var a=undefined;return 3==e.diskType&&(a=e.disk),{action:"upgradeBandwidth",type:"cvm",lanIp:e.deviceLanIp,uuid:e.uuid,vpcId:e.vpcId,subnetId:e.subnetId,isVpcGateway:e.isVpcGateway,networkPayMode:e.networkPayMode,startTime:t.sTime,endTime:t.eTime,ssd:a,parts:i}},k.prototype.getPriceParaForHour=function(e){var t=this.hasPermItems[0],i=this.getInputData();return{bandwidth:e?t.bandwidth:i.bandwidth}},k.prototype.execSecond=function(){var e=this,t=this.hasPermItems[0],i=h.tmpl(I,{bandwidth:t.bandwidth,networkPayModeDesc:t.networkPayModeDesc});this.showDialog(i,function(){e.toUpgrade()}),this.wrapper=u("#upgradeBandwidthWrap"),this.renderBandwidthRange()},k.prototype.showDialog=function(e,t){d.create(e,"680","",{title:"调整网络","class":"dialog_layer_v2 hasDatepicker",preventResubmit:!0,button:{"确定":t}})},k.prototype.isSingle=function(){return 1==this.hasPermItems.length},k.prototype.getInputData=function(){var e={bandwidth:this.bandWidthRange.val()};return this.isNetworkSecondPay()||(e.sTime=this.datepicker.selected.from,e.eTime=this.datepicker.selected.to),e},k.prototype.toUpgrade=function(){var t=this,i=this.hasPermItems[0],a=this.getInputData();if(this.isNetworkSecondPay()){if(a.bandwidth==i.bandwidth)return this.restoreDialogBtn(),l.error("带宽未变更!");this.upgradeCommon.checkSecondModeEnoughPay().then(function(e){e?r.upgradeHourCvmBandwidth({uuidList:[i.uuid],lanIpList:[i.deviceLanIp],bandwidth:a.bandwidth},function(e){e=e.data||e,d.hide(),t.checkTask(e,"调整网络中")}):t.upgradeCommon.showNotEnoughPay()}),c.click("yunzhuji.btn.upgradebandwidth.second")}else{var e=function(){var e=t.collectData();t.upgradeCommon.toUpgrade(e),c.click("yunzhuji.btn.upgradebandwidth.monthyear")};if(t.upgradePrice=t.wrapper.find('[data-field="cost"]').text(),this.isChangeMode){d.hide();var s=t.changeLimitInfo.currCount,n=t.changeLimitInfo.maxCount-t.changeLimitInfo.currCount,o=h.tmpl(y,{maxCount:t.changeLimitInfo.maxCount,currCount:s,leftCount:n});d.create(o,"580","",{title:"确认切换","class":"dialog_layer_v2",preventResubmit:!0,button:{"我知道了，确认切换":e}})}else e()}},i.exports=k}),define("widget/cvmList/upgradeconfig/cdhupgradeconfig",function(e,t,i){var n=e("$"),a=e("qccomponent"),o=(e("manager"),e("models/cdh")),d=(e("dialog"),e("widget/range/range")),r=e("appUtil"),s=e("widget/cvmList/jsformutil"),l=e("constants"),c=e("modules/cvm/cdh/cdhconfig"),p=a.extend({$tpl:'    <div>        <div class="tc-15-msg">            调整配置后，该服务器的内网IP可能发生变化。        </div>        <div class="form-wrap" style="padding-top: 10px">            <ul class="form-list">                <li>                    <div class="form-label"><label>ID/主机名</label></div>                    <div class="form-input">                    <div class="id-name-cell">                        <p>                            <span class="text-overflow m-width" title="" > {{selectedItem.uInstanceId}} </span>                        </p>                        <div>                            <span class="text-overflow m-width" title="" >{{selectedItem.alias}}</span>                        </div>                    </div>                    </div>                </li>                <li>                    <div class="form-label"><label>原配置</label></div>                    <div class="item-descr-txt">                        <span class="text-overflow m-width" title="" >{{selectedItem.cpu}}核{{selectedItem.mem}}G</span>                    </div>                </li>                <li>                    <div class="form-label"><label>目标CPU核数</label></div>                    <div class="form-input">                        <div data-role="cdhCpuRange" style="width:450px"></div>                    </div>                </li>                <li>                    <div class="form-label"><label>目标内存容量</label></div>                    <div class="form-input">                        <div data-role="cdhMemRange" style="width:450px"></div>                    </div>                </li>\x3c!--                <li>                    <div class="form-label"><label>目标CPU核数</label></div>                    <div class="form-input">                                <span class="item-descr-txt">                                    <ul>                                        <li>                                            <div class="tc-15-rich-radio" role="radiogroup">                                                <button b-repeat="cpuInfo in cpuList" class="{{cpuInfo.value == cpuSelected ?                                                       cpuInfo.value == cpuList[0].value ? \'tc-15-btn first checked m\' :                                                       cpuInfo.value == cpuList[cpuList.length - 1].value ? \'tc-15-btn last checked m\' :                                                       \'tc-15-btn checked m\'                                                       :                                                       cpuInfo.value == cpuList[0].value ? \'tc-15-btn first m\' :                                                       cpuInfo.value == cpuList[cpuList.length - 1].value ? \'tc-15-btn last m\' :                                                       \'tc-15-btn m\'}}" role="radio" b-on-click="setCpuCurrent(cpuInfo.value)" title="">{{cpuInfo.text}}</button>                                            </div>                                        </li>                                    </ul>                                </span>                    </div>                </li>                <li>                    <div class="form-label"><label>目标内存容量</label></div>                    <div class="form-input">                                <span class="item-descr-txt">                                    <ul>                                        <li>                                            <div class="tc-15-rich-radio" role="radiogroup">                                                <button b-repeat="memInfo in memList" class="{{memInfo.value == memSelected ?                                                       memInfo.value == memList[0].value ? \'tc-15-btn first checked m\' :                                                       memInfo.value == memList[memList.length - 1].value ? \'tc-15-btn last checked m\' :                                                       \'tc-15-btn checked m\'                                                       :                                                       memInfo.value == memList[0].value ? \'tc-15-btn first m\' :                                                       memInfo.value == memList[memList.length - 1].value ? \'tc-15-btn last m\' :                                                       \'tc-15-btn m\'}}" role="radio" b-on-click="setMemCurrent(memInfo.value)">{{memInfo.text}}</button>                                            </div>                                        </li>                                    </ul>                                </span>                    </div>                </li>--\x3e            </ul>        </div>    </div>',$beforeInit:function(){},$afterInit:function(){var i=this,a=n(i.$el).find('[data-role="cdhCpuRange"]')[0],s=n(i.$el).find('[data-role="cdhMemRange"]')[0];o.request({name:"getVpsHostList",data:{regionId:r.getRegionId(),uHostIdList:[i.selectedItem.uHostId]},success:function(e){var t=e.hostList[0];i.setSlider(a,s,t)}})},setSlider:function(e,t,i){var a=this,s=+a.selectedItem.cpu,n=+a.selectedItem.mem;a.newCpuSize=+s,a.newMemSize=+n;var o=i.cpuAvailable+a.newCpuSize,r=i.memAvailable+a.newMemSize;a.cpuRange=new d({renderTo:e,value:+s,min:1,max:+o,unit:"核",section:[{value:1,width:1},{value:+o,width:300}],step:1,change:function(e){a.newCpuSize=+e}}),a.memRange=new d({renderTo:t,value:+n,min:1,max:+r,unit:"G",section:[{value:1,width:1},{value:+r,width:300}],step:1,change:function(e){a.newMemSize=+e}})},setMemCurrent:function(e){this.$set("memSelected",e)},setCpuCurrent:function(e){this.$set("cpuSelected",e)},doAction:function(e){if(this.newCpuSize!=this.selectedItem.cpu||this.selectedItem.mem!=this.newMemSize){var t=c.NEW_PAY_URL,i=JSON.stringify({raw_goodsData:[this.getUpgradeConfParam()]});s.jsFormSender(t,{itemDetails:i},"post","_self"),e.hide()}else e.hide()},getUpgradeConfParam:function(){var e=this.selectedItem;return{goodsCategoryId:"100050",regionId:r.getRegionId(),projectId:+e.projectId,zoneId:+e.zoneId,payMode:1,goodsNum:1,goodsDetail:{curDeadline:"0000-00-00 00:00:00",resourceId:e.uInstanceId,oldConfig:{pid:10555,cpu:+e.cpu,mem:+e.mem},newConfig:{modifyMode:"manual",pid:10555,cpu:+this.newCpuSize,mem:+this.newMemSize,compute:{cpu:+this.newCpuSize,mem:+this.newMemSize},diskInfo:{root:{target:"xvda",type:+e.rootType,size:+e.rootSize},data:{target:"xvdb",type:1,size:+e.disk}}},productInfo:[{name:"项目",value:e.projectName},{name:"内网IP",value:e.deviceLanIp},{name:"ID/主机名",value:e.uInstanceId+"、"+e.alias},{name:"地域",value:l.REGIONNAMES[r.getRegionId()]},{name:"可用区",value:e.zoneName},{name:"原配置",value:e.cpu+"核、"+e.mem+"G内存"},{name:"调整后配置",value:this.newCpuSize+"核、"+this.newMemSize+"G内存"}]}}}},{});i.exports=p}),define("widget/cvmList/upgradeconfig/config",function(e,t,i){e("manager");var s={cpuMem:{1:{data:[1,2,4,8,12],defaults:2},2:{data:[2,4,8,12,16],defaults:4},4:{data:[4,8,12,16,24],defaults:8},8:{data:[8,12,16,24,32],defaults:16},12:{data:[12,16,24,32,60],defaults:24}},stopSelling:{100001:[12,16,24]}},n={cpuMem:{1:{data:[8],defaults:8},2:{data:[16],defaults:16},4:{data:[32],defaults:32},8:{data:[64],defaults:64},12:{data:[96],defaults:96},16:{data:[128],defaults:128},24:{data:[192],defaults:192},32:{data:[256],defaults:256},48:{data:[368],defaults:368}}},o={cpuMem:{1:{data:[1,2,4],defaults:2},2:{data:[4,8],defaults:4},4:{data:[8,16],defaults:8},8:{data:[16,32],defaults:16},12:{data:[24,48],defaults:24},16:{data:[32,48],defaults:32},24:{data:[48,56],defaults:48},32:{data:[64,120],defaults:64}}},r={cpuMem:{1:{data:[8],defaults:8},2:{data:[16],defaults:16},4:{data:[32],defaults:32},8:{data:[64],defaults:64},12:{data:[96],defaults:96},16:{data:[128],defaults:128},24:{data:[192],defaults:192},32:{data:[256],defaults:256},48:{data:[384],defaults:384}}},d={cpuMem:{4:{data:[8,16,32],defaults:8},8:{data:[16,32],defaults:16},16:{data:[32,60],defaults:32},32:{data:[120],defaults:120}}};i.exports={isMemType:function(e){return 0<=e.indexOf("SVLMEM")||0<=e.indexOf("VSLMEM")},isCALType:function(e){return 0<=e.indexOf("VSHCAL")},isSecondDeviceType:function(e){return/.+_2$/.test(e)},isHighIOType:function(){return 0<=type.indexOf("VSHIO")},get:function(e,t,i){var a;this.isSecondDeviceType(e)?a=this.isMemType(e)?r:this.isCALType(e)?d:o:this.isMemType(e)?a=n:(a=s,"100002"!=t&&"100003"!=t&&"200001"!=t&&"200002"!=t||(a.cpuMem[1].data=[1,2,4],a.cpuMem[2].data=[2,4,8,12]),"300001"==t&&(delete a.cpuMem[1],a.cpuMem[2].data=[2,4,8,12,16]),"100002"!=t&&"200001"!=t&&"300001"!=t||(a.cpuMem[8].data=[8,16,24,32],a.cpuMem[12].data=[12,24,28],a.cpuMem[16]={data:[16,32,48],defaults:32},a.cpuMem[24]={data:[56],defaults:56}),"100003"!=t&&"200002"!=t||(a.cpuMem[8].data=[8,16,24,32],a.cpuMem[12].data=[12,24,48],a.cpuMem[16]={data:[16,32,48],defaults:32},a.cpuMem[24]={data:[24,48,56],defaults:56},a.cpuMem[32]={data:[64],defaults:64}),"800001"==t&&(a.cpuMem[1].data=[1,2,4],a.cpuMem[2].data=[2,4,8,12],a.cpuMem[8].data=[8,16,24,32],a.cpuMem[12].data=[12,24,48],a.cpuMem[16]={data:[16,32,48],defaults:32},a.cpuMem[24]={data:[24,48,56],defaults:56},a.cpuMem[32]={data:[64],defaults:64}),"400001"==t&&(a.cpuMem[1].data=[2,4,8],a.cpuMem[2].data=[4,8,12,16],a.cpuMem[8].data=[8,16,24,32],a.cpuMem[12].data=[24,48],a.cpuMem[16]={data:[32,48],defaults:32},a.cpuMem[24]={data:[60],defaults:60}),"900001"==t&&(a.cpuMem={1:{data:[1,2,4],defaults:2},2:{data:[2,4,8,12],defaults:4},4:{data:[4,8,12,16,24],defaults:8},8:{data:[8,16,24,32],defaults:16},12:{data:[12,24,48],defaults:24},16:{data:[16,32,48],defaults:32},24:{data:[24,48,56],defaults:48},32:{data:[64],defaults:64}}),"120001"==t&&(a.cpuMem={1:{data:[1,2,4,8],defaults:2},2:{data:[2,4,8,12],defaults:4},4:{data:[4,8,12,16,24,32],defaults:8},8:{data:[8,16,24,32,64],defaults:16},12:{data:[12,24,36,48],defaults:24}})),i(a)}}}),define("widget/cvmList/upgradeconfig/upgradeconfig",function(e,t,i){var m,c=e("$"),f=e("manager"),a=e("widget/cvmList/operate_base"),v=e("dialog"),o=e("util"),p=e("appUtil"),r=e("tips"),l=e("widget/pills/pills"),d=e("widget/selectedShow/selectedShow"),u=e("widget/cvmList/upgradeconfig/config"),h=e("widget/cvmList/upgrade_common"),g=(e("constants"),e("reporter")),w=e("widget/cvmList/upgradeconfig/cdhupgradeconfig"),b='<div id="upgradeConfigWrap"><ul class="form-list">    <li>        <div class="form-label"><label>原配置</label></div>        <div class="form-input">            <p class="normal-txt">            <span><%-cpu%>核</span>            <span><%-mem%>GB</span>            <% if (isCvmSecondPay) { %>            <span class="cost"><strong data-field="orig-config-cost"></strong>元/小时</span>            <% } %>            </p>        </div>    </li>    <li>        <div class="form-label"><label>目标CPU核数</label></div>        <div class="form-input">        <div id="cpuPillsWrap"></div>        </div>    </li>    <li>        <div class="form-label"><label>目标内存容量</label></div>        <div class="form-input">            <div id="memPillsWrap"></div>        </div>    </li>    <li class="cost-li">        <div class="form-label">        <label data-field="pricetitle">        <% if (isCvmSecondPay) { %>            调整后单价            <% } else { %>            需支付费用            <% } %>        </label>        </div>        <div class="form-input">            <span class="cost"><strong data-field="cost"></strong>元<% if (isCvmSecondPay) { %>/小时<% } %>            </span><span data-discount style="display:none;font-size:1.2em;"> <span data-field="origin-cost" style="text-decoration:line-through; margin:0 5px"></span>元</span><% if (isCvmLadderPrice) { %><div class="tc-15-bubble-icon">                        <i class="tc-icon icon-info-red"></i>                        <div class="tc-15-bubble tc-15-bubble-left">                            <div class="tc-15-bubble-inner">                                <p>按量计费阶梯定价，用得越久越便宜，<a href="https://www.qcloud.com/doc/product/213/%E8%AE%A1%E8%B4%B9%E6%A8%A1%E5%BC%8F%E8%AF%B4%E6%98%8E#2" target="_blank" >查看详情</a>。</p>                            </div>                        </div>                    </div>            <% } %>        </div>    </li>    <li class="deadline-li" style="display:none;">        <div class="form-label"><label>当前有效期至</label></div>        <div class="form-input">            <div class="curDeadline inline-help-text"></div>        </div>    </li>    <li class="deadline-li" style="display:none;">        <div class="form-label"><label>延长有效期至</label></div>        <div class="form-input">            <div class="targetDeadline inline-help-text"></div>            <div class="tc-15-bubble-icon tc-15-triangle-align-end">        <i class="tc-icon icon-info-red"></i>        <div class="tc-15-bubble tc-15-bubble-left" style="width:400px;">            <div class="tc-15-bubble-inner">                <p>该云服务器共有<span class="maxCount" style="color:red;"></span>次降配机会，还有<span class="leftCount" style="color:red;"></span>次</p><p>原始配置为 <span class="oldC"></span>核 <span class="oldM"></span>GB ，目标配置为 <span class="newC"></span>核 <span class="newM"></span>GB</p> <p>降低配置，按照实际支付和官网价格折算，应<span class="realCost"></span>元</p><p class="payback-tag">折算成时间，该服务器的到期时间将从<span class="oldDate"></span>调整到<span class="newDate"></span></p><p class="payoff-tag">由于应补差价小于零，将不会调整您的服务器到期时间</p><p><a href="http://www.qcloud.com/doc/product/213/%E8%B0%83%E6%95%B4CVM%E7%A1%AC%E4%BB%B6%E9%85%8D%E7%BD%AE" target="_blank">详细了解CVM配置调整</a></p>            </div>        </div>    </div>        </div>    </li></ul><div class="tc-15-msg act-outline" id="reduceConfigTip" style="display:none;">    </div><% if (item.vpcId == -1 || isCvmLadderPrice) { %><div class="tc-15-msg" style="margin-bottom:20px"><div style="color:#f00">重要提示：</div><ul><% if ( item.vpcId == -1) { %>        <li>调整配置后, 该服务器的内网IP可能发生变化。</li>        <% } %>        <% if ( isCvmLadderPrice) { %>        <li>调整配置后，按量计费价格将从第一阶梯开始计费，请谨慎调整，        <a href="https://www.qcloud.com/doc/product/213/%E8%AE%A1%E8%B4%B9%E6%A8%A1%E5%BC%8F%E8%AF%B4%E6%98%8E#2" target="_blank" >查看详情</a>。</li><% } %>    </ul></div><% } %></div>',I='<div><p><span style="color:red">广州一区已售罄，不支持控制台调整配置。</span></p><p>推荐使用云计算能力更强的广州二区、全新万兆的广州三区。</p><p>如您需要配置调整，可通过<a href="https://console.qcloud.com/workorder">工单系统</a>（需求->云服务器->广州一区配置调整）联系我们。</p></div>',s=function(e){a.call(this,e)};(s.prototype=new a).exec=function(){var a=this,s=this.hasPermItems[0];if(100001!=s.zoneId)if(s.uHostId){var t=new w({selectedItem:s});v.create(t.$el,"600","",{title:"升级配置","class":"dialog_layer_v2 tc-15-rich-dialog new-gateway",preventResubmit:!0,button:{"确定":function(e){t.doAction(v,function(){})}}})}else{var n=!1;f.queryWhiteList({whiteKey:["CVM_LADDER_PRICE"]},function(e){n=!(!e.CVM_LADDER_PRICE||!e.CVM_LADDER_PRICE.length),function i(t){if(m={},a.selectedItemIsExpire())return r.error("服务器已过期，请续费");var e=o.tmpl(b,{cpu:s.cpu,mem:s.mem,item:s,isVpc:a.hasFeature("VPC"),isCvmSecondPay:a.isCvmSecondPay(),isCvmLadderPrice:t});v.create(e,"650","",{title:"调整配置",preventResubmit:!0,button:{"确定":function(){if(-1==s.vpcId||t){var e="";-1==s.vpcId&&t?e='调整配置后，该服务器的内网IP会产生变化，并且按量计费价格将从第一阶梯开始计费，请谨慎调整，<a href="https://www.qcloud.com/doc/product/213/%E8%AE%A1%E8%B4%B9%E6%A8%A1%E5%BC%8F%E8%AF%B4%E6%98%8E#2" target="_blank" >查看详情</a>。':-1==s.vpcId?e="调整配置后, 该服务器的内网IP会产生变化。":t&&(e='调整配置后，按量计费价格将从第一阶梯开始计费，请谨慎调整，<a href="https://www.qcloud.com/doc/product/213/%E8%AE%A1%E8%B4%B9%E6%A8%A1%E5%BC%8F%E8%AF%B4%E6%98%8E#2" target="_blank" >查看详情</a>。'),v.create(e,"525","",{title:"温馨提示",preventResubmit:!0,button:{"确定":function(){a.toUpgrade()}}})}else a.toUpgrade()}}}),d.render(a.selectedShowOptions),a.wrapper=c("#upgradeConfigWrap"),a.upgradeCommon=new h(a),a._type=s.deviceClass,a._zone=s.zoneId,u.get(a._type,a._zone,function(e){m=e,a.initComponent()})}(n=!(!a.isCvmSecondPay()||!n))})}else v.create(I,"600","",{title:"调整配置",button:{"确定":function(e){v.hide()}}})},s.prototype.initComponent=function(){var r=this,d=this.hasPermItems[0],e=[];for(var t in m.cpuMem){if(t<d.cpu)for(var i in m.cpuMem[t].data){m.cpuMem[t].data[i]>d.mem&&delete m.cpuMem[t].data[i]}if(t>d.cpu)for(var i in m.cpuMem[t].data){m.cpuMem[t].data[i]<d.mem&&delete m.cpuMem[t].data[i]}}for(var a in m.cpuMem){var s={name:a+"核",value:a,active:a==d.cpu};e.push(s)}var n=function(e){var t=c("#memPillsWrap"),i=m.cpuMem[e].data,a=m.cpuMem[e].defaults,s=[],n=0;if(-1<i.indexOf(d.mem))n=d.mem;else if(-1<i.indexOf(a))n=a;else{var o=i.filter(function(e){return e});n=o[o.length-1]}i.forEach(function(e){var t={name:e+"GB",value:e,active:n==e};"windows"===d.osType.toLowerCase()&&d.osName&&-1<d.osName.toLowerCase().indexOf("2016")&&1==e&&1<d.mem&&(t.disabled=!0,t.tips="使用Windows 2016系统的云服务器最低内存限制为2GB"),s.push(t)}),t.html(""),r.memPills=new l({renderTo:t,data:s,newMode:!0,change:function(){r.setPrice(),r.displayEniQuotaTip()}}),r.displayEniQuotaTip()};this.cpuPills=new l({renderTo:c("#cpuPillsWrap"),data:e,newMode:!0,change:function(){var e=this.val();n(e),r.setPrice()}}),n(d.cpu),r.setPrice(!0)},s.prototype.collectData=function(){var e=this.hasPermItems[0],t=this.cpuPills.val(),i=this.memPills.val();return[{goodsCategoryId:100021,appId:p.getAppId(),projectId:e.projectId,regionId:p.getRegionId(),zoneId:e.zoneId,payMode:e.cvmPayMode,goodsNum:1,goodsDetail:{productInfo:[{name:"项目",value:e.projectName},{name:"主机名",value:e.uInstanceId},{name:"内网IP",value:e.deviceLanIp},{name:"所属网络",value:e.netName},{name:"可用区",value:e.zoneName},{name:"CPU",value:e.cpu+"=>"+t},{name:"内存",value:e.mem+"=>"+i}],newConfig:{cpu:parseInt(t),mem:parseInt(i),compute:{cpu:parseInt(t),mem:parseInt(i)},modifyMode:"compute"},curDeadline:e.deadline,resourceId:e.uInstanceId}}]},s.prototype.isReduceConfig=function(){var e=this.hasPermItems[0],t=this.cpuPills.val(),i=this.memPills.val();return t<=e.cpu&&i<e.mem||t<e.cpu&&i<=e.mem},s.prototype.QueryInstanceEniLimit=function(e){var t=c.Deferred();return f.getInstanceEniLimit(e,function(e){e=e&&e.data||{},t.resolve(e)},t.reject),t},s.prototype.QueryInstanceEniNum=function(e){var t=c.Deferred();return f.getInstanceEniNum(e,function(e){e=e&&e.data||{},t.resolve(e)},t.reject),t},s.prototype.checkEniQuota=function(){var o=c.Deferred(),e=this.hasPermItems[0],t=this.cpuPills.val(),i=this.memPills.val(),r=!1,d=!1,l=!1;return this.isReduceConfig()?(r=!0,c.when(this.QueryInstanceEniLimit({regionId:p.getRegionId(),instanceId:e.uInstanceId,cpu:t,mem:i}),this.QueryInstanceEniNum({instanceId:e.uInstanceId,hideSecondary:0})).done(function(e,t){var i=e.eniLimit,a=e.eniIpLimit,s=(t=t.data).length||0,n=0;t.forEach(function(e){n=Math.max(n,e.privateIpAddressesSet&&e.privateIpAddressesSet.length||0)}),i<s&&(d=!0),a<n&&(l=!0),o.resolve({isReduceConfig:r,eniOverLimit:d,ipOverLimit:l,eniLimit:i,eniIpLimit:a})}).fail(function(){o.resolve({isReduceConfig:r,eniOverLimit:d,ipOverLimit:l,eniLimit:0,eniIpLimit:0})})):o.resolve({isReduceConfig:r,eniOverLimit:d,ipOverLimit:l,eniLimit:0,eniIpLimit:0}),o},s.prototype.displayEniQuotaTip=function(){var i=this,e=this.hasPermItems[0],a=p.getRegionId(),s=e.uInstanceId;0<e.vpcId&&this.checkEniQuota().done(function(e){var t="";c("#reduceConfigTip").removeClass("warning").hide(),i.restoreDialogBtn(),e.eniOverLimit||e.ipOverLimit||!e.isReduceConfig?e.eniOverLimit?(t=o.tmpl('<div class="tip-info">注意：降配后,最多支持<%= eniLimit %>个网卡，每个网卡最多支持<%=eniIpLimit %>个IP，当前云主机绑定的网卡已超过配额。<a href="//www.qcloud.com/document/product/215/6513#.E4.BD.BF.E7.94.A8.E7.BA.A6.E6.9D.9F" target="_blank">网卡配额说明 <i class="external-link-icon"></i> </a>请先解绑网卡，再调整配置。<a href="//console.qcloud.com/vpc/eni?instanceId=<%=instanceId%>" target="_blank">查看云主机弹性网卡</a></div>',{regionId:a,instanceId:s,eniLimit:e.eniLimit,eniIpLimit:e.eniIpLimit}),c("#reduceConfigTip").addClass("warning").show(),v.toggleBtnDisable(!0)):e.ipOverLimit&&(t=o.tmpl('<div class="tip-info">注意：降配后,最多支持<%= eniLimit %>个网卡，每个网卡最多支持<%=eniIpLimit %>个IP，当前云主机绑定的网卡已超过配额。<a href="//www.qcloud.com/document/product/215/6513#.E4.BD.BF.E7.94.A8.E7.BA.A6.E6.9D.9F" target="_blank">网卡配额说明 <i class="external-link-icon"></i> </a>请先更换其他网卡或释放IP。<a href="//console.qcloud.com/vpc/eni?instanceId=<%=instanceId%>" target="_blank">查看云主机弹性网卡</a></div>',{regionId:a,instanceId:s,eniLimit:e.eniLimit,eniIpLimit:e.eniIpLimit}),c("#reduceConfigTip").addClass("warning").show(),v.toggleBtnDisable(!0)):(t=o.tmpl('<div class="tip-info">注意：降配后云主机最多支持<%= eniLimit %>个网卡，每个网卡最多支持<%=eniIpLimit %>个IP。<a href="//www.qcloud.com/document/product/215/6513#.E4.BD.BF.E7.94.A8.E7.BA.A6.E6.9D.9F" target="_blank">查看网卡配额说明</a></div>',{eniLimit:e.eniLimit,eniIpLimit:e.eniIpLimit}),c("#reduceConfigTip").show()),c("#reduceConfigTip").html(t)})},s.prototype.setPrice=function(a){var e,s=this,t=this.hasPermItems[0],i=this.cpuPills.val(),n=this.memPills.val();this.isCvmSecondPay()?this.upgradeCommon.getConfigPricePid().then(function(e){if(a){var t=s.getPriceParaForHour(!0);s.upgradeCommon.getPriceForHour(e,t,!0)}else{var i=s.getPriceParaForHour();s.upgradeCommon.getPriceForHour(e,i)}}):(e=i<=t.cpu&&n<=t.mem?i==t.cpu&&n==t.mem?[{goodsCategoryId:21,appId:p.getAppId(),projectId:t.projectId,regionId:p.getRegionId(),zoneId:t.zoneId,payMode:t.cvmPayMode,goodsNum:1,goodsDetail:this.getPricePara()}]:[{goodsCategoryId:79,appId:p.getAppId(),projectId:t.projectId,regionId:p.getRegionId(),zoneId:t.zoneId,payMode:t.cvmPayMode,goodsNum:1,goodsDetail:this.getPricePara(!0,i,n)}]:this.collectData(),f.getPrice({goodsDetail:e},function(e){s.upgradeCommon.setPriceUI(e,{cpu:i,mem:n})}))},s.prototype.notChooseMemPrice=function(){var e=this.wrapper,t=e.find('[data-field="cost"]'),i=e.find("[data-discount]");t.html("0"),e.find('[data-field="pricetitle"]').text("需支付费用"),i.hide()},s.prototype.getPricePara=function(e,t,i){return e?this.upgradeCommon.getPriceParaForReduce(t,i):this.upgradeCommon.getPriceParaForConfig()},s.prototype.getPriceParaForHour=function(e){var t=this.hasPermItems[0],i=this.upgradeCommon.getInputData();return e&&(i.cpu=t.cpu,i.mem=t.mem),i},s.prototype.tipsError=function(e){return this.restoreDialogBtn(),r.error(e)},s.prototype.toUpgrade=function(){var e,a=this,s=this.hasPermItems[0],t=this.upgradeCommon.getInputData(),n=this.getPricePara();if(m.stopSelling&&(e=m.stopSelling[s.zoneId])&&0<=e.indexOf(t.cpu))return this.tipsError("该cpu核数在当前可用区停止售卖, 请重新选择");if(this.isCvmSecondPay()){if(t.cpu==s.cpu&&t.mem==s.mem)return this.tipsError("配置未变更!");Promise.all([this.upgradeCommon.checkSecondModeEnoughPay(),this.upgradeCommon.getConfigPricePid()]).then(function(e){var t=e[0],i=e[1];t?(a.upgradeCommon.setRootPara(n.parts),f.upgradeHourCvm({zoneId:s.zoneId,lanIp:s.deviceLanIp,uuid:s.uuid,pid:i,oldBillId:s.billId,parts:n.parts},function(e){e=e.data||e,v.hide(),a.checkTask(e,"调整配置中")})):a.upgradeCommon.showNotEnoughPay()}),g.click("yunzhuji.btn.upgradeconfig.second")}else{for(var i,o,r,d,l,c=0;l=s.cbsList[c];c++)"root"===l.diskType&&(i=l.target,r=l.diskSize),"data"===l.diskType&&(o=l.target,d=l.diskSize);var p=this.cpuPills.val(),u=this.memPills.val();if(p<=s.cpu&&u<s.mem||p<s.cpu&&u<=s.mem){n={type:"cvm",subType:"cvmBasicConfig",action:"upgradeCvm",zoneId:s.zoneId,curDeadline:s.deadline,returnParts:{cpu:s.cpu,mem:s.mem},uuid:s.uuid,parts:{os:s.osValue,bandwidth:s.bandwidth,cpu:p,mem:u,diskInfo:{root:{target:i,type:s.rootType,size:r||s.rootSize},data:[{target:o,type:s.diskType,size:d||s.diskSize}]}},lanIp:s.deviceLanIp,vpcId:s.vpcId,subnetId:s.subnetId,isVpcGateway:s.isVpcGateway,networkPayMode:s.networkPayMode,productInfo:[{name:"CPU",value:s.cpu+"=>"+p},{name:"内存",value:s.mem+"=>"+u}]};f.payByCartCvm({categoryId:79,goodsDetail:JSON.stringify(n)},function(e){v.hide();try{a.checkTask(e,"调整配置中")}catch(t){console.log(t)}})}else{var h=this.collectData();this.upgradeCommon.toUpgrade(h),g.click("yunzhuji.btn.upgradeconfig.monthyear")}}},i.exports=s}),define("widget/cvmList/upgradedisk/cdhupgradedisk",function(e,t,i){var n=e("$"),a=(e("manager"),e("qccomponent")),s=(e("widget/cvmList/operate_base"),e("dialog")),o=e("widget/cvmList/jsformutil"),r=e("appUtil"),d=(e("tips"),e("widget/range/range")),l=(e("widget/selectedShow/selectedShow"),e("models/cdh")),c=e("constants"),p=(e("reporter"),e("modules/cvm/cdh/cdhconfig")),u=a.extend({$tpl:'    <div>        <div class="tc-15-msg">            磁盘扩容后需要您手动调整文件系统，把新增的部分容量使用起来。        </div>        <div class="form-wrap" style="padding-top: 10px">            <ul class="form-list">                <li>                    <div class="form-label"><label>ID/主机名</label></div>                    <div class="form-input">                        <div class="id-name-cell">                            <p>                                <span class="text-overflow m-width" title="" > {{selectedItem.uInstanceId}} </span>                            </p>                            <div>                                <span class="text-overflow m-width" title="" >{{selectedItem.alias}}</span>                            </div>                        </div>                    </div>                </li>                <li>                    <div class="form-label"><label>数据盘容量</label></div>                    <div class="item-descr-txt">                        <span class="text-overflow m-width" title="" >{{selectedItem.disk}}GB</span>                    </div>                </li>                <li>                    <div class="form-label"><label>目标容量</label></div>                    <div class="form-input">                        <div data-role="cbsRangeWrap" style="width:450px"></div>                    </div>                </li>                <li>                    <div class="form-label">                        <label data-field="pricetitle">                            需支付费用                        </label>                    </div>                    <div class="form-input">                        <span class="cost" ><strong data-field="cost"></strong>0.00元</span><span data-discount style="display:none;font-size:1.2em;"><span data-field="origin-cost" style="text-decoration:line-through; margin:0 5px"></span>元</span>                    </div>                </li>            </ul>        </div>    </div>',$beforeInit:function(){},$afterInit:function(){var i=this,a=n(i.$el).find('[data-role="cbsRangeWrap"]')[0],s=i.selectedItem.disk||0;l.request({name:"getVpsHostList",data:{regionId:r.getRegionId(),uHostIdList:[i.selectedItem.uHostId]},success:function(e){var t=e.hostList[0].diskAvailable+s;i.cbsRange=new d({renderTo:a,value:s,min:s,max:+t,unit:"GB",section:[{value:s,width:2},{value:+t,width:300}],step:1,change:function(e){i.newDiskSize=e}})}})},getUpgradeDiskParam:function(){var e=this.selectedItem,t={modifyMode:"manual",pid:10555,cpu:e.cpu,mem:e.mem,compute:{cpu:e.cpu,mem:e.mem},diskInfo:{root:{target:"xvda",type:+e.rootType,size:+e.rootSize},data:[{target:3==e.diskType?"xbdb":"xvdb",type:e.diskType,size:+this.newDiskSize}]}};return 3==e.diskType?t.ssd=+this.newDiskSize:t.disk=+this.newDiskSize,{goodsCategoryId:"100050",regionId:+r.getRegionId(),projectId:+e.projectId,zoneId:+e.zoneId,payMode:1,goodsNum:1,goodsDetail:{curDeadline:"0000-00-00 00:00:00",resourceId:e.uInstanceId,oldConfig:{pid:10555,cpu:e.cpu,mem:e.mem},newConfig:t,productInfo:[{name:"项目",value:e.projectName},{name:"内网IP",value:e.deviceLanIp},{name:"ID/主机名",value:e.uInstanceId+"、"+e.alias},{name:"地域",value:c.REGIONNAMES[r.getRegionId()]},{name:"可用区",value:e.zoneName},{name:"原硬盘配置",value:e.disk+"G硬盘"},{name:"调整后硬盘配置",value:+this.newDiskSize+"G硬盘"}]}}},doAction:function(){if(this.newDiskSize&&this.newDiskSize!=this.selectedItem.disk){var e=p.NEW_PAY_URL,t=JSON.stringify({raw_goodsData:[this.getUpgradeDiskParam()]});o.jsFormSender(e,{itemDetails:t},"post","_self")}else s.hide()}});i.exports=u}),define("widget/cvmList/upgradedisk/upgradedisk",function(e,t,i){var l=e("$"),o=e("manager"),a=e("widget/cvmList/operate_base"),r=e("dialog"),n=e("qccomponent"),s=e("util"),d=e("appUtil"),c=e("tips"),p=e("widget/range/range"),u=e("widget/selectedShow/selectedShow"),h=e("widget/cvmList/upgrade_common"),m=e("constants"),f=e("reporter"),v=e("widget/cvmList/upgradedisk/cdhupgradedisk"),g=e("modules/cvm/cbs/cbs/data"),w=e("modules/cvm/cbs/cbsutil"),b={},I=m.CBS_DISK_CONFIG,y=m.SSD_CBS_DISK_CONFIG,k=m.PREMIUM_CBS_DISK_CONFIG,x=m.CBS_META_LIST,P='  <div id="upgradeConfigWrap"><ul class="form-list">    <li>        <div class="form-label"><label>当前容量</label></div>        <div class="form-input">            <p class="normal-txt">            <span><%-cbsSize%>GB</span>            </p>        </div>    </li>    <li>        <div class="form-label"><label>目标容量</label></div>        <div class="form-input">        <div id="cbsRangeWrap" style="width:450px"></div>        </div>    </li>    <% if (!isSecondPay) { %>    <li>        <div class="form-label">        <label data-field="pricetitle">        需支付费用            </label>            </div>        <div class="form-input">            <span class="cost" ><strong data-field="cost"></strong>元</span><span data-discount style="display:none;font-size:1.2em;"> </span>        </div>    </li>    <% } %></ul>     </div>',C='<div id="upgradeSelectWrap"><div class="tc-15-msg" style="margin-bottom:20px"><div style="color:#f00">重要提示：</div><ul><li>为了防止数据丢失，磁盘只可扩容不可缩</li>        <li>        <% if(diskType == "5"){ %>        当前磁盘为SSD云盘，<% } %>磁盘扩容后需要您手动调整文件系统，把新增部分容量使用起来</li>    </ul></div><div class="renew-form old-hang">        <div class="tc-15-option-hd">            <h4>请选择磁盘</h4>        </div>        <div class="tc-15-table-panel"><div id="dialog_cbsList"></div>        </div>    </div></div>';var T=function(e){a.call(this,e)};(T.prototype=new a).exec=function(){var e=this,t=this.hasPermItems[0];if(t.uHostId){var i=new v({selectedItem:t});r.create(i.$el,"600","",{title:"磁盘调整","class":"dialog_layer_v2 tc-15-rich-dialog new-gateway",preventResubmit:!0,button:{"确定":function(e){i.doAction(r,function(){})}}})}else{if(this.selectedItemIsExpire())return c.error("服务器已过期，请续费");var a=s.tmpl(C,{diskType:t.diskType});r.create(a,"600","",{title:"调整磁盘",preventResubmit:!0,button:{"下一步":function(){e.goNext()}},buttonDisable:[1,0]}),u.render(this.selectedShowOptions),this.renderSelectGrid()}},T.prototype.renderSelectGrid=function(){var e=this.hasPermItems[0],i=[];l(e.cbsList).each(function(e,t){"data"==t.diskType&&i.push(t)}),this.cbsList=i,this.selectedCbs=null,this.initCbsGridView(),this.renderGrid(this.cbsList,1,5,this.gridView),this.gridView.checkCellWidth()},T.prototype.initCbsGridView=function(){var i,s=this,e=n.getComponent("grid-view");s.gridView=new e({$data:{hasFirst:!1,initGetData:!1,canResizeColum:!1,selectedHighlight:!1,maxHeight:290,minHeight:141,autoMaxHeight:!1,maxHeightOffset:10,count:5,colums:[{key:"radio",name:"",width:"",minWidth:50,required:!0},{key:"cbsInstanceId",name:"ID/云硬盘名",width:"",minWidth:153,tdTpl:'<div><p>{{item.cbsInstanceId}}</p><p><span class="text-overflow m-width">{{item.alias}}</span></p></div>',required:!0},{key:"diskSize",name:"磁盘容量",width:153,required:!0},{key:"volumeType",name:"磁盘类型",width:153,required:!0}],list:[],showState:!1,showPagination:!0},diskTypeFilterOptions:(i=[],x=x||[],l.each(x,function(e,t){i.push({label:t.name,value:t.medium})}),i),getHeadContent:function(e){if("volumeType"===e.key)return'<grid-view-header-filter b-ref="diskTypeFilter" b-with="{filterOptions: diskTypeFilterOptions, col: col, change: filterchange.bind(this.$root)}"></grid-view-header-filter>'},getCellContent:function(e,t,i){return"radio"==i.key?'<div class="tc-15-first-radio"><input type="radio" class="tc-15-radio">'+(s.gridView.sUInstanceId==t.cbsInstanceId?"checked   ":"")+"</div>":"volumeType"===i.key?"<div><p>"+w.getCbsMetaByMedium(t.volumeType).name+"</p></div>":void 0},filterchange:function(i){var a=[];l(s.cbsList).each(function(e,t){-1!=i.indexOf(t.volumeType)&&a.push(t)}),s.renderGrid(a,1,5,s.gridView)},setTrAttr:function(e,t){return{"data-cbsinstanceid":t.cbsInstanceId}},events:{"click tr":function(e){var t=l(e.target);t.closest("tr").find(":radio").prop("disabled")||(l(this.$el).find(":radio").prop("checked",!1),t.closest("tr").find(":radio").prop("checked",!0),r.toggleBtnDisable(!1,0))}},getData:function(e){var t=e.count;e.page;s.renderGrid(s.cbsList,e.page,t,s.gridView)}}),l("#dialog_cbsList").append(s.gridView.$el)},T.prototype.renderGrid=function(e,t,i,a){var s=e;a.setData({list:s,totalNum:e.length,page:t,count:i})},T.prototype.goNext=function(){var e=this,t=(this.hasPermItems[0],l(e.gridView.$el).find(":radio:checked"));if(t.length){this.upgradeCommon=new h(this),this.gridView.sUInstanceId=t.closest("tr").data("cbsinstanceid"),this.selectedCbs=this.getSelectedCbs();var i=s.tmpl(P,{isSecondPay:this.isCbsSecondPay(),cbsSize:this.selectedCbs.diskSize});r.create(i,"600","",{title:"调整磁盘",preventResubmit:!0,button:{"确定":function(){e.toUpgrade()}}}),this.wrapper=l("#upgradeConfigWrap"),function a(){var t=l.Deferred();return l.isEmptyObject(b)?o.queryWhiteList({whiteKey:["cbs_16TB"]},function(e){b=e,t.resolve(b)},function(){t.resolve()}):t.resolve(b),t.promise()}().done(function(){e.initComponent()})}else c.error("请选择磁盘")},T.prototype.initComponent=function(){var e=this,t=this.selectedCbs,i=t.diskSize,a=function r(e,t,i){var a=I[i],s={diskMin:0,diskMax:4e3};return"prepay"==e?"cbs"==t?s=b.cbs_16TB&&b.cbs_16TB.length?{diskMin:a.diskMin,diskMax:a.diskMax}:{diskMin:a.diskMin,diskMax:a.disk}:"cbsssd"==t?s=y:"cbsPremium"==t&&(s=k):"cbs"==t?s={diskMin:0,diskMax:4e3}:"cbsssd"==t&&(s=y),s}(t.payMode,t.volumeType,t.zoneId),s=a.diskMax,n=a.diskMin;n=s<(n=i+10<n?n:i+10)?s:n;var o=function d(e){var t=[];return 250==e?t=[50,100,250]:400==e?t=[100,200,400]:500==e?t=[100,300,500]:800==e?t=[160,480,800]:1e3==e?t=[200,500,1e3]:1200==e?t=[200,500,1200]:1500<=e&&(t=[200,500,1e3,e]),t}(s)||[];o=o.map(function(e,t){return{value:e,width:300/o.length*(t+1)}}),this.cbsRange=new p({renderTo:l("#cbsRangeWrap"),value:i,min:n,max:s,unit:"GB",section:o,step:10,change:function(){e.setPrice()}}),e.setPrice(!0)},T.prototype.collectData=function(){var e=this.hasPermItems[0],t=this.selectedCbs,i=w.getCbsMetaByMedium(t.volumeType),a=this.cbsRange?this.cbsRange.val():0;if(1==t.portable)return[{goodsCategoryId:100060,regionId:d.getRegionId(),zoneId:t.zoneId,projectId:t.projectId,payMode:1,goodsDetail:{zoneId:t.zoneId,productInfo:[{name:"容量",value:t.diskSize+"GB→"+a+"GB"}],resourceId:t.cbsInstanceId,curDeadline:t.deadline,oldConfig:{cbsSize:t.diskSize,pid:i&&i.id,mediumType:"cbs"},newConfig:{cbsSize:a,pid:i&&i.id,mediumType:"cbs"}},goodsNum:"1"}];var s={diskInfo:{data:[{target:"xvde",type:i.type,size:a}]},modifyMode:"disk"};return s[i.priceConfig.data]=parseInt(a),[{goodsCategoryId:100021,appId:d.getAppId(),projectId:e.projectId,zoneId:e.zoneId,regionId:d.getRegionId(),payMode:1,goodsNum:1,goodsDetail:{productInfo:[{name:"项目",value:e.projectName},{name:"主机名",value:e.uInstanceId},{name:"内网IP",value:e.deviceLanIp},{name:"所属网络",value:e.netName},{name:"可用区",value:e.zoneName},{name:"磁盘",value:t.diskSize+"=>"+a}],newConfig:s,curDeadline:e.deadline,resourceId:e.uInstanceId}}]},T.prototype.setPrice=function(e){var t=this,i=this.gridView.sUInstanceId,a=this.selectedCbs,s=(w.getCbsMetaByMedium(a.volumeType),this.cbsRange?this.cbsRange.val():0);if(1==this.selectedCbs.portable)g.querryStoragePrice({inquiryType:"resize",storageId:i,storageSize:s}).done(function(e){e&&r.el.find("[data-field=cost]").text(e.price/100)});else if(this.isCvmSecondPay());else{var n=this.collectData();o.getPrice({goodsDetail:n},function(e){t.upgradeCommon.setPriceUI(e,{})})}},T.prototype.getSelectedCbs=function(){for(var e,t,i=this.hasPermItems[0],a=this.gridView.sUInstanceId,s=0;t=i.cbsList[s];s++)if(t.cbsInstanceId==a){e=t;break}return e},T.prototype.isCbsSecondPay=function(){return"postpay"==this.selectedCbs.payMode},T.prototype.getPricePara=function(){var e=this.gridView.sUInstanceId;return this.upgradeCommon.getPriceParaForConfig(e)},T.prototype.getPriceParaForHour=function(e){this.hasPermItems[0];var t=this.upgradeCommon.getInputData();return e&&(t.cbsSize=this.selectedCbs.diskSize),t},T.prototype.tipsError=function(e){return this.restoreDialogBtn(),c.error(e)},T.prototype.toUpgrade=function(){var a=this,s=this.hasPermItems[0],e=this.selectedCbs,t=this.cbsRange?this.cbsRange.val():0;if(this.isCbsSecondPay()){var n=this.getPricePara();if(t==e.diskSize)return this.tipsError("配置未变更!");Promise.all([this.upgradeCommon.checkSecondModeEnoughPay(),this.upgradeCommon.getConfigPricePid()]).then(function(e){var t=e[0],i=e[1];t?(a.upgradeCommon.setRootPara(n.parts),o.upgradeHourCvm({zoneId:s.zoneId,lanIp:s.deviceLanIp,uuid:s.uuid,pid:i,oldBillId:s.billId,parts:n.parts},function(e){e=e.data||e,r.hide(),a.checkTask(e,"调整磁盘中")})):a.upgradeCommon.showNotEnoughPay()}),f.click("yunzhuji.btn.upgradedisk.second")}else{var i=this.collectData();this.upgradeCommon.toUpgrade(i),f.click("yunzhuji.btn.upgradedisk.monthyear")}},i.exports=T}),define("widget/cvmList/xentokvm/xentokvm",function(e,t,i){var a=e("$"),s=(e("manager"),e("dialog")),n='    <style type="text/css">    .swapnotes li{padding:4px 0; list-style-type:disc; margin-left: 20px}    .dialog-confirm-ck{position: absolute; left: 20px; top:20px; font-size: 14px}    </style><div class="tip_box">        <ul class="swapnotes">            <li>该服务器架构老旧，已不支持自动置换，请退还后重新购买。</li>            <li style="color:#f00">退还前请务必备份好重要数据。</li>            <li>如有疑问，请填写<a data-event="nav" href="/workorder">工单反馈</a></li>        </ul>    </div>',o={render:function(e){this.operIns=e,s.create(n,"640","",{title:"置换新服务器注意事项",preventResubmit:!0,button:{"确定":function(){s.hide()}}}),a("#confirmEnter").change(function(){var e=a(this).prop("checked");s.toggleBtnDisable(!e)})}};i.exports=o}),define("widget/getOsName/getOsName",function(e,t){var i=e("models/iaas"),a=e("appUtil"),s={},n=i.apiRequest({serviceType:"image",cmd:"GetOs",data:{whiteSwitch:0},regionId:a.getRegionId()},{camTips:!1}).then(function(e){return e.data.os.forEach(function(e){s[e.name]=e.desc}),e});t.getOsName=function(e){return s[e]||e},t.promise=n}),define("widget/grid/qcGrid",function(e,t,i){var r=e("widget/editInPlace/editInPlace"),d=e("widget/baseInfo/validator"),s=e("qccomponent"),a=(e("pageManager"),s.getComponent("grid-view")),l=e("$"),n=a.extend({editTpl:'    <form action="javascript:;" b-on-submit="hide(true)" style="width: 250px;">        <div class="form-unit">            <input type="text" b-model="name" data-validate="name" maxlength="25"                   class="tc-15-input-text s" style="float: none; width: 180px;">            <p class="form-input-help">还能输入{{25 - name.length}}个字符，英文、汉字、数字、连接线"-"或下划线"_"</p>        </div>    </form>',delTipsTitle:"确认要删除?",delTipsContent:"",update:function(e,t,i){return Promise.resolve()},checkAuth:function(e,t){return!e.$disable},del:function(e){return Promise.resolve()},change:function(a,s,n){var o=this.$root;return function(e){if(o.checkAuth(a,s)){var t=l(e.target).closest("tr").attr("data-index"),i=new r({$data:{trigger:"",hideDestroy:!0,name:n,content:o.editTpl},$afterDestroy:function(){o.updateItem(t,{$selected:!1})},attachEl:"auto"==o.minHeight?o.$el:null,handler:e.target,onConfirm:function(){var e=new d({errClass:"is-error"}),t=l(this.$el).find("[data-confirm]");if(e.validate(l(this.$el).find("input")[0],{noTips:!0})){if(this.name===n||t.hasClass("disabled"))return;return t.addClass("disabled"),o.update(a,s,this.name).then(function(e){return t.removeClass("disabled"),e},function(e){throw t.removeClass("disabled"),e})}return!1}});i.show(),l(i.$el).find("input").select(),o.updateItem(t,{$selected:!0})}}},checkDel:function(t,i){i=i||{};var a=this.$root;return function(e){a.checkAuth(t,i.action||"del")&&new(s.getComponent("popup-confirm"))({$data:l.extend({trigger:"",title:a.delTipsTitle,content:a.delTipsContent,style:"width: 330px;",hideDestroy:!0},i),handler:e.target,attachEl:"auto"==a.minHeight?a.$el:null,onConfirm:i.onConfirm||function(){a.del(t).then(function(){a.refresh()})}}).show()}}});i.exports=n}),define("widget/intro/intro",function(e,t,i){var o=e("$"),a=e("manager"),s=e("qccomponent"),n={platform:1,dfw:2,sslvpn:4},r=s.extend({$tpl:'    <div>        <div style="position: absolute;z-index: 99999999" b-style="rect" b-on-click="next()"></div>    <div class="mod-guide">        <div class="mod-guide-backdrop" b-on-click="next()">            <table class="backdrop-tb">                <tbody>                <tr>                    <td colspan="3" data-event="guide_next_step">                    </td>                </tr>                </tbody>            </table>        </div>        <div b-style="{top: rect.top + rect.height + offset.top, left: rect.left + rect.width / 2 + offset.left}" class="mod-guide-main mode-dialog">            <div class="mode-dialog-inner">                <div class="mod-dialog-hd">                    <a title="关闭" class="btn-dismiss" href="javascript:;" b-on-click="close()">关闭</a>                </div>                <div class="mod-dialog-bd">                    <div class="tips-content tips-1"                         b-style="{display: curStep == $index ? \'block\' : \'none\'}"                         b-repeat="step in steps">                        <div class="hd-text">{{step.title}}</div>                        <div class="p-text">{{step.content}}</div>                    </div>                </div>                <div class="mod-dialog-ft">                    <div class="mod-dialog-ft-left">                        <ol class="mod-dots">                            <li b-repeat="step in steps">                                <a role="button" class="btn-dot {{curStep == $index ? \'btn-dot-sel\' : \'\'}}"                                   b-on-click="$root.step($index)" href="javascript:;">{{$index + 1}}</a>                            </li>                        </ol>                    </div>                    <div class="mod-dialog-ft-right">                        <a role="button" class="tc-btn blue mid next-tips" href="javascript:;" b-on-click="next()">                            {{curStep < steps.length - 1 ? \'下一步\' : \'开始体验\'}}                        </a>                    </div>                </div>            </div>        </div>    </div>    </div>',start:function(){this.needShow(function(e){e&&(this.step(0),document.body.appendChild(this.$el),this.seen())})},close:function(){this.$target.css(this._originStyle),this.$destroy()},next:function(){var e=1*this.curStep+1;e>=this.steps.length?this.close():this.step(e)},prev:function(){this.step(this.curStep-1)},step:function(e){try{e=Math.max(0,Math.min(this.steps.length-1,e));var t=this.steps[e].target,i=o("function"==typeof t?t():t);this.$target&&this._originStyle&&this.$target.css(this._originStyle),this._originStyle={position:i.css("position"),zIndex:i.css("z-index")};var a={zIndex:"99999"};"relative"!==this._originStyle.position&&"absolute"!==this._originStyle.position&&(a.position="relative"),i.css(a);var s=i.offset();this.$set({curStep:e,rect:{left:s.left,height:i.outerHeight(),top:s.top,width:i.outerWidth()}}),this.$target=i}catch(n){console.error(n),this.close()}},needShow:function(t){var i=this;a.getUserIsSeeGuidelines(function(e){i._isSeeGuidlints=e.isSeeGuidlints,t.call(i,!(e.isSeeGuidlints&n[i.type]))})},seen:function(){a.setUserIsSeeGuidelines(this._isSeeGuidlints|n[this.type])}},{defaults:{curStep:0,offset:{left:-56,top:18}},types:n});i.exports=r}),define("widget/location/location",function(e,t,i){var s=e("$"),n=e("util"),a=(e("appUtil"),e("models/developer")),o=e("dataManager"),r=function(e){if(this.options=s.extend({},{renderTo:null,area:null,change:null,actived:null,names:null,cb:null,provTpl:'<select name="<%=names[0]%>" class="<%=selectClass%>" id="locationProv"><%for(var key in data){%><%if (!excludeProvId || key != excludeProvId) {%><option value="<%=key%>" data-name="<%=data[key].name%>" <%if(actived[0] == key){%> selected <%}%> ><%=data[key].name%></option><%}%><%}%></select>&nbsp;<select name="<%=names[1]%>" class="<%=selectClass%>" id="locationCity"></select><%if(isArea){%><select name="<%=names[2]%>" class="<%=selectClass%>" id="locationArea" style="display:none"></select><%}%>',cityTpl:'<%for(var key in citys){%><option value="<%=key%>" data-name="<%=citys[key].name%>" <%if(actived[1] == key){%> selected <%}%> ><%=citys[key].name%></option><%}%>',areaTpl:'<%for(var key in areas){%><option value="<%=key%>" data-name="<%=areas[key].name%>" <%if(actived[2] == key){%> selected <%}%> ><%=areas[key].name%></option><%}%>'},e),this.options.renderTo)return this.options.actived||(this.options.actived=[0,0,0]),this.options.names||(this.options.names=["","",""]),this.$renderTo=this.options.renderTo,this.init(),this.bindEvent(),this};r.prototype={init:function(){var t=this;o.get("widget_locationMap")?t.rednerInit(o.get("widget_locationMap")):a.request({name:"getLocationMap",cacheKey:"widget_locationMap",success:function(e){t.rednerInit(e)},fail:function(e){}})},rednerInit:function(e){this.map=e,this.renderProv(),this.renderCity(this.options.actived[0]),this.options.area&&this.renderArea(this.options.actived[0],this.options.actived[1]),this.options.cb&&this.options.cb()},bindEvent:function(){var t=this;this.$renderTo.on("change",this.options.renderTo,function(e){"locationProv"===e.target.id&&(t.renderCity(e.target.value),t.renderArea(s("#locationProv").val(),s("#locationCity").val())),"locationCity"===e.target.id&&t.renderArea(s("#locationProv").val(),s("#locationCity").val()),t.options.change&&t.options.change(e)})},renderProv:function(){var e=n.tmpl(this.options.provTpl,{data:this.map,isArea:this.options.area,actived:this.options.actived,names:this.options.names,excludeProvId:this.options.excludeProvId,selectClass:this.options.selectClass||"ui_form_select"});this.$renderTo.append(e),this.renderCity()},renderCity:function(e){var t=e||0,i=s("#locationCity");if(this.map[t].sub){var a=n.tmpl(this.options.cityTpl,{citys:this.map[t].sub,actived:this.options.actived,names:this.options.names});i.html(a).show()}else i.hide().html("")},renderArea:function(e,t){var i=s("#locationArea");if(0!=this.map[e].type&&0!=e&&0!=t&&this.map[e].sub){var a=n.tmpl(this.options.areaTpl,{areas:this.map[e].sub[t].sub,actived:this.options.actived,names:this.options.names});i.html(a).show()}else i.hide().html("")},get:function(){var e={};return e.prov={name:s("#locationProv").attr("data-name"),value:s("#locationProv").val()},e.city={name:s("#locationCity").attr("data-name"),value:s("#locationCity").val()},this.options.area&&(e.area={name:s("#locationArea").attr("data-name"),value:s("#locationArea").val()}),e}},i.exports=r}),define("widget/monitorchart/monitorchart",function(e,t,i){var l,c,p,f,v=e("$"),n=e("manager"),u=e("util"),h=e("appUtil"),m=(e("Highcharts"),e("qccomponent")),g=e("models/api"),w=null,b=null,I={},y=function(){var e=!1;return l&&"cvm"==l.toLowerCase()&&(e=!0),e},k={chart:{zoomType:"x"},title:{text:""},yAxis:{title:{text:""},lineWidth:1,tickPixelInterval:45,min:0,labels:{style:{fontSize:"12px"}}},plotOptions:{line:{marker:{enabled:!0,lineWidth:2,lineColor:"#ff7a22",fillColor:"#FFFFFF",radius:3,states:{hover:{enabled:!0}}},lineWidth:1,color:"#ff7a22"},spline:{marker:{enabled:!1,radius:3,states:{hover:{enabled:!0}}},lineWidth:1,color:"#ff7a22"}},credits:{enabled:!1},legend:{enabled:!1,align:"center",verticalAlign:"bottom",borderWidth:1,padding:12,itemStyle:{fontSize:"12px"}},tooltip:{}},x='<div class="charts-panel">    <qc-date-picker id="monitorDatePicker"></qc-date-picker>    <div class="chart-wrap keyboard-focus-obj" id="monitorScContainer">        <% for (var i=0;i < categories.length-1; i++ ) { %>            <% var category = categories[i]; %>            <div class="chart-grid" id="<%=category.type%>" >                <h3 class="chart-caption" data-multi="<%=category.multi%>"><%=category.name%></h3>                                <% for (var j=0;j<category.charts.length; j++ ) { %>                    <% var chart = category.charts[j]; %>                    <% if (j % 2 == 0) { %>                        <div class="chart-row">                    <% } %>                    <div class="chart-cell" style="visibility:<%=(chart.hidden?"hidden":"")%>" >                        <h4 class="chart-title" data-multi="<%=chart.multi%>"><%=chart.name%></h4>                        <div class="chart-main agent-tip-wrap" >                            <div class="chart-box" style="height:160px; font-size:14px" id="<%=chart.type%>" data-unit="<%=chart.unit%>" data-chart-box="true" alone="<%=chart.alone%>" showed="<%=(chart.hidden?"0":"1")%>"></div>                        </div>                    </div>                    <% if (j % 2 == 0) { %>                        <div class="chart-cell gap-cell"></div>                        <% if (j == category.charts.length - 1) { %>                            </div>                        <% } %>                    <% } else { %>                        </div>                    <% } %>                <% } %>            </div>        <% } %>        <div id="diskShow"></div>    </div></div></div>',o='<div class="guide-layer"><span class="guide-text"><strong class="text-weak">暂无数据</strong><br/><a style="font-size:12px;" href="http://www.qcloud.com/doc/product/248/%E4%BA%91%E7%9B%91%E6%8E%A7%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98"  target="_blank">查看可能导致无数据的原因</a></span></div>',r='            <% if(usageData && usageData.length){ %>            <p class="disk-top-inf"><label>磁盘总容量</label><span><%=sum.toFixed(2)%>GB</span></p>            <table class="mod-graph-list mod">            <tbody>            <% for(var i=0;i<usageData.length;i++){ var total = usageData[i].total; var usage = (usageData[i].usage/100*total).toFixed(2);%>                <tr class="span-row">                    <td class="item-dt"><%=usageData[i].name%></td>                    <td class="item-dd-bar">                        <span class="mod-progress"><span class="mod-bar" style="width:<%=usageData[i].usage%>%;"></span></span>                    </td>                    <td class="item-dd"><div class="cell-box"><%=usage%> GB/<%=total%> GB</div></td>                </tr>            <% } }%>            </tbody>            </table>',P='     <div class="select-disk">        <label>磁盘监控</label>        <select class="tc-15-select m" id="diskIdSelect">        <% if(diskList && diskList.length){ %>        <% for(var i=0;i<diskList.length;i++){ %>            <option value=<%=diskList[i].disk_type%>><%=diskList[i].diskInfo%></option>        <% } }else{%>           <option value="-1">没有相应的磁盘信息</option>        <% } %>        </select>     </div>',d='      <div class="disk-box-wrap">            <h4>磁盘分区使用情况</h4>            <div class="disk-box">            <div id="usageData" style="font-size:14px;position:relative;min-height:30px;"></div>            </div>     </div>         <div id="diskList"></div>         <div class="chart-grid" id="<%=disk.type%>" >                <% for (var j=0;j<disk.charts.length; j++ ) { %>                    <% var chart = disk.charts[j]; %>                    <% if (j % 2 == 0) { %>                        <div class="chart-row">                    <% } %>                    <div class="chart-cell" style="visibility:<%=(chart.hidden?"hidden":"")%>" >                        <h4 class="chart-title" data-multi="<%=chart.multi%>"><%=chart.name%></h4>                        <div class="chart-main agent-tip-wrap" >                            <div class="chart-box" style="height:160px; font-size:14px" id="<%=chart.type%>" data-unit="<%=chart.unit%>" data-chart-box="true" alone="<%=chart.alone%>" showed="<%=(chart.hidden?"0":"1")%>"></div>                        </div>                    </div>                    <% if (j % 2 == 0) { %>                        <div class="chart-cell gap-cell"></div>                        <% if (j == disk.charts.length - 1) { %>                            </div>                        <% } %>                    <% } else { %>                        </div>                    <% } %>                <% } %>            </div>             </div>',C=[],T=function(){if(!y()||v("#diskIdSelect option").length){for(var e,t=document.body.scrollTop||document.documentElement.scrollTop,i=(document.body.scrollLeft||document.documentElement.scrollLeft,t+document.documentElement.clientHeight),a=(document.documentElement.clientWidth,C.length),s=!1,n=[],o="",r=0;r<a;r++)if(null!=C[r]&&(e=document.getElementById(C[r]))){var d=v(e).offset(),l=v(e).attr("showed"),c=d.top,p=d.left,u=c+e.clientHeight;e.clientWidth;if(c<i&&t<c&&1==l||t<u&&u<i&&1==l){if(f.selected){v(f.$el);var h=f.selected.to;o="1h"==f.selected.from?"1h":{from:f.selected.from,to:h}}v("#"+C[r])&&v("#"+C[r]).attr("alone")?A([C[r]],o):n.push(C[r]),s=!(C[r]=null)}}if(y()?S(n,o):A(n,o),s){var m=[];for(r=0;r<a;r++)C[r]&&m.push(C[r]);C=m}}else setTimeout(T,100)},S=function(a,e){var t,i;if(f.selected){v(f.$el);var s=f.selected.to;"1h"==f.selected.from?(i=h.formatDate(new Date,"yyyy-MM-dd hh:mm:ss"),t=B(i)):(t=f.selected.from+" 00:00:00",i=s+" 23:59:59")}var n,o=(R(i)-R(t))/1e3;n=o<86400?3600==o?60:300:o<604800?3600:86400;for(var r=v("#diskIdSelect option:selected").val(),d=0;d<a.length;d++)-1==a[d].indexOf("disk")?A([a[d]],e):v.when(M([a[d]],r,t,i,n)).done(function(t){v.each(t,function(){var e={};e.chartData={points:t.dataPoints,metric:t.metricName,start:t.startTime,series:!1,period:t.period/60},e.chartInfo=t.metricName,E(e.chartInfo,e.chartData)})}).fail(function(){if(a.length)for(var e=a.length,t=0;t<e;t++){var i=a[t].split("__");3==i.length&&C.push(i[0]+"__"+i[1])}})},D=function(e,t){return e=parseFloat(e),isNaN(e)&&(e=null),I[t]&&(e=I[t].call(null,e)),e},E=function(e,t){var i=document.getElementById(e);if(i)if(t.points){var a=function(a,s){var i,n=!0,o=[],r=[];if(s.series){v.each(s.points,function(i,e){v.each(e,function(e,t){s.points[i][e]=D(t,a),undefined!=s.points[i][e]&&(n=!1)})});var d=0,l="";"disk_usage"==s.metric&&(l="分区"),v.each(s.points,function(e,t){r.push({index:d,name:e,cName:l+e}),i=_(s,!0,e),o.push({name:e,type:"spline",data:i.points,pointStart:i.start,pointInterval:i.period,zIndex:1,visible:0==d}),d+=1})}else v.each(s.points,function(e,t){s.points[e]=D(t,a),undefined!=s.points[e]&&(n=!1)}),i=_(s,!0),o.push({name:"base",type:"spline",data:i.points,pointStart:i.start,pointInterval:i.period,zIndex:1});return{bEmpty:n,series:o,seriesNames:r,graph:i}}(e,t);if(a.bEmpty)return void L(e);var s=a.series,n=a.graph,o=v(i),r=n.period<864e5,d=n.end-n.start<36e5;r?o.highcharts(v.extend(!0,{},k,{xAxis:{type:"datetime",dateTimeLabelFormats:{hour:"%H:%M",day:"%m-%d"},minTickInterval:d?1:12,tickPixelInterval:50,title:{text:""}},yAxis:{labels:{format:"{value}"+v(i).attr("data-unit")}},tooltip:{xDateFormat:"%Y-%m-%d %H:%M",formatter:function(){var e=new Date(this.x);return e=new Date(e.getTime()+6e4*e.getTimezoneOffset()),[h.formatDate(e,"MM-dd hh:mm"),": ","<b>",this.y,v(i).attr("data-unit"),"</b>"].join("")}},series:s})):v(i).highcharts(v.extend(!0,{},k,{xAxis:{type:"datetime",dateTimeLabelFormats:{day:"%m-%d",week:"%m-%d",month:"%Y-%m"},labels:{},minTickInterval:1,tickPixelInterval:100},yAxis:{labels:{format:"{value}"+v(i).attr("data-unit")}},tooltip:{xDateFormat:"%Y-%m-%d",formatter:function(){var e=new Date(this.x);return e=new Date(e.getTime()+6e4*e.getTimezoneOffset()),[h.formatDate(e,"MM-dd"),": ","<b>",this.y,v(i).attr("data-unit"),"</b>"].join("")}},series:s})),v(i).parent().find(".guide-layer").hide(),function(t,e){var i,a,s;if(a=t.closest(".chart-grid").find(">[data-multi=1]"),i=s=t.closest(".chart-cell").find("[data-multi=1]"),0<a.size()&&(i=a),0==e.length)i.find(".tc-15-select").remove();else if(1<e.length&&0<s.size()){i.find(".tc-15-select").remove();var n=v('<select class="tc-15-select m " style="min-width: 105px;max-width: 280px; margin-left:6px;"></select>');v.each(e,function(e,t){n.append('<option value="'+t.index+'">'+t.cName+"</option>")}),n.on("change",function(){var s=v(this).val(),e=[];0<a.size()?e=t.closest(".chart-grid").find(".chart-box"):e.push(t),v.each(e,function(e,t){var i=v(t),a=[];0<i.size()&&i.highcharts()&&(a=i.highcharts().series),v.each(a,function(e,t){s==e?a[e].show():a[e].hide()})})}),i.append(n)}}(o,a.seriesNames)}else L(e)},L=function(e){v("#"+e).after(o)},_=function(e,t,i){if(!e)return null;var a=60*e.period*1e3,s=(e.series?e.points[i]:e.points)||[];if(t)for(;s.length&&null===s[s.length-1];)s.pop();var n,o=Date.UTC.apply(Date,(n=e.start,/^(\d{4})[-\s\.,\/]*(\d+)[-\s\.,\/]*(\d+)\s*(\d+)\:(\d+):(\d+)$/.test(n)?[RegExp.$1,RegExp.$2-1,RegExp.$3,RegExp.$4,RegExp.$5,RegExp.$6]:null));return{period:a,points:s,start:o,end:o+a*(s.length-1)}},A=function(s,e){0<s.length&&n.loadChartDataV2({chartInfos:s,date:e,area:h.getRegionId(),uuid:b.uuid,vpcId:b.vpcId,ip:b.ip,appId:h.getAppId(),namespace:l},function(e){e.length||v("#"+s).after(o),v.each(e,function(e,t){E(t.chartInfo,t.chartData)})},function(e){for(var t=s.length,i=0;i<t;i++){var a=s[i].split("__");3==a.length&&C.push(a[0]+"__"+a[1])}},w,b)},M=function(e,t,i,a,s){if(0<e.length)for(var n=0,o=e.length;n<o;n++){var r={dimensions:[{},{}],namespace:"qce/cvm"};r.metricName=e[n],r.dimensions[0].name="unInstanceId",r.dimensions[0].value=w,r.dimensions[1].name="disk",r.dimensions[1].value=t,r.startTime=i,r.endTime=a,r.period=s;var d=v.Deferred();return g.req({serviceType:"monitor",cmd:"GetMonitorData",region:h.getRegionId(),data:r},{tipErr:!1}).then(function(e){d.resolve(e)},function(e){d.reject(e)}),d}},B=function(e){return e=new Date(e.replace(/\-/g,"/")).getTime()-36e5,e=new Date(e),h.formatDate(e,"yyyy-MM-dd hh:mm:ss")},R=function(e){var t=/^\s*(\d{4})-(\d\d)-(\d\d)\s*T?\s*((\d\d)\:(\d\d)\:(\d\d))?/.exec(e);return t?new Date(t[1],t[2]-1,t[3],t[5],t[6],t[7]):null},O=function(){var e,t,i=v("#diskIdSelect option:selected").val(),a=["disk_read_traffic","disk_write_traffic","disk_read_iops","disk_write_iops","disk_await","disk_svctm","disk_util"];if(f.selected){v(f.$el);var s=f.selected.to;"1h"==f.selected.from?(t=h.formatDate(new Date,"yyyy-MM-dd hh:mm:ss"),e=B(t)):(e=f.selected.from+" 00:00:00",t=s+" 23:59:59")}var n,o=(R(t)-R(e))/1e3;n=o<86400?3600==o?60:300:o<604800?3600:86400;for(var r=0;r<a.length;r++)v.when(M([a[r]],i,e,t,n)).done(function(a){v.each(a,function(e,t){var i={};i.chartData={points:a.dataPoints,metric:a.metricName,start:a.startTime,series:!1,period:a.period/60},i.chartInfo=a.metricName,E(i.chartInfo,i.chartData)})}).fail(function(){})};i.exports={render:function(e,t,i,a,s,n,o){var r=this;l=t,c=e,a,w=i,b=n||{},I=s||{};var d=u.tmpl(x,{categories:a});c.html(d),p=v(o||"#monitorScContainer"),y()&&r.renderUsageDisk(a),(f=m.mount("monitorDatePicker",{$data:{showCalendar:!0,lang:"zh-cn",tabs:[{label:"近1小时",from:"1h",to:"1h",display:"近1小时"},{label:"今天",from:"%TODAY",to:"%TODAY"},{label:"昨天",from:"%TODAY-1",to:"%TODAY-1"},{label:"近7天",from:"%TODAY-6",to:"%TODAY"},{label:"近14天",from:"%TODAY-14",to:"%TODAY"}],selected:{from:"1h",to:"1h"},range:{min:"%TODAY-30",max:"%TODAY",maxLength:"31"}}})).$on("datepick",function(e){r.triggerLoad()}),v(window).bind("resize",T),p.bind("scroll",T),setTimeout(r.triggerLoad,400)},renderUsageDisk:function(e){for(var s,t,i=0;i<e.length;i++)"disk"==e[i].type&&(t=e[i]);var a=u.tmpl(d,{disk:t});v("#diskShow").html(a),n.loadChartDataV2({chartInfos:["disk_usage"],date:"1h",area:h.getRegionId(),uuid:b.uuid,vpcId:b.vpcId,ip:b.ip,appId:h.getAppId(),namespace:l},function(e){if(e.length){s=e[0].chartData.partition;for(var t=0,i=0;i<s.length;i++)t+=s[i].total;var a=u.tmpl(r,{usageData:s,sum:t});v("#usageData").html(a)}else v("#usageData").html(o)},function(e){v("#usageData").html(o)},w,b),n.getCvmList({count:1,offset:0,regionId:h.getRegionId(),uInstanceIdList:[w]},function(e){var t=[],i=w;if(e.deviceList&&e.deviceList.length){var a=e.deviceList[0],s={};if(a.rootSize&&(s.disk_type="root",s.diskInfo=i+"的系统盘("+a.rootSize+"GB)",t.push(s)),s={},!a.disk||1!=a.rootType&&3!=a.rootType||(s.disk_type="data",s.diskInfo=i+"的数据盘("+a.disk+"GB)",t.push(s)),a.cbsList.length)for(var n=0,o=a.cbsList.length;n<o;n++)if(s={},1==a.cbsList[n].portable){var r=i+"的"+("root"==a.cbsList[n].diskType?"系统盘":"数据盘")+a.cbsList[n].cbsInstanceId+"("+a.cbsList[n].diskSize+"GB)";s.disk_type=a.cbsList[n].cbsInstanceId,s.diskInfo=r,t.push(s)}else"data"==a.cbsList[n].diskType&&(s.disk_type="data",s.diskInfo=i+"的数据盘("+a.cbsList[n].diskSize+"GB)",t.push(s));var d=u.tmpl(P,{diskList:t});v("#diskList").html(d),v("#diskIdSelect").on("change",O)}else;},function(){var e=u.tmpl(P,{diskList:""});v("#diskList").html(e)})},triggerLoad:function(){var e,t=v("[data-chart-box]").html(""),i=t.length;C=[];for(var a=0;a<i;a++)(e=t[a].id)&&C.push(e);0<i&&T()},tryLoadCharts:T,destroy:function(){v(window).unbind("resize",T),p.unbind("scroll",T),C=[],b=w=f=p=c=null,I={}}}}),define("widget/page/DetailPage",function(e,t,i){var a=e("widget/detail/detail"),s=e("pageManager"),n=e("$"),o=e("appUtil"),r=e("router"),d=e("widget/cam/cam");a.tag("cam-tips",d.CamTips);var l=a.extend({notFoundTips:'    <div style="padding: 100px; text-align: center" b-if="notFound">        <div class="tc-15-list-legend" style="border: none">基础网络云主机不支持弹性网卡</div>        <div class="tc-15-list-content">            弹性网卡仅支持私有网络云主机        </div>    </div>',$beforeInit:function(){l.__super__.$beforeInit.call(this),this.content="{{> notFoundTips }}",this._tabs=[]},$afterInit:function(){l.__super__.$afterInit.call(this);var e=this;n(this.$el).on("REFRESHDETAIL",function(){e.refresh()}),this.refresh()},loadData:function(e,t){return Promise.resolve({title:"标题",id:e,query:t,item:{}})},refresh:function(){var t=this;return this.loadData(this.id,this.query).then(function(e){e.item?t.$set({title:e.title,item:e.item}):t.$set({notFound:!0,hideTabs:!0})},function(e){d.isCamRefused(e)&&t.$set("content","<cam-tips>"+e.message+"</cam-tips>"),t.$set({notFound:!0,hideTabs:!0})})},loadTabs:function(e){var t=this,i=this.$refs.tabs,a=this._tabs[e],s=i.list[e].Component;a&&i.list[e].refresh&&(a.$destroy(),a=null,this._tabs[e]=null),a||(s?a=new s({$data:{id:this.id,query:this.query,regionId:o.getRegionId()},getBaseInfo:function(){return t.loadData.apply(t,arguments).then(function(e){return e.item})}}):(a=new Bee,console.error("请传入一个 Component 构造函数")),this._tabs[e]||(this._tabs[e]=a),i.list.$set(e,{content:a.$el})),t.$set("activeIndex",e)},back:function(){1<history.length?history.back():this.backUrl&&r.navigate(this.backUrl)},destroy:function(){this.$destroy()}},{render:function(e,t,i){var a=new this({$data:n.extend({},{id:t,query:i})});return s.appArea.html(a.$el),a}});i.exports=l}),define("widget/page/ListPage",function(e,t,i){var a=e("qccomponent"),s=e("pageManager"),n=e("widget/grid/qcGrid"),o=e("widget/fieldsManager/gridView"),r=(e("models/api"),e("$"));e("./BeeRoute");e("widget/region/regionSelector"),e("widget/projects/projectSelector");var d=a.extend({$beforeInit:function(){this.gridOpts=r.extend({},d.prototype.gridOpts,this.gridOpts),d.__super__.$beforeInit.call(this)},$afterInit:function(){this.grid=this.$refs.grid,d.__super__.$afterInit.call(this),this.$watch("regionId",function(){this.grid.refresh()}),this.$watch("projectId",function(){this.grid.refresh()})},headerTpl:'    <div class="manage-area-title">        <h2>{{title}}</h2>        <project-selector b-if="hasProjectSelector" b-model="projectId" b-ref="projectSelector" need-all="{{isNeedAllProject}}"></project-selector>        <region-selector b-if="hasRegionSelector" b-model="regionId" b-ref="regionSelector"                         get-white-list="{{getRegionWhiteList}}"></region-selector>        <div class="manage-area-title-right">            {{> rightTpl }}        </div>    </div>',panelTpl:'    <div class="tc-15-action-panel">        <button type="button" class="tc-15-btn m {{canAdd ? \'\' : \'disabled\'}}" b-on-click="_add()">            <b class="icon-add"></b>新建        </button>        <button b-on-click="fieldSetting()" class="tc-15-btn weak m setting"></button>        <button b-on-click="refresh()" class="tc-15-btn weak m refresh right-item"></button>        <qc-search b-ref="search" search="{{search.bind(this)}}"                   placeholder="{{searchPlaceHolder}}"></qc-search>    </div>',rightTpl:"",gridOpts:{},getRegionWhiteList:function(){var e=r.Deferred();return e.resolve([]),e.promise()},fieldSetting:function(){this.$refs.grid.showFieldsManager()},search:function(e){this.grid.listFn({page:1,searchKey:e})},refresh:function(){var e=this;this.grid.$refreshing=!0,this.grid.refresh(function(){e.grid.$refreshing=!1})},_add:function(){this.canAdd&&this.add&&this.add()},destroy:function(){this.$destroy()}},{render:function(e,t,i){var a;return 1==arguments.length&&(i=e,e=undefined),e?this[e]&&this[e].render?this.currentPage=this[e].render.apply(this[e],arguments)||this[e]:s.render404():(d.tag("list-grid",n.extend({$mixins:[o((this.gridKey||this.defaults.title)+"_grid_fields")]})),a=new this('    <div>        {{> headerTpl}}        <div class="manage-area-main">            {{> panelTpl }}            <list-grid b-ref="grid" region-id="{{regionId}}" query="{{query}}" b-with="gridOpts"></list-grid>        </div>    </div>',{$data:{query:i}}),this.currentPage=a,s.appArea.html(a.$el)),this.currentPage},destroy:function(){this.currentPage&&(this.currentPage.destroy&&this.currentPage.destroy.apply(this.currentPage,arguments),this.currentPage=null)},defaults:{title:"表格标题",hasRegionSelector:!0,hasProjectSelector:!0,isNeedAllProject:!1,searchPlaceHolder:"请输入搜索关键字"}});i.exports=d}),define("widget/page/mixins/grid/chart",function(e,t,i){var o=e("appUtil");i.exports={onRender:function(){var i=this.$el,a=this.bee,t=function(e){var t=$(e.target).parents();t.length&&!t.is(i.find(".sidebar-panel"))&&$("html").find(e.target).length&&a.$set("chartId","")},s=$(document.body),n=o.bufferFn(function(){s.on("click",t)},100);a.$watch("chartId",function(e){s.off("click",t),e&&(n.destroy(),n())})},onGridChart:function(e,t,i){var a=this,s=a.bee,n=a.grid.list;t=+t||0,s.$set({chartId:e[a.idProperty],chartName:e[a.nameProperty],chartData:e,hasPrev:t<=0,prevChart:t<=0?$.noop:function(){a.onGridChart(n[t-1],t-1)},hasNext:t>=n.length-1,nextChart:t>=n.length-1?$.noop:function(){a.onGridChart(n[t+1],t+1)}})}}}),define("widget/page/mixins/grid/detail",function(e,t,i){i.exports={params:{detailId:{defaults:"",history:!0}},processBeeConfig:function(e){var i=this;$.extend(e.$data,{backList:function(){this.$set({searchKey:"",pendingKeyword:""})},detailUpdate:function(e){var t={};t[i.idProperty]=i.bee.detailId,i.grid.updateRowData(t,e)},getItemProcessor:i.getItemProcessor.bind(i),prepareItemCompleter:i.prepareItemCompleter.bind(i),getItemCompleter:i.getItemCompleter.bind(i)})},onGridDetail:function(e,t,i){var a=this.bee,s=this.grid;a.$set({tab:"info",detailData:e,detailUpdate:function(e){s.updateItem(t,e)},detailId:e[this.idProperty]})}}}),define("widget/popover/popConfirm",function(e,t,i){var o=e("widget/popover/popover"),r=e("$"),d='<div class="tc-bubble">    <div class="tc-bubble-inner">        <div class="txt-edit">            <%- content %>        </div>        <div class="btn-layer">            <button data-confirm class="tc-btn">确定</button>            <button data-cancel class="tc-btn white">取消</button>        </div>    </div></div>';i.exports=function(e,t){var i=(e=e||{}).content||"",a=e.confirm||function(){},s=e.el;"string"!=typeof i&&(e.content=""),t=r.extend({tpl:d},t);var n=new o(e.content,t);i&&!e.content&&n.$el.find(".txt-edit").append(i),n.show(s),n.$el.on("click","[data-confirm]",function(){var e=a.call(n);e&&e.then?e.then(function(){n.hide()}):!1!==e&&n.hide()}).on("click","[data-cancel]",function(){n.hide()})}}),define("widget/popover/popTips",function(e,t,i){var n=e("widget/popover/popover"),o=e("$"),r=e("util"),d='    <div class="tc-15-confirm-popout tc-15-confirm-popout-bottom align-end"  style="position:absolute; top:30px; left:-300px;">        <div class="tc-15-confirm-popout-bd">                <%- content %>        </div>    </div>',l='    <div class="tc-15-msg">        <div>            <h3><%- title %></h3>            <a class="notice-btn-close" style="top:5px" href="javascript:;" title="关闭" data-close>关闭</a>        </div>        <div><%- content %></div>    </div>';i.exports=function(e,t){var i=this;i.opts=o.extend({},{target:null,title:"",content:"",defaultShow:!0,hideCloseIcon:!1,onClose:function(){},onHide:function(){}},e),t=o.extend({tpl:d},t);var a=new n(r.tmpl(l,{title:i.opts.title,content:i.opts.content}),t),s=function(e){e.hide(),e.hidden=!0,i.opts.onHide&&i.opts.onHide.call(e)};return i.opts.defaultShow&&(a.show(i.opts.target),a.hidden=!1),i.opts.persist&&a.$el.attr("data-role",""),i.opts.hideDelay&&setTimeout(function(){!a.hidden&&s(a)},i.opts.hideDelay),i.opts.hideCloseIcon&&a.$el.find("[data-close]").remove(),a.$el.on("click","[data-close]",function(){var e=i.opts.onClose.call(a);e&&e.then?e.then(function(){s(a)}):!1!==e&&s(a)}),a}}),define("widget/region/region2",function(e,t,i){var h=e("$"),m=e("util"),a=e("manager"),f=e("constants"),v=e("appUtil"),s=function(e){var t={renderTo:null,selectedId:v.getRegionId(),change:null},c=this;this.options=h.extend({},t,e),this.activeCls="checked";var p=this.options.renderTo,u=(this.options.selectedId,this.options.whiteList);if(p=h(p))return a.queryRegion(function(e){var t=v.clone(e),i=v.getRegionOrderHackObj(t),a=f.REGIONNAMES,s=[];if(u){for(var n={},o=0;o<u.length;o++)n[u[o]]=!0;for(var r in i)n[r=r.replace("_","")]||delete t[r]}for(var r in i)r=r.replace("_",""),s.push({name:a[r],value:r});var d=m.tmpl('    <div class="tc-15-rich-radio" role="radiogroup">        <% for (var i=0, item; item = data[i]; i++) { %>            <button type="button" data-value="<%- item.value %>" class="tc-15-btn m <% if (i===0) { %> first <% } %> <% if (i===data.length -1) { %> last <% } %> <% if(data[i].value==selected){ %> checked <% } %>" >                <%= item.name %>            </button>        <% } %>    </div>',{data:s,selected:c.options.selectedId}),l=h(d);c.$el=l,p.append(l),c.bindEvent()},undefined,this.options.regionListType),this};s.prototype={bindEvent:function(){var e=this;this.$el.on("click","button:not([checked])",function(){e.select(this),e.change(this)})},select:function(e){var t=this.activeCls,i=this.selectedId;this.$el.find("."+t).removeClass(t),h(e).addClass(t),i=h(e).attr("data-value"),v.setRegionId(i)},change:function(e){var t=this.options.change;t&&t.call(this,h(e))},val:function(e){var t=this.$el;if(e===undefined)return t.find("."+this.activeCls).attr("data-value");var i=t.find('[data-value="'+e+'"]');i.length&&this.select(i)}},i.exports=s}),define("widget/select/Base",function(e,t,i){var a=e("qccomponent"),s=e("appUtil"),n=a.getComponent("qc-select"),o="_loadTask",r=n.extend({$valuekey:"value",_bindProperty:function(t,e){var i=this;s.beeBind(i,i,"selected ? selected."+t+" : "+t,t),e&&i.$watch(t,function(e){i._locateOption(t,e)})},_locateOption:function(e,t){var i,a,s,n,o,r=this,d=r._getLoadState(),l=r.selected,c=r.list;s=e,n=t,c.some(function(e){if(n===e[s])return o=e,!0}),!(i=o)&&c.length&&"resolved"===d&&(i=r.forceSelect?c[0]:{},a=!0),!i||!a&&l&&l[e]===i[e]||r.$set("selected",i)},_setList:function(e){var t=this;e=e||[],t.allOption?e=[s.clone(t.allOption)].concat(e):!e.length&&t.noneOption&&(e=[t.noneOption]),t.$set("list",e)},_getLoadState:function(){var e=this[o];return e?e.state():"notReady"},$afterInit:function(){var t=this,i=t.$valuekey;n.prototype.$afterInit.apply(t,arguments),t.syncFields.forEach(function(e){t._bindProperty(e,e===i)}),t.$watch("["+t.watchFields.join(",")+"]",function(){var e=t[o]=t.getData();e&&e.then(function(e){t._setList(e)},function(){t._setList([])})},!0),t.$watch("list",function(){t._locateOption(i,t[i])})}},{defaults:{watchFields:["regionId"],syncFields:["id"],forceSelect:!0,label:"加载中...",selected:{},list:[],simulateSelect:!0}});i.exports=r}),define("widget/selectedShow/selectedShow",function(e,t,i){var n=e("$"),o=e("util"),a=e("event"),r=e("dialog"),d='<div class="act-outline" id="selectedShowWrap">    <div class="act-summary">您已选<strong><%-allLength%>台<%=insName%></strong>，<% if (noPermItems.length) { %>其中<strong><%-noPermItems.length%>台<%=insName%></strong>将不能执行<%=actionName%>操作，<% } %><a href="javascript:;" data-event="s_show_detail">查看详情<i id="selectedShowIconArr" class="icon-arrow-down"></i></a></div>    <div class="act-details" style="display:none" id="selectedShowDetail">        <table class="act-details-tb">            <tbody>            <% for (var i = 0, item; item = allItems[i]; i++) { %><tr><td><%=i+1%></td><td><span class="entity-name" title="<%=item.name%>" style="width: 10em;"><%=item.name%></span><% if (item.id) { %><span class="entity-name" title="<%=item.id%>" style="width: 7em;"><a data-event="nav" href="/cvm/detail/1/<%=item.id%>"><%=item.id%></a></span><% } %><% if (item.reason) { %><span class="act-result text-danger" title="<%=item.reason%>"><%=item.reason%></span><% } else { %><% if (actionName) { %><span class="act-result">可<%=actionName%></span><% } else { %><span class="act-result">可操作</span><% } %><% } %>                    </td></tr><% } %>            </tbody>        </table>    </div></div>',s={render:function(e){var t=e.hasPermItems||[],i=e.noPermItems||[],a=[];a=a.concat(i).concat(t);var s=o.tmpl(d,{actionName:e.actionName||"",allItems:a,allLength:a.length,hasPermItems:t,noPermItems:i,insName:e.insName||"云主机"});t.length||r.toggleBtnDisable(1),e.renderTo?n(e.renderTo).html(s):r.el.find(".dialog_layer_cont").prepend(s),r.center(),this.bindEvt()},bindEvt:function(){var e=this;a.addCommonEvent("click",{s_show_detail:function(){e._toggleBox()}})},_toggleBox:function(){var e=n("#selectedShowDetail"),t=n("#selectedShowIconArr");e.toggle(),e.is(":visible")?t.removeClass("icon-arrow-down").addClass("icon-arrow-up"):t.removeClass("icon-arrow-up").addClass("icon-arrow-down"),r.center()}};i.exports=s}),define("widget/selectors/EipSelector",function(e,t,i){var a=e("./ListSelector"),n=e("appUtil"),o=e("models/iaas"),r={BANDWIDTH_PREPAID_BY_MONTH:"包月带宽",TRAFFIC_POSTPAID_BY_HOUR:"按流量",BANDWIDTH_POSTPAID_BY_HOUR:"按小时带宽",BANDWIDTH_PACKAGE:"带宽包用户"},s=a.extend({payModeMap:r,getData:function(s){var e=(s=s||{}).count||this.count,t=s.page||this.page,i=$.extend({},{limit:e,offset:e*(t-1),filters:[{name:"address-status",values:["UNBIND"]},{name:"is-arrears",values:["FALSE"]}]});return s.searchKey&&(n.isValidIp(s.searchKey)?i.filters.push({name:"address-ip",values:[s.searchKey]}):i.filters.push({name:"address-name",values:[s.searchKey]})),o.apiRequest({regionId:this.regionId,cmd:"DescribeAddresses",data:i,serviceType:"eip"},{v3:!0,camTipsType:"dialog"}).then(function(e){var t=e.response,i=t.addressSet||[],a=t.totalCount||0;return i.forEach(function(e){e.eipName=e.addressName||"未命名",e.eipId=e.addressId,e.eip=e.addressIp,e._payMode=r[e.payMode]||""}),$.extend({},s,{list:i,totalNum:a})})}},{defaults:{multipleSearch:!1,checkType:"radio",checkKey:"eipId",colums:[{name:"ID/名称",key:"eipId",tdTpl:'<p>{{item.eipId}}</p><p class="text-overflow">{{item.eipName}}</p>',show:!0},{name:"弹性公网IP",key:"eip",show:!0},{name:"计费模式",key:"_payMode",show:!1},{name:"带宽上限",key:"bandwidth",show:!1,tdTpl:"<span>{{item.bandwidth}} Mpbs<span>"}]}});i.exports=s}),define("widget/selectors/NatSelector",function(e,t,i){var a=e("./ListSelector"),n=e("models/api"),s=a.extend({getData:function(i){var e=(i=i||{}).count||this.count,t=i.page||this.page,a=this,s=$.extend({},this.extraParam,{limit:e,offset:e*(t-1)});return i.searchKey&&(/^nat-\w{8}$/.test(i.searchKey)?s.natId=i.searchKey:s.natName=i.searchKey),n.request({regionId:this.regionId,cmd:"DescribeNatGateway",data:s,serviceType:"vpc"}).then(function(e){var t=e.data||[];return $.extend({},i,a.parseData({list:t,totalNum:e.totalCount}))})},parseData:function(e){return e}},{defaults:{multipleSearch:!1,checkType:"radio",checkKey:"natId",colums:[{name:"NAT网关ID/名称",key:"natId",tdTpl:'<p>{{item.natId}}</p><p class="text-overflow">{{item.natName}}</p>'},{name:"绑定弹性IP数",key:"eipCount"}]}});i.exports=s}),define("widget/selectors/SubnetSelectorAlt",function(e,t,i){var a=e("./ListSelector"),n=e("models/iaas"),s=a.extend({getData:function(i){var e=(i=i||{}).count||this.count,t=i.page||this.page,a=this,s=$.extend({},this.extraParam,{limit:e,offset:e*(t-1)});return this.vpcId&&(s.vpcId=this.vpcId),this.zoneIds&&(s.zoneIds=this.zoneIds),i.searchKey&&(/^subnet-\w{8}$/.test(i.searchKey)?s.subnetId=i.searchKey:s.subnetName=i.searchKey),n.apiRequest({regionId:this.regionId,action:"DescribeSubnetEx",data:s,serviceType:"vpc"},{camTips:!1}).then(function(e){var t=e.data||[];return $.extend({},i,a.parseData({list:t,totalNum:e.totalCount}))})},parseData:function(e){return e}},{defaults:{multipleSearch:!1,checkType:"radio",checkKey:"unSubnetId",colums:[{name:"子网ID/名称",key:"unSubnetId",tdTpl:'<p>{{item.unSubnetId}}</p><p class="text-overflow">{{item.subnetName}}</p>'},{name:"CIDR",key:"cidrBlock"}]}});i.exports=s}),define("widget/selectors/snapshotSelector",function(e,t,i){var a=e("qccomponent"),s=(e("models/snapshot"),e("appUtil")),n=e("models/iaas"),o=a.extend({$tpl:'    <span>        <span style="display:none">{{snapshotId}}</span>        <select class="{{className}}" b-attr="attr" b-model="snapshotId">            <option b-repeat="item in list" value="{{item.snapshotId}}" disabled?="item.$disabled" title="{{item.$title || (item.snapshotName + \' - \' + item.snapshotId)}}">{{item.snapshotName}}{{showId ? (\' (\' + item.snapshotId + \' )\') : \'\'}}</option>        </select>    </span>',$valuekey:"snapshotId",$afterInit:function(){o.__super__.$afterInit.call(this),this.$watch("[regionId, projectId]",function(){var e=this.projectId||s.getProjectId(!0),t=this.regionId||s.getRegionId();this.getData({regionId:t,projectId:e})},!0),this.$watch("snapshotId",function(t){t&&this.onSelect(this.list.filter(function(e){return e.snapshotId==t})[0])},!0)},getData:function(e){var a=this;n.apiRequest({serviceType:"cbs",action:"DescribeSnapshots",regionId:e.regionId,data:{Offset:0,Version:"2017-03-12",Limit:this.limit||100,Filters:[{Name:"project-id",Values:[e.projectId]}]}}).then(function(e){var t,i=e.Response.SnapshotSet||[];i=a.filter(i),a.$set("list",i),a.snapshotId||(t=(i.filter(function(e){return!e.$disabled})||[])[0])&&a.$set("snapshotId",t.snapshotId)})},filter:function(e){return e},onSelect:function(e){}},{defaults:{className:"tc-15-select",attr:{}}});i.exports=o}),define("widget/visibility",function(e,t,i){i.exports=function(t,i,e){var a;"function"==typeof i?a=function(e){e?t():i()}:(a=t,e=i);var s=function(){a(!document.visibilityState||"visible"===document.visibilityState)};$(document).on("visibilitychange",s),e&&s();var n=function(){$(document).off("visibilitychange",s)};return n.destroy=n}});