define("modules/cvm2/cvm_grid",function(e,t,i){var c=e("$"),l=e("util"),p=e("appUtil"),a=e("widget/fieldsManager/gridView"),n=e("widget/cvmList/xentokvm/xentokvm"),r=e("reporter"),o=e("widget/cvmList/operate_base"),d=(e("modules/cvm2/event/operate_entry"),e("modules/cvm2/event/operate_auth"),e("modules/cvm2/event/monitor")),u=e("constants"),m={hasFirst:!0,initGetData:!1,canResizeColum:!1,selectedHighlight:!1,firstColWith:"26px",colums:[{key:"idName",name:"ID/主机名",colClassName:"col-svrid",minWidth:94,required:!0},{key:"monitor",name:"监控",width:44,minWidth:44},{key:"statusDesc",name:"状态",width:100,minWidth:100},{key:"zoneName",name:"可用区",width:92,minWidth:92},{key:"deviceTypeName",name:"\t主机类型",width:94,minWidth:94},{key:"cvmConfig",name:"配置",width:116},{key:"ip",name:"主IP地址",width:172},{key:"cvmPayModeDesc",name:"主机计费模式",i18n:!1,width:114},{key:"networkPayModeDesc",name:"网络计费模式",selected:!1,width:125},{key:"projectName",name:"所属项目",selected:!1,width:114},{key:"_operCol",name:"操作",required:!0,width:136}],list:[],canSelectTotal:!1,autoMaxHeight:!1,maxHeightOffset:10,autoCheckWidth:!1,showState:!0,showPagination:!0,totalNum:0,count:50,trackKey:"uuid",searchItemName:"云主机"};t.get=function h(s){return{$data:c.extend({},m,!0),$mixins:[a("cvm2_fields","",6,9)],getData:function(e,t){s.gridView.page=e.page,s.gridView.count=e.count,s.reload()},getCellContent:function(e,t,i){return function d(e,t,i,a){var s,n=a,r=n.gridView.list.indexOf(t);if("idName"==i.key)return l.tmpl('    <div class="id-name-cell">        <p>        <% if (item.uuid && item.uInstanceId) { %>        <a data-event="nav" href="/cvm/detail/<%- regionId %>/<%- item.uInstanceId %>"><%- item.uInstanceId%></a>        <% } %>        <% if (item.newFlag){ %>        <span class="new-mark-icon"></span>        <% } %>        <% if (item.autoRenewFlag == 1) { %><span class="icon-renewal-mark" title="该主机已设置为自动续费"></span><% } %>        </p>        <div><% if (item.canUpgradeToKvm) { %><i class="update-icon"><% if(isLast){%><div class="tc-bubble tc-bubble-bottom" style="left:-17px;top:-47px;visibility:hidden;"><% }else{%><div class="tc-bubble tc-bubble-top" style="top:27px;visibility:hidden;"><% } %><div class="tc-bubble-inner"><p><a href="javascript:;" data-event="upgradeToKvm">置换为新服务器</a>后可用制作镜像等新特性</p></div></div></i>&nbsp;<% } %><span class="text-overflow m-width" title="{{item.alias}}" <% if (item.canUpgradeToKvm || item.autoRenewFlag) { %> style="max-width: 70%;" <% } %> > {{item.alias}} </span><% if (!item.$loading) { %><i class="pencil-icon" data-name="alias"data-event="cvm_oper_action" style="visibility:hidden;"></i><% } %>        </div>            </div>',{item:t,regionId:p.getRegionId(),isLast:r>=n.gridView.list.length-1&&0!=r});if("deviceTypeName"!=i.key)return"ip"==i.key?t.ipConfig?l.tmpl('<div class="ip-cell"><p><%if(deviceWanIp){%><%if(eipInfo){%><span class="text-overflow m-width" title="弹性公网IP: <%= deviceWanIp %>"><%= deviceWanIp %><i class="net-type">(弹性)</i></span><i class="copy-icon" data-clipboard-text="<%=deviceWanIp%>" style="display:none; cursor:pointer;" title="复制弹性公网IP"></i><% } else {%><span class="text-overflow m-width" title="公网IP: <%= deviceWanIp %>"><%= deviceWanIp %><i class="net-type">(公)</i></span><i class="copy-icon" data-clipboard-text="<%=deviceWanIp%>" style="display:none; cursor:pointer;" title="复制公网IP"></i> <% if(eipQuotaData){ %>                <% if(eipQuotaData.currentEipNum < eipQuotaData.eipNumQuota){ %>                <i class="convert-ip-icon" data-event="wipToEip"  style="cursor:pointer;"                 data-title="IP保持不变，转为弹性公网IP，您最多可开通<%=eipQuotaData.eipNumQuota%>个弹性公网IP，已开通<%=eipQuotaData.currentEipNum%>个。"></i>                <% }else{ %>                <i class="convert-ip-ash-icon" data-title="转为弹性公网IP，您的弹性公网IP已达到<%=eipQuotaData.eipNumQuota%>个上限。"></i>                <% } %>            <% } %>            <% } %>\x3c!--eipInfo--\x3e            <% } else {%>\x3c!--deviceWanIp--\x3e            <span class="text-overflow m-width" title="">-</span>            <% }%></p><p><span class="text-overflow m-width" title="内网IP: <%= deviceLanIp %>"><%= deviceLanIp %><% if (deviceLanIp && deviceLanIp!="-") { %><i class="net-type">(内)</i><% } %></span><i class="copy-icon" data-clipboard-text="<%=deviceLanIp%>" style="display:none; cursor:pointer;" title="复制内网IP"></i></p>    </div>',t.ipConfig):"":"cvmPayModeDesc"==i.key?"<div><p>"+t.cvmPayModeDesc+"</p><p>"+t.cvmPayModeTimeDesc+"</p></div>":"monitor"==i.key?l.tmpl('<a   href="javascript:;"  <% if (runflag == 3) { %><% }else{ %>  style="cursor:pointer;"   data-event="renderMonitor"<% }%>       class="icon-monitor always-active">监控</a>',t):"_operCol"!=i.key?"<div>"+(e||"")+"</div>":(s=n.gridView.list.length<r+5&&3<=r+1,l.tmpl('<%if(item.$loading){%><div class="cvm-oper-cell" data-title="正在执行任务"><a href="javascript:;">登录</a><% if (isPrepaidUser && !isSecondPayMode&& !uHostId) { %><a href="javascript:;">续费</a><% } %><div class="tc-15-dropdown"><a href="javascript:;" class="tc-15-dropdown-link" >更多<i class="caret"></i></a></div></div><%}else{%><div class="cvm-oper-cell">        <a href="javascript:;" data-name="vnc" data-event="cvm_oper_action"  data-hot="yunzhuji.web">登录</a>        <% if (isPrepaidUser && !isSecondPayMode&& !uHostId) { %>        <a href="javascript:;" data-name="renew" data-event="cvm_oper_action">续费</a>        <% } %>\x3c!-- 展开下拉菜单添加tc-15-menu-active --\x3e<div  data-name="moreBtn"   class="tc-15-dropdown <%if(isUp){%>tc-15-dropup <%}%>" ><a href="javascript:void(0);" class="tc-15-dropdown-link" data-event="morebtn">更多<i class="caret"></i></a><ul class="tc-15-dropdown-menu"><li class="has-submenu"><a href="javascript:;">云主机状态</a><ul class="tc-15-dropdown-menu" style="display:none"><li data-name="reboot" data-event="cvm_oper_action"><a href="javascript:;">重启</a></li>            <li data-name="boot" data-event="cvm_oper_action"><a href="javascript:;">开机</a></li>            <li data-name="shutdown" data-event="cvm_oper_action"><a href="javascript:;">关机</a></li><% if (!isPrepaidUser) { %>  <li data-event="cvm_oper_action" data-name="returncvm"><a href="javascript:;">退还服务器</a></li>  <% } else { %>  <li data-event="cvm_oper_action" data-name="destroycvm"><a href="javascript:;">销毁</a></li>  <% } %></ul></li><li class="has-submenu"><a href="javascript:;">云主机设置</a><ul class="tc-15-dropdown-menu" style="display:none"><li data-name="alias" data-event="cvm_oper_action"><a href="javascript:;">改名</a></li><% if (isPrepaidUser) { %>            <li data-name="upgradeconfig" data-event="cvm_oper_action"><a href="javascript:;">调整配置</a></li>            <li data-name="upgradedisk" data-event="cvm_oper_action"><a href="javascript:;">调整磁盘</a></li>            <% } %><li data-name="upgradebandwidth" data-event="cvm_oper_action"><a href="javascript:;">调整网络</a></li></ul></li><li class="has-submenu"><a href="javascript:;">密码/密钥</a><ul class="tc-15-dropdown-menu" style="display:none"><li data-name="resetpwd" data-event="cvm_oper_action"><a href="javascript:;">重置密码</a></li>            <li data-name="bindkeypair" data-event="cvm_oper_action"><a href="javascript:;">加载密钥</a></li></ul></li><% if (!notShow_firewall) { %>            <li data-control="firewall" data-name="firewall" data-event="cvm_oper_action"><a href="javascript:;">配置安全组</a></li>            <% } %>             <li class="has-submenu"><a href="javascript:;">弹性网卡</a><ul class="tc-15-dropdown-menu" style="display:none"><li data-name="bindEni" data-event="cvm_oper_action"><a href="javascript:;">绑定弹性网卡</a></li>            <li data-name="unbindEni" data-event="cvm_oper_action"><a href="javascript:;">解绑弹性网卡</a></li></ul></li>             <li data-name="createimg" data-event="cvm_oper_action"><a href="javascript:;">制作镜像</a></li>            <li data-name="resetos" data-event="cvm_oper_action"><a href="javascript:;">重装系统</a></li><% if (!notShow_changeproject) { %>            <li data-control="changeproject" data-name="changeproject" data-event="cvm_oper_action"><a href="javascript:;">分配至项目</a></li>            <% } %>                        <li class="has-submenu"><a href="javascript:;">弹性IP </a><ul class="tc-15-dropdown-menu" style="display:none"><li data-name="bindEip" data-event="cvm_oper_action"><a href="javascript:;">绑定弹性IP</a></li><li data-name="unbindEip" data-event="cvm_oper_action"><a href="javascript:;">解绑弹性IP</a></li></ul></li><li data-name="export" data-event="cvm_oper_action"><a href="javascript:;">导出信息</a></li></ul></div></div><%}%>',{item:t,uHostId:t.uHostId,isBandWidthPackageUser:n.isBandwidthPackageUser,isPrepaidUser:n.isPrepaidUser,notShow_firewall:n.notShow_firewall,notShow_changeproject:n.notShow_changeproject,isSecondPayMode:t.cvmPayMode==u.CVMPAYMODE.SECOND,isUp:s}));if(t.uHostId){var o="/cvm/cdh/detail/"+p.getRegionId()+"/"+t.uHostId+"/1";return l.tmpl('<p><%= deviceTypeDesc%><i class="<%= osIcon%>" data-title="<%= osName %>"></i></p><p><a href="<%=url%>"><%= uHostId %></a></p>',c.extend(!0,{},t,{url:o}))}return l.tmpl('<%= deviceTypeDesc%><i class="<%= osIcon%>" data-title="<%= osName %>"></i>',t)}(e,t,i,s)},getHeadContent:function(e){return"zoneName"===e.key?'<span class="text-overflow" id="zoneIdSelector">可用区</span>':"deviceTypeName"===e.key?'<span class="text-overflow" id="deviceClassSelector">主机类型</span>':"cvmPayModeDesc"===e.key?'<span class="text-overflow" id="payModeSelector">主机计费模式</span>':void 0},setTrAttr:function(e,t){return e={"data-uinstanceid":t.uInstanceId,"data-role":"cvm_row","data-deviceLanIp":t.deviceLanIp,"data-uuid":t.uuid},t.$loading&&(e["data-isLoading"]=!0),e},resetCheckbox:function(e){c("tr[data-uinstanceid] input[type=checkbox]:checked").not(c(e.target).closest("tr").find(":checkbox")).trigger("click"),c(e.target).closest("tr").find(":checkbox").prop("checked")||c(e.target).closest("tr").find(":checkbox").trigger("click")},events:{"click tr[data-uinstanceid] input[type=checkbox]":function(e){var t=s.getSelectItem(c("tr[data-uinstanceid] input[type=checkbox]:checked"));s.checkOperAction(t)},"click tr :checkbox:eq(0)":function(e){if(c(":checkbox:eq(0)").prop("checked"))var t=s.getSelectItem(c("tr[data-uinstanceid] input[type=checkbox]"));else t=[];s.checkOperAction(t)},"click tr[data-uinstanceid]":function(e){var t=c(e.target).closest("tr").find(":checkbox");t&&0<t.length&&!c(e.target).is(":checkbox")&&0<!c(e.target).closest(".cvm-oper-cell").length&&(0<c(e.target).closest("[data-event]").length||t.trigger("click"))},"click tr [data-event=renderMonitor]":function(e){s.gridView.resetCheckbox(e);var t=s.getSelectItem(c(e.target));d.init(t[0],s)},"click tr [data-event=wipToEip]":function(e){c(e.target).closest("tr").find("[data-event=cvm_oper_action][data-name=bindEip]").trigger("click")},"click tr [data-event=upgradeToKvm]":function(e){s.gridView.resetCheckbox(e);var t=c(e.target).closest("tr"),i=parseInt(t.attr("data-index"));s.gridView.$refs.list[i].$set({$selected:!0});var a=new o({listIns:s,selectedItems:[{uuid:t.attr("data-uuid"),el:t}]});return n.render(a),r.click("yunzhuji.cvm_list_xen2kvm"),!1},"click tr [data-event=cvm_oper_action]":function(e){s.gridView.resetCheckbox(e);var t=s.getSelectItem(c(e.target));s.operActionEvent(c(e.target).closest("[data-name][data-event]"),t)}}}}}),define("modules/cvm2/cvmgridfilter",function(e,t,i){var s=e("util"),n=e("$"),a=(e("appUtil"),function(e){this.item=e;var i=this.container=n(s.tmpl('<div id="<%=id%>" data-name="cvmfilter"><span class="tc-15-filtrate-btn"><span class="text-overflow"><%=title%></span><i class="filtrate-icon"></i></span><div class="tc-15-filtrateu" style="display: none;"><ul class="tc-15-filtrate-menu" ><li class="tc-15-optgroup"><a href="javascript:;">全部</a></li><%for(var i=0,item;item = list[i++];){%><li class="tc-15-optgroup" data-val="<%=item.value%>"><a href="javascript:;"><%=item.name%></a></li><%}%></ul></div></div>',e));i.replaceAll(n("#"+e.id));var a={};this.set=function(e){if((i.find("li").removeClass("selected"),i.find(".tc-15-filtrate-btn").removeClass("current"),null!=e&&e!==undefined)&&0<this.container.find("li[data-val="+e+"]").length)return this.container.find("li[data-val="+e+"]").addClass("selected"),void this.container.find(".tc-15-filtrate-btn").addClass("current")};var t=this;this.container.find("li:gt(0)").click(function(e){i.find("li").removeClass("selected"),n(this).addClass("selected"),r(),a.selected&&a.selected.apply(null,[t.getVal()]),e.stopPropagation()}),this.container.find("li:eq(0)").click(function(e){i.find("li").removeClass("selected"),r(),a.selected&&a.selected.apply(null,[null]),e.stopPropagation()}),this.container.click(function(e){var t=i.find(".tc-15-filtrateu").prop("display");n(".manage-area.cvm").find(".tc-15-filtrateu").hide(),r(),t?(i.find(".tc-15-filtrateu").hide(),i.find(".tc-15-filtrate-btn").removeClass("current")):(i.find(".tc-15-filtrateu").show(),i.find(".tc-15-filtrate-btn").addClass("current")),e.stopPropagation()}),this.$on=function(e,t){return a[e]=t,this},this.getVal=function(){var i,a=this.container.find("li.selected");return 0<a.length?(n(this.item.list).each(function(e,t){a.data("val")==t.value&&(i=t)}),i):null}});function r(){n(".manage-area.cvm").find(".tc-15-filtrateu").hide(),0<n(".manage-area.cvm").find(".tc-15-filtrateu").find(".selected").length||n(".manage-area.cvm").find(".tc-15-filtrateu").parent().find(".tc-15-filtrate-btn").removeClass("current")}var o=function(e){0==n(e.target).closest("[data-name=cvmfilter]").length&&r()};function d(e){return new a(e)}return{initFilter:function(e,t){this.initZoneFilter(e,t),this.initDeviceClassFilter(e,t),this.initPayModeFilter(e,t),n(".manage-area.cvm").unbind("click",o).bind("click",o)},initZoneFilter:function(e,t){var i=[];n(e.data.zoneList).each(function(e,t){i.push({name:t.zoneName,value:t.zoneId})}),t.gridView.zoneIdSelector=d({id:"zoneIdSelector",title:"可用区",list:i}).$on("selected",function(e){t.filterhange()})},initDeviceClassFilter:function(e,t){var i=[];n(e.data.deviceClassList).each(function(e,t){i.push({name:t.name,value:t.id,deviceClassList:t.deviceClassList})}),t.gridView.deviceClassSelector=d({id:"deviceClassSelector",title:"主机类型",list:i}).$on("selected",function(e){t.filterhange()})},initPayModeFilter:function(e,t){if(t.isPrepaidUser){var i=[];n(e.data.payModeList.cvm).each(function(e,t){i.push({name:t.desciption,value:t.mode})}),t.gridView.payModeSelector=d({id:"payModeSelector",title:"主机计费模式",list:i}).$on("selected",function(e){t.filterhange()})}else;},initProjectFilter:function(e,t){var i=[];n(e.data.projectList).each(function(e,t){i.push({name:t.name,value:t.projectId})}),t.gridView.projectSelector=d({id:"projectSelector",title:"所属项目",list:i}).$on("selected",function(e){t.filterhange()})},initNetworkPayModeFilter:function(e,t){if(t.isPrepaidUser){var i=[];n(e.data.payModeList.network).each(function(e,t){i.push({name:t.desciption,value:t.mode})}),t.gridView.networkPayModeSelector=d({id:"networkPayModeSelector",title:"网络计费模式",list:i}).$on("selected",function(e){t.filterhange()})}else;},setDafaultFilter:function(e,t,i){if(e.zoneIdList?i.gridView.zoneIdSelector.set(e.zoneIdList[0]):i.gridView.zoneIdSelector.set("-1"),e.deviceClassList&&e.deviceClassList[0]){for(var a=e.deviceClassList[0],s=!1,n=0;n<t.data.cvmTypeList.length;n++)if(a==t.data.cvmTypeList[n].type){i.gridView.deviceClassSelector.set(t.data.cvmTypeList[n].key),s=!0;break}s||i.gridView.deviceClassSelector.set("-1")}else i.gridView.deviceClassSelector.set("-1");i.gridView.payModeSelector&&(e.cvmPayModeList?i.gridView.payModeSelector.set(e.cvmPayModeList[0]):i.gridView.payModeSelector.set("-1"))}}}),define("modules/cvm2/cvmlist",function(e,t,i){var b=e("$"),s=e("pageManager"),a=e("dropdown"),n=e("util"),u=e("appUtil"),r=(e("projectsSelector"),e("regionSelector"),e("widget/copy/copy")),m=e("widget/pills/pills"),o=e("modules/cvm2/event/addcvm"),d=e("modules/cvm2/event/dropdown"),p=e("modules/cvm2/event/operate_entry"),h=e("modules/cvm2/event/operate_auth"),I=e("modules/cvm2/dataformat"),v=e("constants"),f=e("config/regionconfig"),y=e("modules/cvm2/data"),c=(e("modules/cvm2/cvmutil"),e("modules/cvm2/task")),l=(e("modules/cvm2/cvmgridfilter"),e("dialog"),e("modules/cvm2/cvm_grid")),g=e("tips"),w=(e("models/api"),e("search"),e("router")),x=e("reporter"),k=e("qccomponent"),C=e("widget/i18n"),T=e("modules/cvm2/search_box"),D=(e("config/reactSupport"),new(e("lib/TickQueue"))({interval:5e3}));D.start();var P={param:{},title:"实例-控制台",pageClass:"",renderBtnGroup:function(e){var p=this;T.setDefaultData(e),T.init(function(e,t){p.renderList(b.extend({page:1},e)),p.searchData=e}),y.queryRegion().done(function(e){for(var t=[],i=[],a=v.REGIONORDER,s=v.REGIONNAMES,n=[],r={},o=[],d=0,c=a.length;d<c;d++){var l=a[d];e[l]&&(t.push({name:s[l],value:l}),i.push(l))}p.regionId=u.getRegionId(),p.regionPills=new m({renderTo:b("#regionGroup"),data:t,newMode:!0,change:function(e){var t=p.regionPills.val();r[t]?w.navigate("/ovm?region="+r[t].value):(u.setRegionId(t),p.regionId=t,p.gridView.page=1,p.gridView.count=50,p.reload())}}),p.regionPills.val(u.getRegionId()),y.getUserCvmOverview({regionIds:i}).done(function(e){o=e.data,b(e.data).each(function(e,t){p.setRegionNum(t,"overview")})}),y.queryOvmRegion().done(function(e){e.length&&(r=p.getOvmRegionMap(e),p.regionPills.setData(t.concat(p.filterOvmRegionList(e,n))),b(o.concat(n)).each(function(e,t){p.setRegionNum(t,"overview")}))})})},getOvmRegionMap:function(e){for(var t={},i=0;i<e.length;i++){var a=e[i];t[a.region_id]={value:a.value,name:a.name}}return t},filterOvmRegionList:function(e,t){for(var i=[],a=0;a<e.length;a++){var s=e[a];0<s.vm_cnt&&(i.push({name:s.name,value:s.region_id}),t.push({regionId:s.region_id,validCvmNum:s.vm_cnt,name:s.name,isOvm:1,newFlag:0}))}return i},updateUserCvmOverview:function(e){var t=this.regionPills.$el.find("button[data-value="+e.regionId+"]");if(0!=t.data("newFlag")){var i=v.REGIONNAMES[e.regionId];t.html(i+"("+t.data("validNum")+")");var a=[];a.push({regionId:e.regionId,newFlag:0}),y.updateUserCvmOverview({cvmOverviews:a}).done(function(e){})}},setRegionNum:function(e,t){var i=this.regionPills.$el.find("button[data-value="+e.regionId+"]");if("overview"!=t||0!=i.data("validflag")){var a=v.REGIONNAMES,s=e.isOvm?e.name:a[e.regionId];1==e.newFlag?(i.html(s+"("+e.validCvmNum+")<span class='new-dot-mark'></span>"),i.attr("data-title","该地域有新购机器")):(i.html(s+"("+e.validCvmNum+")"),i.removeAttr("data-title")),i.data("validNum",e.validCvmNum),i.data("validflag",1),i.data("newFlag",e.newFlag)}},render:function(e){var a=this;e=e||{},nmc.render(n.tmpl('<div class="manage-area cvm"><div class="manage-area-title"><h2>云主机</h2><div id="projectsWrapper" class="tc-select-box"></div><div class="manage-area-title-right"><a href="//'+QCMAIN_HOST+'/document/product/213/3687" target="_blank" class="guide-link">云服务器使用指南<b class="external-link-icon"></b></a></div><div id="listtips"></div></div><div class="cvm-area-wrap" role="radiogroup"  id="regionGroup" ></div><div class="manage-area-main"><div id="showTip"></div><div class="tc-action-grid"  id="operArea"><div class="justify-grid"><div class="col"><button class="tc-15-btn m btn-add" data-event="add_cvm" data-hot="yunzhuji.new"><b class="icon-add"></b>新建</button><button class="tc-15-btn m disabled" data-event="cvm_oper_action" data-name="boot">开机</button><button class="tc-15-btn m disabled" data-event="cvm_oper_action" data-name="shutdown">关机</button><button class="tc-15-btn m disabled" data-event="cvm_oper_action" data-name="reboot">重启</button><button b-if="notI18n()" class="tc-15-btn m disabled" data-event="cvm_oper_action" data-name="renew">续费</button><button class="tc-15-btn m disabled" data-event="cvm_oper_action" data-name="resetpwd">重置密码</button><div class="tc-15-dropdown tc-15-dropdown-btn-style"   data-name="moreBtn"><a href="javascript:void(0);" class="tc-15-dropdown-link">更多操作<i class="caret"></i></a></div></div><div class="col">    <div id="searchArea" class="d-ib" style="width:400px;"></div>    <button type="button" class="tc-15-btn weak m refresh"  data-event="refresh" >刷新</button>    <button class="tc-15-btn weak m setting" data-event="set_Fields" title="设置列表显示字段" data-hot="yunzhuji.setfields" data-grid-setting="true"></button>    <button class="tc-15-btn weak m download" data-event="cvm_oper_action" data-name="exportall"></button></div></div></div>\x3c!-- 表格 结束 --\x3e<div id="cvmList" class="tc-table-grid tc-table-grid-cvm"></div></div></div>',{}),"cvm"),this.bee=s.appArea.children().length&&k.mount(s.appArea.children()[0],C.getBeeConfig()),this.cvmListEl=b("#cvmList"),this.searchAreaEl=b("#searchArea"),a.initGridView(e),a.renderBtnGroup(e),C.syncThen(function(e){if(e){var t=a.gridViewOptions.$data,i=t.colums=t.colums.filter(function(e){return!1!==e.i18n});a.gridView&&a.gridView.setColums(i)}});var t=k.getComponent("grid-view");a.gridView=new t(a.gridViewOptions),a.bindEvent(),a.cvmListEl.append(a.gridView.$el)},initCopy:function(){var e=this.cvmListEl.find(".ip-cell"),t=e.find("[data-clipboard-text]");new r({handle:t,container:e})},initGridView:function(e){this.gridViewOptions=l.get(this)},operActionEvent:function(e,t){var i=b(e).data("name"),a=p.getModuleMap();if(t&&0<t.length||"exportall"==i){var s=a[i],n=a[i].name,r=a[i].hotTag,o=new s.module({listIns:this,button:b(e),selectedItems:t}),d=new h({dataItems:t,operAction:p.getModuleArr(),listIns:this});o.operateAuth=d;var c=o.resolvePerm(t,i,n);if(o.permResult=c,o.hasPermItems=c.hasPermItems,o.selectedItems=c.hasPermItems,o.selectedShowOptions=c.selectedShowOptions,o.exec&&o.exec(),r){var l=o.selectedItems[0];"yunzhuji.showvnc"==r&&l&&l.osType&&(r+="linux"==l.osType?"_linux":"_windows"),x.click(r)}}else g.error("请选择主机。")},checkOperAction:function(e){var t=new h({dataItems:e=e||[],operAction:p.getModuleArr(),listIns:this}),i=p.getModuleMap();for(var a in i){var s=i[a];if(b("#operArea").find('[data-event=cvm_oper_action][data-name="'+a+'"]')){var n=new s.module({listIns:this,button:b("#operArea").find('[data-event=cvm_oper_action][data-name="'+a+'"]'),selectedItem:[]});n.refresh&&n.refresh(e,a,t)}}},getSelectItem:function(t){var s=[];return b(this.gridView.list).each(function(e,a){t.each(function(e,t){var i=b(t).closest("tr").data("uinstanceid");a.uInstanceId==i&&(a.el=b(t).closest("tr"),s.push(a))})}),s},showTask:function(e,t,i,a){c.check({listIns:this,task:e,tipTxt:t,from:i,objBase:a})},checkTask:function(e,t,i,a){},refresh:function(){this.renderList()},reload:function(){this.renderList()},getFormattedCvmInfo:function(v,e){var f=P,g=b.Deferred();return b.when(y.queryCvmList(v,e),y.getCvmWhiteList(["PrepaidForCVM","CVM_bandwidtd","CVM_FIREWALL","cvm_online_image","CVM_LARGERLIST","CVM_REFUND"]),y.getProjects(),y.getCvmFilterConfig(null,e)).done(function(e,t,i,a){T.setData(a.data);var s=e.data,n=s.deviceList,r=t.PrepaidForCVM&&0<t.PrepaidForCVM.length,o=t.CVM_bandwidtd&&0<t.CVM_bandwidtd.length,d=t.cvm_online_image&&0<t.cvm_online_image.length,c=t.CVM_FIREWALL&&0<t.CVM_FIREWALL.length,l=t.CVM_REFUND&&0<t.CVM_REFUND.length;(f.projectData=i)&&0<i.length?f.notShow_changeproject=!1:f.notShow_changeproject=!0,f.isBandwidthPackageUser=o,f.isPrepaidUser=r,f.onlineImage=d,f.isCvmRefundUser=l,f.notShow_firewall=!c;var p=[],u=[];if(b(n).each(function(e,t){t.isBandwidthPackageUser=f.isBandwidthPackageUser,t.isPrepaidUser=f.isPrepaidUser,t.isCvmRefundUser=f.isCvmRefundUser,t.regionId=v.regionId,u.push(t.uInstanceId),t.deviceWanIp&&p.push(t.deviceWanIp)}),a){var m=[],h=[];b(a.data.cvmTypeList).each(function(e,i){i.showInMenu&&h.push(i),b(i.deviceClassList).each(function(e,t){m.push({type:t,typeName:i.name,key:i.id})})}),a.data.deviceClassList=h,a.data.cvmTypeList=m}n=I.get(n,{filterData:a.data}),g.resolve({params:v,deviceList:n,uInstanceIds:u,wipArr:p,cvmListData:s,whiteList:t})}).fail(function(){g.reject()}),g.promise()},getFormattedCvmMoreInfo:function(o,e){var d=P,c=o.deviceList,t=(o.cvmListData,o.wipArr),i=o.uInstanceIds,a=u.getRegionId(),s=f.getRegionCodeMap(),l=b.Deferred(),n=b.Deferred();return t.length?y.queryIpBlockInfo({vipList:t,region:s[a]},e).then(n.resolve,function(){n.resolve({})}):n.resolve({}),b.when(y.getCvmMore({regionId:a,wipArr:t},e),y.queryNetInfo({uInstanceIds:i},e),y.queryImageInfo({uInstanceIds:i},e),y.queryCbsInfo({uInstanceIds:i},e),n).done(function(e,t,i,a,s){var n={},r={};b(i).each(function(e,t){n[t.uInstanceId]=t}),b(a.data).each(function(e,t){r[t.uInstanceId]=t.cbsList}),e.imageMap=n,e.cbsMap=r,e.projectData=d.projectData,e.ipBlocked=s&&s.list||[],I.getAll(c,e),l.resolve({params:o,deviceList:c})}).fail(function(){l.reject()}),l.promise()},renderList:function(e){var s=this,t=(e=e||s.searchData||{})&&0<e.page?e.page:this.gridView.page,i=e&&0<e.count?e.count:this.gridView.count;e.offset=(t-1)*i,e.limit=i,e.regionId=u.getRegionId(),"undefined"==typeof e.projectId&&-1!=u.getProjectId()&&(e.projectId=u.getProjectId());var n="";(e.instanceName||e.uInstanceIds||e.ips||e.searchWord||"undefined"!=typeof e.projectId&&-1!=e.projectId||e.zoneIdList||e.deviceClassList||e.cvmPayModeList||"undefined"!=typeof e.vpcId||"undefined"!=typeof e.subnetIds||"undefined"!=typeof e.uHostIds)&&(n="not empty"),s.gridLoaded=!1,s.getFormattedCvmInfo(e).done(function(e){var t=e.params;if(s.isPrepaidUser||b("#listtips").append('<div style="position:absolute;z-index:99;font-size:12px;line-height:20px;right:140px;top:15px;padding:5px 8px;background:#fffee7;border:1px solid #f2ba23;color:#264663;box-shadow:0 1px 3px rgba(0,0,0,.1)">当前云服务器为后付费月结的购买方式，现在去<a href="https://console.qcloud.com/workorder/category/create?level1_id=6&level2_id=7&level1_name=%E8%AE%A1%E7%AE%97%E4%B8%8E%E7%BD%91%E7%BB%9C&level2_name=%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8%20CVM" class="">切换到预付费</a>购买方式，<a target="_blank" href="https://'+QCMAIN_HOST+'/doc/product/213/5041">详细说明</a></div>'),e.whiteList.CVM_LARGERLIST&&0<e.whiteList.CVM_LARGERLIST.length){var i=s.gridView.$refs.pager;i.maxCount=200,i.minCount=50,i.countInterval=50}if(s.gridView.setData({list:e.deviceList,totalNum:e.cvmListData.totalNum,page:Math.floor(t.offset/t.limit)+1,count:t.limit}),s.showTableTips(e.deviceList,e.cvmListData,n),s.checkOperAction(),s.gridLoaded=!0,0<e.deviceList.length){s.renderMoreInfo({cvmListData:e.cvmListData,deviceList:e.deviceList,uInstanceIds:e.uInstanceIds,wipArr:e.wipArr,searchKey:n}),s.renderCvmNewFlag({deviceList:e.deviceList,uInstanceIds:e.uInstanceIds});var a=e.deviceList.map(function(e,t){return{idx:t,data:e}}).filter(function(e){return e.data.$loading});D.remove("cvm").push({id:"cvm",data:{regionId:t.regionId,loadingCVMList:a},work:s.inspectCvm.bind(s)})}})},showTableTips:function(e,t,i){var a=this;0==e.length?i?a.gridView.showTips('<span class="text">抱歉，没有找到相关云主机，尝试其他搜索条件。<a data-event="cvmnav" href="javascript:void(0);">返回列表</a></span>'):(a.gridView.showTips('<span class="text">当前项目下云主机列表为空，您可以<a href="javascript:void(0);" data-event="list_add_cvm" data-hot="yunzhuji.new">新建</a>一台云主机</span>'),b("[data-event=list_add_cvm]").click(o.add)):i&&a.gridView.showTips('<span class="text">搜索找到'+t.totalNum+'条结果，<a data-event="cvmnav" href="javascript:void(0);">返回列表</a></span>'),b("[data-event=cvmnav]").unbind().click(function(){a.gridView.page=1,a.gridView.count=50,u.setProjectId(-1),w.navigate("/cvm")})},filterhange:function(){var e=P;e.gridLoaded&&(e.gridView.page=1,e.gridView.count=50,e.renderList())},renderCvmNewFlag:function(t){b.when(y.getCvmNewFlag({uInstanceIds:t.uInstanceIds})).done(function(e){var n=e.data;n.length&&b(t.deviceList).each(function(e,t){for(var i=0,a=n.length;i<a;i++){var s=n[i];if(t.uInstanceId in s){t.newFlag=s[t.uInstanceId];break}}})}).fail(function(){})},renderMoreInfo:function(e){var i=this;this.getFormattedCvmMoreInfo(e).done(function(e){var t=e.params;i.gridView.setData({list:e.deviceList}),i.showTableTips(e.deviceList,t.cvmListData,t.searchKey),i.bindEvent2(e.deviceList)})},bindEvent2:function(e){var t=b("#cvmList");this.initCopy(),d.init(t,this),b("#cvmList").find("tr[data-uinstanceid]").bind({mouseover:function(e){b(this).find(".pencil-icon").css("visibility","visible"),b(this).find(".tc-bubble").css("visibility","visible"),b(this).find(".convert-ip-ash-icon").css("visibility","visible")},mouseout:function(e){b(this).find(".pencil-icon").css("visibility","hidden"),b(this).find(".tc-bubble").css("visibility","hidden"),b(this).find(".convert-ip-ash-icon").css("visibility","hidden")}}),this.notShow_changeproject?b("#operArea").find("[data-name=changeproject]").remove():b("#operArea").find("[data-name=changeproject]").show(),this.isPrepaidUser?(b("#operArea").find("[data-name=returncvm]").remove(),b("#operArea").find("[data-name=destroycvm]").show()):(b("#operArea").find("[data-name=returncvm]").show(),b("#operArea").find("[data-name=destroycvm]").remove())},bindEvent:function(){var s=this;b("#operArea").find(".tc-15-dropdown").append(n.tmpl('<ul class="tc-15-dropdown-menu"><li role="presentation" data-event="cvm_oper_action" data-name="bindkeypair"><a role="menuitem" href="javascript:void(0);">加载密钥</a></li><li role="presentation" data-event="cvm_oper_action" data-name="changeproject"  style="display:none;"><a href="javascript:;">分配至项目</a></li><li role="presentation" data-event="cvm_oper_action" data-name="alias"><a role="menuitem" href="javascript:void(0);">改名</a></li><li role="presentation" data-event="cvm_oper_action" data-name="upgradebandwidth"><a role="menuitem" href="javascript:void(0);">调整网络</a></li><li data-event="cvm_oper_action" data-name="returncvm" style="display:none;"><a href="javascript:;">退还服务器</a></li><li data-event="cvm_oper_action" data-name="destroycvm"  style="display:none;"><a href="javascript:;">销毁</a></li><li data-event="cvm_oper_action" data-name="export"><a href="javascript:;">导出选中</a></li><li data-event="cvm_oper_action" data-name="exportall"><a href="javascript:;">导出全部</a></li></ul>',s)),new a(b("#operArea").find(".tc-15-dropdown"),{newMode:!0}),b("#operArea").on("click","[data-event=cvm_oper_action]",function(e){var t=s.getSelectItem(b("tr[data-uinstanceid] input[type=checkbox]:checked"));(e=b(e.target).closest("[data-name][data-event]")).hasClass("disabled")||s.operActionEvent(e,t)}),b("#operArea").find("[data-event=refresh]").click(function(e){s.reload()}),b("#operArea").find("[data-event=set_Fields]").click(function(){s.gridView.showFieldsManager()}),b("#operArea").find("[data-event=add_cvm]").click(o.add),b(".manage-area.cvm").bind("click",function(e){0==b(e.target).closest("[data-name=moreBtn]").length&&b(".manage-area.cvm").find(".tc-15-menu-active").removeClass("tc-15-menu-active")}),b("#cvmList").bind("click",".item-row",function(e){var t=b(e.target).closest("tr"),i=t.find(".new-mark-icon");if(0!=i.length){i.hide();var a=[t.data("uinstanceid")];b.when(y.resetNewFlag({uInstanceIds:a})).done(function(e){var t=u.getRegionId(),i=s.regionPills.$el.find("button[data-value="+t+"]");e.data&&0==e.data.newFlag&&(i.find(".new-dot-mark").remove(),i.removeAttr("data-title"))}).fail(function(){})}})},inspectCvm:function(e,r){var t,i,o=this,a={global:!1,tipErr:!1},s=[];e.forEach(function(e){i=e.regionId,s=s.concat(e.loadingCVMList)}),(t=s.map(function(e){return e.data.uInstanceId}))&&t.length&&this.getFormattedCvmInfo({regionId:i,uInstanceIds:t},a).done(function(e){e&&e.uInstanceIds.length&&o.getFormattedCvmMoreInfo({cvmListData:e.cvmListData,deviceList:e.deviceList,uInstanceIds:e.uInstanceIds,wipArr:e.wipArr},a).done(function(e){(e.deviceList||[]).map(function(t){return{idx:(s.find(function(e){return e.data.uInstanceId===t.uInstanceId})||{}).idx,data:t}}).forEach(function(t,e){if(!t.data.$loading){var i=t.data.uInstanceId,a=o.cvmListEl.find("tr[data-uinstanceid="+i+"]");o.gridView.updateItem(t.idx,t.data),o.initCopy(),d.refresh(a,o);for(var s=0,n=r.data.length;s<n;s++)r.data[s].loadingCVMList=r.data[s].loadingCVMList.filter(function(e){return e.data.uInstanceId!==t.data.uInstanceId})}})})})}};i.exports={render:function S(a){null!=(a=a||{}).pid&&a.pid!=undefined?u.setProjectId(a.pid):null!=a.projectId&&a.projectId!=undefined&&u.setProjectId(a.projectId);var e=v.REGIONNAMES;0<a.rid&&e[a.rid]?u.setRegionId(a.rid):0<a.regionId&&e[a.regionId]&&u.setRegionId(a.regionId),a.alias&&(a.instanceName=a.alias,delete a.alias),a.instanceName&&(a.instanceName=decodeURIComponent(a.instanceName)),a.vagueIp&&(a.searchWord=a.vagueIp,delete a.vagueIp),a.instanceId&&(a.uInstanceIds=[a.instanceId]),b(["uInstanceIds","uHostIds","ips","zoneIdList","deviceClassList","cvmPayModeList","subnetIds"]).each(function(e,t){var i=a[t];i&&(a[t]=decodeURIComponent(i).split(","))}),P.render(a)},destroy:function(){D.stop()}}}),define("modules/cvm2/cvmutil",function(e,t,i){var l=e("$"),p=e("tips");return{getCvmAnalyseValue:function(e,t){e=l.trim(e);var i=/^(?:(?:[1-9]?[0-9]|1[0-9]{2}|2(?:[0-4][0-9]|5[0-5]))\.){3}(?:[1-9]?[0-9]|1[0-9]{2}|2(?:[0-4][0-9]|5[0-5]))$/,a=/^ins-/;if(breakReg=/\n/,options={},e){var s=e.split(/\n/);if(s[0]=l.trim(s[0]),i.test(s[0])){for(var n,r=[],o=0;o<s.length;o++)n=l.trim(s[o]),i.test(n)&&r.push(n);if(!(0<r.length))return p.error("输入主机名/主机ID／IP进行搜索"),null;options.ips=r}else if(a.test(s[0])){var d,c=[];for(o=0;o<s.length;o++)d=l.trim(s[o]),a.test(d)&&c.push(d);if(!(0<c.length))return p.error("输入主机名/主机ID／IP进行搜索"),null;options.uInstanceIds=l.unique(c)}else if(/^\d{1,3}((\.(\d{1,3})?)?){0,3}$/.test(s[0])){if(1!=s.length)return p.error("IP段暂不支持批量模糊搜索"),null;options.searchWord=s[0]}else{if(1!=s.length)return p.error("实例名称暂不支持批量模糊搜索"),null;options.instanceName=s[0]}return options.ips&&1==options.ips.length&&(options.searchWord=options.ips[0],delete options.ips),options}},getFilter:function(e,t){var i={};if(!e){if(e=e||{},i=this.getCvmAnalyseValue(t.searchWord),t.gridView.zoneIdSelector&&t.gridView.zoneIdSelector.getVal()&&(e.zoneIdList=[t.gridView.zoneIdSelector.getVal().value],-1==e.zoneIdList[0]&&(e.zoneIdList=null)),t.gridView.deviceClassSelector&&t.gridView.deviceClassSelector.getVal()){var a=t.gridView.deviceClassSelector.getVal();-1==a.value?e.deviceClassList=null:e.deviceClassList=a.deviceClassList}t.gridView.payModeSelector&&t.gridView.payModeSelector.getVal()&&(e.cvmPayModeList=[t.gridView.payModeSelector.getVal().value],-1==e.cvmPayModeList[0]&&(e.cvmPayModeList=null)),t.gridView.projectSelector&&t.gridView.projectSelector.getVal()&&(e.projectId=t.gridView.projectSelector.getVal().value,-1==e.projectId&&delete e.projectId),t.gridView.networkPayModeSelector&&t.gridView.networkPayModeSelector.getVal()&&(e.networkPayModeList=[t.gridView.networkPayModeSelector.getVal().value],-1==e.networkPayModeList[0]&&(e.networkPayModeList=null))}var s=e&&0<e.page?e.page:t.gridView.page,n=e&&0<e.count?e.count:t.gridView.count,r=l.extend(e,{offset:(s-1)*n,limit:n,projectId:t.projectId,regionId:t.regionId},i);for(var o in r)null==r[o]&&delete r[o];return-1==r.projectId&&delete r.projectId,r}}}),define("modules/cvm2/data",function(e,t,i){var s=e("$"),n=(e("models/api"),e("manager")),a=(e("constants"),e("appUtil"),e("util"),e("models/iaas"));i.exports={queryZone:function(e){var t=s.Deferred();return n.queryZone(e,function(e){t.resolve(e)},function(e){t.reject(e)}),t},queryRegion:function(e){var t=s.Deferred();return n.queryRegion(function(e){t.resolve(e)},function(e){t.reject(e)}),t},queryOvmRegion:function(){var t=s.Deferred();return a.apiRequest({cmd:"DescribeOvmRegions",serviceType:"ovm",data:{withVmCnt:1}},{tipErr:!1}).then(function(e){t.resolve(e.data.region_list)},function(e){t.resolve([])}),t},queryCvmAndOvmRegion:function(){var i=s.Deferred();return s.when(this.queryRegion(),this.queryOvmRegion()).done(function(e,t){i.resolve({cvmRegionMap:e,ovmRegionList:t})}),i},getProjects:function(){var t=s.Deferred();return n.getProjects(function(e){setTimeout(function(){t.resolve(e.data)},0)}),t},getCvmList:function(e){var t=s.Deferred();return n.getCvmList(e,function(e){t.resolve(e)},function(e){t.reject(e)},function(){console.log(arguments)}),t},getCvmMore:function(e,t){var i=s.Deferred(),a=t&&t.global;return cacheKey=t&&t.cacheKey,tipErr=t&&t.tipErr,n.getCvmMore(e,function(e){i.resolve(e)},function(e){i.reject(e)},a,cacheKey,tipErr),i},getCvmWhiteList:function(e,t){var i=s.Deferred();return n.getAllWhiteList(function(e){i.resolve(e)},function(e){i.reject(e)}),i},queryCvmList:function(e,t){var i=s.Deferred();return a.apiRequest({cmd:"DescribeInstanceMainInfo",serviceType:"cvm",data:e},t).then(function(e){i.resolve(e)},function(e){i.reject(e)}),i},queryImageInfo:function(e,t){var i=s.Deferred();return a.apiRequest({cmd:"DescribeInstanceImageInfo",serviceType:"cvm",data:e},t).then(function(e){i.resolve(e)},function(e){i.reject(e)}),i},queryCbsInfo:function(e,t){var i=s.Deferred();return a.apiRequest({cmd:"DescribeInstanceCbsInfo",serviceType:"cvm",data:e},t).then(function(e){i.resolve(e)},function(e){i.reject(e)}),i},queryNetInfo:function(e,t){var i=s.Deferred();return a.apiRequest({cmd:"DescribeInstanceNetInfo",serviceType:"cvm",data:e},t).then(function(e){i.resolve(e)},function(e){i.reject(e)}),i},queryIpBlockInfo:function(e,t){var i=s.Deferred();return a.apiRequest({cmd:"GetUnblockTime",serviceType:"bgpip",data:e},t).then(function(e){i.resolve(e.data||{})},function(e){i.reject(e)}),i},getCvmFilterConfig:function(e,t){var i=s.Deferred();return a.apiRequest({cmd:"getZonesAndCvmTypesAndPayModesForMc",serviceType:"cvm",data:e},t).then(function(e){i.resolve(e)},function(e){i.reject(e)}),i},getUserCvmOverview:function(e){var t=s.Deferred();return a.apiRequest({cmd:"DescribeUserCvmOverview",serviceType:"cvm",data:e}).then(function(e){t.resolve(e)},function(e){t.reject(e)}),t},updateUserCvmOverview:function(e){var t=s.Deferred();return a.apiRequest({cmd:"ModifyUserCvmOverview",serviceType:"cvm",data:e}).then(function(e){t.resolve(e)},function(e){t.reject(e)}),t},getCvmNewFlag:function(e){var t=s.Deferred();return a.apiRequest({cmd:"DescribeCvmNewFlag",serviceType:"cvm",data:e}).then(function(e){t.resolve(e)},function(e){t.reject(e)}),t},resetNewFlag:function(e){var t=s.Deferred();return a.apiRequest({cmd:"ResetCvmNewFlag",serviceType:"cvm",data:e}).then(function(e){t.resolve(e)},function(e){t.reject(e)}),t},patchResetNewFlag:function(e){var t=s.Deferred();return a.apiRequest({cmd:"BatchResetCvmNewFlag",serviceType:"cvm",data:e}).then(function(e){t.resolve(e)},function(e){t.reject(e)}),t}}}),define("modules/cvm2/dataformat",function(e,t,i){var r=e("constants"),u=e("appUtil"),o=e("util"),d=(r.DEVICE_RUNFLAGS,{1:"本地磁盘",2:"云硬盘",3:"本地SSD盘",5:"SSD云硬盘"}),m={cvmConfig:function(e){var t=e.cpuInfo=!e.deviceClass||"v1.0.5"!=e.deviceClass.toLowerCase()&&"v1.1"!=e.deviceClass.toLowerCase()?e.cpu+"核":"共享核",i=e.memInfo=e.deviceClass&&"v1.0.5"==e.deviceClass.toLowerCase()?e.mem+"MB":e.mem+"GB",a=e.bandwidth+"Mbps";1==e.trafficBandwidthUnLimitFlag&&(a="无限制");var s=d[e.rootType],n="<p>"+t+"  "+i+"  "+a+"</p>";s&&e.rootSize&&(n+="<p>系统盘："+s+"</p>"),e.netName?n+='<p class="text-overflow">网络：'+(0<e.vpcId?'<a data-event="nav" href="https://console.qcloud.com/vpc/vpc?rid='+e.regionId+"&vpcId="+e.vpcId+'" target="_blank">'+e.netName+"</a>":e.netName)+"</p>":n+="<p>&nbsp;</p>",e.cvmConfig=n},statusDesc:function(e){var t=e.rawStatusDesc=e.rawStatusDesc||e.statusDesc;e.$loading=!1,e.$disable=!1,"故障"!==t&&"运行中"!==t&&"已退还"!==t&&"已关机"!==t&&"待回收"!==t&&"重装系统失败"!==t&&"调整配置失败"!==t&&"数据盘扩容失败"!==t&&"调整带宽失败"!==t&&"系统盘扩容失败"!==t&&"发货失败"!==t&&(e.$loading=!0,e.$disable=!0);var i="";if(i="运行中"===t?"text-success":"已关机"===t||"待回收"===t?"text-danger":"故障"===t||"重装系统失败"===t||"调整配置失败"===t||"数据盘扩容失败"===t||"调整带宽失败"===t||"系统盘扩容失败"===t||"发货失败"===t?"text-warning":"",e.statusDesc='<span class="text-overflow '+i+'">'+t+"</span>",1==e.isSafeIsolated){var a=e.safeIsolatedInfo;e.statusDesc='<span class="text-overflow warning">'+t,e.statusDesc+='<i class="ico-warning" qc-popover="服务器由于有安全风险外网已被隔离，请尽快处理安全风险，解除风险后'+o.tmpl("<%=text%>",{text:'<a data-event="nav" href="/workorder/create?level1_id=6&level2_id=7&level1_name=计算与网络&level2_name=云服务器%20CVM">提交工单</a>'})+"给我们确认执行结果；<br>具体安全风险："+a+'"></i></span>'}else if(e.ipBlocked){e.statusDesc='<span class="text-overflow warning">'+t;var s=o.tmpl("<%=text%>",{text:'<span class="text-danger">封堵</span>'}),n=o.tmpl("<%=text%>",{text:'<a href="https://'+QCBUY_HOST+'/bgp_sp" target="_blank">购买</a>BGP<a href="https://'+QCMAIN_HOST+'/document/product/297/8337" target="_blank">高防服务包</a>'});e.statusDesc+='<i class="ico-warning" qc-popover="服务器由于受到攻击被'+s+"。"+e.ipBlockedTime+"将自动解封，您也可以"+n+'来应对攻击，恢复业务。"></i></span>'}else"重装系统失败"!==t&&"调整配置失败"!==t&&"数据盘扩容失败"!==t&&"调整带宽失败"!==t&&"系统盘扩容失败"!==t&&"发货失败"!==t||(e.statusDesc='<span class="text-overflow warning">'+t,e.statusDesc+='<i class="ico-warning" qc-popover="由于系统繁忙'+(e.errorKey?"（错误码："+e.errorKey+"）":"")+"，您的CVM实例"+t+"，请尽快"+o.tmpl("<%=text%>",{text:'<a data-event="nav" href="/workorder/create?level1_id=6&level2_id=7&level1_name=%E8%AE%A1%E7%AE%97%E4%B8%8E%E7%BD%91%E7%BB%9C&level2_name=%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8%20CVM">提交工单</a>'})+' 联系我们进行处理。"></i></span>');e.statusDesc='<span class="status-col">'+e.statusDesc+"</span>"},deadlineInfoAndStatus:function(e,t){var i,a=e.deadline||"0000-00-00 00:00:00",s=new Date(a.replace(/\-/g,"/")),n="";i=(t&&!isNaN(t)?t:u.getSystemTime())-s.getTime();var r,o=0;"0000-00-00 00:00:00"==a?(n="-",o=3):o=0<i?(n=(r=Math.floor(i/864e5))<1?'<span class="text-overflow status-recover error">已过期1天</span>':'<span class="text-overflow status-recover error">已过期'+r+"天</span>",1):i<-6048e5?(n=u.formatDate(u.getDate(a),"yyyy-MM-dd"),0):(n=(r=Math.floor(Math.abs(i/864e5)))<1?'<span class="text-overflow warning">小于1天到期</span>':'<span class="text-overflow warning">'+r+"天后到期</span>",2);return e.deadlineStatus=o,e.deadlineInfo=n},cvmPayModeDesc:function(e){var t="包年包月",i=[];if(e.cvmPayMode===r.CVMPAYMODE.CDHPAID)t="不计费",e.addTimeStamp&&i.push("<p>"+u.formatDate(u.getDate(e.addTimeStamp),"yyyy-MM-dd")+"创建</p>");else if(e.cvmPayMode===r.CVMPAYMODE.SECOND)t="按量计费",e.addTimeStamp&&i.push("<p>"+u.formatDate(u.getDate(e.addTimeStamp),"yyyy-MM-dd")+"创建</p>");else if(e.isPrepaidUser){var a=m.deadlineInfoAndStatus(e);"-"!=a&&(0==e.deadlineStatus?i.push(a+"到期"):i.push(a))}else t="后付费";e.cvmPayModeDesc=t,e.cvmPayModeTimeDesc=i.join("")},networkPayModeDesc:function(e){var t="按带宽包年包月计费";e.networkPayMode===r.NETWORKPAYMODE.FLOW?t="按流量计费":e.networkPayMode===r.NETWORKPAYMODE.SECOND?t="按带宽使用时长计费":e.isBandwidthPackageUser||e.networkPayMode===r.NETWORKPAYMODE.PACKAGE?t="共享带宽包":e.isPrepaidUser||(t="按带宽后付费月结"),e.networkPayModeDesc=t},diskInfo:function(e){var t=d[e.rootType];e.sysDiskInfo=e.rootSize+"GB",t&&e.rootSize&&(e.sysDiskInfo+="("+t+")");var i=d[e.diskType];if(0<=$.inArray(+e.diskType,r.DISK_CATEGORY.cloud)&&0!=e.status){var a=0;if(e.cbsList&&0<e.cbsList.length)for(var s=0;s<e.cbsList.length;s++)e.cbsList[s].diskType&&"data"!==e.cbsList[s].diskType||(a+=e.cbsList[s].diskSize);e.diskInfo=a+"GB",i&&a&&(e.diskInfo+="("+i+")"),e.uHostId&&0==a&&(e.diskInfo="无")}else e.diskInfo=e.disk+"GB",i&&e.disk&&(e.diskInfo+="("+i+")")},cpuInfo:function(e){e.cpuInfo=!e.deviceClass||"v1.0.5"!=e.deviceClass.toLowerCase()&&"v1.1"!=e.deviceClass.toLowerCase()?e.cpu+"核":"共享核"},memInfo:function(e){e.memInfo=e.deviceClass&&"v1.0.5"==e.deviceClass.toLowerCase()?e.mem+"MB":e.mem+"GB"},bandwidthInfo:function(e){e.bandwidthInfo=e.bandwidth+"Mbps",65535==e.bandwidth&&(e.bandwidthInfo="无限制")},canUpgradeToKvm:function(e){var t=r.HYPERVISOR,i=r.ZONEID.GZ1,a=!1;e.isPrepaidUser&&t&&t.ENABLE&&e.opsAvailable.XENTOKVM&&(e.zoneId!=i||!e.cbsList.length)&&(a=!0,t.ENABLE_WINDOWS||"windows"!==e.osType?!t.ENABLE_CBS&&e.cbsList&&e.cbsList.length&&(a=!1):a=!1),e.canUpgradeToKvm=a},projectName:function(e,t){for(var i,a=t,s={},n=0;i=a[n];n++)s[i.projectId]=i.name;e.projectName=s[e.projectId]||"已停用项目"},deviceImageIdInfo:function(e){e.deviceImageIdInfo=e.deviceImageId,e.unImgIdInfo=e.unImgId,0==e.deviceImageId&&(e.deviceImageIdInfo="-"),e.unImgId||(e.unImgIdInfo="-")}};i.exports={get:function(e,t){var n=t.filterData;return $(e).each(function(e,i){var a,t,s;i.statusDesc=u.getRunFlagDesc(i.runflag),i.uHostId&&6==i.runflag&&(i.statusDesc="销毁中"),$(n.osTypeList).each(function(e,t){if(t.name===i.osName)return i.osValue=i.osName,i.osName=t.desc,i.osType=t.osType,i.defaultUser=t.defaultUser,!1}),i.deviceTypeDesc=(a=i.deviceClass,t=n.cvmTypeList,s="",a=a.replace(/\./g,""),$(t).each(function(e,t){if(t.type.replace(/\./g,"")==a)return s=t.typeName,!1}),s),i.osIcon=function(e){var t=r.CVM_ROOT_SYSTEM_ICON,i="";if(!e)return i;for(var a in t)if(new RegExp(a,"i").test(e)){i=t[a];break}return i}(i.osValue||i.osName),m.statusDesc(i),i.zoneName||(i.zoneName="-"),m.cvmPayModeDesc(i),m.cvmConfig(i)}),e},getAll:function(e,t){var i=t.vpcList,n={};$(i).each(function(e,t){var i=t.vpcId;n[i]={name:t.vpcName,subnet:{},vpcCIDR:t.vpcCIDR,unVpcId:t.uniqVpcId};var a=t.subnetList||[];$(a).each(function(e,t){n[i].subnet[t.subnetId]=t.subnetName})});var r=t&&t.ipBlocked||{},o=t.projectData,d=t.imageMap||{},c=t.cbsMap||{},l=t.eipQuota,p={};if(t.eipSet){var a=t.eipSet.eipSet;$(a).each(function(e,t){p[t.eip]=t})}return $(e).each(function(e,t){t.cbsList=c[t.uInstanceId]||[],t.unImgId=d[t.uInstanceId];var i=n[t.vpcId],a=i?i.subnet[t.subnetId]:"";if(t.netName=i?i.name:"基础网络",t.unVpcId=i?i.unVpcId:"",t.subnetName=i&&a||"-",t.relatedVpcId&&(t.relatedVpc=n[t.relatedVpcId]),t.ipConfig={deviceLanIp:t.deviceLanIp,deviceWanIp:t.deviceWanIp,eipQuotaData:l,eipInfo:null},t.deviceWanIp&&p[t.deviceWanIp]&&(t.eipInfo=t.ipConfig.eipInfo=p[t.deviceWanIp]),t.deviceWanIp){var s=r.find(function(e){return e.ip==t.deviceWanIp});t.ipBlocked=s&&!!s.unblockTime,t.ipBlockedTime=s&&s.unblockTime||""}t.operateAuth=t.operateAuth||0,t.opsAvailable=u.getOperationTag(t.operateAuth,t.runflag),m.statusDesc(t),m.cvmConfig(t),m.networkPayModeDesc(t),m.deadlineInfoAndStatus(t),m.diskInfo(t),m.cpuInfo(t),m.memInfo(t),m.canUpgradeToKvm(t),m.projectName(t,o),m.bandwidthInfo(t),m.deviceImageIdInfo(t)}),e}}}),define("modules/cvm2/event/addcvm",function(e,t,i){var a=e("appUtil"),s=e("constants");t.add=function(){var e=s.BUY_HOST;e+="cvm?regionId="+a.getRegionId()+"&projectId="+a.getRegionId(),window.open(e,"_blank")}}),define("modules/cvm2/event/alias/alias",function(e,t,i){var o=e("$"),d=e("manager"),a=e("modules/cvm2/event/operate_base"),c=e("dialog"),l=e("tips"),s=e("util"),n=e("lengthlimiter"),r=e("widget/selectedShow/selectedShow"),p='<div class="edit_form_wrap">        <ul class="edit_psword">            <li>                <label class="txt">新云主机名称:</label>                <input class="txt_input" style="width:260px" id="aliasIpt" data-lenLimit="60" maxlength="60" relTipId="nameTip" type="text"/>                <p class="tip" id="nameTip"></p>            </li>            \x3c!--<li class="mod">                <input type="checkbox" class="tc-15-checkbox" checked />                <span class="msg">批量改名时，自动添加序号</span>            </li>--\x3e        </ul>    </div>',u=function(e){a.call(this,e)};(u.prototype=new a).exec=function(){var e,t=this;e=this.hasPermItems[0],c.create(s.tmpl(p,{}),540,"",{title:"改名",preventResubmit:!0,button:{"确定":function(){t.sendReq()}},onload:function(e){}}),r.render(this.selectedShowOptions),n.trigger(),o("#aliasIpt").focus().val(e.alias),n.trigger()},u.prototype.sendReq=function(){var e=this,t=c.el.find('input[type="text"]'),i=o.trim(t.val());if(!i)return t.focus(),void this.restoreDialogBtn();for(var a,s=[],n=[],r=0;a=e.hasPermItems[r];r++)s.push(a.deviceLanIp),n.push(a.uuid);d.modifyCvmAliasBatch({alias:i,ipList:s,uuidList:n},function(){c.hide(),e.refreshList(!0),l.success("修改成功")})},i.exports=u}),define("modules/cvm2/event/bindEni/bindEni",function(d,e,t){var c=d("$"),i=d("widget/cvmList/operate_base"),a=d("widget/selectors/EniSelector"),s=d("manager"),l=d("dialog"),p=d("tips"),n=d("util"),u={main:'<div class="binding-ip" id="cvmBindEni">    <div class="tc-15-option-hd mb10">        <h4 class="mb10">请选择云主机"{{instanceId}}"要绑定的弹性网卡</h4>        <p class="mb10">该云主机支持{{eniLimit}}块网卡，每个网卡支持{{eniIpLimit}}个IP，<a href="//'+QCMAIN_HOST+'/document/product/215/6513#.E4.BD.BF.E7.94.A8.E7.BA.A6.E6.9D.9F" target="_blank">查看网卡配额说明 <b class="external-link-icon"></b></a></p><div class="tc-15-msg" style="margin: 10px 0;"><div class="tip-info">云主机绑定弹性网卡后，您需登录云主机配置IP及路由，点击<a href="//'+QCMAIN_HOST+'/document/product/215/6513#.E4.BA.91.E4.B8.BB.E6.9C.BA.E5.86.85.E5.BC.B9.E6.80.A7.E7.BD.91.E5.8D.A1.E7.9A.84.E9.85.8D.E7.BD.AE.EF.BC.88.E4.BB.A5centos-7.2.E4.B8.BA.E4.BE.8B.EF.BC.89" target="_blank">查看操作指南</a></div></div>        <p class="mb10">                <label class="form-ctrl-label {{action.disabled ? \'text-weak\': \'\'}}" data-title?="action.disabled && action.disabledTip" b-repeat="action in actions">                    <input type="radio" name="rd-demo1" class="tc-15-radio" b-model="actionType"  disabled?="action.disabled" value="{{action.type}}" />                    {{action.label}}                </label>        </p>        <span  b-if="actionType==\'bind\'">已筛选"私有网络：{{netName}}，可用区：{{zoneName}}"下的弹性网卡</span>    </div>    <eni-selector b-ref="eni" zone-id="{{zoneId}}" instance-id="{{instanceId}}" callback="{{callback.bind(this)}}" vpc-id="{{vpcId}}" eni-ip-limit="{{eniIpLimit}}" extra-param="{{extraParam}}" search-placeholder="搜索名称、内网IP" b-if="actionType==\'bind\'"></eni-selector></div>',overlimit:'<div class="dialog-confirm-box">    <p class="dialog-confirm-title"><i class="m-error-icon"></i><strong>弹性网卡数量已达到上限</strong></p>    <p class="dialog-confirm-text">云主机绑定弹性网卡数量超过上限。</p>  </div>',tipcontent:'<div class="dialog-confirm-box">    <p class="dialog-confirm-title"><i class="<%= iconClassName %>"></i><strong><%= text %></strong></p>    <p class="dialog-confirm-text"><%= desc %></p>  </div>'},r={0:{text:"绑定成功",desc:"您的弹性网卡已经绑定成功。接下来，还需要登录云主机并进行配置后才能生效。具体配置方法可查看文档。",iconClassName:"m-success-icon"},29231:{text:" 弹性网卡已绑定IP数超过此规格云主机单网卡IP绑定数上限",desc:" 弹性网卡已绑定IP数超过当前云主机单网卡IP绑定数上限，本次绑定失败。",iconClassName:"m-error-icon"},29232:{text:"弹性网卡数量已达到上限",desc:"可能有其它人已经绑定了弹性网卡，使当前云主机的弹性网卡数量已达上限，本次绑定失败。",iconClassName:"m-error-icon"},9005:{text:"弹性网卡已被绑定",desc:"可能有其它人已经绑定了弹性网卡，本次绑定失败。您可以重新绑定其它弹性网卡。",iconClassName:"m-error-icon"}},m=Bee.extend({$tpl:u.main,callback:function(e){if(!e.length){var t=this.$get("actions");t[0].disabled=!0,t[0].disabledTip="私有网络："+this.netName+"，可用区：'"+this.zoneName+"'下没有可用的弹性网卡，您可以新建一个并绑定",t.$set(0,t[0]),this.$set("actionType","new")}}},{defaults:{actionType:"bind",actions:[{label:"绑定已有弹性网卡",type:"bind",disabled:!1},{label:"新建弹性网卡并绑定",type:"new",disabled:!1}]}});m.tag("eni-selector",a.extend({parseData:function(e){var t=this;return e.list=e.list.filter(function(e){return e.zoneId==t.zoneId}),e.list.forEach(function(e){e.ipNum=e.privateIpAddressesSet.length,e.instanceSet&&e.instanceSet.instanceId==t.instanceId&&(e.$disable=!0,e.$disableTips="云主机已绑定绑定该网卡"),e.primary&&(e.$disable=!0,e.$disableTips="主网卡不可绑定"),e.instanceSet&&e.instanceSet.instanceId&&(e.$disable=!0,e.$disableTips="该网卡已绑定其他云主机"),(e.privateIpAddressesSet||[]).length>t.eniIpLimit&&(e.$disable=!0,e.$disableTips="该网卡绑定的IP数超过了云主机支持的上限")}),this.callback(e.list),e}},{defaults:c.extend({},a.defaults,{colums:[{name:"网卡ID/名称",key:"networkInterfaceName",tdTpl:'<p><span class="text-overflow">{{item.networkInterfaceId}}</span></a></p><span class="text-overflow m-width">{{item.eniName}}</span>'},{name:"所属子网",key:"subnetId"},{name:"网卡IP数",key:"ipNum"}]})}));var o=function(e){i.call(this,e)};(o.prototype=new i).exec=function(){var t=this;this.doAction({instanceId:this.hasPermItems[0].uInstanceId,regionId:this.hasPermItems[0].regionId,zoneId:this.hasPermItems[0].zoneId,zoneName:this.hasPermItems[0].zoneName,vpcId:this.hasPermItems[0].unVpcId,netName:this.hasPermItems[0].netName}).then(function(e){(e=(e||{}).data)&&e.taskId&&t.checkTask(e,"绑定弹性网卡中")},function(){})},o.prototype.doAction=function(r){var o=this;return new Promise(function(s,n){Promise.all([o.QueryInstanceEniLimit({regionId:r.regionId,instanceId:r.instanceId}),o.QueryInstanceEniNum({instanceId:r.instanceId,hideSecondary:0})]).then(function(e){var t=e[0].eniLimit||0,i=e[0].eniIpLimit||0;if(data=e[1]&&e[1].data||[],t<=(data.length||0))l.create(u.overlimit,500,"",{struct:"rich",closeIcon:!1,defaultCancelBtn:!1,button:{"确定":function(){l.hide(),n()}}});else{var a=o.bee=new m({$data:{instanceId:r.instanceId,netName:r.netName,regionId:r.regionId,zoneId:r.zoneId,zoneName:r.zoneName,eniLimit:t,eniIpLimit:i,extraParam:{hideSecondary:0,limit:999,vpcId:r.vpcId}}});o.bee.$watch("actionType",function(e){var n=this;"new"==e?nmcLoad("vpc2.js",function(){d.async(["modules/vpc/eni/add/add","modules/vpc/eni/model"],function(e,t){o.add=new e.Add({$data:{regionId:r.regionId,vpcId:r.vpcId,netName:r.netName,eni:{vpcId:r.vpcId},cvmAvaliableIP:i,hideRegion:!0},sendCreateRequest:function(e){var s=this;return e=c.extend({},e,{instanceId:r.instanceId}),t.CreateAndAttachNetworkInterface(e,{tipErr:!1}).then(function(e){return e},function(e){var t,i,a=e.message.match(/privateIpAddress\(([\d\.]+)\)/);throw(a=a&&a[1])&&(t=c(n.$el).find('[data-ip="'+a+'"]'),29215==e.cgwCode?(i="该内网IP不在弹性网卡子网内",p.hideFlash(1)):29216==e.cgwCode?(i="该内网IP已经被使用",p.hideFlash(1)):29236==e.cgwCode&&(i="该IP为子网保留IP, 不能使用",p.hideFlash(1)),t&&t[0]&&i&&s.validator.showErr(t[0],i),p.error(e.msg)),e})}}),c(o.bee.$el).append(o.add.$el),l&&l.center()})}):(c(o.add.$el).remove(),o.add&&o.add.$destroy())}),l.create(a.$el,720,"",{title:"绑定弹性网卡",defaultCancelCb:function(){a.$destroy(),n()},button:{"确定":function(e){var t=(o.bee.$refs.eni.currentItem||{}).networkInterfaceId;"bind"==o.bee.actionType?o.sendReq({vpcId:r.vpcId,networkInterfaceId:t,instanceId:r.instanceId}).then(function(e){l.hide(),s(e)},n):o.add.submit({btn:e}).then(function(e){l.hide(),o.displayTip(e).then(s)},function(e){l.toggleBtnDisable(!1),o.displayTip(e).then(n)})}},preventResubmit:!0})}},function(){})})},o.prototype.sendReq=function(a){var s=this;return new Promise(function(t,i){a&&a.networkInterfaceId?nmcLoad("vpc2.js",function(){d.async("modules/vpc/eni/model",function(e){e.AttachNetworkInterface({networkInterfaceId:a.networkInterfaceId,vpcId:a.vpcId,instanceId:a.instanceId},{tipErr:!1}).then(function(e){s.displayTip(e).then(t)},function(e){s.displayTip(e).then(i)})})}):t()})},o.prototype.QueryInstanceEniLimit=function(i){return new Promise(function(t,e){s.getInstanceEniLimit(i,function(e){e=e&&e.data||{},t(e)},e)})},o.prototype.QueryInstanceEniNum=function(i){return new Promise(function(t,e){s.getInstanceEniNum(i,function(e){e=e&&e.data||{},t(e)},e)})},o.prototype.displayTip=function(i){var a=r[i.code];return new Promise(function(e,t){0==i.code?e(i):a?l.create(n.tmpl(u.tipcontent,{text:a.text,desc:a.desc,iconClassName:a.iconClassName}),500,"",{struct:"rich",closeIcon:!1,defaultCancelBtn:!1,button:{"确定":function(){l.hide(),e(i)}}}):(p.error(i.msg),e())})},t.exports=o}),define("modules/cvm2/event/bindkeypair/bindkeypair",function(e,t,i){var c=e("$"),l=e("manager"),a=e("modules/cvm2/event/operate_base"),p=e("dialog"),o=e("util"),u=e("appUtil"),m=(e("event"),e("tips")),d=e("constants"),h=e("widget/selectedShow/selectedShow"),v=e("modules/cvm2/event/upgrade_common"),f='<div id="bindkeyWrapper">    <div class="mod-secret-key" style="margin-top:0">            <div class="mod-secret-key-tit">对选中云主机加载以下密钥：</div>            <div class="secret-key-list" style="min-height:250px">                <ul class="sshkey-list"></ul>            </div>          </div></div>',g='<div class="text-tips">        <p>1、为了避免数据丢失，加载密钥需要在<em class="text-danger">关机</em>状态下操作，云服务器将关机中断您的业务，请仔细确认</p>        <p>2、强制关机可能会导致数据丢失或文件系统损坏，您也可以主动关机后进行调整配置</p>        <p>3、强制关机可能需要您等待较长时间，请耐心等待</p>        <p><label class="form-ctrl-label"><input type="checkbox" b-model="agree" class="tc-15-checkbox">同意强制关机</label></p>    </div>',s='<% if (data.length) { %><% for (var i=0, item; item = data[i]; i++) { %><li><label class="tc-15-checkbox-wrap" style="display:block"><input type="checkbox" class="tc-15-checkbox" value="<%- item.key_id %>"><%= item.key_name %></label></li><% } %><% } else { %><li style="padding:20px; text-align:center">暂无密钥, <a href="/cvm/sshkey" data-event="nav">点击新建</a></li><style>.secret-key-list{min-height: 0!important}</style><% } %>',n=function(e){a.call(this,e)};(n.prototype=new a).exec=function(){var e=this,t=this.hasPermItems,i=t[0],a=o.tmpl(f,{powerOffWiki:d.POWEROFFWIKI}),s=!0;this.upgradeCommon=new v(this);for(var n=0;t[n];n++)e.upgradeCommon.isShutdown(t[n].runflag)||(s=!1);var r={shutdown:{"确定":function(){e.sendReq()}},nonShutdown:{"下一步":function(){e.toConfirmShutdown({confirmTpl:g,title:"加载密钥",confirmBtnTxt:"去调整"}).done(function(){e.sendReq(!0)})}}}[s?"shutdown":"nonShutdown"];p.create(a,540,"",{title:"加载密钥",preventResubmit:!0,button:r}),h.render(this.selectedShowOptions),this.wrapper=c("#bindkeyWrapper"),this.keyList=this.wrapper.find(".sshkey-list"),this.keyListData=[],this.getKeyList(i.projectId,1)},n.prototype.getKeyList=function(i,a){var s=this,e=40*(a-1);l.queryKeypair({count:40,offset:e,projectId:i},function(e){var t=e.key_list||[];s.keyListData=s.keyListData.concat(t),s.renderListUi(t),s.keyListData.length<e.key_total&&s.getKeyList(i,a+1)})},n.prototype.renderListUi=function(e){var t=this.keyList,i=o.tmpl(s,{data:e});t.append(i)},n.prototype.sendReq=function(e){var t=this,i=this.keyList;if(keyChecked=i.find('input[type="checkbox"]:checked'),!keyChecked.length)return m.error("请选择密钥!"),u.restoreDialogBtn(),!1;for(var a,s=[],n=[],r=[],o=0;a=this.hasPermItems[o];o++)n.push(a.deviceLanIp),r.push(a.uuid);keyChecked.each(function(e,t){t=c(t);var i={};i.keyId=t.val(),i.bindIpList=n,i.bindUuidList=r,s.push(i)});var d={actionType:2,reqList:s};!0===e&&(d.hardPowerOffFlag=1),l.manageCvmKey(d,function(e){p.hide(),t.checkTask(e,"下发密钥中","sshkey")})},i.exports=n}),define("modules/cvm2/event/createimg/createimg",function(e,t,i){var u=e("$"),a=e("manager"),s=e("modules/cvm2/event/operate_base"),m=e("validator"),h=e("dialog"),n=e("tips"),v=e("util"),r=(e("appUtil"),e("event")),o=e("modules/cvm2/event/xentokvm/xentokvm"),d=e("widget/selectedShow/selectedShow"),c=(e("models/api"),e("lengthlimiter")),f=e("reporter"),g=e("models/iaas"),b={main:'    <style>.deci-ul li{list-style-type:decimal; margin-left: 20px}</style>    <div id="createImgWrapper">    <div class="tip_box">            <% if (osType == "linux") { %>            镜像制作过程约需10分钟。            <% } else if (osType == "windows" && sysprep) { %>            <ul class="deci-ul">            <li>镜像制作过程约需30分钟。</li>            <li><span style="color:red">执行sysprep需要云服务器启用administrator账户；基于windows 2008制作的镜像，无法保留administrator用户目录下的文件。</span>若不需要使用域账户登录windows，强烈建议选择 <a href="javascript:;" data-event="change_no_sysprep">不执行sysprep制作镜像</a>。</li>            <li>请务必确认<span style="color:red">QcloudService</span>服务已设置为自动启动，否则制作的镜像将不可用。镜像制作失败常见<a href="https://'+QCMAIN_HOST+'/document/product/213/2504" target="_blank"> 解决办法</a></li>            </ul>            <% } else if (osType == "windows" && !sysprep) { %>            <ul class="deci-ul">            <li>镜像制作过程约需30分钟。</li>            <% if(!sysprepUnsupported){ %><li>若您需要使用域账号登陆windows，请选择<a href="javascript:;" data-event="change_sysprep"> 执行sysprep制作镜像</a>。</li><% } %>            <li>请务必确认<span style="color:red">QcloudService</span>服务已设置为自动启动，否则制作的镜像将不可用。镜像制作失败常见<a href="https://'+QCMAIN_HOST+'/document/product/213/2504" target="_blank"> 解决办法</a></li>            </ul>            <% } %>            <% if(isOnline && isPowerOn){ %>            <p id="norebootTips" style="color:#f00;display:none;">注意：未选择重启制作镜像时，运行中CVM的内存数据会有一定概率不被写入镜像。</p>            <% } %>                   </div>    <div class="edit_form_wrap">            <ul class="edit_psword">                <li>                    <label class="txt"><span style="color:#f00">*</span>镜像名称:</label>                    <input class="tc-15-input-text m" type="text" maxlength="20" />                                  <p class="tip">只支持字母、数字或连接符号</p>                </li>                <li>                    <label class="txt">镜像描述:</label>                    <textarea class="tc-15-input-textarea" data-lenLimit="60" relTipId="descTip"></textarea>                    <p class="tip" id="descTip"></p>                </li>                \x3c!-- <% if(isOnline && isPowerOn){ %>                <li>                    <label class="txt"></label>                    <input type="checkbox" class="tc-15-checkbox" id="isreboot" checked="checked"><label for="isreboot">重启云主机，制作完整镜像</label>                </li>                <% } %> --\x3e            </ul>        </div>    </div>',xenTip:'    <div style="padding:10px; font-size:14px">该服务器需要置换为新服务器才能制作自定义镜像。<a href="javascript:;" id="replaceServer">立即置换新服务器</a></div>',confirmTip:"    <% if(!isReboot){ %>    <p>您现在用的是不重启制作镜像，即不用关机，有一定风险正在运行中的部分数据不会保留到制作好的自定义镜像内</p>    <% }else{ %>    <p>请确认关机并制作完整镜像，制作完成将重新启动，制作期间，云主机内服务将随关机而停止</p>          <% } %>    ",confirm:'    <div class="text-tips">        <p>1、为了避免数据丢失，制作自定义镜像需要在<em class="text-danger">关机</em>状态下操作，云服务器将关机中断您的业务，请仔细确认</p>        <p>2、强制关机可能会导致数据丢失或文件系统损坏，您也可以主动关机后进行自定义镜像的制作</p>        <p>3、强制关机可能需要您等待较长时间，请耐心等待</p>        <p><label class="form-ctrl-label"><input type="checkbox" id="isHardPowerOffFlag" b-model="agree" class="tc-15-checkbox">同意强制关机</label></p>        <% if (isWhiteList){ %>            <p id="noRebootTips" style="color:#f00;">注意：未选择关机制作镜像时，运行中CVM的内存数据会有一定概率不被写入镜像。</p>        <% } %>    </div>'},l=function(e){s.call(this,e)};(l.prototype=new s).exec=function(){if(1===this.hasPermItems[0].hypervisor)return this.showXenTip();var t=this;this.isPowerOn=this.hasFeature("NONSHUTDOWN"),this.sysprepUnsupported=50<this.hasPermItems[0].rootSize,a.getAllWhiteList(function(e){e&&e.windows2003_offline&&e.windows2003_offline.length&&(t.whiteList2003=!0),t.whiteList2003||!/windows2003/.test(t.hasPermItems[0].osValue)?(g.apiRequest({serviceType:"image",cmd:"DescribeImages",data:{status:0,imageType:1,limit:200}}).then(function(e){t.imgData=e}),e&&e.cvm_online_image&&e.cvm_online_image.length?(t.isOnline=!0,t.isWhiteList=!0):(t.isOnline=!0,t.isWhiteList=!1),t.showDialog(),c.trigger()):n.error('不再支持windows 2003的云服务器制作自定义镜像 <a href="http://bbs.qcloud.com/thread-4937-1-2.html" target="_blank">了解原因</a>',6e3)})},l.prototype.showDialog=function(e){var t=this,i=t.hasPermItems[0].osType,a="制作自定义镜像",s=v.tmpl(b.main,{osType:i,sysprep:e,sysprepUnsupported:this.sysprepUnsupported,isOnline:this.isOnline,isPowerOn:this.isPowerOn}),n=t.isPowerOn&&t.isOnline?{"下一步":function(){t.sendReq(e)}}:{"确定":function(){t.sendReq(e)}};"windows"!==i||this.sysprepUnsupported||(a+=e?"(执行sysprep)":"(不执行sysprep)"),h.create(s,"550","",{title:a,preventResubmit:!0,button:n}),d.render(this.selectedShowOptions),t.bindEvent()},l.prototype.bindEvent=function(){var e=this;r.bindCommonEvent(u("#createImgWrapper")[0],"click",{change_sysprep:function(){e.showDialog(!0)},change_no_sysprep:function(){e.showDialog()}}),u("#isreboot").on("change",function(){u(this).prop("checked")?u("#norebootTips").hide():u("#norebootTips").show()})},l.prototype.showXenTip=function(){var e=this;h.create(b.xenTip,"500","",{title:"制作镜像",button:{}}),u("#replaceServer").click(function(){o.render(e)})},l.prototype.sendReq=function(e){var t=this,i=this.hasPermItems[0],a=h.el.find('input[type="text"]'),s=h.el.find("textarea"),n=u.trim(a.val()),r=u.trim(s.val()),o=function(e,t){var i={tip:e};return m.showErr(t,i)};if(!n)return o("请输入镜像名称",a);if(20<n.length)return o("镜像名称不能超过20个字符",a);if(!/^[0-9a-zA-Z-]{1,20}$/.test(n))return o("请输入格式正确的名称",a);if(this.imgData)for(var d,c=0;d=this.imgData.imageSet[c];c++)if(n.toLowerCase()==d.imageName.toLowerCase())return o("输入的名称已经存在",a);if(r&&60<r.length)return o("描述长度不能超过60个字符",s);var l={instanceId:i.uInstanceId,imageName:n,imageDescription:r};"windows"==this.hasPermItems[0].osType&&(l.sysprep=e?1:0);var p=function(){var e=!1;t.isOnline&&t.isPowerOn&&(e=u("#isHardPowerOffFlag").prop("checked"),l.hardFlag=e?1:0),g.apiRequest({serviceType:"image",cmd:"CreateImage",data:l}).then(function(e){h.hide(),t.checkTask({taskId:e.data.taskId},"制作镜像中")}),this.isOnline&&this.isPowerOn&&(e?f.click("yunzhuji.zzjingxiang.shutoff"):f.click("yunzhuji.zzjingxiang.noshutoff"))};this.isOnline&&this.isPowerOn?t.toConfirmShutdown({confirmTpl:v.tmpl(b.confirm,{isWhiteList:t.isWhiteList}),title:"制作自定义镜像",confirmBtnTxt:"制作镜像",isConfirmBtnNoDisable:t.isWhiteList}).done(function(){p()}):p()},i.exports=l}),define("modules/cvm2/event/dropdown",function(e,t,i){e("reporter"),e("config/constants"),e("widget/cvmList/xentokvm/xentokvm"),e("widget/cvmList/data_package");var l=e("modules/cvm2/event/operate_entry"),p=e("modules/cvm2/event/operate_auth");e("widget/copy/copy");return{refresh:function(e,t){var i,a=t.gridView,s=e.data("uinstanceid");if($(a.list).each(function(e,t){t.uInstanceId==s&&(i=t)}),i)for(var n,r=l.getModuleArr(),o=new p({dataItems:[i],operAction:r,listIns:t}).getAuth(),d=0;n=r[d];d++){var c=e.find('[data-name="'+n+'"]');o[n]&&c.length&&(0===o[n].code?(c.removeClass("disabled").attr("data-title",""),c.is("[data-name=alias]")&&c.css("cursor","pointer")):c.is("[data-name=alias]")?c.addClass("disabled").attr("title",o[n].tip).removeAttr("data-event"):c.addClass("disabled").attr("data-title",o[n].tip).removeAttr("data-event"))}},init:function(t,i){i.gridView;$(t).find("tr[data-uinstanceid]").on("click","[data-event=morebtn]",function(){if(0<$(this).closest("div.tc-15-menu-active").length)$(this).parent().removeClass("tc-15-menu-active");else{$(t).find("[data-event=morebtn]").parent().removeClass("tc-15-menu-active");var e=this;setTimeout(function(){$(e).parent().addClass("tc-15-menu-active")},0)}}).on("mouseover","ul.tc-15-dropdown-menu li",function(){$(this).closest("tr").find("ul:gt(0)").hide(),$(this).find("ul").show()});var a=this;t.find("tr[data-uinstanceid]").each(function(e,t){a.refresh($(this),i)})}}}),define("modules/cvm2/event/export/export",function(e,t,i){e("$");var a=e("widget/cvmList/operate_base"),n=e("util"),r=e("appUtil"),s=(e("models/api"),function(e){a.call(this,e)});(s.prototype=new a).exec=function(){for(var e,t=[],i=0;e=this.selectedItems[i];i++)t.push(e.uInstanceId);var a={t:(new Date).getTime(),uin:n.getUin(),csrfCode:n.getACSRFToken(),projectId:r.getProjectId(),regionId:r.getRegionId(),resourceIdList:t},s=n.objectToParams(a);location.href="/cgi/cvm?action=exportCvm&"+s},i.exports=s}),define("modules/cvm2/event/export/exportall",function(e,t,i){e("$"),e("manager");var a=e("widget/cvmList/operate_base"),s=e("util"),n=e("appUtil"),r=function(e){a.call(this,e)};(r.prototype=new a).exec=function(){var e={t:(new Date).getTime(),uin:s.getUin(),csrfCode:s.getACSRFToken(),projectId:n.getProjectId(),regionId:n.getRegionId()},t=s.objectToParams(e);location.href="/cgi/cvm?action=exportCvm&"+t},i.exports=r}),define("modules/cvm2/event/monitor",function(e,t,i){e("constants");var d=e("appUtil"),c=e("reporter"),l=e("modules/cvm/view/monitor");e("panel"),e("router");return{init:function p(e,t){if(!d.getSelectedText()&&(!e.$loading||e.deviceLanIp)){c.click("yunzhuji.line");var i=t,a=i.cvmListEl,s=a.find('tr[data-uinstanceid="'+e.uInstanceId+'"]').attr("data-index"),n=[],r=0,o=0;i.gridView.list.forEach(function(e,t){var i=a.find('tr[data-index="'+t+'"]');i.length&&(i.data("monitor-index",r),n.push(e),t==s&&(o=r),r++)}),l.showList(n,o,function(e){var t=$("#cvmList"),i=t.find('tr[data-uinstanceid="'+e+'"]');i.length&&(t.find("input:checkbox").removeProp("checked"),i.find("input:checkbox").prop("checked","true"))})}}}}),define("modules/cvm2/event/operate_auth",function(e,t,i){var n=e("constants"),a=function(e){this.options=e,this.listIns=e.listIns,this.checkOpsAvailable()};a.prototype={checkOpsAvailable:function(){this.auth={},this.feature={},this.allFeature={},this.multiTypeCvm={hourCvm:!1,cdhCvm:!1};for(var e,t=this.options.dataItems,i=0;e=t[i];i++){var a=e.opsAvailable;e.cvmPayMode===n.CVMPAYMODE.YEARMONTH&&(this.feature.BATCHRETURN=!0),a.DELETE&&(this.auth.DELETE=!0),a.REBOOT&&(this.auth.REBOOT=!0),a.BOOT&&(this.auth.BOOT=!0),a.SHUTDOWN&&(this.auth.SHUTDOWN=!0),a.RESETPW&&(this.auth.RESETPW=!0),a.FORMAT&&(this.auth.FORMAT=!0),a.RENAME&&(this.auth.RENAME=!0),a.CREATEIMG&&(this.auth.CREATEIMG=!0),a.SETBANDWIDTH&&(this.auth.SETBANDWIDTH=!0),a.RESETOS&&(this.auth.RESETOS=!0),a.SNAPSHOT&&(this.auth.SNAPSHOT=!0),a.UPGRADEBANDWIDTH&&(this.auth.UPGRADEBANDWIDTH=!0),a.RENEW&&(this.auth.RENEW=!0),a.UPGRADECONFIG&&(this.auth.UPGRADECONFIG=!0),a.DELIVERKEY&&(this.auth.DELIVERKEY=!0),a.CONNECTVNC&&(this.auth.CONNECTVNC=!0),a.XENTOKVM&&(this.auth.XENTOKVM=!0),"linux"!==e.osType?this.feature.WINDOWS=!0:this.allFeature.WINDOWS=!1,0!==parseInt(e.disk)||e.cbsList.length?this.allFeature.NOSPACE=!1:this.feature.NOSPACE=!0,0<e.vpcId?this.feature.VPC=!0:this.allFeature.VPC=!1,28==e.runflag?this.feature.ISOLATION=!0:this.allFeature.ISOLATION=!1;var s=e.runflag;[1,5,6,19,21,23,24,25,28].indexOf(s)<0&&(this.auth.FIREWALL=!0),4!==e.runflag?this.feature.NONSHUTDOWN=!0:this.allFeature.NONSHUTDOWN=!1,e.cvmPayMode==n.CVMPAYMODE.SECOND?(this.multiTypeCvm.hourCvm=!0,this.feature.CVMSECONDPAY=!0):this.allFeature.CVMSECONDPAY=!1,e.uHostId?(this.multiTypeCvm.cdhCvm=!0,this.feature.CDH_MACHINE=!0):this.allFeature.CDH_MACHINE=!1;!e.ipBlocked&&0<=[0,2,4,6,8,9,13,14,15,17,19,21,23,25,27,29,31,33,35,37,39,41,43,45].indexOf(s)&&(e.eipInfo?this.auth.UNBIND_EIP=!0:this.auth.BIND_EIP=!0),0<e.vpcId&&(this.auth.BIND_ENI=!0,this.auth.UNBIND_ENI=!0),0==e.deviceClass.indexOf("VSFPGA")&&(this.feature.FPGA_MACHINE=!0),0==e.deviceClass.indexOf("VSGPUAMD_2")&&(this.feature.GPUAMD_MACHINE=!0)}this.multiTypeCvm.hourCvm&&this.multiTypeCvm.cdhCvm&&(this.feature.MULTI_CVM=!0)},getAuth:function(){var e=this.options,t=e.dataItems,i=e.operAction;i="string"==typeof i?[i]:i;for(var a,s={},n=0;a=i[n];n++){var r=this.judgment[a];s[a]=r?r.call(this,t):{code:0}}return s},judgment:{alias:function(e){return 0<e.length?this.isOperable("RENAME")?this.enable():this.disable():this.disable("请选择需要改名的服务器")},bandwidthimit:function(e){return e.length<1?this.disable("请选择需要调整网络的服务器"):this.isOperable("SETBANDWIDTH")?this.enable():this.disable()},upgradebandwidth:function(e){if(e.length<1)return this.disable("请选择需要调整网络的服务器");if(!this.listIns.isPrepaidUser||this.listIns.isBandwidthPackageUser)return this.isOperable("SETBANDWIDTH")?this.enable():this.disable();var t=this.getItemsNetworkPayMode();return t.isSame?t.mode==n.NETWORKPAYMODE.FLOW?this.isOperable("SETBANDWIDTH")?this.enable():this.disable():this.isOperableUpBandwith()?this.enable():this.disable():this.enable()},upgradeconfig:function(e){return 1!==e.length?this.disable("请选择需要调整的单台服务器"):this.feature.FPGA_MACHINE?this.disable("暂不支持FPGA机型CPU/内存调整"):this.feature.GPUAMD_MACHINE?this.disable("GPU渲染型GA2目前只支持当前配置售卖，暂不支持调整配置"):this.isOperableUpConfig()?this.enable():this.hasCorrectConfig()?this.disable():this.disable("系统盘和数据盘均为云盘才可调整配置")},upgradedisk:function(e){return 1!==e.length?this.disable("请选择需要调整的单台服务器"):this.isOperableUpDisk()?this.enable():e[0].uHostId?this.disable("独享型云主机只有数据盘为本地盘才可调整磁盘"):this.hasCorrectDisk()?this.disable():this.disable("仅数据盘为云硬盘才支持磁盘扩容")},snapshot:function(e){return 0<e.length?e[0].isSnapAbility?this.enable():this.disable("无法创建快照，请重新选择"):this.disable("请选择需要创建快照的服务器")},destroycvm:function(e){return 0<e.length?this.isOperable("DELETE")?this.hasFeature("MULTI_CVM")?this.disable("不支持独享型云主机和按量计费云主机混合销毁"):this.hasFeature("CDH_MACHINE")?this.enable():1===e.length?this.hasFeature("CVMSECONDPAY")||this.listIns.isCvmRefundUser?this.enable():this.disable("包年包月主机不支持销毁"):this.hasFeature("BATCHRETURN")?this.disable("包年包月主机不支持批量销毁"):this.enable():this.disable():this.disable("请选择需要销毁的服务器")},bindkeypair:function(e){return 0<e.length?this.isOperable("DELIVERKEY")?this.hasAllFeature("WINDOWS")?this.disable("密钥仅支持linux主机"):this.hasAllFeature("VPC")&&!n.SSHKEY_VPC?this.disable("vpc内主机暂不支持密钥"):this.enable():this.disable():this.disable("请选择需要加载密钥的服务器")},boot:function(e){return 0<e.length?this.isOperable("BOOT")?this.enable():this.hasAllFeature("ISOLATION")&&this.hasAllFeature("CVMSECONDPAY")?this.disable("欠费关机，请充值"):this.disable("关机状态的主机才可开机"):this.disable("请选择需要开机的服务器")},changeproject:function(e){return 0<e.length?this.hasAllFeature("ISOLATION")?this.disable():this.hasAllFeature("CDH_MACHINE")?this.disable("独享型云主机不支持分配项目"):this.enable():this.disable("请选择需要分配至项目的服务器")},createimg:function(e){return 1===e.length?this.isOperable("CREATEIMG")?/windows2003/.test(e[0].osName)?this.disable("该服务器系统老旧不支持制作镜像"):this.enable():1===e[0].hypervisor?this.isOperable("XENTOKVM")&&this.listIns.isPrepaidUser?this.enable():this.disable("该服务器架构老旧不支持制作镜像"):this.disable():this.disable("请选择需要制作镜像的单台服务器")},"export":function(e){return 0<e.length?this.enable():this.disable("请选择需要导出的云服务器")},firewall:function(e){return 1==e.length?this.isOperable("FIREWALL")?this.enable():this.disable():this.disable("请选择需要配置安全组的单台服务器")},format:function(e){return 0<e.length?this.isOperable("FORMAT")?this.hasAllFeature("WINDOWS")?this.disable("仅可对linux子机格式化"):this.hasAllFeature("NOSPACE")?this.disable("无数据盘"):this.hasAllFeature("NONSHUTDOWN")?this.disable("关机状态的主机才可格式化"):this.enable():this.disable():this.disable("请选择需要格式化的服务器")},reboot:function(e){return e.length<1?this.disable("请选择需要重启的服务器"):this.isOperable("REBOOT")?this.enable():this.disable("运行中的主机才可重启")},renew:function(e){if(e.length<1)return this.disable("请选择需要续费的服务器");if(this.hasFeature("CVMSECONDPAY"))return this.disable("按量计费主机不支持续费");if(this.hasFeature("CDH_MACHINE"))return this.disable("独享型云主机不支持续费");var t=e[0];return n.ZONEID.GZ1!=t.zoneId||!t.deviceClass||"v1.0.5"!=t.deviceClass.toLowerCase()&&"v1.1"!=t.deviceClass.toLowerCase()?this.isOperable("RENEW")?this.enable():this.disable():this.disable("广州一区共享核机器已下架,请查看公告")},resetos:function(e){return 1===e.length?this.isOperable("RESETOS")?this.enable():this.disable():this.disable("请选择需要重装系统的单台服务器")},resetpwd:function(e){return 0<e.length?this.isOperable("RESETPW")?this.enable():this.disable():this.disable("请选择需要重置密码的服务器")},returncvm:function(e){return 0<e.length?this.isOperable("DELETE")?this.enable():this.disable("运行中、已关机的服务器才可退还"):this.disable("请选择需要退还的服务器")},shutdown:function(e){return 0<e.length?this.isOperable("SHUTDOWN")?this.enable():this.disable("运行中的主机才可关机"):this.disable("请选择需要关机的服务器")},vnc:function(){return this.isOperable("CONNECTVNC")?this.enable():this.disable()},bindEip:function(e){return this.isOperable("BIND_EIP")?this.enable():e&&e[0]&&e[0].ipBlocked?this.disable("当前IP已被安全隔离"):this.disable("已绑定弹性IP，请先解绑")},unbindEip:function(e){return this.isOperable("UNBIND_EIP")?this.enable():e&&e[0]&&e[0].ipBlocked?this.disable("当前IP已被安全隔离"):this.disable("未绑定弹性IP")},bindEni:function(e){return 0<e.length?this.isOperable("BIND_ENI")?this.enable():this.disable("当前主机网络不支持绑定弹性网卡"):this.disable("请选择需要绑定弹性网卡的服务器")},unbindEni:function(e){return 0<e.length?this.isOperable("UNBIND_ENI")?this.enable():this.disable("当前主机网络不支持解绑弹性网卡"):this.disable("请选择需要解绑弹性网卡的服务器")}},isOperableUpBandwith:function(){return this.isOperable("UPGRADEBANDWIDTH")&&!this.listIns.isBandwidthPackageUser},isOperableUpConfig:function(){return this.isOperable("UPGRADECONFIG")&&this.hasCorrectConfig()},isOperableUpDisk:function(){return this.isOperable("UPGRADECONFIG")&&this.hasCorrectDisk()},isOperableOnlineCreateImage:function(){return this.isOperable("CREATEIMG")&&this.listIns.onlineImage},hasCorrectDisk:function(){var e=this.options.dataItems[0],t=!1;if(e.uHostId)return 0<=$.inArray(+e.diskType,n.DISK_CATEGORY.local);0<=$.inArray(+e.diskType,n.DISK_CATEGORY.local)?e.cbsList.length&&(t=!0):1<e.cbsList.length&&(t=!0);return t},hasCorrectConfig:function(){var e=this.options.dataItems[0];if(e.uHostId)return!0;var t=!1;if(e.cbsList)for(var i,a=0;i=e.cbsList[a];a++)"root"==i.diskType&&(t=!0);return t},getItemsNetworkPayMode:function(){var t=[],e=!0;return this.options.dataItems.forEach(function(e){t.indexOf(e.networkPayMode)<0&&t.push(e.networkPayMode)}),1<t.length&&(e=!1),e?{isSame:!0,mode:t[0]||n.NETWORKPAYMODE.YEARMONTH}:{isSame:!1}},enable:function(){return{code:0}},disable:function(e,t){return{code:1,tip:e=e||"当前状态不可进行该操作",reason:t||e}},isOperable:function(e){var t=!1;return!0===this.auth[e]&&(t=!0),t},hasFeature:function(e){var t=!1;return!0===this.feature[e]&&(t=!0),t},hasAllFeature:function(e){var t=!0;return!1===this.allFeature[e]&&(t=!1),t}},i.exports=a}),define("modules/cvm2/event/operate_base",function(w,e,t){var x=w("$"),k=w("manager"),C=w("tips"),a=(w("util"),w("appUtil")),T=w("widget/msg/msg"),o=w("./operate_auth"),s=w("constants"),D=w("widget/operatelog/floattips"),n=w("dialog"),r=w("widget/selectedShow/selectedShow"),i=function(e){e&&(this.listIns=e.listIns,this.button=e.button,this.selectedItems=e.selectedItems)};i.prototype={change:function(e,t,i){this.operateAuth=i;var a=this.operateAuth.getAuth();a[t]&&(0===a[t].code?this.enable():this.disable(a[t].tip))},exec:function(){},refresh:function(e,t,i){this.selectedItems=e||[],this.change(e,t,i)},refreshList:function(e){this.listIns.refresh(e)},disable:function(e,t){this.button.addClass("disabled"),this.setTitle(e),t&&t.call(this)},enable:function(e){this.button.removeClass("disabled"),this.setTitle(),e&&e.call(this)},setTitle:function(e){e=e||"",this.button.attr("data-title",e)},isOperable:function(e){return this.operateAuth.isOperable(e)},hasFeature:function(e){return this.operateAuth.hasFeature(e)},restoreDialogBtn:function(){a.restoreDialogBtn()},selectedItemIsExpire:function(){var e=!1;return 0<this.hasPermItems[0].deadlineInfo.indexOf("status-recover")&&(e=!0),e},isCvmSecondPay:function(){return this.hasPermItems[0].cvmPayMode==s.CVMPAYMODE.SECOND},isNetworkSecondPay:function(){return this.hasPermItems[0].networkPayMode==s.NETWORKPAYMODE.SECOND},isNetworkFlowPay:function(){return this.hasPermItems[0].networkPayMode==s.NETWORKPAYMODE.FLOW},toPay:function(e){var t=s.MANAGE_HOST+"deal/dealsConfirmDirect.php",i={itemDetails:{raw_goodsData:[e]}};a.submitForm(t,i)},toPay2:function(e){var t="https://"+QCBUY_HOST+"/order/check";"[object Array]"!==Object.prototype.toString.call(e)&&(e=[e]);var i={itemDetails:{raw_goodsData:e}};a.submitForm(t,i)},getRootDiskPara:function(){var e=this.hasPermItems[0],t=e.rootType,i="";return 1==t?i="rootDisk":2==t?i="rootCbs":3==t?i="rootSsd":5==t?i="rootCbsSsd":6==t&&(i="rootPCbs"),{key:i,val:e.rootSize}},resolvePerm:function(e,i,t){var a=this,s=[],n=[],r={actionName:t,hasPermItems:[],noPermItems:[]};return e.forEach(function(e){var t=new o({dataItems:[e],operAction:i,listIns:a.listIns}).getAuth();t[i]&&(0===t[i].code?(s.push(e),r.hasPermItems.push({name:e.alias})):(n.push(e),r.noPermItems.push({name:e.alias,reason:t[i].reason})))}),{hasPermItems:s,noPermItems:n,selectedShowOptions:r}},checkTask:function(e,t,a){var s=this,i=e.taskId,n=this.listIns,r=n.gridView,o=n.cvmListEl;if(n.showTask){n.showTask(e,t,a,this)}else{i&&D.showTaskProcessTip({msg:t,business_id:1,task_id:i});var d=function(i){n.userIsDoing&&n.userIsDoing()?s.timeOut=setTimeout(function(){d(i)},3e3):k.getFlowCscResult({taskId:i},function(e){var t=e.status;0===t?(s.refreshList(),T.echo()):2===t?s.timeOut=setTimeout(function(){d(i)},3e3):(!x("#getFlowCscResultErrTip").length&&C.error("操作执行失败"),s.refreshList(),T.echo())},null,a)};if(i){var c='<span class="text-overflow restart">'+t+"</span>";o.find("[data-check-all]").prop("checked",!1);for(var l,p=this.permResult,u=p?p.hasPermItems:this.selectedItems,m=p?p.noPermItems:[],h=0;l=u[h];h++){if(y=l.el){var v=y.attr("data-index");r.$refs.list[v].$set({$loading:!0,$selected:!1}),y.find(".status-col").html(c),n.getSelectedItemData(v).statusDesc=c}else x(".status-tips").html(c);var f="正在执行任务";if(y){(g=n.cvmListEl.find('tr[data-index="'+v+'"]').find(".cvm-oper-cell")).find("> a").addClass("disabled").attr("data-title",f),g.find(".tc-15-dropdown-link").addClass("disabled").attr("data-title",f)}else{var g=x(".cvm-more-opt");x(".cvm-more-opt").attr("data-isloading",!0),g.find(">button").addClass("disabled").attr("data-title",f),x(".tc-15-dropdown-link").addClass("disabled").attr("data-title",f)}}for(var b,I=0;b=m[I];I++){var y;v=(y=b.el).attr("data-index");r.$refs.list[v].$set({$selected:!1})}w.async("widget/cvmList/operate_entry",function(e){e.refresh()}),d(i),this.listIns.clearCheckTask&&this.listIns.clearCheckTask()}}},clearQueryStatus:function(){clearTimeout(this.timeOut)},toConfirmShutdown:function(e){var t={},i=x.Deferred(),a=e.isConfirmBtnNoDisable?0:1,s=new Bee(e.confirmTpl,{$afterInit:function(){e.isConfirmBtnNoDisable||this.$watch("agree",function(e){n.toggleBtnDisable(!e,0)})},$data:{agree:!1}});return t[e.confirmBtnTxt]=function(){i.resolve()},n.create(s.$el,"525","",{title:e.title,preventResubmit:!0,button:t,buttonDisable:[a,0],defaultCancelCb:function(){i.reject()}}),r.render(this.selectedShowOptions),i.promise()},destroy:function(){this.clearQueryStatus()}},t.exports=i}),define("modules/cvm2/event/operate_entry",function(e,t,i){var a={},s={reboot:{name:"重启",module:e("widget/cvmList/reboot/reboot"),hotTag:"yunzhuji.reboot"},boot:{name:"开机",module:e("widget/cvmList/boot/boot"),hotTag:"yunzhuji.turnon"},shutdown:{name:"关机",module:e("widget/cvmList/shutdown/shutdown"),hotTag:"yunzhuji.shutdown"},alias:{name:"重命名",module:e("modules/cvm2/event/alias/alias"),hotTag:"yunzhuji.rename"},resetpwd:{name:"重置密码",module:e("modules/cvm2/event/resetpwd/resetpwd"),hotTag:"yunzhuji.rekey"},format:{name:"格式化",module:e("widget/cvmList/format/format"),hotTag:"yunzhuji.geshi"},renew:{name:"续费",module:e("modules/cvm2/event/renew/renew"),hotTag:"yunzhuji.xufei"},createimg:{name:"制作镜像",module:e("modules/cvm2/event/createimg/createimg"),hotTag:"yunzhuji.zzjingxiang"},upgradebandwidth:{name:"调整带宽",module:e("widget/cvmList/upgradebandwidth/upgradebandwidth"),hotTag:"yunzhuji.upgradebandwidth"},upgradeconfig:{name:"调整配置",module:e("modules/cvm2/event/upgradeconfig/upgradeconfig"),hotTag:"yunzhuji.upgradeconfig"},upgradedisk:{name:"调整磁盘",module:e("modules/cvm2/event/upgradedisk/upgradedisk"),hotTag:"yunzhuji.upgradedisk"},resetos:{name:"重装系统",module:e("modules/cvm2/event/resetos/resetos"),hotTag:"yunzhuji.chongzhuang"},"export":{name:"导出",module:e("modules/cvm2/event/export/export"),hotTag:"yunzhuji.export"},exportall:{name:"导出全部",module:e("modules/cvm2/event/export/exportall"),hotTag:"yunzhuji.exportall"},bindkeypair:{name:"加载密钥",module:e("modules/cvm2/event/bindkeypair/bindkeypair"),hotTag:"yunzhuji.ssh"},returncvm:{name:"退还服务器",module:e("widget/cvmList/returncvm/returncvm"),hotTag:"yunzhuji.tuihuan"},destroycvm:{name:"销毁",module:e("widget/cvmList/destroycvm/destroycvm"),hotTag:"yunzhuji.destroy"},bandwidthimit:{name:"调整带宽",module:e("widget/cvmList/bandwidthimit/bandwidthimit"),hotTag:"yunzhuji.bandwidthimit"},changeproject:{name:"分配至项目",module:e("widget/cvmList/changeproject/changeproject"),hotTag:"yunzhuji.changeproject"},firewall:{name:"配置安全组",module:e("widget/cvmList/firewall/firewall"),hotTag:"yunzhuji.firewall"},wipToEip:{name:"转换为弹性公网IP",module:e("widget/cvmList/eip/wipToEip"),hotTag:"yunzhuji.wipToEip"},bindEip:{name:"绑定弹性公网IP",module:e("widget/cvmList/eip/bindEip"),hotTag:"yunzhuji.bindEip"},unbindEip:{name:"解绑弹性公网IP",module:e("widget/cvmList/eip/unbindEip"),hotTag:"yunzhuji.unbindEip"},bindEni:{name:"绑定弹性网卡",module:e("modules/cvm2/event/bindEni/bindEni"),hotTag:"yunzhuji.bindEni"},unbindEni:{name:"解绑弹性网卡",module:e("modules/cvm2/event/unbindEni/unbindEni"),hotTag:"yunzhuji.unbindEni"},vnc:{name:"登录",module:e("modules/cvm2/event/vnc"),hotTag:"yunzhuji.showvnc"}},n={getModuleArr:function(){var e=[];for(var t in s)e.push(t);return e},getModuleMap:function(){return s},destroy:function(){for(var e in a)a[e].destroy&&a[e].destroy()}};i.exports=n}),define("modules/cvm2/event/renew/renew",function(e,t,i){var o=e("$"),d=e("manager"),a=e("modules/cvm2/event/renew/renew_base"),c=e("dialog"),l=e("util"),p=(e("appUtil"),e("widget/range/range")),u=e("widget/pills/pills"),m=e("widget/selectedShow/selectedShow"),h=e("modules/cvm2/event/renew/renew_batch"),v='<div class="renew-wrapper"><div class="edit_form_wrap">    <ul class="edit_psword">        <li>            <label class="txt" for="">续费时长:</label>            <span class="renewals"></span>            <p class="tip">有效期至<span data-field="validity"><%-expires%></span></p>        </li>        <% if (upgradeBandwidth) { %>        <li>            <label class="txt" for="">调整带宽:</label>            <span class="rerange-ctrl" style="display:none">            <span class="inf">当前带宽<%-bandwidth%>Mbps</span>            <a href="javascript:;" class=\'set-bandwidth\'>调整带宽</a>        </span>            <div class="rerange-wrapper">            <div class="rerange-inner-wrapper"></div>            <span style="color:#ff7a22">调整后的带宽将于<%- deadlineNext %>之后生效</span>                    <p class="datetime-tips" id="buyEipTips" style="display: none;"></p>            </div>            <p class="tip"></p>        </li>        <% } %>        <li>            <label class="txt" for="" data-field="pricetitle">费用:</label>            <span class="price"><span data-field="cost"></span><em>元</em></span>  <span data-discount style="display: none;font-size: 1.2em;"> <span data-field="origin-cost" style="text-decoration: line-through; margin: 0 5px"></span></span>        </li>        <%-activity%>    </ul> </div></div>',s=(QCMAIN_HOST,QCMAIN_HOST,function(e){a.call(this,e)}),n=function(){};n.prototype=a.prototype,((s.prototype=new n).constructor=s).prototype.superclass=a,s.prototype.exec=function(){var t=this;if(1<this.hasPermItems.length){var e=new h({listIns:this.listIns,button:this.button,selectedItems:this.selectedItems});return e.hasPermItems=this.hasPermItems,void e.exec()}var i=this.hasPermItems[0],a=this.isOperable("UPGRADEBANDWIDTH")&&!this.listIns.isBandwidthPackageUser&&!this.isNetworkFlowPay();if(0==i.deviceClass.indexOf("VSHGPU")){var s=this.getTimeSpanData(!0),n=3;s[2].active=!0}else n=12,(s=this.getTimeSpanData())[4].active=!0;var r=l.tmpl(v,{expires:this.getExpires(this.hasPermItems[0].deadline,n),upgradeBandwidth:a,bandwidth:i.bandwidth,deadline:i.deadline,deadlineNext:this.getNextDay(),activity:""});c.create(r,"580","",{title:"主机续费",preventResubmit:!0,button:{"确定":function(){t.toRenew(t.collectData())}}}),m.render(this.selectedShowOptions),this.wrapper=c.el.find(".renew-wrapper"),this.renewals=this.wrapper.find(".renewals"),this.timePills=new u({renderTo:this.renewals,data:s,change:function(){var e=this.val();t.wrapper.find('[data-field="validity"]').html(t.getExpires(t.hasPermItems[0].deadline,parseInt(e))),t.setPrice()}}),a?(this.rerangeCtrl=this.wrapper.find(".rerange-ctrl"),this.setBandwidth=this.rerangeCtrl.find(".set-bandwidth"),this.rerangeWrapper=this.wrapper.find(".rerange-wrapper"),this.rerangeInnerWrapper=this.rerangeWrapper.find(".rerange-inner-wrapper"),1==i.networkPayMode?this.bandWidthRange=new p({renderTo:this.rerangeInnerWrapper,value:65535==i.bandwidth?0:i.bandwidth,min:0,max:200,unit:"Mbps",section:[{value:20,width:75},{value:50,width:150},{value:100,width:225},{value:200,width:300}],step:1,change:function(){t.showBuyEipTips(t.bandWidthRange.val()),t.setPrice()}}):this.bandWidthRange=new p({renderTo:this.rerangeInnerWrapper,value:65535==i.bandwidth?0:i.bandwidth,change:function(){t.setPrice()}})):this.bandWidthRange=null,this.bindEvt(),t.setPrice(),d.getComData(function(e){e.isAgentClient||e.isAgentClient||o("#actLink99").show()})},s.prototype.bindEvt=function(){var e=this;this.bandWidthRange&&this.setBandwidth.on("click",function(){e.rerangeCtrl.hide(),e.rerangeWrapper.show()})},s.prototype.setPrice=function(){var n=this,e=this.collectData();this.superclass.prototype.setPrice({goodsDetail:e},function(e){var t=e[0].totalCost/100,i=e[0].realTotalCost/100,a=n.wrapper.find('[data-field="cost"]'),s=n.wrapper.find("[data-discount]");a.html(i),t&&t!==i?(n.wrapper.find('[data-field="origin-cost"]').html(t+" 元 "),n.wrapper.find("[data-field=pricetitle]").text("优惠价:"),s.show()):(n.wrapper.find("[data-field=pricetitle]").text("费用:"),s.hide())})},i.exports=s}),define("modules/cvm2/event/renew/renew_base",function(e,t,i){var r=e("$"),a=e("manager"),s=e("modules/cvm2/event/operate_base"),o=e("appUtil"),n=function(e){e=r.extend({},{listIns:{},button:r(),selectedItems:[]},e),s.call(this,e)},d=function(){};d.prototype=s.prototype,((n.prototype=new d).constructor=n).prototype.setPrice=function(e,t){a.getPrice(e,t)},n.prototype.toRenew=function(e){this.toPay2(e)},n.prototype.getNextDay=function(){var e=this.hasPermItems[0].deadline;if(!e)return"";e=e.replace(/\-/g,"/");var t=new Date(new Date(e).getTime()+864e5);return o.formatDate(t,"yyyy-MM-dd")+" 00:00:00"},n.prototype.getExpires=function(e,t){return a.getNextDate(e.replace(/\-/g,"/"),parseInt(t))},n.prototype.getInputData=function(){this.hasPermItems[0];var e,t=this.timePills.val();return this.bandWidthRange&&(e=this.bandWidthRange.val()),this.listIns.isBandwidthPackageUser&&(e=65535),{bandwidth:e&&parseInt(e),timespan:t}},n.prototype.collectData=function(a){var s=this,n=[];return a=a||this.getInputData(),!s.listIns.isBandwidthPackageUser&&200<a.bandwidth&&(a.bandwidth=200),r(this.hasPermItems).each(function(e,t){if(!t.uHostId){var i={goodsCategoryId:100020,appId:o.getAppId(),projectId:t.projectId,regionId:o.getRegionId(),zoneId:t.zoneId,goodsNum:1,payMode:t.cvmPayMode,goodsDetail:{productInfo:[{name:"项目",value:t.projectName},{name:"主机名",value:t.uInstanceId},{name:"内网IP",value:t.deviceLanIp},{name:"所属网络",value:t.netName},{name:"可用区",value:t.zoneName}],curDeadline:t.deadline,timeSpan:parseInt(a.timespan),timeUnit:"m",resourceId:t.uInstanceId}};1!=t.networkPayMode||s.listIns.isBandwidthPackageUser||(i.goodsDetail.oldBandwidth=t.bandwidth,"undefined"!=typeof a.bandwidth?i.goodsDetail.bandwidth=a.bandwidth:i.goodsDetail.bandwidth=t.bandwidth,i.goodsDetail.productInfo.push({name:"带宽",value:i.goodsDetail.oldBandwidth+"=>"+i.goodsDetail.bandwidth})),n.push(i)}}),n},n.prototype.getTimeSpanData=function(e){if(e){for(var t=[],i=1;i<6;i++)t.push({name:i+"个月",value:i});return t}for(t=[],i=1;i<=3;i++)t.push({name:i+"个月",value:i});return t.concat([{name:"半年",value:"6"},{name:"1年",value:"12",ico:"ico ico_join"},{name:"2年",value:"24",ico:"ico ico_join"},{name:"3年",value:"36",ico:"ico ico_join"}])},n.prototype.showBuyEipTips=function(e){if(0!=e){for(var t,i=!1,a=0;t=this.hasPermItems[a];a++)if(!(0!=t.bandwidth||t.ipConfig&&t.ipConfig.deviceWanIp)){i=!0;break}if(i){var s="";s=1==this.hasPermItems.length?"该":"存在",s+='主机没有购买外网IP，您可绑定<a target="_blank" href="https://console.qcloud.com/cvm/eip">弹性公网IP</a>访问外网。弹性公网IP绑定主机后不收费。',0<r("#buyEipTips").length&&r("#buyEipTips").html(s).show()}}},i.exports=n}),define("modules/cvm2/event/renew/renew_batch",function(e,t,i){var s=e("$"),n=e("tips"),a=e("manager"),r=e("modules/cvm2/event/renew/renew_base"),o=e("dialog"),d=e("util"),c=e("appUtil"),l=(e("widget/range/range"),e("widget/pills/pills")),p=(e("constants"),e("qccomponent")),u='    <div class="renewal-wrap">    <ul class="form-list renewal-form"><li><div class="form-label"><span class="label">购买时长</span></div><div class="form-input"><span class="renewals"></span></div></li>    </ul>        <div class="renewal-hints">            <p><strong>下列设备（共<%=len%>项）将进行续费操作</strong></p>        </div>        <div id="renewList" style="position:relative;"></div>\x3c!-- 总价 --\x3e<div class="total-price clearfix">  <div class="pull-left"><label>  <input type="checkbox" class="tc-15-checkbox setAutoRenewal">  账户余额足够时，实例到期后按月自动续费</label>  </div>  <div class="pull-right"><em class="gray-text">总计费用</em>&nbsp;&nbsp;<span class="org-text" id="loading">  正在计算价格<span class="percent"></span>...</span><span title="优惠价"><span style="display:none;" class="cost"><span id="realcost"></span><em>元</em></span><span style="display:none;text-decoration:line-through;margin-left:10px;color:#74777c;" title="原价">  <span id="totalCost"></span><em>元</em></span>  </div></div>    </div>',m=function(e){r.call(this,e)},h=function(){};h.prototype=r.prototype,((m.prototype=new h).constructor=m).prototype.superclass=r,m.prototype.exec=function(){if(this.check()){var i=this,e=d.tmpl(u,{len:this.hasPermItems.length});o.create(e,"800","",{title:"批量续费",preventResubmit:!0,button:{"确定":function(){var e=a.prop("checked"),t=i.getInputData();e?i.setRenewalFlag().done(function(){i.toRenew(i.collectData(t))}):i.toRenew(i.collectData(t))}}}),this.wrapper=o.el.find(".renewal-wrap"),this.renewals=this.wrapper.find(".renewals");var t,a=o.el.find(".setAutoRenewal");0==i.hasPermItems[0].deviceClass.indexOf("VSHGPU")?(t=i.getTimeSpanData(!0))[2].active=!0:(t=i.getTimeSpanData())[4].active=!0,i.timePills=new l({renderTo:i.renewals,data:t,change:function(){i.refreshDevice()}}),this.renderDeviceList(),this.bandWidthRange=null}},m.prototype.setRenewalFlag=function(){var t=[];this.hasPermItems.forEach(function(e){t.push(e.uuid)});var e={operateUin:d.getUin(),appId:c.getAppId(),uuids:t,autoRenewFlag:1},i=s.Deferred();return a.setRenewFlag(e,function(e){i.resolve(e)},function(e){i.reject(e)}),i},m.prototype.check=function(){for(var e=this.hasPermItems,t=!1,i=!1,a=0;a<e.length;a++)if(0==e[a].deviceClass.indexOf("VSHGPU")){if(i)return n.flash("不支持GPU机型和其他机型混合续费"),!1;t=!0}else{if(t)return n.flash("不支持GPU机型和其他机型混合续费"),!1;i=!0}return!(100<e.length)||(n.flash("一次最多支持100台云主机批量续费"),!1)},m.prototype.renderDeviceList=function(){var a=this,e={$data:{showPagination:!1,showState:!1,canSelectTotal:!1,hasFirst:!1,maxHeight:150,minHeight:"auto",colums:[{key:"alias",name:"待续费项",minWidth:200,tdTpl:'<div><div><p class="text-overflow">云服务器：{{item.alias}}</p><p class="text-overflow text-weak">所属网络：{{item.netName}}，内网IP：{{item.deviceLanIp}}</p></div></div>'},{key:"bandwidth",name:"续费带宽",width:75},{key:"deadline",name:"到期时间",width:150},{key:"nextLine",name:"续费后到期时间",width:200,minWidth:150}],autoMaxHeight:!1,maxHeightOffset:10},getCellContent:function(e,t,i){return"bandwidth"==i.key?"<div>"+t.bandwidthInfo+"</div>":"deadline"==i.key?t.uHostId?"<div>不计费</div>":"<div>"+c.formatDate(new Date(t.deadline.replace(/\-/g,"/")),"yyyy-MM-dd")+"</div>":"nextLine"==i.key?t.uHostId?"<div>不计费</div>":'<div class="text-warning">'+a.getExpires(t.deadline,a.getInputData().timespan)+"</div>":void 0},events:{},getData:function(e){}},t=p.getComponent("grid-view");this.gridView=new t(e),s("#renewList").append(this.gridView.$el),this.refreshDevice()},m.prototype.refreshDevice=function(){this.gridView.setData({list:this.hasPermItems}),this.cdhOnly||this.setPrice(),o&&o.center()},m.prototype.setPrice=function(){var e=this.collectData();this.superclass.prototype.setPrice({goodsDetail:e},function(e){s("#ctips").hide();var i=0,a=0;s(e).each(function(e,t){i+=t.realTotalCost-0,a+=t.totalCost-0}),s("#realcost").text(i/100).parent().show(),s("#totalCost").text(a/100).parent().show(),s("#loading").hide()})},i.exports=m}),define("modules/cvm2/event/resetos/ImageDropdown",function(e,t,i){var a=e("qccomponent");i.exports=a.extend({$tpl:'<div><select b-model="value" class="tc-15-select m {{cls}}" b-style="style"><option b-repeat="item in list" value="{{item.value}}" disabled?="item.image.$disabled" title?="item.image.$disabled" selected?="value===item.value">{{item.label}}</option><option b-if="list && !list.length">{{emptyTips}}</option><option b-if="!list">加载中...</option></select></div>',$valuekey:"image",$afterInit:function(){this.$watch("[list, value]",function(){var t,i=this.value,e=this.list||[];(e=e.filter(function(e){return e.image&&!e.image.$disabled})).some(function(e){if(""+e.value==""+i)return t=e.image,!0});var a=this.image||{};t&&a.imgId!==t.imgId&&this.$set("image",t)})}},{defaults:{emptyTips:"您在当前地域没有适合此机器的镜像"}})}),define("modules/cvm2/event/resetos/SSHKeyDropdown",function(e,t,i){var a=e("qccomponent"),d=e("manager"),c=i.exports=a.extend({$valuekey:"value",$tpl:'    <span>        <select b-if="!empty" class="tc-15-select m" b-model="value">            <option b-repeat="item in list" value="{{item.key_id}}">{{item.key_name}}</option>        </select>        <span b-if="empty">您当前没有可选的ssh密钥, <a href="/cvm/sshkey" data-event="nav">现在创建</a></span>    </span>',$afterInit:function(){c.__super__.$afterInit.apply(this,arguments);var s=this,n=[],r=function(i,a){var e=40*(a-1);1==a&&(n=[]),d.queryKeypair({count:40,offset:e,projectId:i},function(e){var t=e.key_list||[];1!=a||t.length||s.$set("empty",!0),n=n.concat(t),o(t),n.length<e.key_total&&r(i,a+1)})},o=function(e){var t=s.list;t||(s.$set("list",[{key_name:"请选择..."}]),t=s.list),t.splice.apply(t,[t.length,0].concat(e))};s.$watch("projectId",function(e){0<=e&&r(e,1)},!0)}},{defaults:{empty:!1}})}),define("modules/cvm2/event/resetos/imageApi",function(e,t,i){var a,s=e("manager"),n=(e("models/api"),e("modules/cvm/image/util")),r=e("models/iaas"),o=n.TYPES;t.queryPublicImage=function(i){return new Promise(function(e,t){s._cacheRequest("queryOs",[{uuid:i}]).then(e,t)}).then(function(e){return e.filter(function(e){return 1===e.flag}).map(function(e){return e._imageType=o.PUBLIC,e.imgId=e.unImgId,e.label=e.desc,e.osName=e.name,e.is32bit=/(32位|32bit)/i.test(e.desc),e})})},t.queryPublicImageMap=function(){return e("widget/getOsName/getOsName").promise.then(function(e){var t={};return e.data.os.forEach(function(e){t[e.name]=e}),t})},t.queryImage=function(e,a){return Promise.all([r.apiRequest({regionId:e,serviceType:"image",cmd:"DescribeImages",data:{status:[2,3],imageType:a,limit:200}}),t.queryPublicImageMap()]).then(function(e){var t=e[0],i=e[1];return(t.imageSet||[]).map(function(e){var t=i[e.osName]||{};return $.extend({},e,{_imageType:a,imgId:e.imageId,label:e.unImgId+"("+e.imageName+")",osType:t.osType||(/Xserver|windows/.test(e.osName)?"windows":"linux"),desc:t.desc,rootSize:parseInt(e.size,10),is32bit:t.is32bit})})})},t.queryMarketCategories=function(){return a||(a=new Promise(function(e,t){s.getImageCategories(e,t)}).then(function(e){return e.map(function(e){return{label:e.name,value:e.categoryId}})}))},t.queryMarketImage=function(i,a){return i?Promise.all([new Promise(function(e,t){s.getImageProductsDetail({regionId:a.regionId,categoryId:i,cputype:a.cpu,memtype:a.mem,count:999,startIndex:0},e,t)}),t.queryPublicImageMap()]).then(function(e){var t=e[0],a=e[1];return t.list.map(function(e){var t=e.imgs&&e.imgs[0]||{},i=a[t.os]||{};return $.extend({_imageType:o.MARKET,unImgId:t.unImgId,imgId:t.itemId,label:e.productName,osType:i.osType||(1==t.osType?"linux":"windows"),osName:t.os,desc:i.desc||t.os,rootSize:+t.spaceRequire,is32bit:i.is32bit},e)})}):Promise.resolve([])}}),define("modules/cvm2/event/resetos/resetos",function(s,e,t){var v=s("$"),f=s("manager"),i=s("modules/cvm2/event/operate_base"),n=s("dialog"),r=s("util"),o=s("appUtil"),g=s("tips"),b=s("reporter"),I=s("config/constants"),a=s("modules/cvm/image/util"),d=s("./imageApi"),c=s("qccomponent"),l=s("./validator"),p=s("widget/page/makeAsyncDialogButton"),y=s("modules/cvm/diskUtil"),u=y.TYPE,m=a.TYPES,h={Password:1,SSH:2,KeepSetting:3},w={isOversea:"_checkOverseasRegion(instance.regionId)",isSupportLargerSystemCbs:"_checkLargerSystemCbs(instance.regionId)",isGpu:'instance.deviceClass.indexOf("VSHGPU") == 0',isFpga:'instance.deviceClass.indexOf("VSFPGA") == 0',isGa:'instance.deviceClass.indexOf("VSGPUAMD") == 0',isLocalDisk:"_checkLocalDisk(instance.rootType)",isCbsDisk:"_checkCloudDisk(instance.rootType)",osType:"instance.osType",isWindows:'osType === "windows"',isLinux:'osType === "linux"',mem:"_getActualMem(instance.mem, instance.deviceClass)",rootSize:"instance.rootSize",targetImage:"_getTargetImage(imageType, publicImage, privateImage, sharedImage, marketImage)",targetOsType:"targetImage.osType",isTargetWindows:'targetOsType === "windows"',isTargetLinux:'targetOsType === "linux"',sysprep:"targetImage.sysprep",isSwitchSystem:"osType !== targetOsType",isOldCbs:"_checkOldCbs(instance.cbsList)",isMiniCvm:"_checkMiniCvm(instance.deviceClass)",isXen:"instance.hypervisor",canXenToKvm:"instance.canUpgradeToKvm",canAdjustDisk:"!policy.fixedRootSize && policy.minRootSize<policy.maxRootSize",loginTypeList:"_getLoginType(targetOsType, imageType, sysprep)",loginName:"_getLoginName(targetOsType, targetImage.osName)",keepCurrentImage:"!imageType",resetFlag:"keepCurrentImage ? 0 : 2"},x={targetImage:{},"true":{freeRootSize:y.FREE_ROOT_SIZE,minRootSize:y.FREE_ROOT_SIZE,maxRootSize:y.FREE_ROOT_SIZE,bottomTip:'<div class="tip_box">注意：重装后，服务器系统盘内的所有数据将被清除，恢复到初始状态；服务器数据盘的数据不会丢失，但需要手动挂载才能使用，具体请参看<a data-event="just_for_hot" data-hot="yunzhuji.chongzhuang.page3_normal.guide" target="_blank" href="{{WikiUrls[osType]}}">操作指引</a></div>'},isSwitchSystem:{confirm:'  <style>.confirmswapos li{padding:5px 0; list-style-type:disc; margin-left: 20px}</style><ul class="confirmswapos"><p>注意：CVM原系统盘为{{capitalize(osType)}}，重装为{{capitalize(targetOsType)}}后，请注意：</p><li>您的原【系统盘】数据会丢失，重装后环境将变为您所选新镜像环境；</li><li>关联的【数据盘】格式仍为{{capitalize(osType)}}系统格式，可使用工具读取【数据盘】数据后，再将盘格式化使用；</li><li b-if="isTargetLinux">相关工具的使用方式：<a href="http://'+QCMAIN_HOST+'/doc/product/213/Windows%E9%87%8D%E8%A3%85%E4%B8%BALinux%E5%90%8E%E8%AF%BB%E5%86%99%E5%8E%9FNTFS%E7%B1%BB%E5%9E%8B%E6%95%B0%E6%8D%AE%E7%9B%98" target="_blank">工具链接</a>；</li><li b-if="isTargetWindows">相关工具的使用方式：<a href="http://'+QCMAIN_HOST+'/doc/product/213/Linux%E9%87%8D%E8%A3%85%E4%B8%BAWindows%E5%90%8E%E8%AF%BB%E5%8F%96%E5%8E%9FEXT%E7%B1%BB%E5%9E%8B%E6%95%B0%E6%8D%AE%E7%9B%98" target="_blank">工具链接</a>；</li></ul>'},isLocalDisk:{fixedRootSize:y.FREE_ROOT_SIZE},"isLocalDisk && isLinux":{imageFilter:function(e){return e._imageType===m.PUBLIC||("linux"===e.osType||"本地盘暂不支持通过此镜像切换操作系统")}},"isLocalDisk && isWindows":{imageFilter:function(e){return e._imageType===m.PUBLIC||("windows"===e.osType||"本地盘暂不支持通过此镜像切换操作系统")}},"mem < 2":{imageFilter:function(e){return!("windows"===e.osType&&"2016"==e.osVersion1)||"Windows 2016需要至少2G内存"}},"isLocalDisk && isLinux && instance.rootSize<=20":{linuxMaxRootSize:20},"isLocalDisk && isLinux && isTargetLinux && instance.rootSize<=20":{fixedRootSize:20},"isLocalDisk && isLinux && isTargetWindows && instance.rootSize<50":{topTip:'检测到当前CVM系统盘为本地盘，暂不允许重装为{{isLinux ? "Windows" : "Linux"}}，如有需求请<a data-event="nav" href="/workorder">提交工单</a>',unsupported:!0},"isCbsDisk && isSupportLargerSystemCbs && whitelists.CBS_rootDisk_500":{maxRootSize:500},"isCbsDisk && isSupportLargerSystemCbs && whitelists.CBS_rootDisk_1024":{maxRootSize:1024},"[instance.rootSize, targetImage.rootSize]":function(){return{minRootSize:Math.max(this.instance.rootSize,this.targetImage&&this.targetImage.rootSize||0)}},"isOldCbs && isTargetWindows":{topTip:'因云盘架构升级，<span style="color:#ff0000;">仅限重装为Linux</span>，重装为Windows需<a data-event="nav" href="/workorder">提工单</a>'},"isOldCbs && isLinux && isTargetWindows":{unsupported:!0},isOversea:{imageTypeFilter:function(e){return e!==m.MARKET}},"isOversea && isSwitchSystem":{topTip:'当前实例为{{capitalize(osType)}}操作系统，由于海外系统版权导致的价格差异，<span style="color:red">无法重装为{{capitalize(targetOsType)}}</span>',unsupported:!0},"!whitelists.windows2003_offline":{imageFilter:function(e){return!/windows2003/i.test(e.osName)||"Windows 2003已下线"}},"instance.zoneId == 100001 && isSwitchSystem":{topTip:'因云盘架构升级，检测到当前CVM为{{capitalize(osType)}}，<span style="color:#ff0000;">仅限重装为{{capitalize(osType)}}</span>，重装为{{capitalize(targetOsType)}}需<a data-event="nav" href="/workorder">提工单</a>',unsupported:!0},"isMiniCvm && [osType]":function(){var t=this.osType;return{imageFilter:function(e){return e.osType===t||"微型机无法更换操作系统"}}},"isXen && [canXenToKvm, imageType]":function(){switch(this.imageType){case m.PRIVATE:case m.SHARED:case m.MARKET:return{curImageTip:"xen子机自定义镜像直接不支持按当前重装",bottomTip:this.canXenToKvm?'<div class="error_tip_box"><p style="margin: 4px 0">该服务器技术架构老旧，要使用{{ImageTypeNames[imageType]}}重装系统，请先<a href="javascript:;" data-hot="yunzhuji.chongzhuang.page3_xen.switch_now" data-event="xenToKvm">置换为新服务器</a>。</p></div>':'<div class="error_tip_box">该服务器暂不支持使用{{ImageTypeNames[imageType]}}重装系统。</div>',unsupported:!0}}},"isOldImageUnavailable && imageType===0":function(){return{curImageTip:"当前镜像"+(0<this.instance.deviceImageId?"已删除":"已下架")}},"mem>4":{imageFilter:function(e){return"windows"===e.osType||!0!==e.is32bit||"32位Linux系统不支持大于4G内存"}},isGpu:{imageFilter:function(){function a(e,t){return function s(e,t,i){i=i||0;if(i>=e.length||i>=t.length)return 0;var a=e[i]-t[i];if(0===a)return s(e,t,i+1);return a}([e.osVersion1,e.osVersion2],t)}return function(e){if(!0===e.is32bit)return"GPU计算型机型不支持32位操作系统";var t,i=(e.osClass||"").toLowerCase();return"centos"===i||/centos/i.test(e.osName)?(t=a(e,[6,4]),isNaN(t)||0<=t||"GPU计算型机型仅支持Centos的6.4以上版本"):"ubuntu"===i||/ubuntu/i.test(e.osName)?(t=a(e,[14,4,1]),isNaN(t)||0===t||0===a(e,[16,4,1])||"GPU计算型机型仅支持Ubuntu Server 14.04.1 LTS或16.04.1 LTS"):"windows"===i||/windows/i.test(e.osName)?(t=a(e,[2008]),isNaN(t)||0===t||0===a(e,[2012])||"GPU计算型机型仅支持Windows 2008或2012"):e._imageType!==m.PUBLIC||"GPU计算型机型不支持此操作系统"}}()},isFpga:{fixedRootSize:100,imageFilter:function(e){if(e._imageType!==m.PUBLIC)return!0;var t=(e.osClass||"").toLowerCase(),i=e.name||"";return("centos"===t||/centos/i.test(e.osName))&&-1!=i.indexOf("fpga")||"FPGA机型不支持此操作系统"}},isGa:{imageFilter:function(e){if(e._imageType!==m.PUBLIC)return!0;if(e._imageType===m.PUBLIC){var t=(e.osClass||"").toLowerCase(),i=e.name||"";if("windows"===t)return-1!=i.indexOf("Xserver V8.1_64")||"GPU渲染型机型不支持此操作系统"}return"GPU渲染型机型不支持此操作系统"}}},k={windowsMax:"policy.windowMaxRootSize || policy.fixedRootSize || policy.maxRootSize",linuxMax:"policy.linuxMaxRootSize || policy.fixedRootSize || policy.maxRootSize",filter:"policy.imageFilter"},C={topTip:T,curImageTip:T,bottomTip:T,unsupported:T,freeRootSize:Math.max,imageTypeFilter:function N(t,i){return function(e){return t(e)&&i(e)}},minRootSize:Math.max,maxRootSize:Math.max,fixedRootSize:T,linuxMaxRootSize:Math.max,imageFilter:function $(i,a){return function(e){var t=a(e);return"string"==typeof t?t||i(e):t&&i(e)}}};function T(e,t){return t}var D,P=c.extend({capitalize:o.capitalize,_checkLocalDisk:function(e){return-1<I.DISK_CATEGORY.local.indexOf(e)},_checkCloudDisk:function(e){return-1<I.DISK_CATEGORY.cloud.indexOf(e)},_checkOverseasRegion:o.isOverseasRegion,_checkLargerSystemCbs:function(e){return-1<I.CBS_LARGER_SYSTEM_DISK_REGION.indexOf(+e)},_getActualMem:function(e,t){return"v1.0.5"===t.toLowerCase()&&(e/=1024),e},_checkOldCbs:function(e){var t,i;return(e||[]).some(function(e){if("xvde"===e.target&&!e.portable)return t=+e.hostBlockSize,i=+e.vmBlockSize,4096===t&&4096===i||512===t&&4096===i})},_checkMiniCvm:function(e){return"v1.1"===(e=(e||"").toLowerCase())||"v1.0.5"===e},assureSelected:function(s,n){var r=this;return function(e){var t,i=r.$get(s),a=e.filter(function(e){return!e.$disabled});return!a.some(function(e){return i===(n?e[n]:e)})&&(t=a[0])&&r.$set(s,n?t[n]:t),e}},$beforeInit:function(){P.__super__.$beforeInit.apply(this,arguments),this._initLogical(),this._initData(),this._preLoad(),this._initEvents()},_initLogical:function(){var p=this;Object.keys(w).forEach(function(e){o.beeBind(p,p,w[e],e)});var u=[],m={},s=function(e,t,i){var a=u[e];if(a!==t&&(v.extend(m,a,t),u[e]=t),!i){var s=Object.keys(m);if(s.length){m={};var n,r,o,d,c=(n=u,(r=s)&&(d={},r.forEach(function(e){d[e]=1})),n.filter(function(e){return e}).forEach(function(a){a&&(o?Object.keys(a).forEach(function(e){if(!d||e in d){var t,i=a[e];e in o&&(t=C[e])&&(i=t(o[e],i)),o[e]=i}}):o=v.extend({},a))}),o||{}),l=p.policy;l||p.$set("policy",l={}),s.forEach(function(e){l[e]!==c[e]&&p.$set("policy."+e,c[e])})}}};Object.keys(x).forEach(function(e,t){var i,a=x[e];v.isPlainObject(a)&&(i=a),p.$watch(e,function(e){s(t,e?i||a.call(p):null,!p.targetImage)},!0)}),this.$set("imagePolicy",{}),Object.keys(k).forEach(function(e){o.beeBind(p,p,k[e],"imagePolicy."+e)})},_initData:function(){var a=this;a.$set("whitelists",{});var e=["windows2003_offline","CBS_rootDisk_500","CBS_rootDisk_1024"];f.queryWhiteList({whiteKey:e},function(t){var i={};e.forEach(function(e){t&&t[e]&&t[e].length&&(i[e]=!0)}),a.$set("whitelists",i)});var t=a.instance;f._cacheRequest("checkResetSys",[{regionId:t.regionId,uuid:t.uuid},function(e){a.$set("isOldImageUnavailable",!e.checkResult)}])},_preLoad:function(){var i=this,a=i.policy&&i.policy.imageTypeFilter;Object.keys(m).forEach(function(e){var t=m[e];if(!a||a(t))switch(t){case m.PUBLIC:i._queryPublicImage();break;case m.PRIVATE:i._queryPrivateImage();break;case m.SHARED:i._querySharedImage();break;case m.MARKET:i._queryMarketCategories().then(function(e){e[0]&&i._queryMarketImage(e[0].value)})}})},_initEvents:function(){this.$watch("resetPwd",function(e){e||(this.$set("resetConfirmPwd",""),this.$set("invalids.resetConfirmPwd",""))})},_getLoginType:function(e,t,i){return[{label:"密码",value:h.Password},{label:"SSH密钥",disabled:"windows"===e,value:h.SSH},{label:"保留镜像设置",disabled:!(t===m.PRIVATE||t===m.SHARED)||"windows"===e&&i,value:h.KeepSetting}].filter(function(e){return!0!==e.disabled})},_getLoginName:function(e,t){var i="root";return"windows"===e?i="Administrator":/ubuntu/i.test(t)&&(i="ubuntu"),i},_getTargetImage:function(e,t,i,a,s){var n=this.instance;switch(this.imageType){case m.PUBLIC:return t;case m.PRIVATE:return i;case m.SHARED:return a;case m.MARKET:return s;default:return{osType:n.osType,rootSize:n.rootSize,osName:n.osName,imgId:n.itemId,unImgId:n.unImgId}}},_imgToOption:function(e){return e.map(function(e){return{value:e.imgId||e.unImgId,label:e.label||e.desc,image:e}})},_filterImageType:function(e,t){return t?e.filter(function(e){return t(e.value)}):e},_cachePromise:function(e,t){var i=this._cache||(this._cache={});return i[e]||(i[e]=t()),i[e]},_filterImage:function(e,a,t){return Promise.resolve(e).then(function(e){return(e=e.filter(function(e){return!t||0===e.desc.indexOf(t)})).forEach(function(e){e.$disabled=function(e){var t="windows"===e.osType?a.windowsMax:a.linuxMax;if(e.rootSize>t)return"镜像大小超出"+t+"G";if(a.filter){var i=a.filter(e);return"string"==typeof i?i:i?"":"不可用"}return""}(e)}),e})},_categoryPublicImage:(D="CentOS,Debian,SUSE,openSUSE,Ubuntu,Windows,FreeBSD,CoreOS".split(","),function(e){return Promise.resolve(e).then(function(e){var t=D.slice(0),s={};return e.forEach(function(i){var a;t.some(function(e,t){if(0===i.desc.toLowerCase().indexOf(e.toLowerCase()))return a=t,s[e]=1,!0})&&t.splice(a,1)}),D.filter(function(e){return e in s}).map(function(e){return{label:e,value:e}})})}),_queryPublicImage:function(){var e=this.instance;return this._cachePromise("public",function(){return d.queryPublicImage(e.uuid)})},_queryPrivateImage:function(){var e=this.instance;return this._cachePromise("private",function(){return d.queryImage(e.regionId,m.PRIVATE)})},_querySharedImage:function(){var e=this.instance;return this._cachePromise("shared",function(){return d.queryImage(e.regionId,m.SHARED)})},_queryMarketCategories:function(){return this._cachePromise("marketCategories",function(){return d.queryMarketCategories()})},_queryMarketImage:function(e){var t=this.instance;return this._cachePromise("market."+e,function(){return d.queryMarketImage(e,t)})},getRootSize:function(){if(this.canAdjustDisk)return this.rootSize;var e=this.policy;return e.fixedRootSize||e.maxRootSize},collectOldDisk:function(){return y.parseFromCvm(this.instance)},collectNewDisk:function(){var e=this.collectOldDisk();return e.root.size=this.getRootSize(),e},collectImage:function(){var e=this.targetImage.imgId,t={};switch(this.imageType){case m.PRIVATE:case m.SHARED:t.deviceImageId=e;break;case m.MARKET:t.itemId=e}return t},collectAgentList:function(){var e=this.agentList||{};return{security:e.security?1:0,monitor:e.monitor?1:0}},collectPassword:function(){var e=this,t={};return e.loginType===h.Password?t.passwd=e.resetPwd:e.loginType===h.SSH?t.keyid=+e.sshKey:e.loginType===h.KeepSetting&&(t.keepImageSetting=1),t},isValid:function(){var i=this;i.$set("invalids",{});var e=["targetImage"];switch(this.loginType){case h.SSH:e.push("sshKey");break;case h.Password:e=e.concat(["resetPwd","resetConfirmPwd"])}var a=i;return!e.some(function(e){var t=l[e](a[e],a);if(t)return i.$set("invalids."+e,t),g.error(t),!0})}},{defaults:{capitalize:o.capitalize,DiskType:u,DiskTypeNames:I.DISKTYPE,WikiUrls:{windows:"https://"+QCMAIN_HOST+"/doc/product/213/2158",linux:"https://"+QCMAIN_HOST+"/doc/product/213/2042"},ImageType:m,ImageTypeNames:a.TYPE_NAMES,imageTypeList:[{label:"当前镜像",value:0}].concat([m.PUBLIC,m.PRIVATE,m.SHARED,m.MARKET].map(function(e){return{label:a.TYPE_NAMES[e],value:e}})),imageType:0,LoginType:h,loginType:h.Password}}),S=c.getComponent("qc-segment");function _(e){return(e||"").toLowerCase()}P.tag("button-bar",S.extend({$valuekey:"value",$afterInit:function(){o.beeBind(this,this,"buttons","list"),S.__super__.$afterInit.apply(this,arguments),this.$on("selected",function(e){e&&e.value!==this.value&&this.$set("value",e.value)}),this.$watch("[buttons, value]",function(){this.toggle({value:this.value})})}},{defaults:{idKey:"value"}})),P.tag("ssh-key-dropdown",s("./SSHKeyDropdown")),P.tag("image-select",s("./ImageDropdown")),P.tag("market-image-select",c.getComponent("qc-select").extend({listTpl:'<li data-item role="presentation" b-repeat="item in list | _filter : filterKey" class="{{selected == item ? \'selected\' : \'\'}} {{item.$disabled ? \'disabled\': \'\'}}" data-title?="item.$disabled"><div class="store-os-item"><div class="os-item-name">{{item.productName}}<span class="mirror-space">({{item.imgs[0].spaceRequire}}GB)</span></div><div class="os-item-desc"><p>操作系统：{{item.desc}}</p><p>集成软件：{{item.imgs[0].software}}</p><p>提供商家：{{item.developer&&item.developer.companyName || ""}}</p></div></div></li>',filterData:function(e,t){return t=_(t),e.filter(function(e){return!t||-1<_(e.label).indexOf(t)})}},{defaults:{filter:!0,styleType:1,cls:"select-os-from-store"}}));var E={main:'<div><style>.select-os-from-store.tc-15-dropdown-btn-style .dropdown-list-wrap .tc-15-dropdown-menu {max-height: 283px;}</style><div id="resetosWrapper"><ul class="form-list"><div b-if="policy.topTip" class="tip_box">{{>policy.topTip}}</div><%#lastSetting%>{{>policy.bottomTip}}</ul></div></div>',lastSetting:'<div class="form-wrap re-install" id="lastSettingWrap"><ul class="form-list"> <li>        <div class="form-label">            <label for="">镜像来源</label>        </div>        <div class="form-input"><button-bar b-model="imageType" buttons="{{_filterImageType(imageTypeList, policy.imageTypeFilter)}}"></button-bar>            <div class="tc-15-rich-radio" role="radiogroup" id="imageSet"></div>        </div>    </li>    <li b-if="imageType===0" class="curImg-li">        <div class="form-label lh-normal">            <label for="">镜像</label>        </div>        <div class="form-input"><div class="mirror-name">{{targetImage.osName}}        {{>policy.curImageTip}}        </div><%#agent%></div>    </li>    <li b-if="imageType === ImageType.PUBLIC" class="commonImg-li">        <div class="form-label lh-normal">            <label for="">操作系统</label>        </div>             <div class="form-input"><button-bar b-model="publicOsCategory" buttons="{{_categoryPublicImage(_filterImage(_queryPublicImage(), imagePolicy)).then(assureSelected(\'publicOsCategory\', \'value\'))}}"></button-bar>            \x3c!--<div class="tc-15-rich-radio" role="radiogroup" id="osSet"></div>--\x3e        </div>    </li>    <li b-if="imageType === ImageType.PUBLIC" class="commonImg-li">        <div class="form-label lh-normal">            <label for="">系统版本</label>                    </div>           <div class="form-input"><image-select b-model="publicImage" list="{{_filterImage(_queryPublicImage(), imagePolicy, publicOsCategory).then(assureSelected(\'publicImage\')).then(_imgToOption)}}" style="width:220px;max-width:220px;"></image-select>        <%#agent%>        </div>         </li>    <li b-if="imageType === ImageType.PRIVATE" class="diyImg-li">        <div class="form-label lh-normal">            <label for="">镜像</label>        </div>        <div class="form-input"><image-select b-model="privateImage" list="{{_filterImage(_queryPrivateImage(), imagePolicy).then(assureSelected(\'privateImage\')).then(_imgToOption)}}" style="width:220px;max-width:220px;"></image-select>        <%#agent%>        </div>              </li><li b-if="imageType === ImageType.SHARED" class="sharedImg-li"><div class="form-label lh-normal"><label for="">镜像</label></div><div class="form-input"><image-select b-model="sharedImage" list="{{_filterImage(_querySharedImage(), imagePolicy).then(assureSelected(\'sharedImage\')).then(_imgToOption)}}" style="width:220px;max-width:220px;"></image-select><%#agent%></div></li>    <li b-if="imageType === ImageType.MARKET" class="marketImg-li">        <div class="form-label lh-normal">            <label for="">镜像</label>        </div>           <div class="form-input"><button-bar b-model="marketOsCategory" buttons="{{_queryMarketCategories().then(assureSelected(\'marketOsCategory\', \'value\'))}}"></button-bar><div>        <market-image-select b-model="marketImage" list="{{_filterImage(_queryMarketImage(marketOsCategory), imagePolicy).then(assureSelected(\'marketImage\'))}}"></market-image-select></div>        <%#agent%>        </div>                 </li>    <li class="sysdiskoption-li"><div class="form-label lh-normal"><label for="">系统盘</label></div><div b-if="!canAdjustDisk" class="form-input">{{policy.fixedRootSize || policy.maxRootSize}}GB <span class="inline-help-text text-weak">（{{DiskTypeNames[instance.rootType]}}）</span><span><a href="http://'+QCMAIN_HOST+'/doc/product/213/%E7%B3%BB%E7%BB%9F%E7%9B%98%E6%89%A9%E5%AE%B9%E7%9B%B8%E5%85%B3%E9%97%AE%E9%A2%98" target="_blank">系统盘扩容介绍</a></span></div><div b-if="canAdjustDisk" class="form-input"><slider-range b-model="rootSize" min="{{policy.minRootSize}}" max="{{policy.maxRootSize}}" unit="GB"></slider-range><span><a href="http://'+QCMAIN_HOST+'/doc/product/213/%E7%B3%BB%E7%BB%9F%E7%9B%98%E6%89%A9%E5%AE%B9%E7%9B%B8%E5%85%B3%E9%97%AE%E9%A2%98" target="_blank">系统盘扩容介绍</a></span></div></li><li id="loginArea">        <div class="form-label">            <label for="">登录设置</label>        </div>        <div class="form-input"><button-bar b-model="loginType" buttons="{{assureSelected(\'loginType\', \'value\')(loginTypeList)}}"></button-bar>            <div class="tc-15-rich-radio" role="radiogroup" id="loginSet">            </div>        </div>    </li>    <li b-if="loginType === LoginType.SSH" class="sshKey-li">        <div class="form-label">            <label for="">SSH密码</label>        </div>        <div class="form-input">            \x3c!--<select class="tc-15-select m" id="sshkeySelect"></select>--\x3e<ssh-key-dropdown project-id="{{instance.projectId}}" b-model="sshKey"></ssh-key-dropdown><a href="https://'+QCMAIN_HOST+'/document/product/213/6092" class="inline-help-text links" target="_blank">密钥使用说明</a>        </div>    </li>    <li b-if="loginType === LoginType.Password" class="pwd-li">        <div class="form-label lh-normal">            <label for="">用户名</label>        </div>        <div class="form-input">            <p id="loginUsername">{{loginName}}</p>        </div>    </li>    <li b-if="loginType === LoginType.Password" class="pwd-li">        <div class="form-label">            <label for="">密码</label>        </div>                <form onkeydown="if(event.keyCode==13){return false;}" autocomplete="off">        <div class="form-input">            <div class="form-unit {{invalids.resetPwd ? \'is-error\' : \'\'}}">            <input b-on-input="$set(\'invalids.resetPwd\', \'\')" type="password" id="resetPwd" b-model="resetPwd" class="tc-15-input-text m" placeholder="" autocomplete="new-password">            <b class="icon-valid-flag"></b>            <p class="form-input-help" id="r_errtips">{{invalids.resetPwd}}</p>            </div>        </div>        </form>    </li>    <li b-if="loginType === LoginType.Password && resetPwd" class="pwd-confirm-li">        <div class="form-label">            <label for="">确认密码</label>        </div>        <form onkeydown="if(event.keyCode==13){return false;}" autocomplete="off">        <div class="form-input">            <div class="form-unit {{invalids.resetConfirmPwd ? \'is-error\' : \'\'}}">            <input b-on-input="$set(\'invalids.resetConfirmPwd\', \'\')" type="password" id="resetConfirmPwd" b-model="resetConfirmPwd" class="tc-15-input-text m" placeholder="" autocomplete="new-password">            <b class="icon-valid-flag"></b>            <p class="form-input-help" id="c_errtips">{{invalids.resetConfirmPwd}}</p>            </div>        </div>        </form>    </li>    <li b-if="loginType === LoginType.KeepSetting" class="reserved-image-li">            <div class="d-tbc form-label"><label></label></div>            <div class="d-tbc psw-cell">                <div class="auto-gen-tips" style="margin-top:0">重装后，您可使用自定义镜像内登录信息(密钥/密码)登录</div>                </div>            </li>            \x3c!-- 按量计费 --\x3e            <li b-if="priceMode === \'flow\'" class="payflow-li">        <div class="form-label lh-normal">            <label for="">原配置费用</label>        </div>        <div class="form-input"><i class="n-loading-icon" b-if="oldPriceLoading"></i>            <span b-if="!oldPriceLoading" class="original-cost normal">{{toI18nMoney(oldPrice)}}/小时</span>        </div>    </li>    <li b-if="priceMode === \'flow\'" class="payflow-li">        <div class="form-label lh-normal">            <label for="">新配置费用</label>        </div>        <div class="form-input"><i class="n-loading-icon" b-if="priceLoading"></i>            <span b-if="!priceLoading" class="cost"><strong>{{toI18nMoney(price)}}/小时</strong></span>            <span class="inline-help-text text-weak">新的计费将在重装完成后开始</span>        </div>    </li>    \x3c!-- 补差价 --\x3e    <li b-if="priceMode === \'payoff\'" class="payoff-li">        <div class="form-label lh-normal">            <label for="">应付费用</label>        </div>        <div class="form-input"><i class="n-loading-icon" b-if="priceLoading"></i>            <span b-if="!priceLoading" class="cost">{{toI18nMoney(price)}}</span>            <div b-if="!priceLoading" class="inline-help-text text-weak">            调整后的系统盘将随云主机一起到期，您须补齐相应的差价            <div class="tc-15-bubble-icon tc-15-triangle-align-end">        <i class="tc-icon icon-info-red"></i>        <div class="tc-15-bubble tc-15-bubble-top">            <div class="tc-15-bubble-inner">                <p>云主机将在{{deadline}}到期，截止目前剩余{{restday}}天有效期，需补齐差价{{toI18nMoney(price)}}</p>            </div>        </div>    </div>            </div>        </div>    </li>    \x3c!-- 退费 --\x3e            <li b-if="priceMode === \'payback\'" class="payback-li">        <div class="form-label lh-normal">            <label for="">退还差价</label>        </div>        <div class="form-input"><i class="n-loading-icon" b-if="priceLoading"></i>            <span b-if="!priceLoading" class="cost">{{toI18nMoney(price)}}</span>            <span class="inline-help-text text-weak">            差价将在重装完成后退回你的账户余额            \x3c!-- <div class="tc-15-bubble-icon tc-15-triangle-align-end">        <i class="tc-icon icon-info-red"></i>        <div class="tc-15-bubble tc-15-bubble-top">            <div class="tc-15-bubble-inner">                <p>您已在<span class="dealTime"></span>调整系统盘时新购<span class="dealSize"></span>GB容量，截至目前剩余<span class="dealRestday"></span>天有效期，应退差价¥ <strong class="realCost"></strong></p>            </div>        </div>    </div> --\x3e            </span>        </div>    </li></ul></div>',agent:'        <div class="option-line">    <label class="form-ctrl-label">        <input type="checkbox" id="securityAgentCk" class="tc-15-checkbox" checked="checked" b-model="agentList.security">免费开通DDos防护、WAF和云镜主机防护 <a href="https://'+QCMAIN_HOST+'/product/hs" target="_blank">安全加固介绍</a></label>    </div>    <div class="option-line">    <label class="form-ctrl-label">        <input type="checkbox" id="monitorAgentCk" class="tc-15-checkbox" checked="checked" b-model="agentList.monitor">免费开通云产品监控、分析和实时告警 <a href="https://'+QCMAIN_HOST+'/doc/product/248" target="_blank">云监控介绍</a></label>    </div>'},L=function(e){i.call(this,e)};(L.prototype=new i).exec=function(){var t=this,e=this.hasPermItems[0];if(this.selectedItemIsExpire())return g.error("服务器已过期，请续费");var i=r.tmpl(E.main,{},{lastSetting:E.lastSetting,agent:E.agent});t.$dialog=n.create(i,"730","",{title:"重装系统",preventResubmit:!0,button:p({"开始重装":function(){return b.click("yunzhuji.chongzhuang"),t.reset()}})});var a=t.bee=P.mount(n.contentEl.children()[0],{instance:e,regionId:e.regionId,toI18nMoney:s("widget/i18n").toI18nMoney});a.$watch("[canAdjustDisk, rootSize, targetImage]",o.bufferFn(function(e){t.getPrice(e)},500),!0),a.$watch("policy.unsupported",function(e){var t=!0===e;n.toggleBtnDisable(t)}),setTimeout(function(){n.center()},0)},L.prototype.reset=function(){var e=this,t=e.bee;if(!t.isValid())return!1;var i=t.policy.unsupported;if(i&&i.content&&n.create(new c("<div>"+i.content+"</div>",t.$data).$el,"520","",{title:i.title,button:p(i.button)}),i)return!1;var a=t.policy.confirm;return a?(n.create(new c("<div>"+a+"</div>",t.$data).$el,"520","",{title:"确认重装",preventResubmit:!0,button:p({"确定":function(){return e.sendReq()}})}),!1):e.sendReq()};L.prototype.collectData=function(){var e=this.bee,t=this.hasPermItems[0],i=e.targetImage,a=e.collectNewDisk(),s={modifyMode:"reinstall_os",isWinOs:e.isTargetWindows?1:0,change_root:v.extend({resetFlag:e.resetFlag,osName:i.osName,agentList:e.collectAgentList(),rootSize:a.root.size},e.collectImage(),e.collectPassword()),diskInfo:y.generateOrderParams(a),imageId:e.targetImage.unImgId};return s[y.ROOT_ORDER_PROPERTY_MAP[a.root.type]]=a.root.size,[{goodsCategoryId:100021,appId:o.getAppId(),projectId:t.projectId,regionId:t.regionId,zoneId:t.zoneId,payMode:t.cvmPayMode,goodsNum:1,goodsDetail:{productInfo:[{name:"项目",value:t.projectName},{name:"主机名",value:t.uInstanceId},{name:"内网IP",value:t.deviceLanIp},{name:"所属网络",value:t.netName},{name:"可用区",value:t.zoneName},{name:"磁盘",value:t.rootSize+"=>"+a.root.size},{name:"镜像",value:t.osName+"=>"+i.osName}],newConfig:s,curDeadline:t.deadline,resourceId:t.uInstanceId}}]},L.prototype.collectRefundDetail=function(){var e=this,t=this.hasPermItems[0],i=e.targetImage,a=e.collectOldDisk(),s=e.collectNewDisk(),n={};return n[y.ROOT_ORDER_PROPERTY_MAP[a.root.type]]=a.root.size,v.extend({type:"cvm",subType:"cvmBasicConfig",action:"upgradeCvm",zoneId:t.zoneId,curDeadline:t.deadline,uuid:t.uuid,lanIp:t.deviceLanIp,vpcId:t.vpcId,subnetId:t.subnetId,isVpcGateway:t.isVpcGateway,networkPayMode:t.networkPayMode,resetFlag:e.resetFlag,agentList:e.collectAgentList(),rootSize:s.root.size,productInfo:[{name:"系统盘",value:a.root.size+"=>"+s.root.size}],parts:{os:i.osName,bandwidth:t.bandwidth,cpu:t.cpu,mem:t.mem,diskInfo:y.generateOrderParams(s)},returnParts:n},e.collectImage(),e.collectPassword())},L.prototype.collectRefundData=function(){var e=this.hasPermItems[0];return[{goodsCategoryId:78,appId:o.getAppId(),projectId:e.projectId,regionId:e.regionId,zoneId:e.zoneId,payMode:e.cvmPayMode,goodsNum:1,goodsDetail:this.collectRefundDetail()}]},L.prototype.getPrice=function(){var e,a=this.bee,s=this.hasPermItems[0],t=+s.cvmPayMode,n=this,r=n._priceToken={};if(t===I.CVMPAYMODE.YEARMONTH)e=this.collectData(),a.$set({priceMode:"payoff",priceLoading:!0}),f.getPrice({goodsDetail:e},function(e){if(r===n._priceToken){var t=o.cgwTimeParse(s.deadline),i=new Date;a.$set({priceLoading:!1,price:e[0].realTotalCost/100,deadline:o.formatDate(t,"yyyy-MM-dd"),restday:Math.floor((t.getTime()-i.getTime())/864e5)})}});else if(t===I.CVMPAYMODE.SECOND){var i={cpu:s.cpu,mem:s.mem};a.$set({priceMode:"flow",oldPriceLoading:!0,priceLoading:!0}),y.getFlowPid(s.regionId,s.deviceClass).then(function(t){f.getPriceForHour({pid:t,imageId:a.targetImage.unImgId,parts:v.extend({},i,y.generatePriceParams(a.collectOldDisk(),y.FLOW_NO_FREE?0:a.policy.freeRootSize))},function(e){r===n._priceToken&&a.$set({oldPriceLoading:!1,oldPrice:e[t].money.toFixed(2)})}),f.getPriceForHour({pid:t,imageId:a.targetImage.unImgId,parts:v.extend({},i,y.generatePriceParams(a.collectNewDisk(),y.FLOW_NO_FREE?0:a.policy.freeRootSize))},function(e){r===n._priceToken&&a.$set({priceLoading:!1,price:e[t].money.toFixed(2)})})})}},L.prototype.sendReq=function(){var a=this,i=a.bee,s=this.hasPermItems[0],e=i.isWindows&&i.isTargetLinux,t=!i.isWindows&&i.isTargetWindows,n=+s.cvmPayMode;e&&b.click("yunzhuji.chongzhuang.windowstolinux"),t&&b.click("yunzhuji.chongzhuang.linuxtowindows"),v("#payback-li").is(":visible")&&b.click("yunzhuji.chongzhuang.payback");var r=i.collectOldDisk(),o=i.collectNewDisk(),d=i.policy.freeRootSize,c=y.generatePriceParams(r,d),l=y.generatePriceParams(o,d),p=JSON.stringify(c)===JSON.stringify(l),u=i.collectAgentList();if(i.isLocalDisk&&i.isSwitchSystem)return new Promise(function(t,e){f.switchCvmSystem({uuid:s.uuid,osName:i.targetImage.osName,agentList:u},function(e){a.checkTask(e,"重装操作系统中"),t()},e)});if(n===I.CVMPAYMODE.SECOND||n===I.CVMPAYMODE.POSTPAID||p){var m=v.extend({resetFlag:i.resetFlag,osName:i.keepCurrentImage?undefined:i.targetImage.osName,deviceLanIp:s.deviceLanIp,uuid:s.uuid,rootSize:o.root.size,agentList:u},i.collectImage(),i.collectPassword());return new Promise(function(t,i){f.resetCvmSystem(m,function(e){a.checkTask(e,"重装操作系统中"),t()},function(e){e&&9821==e.mccode&&g.error("当前镜像已被删除, 请选择其他镜像! [9821]"),i(e)})})}var h=this.collectData();return a.toPay2(h),new Promise(function(){})},t.exports=L}),define("modules/cvm2/event/resetos/validator",function(e,i,t){var a,s,n,r,o="()`~!@#$%^&*-+=_|{}[]:;'<>,.?/",d="windows机器密码需12到16位，至少包括三项（[a-z],[A-Z],[0-9]和["+o+"]的特殊符号）",c="linux机器密码需8到16位，至少包括两项（[a-z,A-Z],[0-9]和["+o+"]的特殊符号）",l=/^\//,p="不支持“/”置于密码首位",u=o.split("").map(function(e){return"\\"+e}).join("");i.windowsPassword=(a=new RegExp("^[\\da-zA-Z"+u+"]{12,16}$"),s=[/[a-z]+/,/[A-Z]+/,/[0-9]+/,new RegExp("["+u+"]+")],function(t){if(!a.test(t))return d;var i=0;return s.forEach(function(e){t.match(e)&&i++}),i<3?d:l.test(t)?p:void 0}),i.linuxPassword=(n=new RegExp("^[\\da-zA-Z"+u+"]{8,16}$"),r=[/[a-zA-Z]+/,/[0-9]+/,new RegExp("["+u+"]+")],function(t){if(!n.test(t))return c;var i=0;return r.forEach(function(e){t.match(e)&&i++}),i<2?c:l.test(t)?p:void 0}),i.resetPwd=function(e,t){return(e=$.trim(e))?t.isTargetWindows?i.windowsPassword(e):i.linuxPassword(e):"请输入登录密码"},i.resetConfirmPwd=function(e,t){return(e=$.trim(e))?e!==t.resetPwd?"两次密码不一致":void 0:"请输入确认密码"},i.sshKey=function(e,t){if(!e)return"未选择任何密钥"},i.targetImage=function(e){if(!e)return"请选择合适的镜像"}}),define("modules/cvm2/event/resetpwd/resetpwd",function(e,t,i){var m=e("$"),a=e("manager"),s=e("modules/cvm2/event/operate_base"),d=e("validator"),h=e("dialog"),v=(e("tips"),e("util")),f=e("constants"),g=e("widget/selectedShow/selectedShow"),b=e("modules/cvm2/event/upgrade_common"),I='    <div class="form-wrap">        <ul class="form-list">            <li>                <div class="d-tbc form-label"><label>用户名</label></div>                <div class="d-tbc">                    <div class="tc-15-select-wrap m">                        <select class="tc-15-select" id="pwdUserSelect">                            <option value="0">系统默认</option>                            <option value="1">指定用户名</option>                        </select>                    </div>                    <div class="tc-15-input-text-wrap m usr-name">                        <input id="pwdUserIptDefault" class="tc-15-input-text disabled" type="text" disabled="disabled" value="">                        <input id="pwdUserIptCustom" class="tc-15-input-text" type="text" style="display:none">                        <div id="pwdUserIptCustomTip" class="tc-15-input-tips" style="display:none">仅可对系统中已存在的用户进行重置密码操作</div>                    </div>                </div>            </li>            <li>                <div class="d-tbc form-label"><label>新密码</label></div>                <div class="d-tbc">                    <div class="tc-15-input-text-wrap m">                        <input type="password" class="tc-15-input-text">                        <div class="tc-15-input-tips">                            <% if (osSet == 1) { %>                                <%=passwordTip%>                            <% } else if(osSet == 2 || osSet == 4){ %>                                <%=passwordTip%>                            <% } else { %>密码需要12-16个字符，至少包含[a-z]，[A-Z]，[0-9]，[!@#] 中的3种<% } %>                        </div>                    </div>                </div>            </li>            <li>                <div class="d-tbc form-label"><label>确认密码</label></div>                <div class="d-tbc">                    <div class="tc-15-input-text-wrap m">                        <input type="password" class="tc-15-input-text">                    </div>                </div>            </li>            <li>                <div class="d-tbc form-label"><label>验证码</label></div>                <div class="d-tbc">                    <div class="tc-15-input-text-wrap m">                        <input type="text" class="tc-15-input-text">                        <a id="changePwdVcode" href="javascript:;" class="captcha"><img src="<%-vcodeUrl%>"></a>                        <div class="tc-15-input-tips captcha-tips"></div>                    </div>                </div>            </li>        </ul>    </div>',y='    <div class="text-tips">        <p>1、为了避免数据丢失，重置密码需要在<em class="text-danger">关机</em>状态下操作，云服务器将关机中断您的业务，请仔细确认</p>        <p>2、强制关机可能会导致数据丢失或文件系统损坏，您也可以主动关机后进行调整配置</p>        <p>3、强制关机可能需要您等待较长时间，请耐心等待</p>        <p><label class="form-ctrl-label"><input type="checkbox" b-model="agree" class="tc-15-checkbox">同意强制关机</label></p>    </div>',w=f.VCODEURL,c="()`~!@#$%^&*-+=_|{}[]:;'<>,.?/",n=function(e){s.call(this,e)};(n.prototype=new s).exec=function(){var i=this,a=[],s=[],e=!1,n=0,t="",r=this.hasPermItems,o=!0;this.upgradeCommon=new b(this);for(var d,c=0;d=r[c];c++)a.push(d.deviceLanIp),s.push(d.uuid),t="windows"===d.osType?(e=!0,n|=1,"windows机器密码需12到16位，至少包括三项（[a-z],[A-Z],[0-9]和[()`~!@#$%^&*-+=_|{}[]:;'<>,.?/]的特殊符号）"):(!0,/ubuntu/i.test(d.osName)?(!0,n|=4):n|=2,"linux机器密码需8到16位，至少包括两项（[a-z,A-Z],[0-9]和[()`~!@#$%^&*-+=_|{}[]:;'<>,.?/]的特殊符号）"),i.upgradeCommon.isShutdown(r[c].runflag)||(o=!1);var l=v.tmpl(I,{hasWindows:e,osSet:n,passwordTip:t,powerOffWiki:f.POWEROFFWIKI,vcodeUrl:w+"&t="+(new Date).getTime()}),p={shutdown:{"确认重置":function(){var e=i.getInputData();if(i.checkPwdVcode(e,n)){var t={passwd:e.newPwdVal,ipList:a,uuidList:s,vcode:e.vcodeVal};"1"==e.userSelectVal&&(t.user=e.userVal),i.sendReq(t)}}},nonShutdown:{"下一步":function(){var e=i.getInputData();if(i.checkPwdVcode(e,n)){var t={passwd:e.newPwdVal,ipList:a,uuidList:s,vcode:e.vcodeVal,hardPowerOffFlag:1};"1"==e.userSelectVal&&(t.user=e.userVal),i.toConfirmShutdown({confirmTpl:y,title:"重置密码",confirmBtnTxt:"去调整"}).done(function(){i.sendReq(t)})}}}}[o?"shutdown":"nonShutdown"];h.create(l,540,"",{title:"重置密码",preventResubmit:!0,button:p}),g.render(this.selectedShowOptions);var u="root/ubuntu/Administrator";1==n?u="Administrator":4==n?u="ubuntu":2==n&&(u="root"),m("#pwdUserIptDefault").val(u),this.bindEvent()},n.prototype.bindEvent=function(){var e=this;m("#changePwdVcode").click(function(){e.changePwdVcode()}),m("#pwdUserSelect").change(function(){var e=m(this).val(),t=m("#pwdUserIptDefault"),i=m("#pwdUserIptCustom"),a=m("#pwdUserIptCustomTip");"0"==e?(t.show(),i.hide(),a.hide(),a.closest(".tc-15-input-text-wrap").removeClass("error"),a.html("仅可对系统中已存在的用户进行重置密码操作")):(t.hide(),i.show(),a.show())})},n.prototype.changePwdVcode=function(){m("#changePwdVcode").find("img").attr("src",w+"&t="+(new Date).getTime())},n.prototype.getInputData=function(){var e=h.el.find("input"),t=m("#pwdUserSelect"),i=e.eq(1),a=e.eq(2),s=e.eq(3),n=e.eq(4);return{userSelectVal:t.val(),userVal:m.trim(i.val()),newPwdVal:m.trim(a.val()),confirmPwdVal:m.trim(s.val()),vcodeVal:m.trim(n.val())}},n.prototype.checkPwdVcode=function(e,t){var i=h.el.find("input"),a=i.eq(1),s=i.eq(2),n=i.eq(3),r=i.eq(4),o=function(e,t){var i={tip:e,errMode:1};return d.showErr(t,i),!1};return"1"!=e.userSelectVal||e.userVal?e.newPwdVal?e.confirmPwdVal?e.confirmPwdVal!==e.newPwdVal?o("两次密码不一致",n):function(e,t){var i=c.split("").map(function(e){return"\\"+e}).join("");if(1==t){if(!(r=new RegExp("^[\\da-zA-Z"+i+"]{12,16}$")).test(e))return!1;for(var a=[/[a-z]+/,/[A-Z]+/,/[0-9]+/,new RegExp("["+i+"]+")],s=0,n=0;r=a[n];n++)e.match(r)&&s++;return 3<=s}if(2==t||4==t){if(!(r=new RegExp("^[\\da-zA-Z"+i+"]{8,16}$")).test(e))return!1;for(a=[/[a-zA-Z]+/,/[0-9]+/,new RegExp("["+i+"]+")],n=s=0;r=a[n];n++)e.match(r)&&s++;return 2<=s}if(!/^[\da-zA-Z\!\@\#]{12,16}$/.test(e))return!1;var r;for(a=[/[a-z]+/,/[A-Z]+/,/[0-9]+/,/[\!\@\#]+/],s=0,n=0;r=a[n];n++)e.match(r)&&s++;return 3<=s}(e.newPwdVal,t)?"/"==e.newPwdVal[0]?o("不支持“/”置于密码首位",s):!!e.vcodeVal||o("请输入验证码",r):o("密码不符合规范",s):o("请输入确认密码",n):o("请输入新密码",s):o("请输入用户名",a)},n.prototype.sendReq=function(e){var t=this;a.resetCvmPasswd(e,function(e){h.hide(),t.checkTask(e,"密码重置中","password")},function(e){40==e.code&&t.changePwdVcode()})},i.exports=n}),define("modules/cvm2/event/unbindEni/unbindEni",function(e,t,i){var a=e("widget/cvmList/operate_base"),s=e("widget/selectors/EniSelector"),n=e("dialog"),r=e("tips"),o=e("util"),d=(e("constants"),e("cvm/eip2/common/config")),c='    <div class="binding-ip" id="cvmUnbindEni">        <div class="tc-15-option-hd mb10">            <h4 class="mb10">请选择您要解绑的弹性网卡</h4>            <p>弹性网卡解绑后，将保留内网IP、弹性公网IP、安全组的关联关系。</p>              <span>弹性公网IP在解绑后将收取 <span class="text-warning"><money value="{{price}}" format="words"></money>/小时</span> 的费用</span>        </div>        <eni-selector b-ref="eni"  zone-id="{{zoneId}}"  vpc-id="{{vpcId}}" extra-param="{{extraParam}}" search-placeholder="搜索名称、内网IP"></eni-selector>    </div>',l='    <div class="dialog-confirm-box">        <p class="dialog-confirm-title"><i class="<%= iconClassName %>"></i><strong><%= text %></strong></p>        <p class="dialog-confirm-text"><%= desc %></p>      </div>',p={0:{text:"解绑成功",desc:"您的弹性网卡已经绑定成。接下来，还需要登录云主机并进行配置后才能生效。具体配置方法可查看文档。",className:"succeed",iconClassName:"m-success-icon"}},u=Bee.extend({$tpl:c});u.tag("eni-selector",s.extend({parseData:function(e){return e.list.forEach(function(e){e.ipNum=e.privateIpAddressesSet.length,e.primary&&(e.$disable=!0,e.$disableTips="主网卡不可解绑")}),e}},{defaults:$.extend({},s.defaults,{checkType:"radio",colums:[{name:"网卡ID/名称",key:"networkInterfaceName",tdTpl:'<p><span class="text-overflow">{{item.networkInterfaceId}}</span></a></p><span class="text-overflow m-width">{{item.eniName}}</span>'},{name:"所属子网",key:"subnetId"},{name:"网卡IP数",key:"ipNum"}]})}));var m=function(e){a.call(this,e)};(m.prototype=new a).exec=function(){var t=this;this.doAction({regionId:this.hasPermItems[0].regionId,instanceId:this.hasPermItems[0].uInstanceId,zoneId:this.hasPermItems[0].zoneId,vpcId:this.hasPermItems[0].unVpcId}).then(function(e){(e=(e||{}).data)&&e.taskId&&t.checkTask(e,"解绑弹性网卡中")},function(){})},m.prototype.doAction=function(a){var s=this,e=this.bee=new u({$data:{price:d.EIP_REGION_PRICE[a.regionId].price,zoneId:a.zoneId,extraParam:{instanceId:a.instanceId,hideSecondary:0,limit:999,vpcId:a.vpcId}}});return new Promise(function(t,i){n.create(e.$el,720,"",{title:"解绑弹性网卡",defaultCancelCb:function(){e.$destroy(),i()},button:{"确定":function(){var e=(s.bee.$refs.eni.currentItem||{}).networkInterfaceId;s.sendReq({instanceId:a.instanceId,vpcId:a.vpcId,networkInterfaceId:e}).then(function(e){n.hide(),t(e)},i)}},preventResubmit:!0})})},m.prototype.sendReq=function(a){var s=this;return new Promise(function(t,i){a&&a.networkInterfaceId?nmcLoad("vpc2.js",function(){e.async("modules/vpc/eni/model",function(e){e.DetachNetworkInterface({vpcId:a.vpcId,networkInterfaceId:a.networkInterfaceId,instanceId:a.instanceId},{tipErr:!1}).then(function(e){s.displayTip(e).then(t)},function(e){s.displayTip(e).then(i)})})}):t()})},m.prototype.displayTip=function(i){var a=p[i.code];return new Promise(function(e,t){0==i.code?e(i):a?n.create(o.tmpl(l,{text:a.text,desc:a.desc,iconClassName:a.iconClassName}),500,"",{struct:"rich",closeIcon:!1,defaultCancelBtn:!1,button:{"确定":function(){n.hide(),e(i)}}}):(r.error(i.msg),e())})},i.exports=m}),define("modules/cvm2/event/upgrade_common",function(e,t,i){var n=e("manager"),a=e("tips"),c=e("appUtil"),l=e("dialog"),s=e("router"),r=e("reporter"),o=e("modules/cvm/diskUtil"),d=function(e){this.ins=e,this.selectedItem=e.hasPermItems[0],this.yearmonthPriceData={},this.hourPriceData={}};d.prototype={getInputData:function(){var e=this.selectedItem,t=this.ins,i=t.cpuPills?t.cpuPills.val():e.cpu,a=t.memPills?t.memPills.val():e.mem,s=t.cbsRange?t.cbsRange.val():this.getCbsSize(),n=t.bandWidthRange?parseInt(t.bandWidthRange.val()):undefined,r=e.disk,o=e.diskType,d=e.deviceWanIp?1:0,c=0;3==e.diskType&&(c=r,r=0);var l={cpu:parseInt(i),mem:parseInt(a),cbsSize:parseInt(s),bandwidth:n,diskType:o,disk:r,wanIp:d,ssd:c};return this.setRootPara(l),l},getCbsSize:function(e){var t=this.selectedItem,i=0;if(e){for(var a=0;s=t.cbsList[a];a++)if(s.cbsInstanceId==e){i=s.diskSize;break}}else{var s;for(a=0;s=t.cbsList[a];a++)s.diskType&&"data"!==s.diskType||1==s.portable||(i+=s.diskSize)}return i},setRootPara:function(e){var t=this.ins,i=(this.selectedItem,t.getRootDiskPara());if(i.key){var a=o.FLOW_NO_FREE?0:o.FREE_ROOT_SIZE;e[i.key]=Math.max(0,i.val-a)}for(var s=["rootDisk","rootCbs","rootSsd","rootCbsSsd"],n=0,r=s.length;n<r;n++)s[n]!=i.key&&(e[s[n]]=0)},getPrice:function(e){var t=this;n.getPrice({goodsDetail:e},function(e){t.setPriceUI(e,{})})},getPriceForHour:function(t,e,i){var a=this,s=$.Deferred();return n.getPriceForHour({pid:t,parts:e},function(e){a.setPriceUIForHour(t,e,i),a.hourPriceData[t]=e[t]||{},s.resolve()},s.reject),s},setPriceUI:function(e,t){var i=this.ins.wrapper||$("body"),a=i[0].bee,s=e[0].totalCost/100,n=e[0].realTotalCost/100,r=i.find('[data-field="cost"]'),o=i.find("[data-discount]");if($(".cost-li").show(),r.html(Math.abs(n)),a&&a.$set("cost",Math.abs(n)),this.upgradePrice=Math.abs(n),$(".deadline-li").hide(),e[0].newDeadline){$(".cost-li").hide(),$(".deadline-li").show(),$(".curDeadline").html(this.selectedItem.deadline),$(".targetDeadline").html(e[0].newDeadline),$(".oldC").html(this.selectedItem.cpu),$(".oldM").html(this.selectedItem.mem),$(".newC").html(t.cpu),$(".newM").html(t.mem);var d=(e[0].downGradeCvmCost/100).toFixed(2);0<d?($(".realCost").html("补差价"+d),a&&a.$set("realCost","补差价"+d),$(".payback-tag").hide(),$(".payoff-tag").show()):($(".realCost").html("退差价"+Math.abs(d)),a&&a.$set("realCost","退差价"+Math.abs(d)),$(".payback-tag").show(),$(".payoff-tag").hide(),$(".oldDate").html(this.getYearMonthDay(this.selectedItem.deadline)),$(".newDate").html(this.getYearMonthDay(e[0].newDeadline))),this.getActionsLimit(c.getRegionId(),"upgradecvm",this.selectedItem.uInstanceId).then(function(e){var t=(e=e||{maxCount:0,currCount:0}).maxCount-e.currCount;$(".maxCount").html(e.maxCount),$(".leftCount").html(t),0==t?l.toggleBtnDisable(!0):l.toggleBtnDisable(!1)})}else l.toggleBtnDisable(!1);s&&s!==n?(i.find('[data-field="origin-cost"]').html(s),a&&a.$set("originCost",s),i.find('[data-field="pricetitle"]').text("优惠价"),o.show()):(i.find('[data-field="pricetitle"]').text("需支付费用"),o.hide())},getYearMonthDay:function(e){-1!=e.indexOf(" ")&&(e=e.split(" ")[0]);/(\-)/.exec(e);return e.replace(RegExp.$1,"年").replace(RegExp.$1,"月").concat("日")},setPriceUIForHour:function(e,t,i){var a=this.ins.wrapper||$("body"),s=a[0].bee,n=(t=t[e]||{}).money.toFixed(2),r=a.find('[data-field="cost"]'),o=a.find('[data-field="orig-config-cost"]');i?(o.html(n),r.html(n),s&&s.$set({cost:n,origConfigCost:n})):(r.html(n),s&&s.$set({cost:n})),this.upgradePrice=n,l&&l.toggleBtnDisable(!1)},getPriceParaForReduce:function(e,t){for(var i,a,s,n,r,o=this.selectedItem,d={},c=0;r=o.cbsList[c];c++)"root"===r.diskType&&(i=r.target,s=r.diskSize),"data"===r.diskType&&(a=r.target,n=r.diskSize);return d.os=o.osValue,d.bandwidth=o.bandwidth,d.cpu=e,d.mem=t,d.diskInfo={root:{target:i,type:o.rootType,size:s||o.rootSize},data:[{target:a,type:o.diskType,size:n||o.diskSize}]},{type:"cvm",subType:"cvmBasicConfig",action:"upgradeCvm",lanIp:o.deviceLanIp,uuid:o.uuid,curDeadline:o.deadline,vpcId:o.vpcId,subnetId:o.subnetId,isVpcGateway:o.isVpcGateway,networkPayMode:o.networkPayMode,returnParts:{cpu:o.cpu,mem:o.mem},parts:d}},getPriceParaForConfig:function(e){var t,i=this.selectedItem,a=this.getInputData(),s={};s.upgradeCpu=a.cpu,s.oldCpu=i.cpu,s.upgradeCvmConfig=1,s.upgradeMem=a.mem,s.oldMem=i.mem,s.upgradeCvmConfig=1;for(var n,r=0;n=i.cbsList[r];r++)if("data"===n.diskType&&1!=n.portable){t=n.target;break}return s.upgradeDiskInfo={data:[{target:t,type:i.diskType,size:a.cbsSize}]},s.oldDiskInfo={data:[{target:t,type:i.diskType,size:this.getCbsSize(e)}]},s.upgradeCvmConfig=1,{type:"cvm",subType:"cvmBasicConfig",action:"upgradeCvm",lanIp:i.deviceLanIp,uuid:i.uuid,curDeadline:i.deadline,vpcId:i.vpcId,subnetId:i.subnetId,isVpcGateway:i.isVpcGateway,networkPayMode:i.networkPayMode,parts:s}},getBandwidthPricePid:function(){return 1e4},getConfigPricePid:function(e){var t=this.selectedItem;return o.getFlowPid(t.regionId,this.getDeviceClass(t,e))},getDeviceClass:function(e,t){var i=e.deviceClass;return-1<i.indexOf("VSELF_3")&&(i=i+"_"+t.cpu+"C"+t.mem+"G",-1==["VSELF_3_1C1G","VSELF_3_1C2G"].indexOf(i)&&(i=e.deviceClass)),i},checkSecondModeEnoughPay:function(){var s=this,t=new Promise(function(i){n.getMargin(function(e){var t=e.realBalance;i(t/100)})}),i=new Promise(function(i){s.getConfigPricePid().then(function(t){if(s.hourPriceData[t])i(s.hourPriceData[t].money);else{var e=s.getInputData();e.bandwidth=undefined,n.getPriceForHour({pid:t,parts:e},function(e){e=e[t]||{},i(e.money)})}})});return new Promise(function(a){var e=[t,i];s.ins.isNetworkSecondPay()&&e.push(new Promise(function(t){var i=s.getBandwidthPricePid();if(s.hourPriceData[i])t(s.hourPriceData[i].money);else{var e=s.getInputData();n.getPriceForHour({pid:i,parts:{bandwidth:e.bandwidth||s.selectedItem.bandwidth}},function(e){e=e[i]||{},t(e.money)})}})),Promise.all(e).then(function(e){var t=e[0],i=e[2]?e[1]+e[2]:e[1];a(i<=t)})})},showNotEnoughPay:function(e,t){e=e||'<span class="tit">您的余额不足以支撑所有按量付费资源一个小时的消耗，请先充值!</span>',t=t||"余额不足",l.confirm(e,function(){s.navigate("/account/recharge"),r.click("yunzhuji.btn.recharge")},null,{title:t,width:540,mainBtnName:"立即充值"})},toUpgrade:function(e){if(0==this.upgradePrice)return a.error("该升级方案总计费用为0元, 请重新选择"),this.ins.restoreDialogBtn();this.ins.toPay2(e)},isShutdown:function(e){return 4==e},getActionsLimit:function(e,t,i){var a=$.Deferred(),s={action:t,instanceIds:[i]};return n.delegateCApi(e,"cvm","DescribeCvmActionsLimit",s,function(e){e.data&&0<e.data.length?a.resolve(e.data[0]):a.resolve({maxCount:0,currCount:0})},function(e){a.reject(e)}),a}},i.exports=d}),define("modules/cvm2/event/upgradeconfig/cdhupgradeconfig",function(e,t,i){var n=e("$"),a=e("qccomponent"),r=(e("manager"),e("models/cdh")),d=(e("dialog"),e("widget/range/range")),o=e("appUtil"),s=e("widget/cvmList/jsformutil"),c=e("constants"),l=e("modules/cvm/cdh/cdhconfig"),p=a.extend({$tpl:'    <div>        <div class="tc-15-msg">            调整配置后，该服务器的内网IP可能发生变化。        </div>        <div class="form-wrap" style="padding-top: 10px">            <ul class="form-list">                <li>                    <div class="form-label"><label>ID/主机名</label></div>                    <div class="form-input">                    <div class="id-name-cell">                        <p>                            <span class="text-overflow m-width" title="" > {{selectedItem.uInstanceId}} </span>                        </p>                        <div>                            <span class="text-overflow m-width" title="" >{{selectedItem.alias}}</span>                        </div>                    </div>                    </div>                </li>                <li>                    <div class="form-label"><label>原配置</label></div>                    <div class="item-descr-txt">                        <span class="text-overflow m-width" title="" >{{selectedItem.cpu}}核{{selectedItem.mem}}G</span>                    </div>                </li>                <li>                    <div class="form-label"><label>目标CPU核数</label></div>                    <div class="form-input">                        <div data-role="cdhCpuRange" style="width:450px"></div>                    </div>                </li>                <li>                    <div class="form-label"><label>目标内存容量</label></div>                    <div class="form-input">                        <div data-role="cdhMemRange" style="width:450px"></div>                    </div>                </li>\x3c!--                <li>                    <div class="form-label"><label>目标CPU核数</label></div>                    <div class="form-input">                                <span class="item-descr-txt">                                    <ul>                                        <li>                                            <div class="tc-15-rich-radio" role="radiogroup">                                                <button b-repeat="cpuInfo in cpuList" class="{{cpuInfo.value == cpuSelected ?                                                       cpuInfo.value == cpuList[0].value ? \'tc-15-btn first checked m\' :                                                       cpuInfo.value == cpuList[cpuList.length - 1].value ? \'tc-15-btn last checked m\' :                                                       \'tc-15-btn checked m\'                                                       :                                                       cpuInfo.value == cpuList[0].value ? \'tc-15-btn first m\' :                                                       cpuInfo.value == cpuList[cpuList.length - 1].value ? \'tc-15-btn last m\' :                                                       \'tc-15-btn m\'}}" role="radio" b-on-click="setCpuCurrent(cpuInfo.value)" title="">{{cpuInfo.text}}</button>                                            </div>                                        </li>                                    </ul>                                </span>                    </div>                </li>                <li>                    <div class="form-label"><label>目标内存容量</label></div>                    <div class="form-input">                                <span class="item-descr-txt">                                    <ul>                                        <li>                                            <div class="tc-15-rich-radio" role="radiogroup">                                                <button b-repeat="memInfo in memList" class="{{memInfo.value == memSelected ?                                                       memInfo.value == memList[0].value ? \'tc-15-btn first checked m\' :                                                       memInfo.value == memList[memList.length - 1].value ? \'tc-15-btn last checked m\' :                                                       \'tc-15-btn checked m\'                                                       :                                                       memInfo.value == memList[0].value ? \'tc-15-btn first m\' :                                                       memInfo.value == memList[memList.length - 1].value ? \'tc-15-btn last m\' :                                                       \'tc-15-btn m\'}}" role="radio" b-on-click="setMemCurrent(memInfo.value)">{{memInfo.text}}</button>                                            </div>                                        </li>                                    </ul>                                </span>                    </div>                </li>--\x3e            </ul>        </div>    </div>',$beforeInit:function(){},$afterInit:function(){var i=this,a=n(i.$el).find('[data-role="cdhCpuRange"]')[0],s=n(i.$el).find('[data-role="cdhMemRange"]')[0];r.request({name:"getVpsHostList",data:{regionId:o.getRegionId(),uHostIdList:[i.selectedItem.uHostId]},success:function(e){var t=e.hostList[0];i.setSlider(a,s,t)}})},setSlider:function(e,t,i){var a=this,s=+a.selectedItem.cpu,n=+a.selectedItem.mem;a.newCpuSize=+s,a.newMemSize=+n;var r=i.cpuAvailable+a.newCpuSize,o=i.memAvailable+a.newMemSize;a.cpuRange=new d({renderTo:e,value:+s,min:1,max:+r,unit:"核",section:[{value:1,width:1},{value:+r,width:300}],step:1,change:function(e){a.newCpuSize=+e}}),a.memRange=new d({renderTo:t,value:+n,min:1,max:+o,unit:"G",section:[{value:1,width:1},{value:+o,width:300}],step:1,change:function(e){a.newMemSize=+e}})},setMemCurrent:function(e){this.$set("memSelected",e)},setCpuCurrent:function(e){this.$set("cpuSelected",e)},doAction:function(e,t){if(this.newCpuSize!=this.selectedItem.cpu||this.selectedItem.mem!=this.newMemSize){var i=l.NEW_PAY_URL,a=JSON.stringify({raw_goodsData:[this.getUpgradeConfParam(t)]});s.jsFormSender(i,{itemDetails:a},"post","_self"),e.hide()}else e.hide()},getUpgradeConfParam:function(e){var t=this.selectedItem,i={modifyMode:"manual",pid:10555,cpu:+this.newCpuSize,mem:+this.newMemSize,compute:{cpu:+this.newCpuSize,mem:+this.newMemSize},diskInfo:{root:{target:"xvda",type:+t.rootType,size:+t.rootSize},data:{target:"xvdb",type:1,size:+t.disk}}};return!0===e&&(i.hardPowerOffFlag=1),{goodsCategoryId:"100050",regionId:o.getRegionId(),projectId:+t.projectId,zoneId:+t.zoneId,payMode:1,goodsNum:1,goodsDetail:{curDeadline:"0000-00-00 00:00:00",resourceId:t.uInstanceId,oldConfig:{pid:10555,cpu:+t.cpu,mem:+t.mem},newConfig:i,productInfo:[{name:"项目",value:t.projectName},{name:"内网IP",value:t.deviceLanIp},{name:"ID/主机名",value:t.uInstanceId+"、"+t.alias},{name:"地域",value:c.REGIONNAMES[o.getRegionId()]},{name:"可用区",value:t.zoneName},{name:"原配置",value:t.cpu+"核、"+t.mem+"G内存"},{name:"调整后配置",value:this.newCpuSize+"核、"+this.newMemSize+"G内存"}]}}}},{});i.exports=p}),define("modules/cvm2/event/upgradeconfig/config",function(e,t,i){var s=e("manager"),n={cpuMem:{1:{data:[1,2,4,8,12],defaults:2},2:{data:[2,4,8,12,16],defaults:4},4:{data:[4,8,12,16,24],defaults:8},8:{data:[8,12,16,24,32],defaults:16},12:{data:[12,16,24,32,60],defaults:24}}},r={cpuMem:{1:{data:[8],defaults:8},2:{data:[16],defaults:16},4:{data:[32],defaults:32},8:{data:[64],defaults:64},12:{data:[96],defaults:96},16:{data:[128],defaults:128},24:{data:[192],defaults:192},32:{data:[256],defaults:256},48:{data:[368],defaults:368}}},o={cpuMem:{2:{data:[4,8,16],defaults:8},4:{data:[8,16,32],defaults:8},8:{data:[16,24,32,40],defaults:16},12:{data:[24,36,48,60],defaults:24},16:{data:[80],defaults:80},24:{data:[120],defaults:120},32:{data:[160],defaults:160},48:{data:[240],defaults:240}}},d={cpuMem:{1:{data:[1,2,4],defaults:2},2:{data:[4,8],defaults:4},4:{data:[8,16],defaults:8},8:{data:[16,32],defaults:16},12:{data:[24,48],defaults:24},16:{data:[32,48],defaults:32},24:{data:[48,56],defaults:48},32:{data:[64,120],defaults:64}}},c={cpuMem:{1:{data:[8],defaults:8},2:{data:[16],defaults:16},4:{data:[32],defaults:32},8:{data:[64],defaults:64},12:{data:[96],defaults:96},16:{data:[128],defaults:128},24:{data:[192],defaults:192},32:{data:[256],defaults:256},48:{data:[384],defaults:384}}},l={cpuMem:{2:{data:[4,8,16],defaults:8},4:{data:[8,16,32],defaults:8},8:{data:[16,24,32],defaults:16},12:{data:[24,48],defaults:24},16:{data:[32,64],defaults:32},24:{data:[96],defaults:96},32:{data:[120],defaults:120}}},p={cpuMem:{4:{data:[8,16,32],defaults:8},8:{data:[16,32],defaults:16},16:{data:[32,60],defaults:32},32:{data:[120],defaults:120}}},u={cpuMem:{28:{data:[120],defaults:120},56:{data:[240],defaults:240}}},m={cpuMem:{16:{data:[60],defaults:60},32:{data:[120],defaults:120}}},h={cpuMem:{1:{data:[1,2,4],defaults:2},2:{data:[4,8],defaults:4},4:{data:[8,16],defaults:8},8:{data:[16,32],defaults:16},12:{data:[24,48],defaults:24},16:{data:[32,64],defaults:32},24:{data:[48,96],defaults:48},32:{data:[64,128],defaults:64},48:{data:[96,192],defaults:96},64:{data:[128,240],defaults:128}}},v={cpuMem:{4:{data:[8,16,32],defaults:16},8:{data:[16,32],defaults:16},16:{data:[32,64],defaults:32},32:{data:[64,128,180],defaults:64}}};i.exports={isMemType:function(e){return 0<=e.indexOf("SVLMEM")||0<=e.indexOf("VSLMEM")},isCALType:function(e){return 0<=e.indexOf("VSHCAL")},isSecondDeviceType:function(e){return/.+_2$/.test(e)},isHighIOType:function(e){return 0<=e.indexOf("VSHIO")},isVSELF25G_2:function(e){return 0<=e.indexOf("VSELF25G_2")},isVSHCAL25G_2:function(e){return 0<=e.indexOf("VSHCAL25G_2")},isV3Standard:function(e){return-1<e.indexOf("VSELF_3")},isV3Compute:function(e){return-1<e.indexOf("VSHCAL_3")},get:function(e,t,i){var a;if(this.isSecondDeviceType(e))if(this.isVSELF25G_2(e))a=u;else if(this.isVSHCAL25G_2(e))a=m;else if(this.isMemType(e))a=c;else if(this.isHighIOType(e))a=l;else{if(!this.isCALType(e))return a=d,"800002"!=t&&"100002"!=t&&"100004"!=t&&"200002"!=t&&"160001"!=t&&"160002"!=t&&"170001"!=t&&"800003"!=t&&"180001"!=t&&"190001"!=t||(a.cpuMem[16]={data:[32,64],defaults:32},a.cpuMem[24]={data:[48,96],defaults:48},a.cpuMem[32]={data:[64,128],defaults:64}),"100003"!=t&&"200001"!=t||(a.cpuMem[24]={data:[48,96],defaults:48},a.cpuMem[32]={data:[64,128],defaults:64}),void s.queryWhiteList({whiteKey:["APPLE_4C4G_SERIES2"]},function(e){e&&e.APPLE_4C4G_SERIES2&&e.APPLE_4C4G_SERIES2.length&&(a.cpuMem[4]={data:[4,8,16],defaults:8}),i(a)});a=p}else this.isMemType(e)?a=r:this.isHighIOType(e)?a=o:this.isV3Standard(e)?a=h:this.isV3Compute(e)?a=v:(a=n,"100002"!=t&&"100003"!=t&&"200001"!=t&&"200002"!=t&&"150001"!=t||(a.cpuMem[1].data=[1,2,4],a.cpuMem[2].data=[2,4,8,12]),"300001"==t&&(a.cpuMem[1].data=[1,2],a.cpuMem[2].data=[2,4,8,12,16]),"100002"!=t&&"200001"!=t&&"300001"!=t||(a.cpuMem[8].data=[8,16,24,32],a.cpuMem[12].data=[12,24,28],a.cpuMem[16]={data:[16,32,48],defaults:32},a.cpuMem[24]={data:[56],defaults:56}),"100003"!=t&&"200002"!=t&&"150001"!=t||(a.cpuMem[8].data=[8,16,24,32],a.cpuMem[12].data=[12,24,48],a.cpuMem[16]={data:[16,32,48],defaults:32},a.cpuMem[24]={data:[24,48,56],defaults:56},a.cpuMem[32]={data:[64],defaults:64}),"800001"==t&&(a.cpuMem[1].data=[1,2,4],a.cpuMem[2].data=[2,4,8,12],a.cpuMem[8].data=[8,16,24,32],a.cpuMem[12].data=[12,24,48],a.cpuMem[16]={data:[16,32,48],defaults:32},a.cpuMem[24]={data:[24,48,56],defaults:56},a.cpuMem[32]={data:[64],defaults:64}),"400001"==t&&(a.cpuMem[1].data=[2,4,8],a.cpuMem[2].data=[4,8,12,16],a.cpuMem[8].data=[8,16,24,32],a.cpuMem[12].data=[24,48],a.cpuMem[16]={data:[32,48],defaults:32},a.cpuMem[24]={data:[60],defaults:60}),"900001"==t&&(a.cpuMem={1:{data:[1,2,4],defaults:2},2:{data:[2,4,8,12],defaults:4},4:{data:[4,8,12,16,24],defaults:8},8:{data:[8,16,24,32],defaults:16},12:{data:[12,24,48],defaults:24},16:{data:[16,32,48],defaults:32},24:{data:[24,48,56],defaults:48},32:{data:[64],defaults:64}}),"120001"==t&&(a.cpuMem={1:{data:[1,2,4,8],defaults:2},2:{data:[2,4,8,12],defaults:4},4:{data:[4,8,12,16,24,32],defaults:8},8:{data:[8,16,24,32,64],defaults:16},12:{data:[12,24,36,48],defaults:24}}),"110001"!=t&&"110002"!=t&&"700001"!=t&&"700002"!=t||(a.cpuMem[1].data=[1,2],a.cpuMem[2].data=[2,4],a.cpuMem[12].data=[12,16,24,32,48],a.cpuMem[16]={data:[16,24,32,48],defaults:32},a.cpuMem[24]={data:[60],defaults:60},a.cpuMem[32]={data:[64],defaults:64}));i(a)}}}),define("modules/cvm2/event/upgradeconfig/upgradeconfig",function(t,e,i){var c,l=t("$"),h=t("manager"),a=t("modules/cvm2/event/operate_base"),v=t("dialog"),n=t("util"),p=t("appUtil"),s=t("tips"),u=t("widget/pills/pills"),m=t("widget/selectedShow/selectedShow"),f=t("./config"),r=t("modules/cvm2/event/upgrade_common"),g=(t("constants"),t("reporter")),o=t("modules/cvm2/event/upgradeconfig/cdhupgradeconfig"),d=(t("models/api"),t("models/iaas")),b={main:'<div id="upgradeConfigWrap"><ul class="form-list">    <li>        <div class="form-label"><label>原配置</label></div>        <div class="form-input">            <p class="normal-txt">            <span><%-cpu%>核</span>            <span><%-mem%>GB</span>            <% if (isCvmSecondPay) { %>            <span class="cost"><money value="{{origConfigCost}}" format="words"></money>/小时</span>            <% } %>            </p>        </div>    </li>    <li>        <div class="form-label"><label>目标CPU核数</label></div>        <div class="form-input">        <div id="cpuPillsWrap"></div>        </div>    </li>    <li>        <div class="form-label"><label>目标内存容量</label></div>        <div class="form-input">            <div id="memPillsWrap"></div>        </div>    </li>    <li class="cost-li">        <div class="form-label">        <label data-field="pricetitle">        <% if (isCvmSecondPay) { %>            调整后单价            <% } else { %>            需支付费用            <% } %>        </label>        </div>        <div class="form-input">            <span class="cost"><money value="{{cost}}" format="words"></money><% if (isCvmSecondPay) { %>/小时<% } %>            </span><span data-discount style="display:none;font-size:1.2em;"><money value="{{originCost}}" format="words" style="text-decoration:line-through; margin:0 5px"></money></span><% if (isCvmLadderPrice) { %><div class="tc-15-bubble-icon">                        <i class="tc-icon icon-info-red"></i>                        <div class="tc-15-bubble tc-15-bubble-left">                            <div class="tc-15-bubble-inner">                                <p>按量计费阶梯定价，用得越久越便宜，<a href="https://'+QCMAIN_HOST+'/doc/product/213/%E8%AE%A1%E8%B4%B9%E6%A8%A1%E5%BC%8F%E8%AF%B4%E6%98%8E#2" target="_blank" >查看详情</a>。</p>                            </div>                        </div>                    </div>            <% } %>        </div>    </li>    <li class="deadline-li" style="display:none;">        <div class="form-label"><label>当前有效期至</label></div>        <div class="form-input">            <div class="curDeadline inline-help-text"></div>        </div>    </li>    <li class="deadline-li" style="display:none;">        <div class="form-label"><label>延长有效期至</label></div>        <div class="form-input">            <div class="targetDeadline inline-help-text"></div>            <div class="tc-15-bubble-icon tc-15-triangle-align-end">        <i class="tc-icon icon-info-red"></i>        <div class="tc-15-bubble tc-15-bubble-left" style="width:400px;">            <div class="tc-15-bubble-inner">                <p>该云服务器共有<span class="maxCount" style="color:red;"></span>次降配机会，还有<span class="leftCount" style="color:red;"></span>次</p><p>原始配置为 <span class="oldC"></span>核 <span class="oldM"></span>GB ，目标配置为 <span class="newC"></span>核 <span class="newM"></span>GB</p> <p>降低配置，按照实际支付和官网价格折算，应<money value="{{realCost}}" format="words"></money></p><p class="payback-tag">折算成时间，该服务器的到期时间将从<span class="oldDate"></span>调整到<span class="newDate"></span></p><p class="payoff-tag">由于应补差价小于零，将不会调整您的服务器到期时间</p><p><a href="http://'+QCMAIN_HOST+'/doc/product/213/%E8%B0%83%E6%95%B4CVM%E7%A1%AC%E4%BB%B6%E9%85%8D%E7%BD%AE" target="_blank">详细了解CVM配置调整</a></p>            </div>        </div>    </div>        </div>    </li></ul><div class="tc-15-msg act-outline" id="reduceConfigTip" style="display:none;">    </div><% if (item.vpcId == -1 || isCvmLadderPrice) { %><div class="tc-15-msg" style="margin-bottom:20px"><div style="color:#f00">重要提示：</div><ul><% if ( item.vpcId == -1) { %>        <li>调整配置后, 该服务器的内网IP可能发生变化。</li>        <% } %>        <% if ( isCvmLadderPrice) { %>        <li>调整配置后，按量计费价格将从第一阶梯开始计费，请谨慎调整，        <a href="https://'+QCMAIN_HOST+'/doc/product/213/%E8%AE%A1%E8%B4%B9%E6%A8%A1%E5%BC%8F%E8%AF%B4%E6%98%8E#2" target="_blank" >查看详情</a>。</li><% } %>    </ul></div><% } %></div>',confirm:'<div class="text-tips">        <p>1、为了避免数据丢失，配置调整需要在<em class="text-danger">关机</em>状态下操作，云服务器将关机中断您的业务，请仔细确认</p>        <p>2、强制关机可能会导致数据丢失或文件系统损坏，您也可以主动关机后进行调整配置</p>        <p>3、强制关机可能需要您等待较长时间，请耐心等待</p>        <p><label class="form-ctrl-label"><input type="checkbox" b-model="agree" class="tc-15-checkbox">同意强制关机</label></p>    </div>',unsupported:'<div><p><span style="color:red">广州一区已售罄，不支持控制台调整配置。</span></p><p>推荐使用云计算能力更强的广州二区、全新万兆的广州三区。</p><p>如您需要配置调整，可通过<a href="https://console.qcloud.com/workorder">工单系统</a>（需求->云服务器->广州一区配置调整）联系我们。</p></div>',sellout:'<div><p class="dialog-confirm-title"><i class="m-error-icon"></i><strong>调整配置失败</strong></p><p class="dialog-confirm-text"><%=zoneName%>此配置已售罄，暂不支持控制台调整配置。</p></div>'},I=function(e){a.call(this,e)};(I.prototype=new a).exec=function(){var t=this,e=this.hasPermItems[0];if(t.upgradeCommon=new r(t),100001!=e.zoneId)if(e.uHostId)this.cdhUpgradeConfig();else{var i=!1;h.queryWhiteList({whiteKey:["CVM_LADDER_PRICE"]},function(e){i=!(!e.CVM_LADDER_PRICE||!e.CVM_LADDER_PRICE.length),i=!(!t.isCvmSecondPay()||!i),t.cvmUpgradeConfig(i)})}else v.create(b.unsupported,"600","",{title:"调整配置",button:{"确定":function(e){v.hide()}}})},I.prototype.cdhUpgradeConfig=function(){var e=this,t=this.hasPermItems[0],i=new o({selectedItem:t}),a={shutdown:{"确定":function(){i.doAction(v)}},nonShutdown:{"下一步":function(){e.toConfirmShutdown({confirmTpl:b.confirm,title:"升级配置",confirmBtnTxt:"去调整"}).done(function(){i.doAction(v,!0)})}}}[e.upgradeCommon.isShutdown(t.runflag)?"shutdown":"nonShutdown"];v.create(i.$el,"600","",{title:"升级配置","class":"dialog_layer_v2 tc-15-rich-dialog new-gateway",preventResubmit:!0,button:a})},I.prototype.checkConfigQuota=function(e){return new Promise(function(a,s){d.apiRequest({cmd:"GetVmConfigQuota",serviceType:"cvm",data:e},{tipErr:!1}).then(function(e){var t=e.data&&e.data.resultList,i=t&&t[0]&&t[0].cvmQuota;i&&0<i?a(i):s()},s)})},I.prototype.cvmUpgradeConfig=function(r){var o=this,d=this.hasPermItems[0];if(c={},o.selectedItemIsExpire())return s.error("服务器已过期，请续费");var e=n.tmpl(b.main,{cpu:d.cpu,mem:d.mem,item:d,isVpc:o.hasFeature("VPC"),isCvmSecondPay:o.isCvmSecondPay(),isCvmLadderPrice:r});v.create(e,"650","",{title:"调整配置",preventResubmit:!0,buttonDisable:[1,0],button:{"确定":function(){var e='调整配置后，按量计费价格将从第一阶梯开始计费，请谨慎调整，<a href="https://'+QCMAIN_HOST+'/doc/product/213/%E8%AE%A1%E8%B4%B9%E6%A8%A1%E5%BC%8F%E8%AF%B4%E6%98%8E#2" target="_blank" >查看详情</a>。',t='调整配置后，该服务器的内网IP会产生变化，并且按量计费价格将从第一阶梯开始计费，请谨慎调整，<a href="https://'+QCMAIN_HOST+'/doc/product/213/%E8%AE%A1%E8%B4%B9%E6%A8%A1%E5%BC%8F%E8%AF%B4%E6%98%8E#2" target="_blank" >查看详情</a>。',i=o.upgradeCommon.isShutdown(d.runflag),a={shutdown:{txt:"确定",confirmCb:o.toUpgrade.bind(o)},nonShutdown:{txt:"下一步",confirmCb:function(){o.toConfirmShutdown({confirmTpl:b.confirm,title:"调整配置",confirmBtnTxt:"去调整"}).done(function(){o.toUpgrade(!0)})}}}[i?"shutdown":"nonShutdown"];if(-1==d.vpcId||r){var s="",n={};-1==d.vpcId&&r?s=t:-1==d.vpcId?s="调整配置后, 该服务器的内网IP会产生变化。":r&&(s=e),n[a.txt]=a.confirmCb,v.create(s,"525","",{title:"温馨提示",preventResubmit:!0,button:n})}else a.confirmCb()}}}),m.render(o.selectedShowOptions),o.wrapper=l("#upgradeConfigWrap"),o.bee=t("qccomponent").mount(o.wrapper[0]),o._type=d.deviceClass,o._zone=d.zoneId,f.get(o._type,o._zone,function(e){c=e,o.initComponent()})},I.prototype.initComponent=function(){var o=this,d=this.hasPermItems[0],e=[];for(var t in c.cpuMem){if(t<d.cpu)for(var i in c.cpuMem[t].data){c.cpuMem[t].data[i]>d.mem&&delete c.cpuMem[t].data[i]}if(t>d.cpu)for(var i in c.cpuMem[t].data){c.cpuMem[t].data[i]<d.mem&&delete c.cpuMem[t].data[i]}}for(var a in c.cpuMem){var s={name:a+"核",value:a,active:a==d.cpu};e.push(s)}var n=function(e){var t=l("#memPillsWrap"),i=c.cpuMem[e].data,a=c.cpuMem[e].defaults,s=[],n=0;if(-1<i.indexOf(d.mem))n=d.mem;else if(-1<i.indexOf(a))n=a;else{var r=i.filter(function(e){return e});n=r[r.length-1]}i.forEach(function(e){var t={name:e+"GB",value:e,active:n==e};"windows"===d.osType.toLowerCase()&&d.osName&&-1<d.osName.toLowerCase().indexOf("2016")&&1==e&&1<d.mem&&(t.disabled=!0,t.tips="使用Windows 2016系统的云服务器最低内存限制为2GB"),s.push(t)}),t.html(""),o.memPills=new u({renderTo:t,data:s,newMode:!0,change:function(){o.memVal=this.val(),o.setPrice().always(function(){o.displayEniQuotaTip()})}}),o.memVal=o.memPills.val(),o.setPrice().always(function(){o.displayEniQuotaTip()})};this.cpuPills=new u({renderTo:l("#cpuPillsWrap"),data:e,newMode:!0,change:function(){o.cpuVal=this.val(),n(o.cpuVal)}}),o.cpuVal=o.cpuPills.val(),n(d.cpu),o.setPrice(!0)},I.prototype.collectData=function(e){var t=this.hasPermItems[0],i=this.cpuVal,a=this.memVal,s={productInfo:[{name:"项目",value:t.projectName},{name:"主机名",value:t.uInstanceId},{name:"内网IP",value:t.deviceLanIp},{name:"所属网络",value:t.netName},{name:"可用区",value:t.zoneName},{name:"CPU",value:t.cpu+"=>"+i},{name:"内存",value:t.mem+"=>"+a}],newConfig:{cpu:parseInt(i),mem:parseInt(a),compute:{cpu:parseInt(i),mem:parseInt(a)},modifyMode:"compute"},curDeadline:t.deadline,resourceId:t.uInstanceId};return!0===e&&(s.newConfig.hardPowerOffFlag=1),[{goodsCategoryId:100021,appId:p.getAppId(),projectId:t.projectId,regionId:p.getRegionId(),zoneId:t.zoneId,payMode:t.cvmPayMode,goodsNum:1,goodsDetail:s}]},I.prototype.isReduceConfig=function(){var e=this.hasPermItems[0],t=this.cpuVal,i=this.memVal;return t<=e.cpu&&i<e.mem||t<e.cpu&&i<=e.mem},I.prototype.QueryInstanceEniLimit=function(e){var t=l.Deferred();return h.getInstanceEniLimit(e,function(e){e=e&&e.data||{},t.resolve(e)},t.reject),t},I.prototype.QueryInstanceEniNum=function(e){var t=l.Deferred();return h.getInstanceEniNum(e,function(e){e=e&&e.data||{},t.resolve(e)},t.reject),t},I.prototype.checkEniQuota=function(){var r=l.Deferred(),e=this.hasPermItems[0],t=this.cpuVal,i=this.memVal,o=!1,d=!1,c=!1;return this.isReduceConfig()?(o=!0,l.when(this.QueryInstanceEniLimit({regionId:p.getRegionId(),instanceId:e.uInstanceId,cpu:t,mem:i}),this.QueryInstanceEniNum({instanceId:e.uInstanceId,hideSecondary:0})).done(function(e,t){var i=e.eniLimit,a=e.eniIpLimit,s=(t=t.data).length||0,n=0;t.forEach(function(e){n=Math.max(n,e.privateIpAddressesSet&&e.privateIpAddressesSet.length||0)}),i<s&&(d=!0),a<n&&(c=!0),r.resolve({isReduceConfig:o,eniOverLimit:d,ipOverLimit:c,eniLimit:i,eniIpLimit:a})}).fail(function(){r.resolve({isReduceConfig:o,eniOverLimit:d,ipOverLimit:c,eniLimit:0,eniIpLimit:0})})):r.resolve({isReduceConfig:o,eniOverLimit:d,ipOverLimit:c,eniLimit:0,eniIpLimit:0}),r},I.prototype.displayEniQuotaTip=function(){var i=this,e=this.hasPermItems[0],a=p.getRegionId(),s=e.uInstanceId;0<e.vpcId&&this.checkEniQuota().done(function(e){var t="";l("#reduceConfigTip").removeClass("warning").hide(),i.restoreDialogBtn(),e.eniOverLimit||e.ipOverLimit||!e.isReduceConfig?e.eniOverLimit?(t=n.tmpl('<div class="tip-info">注意：降配后,最多支持<%= eniLimit %>个网卡，每个网卡最多支持<%=eniIpLimit %>个IP，当前云主机绑定的网卡已超过配额。<a href="//'+QCMAIN_HOST+'/document/product/215/6513#.E4.BD.BF.E7.94.A8.E7.BA.A6.E6.9D.9F" target="_blank">网卡配额说明 <i class="external-link-icon"></i> </a>请先解绑网卡，再调整配置。<a href="//console.qcloud.com/vpc/eni?instanceId=<%=instanceId%>" target="_blank">查看云主机弹性网卡</a></div>',{regionId:a,instanceId:s,eniLimit:e.eniLimit,eniIpLimit:e.eniIpLimit}),l("#reduceConfigTip").addClass("warning").show(),v.toggleBtnDisable(!0)):e.ipOverLimit&&(t=n.tmpl('<div class="tip-info">注意：降配后,最多支持<%= eniLimit %>个网卡，每个网卡最多支持<%=eniIpLimit %>个IP，当前云主机绑定的网卡已超过配额。<a href="//'+QCMAIN_HOST+'/document/product/215/6513#.E4.BD.BF.E7.94.A8.E7.BA.A6.E6.9D.9F" target="_blank">网卡配额说明 <i class="external-link-icon"></i> </a>请先更换其他网卡或释放IP。<a href="//console.qcloud.com/vpc/eni?instanceId=<%=instanceId%>" target="_blank">查看云主机弹性网卡</a></div>',{regionId:a,instanceId:s,eniLimit:e.eniLimit,eniIpLimit:e.eniIpLimit}),l("#reduceConfigTip").addClass("warning").show(),v.toggleBtnDisable(!0)):(t=n.tmpl('<div class="tip-info">注意：降配后云主机最多支持<%= eniLimit %>个网卡，每个网卡最多支持<%=eniIpLimit %>个IP。<a href="//'+QCMAIN_HOST+'/document/product/215/6513#.E4.BD.BF.E7.94.A8.E7.BA.A6.E6.9D.9F" target="_blank">查看网卡配额说明</a></div>',{eniLimit:e.eniLimit,eniIpLimit:e.eniIpLimit}),l("#reduceConfigTip").show()),l("#reduceConfigTip").html(t)})},I.prototype.setPrice=function(a){var e,s=this,n=l.Deferred(),t=this.hasPermItems[0],i=this.cpuVal,r=this.memVal;return v&&v.toggleBtnDisable(!0),this.isCvmSecondPay()?this.upgradeCommon.getConfigPricePid({cpu:i,mem:r}).then(function(e){if(a){var t=s.getPriceParaForHour(!0);s.upgradeCommon.getPriceForHour(e,t,!0).then(n.resolve,n.reject)}else{var i=s.getPriceParaForHour();s.upgradeCommon.getPriceForHour(e,i).then(n.resolve,n.reject)}}):(e=i<=t.cpu&&r<=t.mem?i==t.cpu&&r==t.mem?s.collectData():[{goodsCategoryId:79,appId:p.getAppId(),projectId:t.projectId,regionId:p.getRegionId(),zoneId:t.zoneId,payMode:t.cvmPayMode,goodsNum:1,goodsDetail:this.getPricePara(!0,i,r)}]:this.collectData(),h.getPrice({goodsDetail:e},function(e){s.upgradeCommon.setPriceUI(e,{cpu:i,mem:r}),n.resolve()},n.reject)),n},I.prototype.notChooseMemPrice=function(){var e=this.wrapper,t=this.bee,i=e.find("[data-discount]");t.$set("cost",0),e.find('[data-field="pricetitle"]').text("需支付费用"),i.hide()},I.prototype.getPricePara=function(e,t,i){return e?this.upgradeCommon.getPriceParaForReduce(t,i):this.upgradeCommon.getPriceParaForConfig()},I.prototype.getPriceParaForHour=function(e){var t=this.hasPermItems[0],i=this.upgradeCommon.getInputData();return e&&(i.cpu=t.cpu,i.mem=t.mem),i},I.prototype.tipsError=function(e){return this.restoreDialogBtn(),s.error(e)},I.prototype.toUpgrade=function(t){var i=this,a=this.hasPermItems[0],e=this.upgradeCommon.getInputData();this.checkConfigQuota({cvmPayMode:a.cvmPayMode,zoneIdList:[a.zoneId],configList:[{deviceClass:a.deviceClass,cpu:e.cpu||0,mem:e.mem||0,gpu:a.gpu||0,fpga:a.fpga||0}]}).then(function(e){i.execUpgrade(t)})["catch"](function(e){v.create(n.tmpl(b.sellout,{zoneName:a.zoneName}),"600","",{title:"调整配置",button:{"确定":function(e){v.hide()}}})})},I.prototype.execUpgrade=function(s){var n=this,r=this.hasPermItems[0],e=this.upgradeCommon.getInputData(),o=this.getPricePara();if(this.isCvmSecondPay()){if(e.cpu==r.cpu&&e.mem==r.mem)return this.tipsError("配置未变更!");Promise.all([this.upgradeCommon.checkSecondModeEnoughPay(),this.upgradeCommon.getConfigPricePid()]).then(function(e){var t=e[0],i=e[1];n.upgradeCommon.setRootPara(o.parts);var a={zoneId:r.zoneId,lanIp:r.deviceLanIp,uuid:r.uuid,pid:i,oldBillId:r.billId,parts:o.parts};!0===s&&(a.hardPowerOffFlag=1),t?h.upgradeHourCvm(a,function(e){e=e.data||e,v.hide(),n.checkTask(e,"调整配置中")}):n.upgradeCommon.showNotEnoughPay()}),g.click("yunzhuji.btn.upgradeconfig.second")}else{for(var t,i,a,d,c,l=0;c=r.cbsList[l];l++)"root"===c.diskType&&(t=c.target,a=c.diskSize),"data"===c.diskType&&(i=c.target,d=c.diskSize);var p=this.cpuVal,u=this.memVal;if(p<=r.cpu&&u<r.mem||p<r.cpu&&u<=r.mem){o={type:"cvm",subType:"cvmBasicConfig",action:"upgradeCvm",zoneId:r.zoneId,curDeadline:r.deadline,returnParts:{cpu:r.cpu,mem:r.mem},uuid:r.uuid,parts:{os:r.osValue,bandwidth:r.bandwidth,cpu:p,mem:u,diskInfo:{root:{target:t,type:r.rootType,size:a||r.rootSize},data:[{target:i,type:r.diskType,size:d||r.diskSize}]}},lanIp:r.deviceLanIp,vpcId:r.vpcId,subnetId:r.subnetId,isVpcGateway:r.isVpcGateway,networkPayMode:r.networkPayMode,productInfo:[{name:"CPU",value:r.cpu+"=>"+p},{name:"内存",value:r.mem+"=>"+u}]};!0===s&&(o.hardPowerOffFlag=1),h.payByCartCvm({categoryId:79,goodsDetail:JSON.stringify(o)},function(e){v.hide();try{n.checkTask(e,"调整配置中")}catch(t){console.log(t)}})}else{var m=this.collectData(s);this.upgradeCommon.toUpgrade(m),g.click("yunzhuji.btn.upgradeconfig.monthyear")}}},i.exports=I}),define("modules/cvm2/event/upgradedisk/cdhupgradedisk",function(e,t,i){var n=e("$"),a=(e("manager"),e("qccomponent")),s=(e("modules/cvm2/event/operate_base"),e("dialog"),e("widget/cvmList/jsformutil")),r=e("appUtil"),o=(e("tips"),e("widget/range/range")),d=(e("widget/selectedShow/selectedShow"),e("models/cdh")),c=e("constants"),l=(e("reporter"),e("modules/cvm/cdh/cdhconfig")),p=a.extend({$tpl:'    <div>        <div class="tc-15-msg">            磁盘扩容后需要您手动调整文件系统，把新增的部分容量使用起来。        </div>        <div class="form-wrap" style="padding-top: 10px">            <ul class="form-list">                <li>                    <div class="form-label"><label>ID/主机名</label></div>                    <div class="form-input">                        <div class="id-name-cell">                            <p>                                <span class="text-overflow m-width" title="" > {{selectedItem.uInstanceId}} </span>                            </p>                            <div>                                <span class="text-overflow m-width" title="" >{{selectedItem.alias}}</span>                            </div>                        </div>                    </div>                </li>                <li>                    <div class="form-label"><label>数据盘容量</label></div>                    <div class="item-descr-txt">                        <span class="text-overflow m-width" title="" >{{selectedItem.disk}}GB</span>                    </div>                </li>                <li>                    <div class="form-label"><label>目标容量</label></div>                    <div class="form-input">                        <div data-role="cbsRangeWrap" style="width:450px"></div>                    </div>                </li>                <li>                    <div class="form-label">                        <label data-field="pricetitle">                            需支付费用                        </label>                    </div>                    <div class="form-input">                        <span class="cost" ><strong data-field="cost"></strong>0.00元</span><span data-discount style="display:none;font-size:1.2em;"><span data-field="origin-cost" style="text-decoration:line-through; margin:0 5px"></span>元</span>                    </div>                </li>            </ul>        </div>    </div>',$beforeInit:function(){},$afterInit:function(){var i=this,a=n(i.$el).find('[data-role="cbsRangeWrap"]')[0],s=i.selectedItem.disk||0;d.request({name:"getVpsHostList",data:{regionId:r.getRegionId(),uHostIdList:[i.selectedItem.uHostId]},success:function(e){var t=e.hostList[0].diskAvailable+s;i.cbsRange=new o({renderTo:a,value:s,min:s,max:+t,unit:"GB",section:[{value:s,width:2},{value:+t,width:300}],step:1,change:function(e){i.newDiskSize=e}})}})},getUpgradeDiskParam:function(e){var t=this.selectedItem,i={modifyMode:"manual",pid:10555,cpu:t.cpu,mem:t.mem,compute:{cpu:t.cpu,mem:t.mem},diskInfo:{root:{target:"xvda",type:+t.rootType,size:+t.rootSize},data:[{target:3==t.diskType?"xbdb":"xvdb",type:t.diskType,size:+this.newDiskSize}]}};return 3==t.diskType?i.ssd=+this.newDiskSize:i.disk=+this.newDiskSize,!0===e&&(i.hardPowerOffFlag=1),{goodsCategoryId:"100050",regionId:+r.getRegionId(),projectId:+t.projectId,zoneId:+t.zoneId,payMode:1,goodsNum:1,goodsDetail:{curDeadline:"0000-00-00 00:00:00",resourceId:t.uInstanceId,oldConfig:{pid:10555,cpu:t.cpu,mem:t.mem},newConfig:i,productInfo:[{name:"项目",value:t.projectName},{name:"内网IP",value:t.deviceLanIp},{name:"ID/主机名",value:t.uInstanceId+"、"+t.alias},{name:"地域",value:c.REGIONNAMES[r.getRegionId()]},{name:"可用区",value:t.zoneName},{name:"原硬盘配置",value:t.disk+"G硬盘"},{name:"调整后硬盘配置",value:+this.newDiskSize+"G硬盘"}]}}},doAction:function(e,t){if(this.newDiskSize&&this.newDiskSize!=this.selectedItem.disk){var i=l.NEW_PAY_URL,a=JSON.stringify({raw_goodsData:[this.getUpgradeDiskParam(t)]});s.jsFormSender(i,{itemDetails:a},"post","_self")}else e.hide()}});i.exports=p}),define("modules/cvm2/event/upgradedisk/upgradedisk",function(e,t,i){var c=e("$"),d=e("manager"),a=e("modules/cvm2/event/operate_base"),l=e("dialog"),n=e("qccomponent"),o=e("util"),p=e("appUtil"),u=e("tips"),m=e("widget/range/range"),s=e("widget/selectedShow/selectedShow"),r=e("modules/cvm2/event/upgrade_common"),h=e("constants"),v=e("reporter"),f=e("modules/cvm2/event/upgradedisk/cdhupgradedisk"),g=e("modules/cvm/cbs/cbs/data"),b=e("modules/cvm/cbs/cbsutil"),I={},y=h.CBS_DISK_CONFIG,w=h.SSD_CBS_DISK_CONFIG,x=h.PREMIUM_CBS_DISK_CONFIG,k=h.CBS_META_LIST,C={main:'  <div id="upgradeConfigWrap"><ul class="form-list">    <li>        <div class="form-label"><label>当前容量</label></div>        <div class="form-input">            <p class="normal-txt">            <span><%-cbsSize%>GB</span>            </p>        </div>    </li>    <li>        <div class="form-label"><label>目标容量</label></div>        <div class="form-input">        <div id="cbsRangeWrap" style="width:450px"></div>        </div>    </li>    <% if (!isSecondPay) { %>    <li>        <div class="form-label">        <label data-field="pricetitle">        需支付费用            </label>            </div>        <div class="form-input">            <span class="cost" ><strong data-field="cost"></strong>元</span><span data-discount style="display:none;font-size:1.2em;"> </span>        </div>    </li>    <% } %></ul>     </div>',confirm:'<div class="text-tips">        <p>1、为了避免数据丢失，调整磁盘需要在<em class="text-danger">关机</em>状态下操作，云服务器将关机中断您的业务，请仔细确认</p>        <p>2、强制关机可能会导致数据丢失或文件系统损坏，您也可以主动关机后进行调整配置</p>        <p>3、强制关机可能需要您等待较长时间，请耐心等待</p>        <p><label class="form-ctrl-label"><input type="checkbox" b-model="agree" class="tc-15-checkbox">同意强制关机</label></p>    </div>',select:'<div id="upgradeSelectWrap"><div class="tc-15-msg" style="margin-bottom:20px"><div style="color:#f00">重要提示：</div><ul><li>为了防止数据丢失，磁盘只可扩容不可缩</li>        <li>        <% if(diskType == "5"){ %>        当前磁盘为SSD云盘，<% } %>磁盘扩容后需要登录虚拟机手动修改文件系统配置，把新增部分容量使用起来，请见详细说明：<a href="https://'+QCMAIN_HOST+'/document/product/362/6737" target="_blank" class="guide-link">扩容Windows文件系统<b class="external-link-icon"></b> </a>和<a href="https://'+QCMAIN_HOST+'/document/product/362/6738" target="_blank" class="guide-link">扩容Linux文件系统<b class="external-link-icon"></b></a></li>    </ul></div><div class="renew-form old-hang">        <div class="tc-15-option-hd">            <h4>请选择磁盘</h4>        </div>        <div class="tc-15-table-panel"><div id="dialog_cbsList"></div>        </div>    </div></div>',error:'<div class="dialog-confirm-box">    <p class="dialog-confirm-title"><i class="m-error-icon"></i><strong>调整磁盘失败</strong></p>    <p class="dialog-confirm-text">调整弹性云盘需要关闭云主机，请关机后重试。</p>  </div>'};var T=function(e){a.call(this,e)};(T.prototype=new a).exec=function(){var e=this.hasPermItems[0];if(this.upgradeCommon=new r(this),e.uHostId)this.cdhUpgradeDisk();else{if(this.selectedItemIsExpire())return u.error("服务器已过期，请续费");this.cvmUpgradeDisk()}},T.prototype.renderSelectGrid=function(){var e=this.hasPermItems[0],i=[];c(e.cbsList).each(function(e,t){"data"==t.diskType&&i.push(t)}),this.cbsList=i,this.selectedCbs=null,this.initCbsGridView(),this.renderGrid(this.cbsList,1,5,this.gridView),this.gridView.checkCellWidth()},T.prototype.initCbsGridView=function(){var i,s=this,e=n.getComponent("grid-view");s.gridView=new e({$data:{hasFirst:!1,initGetData:!1,canResizeColum:!1,selectedHighlight:!1,maxHeight:290,minHeight:141,autoMaxHeight:!1,maxHeightOffset:10,count:5,colums:[{key:"radio",name:"",width:"",minWidth:50,required:!0},{key:"cbsInstanceId",name:"ID/云硬盘名",width:"",minWidth:153,tdTpl:'<div><p>{{item.cbsInstanceId}}</p><p><span class="text-overflow m-width">{{item.alias}}</span></p></div>',required:!0},{key:"diskSize",name:"磁盘容量",width:153,required:!0},{key:"volumeType",name:"磁盘类型",width:153,required:!0}],list:[],showState:!1,showPagination:!0},diskTypeFilterOptions:(i=[],k=k||[],c.each(k,function(e,t){i.push({label:t.name,value:t.medium})}),i),getHeadContent:function(e){if("volumeType"===e.key)return'<grid-view-header-filter b-ref="diskTypeFilter" b-with="{filterOptions: diskTypeFilterOptions, col: col, change: filterchange.bind(this.$root)}"></grid-view-header-filter>'},getCellContent:function(e,t,i){return"radio"==i.key?'<div class="tc-15-first-radio"><input type="radio" class="tc-15-radio">'+(s.gridView.sUInstanceId==t.cbsInstanceId?"checked   ":"")+"</div>":"volumeType"===i.key?"<div><p>"+b.getCbsMetaByMedium(t.volumeType).name+"</p></div>":void 0},filterchange:function(i){var a=[];c(s.cbsList).each(function(e,t){-1!=i.indexOf(t.volumeType)&&a.push(t)}),s.renderGrid(a,1,5,s.gridView)},setTrAttr:function(e,t){return{"data-cbsinstanceid":t.cbsInstanceId}},events:{"click tr":function(e){var t=c(e.target);t.closest("tr").find(":radio").prop("disabled")||(c(this.$el).find(":radio").prop("checked",!1),t.closest("tr").find(":radio").prop("checked",!0),l.toggleBtnDisable(!1,0))}},getData:function(e){var t=e.count;e.page;s.renderGrid(s.cbsList,e.page,t,s.gridView)}}),c("#dialog_cbsList").append(s.gridView.$el)},T.prototype.renderGrid=function(e,t,i,a){var s=e;a.setData({list:s,totalNum:e.length,page:t,count:i})},T.prototype.cdhUpgradeDisk=function(){var e=this,t=this.hasPermItems[0],i=new f({selectedItem:t}),a={shutdown:{"确定":function(){i.doAction(l)}},nonShutdown:{"下一步":function(){e.toConfirmShutdown({confirmTpl:C.confirm,title:"调整磁盘",confirmBtnTxt:"去调整"}).done(function(){i.doAction(l,!0)})}}}[e.upgradeCommon.isShutdown(t.runflag)?"shutdown":"nonShutdown"];l.create(i.$el,"600","",{title:"磁盘调整","class":"dialog_layer_v2 tc-15-rich-dialog new-gateway",preventResubmit:!0,button:a})},T.prototype.selectDisk=function(){var e=this.hasPermItems[0],t=c.Deferred(),i=o.tmpl(C.select,{diskType:e.diskType});return l.create(i,"600","",{title:"调整磁盘",preventResubmit:!0,button:{"下一步":function(){t.resolve()}},buttonDisable:[1,0],defaultCancelCb:function(){t.reject()}}),s.render(this.selectedShowOptions),this.renderSelectGrid(),t.promise()},T.prototype.cvmUpgradeDisk=function(){var n=this,r=this.hasPermItems[0];this.selectDisk().done(function(){var e=c(n.gridView.$el).find(":radio:checked");if(e.length){n.gridView.sUInstanceId=e.closest("tr").data("cbsinstanceid"),n.selectedCbs=n.getSelectedCbs();var t=n.upgradeCommon.isShutdown(r.runflag);if(1==n.selectedCbs.portable&&!t)return l.create(C.error,"600","",{title:"调整磁盘失败",preventResubmit:!0,button:{"确定":function(){l.hide()}}});var i=o.tmpl(C.main,{isSecondPay:n.isCbsSecondPay(),cbsSize:n.selectedCbs.diskSize}),a={shutdown:{"确定":function(){n.toUpgrade()}},nonShutdown:{"下一步":function(){n.toConfirmShutdown({confirmTpl:C.confirm,title:"调整磁盘",confirmBtnTxt:"去调整"}).done(function(){n.toUpgrade(!0)})}}}[t?"shutdown":"nonShutdown"];l.create(i,"570","",{title:"调整磁盘",preventResubmit:!0,button:a}),n.wrapper=c("#upgradeConfigWrap"),function s(){var t=c.Deferred();return c.isEmptyObject(I)?d.queryWhiteList({whiteKey:["cbs_16TB"]},function(e){I=e,t.resolve(I)},function(){t.resolve()}):t.resolve(I),t.promise()}().done(function(){n.initComponent()})}else u.error("请选择磁盘")})},T.prototype.initComponent=function(){var e=this,t=this.selectedCbs,i=t.diskSize,a=function o(e,t,i){var a=null;if("cbs"==t)if("prepay"==e){var s=y[i];if(!s)return a;a=I.cbs_16TB&&I.cbs_16TB.length?{diskMin:s.diskMin,diskMax:s.diskMax}:{diskMin:s.diskMin,diskMax:s.disk}}else a={diskMin:0,diskMax:4e3};else"cbsssd"==t?a=w:"cbsPremium"==t&&(a=x);return a}(t.payMode,t.volumeType,t.zoneId);if(a){var s=a.diskMax,n=a.diskMin;n=s<(n=i+10<n?n:i+10)?s:n;var r=function d(e){var t=[];return 250==e?t=[50,100,250]:400==e?t=[100,200,400]:500==e?t=[100,300,500]:800==e?t=[160,480,800]:1e3==e?t=[200,500,1e3]:1200==e?t=[200,500,1200]:1500<=e&&(t=[200,500,1e3,e]),t}(s)||[];r=r.map(function(e,t){return{value:e,width:300/r.length*(t+1)}}),this.cbsRange=new m({renderTo:c("#cbsRangeWrap"),value:i,min:n,max:s,unit:"GB",section:r,step:10,change:function(){e.setPrice()}}),e.setPrice(!0)}},T.prototype.collectData=function(e){var t=this.hasPermItems[0],i=this.selectedCbs,a=b.getCbsMetaByMedium(i.volumeType),s=this.cbsRange?this.cbsRange.val():0,n=null;if(1==i.portable)n={goodsCategoryId:100060,regionId:p.getRegionId(),zoneId:i.zoneId,projectId:i.projectId,payMode:1,goodsDetail:{zoneId:i.zoneId,productInfo:[{name:"容量",value:i.diskSize+"GB→"+s+"GB"}],resourceId:i.cbsInstanceId,curDeadline:i.deadline,oldConfig:{cbsSize:i.diskSize,pid:a&&a.id,mediumType:"cbs"},newConfig:{cbsSize:s,pid:a&&a.id,mediumType:"cbs"}},goodsNum:"1"},!0===e&&(n.goodsDetail.hardPowerOffFlag=1);else{var r={diskInfo:{data:[{target:"xvde",type:a.type,size:s}]},modifyMode:"disk"};!0===e&&(r.hardPowerOffFlag=1),r[a.priceConfig.data]=parseInt(s),n={goodsCategoryId:100021,appId:p.getAppId(),projectId:t.projectId,zoneId:t.zoneId,regionId:p.getRegionId(),payMode:1,goodsNum:1,goodsDetail:{productInfo:[{name:"项目",value:t.projectName},{name:"主机名",value:t.uInstanceId},{name:"内网IP",value:t.deviceLanIp},{name:"所属网络",value:t.netName},{name:"可用区",value:t.zoneName},{name:"磁盘",value:i.diskSize+"=>"+s}],newConfig:r,curDeadline:t.deadline,resourceId:t.uInstanceId}}}return[n]},T.prototype.setPrice=function(e){var t=this,i=this.gridView.sUInstanceId,a=this.selectedCbs,s=(b.getCbsMetaByMedium(a.volumeType),this.cbsRange?this.cbsRange.val():0);if(1==this.selectedCbs.portable)g.querryStoragePrice({inquiryType:"resize",storageId:i,storageSize:s}).done(function(e){e&&l.el.find("[data-field=cost]").text(e.price/100)});else if(this.isCvmSecondPay());else{var n=this.collectData();d.getPrice({goodsDetail:n},function(e){t.upgradeCommon.setPriceUI(e,{})})}},T.prototype.getSelectedCbs=function(){for(var e,t,i=this.hasPermItems[0],a=this.gridView.sUInstanceId,s=0;t=i.cbsList[s];s++)if(t.cbsInstanceId==a){e=t;break}return e},T.prototype.isCbsSecondPay=function(){return"postpay"==this.selectedCbs.payMode},T.prototype.getPricePara=function(){var e=this.gridView.sUInstanceId;return this.upgradeCommon.getPriceParaForConfig(e)},T.prototype.getPriceParaForHour=function(e){this.hasPermItems[0];var t=this.upgradeCommon.getInputData();return e&&(t.cbsSize=this.selectedCbs.diskSize),t},T.prototype.tipsError=function(e){return this.restoreDialogBtn(),u.error(e)},T.prototype.toUpgrade=function(s){var n=this,r=this.hasPermItems[0],e=this.selectedCbs,t=this.cbsRange?this.cbsRange.val():0;if(this.isCbsSecondPay()){var o=this.getPricePara();if(t==e.diskSize)return this.tipsError("配置未变更!");Promise.all([this.upgradeCommon.checkSecondModeEnoughPay(),this.upgradeCommon.getConfigPricePid()]).then(function(e){var t=e[0],i=e[1];n.upgradeCommon.setRootPara(o.parts);var a={zoneId:r.zoneId,lanIp:r.deviceLanIp,uuid:r.uuid,pid:i,oldBillId:r.billId,parts:o.parts};!0===s&&(a.hardPowerOffFlag=1),t?d.upgradeHourCvm(a,function(e){e=e.data||e,l.hide(),n.checkTask(e,"调整磁盘中")}):n.upgradeCommon.showNotEnoughPay()}),v.click("yunzhuji.btn.upgradedisk.second")}else{var i=this.collectData(s);this.upgradeCommon.toUpgrade(i),v.click("yunzhuji.btn.upgradedisk.monthyear")}},i.exports=T}),define("modules/cvm2/event/vnc",function(e,t,i){e("$");var a=e("widget/cvmList/operate_base"),s=e("cvm/cvm/event/vnc"),n=function(e){a.call(this,e)};(n.prototype=new a).exec=function(){var e;e=this.hasPermItems[0];var t=new s({listIns:this,selectedItem:[e]});t.selectedItems=t.hasPermItems=this.hasPermItems,t.exec&&t.exec()},i.exports=n}),define("modules/cvm2/event/xentokvm/xentokvm",function(e,t,i){var a=e("$"),s=(e("manager"),e("dialog")),n='    <style type="text/css">    .swapnotes li{padding:4px 0; list-style-type:disc; margin-left: 20px}    .dialog-confirm-ck{position: absolute; left: 20px; top:20px; font-size: 14px}    </style><div class="tip_box">        <ul class="swapnotes">            <li>该服务器架构老旧，已不支持自动置换，请退还后重新购买。</li>            <li style="color:#f00">退还前请务必备份好重要数据。</li>            <li>如有疑问，请填写<a data-event="nav" href="/workorder">工单反馈</a></li>        </ul>    </div>',r={render:function(e){this.operIns=e,s.create(n,"640","",{title:"置换新服务器注意事项",preventResubmit:!0,button:{"确定":function(){s.hide()}}}),a("#confirmEnter").change(function(){var e=a(this).prop("checked");s.toggleBtnDisable(!e)})}};i.exports=r}),define("modules/cvm/main",function(e,t,i){e("$"),e("pageManager"),e("manager"),e("util");var a=e("appUtil"),s=e("modules/cvm2/cvmlist");i.exports={render:function(e,t){var i=arguments.length;2==i||(e=1==i?(t=e,""):(t=e,{})),"detail"==e||(!(0<a.getRegionId())&&a.setRegionId(1),s.render(t))},destroy:function(){s.destroy()}}}),define("modules/cvm2/search_box",function(e,t,i){var r,n,a=e("config/reactSupport"),o=e("manager"),d=e("appUtil"),c=e("tips"),l=/^(?:(?:[1-9]?[0-9]|1[0-9]{2}|2(?:[0-4][0-9]|5[0-5]))\.){3}(?:[1-9]?[0-9]|1[0-9]{2}|2(?:[0-4][0-9]|5[0-5]))$/,p=/^\d{1,3}((\.(\d{1,3})?)?){0,3}$/,u=/^ins-/,m=!1,h={key:-1,name:"全部项目"},v={key:"projectId",name:"所属项目",type:"single"},s={key:"vpcId",name:"vpcId",type:"input"},f={key:"subnetIds",name:"子网ID",type:"input"},g={key:"uHostIds",name:"宿主机ID",type:"input"},b=[],I=[{type:"input",key:"instanceName",name:"主机名"},{type:"input",key:"uInstanceIds",name:"主机ID"},{type:"input",key:"searchWord",name:"IP"},{type:"multiple",key:"zoneIdList",name:"可用区"},{type:"multiple",key:"deviceClassList",name:"主机类型"},{type:"multiple",key:"cvmPayModeList",name:"主机计费模式"}],y=function(e){if(n){if(n.zoneIdList){var i=e.zoneList,a=n.zoneIdList.map(function(e){for(var t=0;t<i.length;t++)if(i[t].zoneId==e)return{key:i[t].zoneId,name:i[t].zoneName}});b.push({values:a,attr:I[3]})}if(n.deviceClassList){var t=e.cvmTypeList;a=[];t.forEach(function(e){var t=!0;e.deviceClassList.forEach(function(e){-1==n.deviceClassList.indexOf(e)&&(t=!1)}),t&&a.push({key:e.deviceClassList.join(),name:e.name})}),b.push({values:a,attr:I[4]})}if(n.cvmPayModeList){var s=e.payModeList.cvm;a=n.cvmPayModeList.map(function(e){for(var t=0;t<s.length;t++)if(s[t].mode==e)return{key:s[t].mode,name:s[t].desciption}});b.push({values:a,attr:I[5]})}r&&r.setState({value:b}),n=null}},w=function(e){e=e||[];for(var t={},i=0;i<e.length;i++){var a=e[i];if(null==a.attr){var s="instanceName";l.test(a.values[0].name)?s="ips":p.test(a.values[0].name)?s="searchWord":u.test(a.values[0].name)&&(s="uInstanceIds"),t[s]=t[s]||[],t[s]=t[s].concat(a.values.map(function(e){return e.name}))}if(a.attr=a.attr||{},"projectId"==a.attr.key&&d.setProjectId(a.values[0].key),"projectId"!=a.attr.key||-1!=a.values[0].key)if("searchWord"==a.attr.key)l.test(a.values[0].name)?(t.ips=t.ips||[],t.ips=t.ips.concat(a.values.map(function(e){return e.name}))):(t.searchWord=t.searchWord||[],t.searchWord=t.searchWord.concat(a.values.map(function(e){return e.name})));else if("deviceClassList"==a.attr.key){var n=[];a.values.forEach(function(e){n=n.concat(e.key.split(","))}),t[a.attr.key]=n}else"instanceName"==a.attr.key?(t.instanceName=t.instanceName||[],t.instanceName=t.instanceName.concat(a.values.map(function(e){return e.name}))):"input"==a.attr.type?(t[a.attr.key]=t[a.attr.key]||[],t[a.attr.key]=t[a.attr.key].concat(a.values.map(function(e){return e.name}))):"single"==a.attr.type?t[a.attr.key]=a.values[0].key:t[a.attr.key]=a.values.map(function(e){return e.key})}if(t.instanceName){if(1<t.instanceName.length)return c.error("实例名称暂不支持批量模糊搜索"),null;t.instanceName=t.instanceName[0]}if(t.searchWord){if(1<t.searchWord.length)return c.error("IP段暂不支持批量模糊搜索"),null;t.searchWord=t.searchWord[0]}if(t.vpcId){if(1<t.vpcId.length)return c.error("vpcId暂不支持批量查询"),null;t.vpcId=t.vpcId[0]}return t.ips&&1==t.ips.length&&(t.searchWord=t.ips[0],delete t.ips),"undefined"==typeof t.projectId&&(m?-1!=d.getProjectId()&&d.setProjectId(-1):-1!=I.indexOf(v)&&(t.projectIdList=v.values.map(function(e){return e.key}))),t};t.init=function(s){var n=function(e){var t=w(e);t&&s&&s(t)};o.getProjects(function(e){if(e&&e.data&&e.data.length&&(1!=e.data.length||0!=e.data[0].projectId)){m=e.isShowAll;var i=d.getProjectId(),a=!1,s=m?[h]:[],n=null;if(e.data.forEach(function(e){var t={key:e.projectId,name:e.name};i==e.projectId&&(a=!0,n=t),s.push(t)}),!m&&!a)return d.setProjectId(s[0].key),void location.reload();a?b.push({attr:v,values:[n]}):b.push({attr:v,values:[h]}),-1==I.indexOf(v)&&(v.values=s,I.push(v))}}),a.useTea(function(){var e=window.tea.component.TagSearchBox,t=React.__SECRET_DOM_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,i=React.createClass({displayName:"TSearchBox",getInitialState:function(){return{value:b}},onChange:n,render:function(){return React.createElement(e,{attributes:I,minWidth:400,value:this.state.value,onChange:n})}});r=t.render(React.createElement(i,null),document.getElementById("searchArea"));var a=w(b);a&&s&&s(a)})},t.setData=function(e){!function(e){var t=e.zoneList,i=[];t.forEach(function(e){i.push({key:e.zoneId,name:e.zoneName})}),I[3].values=i;var a=e.cvmTypeList,s=[];a.forEach(function(e){s.push({key:e.deviceClassList.join(),name:e.name})}),I[4].values=s;var n=e.payModeList.cvm,r=[];n.forEach(function(e){r.push({key:e.mode,name:e.desciption})}),I[5].values=r,y(e)}(e)},t.setDefaultData=function(e){if(b=[],e.instanceName&&b.push({values:[{name:e.instanceName}],attr:I[0]}),e.uInstanceIds){var t=e.uInstanceIds.map(function(e){return{name:e}});b.push({values:t,attr:I[1]})}if(e.searchWord||e.ips){if(e.searchWord)t=[{name:e.searchWord}];else t=e.ips.map(function(e){return{name:e}});b.push({values:t,attr:I[2]})}if(e.vpcId&&(b.push({values:[{name:e.vpcId}],attr:s}),-1==I.indexOf(s)&&I.push(s)),e.subnetIds){t=e.subnetIds.map(function(e){return{name:e}});b.push({values:t,attr:f}),-1==I.indexOf(f)&&I.push(f)}if(e.uHostIds){t=e.uHostIds.map(function(e){return{name:e}});b.push({values:t,attr:g}),-1==I.indexOf(g)&&I.push(g)}n={zoneIdList:e.zoneIdList,deviceClassList:e.deviceClassList,cvmPayModeList:e.cvmPayModeList}}}),define("modules/cvm2/task",function(e,t,i){var x=e("$"),k=e("manager"),C=e("tips"),T=(e("util"),e("appUtil")),D=e("widget/msg/msg"),P=(e("constants"),e("widget/operatelog/floattips")),S=e("modules/cvm2/event/dropdown");return{check:function(e){var t=e.task,i=e.tipTxt,a=e.from,s=e.objBase,n=e.listIns,r=s,o=t.taskId,d=n.gridView,c=n.cvmListEl,l=e.regionId;l==undefined&&(l=T.getRegionId());var p=function(i){k.getFlowCscResult(i,function(e){var t=e.status;0===t?(n.refresh(),D.echo()):2===t?r.timeOut=setTimeout(function(){p(i)},3e3):(!x("#getFlowCscResultErrTip").length&&C.error("操作执行失败"),n.refresh(),D.echo())},null,a)};if(o){P.showTaskProcessTip({msg:i,business_id:1,task_id:o});var u='<span class="text-overflow restart">'+i+"</span>";c.find("[data-check-all]").prop("checked",!1);for(var m,h=r.permResult,v=h?h.hasPermItems:r.selectedItems,f=h?h.noPermItems:[],g=0;m=v[g];g++){if(w=m.el){var b=w.attr("data-index");m.statusDesc=u,m.$loading=!0,d.$refs.list[b].$set(m),S.refresh(w,n)}}for(var I,y=0;I=f[y];y++){var w;b=(w=I.el).attr("data-index");d.$refs.list[b].$set({$selected:!1})}p({taskId:o,regionId:l})}}}}),define("modules/cvm/cbs/cbs/useless",function(e,t,i){var u=e("$"),a=e("pageManager"),l=e("manager"),s=e("util"),m=e("appUtil"),n=(e("event"),e("projectsSelector")),r=e("widget/region/regionPills"),o=e("widget/fieldsManager/gridView"),p=e("modules/cvm/cbs/cbs/data"),d=(e("tips"),e("modules/cvm/cbs/cbsdetail")),c=e("modules/cvm/cbs/event/attach"),h=e("modules/cvm/cbs/event/modifyalias"),v=e("modules/cvm/cbs/event/createsnapshot"),f=e("modules/cvm/cbs/event/cancelattach"),g=e("modules/cvm/cbs/event/buy"),b=e("modules/cvm/cbs/event/renew"),I=e("modules/cvm/cbs/event/upgradedisk"),y=e("modules/cvm/cbs/event/exports"),w=e("modules/cvm/cbs/event/changeproject"),x=(e("models/api"),e("search"),e("router")),k=(e("reporter"),e("qccomponent")),C=e("contextmenu"),T=e("modules/cvm/cbs/operate_auth"),D=e("widget/grid/Action"),P=e("constants"),S=e("modules/cvm/cbs/cbsutil"),_=e("./monitor"),E=e("widget/i18n"),L=k.getComponent("grid-view").extend(E.getBeeConfig());L.tag("action",k.extend({$tpl:'    <a href="javascript:void(0);" data-event?="!disabled && act" class="{{disabled ? \'disable\' : \'\'}}" data-title?="disabled && title" >{{>$content}}</a>'}));var N,$=["renew","createsnapshot","upgradedisk","changeproject","attach","modifyalias","cancelattach","exports"],A=P.CBS_REGION,R=P.CBS_META_LIST,M=s.tmpl('    <div>    <div class="til">    <a href="javascript:void(0);" data-event="cbsdetail"><%=item.storageId%></a>         <% if(item.rollbacking){ %>         <div class="tc-15-bubble-icon tc-15-triangle-align-start" style="z-index:99">                          <i class="tc-icon plaint-icon"></i>                                 <div class="tc-15-bubble tc-15-bubble-top">                                       <div class="tc-15-bubble-inner">                   <p>云硬盘回滚成功，可正常使用。部分数据正在搬迁中，已完成<%=item.rollbackPercent%>%，搬迁过程中磁盘性能可能会下降15%。</p>                                            </div>                                </div>                     </div>        <% } %>           </div>    <p>       <span class="text-overflow m-width"><%=item.storageName%></span>       <i class="pencil-icon" data-title="改名" data-event="modifyalias"></i>    </p>   </div>',null);var j={param:{},title:"云硬盘-控制台",pageClass:"",render:function(){a.appArea.html(s.tmpl('<style>   .pencil-icon{visibility: hidden; cursor:pointer}</style><div class="manage-area">                <div class="manage-area-title">                    <h2>云硬盘</h2>                    <div id="projectsWrapper" class="tc-select-box"></div><div id="regionWrapper" class="tc-select-box"></div>                </div>                <div class="manage-area-main">                    <div id="operArea">                        <div class="tc-15-action-panel">                            <div b-template b-if="notI18n()">                                <button b-if="allowBuy" type="button" class="tc-15-btn m btn-add" data-event="buystorage"><b class="icon-add"></b> 新建</button>                                <button type="button" class="tc-15-btn m weak disabled" data-event="cbsattach">挂载</button>                                <button type="button" class="tc-15-btn m weak disabled" data-event="cancelattach">卸载</button>                            </div>                            <button class="tc-15-btn weak m download" data-event="exports"></button>                            <button class="tc-15-btn weak m setting" data-event="set_Fields" title="设置列表显示字段" data-hot="yunzhuji.setfields" data-grid-setting="true"></button>                            <div id="searchArea" class="pull-right"></div>                        </div>                    </div>                    <div id="cbsList"></div>                </div>            </div>',{})),this.bee=k.mount(a.appArea.children(".manage-area")[0],E.getBeeConfig()),this.cbsListEl=u("#cbsList"),this.searchAreaEl=u("#searchArea"),this.operAreaEl=u("#operArea"),this.renderBtnGroup(),this.initGridView(),this.bindEvent(),this.renderList(this.param)},renderBtnGroup:function(){var t=this,e=k.components["qc-search"],i=this.search=new e({$data:{keyword:"",searchEmpty:!0,multiple:!0,placeholder:"云硬盘ID，关联CVM内网IP"},search:function(){t.gridView.page=1,t.gridView.count=20,t.getList(),t.checkEvent([])}});this.searchAreaEl.html("").append(i.$el),this.projectsWrapperEl=u("#projectsWrapper"),this.regionWrapperEl=u("#regionWrapper"),this.projectsSelector=new n({renderTo:this.projectsWrapperEl,needAll:!1,selectedId:this.getProjectId({}),change:function(){t.gridView.page=1,t.gridView.count=20,t.getList(),t.checkEvent([])}}),this.regionSelector=new r({whiteList:A,$data:{global:!0,"short":!0,reset:!0}}),this.regionWrapperEl.html(this.regionSelector.$el),this.regionSelector.$on("selected",function(e){t.gridView.page=1,t.gridView.count=20,t.getList(),t.checkEvent([])})},renderList:function(e){var t=[].slice.call(arguments);this.getList.apply(this,t)},renderMenu:function(){var a=this,t=[{renew:{name:"续费",i18n:!1,callback:this.execContextMenu},createsnapshot:{name:"创建快照",callback:this.execContextMenu},upgradedisk:{name:"扩容",i18n:!1,callback:this.execContextMenu},changeproject:{name:"分配至项目",callback:this.execContextMenu},attach:{name:"挂载",i18n:!1,callback:this.execContextMenu},modifyalias:{name:"改名",callback:this.execContextMenu},cancelattach:{name:"卸载",i18n:!1,callback:this.execContextMenu},exports:{name:"导出信息",callback:this.execContextMenu}}],i=this;E.then(function(e){e&&t.forEach(function(t){Object.keys(t).forEach(function(e){!1===t[e].i18n&&delete t[e]})}),i.contextMenu=new C({object:i.cbsListEl,selector:"tbody tr",data:t,onShow:function(e,t,i){D.hideMenu(a.cbsListEl),a.displayOperMenu(t,i)}})})},bindEvent:function(){var t=this,e=this.bee,i=this.cbsListEl;e.$set("allowBuy",!0);var a={buystorage:function(e){g.init({projectId:t.getProjectId(),regionId:t.getRegionId()})},set_Fields:function(){t.gridView.showFieldsManager()},cancelattach:function(){if(!u(this).is(".disabled")){var e=t.gridView.getSelected();0<e.length&&t.exec("cancelattach",e)}},cbsattach:function(){if(!u(this).is(".disabled")){var e=t.gridView.getSelected();0<e.length&&t.exec("attach",e)}},exports:function(){var e=t.getFilter(t.param);e.allCbs=1,y(e)}};u("#operArea").on("click","[data-event]",function(e){var t=u(e.currentTarget).attr("data-event");t in a&&a[t].apply(this,arguments)}),i.on("mouseenter",".item-row",function(e){u(this).find(".pencil-icon").css("visibility","visible")}).on("mouseleave",".item-row",function(e){u(this).find(".pencil-icon").css("visibility","hidden")}),u(document).on("click",function(){i.find("tr[data-storageid] .tc-15-menu-active").hide(),i.find("tr[data-storageid] .tc-15-menu-disabled").show()})},exec:function(e,t){var i=this;switch(t||(t=i.gridView.getSelected()),e){case"attach":c.init(t,{projectId:i.getProjectId(),regionId:i.getRegionId(),callback:i.refresh.bind(i)});break;case"modifyalias":h.init(t,{callback:i.refresh.bind(i)});break;case"createsnapshot":v.init(t,{projectId:i.getProjectId(),regionId:i.getRegionId(),callback:i.refresh.bind(i)});break;case"cancelattach":f.init(t,{projectId:i.getProjectId(),regionId:i.getRegionId(),callback:i.refresh.bind(i)});break;case"renew":b.init(t,{projectId:i.getProjectId(),regionId:i.getRegionId()});break;case"upgradedisk":I.init(t[0],{projectId:i.getProjectId(),regionId:i.getRegionId(),callback:i.refresh.bind(i)});break;case"changeproject":w.init(t,{projectId:i.getProjectId(),regionId:i.getRegionId(),callback:i.refresh.bind(i)});break;case"exports":var a=i.getFilter(i.param);a.searchValue=t[0]&&t[0].storageId,y(a)}},initGridView:function(){var i,a=this,s={$data:{hasFirst:!0,orderField:"addTimeStamp",order:1,initGetData:!1,canResizeColum:!0,selectedHighlight:!1,colums:a.getColumns(),list:[],canSelectTotal:!1,autoMaxHeight:!0,maxHeightOffset:10,autoCheckWidth:!1,showState:!0,showPagination:!0,totalNum:0,trackKey:"uuid",searchItemName:"云主机"},$mixins:[o("cbs_fields")],getCellContent:function(e,t,i){return a.getCellContent(e,t,i)},portableFilterOptions:[{label:"支持",value:"1"},{label:"不支持",value:"0"}],storageTypeFilterOptions:(i=[],R=R||[],u.each(R,function(e,t){i.push({label:t.name,value:t.value})}),i),diskTypeFilterOptions:[{label:"系统盘",value:"root"},{label:"数据盘",value:"data"}],payModeDescFilterOptions:[{label:"包年包月",value:"prePay"},{label:"按量计费",value:"postPay"}],storageStatusFilterOptions:[{label:"已挂载",value:"normalSuccess"},{label:"待挂载",value:"normalFail"},{label:"待回收",value:"toRecycle"},{label:"挂载中",value:"attaching"},{label:"解挂中",value:"detaching"},{label:"快照创建中",value:"snapshotCreating"},{label:"回滚中",value:"rollback"},{label:"扩容中",value:"expanding"}],getHeadContent:function(e){return"attachedDesc"===e.key?'<grid-view-header-filter b-ref="portableFilter" b-with="{ ready: portableFilterReady.bind(this.$root), filterOptions: portableFilterOptions, col: col, change: filterhange.bind(this.$root) }"></grid-view-header-filter>':"storageTypeDesc"===e.key?'<grid-view-header-filter b-ref="storageTypeFilter" b-with="{ ready: storageTypeFilterReady.bind(this.$root), filterOptions: storageTypeFilterOptions, col: col, change: filterhange.bind(this.$root) }"></grid-view-header-filter>':"diskTypeDesc"===e.key?'<grid-view-header-filter b-ref="diskTypeFilter" b-with="{ ready: diskTypeFilterReady.bind(this.$root), filterOptions: diskTypeFilterOptions, col: col, change: filterhange.bind(this.$root) }"></grid-view-header-filter>':"payModeDesc"===e.key?'<grid-view-header-filter b-ref="payModeFilter" b-with="{ ready: payModeFilterReady.bind(this.$root), filterOptions: payModeDescFilterOptions, col: col, change: filterhange.bind(this.$root) }"></grid-view-header-filter>':"storageStatus"===e.key?'<grid-view-header-filter b-ref="storageStatusFilter" b-with="{ ready: storageStatusFilterReady.bind(this.$root), filterOptions: storageStatusFilterOptions, col: col, change: filterhange.bind(this.$root) }"></grid-view-header-filter>':void 0},portableFilterReady:function(e){this.portableFilter=e},storageTypeFilterReady:function(e){this.storageTypeFilter=e},diskTypeFilterReady:function(e){this.diskTypeFilter=e},payModeFilterReady:function(e){this.payModeFilter=e},storageStatusFilterReady:function(e){this.storageStatusFilter=e},filterhange:function(e){a.gridLoaded&&(a.gridView.page=1,a.gridView.count=20,a.getList(),a.checkEvent([]))},setTrAttr:function(e,t){return e={"data-storageId":t.storageId},t.$loading&&(e["data-isLoading"]=!0),e},getSlectItem:function(t){var s=[];return u(a.gridView.list).each(function(e,a){u(t).each(function(e,t){var i=u(t).closest("tr").data("storageid");a.storageId==i&&s.push(a)})}),s},events:{"click tr .tc-15-dropdown":function(e){e.stopPropagation(),u(e.target).closest("td").find(".tc-15-menu-active").toggle(),u(e.target).closest("td").find(".tc-15-menu-disabled").toggle()},"click tr [data-event=cbsdetail]":function(e){var t=a.gridView.getSlectItem(e.target);x.navigate("/cvm/cbs/detail?storageId="+t[0].storageId)},"click tr [data-event=cbs_view]":function(e){var t=u(e.target).closest("tr").data("index");_.showList(a.gridView.list,t,function(e){var t=u("#cbsList"),i=t.find('tr[data-storageid="'+e+'"]');i.length&&(t.find("input:checkbox").removeProp("checked"),i.find("input:checkbox").prop("checked","true"))})},"click tr [data-event=cbsattach]":function(e){var t=a.gridView.getSlectItem(e.target);a.gridView.updateselect(t),c.init(t,{projectId:a.getProjectId(),regionId:a.getRegionId(),callback:a.refresh.bind(a)})},"click tr [data-event=cancelattach]":function(e){var t=a.gridView.getSlectItem(e.target);a.gridView.updateselect(t),f.init(t,{projectId:a.getProjectId(),regionId:a.getRegionId(),callback:a.refresh.bind(a)})},"click tr [data-event=modifyalias]":function(e){var t=a.gridView.getSlectItem(e.target);a.gridView.updateselect(t),h.init(t,{callback:a.refresh.bind(a)})},"click tr [data-event=createsnapshot]":function(e){var t=a.gridView.getSlectItem(e.target);a.gridView.updateselect(t),v.init(t,{projectId:a.getProjectId(),regionId:a.getRegionId(),callback:a.refresh.bind(a)})},"click tr [data-event=renew]":function(e){var t=a.gridView.getSlectItem(e.target);b.init(t,{projectId:a.getProjectId(),regionId:a.getRegionId()}),a.gridView.updateselect(t)},"click tr [data-event=upgradedisk]":function(e){var t=a.gridView.getSlectItem(e.target);a.gridView.updateselect(t),I.init(t[0],{projectId:a.getProjectId(),regionId:a.getRegionId()})},"click tr [data-event=changeproject]":function(e){var t=a.gridView.getSlectItem(e.target);a.gridView.updateselect(t),w.init(t,{projectId:a.getProjectId(),regionId:a.getRegionId(),callback:a.refresh.bind(a)})},"click tr [data-event=exports]":function(e){var t=a.gridView.getSlectItem(e.target),i=a.getFilter(a.param);i.searchValue=t[0]&&t[0].storageId,y(i)},"click tr[data-storageid] input[type=checkbox]":function(e){var t=a.gridView.getSlectItem(u("tr[data-storageid] input[type=checkbox]:checked"));a.checkEvent(t)},"click tr :checkbox:eq(0)":function(e){a.checkEvent(a.gridView.list)}},updateselect:function(e){var i={};u(a.gridView.list).each(function(e,t){i[t.storageId]=e,a.gridView.updateItem(e,{$selected:!1})}),u(e).each(function(e,t){a.gridView.updateItem(i[t.storageId],{$selected:!0})})},getData:function(e,t){this.order=e.order,this.orderField=e.orderField,this.page=e.page,this.count=e.count,a.getList(),a.checkEvent([])}};E.syncThen(function(e){if(e){var t=s.$data,i=t.colums=t.colums.filter(function(e){return!1!==e.i18n});a.gridView&&a.gridView.setColums(i)}}),a.gridView=new L(s),a.cbsListEl.append(a.gridView.$el),this.gridLoaded=!1,this.gridView.portableFilter&&this.gridView.portableFilter.setFilterResult(this.param.portable),this.gridView.storageTypeFilter.setFilterResult(this.param.storageTypes),this.gridView.diskTypeFilter.setFilterResult(this.param.diskType),this.gridView.payModeFilter&&this.gridView.payModeFilter.setFilterResult(this.param.payMode),this.gridView.storageStatusFilter.setFilterResult(this.param.storageStatus),this.param.storageIds&&this.search.$set("keyword",this.param.storageIds.join("\n"))},goDetail:function(e){var i=this,a=e.storageId||e.diskId,s=e.rid||i.getRegionId();!function n(e,t){e.init({storageId:a,regionId:s,projectId:i.getProjectId()},{formateData:t.formateData,callback:function(){x.navigate("/cvm/cbs")}})}(d,j)},execContextMenu:function(e,t){j.execRowMenuItem(e,t)},execRowMenuItem:function(e,t){for(var i=u(e).attr("data-index"),a=this.gridView,s=0,n=a.list.length;s<n;s++)a.$refs.list[s].$set({$selected:!1});a.$refs.list[i].$set({$selected:!0}),this.selectedChange(),this.exec(t.attr("data-name"))},getProjectId:function(e){return m.getProjectId()},getRegionId:function(e){return m.getRegionId()},getFilter:function(e){var t=function(e){if(e&&e.shift){if(1===e.length)return e[0]}else if(e)return e;return null},i=this.search&&this.search.getKeyword().trim()||"",a=u.extend(!0,[],this.gridView.storageStatusFilter.$data.filterResult),s=null;if(a&&a.length)if(this.gridView.storageStatusFilter.allChecked)a=null;else{var n=a.filter(function(e){return"normalSuccess"==e||"normalFail"==e});a.forEach(function(e,t){"normalSuccess"==e?(a[t]="normal",s=1):"normalFail"==e&&(a[t]="normal",s=0)}),n&&2==n.length&&(s=null)}var r=e&&0<e.page?e.page:this.gridView.page,o=e&&0<e.order?e.order:this.gridView.order,d=e&&0<e.orderField?e.orderField:this.gridView.orderField,c=e&&0<e.count?e.count:this.gridView.count;e={offset:(r-1)*c,limit:c,projectId:this.getProjectId(),regionId:this.getRegionId(),portable:t(this.gridView.portableFilter&&this.gridView.portableFilter.$data.filterResult),storageTypes:this.gridView.storageTypeFilter.$data.filterResult,diskType:t(this.gridView.diskTypeFilter.$data.filterResult),payMode:t(this.gridView.payModeFilter&&this.gridView.payModeFilter.$data.filterResult),storageStatus:a,attached:s,searchValue:i,order:o,orderField:d};for(var l in e)null==e[l]&&delete e[l];return-1==e.projectId&&delete e.projectId,e},getList:function(d){var c=this;this.operAreaEl;d=this.getFilter(d),u.when(p.queryCbsStorages(d),p.queryZone(this.getRegionId({}))).done(function(a,s){var e=a.storageSet,t=[];c.gridLoaded=!0;for(var i=0,n=e.length,r=0;i<n;i++)null!=e[i].uInstanceId&&-1==t.indexOf(e[i].uInstanceId)&&(t[r++]=e[i].uInstanceId);if(t.length)l.getCvmList({count:t.length,offset:0,regionId:c.getRegionId(),uInstanceIdList:t},function(e){var t=e.deviceList,i=c.formateData(a.storageSet,s,t);c.gridView.checkCellWidth(),c.renderMenu(),c.gridView.setData({list:i,totalNum:a.totalCount,page:Math.floor(d.offset/d.limit)+1,count:d.limit}),c.checkTask(),i&&0<i.length||c.gridView.showTips('<span class="text"></span>您查看的对象已不存在或没有权限查看')},function(){c.gridView.setData({list:[],totalNum:0,page:d.page,count:d.count}),c.gridView.checkCellWidth(),c.gridView.showTips("系统繁忙，请稍后重试。")});else{var o=c.formateData(a.storageSet,s);c.gridView.checkCellWidth(),c.renderMenu(),c.gridView.setData({list:o,totalNum:a.totalCount,page:Math.floor(d.offset/d.limit)+1,count:d.limit,orderField:d.orderField,order:d.order}),c.checkTask(),o&&0<o.length||c.gridView.showTips('<span class="text"></span>您查看的对象已不存在或没有权限查看')}}).fail(function(){c.gridView.setData({list:[],totalNum:0,page:d.page,count:d.count}),c.gridView.checkCellWidth(),c.gridView.showTips("系统繁忙，请稍后重试。")})},statusDescMapTxt:{normal:[["已挂载","待挂载"],["success","warning"]],attaching:["挂载中",""],detaching:["卸载中",""],expanding:["扩容中",""],toRecycle:["待回收","danger"],snapshotCreating:["创建快照中",""],rollback:["回滚中",""],isolated:["欠费隔离","danger"]},statusDesc:function(e){var t=this.statusDescMapTxt[e.storageStatus];"normal"==e.storageStatus?1==e.attached?(e.statusDesc=t[0][0],e.statusDesClass=t[1][0]):(e.statusDesc=t[0][1],e.statusDesClass=t[1][1]):(e.statusDesc=t?t[0]:"未知状态",e.statusDesClass=t?t[1]:"success"),e.$loading=!1,0<=u.inArray(e.storageStatus,["attaching","detaching","expanding","snapshotCreating","rollback"])&&(e.$loading=!0)},formateData:function(d,e,c){c!=undefined&&(c=c);var l=j,p={};return e.forEach(function(e){p[e.zoneId]=e.zoneName}),u(d).each(function(e,t){var i,a,s=S.getCbsMetaByValue(t.storageType);if(t.diskTypeDesc="root"==t.diskType?"系统盘":"数据盘",t.storageTypeDesc=s.name,t.payModeDesc="prePay"==t.payMode?"包年包月":"按量计费",c&&c.length)for(var n=0,r=c.length;n<r;n++)t.uInstanceId==c[n].uInstanceId&&(t.uInstanceStatus=c[n].runflag);t.isAttach=!1,t.isUpgrade=!1,t.isCancelAttach=!1,t.isAlias=!1,t.isRenew=!1,t.isSnapAbility=!1,t.isChangeProject=!1,t.isExports=!0,t.isUp=(i=d.length,a=!1,4<=i&&i-5<e&&(a=!0),i<=6&&e<3&&(a=!1),a),"1"==t.snapshotAbility&&-1<P.SNAPSHOT_REGION_LIST.indexOf(m.getRegionId()+"")&&(t.isSnapAbility=!0),t.rollbacking&&(t.isSnapAbility=!1),1==t.portable&&"toRecycle"!=t.storageStatus&&(t.isRenew=!0),t.storageSizeDesc=t.storageSize+"G",t.zoneName=p[t.zoneId]||"",t.regionId=l.getRegionId(),t.deadlineTimeDesc=function o(e,t){var i=0,a=t&&!isNaN(t)?t:(new Date).getTime();return e?(i=a-new Date(e.replace(/\-/g,"/")).getTime(),"0000-00-00 00:00:00"==e?"-":0<i?6048e5<i?'<span class="text-overflow status-recover">已回收</span>':'<span class="text-overflow status-recover error">'+(7-Math.floor(i/864e5))+"天后回收</span>":i<-6048e5?e.substring(0,19):'<span class="text-overflow warning">'+Math.abs(Math.floor(i/864e5))+"天后到期</span>"):"-"}(t.deadlineTime),l.statusDesc(t),"normal"==t.storageStatus&&(t.isAlias=!0,1==t.attached?1==t.portable&&(t.isCancelAttach=!0):(1==t.portable&&(t.isAttach=!0),t.isChangeProject=!0)),l.canDiskUpgrade(t)&&(t.isUpgrade=!0),t.attachedDesc=1==t.portable?"支持":"不支持"}),d},canDiskUpgrade:function(e){var t=j,i=!1;return"normal"==e.storageStatus&&t.isexpired(e.deadlineTime)&&(1==e.portable?1==e.attached?4==e.uInstanceStatus&&(i=!0):i=!0:"data"==e.diskType&&4==e.uInstanceStatus&&(i=!0)),i},isexpired:function(e){var t=!1;if(e&&"0000-00-00 00:00:00"!=e){var i=new Date(e.replace(/\-/g,"/"));(new Date).getTime()<i.getTime()&&(t=!0)}else t=!0;return t},getCellContent:function(e,t,i){return"storageId"==i.key?M({item:t}):"storageStatus"==i.key?'<div><span class="text-overflow m-width text-'+t.statusDesClass+'">'+t.statusDesc+"</span></div>":"uInstanceId"==i.key?t.uInstanceId?0==t.attached?'<div><a class="text-warning" data-title="该虚拟机为弹性云盘欠费前关联的服务器，您重新挂载后可使用" href="/cvm/detail/'+t.regionId+"/"+t.uInstanceId+'">'+t.uInstanceId+"</a></div>":'<div><a href="/cvm/detail/'+t.regionId+"/"+t.uInstanceId+'">'+t.uInstanceId+"</a></div>":"<div>-</div>":"_operCol"==i.key?undefined:"_monitor"==i.key?s.tmpl('    <a href="javascript:;" data-event="cbs_view" class="icon-monitor">监控</a>',{}):"<div>"+(e||"")+"</div>"},getColumns:function(){return[{key:"storageId",name:"ID/名称",width:"",minWidth:150,required:!0,orderField:"alias"},{key:"_monitor",name:"监控",width:50,required:!0},{key:"storageStatus",name:"状态",width:120,required:!0},{key:"storageSizeDesc",name:"容量",width:100,required:!0},{key:"zoneName",name:"可用区",width:90,required:!0},{key:"attachedDesc",name:"\t可挂载/卸载",width:150,minWidth:150,i18n:!1,required:!0},{key:"storageTypeDesc",name:"磁盘类型",width:150},{key:"diskTypeDesc",name:"磁盘属性",width:150,minWidth:150},{key:"uInstanceId",name:"已挂载云主机",width:150},{key:"payModeDesc",name:"计费模式",i18n:!1,width:160},{key:"deadlineTimeDesc",name:"到期时间",order:!0,orderField:"deadlineTime",i18n:!1,width:160,minWidth:160},{key:"_operCol",name:"操作",required:!0,width:200,minWidth:200,tdTpl:'    <div class="operating-group">        <action b-if="notI18n()" act="renew" disabled="{{!item.isRenew}}" title="{{ item.payMode==\'prePay\' ? \'与CVM一同购买的云硬盘，在CVM续费时，将一并续费\' : (item.payMode==\'postPay\' ? \'按量计费的云硬盘，无需续费，请保持账户余额充足\' : \'\') }}">续费</action>        <action act="createsnapshot" disabled="{{!item.isSnapAbility}}">创建快照</action>        <div class="tc-15-dropdown tc-15-menu-disabled">            <a href="javascript:;" class="tc-15-dropdown-link tc-15-dropdown-link-special">更多<i class="caret"></i></a>        </div>        <div class="tc-15-dropdown tc-15-menu-active {{item.isUp ? \'tc-15-dropup\' : \'\'}}" style="display: none;">            <a href="javascript:" class="tc-15-dropdown-link tc-15-dropdown-link-special">更多<i class="caret"></i></a>            <div class="tc-15-dropdown-menu-box">                <ul class="tc-15-dropdown-menu" role="menu">                    <li b-if="notI18n()">                        <action act="upgradedisk" disabled="{{!item.isUpgrade}}" title="已挂载到云服务器的云硬盘，当服务器处于关机状态时，数据盘支持磁盘扩容。（系统盘暂时不支持扩容）">扩容</action>                    </li>                    <li b-if="notI18n()">                        <action act="cbsattach" disabled="{{!item.isAttach}}">挂载到云主机</action>                    </li>                    <li>                        <action act="changeproject" disabled="{{!item.isChangeProject}}">分配至项目</action>                    </li>                    <li>                        <action act="modifyalias" disabled="{{!item.isAlias}}">改名</action>                    </li>                    <li b-if="notI18n()">                        <action act="cancelattach" disabled="{{!item.isCancelAttach}}">卸载</action>                    </li>                    <li>                        <action act="exports" disabled="{{!item.isExports}}">导出信息</action>                    </li>                </ul>            </div>        </div>    </div>',locked:!0}]},selectedChange:function(){var e=this.gridView.getSelected();this.toggleBtnStatus(e,u("#operArea"))},displayOperMenu:function(e,t){var i=this.gridView.getSlectItem(t);this.toggleBtnStatus(i,e)},toggleBtnStatus:function(e,i){var a=new T({dataItems:e,operAction:$}).getAuth();$.forEach(function(e){var t=i.find('[data-name="'+e+'"]');0==a[e].code?m.enableBtn(t):m.disableBtn(t,a[e].tip)})},checkEvent:function(e){var i=[],a=[];u(e).each(function(e,t){t&&t.isAttach&&i.push(t),t&&t.isCancelAttach&&a.push(t)});var t=u("#operArea").find("[data-event=cancelattach]"),s=u("#operArea").find("[data-event=cbsattach]");0===i.length&&0===a.length&&0==e.length?(s.addClass("disabled").attr("data-title","请选择需要挂载的云硬盘"),t.addClass("disabled").attr("data-title","请选择需要卸载的云硬盘")):(i.length==e.length?10<i.length?s.addClass("disabled").attr("data-title","批量挂载数量不可大于10"):s.removeClass("disabled").attr("data-title",""):s.addClass("disabled").attr("data-title","未挂载的弹性云硬盘才可以挂载"),a.length==e.length?10<a.length?t.addClass("disabled").attr("data-title","批量卸载数量不可大于10"):t.removeClass("disabled").attr("data-title",""):t.addClass("disabled").attr("data-title","已挂载且未做任务的弹性云硬盘才可以卸载"))},refresh:function(e){var t=this.getFilter();this.renderList(t,e),this.checkEvent([])},checkTask:function(){var i=this,e=this.cbsListEl.find("[data-grid-body] tr");this.isWating=!1,e.each(function(e,t){if(u(t).attr("data-isLoading"))return!(i.isWating=!0)}),this.clearCheckTask(),this.isWating?this.watingTime=setTimeout(function(){e.find(":checkbox:checked").length||m.isContextMenuShow()||D.isMenuActivated(e)?i.checkTask():N&&(i.refresh(),N--)},5e3):this.setmaxReqNum()},setmaxReqNum:function(){N=100},clearCheckTask:function(){clearTimeout(this.watingTime)}};i.exports={render:function(t,i){e.async("cvm/cbs2/cbslist",function(e){(j=e).render(t,i)})},oldRender:function(e,t){var i=arguments.length;2==i||(e=1==i?(t=e,""):(t=e,{})),"detail"==e?("string"==typeof t&&(t={storageId:t}),j.goDetail(t)):(!(0<m.getRegionId())&&m.setRegionId(1),t&&t.storageIds&&(t.storageIds=t.storageIds.split(",")),j.param=u.extend(function a(){return u.extend({page:1,count:20,portable:null,payMode:null,storageStatus:"",attached:null,storageTypes:null,diskType:null,projectId:-1,regionId:0,storageIds:"",searchValue:"",orderField:"",order:0},!0)}(),t,!0),j.render())},destroy:function(){j&&j.destroy&&j.destroy()}}}),define("modules/cvm/cbs/cbsdetail",function(e,t,i){var s,p=e("$"),u=e("router"),n=e("pageManager"),a=(e("models/api"),e("modules/cvm/cbs/cbs/data")),m=e("manager"),r=e("modules/cvm/cbs/event/attach"),o=e("modules/cvm/cbs/event/modifyalias"),d=e("modules/cvm/cbs/event/createsnapshot"),c=e("modules/cvm/cbs/event/cancelattach"),l=e("modules/cvm/cbs/event/renew"),h=e("modules/cvm/cbs/event/upgradedisk"),v=e("util"),f=e("appUtil"),g=e("dialog"),b=e("widget/copy/copy"),I=e("qccomponent"),y=I.getComponent("grid-view"),w=e("modules/cvm/cbs/cbsutil"),x=e("./monitor"),k={main:'<div class="manage-area">                <div class="manage-area-title secondary-title">                    <a href="javascript:void(0);" class="back-link"><i class="btn-back-icon"></i>返回</a>                    <span class="line-icon">|</span>                    <h2>{{item.storageId}}详情</h2>                </div>                <div class="manage-area-main secondary-main">                    \x3c!-- tab --\x3e                    <div class="tc-15-tab tc-15-tab-alt">                        <ul role="tablist" class="tc-15-tablist" id="cbsList">                            <li class="tc-cur" b-attr="tab_detail" b-on-click="tab(\'detail\')"><a href="javascript:void(0);" role="tab">参数</a></li>                            <li b-attr="tab_optlog" b-on-click="tab(\'optlog\')"><a href="javascript:void(0);" role="tab">操作日志</a></li>                            <li b-attr="tab_monitor" b-on-click="tab(\'monitor\')"><a href="javascript:void(0);" role="tab">磁盘监控</a></li>                        </ul>                        \x3c!-- 参数 --\x3e                        <div class="tab-panel param-panel" b-if="isShowInfo">                            \x3c!-- 参数列表 开始 --\x3e                            <div class="param-box">                                <div class="param-hd">                                    <h3>云硬盘信息</h3>                                </div>                                <div class="param-bd">                                    <ul class="item-descr-list">                                        <li>                                            <span class="item-descr-tit">名称</span>                                            <span class="item-descr-txt">{{item.storageName}}                                            <a b-if="item.isAlias" class="edit" href="javascript:void(0);" data-event="modifyalias">改名</a>                                            </span>                                        </li>                                        <li>                                            <span class="item-descr-tit">资源ID</span>                                            <span class="item-descr-txt viewIpCopyWrap">{{item.storageId}}<a href="javascript:;" data-clipboard-text={{item.storageId}} style="display:none;">复制</a></span>                                        </li>                                        <li>                                            <span class="item-descr-tit">状态</span>                                            <span class="text-success">{{item.statusDesc}}</span>                                        </li>                                        <li b-if="!item.proejctNull">                                            <span class="item-descr-tit">所属项目</span>                                            <span class="item-descr-txt">{{item.projectName}}</span>                                        </li>                                        <li>                                            <span class="item-descr-tit">地域</span>                                            <span class="item-descr-txt">{{item.regionName}}</span>                                        </li>                                        <li>                                            <span class="item-descr-tit">可用区</span>                                            <span class="item-descr-txt">{{item.zoneName}}</span>                                        </li>                                        <li>                                            <span class="item-descr-tit">磁盘类型</span>                                            <span class="item-descr-txt">{{item.storageTypeDesc}}</span>                                        </li>                                        <li>                                            <span class="item-descr-tit">磁盘属性</span>                                            <span class="item-descr-txt">{{item.diskTypeDesc}}</span>                                        </li>                                        <li>                                            <span class="item-descr-tit">云硬盘容量</span>                                            <span class="item-descr-txt">                                            {{item.storageSizeDesc}}                                            <a b-if="item.isUpgrade" class="edit" href="javascript:void(0);" data-event="upgradedisk">扩容</a></span>                                        </li>                                        <li>                                            <span class="item-descr-tit">已挂载云主机</span>                                            <span b-if="item.uInstanceId" class="item-descr-txt viewIpCopyWrap">                                                <a data-event="nav" href="/cvm/detail/{{item.regionId}}/{{item.uInstanceId}}">{{item.uInstanceId}}</a>                                                <a href="javascript:;" data-clipboard-text={{item.uInstanceId}} style="display:none;">复制</a>                                                <a b-if="item.isCancelAttach" class="edit" href="javascript:void(0);" data-event="cancelattach">卸载</a>                                            </span>                                            <span b-if="!item.uInstanceId && item.isAttach" class="item-descr-txt">                                                未挂载 <a class="edit" href="javascript:void(0);" data-event="cbsattach">挂载</a>                                            </span>                                        </li>                                        <li>                                                                                    <span class="item-descr-tit">云主机名称</span>                                            <span b-if="item.uInstanceId" class="item-descr-txt">                                                <a data-event="nav" href="/cvm/detail/{{item.regionId}}/{{item.uInstanceId}}">{{item.uInstanceName}}</a>                                                <a b-if="item.isCancelAttach" class="edit" href="javascript:void(0);" data-event="cancelattach">卸载</a>                                            </span>                                            <span class="item-descr-txt">                                        </li>                                        <li>                                            <span class="item-descr-tit">可卸载</span>                                            <span class="item-descr-txt">{{item.attachedDesc}}</span>                                        </li>                                        <li>                                            <span class="item-descr-tit">计费模式</span>                                            <span class="item-descr-txt">{{item.payModeDesc}}                                               <a b-if="item.isRenew" class="edit" href="javascript:void(0);" data-event="renew">续费</a>                                            </span>                                        </li>                                        <li>                                            <span class="item-descr-tit">定期快照策略</span>                                            <span b-if="item.aspId" class="item-descr-txt viewIpCopyWrap">                                                <a data-event="nav" href="/cvm/snapshot/asp_detail/{{item.aspId}}">{{item.aspId}}</a>                                                ({{item.aspPolicy}})                                            </span>                                            <span b-if="!item.aspId" class="item-descr-txt">                                                未关联                                            </span>                                        </li>                                        <li>                                            <span class="item-descr-tit">创建时间</span>                                            <span class="item-descr-txt">{{item.createTime}}</span>                                        </li>                                        <li>                                            <span class="item-descr-tit">到期时间</span>                                            <span class="item-descr-txt">{{{item.deadlineTimeDesc}}}</span>                                        </li>                                        <li>                                            <span class="item-descr-tit">本磁盘快照</span>                                            <span class="item-descr-txt">                                                {{{ item.snashotsTxt }}}                                                 <a b-if="item.isSnapAbility" class="edit" href="javascript:void(0);" data-event="createsnapshot"> 创建快照</a>                                            </span>                                        </li>                                    </ul>                                </div>                            </div>                            \x3c!-- 参数列表  --\x3e                        </div>                        \x3c!-- 操作日志 --\x3e                        <div class="tab-panel log-panel"  b-if="isShowLog">                            <div class="log-param snap-log-param">                                <div class="justify-grid">                                    <div class="col">                                        <qc-date-picker b-ref="datePicker">                                        <script type="text/json" data>                                          {                                            "showCalendar": true,                                            "tabs": [{                                              "label": "实时",                                              "from": "%TODAY",                                              "to": "%TODAY"                                            }, {                                              "label": "近7天",                                              "from": "%TODAY-7",                                              "to": "%TODAY"                                            }, {                                              "label": "近15天",                                              "from": "%TODAY-15",                                              "to": "%TODAY"                                            }, {                                              "label": "近30天",                                              "from": "%TODAY-30",                                              "to": "%TODAY"                                            }],                                            "selected": {"from": "%TODAY", "to": "%TODAY"}                                          }                                        <\/script>                                      </qc-date-picker>                                    </div>                                </div>                                                            <optlog-gridview b-ref="grid"></optlog-gridview>                            </div>                        </div>                        \x3c!-- 磁盘监控 --\x3e                        <div class="tab-panel monitor-panel" b-if="isShowMonitor">                             <div class="tc-15-data-graph" id="monitorRender">                             </div>                        </div>                    </div>                </div>            </div>',cbs_null:'<div class="ui-popmsg">    <div class="info">        <p>该云硬盘已退订或删除，请返回重新操作 </p>    </div></div>',optResult:'<span class="text-success" b-if="item.status == 0">成功</span><span class="text-danger" b-if="item.status == 1">失败</span><span b-if="item.status == 2">进行中</span>',monitorShow:'            <ul>            <style>                ul li .guide-layer{                   height: 200px;                   width:100px;                   position: relative;                   left:200px;                }            </style>                  <% for(var i=0;i<chartList.length;i++){ %>                     <li>                        <div class="tc-15-data-graph-title">                              <strong class="tc-15-data-graph-title"><%=chartList[i].name%>&nbsp;<em class="text-unit" style="color:#A2A2A2">(单位：<%=chartList[i].unit%>)</em></strong>                        </div>                        <div class="tc-15-data-graph-info" id="<%=chartList[i].type%>" data-unit="<%=chartList[i].unit%>">                        </div>                     </li>                     <% } %>            </ul>',noData:'  <div class="txt-info-wrap">     <p class="txt-info">该云硬盘未被挂载，暂无数据</p>  </div>',errorTip:'<div class="txt-info-wrap"><p class="txt-info">暂无数据</br>  <a style="font-size:12px;" href="http://'+QCMAIN_HOST+'/doc/product/248/%E4%BA%91%E7%9B%91%E6%8E%A7%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98"  target="_blank">查看可能导致无数据的原因</a></p>  </div>'},C=I.extend({$tpl:k.main,tab:function(e){T.tab(e)}});C.tag("optlog-gridview",y.extend({getData:function(e){T.opts=e,T.renderGrid()}},{defaults:{colums:[{name:"操作",key:"task_title",width:180,order:!1,required:!0,tdTpl:k.id},{name:"操作结果",key:"status",width:180,order:!1,required:!0,tdTpl:k.optResult},{name:"操作人帐号名称",key:"operate_uin",width:180,order:!1,required:!0},{name:"操作时间",key:"begin_time",width:180,order:!1,required:!0}],emptyTips:"当前过滤条件下没有相应的云硬盘操作日志",searchItemName:"云硬盘操作日志",initGetData:!1,hasFirst:!1}}));var T={init:function(e,c){this.opts={count:20,page:1,order:1,orderField:""};var l=this;this.storageId=e.storageId,this.regionId=e.regionId,this.projectId=e.projectId,p.when(a.querySnapshots({regionId:l.regionId,storageIds:[e.storageId],mc:1}),a.queryCbsStorages({regionId:l.regionId,storageIds:[e.storageId]}),a.queryAspByCbs({regionId:l.regionId,storageId:e.storageId}),a.queryZone(l.regionId),a.getProjects(),this.queryRegion()).done(function(e,t,i,a,s,n){if(t&&t.storageSet&&0==t.storageSet.length)g.create(k.cbs_null,"550","",{title:"云硬盘",preventResubmit:!1,defaultCancelBtn:!1,button:{"确定":function(e){u.navigate("/cvm/cbs")}}});else{var r=c.formateData(t.storageSet,a),o=[];if(p(e.snapshotSet).each(function(e,t){o.push("<a href='/cvm/snapshot/detail/"+t.snapshotId+"'><font>"+t.snapshotId+"</font>")}),s&&0<s.length?(r[0].proejctNull=!1,p(s).each(function(e,t){t.projectId==r[0].projectId&&(r[0].projectName=t.name)})):r[0].proejctNull=!0,r[0].regionName=n[l.regionId],r[0].snashotsTxt=o.join("&nbsp;&nbsp;")||"无快照",i&&i.aspSet&&0<i.aspSet.length){var d=i.aspSet[0];r[0].aspId=d.aspId,r[0].aspPolicy=w.parseAspPolicy(d)}r[0].uInstanceId?m.getCvmList({count:1,offset:0,regionId:l.regionId,uInstanceIdList:[r[0].uInstanceId]},function(e){var t=e.deviceList;r[0].uInstanceName=t&&t.length?t[0].alias:"",l.renderDetail(c,r)},function(){r[0].uInstanceName="-",l.renderDetail(c,r)}):l.renderDetail(c,r)}}).fail(function(){})},renderDetail:function(e,t){var i=t[0],a=this.bee=new C({item:i,isShowInfo:!0});i.uInstanceId,i.portable,i.diskType,s=i,n.appArea.html(a.$el),v.paramsToObject(this.parseSearch()).monitor&&(p("#cbsList li").eq(0).removeClass("tc-cur"),p("#cbsList li").eq(2).addClass("tc-cur"),this.tab("monitor")),this.initCopy(),p(".back-link").click(function(){e.callback?e.callback():u.navigate("/cvm/cbs")}),p("[data-event=modifyalias]").click(function(){o.init(t,{callback:function(){u.navigate("/cvm/cbs/detail?storageId="+i.storageId+"&rid="+i.regionId)}})}),p("[data-event=upgradedisk]").click(function(){h.init(i,{projectId:i.projectId,regionId:i.regionId})}),p("[data-event=cbsattach]").click(function(){r.init(t,{projectId:i.projectId,regionId:i.regionId,callback:function(){u.navigate("/cvm/cbs/detail?storageId="+i.storageId+"&rid="+i.regionId)}})}),p("[data-event=cancelattach]").click(function(){c.init(t,{projectId:i.projectId,regionId:i.regionId,callback:function(){u.navigate("/cvm/cbs/detail?storageId="+i.storageId+"&rid="+i.regionId)}})}),p("[data-event=renew]").click(function(){l.init(t,{projectId:i.projectId,regionId:i.regionId})}),p("[data-event=createsnapshot]").click(function(){d.init(t,{projectId:i.projectId,regionId:i.regionId,callback:function(){u.navigate("/cvm/cbs/detail?storageId="+i.storageId+"&rid="+i.regionId)}})})},initCopy:function(){var e=p(".viewIpCopyWrap"),t=e.find("[data-clipboard-text]");new b({handle:t,container:e})},queryRegion:function(){var t=p.Deferred();return m.queryRegion(function(e){t.resolve(e)},function(e){t.reject(e)}),t},tab:function(e){this.bee.$set({tab_detail:{"class":""},tab_optlog:{"class":""},tab_monitor:{"class":""}}),this.bee.$set("tab_"+e,{"class":"tc-cur"}),this.bee.$set({isShowInfo:"detail"===e,isShowLog:"optlog"===e,isShowMonitor:"monitor"===e}),"optlog"===e&&this.initOptlog(),"monitor"===e&&this.initMonitor()},initOptlog:function(){var t=this;this.datePicker=this.bee.$refs.datePicker,this.grid=this.bee.$refs.grid,this.renderGrid(),this.datePicker.$off("datepick"),this.datePicker.$on("datepick",function(e){t.renderGrid()})},renderGrid:function(){var a=this,e=this.datePicker.selected.from,t=this.datePicker.selected.to;this.queryLog(e,t,function(e){var t={list:e.datalist,totalNum:e.total};if(0<e.datalist.length){var i=[];e.datalist.forEach(function(e){i.push(e.operate_uin)}),m.getAccounts({uins:i},function(i){e.datalist.forEach(function(e){for(var t=0;t<i.length;t++)if(i[t][e.operate_uin]){e.operate_uin=i[t][e.operate_uin];break}}),a.grid.setData(t)},function(){a.grid.setData(t)})}else a.grid.setData(t)})},queryLog:function(e,t,i){var a=f.getProjectId(),s={page:this.opts.page,count:this.opts.count,projectId:a,instance_id:this.storageId,begin_time:e,end_time:t,command:"",orderField:"",order:""};m.getOperatelogList(s,function(e){i&&i(e)},function(e){},!0)},initMonitor:function(){x.showDetail(s,document.getElementById("monitorRender"))},parseSearch:function(){return location.search||location.href.split("?")[1]}};i.exports=T}),define("modules/cvm/cbs/cbsutil",function(e,t,i){var s=e("constants"),n=e("$"),a=e("dialog"),r=e("manager");i.exports={getCbsMetaByValue:function(i){var e=s.CBS_META_LIST,a=null;return n.each(e,function(e,t){if(t.value==i)return a=t,!1}),a},getCbsMetaByMedium:function(i){var e=s.CBS_META_LIST,a=null;return n.each(e,function(e,t){if(t.medium==i)return a=t,!1}),a},getConfigPricePid:function o(){var e=n.Deferred();return e.resolve(10578),Promise.resolve(e.promise())},checkSecondModeEnoughPay:function(e){var t=this,i=new Promise(function(i){r.getMargin(function(e){var t=e.realBalance;i(t/100)})}),s=new Promise(function(i){t.getConfigPricePid().then(function(t){r.getPriceForHour({pid:t,parts:e},function(e){e=e[t]||{},i(e.money)})})});return new Promise(function(a){var e=[i,s];Promise.all(e).then(function(e){var t=e[0],i=e[1];a(i<=t)})})},showNotEnoughPay:function(e,t){e=e||'<span class="tit">您的余额不足以支撑所有按量付费资源一个小时的消耗，请先充值!</span>',t=t||"余额不足",a.confirm(e,function(){router.navigate("/account/recharge"),reporter.click("yunzhuji.btn.recharge")},null,{title:t,width:540,mainBtnName:"立即充值"})},parseAspPolicy:function(e){var i={1:"一",2:"二",3:"三",4:"四",5:"五",6:"六",0:"日"};if(!e.policy||e.policy.length<1)return"";var a=e.policy[0],s=[];return s.push("每周"),a.dayOfWeek.forEach(function(e,t){s.push(i[e]),t==a.dayOfWeek.length-1?s.push("，"):s.push("、")}),a.hour.forEach(function(e,t){s.push(10<e?e:"0"+e),s.push(":00"),t==a.hour.length-1?s.push("，"):s.push("、")}),s.push("自动创建快照，"),0==e.isPermanent?s.push("保留"+e.retentionDays+"天后自动删除"):s.push("永久保留"),s.join("")}}}),define("modules/cvm/cbs/cbs/data",function(e,t,i){var a=e("$"),s=(e("models/api"),e("manager")),n=e("constants"),r=e("appUtil"),o=(e("util"),e("models/iaas")),d=e("models/snapshot");i.exports={queryZone:function(e){var t=a.Deferred();return s.queryZone(e,function(e){t.resolve(e)},function(e){t.reject(e)}),t},setCbsAutoRenewFlag:function(e){var t=a.Deferred();return s.setCbsAutoRenewFlag(e,function(e){t.resolve(e)},function(e){t.reject(e)}),t},querySnapshots:function(e){var t=a.Deferred();return o.apiRequest({regionId:e.regionId,cmd:"DescribeSnapshots",serviceType:"snapshot",data:e}).then(function(e){t.resolve(e)},function(e){t.reject(e)}),t},queryRegion:function(e){var t=a.Deferred();return s.queryRegion(function(e){t.resolve(e)},function(e){t.reject(e)}),t},detachCbsStoragesCgi:function(e){var t=a.Deferred();return o.apiRequest({cmd:"DetachCbsStorages",serviceType:"cbs",data:e}).then(function(e){t.resolve(e)},function(e){t.reject(e)}),t},getCVmCbsNum:function(e){var t=a.Deferred();return o.apiRequest({cmd:"DescribeInstancesCbsNum",serviceType:"cbs",data:e}).then(function(e){t.resolve(e)},function(e){t.reject(e)}),t},getCbsLimit:function(e){var t=a.Deferred();return o.apiRequest({cmd:"DescribeCbsQuota",serviceType:"cbs",data:e}).then(function(e){t.resolve(e)},function(e){t.reject(e)}),t},attachCbsStorages:function(e){var t=a.Deferred();return o.apiRequest({cmd:"AttachCbsStorages",serviceType:"cbs",data:e}).then(function(e){t.resolve(e)},function(e){t.reject(e)}),t},getCvmList:function(e){var t=a.Deferred();return o.apiRequest({cmd:"DescribeInstances",serviceType:"cvm",data:e}).then(function(e){t.resolve(e)},function(e){t.reject(e)}),t},getProjects:function(){var t=a.Deferred();return s.getProjects(function(e){setTimeout(function(){t.resolve(e.data)},0)}),t},queryCbsStoragesForRecycle:function(e){var t=a.Deferred();return o.apiRequest({cmd:"DescribeCbsStoragesForRecycle",serviceType:"cbs",data:e}).then(function(e){t.resolve(e)},function(e){t.reject(e)}),t},queryCbsStorages:function(e){e.orderBy=e.orderField,delete e.orderField;var t=a.Deferred();return o.apiRequest({regionId:e.regionId,cmd:"DescribeCbsStorages",serviceType:"cbs",data:e},{global:!1}).then(function(e){t.resolve(e)},function(e){t.reject(e)}),t},modifyStorageAttr:function(e){var t=a.Deferred();return o.apiRequest({cmd:"ModifyCbsStorageAttributes",serviceType:"cbs",data:e}).then(function(e){t.resolve(e)},function(e){t.reject(e)}),t},querryStoragePrice:function(e){var t=a.Deferred();return o.apiRequest({cmd:"InquiryStoragePrice",serviceType:"cbs",data:e,regionId:e.regionId}).then(function(e){t.resolve(e)},function(e){t.reject(e)}),t},createSnapshot:function(e){var t=a.Deferred();return o.apiRequest({cmd:"CreateSnapshot",serviceType:"snapshot",data:e}).then(function(e){t.resolve(e)},function(e){t.reject(e)}),t},querySnapshotPrice:function(e){var t=a.Deferred();return o.apiRequest({cmd:"InquirySnapshotPrice",serviceType:"snapshot",data:e,regionId:e.regionId}).then(function(e){t.resolve(e)},function(e){t.reject(e)}),t},queryAspByCbs:function(e){e=e||{};var t=a.Deferred();return d.request({name:"describeCbsAssociatedAsp",data:e,tipErr:!0,global:e.ajaxGlobal,success:function(e){e?t.resolve(e):t.resolve(null)},fail:function(e){e?t.resolve(e):t.resolve(null)}}),t},toPay2:function(e){var t="https://"+QCBUY_HOST+"/order/check";"[object Array]"!==Object.prototype.toString.call(e)&&(e=[e]);var i={itemDetails:{raw_goodsData:e}};r.submitForm(t,i)},topay:function(e){n.MANAGE_HOST="http://manage.qcloud.com/";var t=n.MANAGE_HOST+"deal/dealsConfirmDirect.php",i={itemDetails:{raw_goodsData:e}};r.submitForm(t,i)}}}),define("modules/cvm/cbs/event/attach",function(e,t,i){var c=e("$"),l=(e("router"),e("pageManager"),e("manager")),p=(e("models/api"),e("dialog")),u=e("qccomponent"),m=e("util"),h=e("tips"),v=e("modules/cvm/cbs/cbs/data"),f=e("appUtil"),g=e("modules/cvm/cbs/event/selectedShow"),b='<div id="selectedshow"> </div><div class="renew-form old-hang">                        <div class="tc-15-option-hd">                            <h4>请选择云主机</h4>                        </div>                        <div class="tc-15-table-panel">                        <div class="search-wrap"  id="searchArea"></div>                            <div id="dialog_cvmList"></div>                        </div>                             <div id="cbsCheckBox" style="margin-top: 15px;">                                <label class="form-ctrl-label"><input type="checkbox" class="tc-15-checkbox">自动续费</label>                                <p class="text-weak text-danger" style="display:none">   由于虚拟机与弹性云硬盘的到期回收时间不一致，如欠费时会被隔离，中断业务，建议您开启该云硬盘的自动续费功能                                </p>                            </div></div>',a='<div class="ui-popmsg">                            <div class="info">                                <span class="tit">没有可用的云主机</span>                                <p>您在<%=zoneName || ""%>没有云主机，挂载云硬盘只能挂载到同一可用区下的云主机</p>                            </div>                        </div>';function s(s,o,e){var n=this,d=[];c(s).each(function(e,t){d.push(t.storageId)});var t=u.getComponent("grid-view");n.gridView=new t({$data:{hasFirst:!1,initGetData:!1,canResizeColum:!1,selectedHighlight:!1,maxHeight:290,minHeight:"auto",autoMaxHeight:!1,maxHeightOffset:10,count:5,colums:[{key:"radio",name:"",width:"",minWidth:50,required:!0},{key:"uInstanceId",name:"ID",width:"",minWidth:153,required:!0},{key:"alias",name:"名称",width:153,required:!0},{key:"canAttachNum",name:"可挂载数量",width:153,required:!0}],list:[],showState:!1,showPagination:!0,searchItemName:"云主机"},getCellContent:function(e,t,i){if("radio"==i.key)return'<div class="tc-15-first-radio"><input type="radio" class="tc-15-radio" '+(n.gridView.sUInstanceId==t.uInstanceId?"checked   ":"")+(0<t.canAttachNum?"":"disabled")+"></div>"},setTrAttr:function(e,t){return{"data-uinstanceid":t.uInstanceId}},events:{"click tr":function(e){c(e.target).closest("tr").find(":radio").prop("disabled")||(c(this.$el).find(":radio").prop("checked",!1),c(e.target).closest("tr").find(":radio").prop("checked",!0))}},getData:function(t){var i=t.count,e=i*(t.page-1),a=function c(e){var t=/^(?:(?:[1-9]?[0-9]|1[0-9]{2}|2(?:[0-4][0-9]|5[0-5]))\.){3}(?:[1-9]?[0-9]|1[0-9]{2}|2(?:[0-4][0-9]|5[0-5]))$/,i=null;if(e)if(i={},/\n/.test(e)){for(var a,s=e.replace(/\s+/,"\n").split("\n"),n=[],r=[],o=!1,d=0;a=s[d];d++)if(t.test(a)){if(0==d&&(o=!0),!o)return h.error("暂不支持批量模糊搜索,请检查输入");n.push(a)}else{if(o||0!=a.indexOf("host-"))return h.error("暂不支持批量模糊搜索,请检查输入");r.push(a)}n&&0<n.length?i.ipList=n:r&&0<r.length&&(i.uHostIdList=r)}else/^\d{1,3}((\.(\d{1,3})?)?){0,3}$/.test(e)?i.vagueIp=e:0==e.indexOf("host-")?i.uHostId=e:i.alias=e;return i}(r.getKeyword())||{};l.getCvmList({projectId:s[0].projectId,regionId:o.regionId,zoneId:s[0].zoneId,statusList:[1],offset:e,count:i,alias:a.alias,vagueIp:a.vagueIp,ipList:a.ipList,uHostIdList:a.uHostIdList},function(e){I(e,t.page,i,n.gridView)},function(){n.gridView.showTips("系统繁忙，请稍后重试。"),I({},t.page,i,n.gridView)})}}),p.create(m.tmpl(b,{storageIds:d.join(";")}),"550","",{title:"挂载到云主机",preventResubmit:!1,button:{"确定":function(e){var t=c(n.gridView.$el).find(":radio:checked");if(0!==t.length){var r=c("#cbsCheckBox").find('input[type="checkbox"]').eq(0),i=t.closest("tr").data("uinstanceid");v.attachCbsStorages({storageIds:d,uInstanceId:i}).done(function(e){var t=0,i=[],a=[];if(0==e.code&&e.detail){for(var s=0;s<d.length;s++){var n=e.detail[d[s]]||{code:-1};if(n&&0==n.code)delete n.errorMsg,i.push({storageId:d[s]}),a.push(d[s]);else{i.push({storageId:d[s],errorMsg:{16e3:"磁盘不存在",16001:"正在执行任务中",16007:"磁盘类型错误",9005:"正在执行任务中",9814:"正在执行任务中",16008:"此磁盘不是弹性云硬盘",16009:"CVM上不能挂载更多的磁盘"}[n.code]||"执行失败"}),t++}}r.prop("checked")&&v.setCbsAutoRenewFlag({type:"cbs",operateUin:m.getUin(),appId:f.getAppId(),uuids:a,autoRenewFlag:1}).done(function(){h.success("自动续费成功")}).fail(function(){h.error("续费失败")}),0===t?(p.hide(),setTimeout(function(){o&&o.callback&&o.callback()},50)):g.render({hasPermItems:i,actionName:"挂载",renderTo:"#selectedshow"})._toggleBox()}else h.error("操作执行失败，请稍后重试")}).fail(function(e){var t={16e3:"磁盘不存在",16001:"正在执行任务中",16007:"磁盘类型错误",9005:"正在执行任务中",9814:"正在执行任务中",16008:"此磁盘不是弹性云硬盘",16009:"CVM上不能挂载更多的磁盘"};t[e.data.cgwerrorCode]?h.error(t[e.data.cgwerrorCode]):h.error(e.msg)})}else h.error("请选择云主机")}}}),g.render({hasPermItems:s,actionName:"挂载",renderTo:"#selectedshow"}),c("#dialog_cvmList").append(n.gridView.$el);var i=c("#cbsCheckBox").find('input[type="checkbox"]').eq(0);i.prop("checked",!0),i.click(function(){i.prop("checked")?c("#cbsCheckBox .text-danger").css("display","none"):c("#cbsCheckBox .text-danger").css("display","block")});var a=p.el.find("#searchArea"),r=new u.components["qc-search"]({$data:{keyword:"",searchEmpty:!0,multiple:!0,placeholder:"请输IP(换行分隔)或主机名"},search:function(){n.gridView.getData({page:1,count:n.gridView.count})}});a.html("").append(r.$el),a.on("keydown",function(e){window.event?window.event.cancelBubble=!0:evt.stopPropagation()}),I(e,1,5,gridView),n.gridView.checkCellWidth(),p&&p.center()}function I(e,t,i,s){var a=c(s.$el).find(":radio:checked");if(0<a.length&&(s.sUInstanceId=a.eq(0).closest("tr").data("uinstanceid")),e&&e.deviceList&&0<e.deviceList.length){p.center();var n=[];if(c(e.deviceList).each(function(e,t){n.push(t.uInstanceId)}),0==n.length)return;v.getCVmCbsNum({uInstanceIds:n}).done(function(a){0==a.code&&a.detail&&(c(e.deviceList).each(function(e,t){var i=a.detail[t.uInstanceId];t.canAttachNum=i?i.maxAttachNum-i.count:(i={maxAttachNum:0,count:0},0),t.attachDetail=i}),s.setData({list:e.deviceList,totalNum:e.totalNum,page:t,count:i}))})}else s.showTips('<span class="text"></span>您查看的对象已不存在或没有权限查看');s.setData({list:e.deviceList||[],totalNum:e.totalNum,page:t,count:i})}i.exports={init:function(t,i,e){l.getCvmList({projectId:t[0].projectId,regionId:i.regionId,zoneId:t[0].zoneId,statusList:[1],offset:0,count:5},function(e){e&&e.deviceList&&e.deviceList.length?s(t,i,e):p.create(m.tmpl(a,t[0]),"550","",{title:"挂载到云主机",preventResubmit:!1,button:{"去购买":function(e){window.open("https://"+QCBUY_HOST+"/cvm?regionId="+i.regionId)}}})})}}}),define("modules/cvm/cbs/event/buy",function(e,t,i){var c=e("$"),l=(e("router"),e("pageManager"),e("constants")),a=(e("config/regionconfig"),e("reporter"),e("manager")),r=e("models/api"),p=e("dialog"),s=e("lengthlimiter"),n=e("modules/cvm/cbs/cbs/data"),o=window.appUtil=e("appUtil"),d=e("widget/range/range"),u=e("widget/pills/pills"),m=e("util"),h=e("tips"),v=e("qccomponent"),f=(v.getComponent("grid-view"),l.SNAPSHOT_STATUS,e("models/snapshot"),e("modules/cvm/cbs/cbsutil")),g={},b=l.CBS_DISK_CONFIG,I=l.SSD_CBS_DISK_CONFIG,y=l.PREMIUM_CBS_DISK_CONFIG,w=l.CBS_BUY_REGION,x=l.SSD_CBS_BUY_REGION,k=l.PREMIUM_CBS_BUY_REGION,C=c.extend(!0,[],l.CBS_META_LIST.slice()),T='  <div class="tc-15-msg" style="margin-bottom:20px"><ul>        <li>弹性云盘可以在同一可用区内的虚拟机之间自由挂载和卸载，不支持跨可用区挂载</li>    </ul> </div>      <div class="new-disk">                        <ul class="form-list">                            <li>                                <div class="form-label">                                    <label for="">命名</label>                                </div>                                <input class="txt_input" type="text" style="padding-left:10px;" data-lenLimit="20" maxlength="20" relTipId="cbsNameTip" placeholder="请输入名称">                                <p class="tip" id="cbsNameTip" style="color: #a2a2a2; padding:5px 0;font-size:12px;"></p>                            </li>                            <li class="project">                                                                                        </li>                            <li>                                <div class="form-label">                                    <label for="">地域</label>                                </div>                                <div class="form-input">                                    <div class="tc-15-rich-radio region" role="radiogroup">                                    </div>                                </div>                            </li>                            <li>                                <div class="form-label"><label>可用区</label></div>                                    <div class="form-input">                                    <div class="tc-15-rich-radio num-disk-tab zone" role="radiogroup">                                    </div>                                </div>                            </li>                            <li>                                <div class="form-label"><label>计费模式</label></div>                                    <div class="form-input">                                    <div class="tc-15-rich-radio num-disk-tab buytype" role="radiogroup">                                    </div>                                </div>                            </li>                            <li>                                <div class="form-label"><label>云硬盘类型</label></div>                                    <div class="form-input">                                    <div class="tc-15-rich-radio num-disk-tab storagetype" role="radiogroup">                                    </div>                                </div>                            </li>                            <li class="type1" >                                <div class="form-label"><label>容量</label></div>                                <div class="form-input">                                    <div class="storagesizerange">                                    </div>                                    <p class="text-weak ioTip"></p>                                </div>                            </li>                           <li data-snapshot>                               <div class="form-label"><label>使用快照创建磁盘</label></div>                               <div class="form-input" id="snapshotWarper"></div>                            </li>                            <li>                                <div class="form-label">                                    <label for="">购买数量</label>                                </div>                                                                   <div class="form-input storagenum">                                    <span class="tc-15-input-num m">                                        <span class="minus disabled"  role="button">-</span>                                        <input tyep="text" class="num" value="1">                                        <span class="plus"  role="button">+</span>                                    </span>                                    <span class="num-label">                                    </span>                                </div>                            </li>                            <li>                                <div class="form-label">                                    <label for="">购买时长</label>                                </div>                                <div class="form-input">                                    <div class="tc-15-rich-radio timetype" role="radiogroup">                                    </div>                                </div>                            </li>                            <li>                                <div class="form-label">                                    <label for="">费用</label>                                </div>                                <div class="form-input">                                    <span class="price"><span data-field="cost"></span><em>元</em></span>                                </div>                            </li>                        </ul>                    </div> ',D=[{name:"1个月",value:"1"},{name:"2个月",value:"2"},{name:"3个月",value:"3"},{name:"半年",value:"6",ico:"icon-hui",iconVal:"88折"},{name:"1年",value:"12",active:!0,ico:"ico ico_join icon-hui",iconVal:"83折"},{name:"2年",value:"24",ico:"ico ico_join icon-hui",iconVal:"7折"},{name:"3年",value:"36",ico:"ico ico_join icon-hui",iconVal:"5折"}],P=[{name:"包年包月",value:"1"}],S=0;function _(e){n.queryZone(e).done(function(e){e=e.filter(function(e){return"100001"!=e.zoneId}).map(function(e){return{name:e.zoneName,value:e.zoneId}}),p.el.find(".zone").html(""),O.zonePills=new u({renderTo:p.el.find(".zone"),data:e,newMode:!0,change:function(e){E(),$()}}),O.zonePills.val(e[0].value),E(),$()})}function E(){o.getRegionId();var i,a,s=O.snapshot&&O.snapshot.$get("snapshotSize")||0,n=[];O.zonePills&&(i=O.zonePills.val()),c.each(C,function(e,t){(a=N(t.value,i))&&a.diskMax>=s&&n.push(c.extend({},t))}),x.indexOf(i)<0&&(n=n.filter(function(e){return"cloudSSD"!=e.value})),k.indexOf(i)<0&&(n=n.filter(function(e){return"cloudPremium"!=e.value})),p.el.find(".storagetype").html(""),n.length&&(n[0].active=!0,O.storageTypePills=new u({renderTo:p.el.find(".storagetype"),data:n,newMode:!0,change:function(){var e=N(this.val(),i);O.snapshot&&(O.snapshot.$set("maxSize",e.diskMax),O.snapshot.search()),L(),$()}}),-1<l.SNAPSHOT_REGION_LIST.indexOf(l.ZONETOREGIONMAP[i])?(a=N(n[0].value,i),O.snapshot=new j({$data:{snapshotId:O.param.snapshotId,snapshotSize:O.param.snapshotSize,maxSize:a.diskMax}}),p.el.find("#snapshotWarper").html(O.snapshot.$el),p.el.find("[data-snapshot]").show()):(O.snapshot&&(O.snapshot.$set("$enable",!0),O.snapshot=null),p.el.find("[data-snapshot]").hide()),L())}function L(e){var t=O.snapshot&&O.snapshot.$get("snapshotSize")||0,i=N(O.storageTypePills.val(),O.zonePills.val()),a=i.diskMax,s=i.diskMin;s=a<(s=t<s?s:t)?a:s,e=void 0!==e?e:10;var n=function r(e){var t=[];250==e?t=[50,100,250]:400==e?t=[100,200,400]:500==e?t=[100,300,500]:800==e?t=[160,480,800]:1e3==e?t=[200,500,1e3]:1200==e?t=[200,500,1200]:1500<=e&&(t=[200,500,1e3,e]);return t}(a)||[];n=n.map(function(e,t){return{value:e,width:300/n.length*(t+1)}}),O.storageSizeRange=new d({renderTo:p.el.find(".type1 .storagesizerange"),unit:"GB",value:e,min:s,max:a,width:300,step:10,section:n,change:function(){A(),$()}}),A(),$()}function N(e,t){var i=null;if("cloudBasic"==e){var a=b[t];if(!a)return i;i=g.cbs_16TB&&g.cbs_16TB.length?{diskMin:a.diskMin,diskMax:a.diskMax}:{diskMin:a.diskMin,diskMax:a.disk}}else"cloudSSD"==e?i=I:"cloudPremium"==e&&(i=y);return i}function $(){var e=R();n.querryStoragePrice({inquiryType:"create",storageSize:e.storageSize,storageType:e.storageType,payMode:"prePay",period:e.timeVal,goodsNum:e.goodsNum,regionId:e.regionId}).done(function(e){e&&p.el.find("[data-field=cost]").text(e.price/100)})}function A(){var e=O.storageTypePills.val(),t=O.storageSizeRange.val();if("cloudSSD"==e)i=24e3<(i=24*t)?24e3:i,a=260<(a=(.147*(t-250)+150).toFixed(1))?260:a,c(".ioTip").html("峰值性能：&nbsp;&nbsp;随机IO&nbsp;"+i+"&nbsp;IOPS &nbsp;&nbsp;吞吐量&nbsp;"+a+"&nbsp;MB/s");else if("cloudPremium"==e){var i,a;i=4500<(i=1500+8*t)?4500:i,a=130<(a=(.147*t+75).toFixed(1))?130:a,c(".ioTip").html("峰值性能：&nbsp;&nbsp;随机IO&nbsp;"+i+"&nbsp;IOPS &nbsp;&nbsp;吞吐量&nbsp;"+a+"&nbsp;MB/s")}else c(".ioTip").html("")}function R(){var e=O.storageTypePills.val(),t=f.getCbsMetaByValue(e),i={regionId:O.regionPills.val(),zoneId:O.zonePills.val(),timeVal:O.timeTypePills.val(),projectId:p.el.find(".project select").val(),storageType:O.storageTypePills.val(),pid:t.id,medium:t.medium,storageSize:O.storageSizeRange.val(),goodsNum:p.el.find(".storagenum").find(".num").val(),alias:p.el.find('input[type="text"]').eq(0).val()};return O.snapshot&&(i.snapshotId=O.snapshot.$get("snapshotId")||O.snapshot.$get("$selected")),i}function M(e){var t=Math.min(S,10),i=p.el.find(".storagenum").find(".num").val(),a=Math.min(Math.max(parseInt(0+i),1),t),s=p.el.find(".storagenum").find(".plus"),n=p.el.find(".storagenum").find(".minus");n.removeClass("disabled"),s.removeClass("disabled"),t<=(a=e(a))?(a=t,s.addClass("disabled")):s.removeClass("disabled"),a<=1?(a=1,n.addClass("disabled")):n.removeClass("disabled"),p.el.find(".storagenum").find(".num").val(a),$()}var j=v.extend({$tpl:'    <div>        <div b-if="!snapshotId">            <label class="tc-15-switch tc-15-switch-checked" title="">                <input type="checkbox" b-model="$useSnapshot" class="tc-15-switch-input">                <span class="tc-15-switch-helper">开启</span>            </label>            <div b-if="$useSnapshot" class="filter-list-box">                <div class="search-wrap">                    <div class="tc-15-search">                        <input class="tc-15-search-words" b-model="$query" type="text" placeholder="支持快照ID、名称搜索">                        <a href="javascript:;" role="button" b-on-click="clear()" class="btn-rm-txt" title="清空">清空</a>                    </div>                    <button id="snapshotSearch" b-on-click="search()" class="tc-15-btn weak m search"></button>                </div>                <div class="tc-15-table-panel">                    <div class="tc-15-table-fixed-head">                        <table class="tc-15-table-box">                            <colgroup>                                <col style="width:36px;">                                <col style="width:180px;">                                <col>                                <col>                            </colgroup>                            <thead>                            <tr tabindex="0">                                <th>                                    <div class="tc-15-first-radio">                                    </div>                                </th>                                <th>                                    <div>快照ID/名称</div>                                </th>                                <th>                                    <div>创建时间</div>                                </th>                                <th>                                    <div>大小</div>                                </th>                            </tr>                            </thead>                        </table>                    </div>                    <div class="tc-15-table-fixed-body" b-on="{scroll: scrollLoad}">                        <table class="tc-15-table-box tc-15-table-rowhover">                            <colgroup>                                <col style="width: 36px;">                                <col style="width:180px;">                                <col>                                <col>                            </colgroup>                            <tbody>                                <tr b-repeat="item in $list" class="{{$selected == item.snapshotId ? \'selected\': \'\'}}" tabindex="0">                                    <td>                                        <div class="tc-15-first-radio">                                            <input type="radio" class="tc-15-radio" b-model="$selected" data-size="{{item.storageSize}}" name="snapshotChk" value="{{item.snapshotId}}">                                        </div>                                    </td>                                    <td>                                        <div>                                            <p class="text-truncate list-item-text">{{item.snapshotId}}</p>                                            <p class="text-truncate list-item-text">{{item.snapshotName}}</p>                                        </div>                                    </td>                                    <td>                                        <div>                                            <p>{{item.createTime}}</p>                                        </div>                                    </td>                                    <td>                                        <div>                                            <p>{{item.storageSize}}GB</p>                                        </div>                                    </td>                                </tr>                                <tr b-if="$list.length==0" data-search-tips="">                                    <td class="text-center" colspan="11">                                        <div><span class="text">抱歉，没有找到相关快照，尝试其他搜索条件。</span></div>                                    </td>                                </tr>                            </tbody>                        </table>                    </div>                </div>            </div>        </div>        <p b-if="snapshotId" class="text-label" style="line-height: 27px;">{{snapshotId}}</p>    </div>',$afterInit:function(){var a=this,e=this.$get("snapshotId");j.__super__.$afterInit.call(this),this.$list=[],this.$set("$offset",0),this.$set("$enable",!0),this.$set("$maxSize",0),this.$watch("$useSnapshot",function(e){if(!e){var t=O.storageSizeRange.val();a.$set("$selected",""),a.$set("snapshotSize",0),L(t)}e&&!a.$get("$selected")?a.$set("$enable",!1):a.$set("$enable",!0)}),this.$watch("$selected",function(e){var t=+c('[name="snapshotChk"]:checked').attr("data-size")||0,i=O.storageSizeRange.val();a.$set("snapshotSize",t),L(i),a.$get("$useSnapshot")&&!e?a.$set("$enable",!1):a.$set("$enable",!0)}),this.$watch("$enable",function(e){e?p.getBtn(0).removeClass("btn_unclick"):p.getBtn(0).addClass("btn_unclick")}),e||this.getData().then(function(e){e=a.$list.concat(e),a.$set("$list",e)})},getData:function(){var s=this,t={diskType:"data",snapshotStatus:[0],offset:this.$get("$offset"),limit:20,orderField:"",order:0,ajaxGlobal:!1},n=c.Deferred();return this.$query&&(t.searchValue=this.$query),this.$isLock=!0,function e(){return new Promise(function(i,e){a.getProjects(function(e){var t=[];e.data.length&&e.data.map(function(e){t.push(e.projectId)}),i(t)},e)})}().then(function(e){t.projectIds=e,r.request({serviceType:"snapshot",cmd:"DescribeSnapshots",regionId:O.regionPills.val(),data:t}).then(function(e){if(e){var t=e.snapshotSet||[],i=s.$get("maxSize");if(i)for(var a=t.length-1;0<=a;a--)+t[a].storageSize>i&&t.splice(a,1);n.resolve(t),e.snapshotSet.length&&s.$offset++}else n.resolve(null);s.$isLock=!1},function(e){e?n.reject(e):n.reject(null),s.$isLock=!1})}),n},scrollLoad:function(e){var t=this,i=c(e.target),a=i.scrollTop(),s=i.height(),n=i.children().height();!this.$isLock&&n<=a+s&&this.getData().then(function(e){e=t.$list.concat(e),t.$set("$list",e)})},search:function(){var t=this;this.$get("snapshotId")||(this.$set("$offset",0),this.getData().then(function(e){t.$set("$list",e),t.$set("$selected","")}))},clear:function(){this.$set("$query","")}}),O={},B=function(d){-1!=w.indexOf(d.regionId+"")?(d.maxnum=S,p.create(m.tmpl(T,d),720,"",{title:"新建数据盘",preventResubmit:!1,button:{"确定":function(){!function i(){var e=R(),t={goodsCategoryId:100058,regionId:e.regionId,projectId:e.projectId,payMode:1,zoneId:e.zoneId,goodsDetail:{zoneId:e.zoneId,productInfo:[{name:"容量",value:e.storageSize+"GB"}],mediumType:e.medium,cbsSize:e.storageSize,pid:e.pid,timeSpan:e.timeVal,timeUnit:"m"},goodsNum:e.goodsNum};e.snapshotId&&(t.goodsDetail.snapInstanceId=e.snapshotId),e.alias&&(t.goodsDetail.alias=e.alias),n.toPay2(t),p.hide()}()}}}),s.trigger(),n.getCbsLimit().done(function(e){var t=e.cbsQuota-e.curStorageNum;0<(S=t)&&(d.maxnum=t,c(".num-label").html(m.tmpl('<label class="text-label">单次最多可创建10块弹性云硬盘</label>',d)))}),O.buyTypePills=new u({renderTo:p.el.find(".buytype"),data:P,newMode:!0,change:function(e){}}),O.buyTypePills.val(P[0].value),O.timeTypePills=new u({renderTo:p.el.find(".timetype"),data:D,newMode:!0,change:function(){$()}}),O.timeTypePills.val(D[0].value),p.el.find(".storagenum").find(".num").change(function(e){M(function(e){return e})}),p.el.find(".storagenum").find(".num").blur(function(e){M(function(e){return e})}),p.el.find(".storagenum").find(".minus").click(function(e){c(this).hasClass("disabled")||M(function(e){return--e})}),p.el.find(".storagenum").find(".plus").click(function(e){c(this).hasClass("disabled")||M(function(e){return++e})}),c.when(n.queryRegion(),n.getProjects()).done(function(e,t){for(var i=l.REGIONNAMES,a=[],s=l.REGIONORDER,n=0,r=s.length;n<r;n++){var o=s[n];-1<w.indexOf(o+"")&&e[o]&&a.push({name:i[o],value:o,disabled:d.readOnly&&o!=d.regionId})}t&&0<t.length?p.el.find(".project").append(m.tmpl('<div class="form-label">    <label for="">所属项目</label></div> <%if (projectList.length === 1 && projectList[0].projectId == 0) {%>  <div class="form-input">  <%=projectList[0].name%>   </div>  <%}else{%><div class="tc-15-select-wrap m"><select class="tc-15-select"><%for(var i = 0;i<projectList.length;i++){%><option value="<%=projectList[i].projectId%>" <%if(projectList[i].projectId == projectId){%>selected<%}%>><%=projectList[i].name%> </option><%}%></select> </div>  <%}%>',{projectList:t,projectId:d.projectId})):p.el.find(".project").hide(),O.regionPills=new u({renderTo:p.el.find(".region"),data:a,newMode:!0,change:function(e){_(c(e).data("value"))}}),O.regionPills.val(d.regionId),_(d.regionId)}).fail(function(){})):h.error("该地域弹性云盘即将发售，敬请期待")};i.exports={init:function(e){(O={}).param=e,S=0,function i(){var t=c.Deferred();return c.isEmptyObject(g)?a.queryWhiteList({whiteKey:["CVM_SSD_CBS_WHITELIST","CVM_SSD_CBS_SH_1_WHITELIST","premium_cbs","CVM_Premium_CBS_SH_1_WHITELIST","cbs_16TB"]},function(e){g=e,t.resolve(g)},function(){t.resolve()}):t.resolve(g),t.promise()}().done(function(){g.CVM_SSD_CBS_WHITELIST||(C=c.grep(C,function(e,t){return"cloudSSD"!=e.value})),g.CVM_SSD_CBS_SH_1_WHITELIST||(x=c.grep(x,function(e,t){return"200001"!=e})),g.premium_cbs||(C=c.grep(C,function(e,t){return"cloudPremium"!=e.value})),g.CVM_Premium_CBS_SH_1_WHITELIST||(k=c.grep(k,function(e,t){return"200001"!=e})),B(e)})}}}),define("modules/cvm/cbs/event/cancelattach",function(e,t,i){var a=e("$"),o=(e("router"),e("pageManager"),e("reporter"),e("manager"),e("models/api"),e("dialog")),s=e("modules/cvm/cbs/cbs/data"),d=e("util"),c=e("tips"),l=e("modules/cvm/cbs/event/selectedShow"),p={cancel:'<div id="selectedshow"> </div>        <div class="ui-popmsg">            <div class="info">            <%if(itemList.length> 1){%>                <span class="tit">批量卸载云硬盘</span>                <%}else{%>                <span class="tit">卸载云主机(<%=itemList[0].uInstanceId%>)的云硬盘(<%=itemList[0].storageId%>)</span>                <%}%>                <p>win服务器：强烈建议您在卸载之前，对该磁盘执行脱机操作，<a href="http://'+QCMAIN_HOST+'/doc/product/362/%E4%BA%91%E7%A1%AC%E7%9B%98%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97#3.-.E5.8D.B8.E8.BD.BD.E5.BC.B9.E6.80.A7.E4.BA.91.E7.A1.AC.E7.9B.98" target="_blank">详情请点击</a>。</p>                <p>linux服务器：建议您在卸载之前，确保该硬盘的所有分区处于非加载状态 (umounted)。部分linux操作系统可能不支持磁盘热拔插，<a                 href="http://'+QCMAIN_HOST+'/doc/product/362/%E9%83%A8%E5%88%86%E5%AD%98%E9%87%8F%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%97%A0%E6%B3%95%E8%AF%86%E5%88%AB%E5%BC%B9%E6%80%A7%E4%BA%91%E7%9B%98%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95" target="_blank">详情请点击</a>。</p>            </div>        </div>  '};i.exports={init:function(e,t){var i,n,r;n=t,r=[],a(i=e).each(function(e,t){r.push(t.storageId)}),0!=r.length?(o.create(d.tmpl(p.cancel,{itemList:i}),580,"",{title:"卸载云硬盘",preventResubmit:!1,button:{"确定":function(){s.detachCbsStoragesCgi({storageIds:r}).done(function(e){var t=0,i=[];if(0==e.code&&e.detail)for(var a=0;a<r.length;a++){var s=e.detail[r[a]]||{code:-1};s&&0==s.code?(delete s.errorMsg,i.push({storageId:r[a]})):(i.push({storageId:r[a],errorMsg:{16e3:"磁盘不存在",16001:"正在执行任务中",16007:"磁盘类型错误",9005:"正在执行任务中",9814:"正在执行任务中",16008:"此磁盘不是弹性云硬盘",16009:"CVM上不能挂载更多的磁盘"}[s.code]||"执行失败"}),t++),0==t?(o.hide(),n&&n.callback&&n.callback()):l.render({hasPermItems:i,actionName:"卸载",renderTo:"#selectedshow"})._toggleBox()}else c.error("操作执行失败，请稍后重试")}).fail(function(e){var t={16e3:"磁盘不存在",16001:"正在执行任务中",16007:"磁盘类型错误",9005:"正在执行任务中",9814:"正在执行任务中",16008:"此磁盘不是弹性云硬盘",16009:"CVM上不能挂载更多的磁盘"};t[e.data.cgwerrorCode]?c.error(t[e.data.cgwerrorCode]):c.error(e.msg)})}}}),l.render({hasPermItems:i,actionName:"卸载",renderTo:"#selectedshow"})):c.error("请选择云硬盘")}}}),define("modules/cvm/cbs/event/changeproject",function(e,t,i){var o=e("$"),d=(e("manager"),e("dialog")),a=e("util"),c=e("tips"),s=e("modules/cvm/cbs/event/selectedShow"),l=e("modules/cvm/cbs/cbs/data"),n='<div id="selectedshow"> </div><div class="table-panel host-table-panel" style="position:static; height:200px"><div class="tc-table-fixed"><div class="tc-table-fixed-head"><table class="tc-table tc-table-headcolor"><colgroup><col class="tc-table-col1"><col class="tc-table-col2"><col class="tc-table-col3"></colgroup><thead><tr><th></th><th><span>项目名称</span></th><th><span>项目说明</span></th></tr></thead></table></div><div class="tc-table-fixed-body def-scroll"><table class="tc-table tc-table-rowhover"><colgroup><col class="tc-table-col1"><col class="tc-table-col2"><col class="tc-table-col3"></colgroup><tbody><% for (var i=0, item; item = projectList[i]; i++ ) { %><tr class="select_project_row"><td><input type="radio" name="change_project_radio" value="<%- item.projectId %>" /></td><td><span><%= item.name %></span></td><td><span><%= item.info %></span></td></tr><% } %></tbody></table></div></div></div>';i.exports={init:function(t,i){t&&0!=t.length&&l.getProjects().done(function(e){e&&0<e.length&&(d.create(a.tmpl(n,{projectList:e}),"540","",{title:"分配至项目",preventResubmit:!1,button:{"确定":function(){!function r(e,t){for(var i,a=[],s=0;i=e[s];s++)a.push(i.storageId);var n=o('input[name="change_project_radio"]:checked');n.length?l.modifyStorageAttr({storageId:a[0],projectId:n.val()}).done(function(e){d.hide(),c.success("修改成功"),t&&t.callback&&t.callback()}):c.error("请选择项目!")}(t,i)}}}),s.render({hasPermItems:t,actionName:"分配项目",renderTo:"#selectedshow"}),o(".select_project_row").click(function(e){if("radio"!==o(e.target).attr("type")){var t=o(this).find('input[type="radio"]');t.prop("checked")?t.prop("checked",!1):t.prop("checked",!0)}}))}).fail(function(){})}}}),define("modules/cvm/cbs/event/createsnapshot",function(e,t,i){var a=e("$"),c=(e("router"),e("pageManager"),e("manager"),e("models/api"),e("dialog")),s=e("qccomponent"),l=(e("models/snapshot"),e("reporter")),p=e("util"),u=e("tips"),n=e("modules/cvm/cbs/cbs/data"),m='<div><p class="tc-15-msg warning" style="margin:0px 0px 10px 0px">  <span class="tip-info">    为了保证快照能完整的捕获磁盘数据内容，建议制作快照前，进行以下操作：    <br>数据库业务：Flush &amp; Lock Table    <br>文件系统：Sync 操作，将内存数据强制刷入磁盘内  </span></p><ul class="form-list" id="create_snapshot_dialog">    <li>        <div class="form-label"><label>云硬盘ID</label></div>        <div class="form-input">            <p>{{storageId}}</p>        </div>    </li>    <li>        <div class="form-label"><label>云硬盘名称</label></div>        <div class="form-input">           <p>{{storageName}}</p>        </div>    </li>    <li>        <div class="form-label"><label>磁盘容量</label></div>        <div class="form-input">            <p>{{storageSize}}GB</p>        </div>    </li>    <li>        <div class="form-label"><label>磁盘类型</label></div>        <div class="form-input">           <p>{{storageTypeDesc}}</p>        </div>    </li>    <li>        <div class="form-label"><label>快照名称</label></div>        <div class="form-input">           <div class="tc-15-input-text-wrap m" b-if="less>=0">               <input type="text" class="tc-15-input-text" b-model="snapshotAlias" maxlength="60" id="snapshotAlias">               <div class="tc-15-input-tips" b-if="isShowLess">你还可以输入{{less}}个字符</span></div>               <div class="tc-15-input-tips" b-if="isShowError">{{errorMsg}}</div>           </div>           <div class="tc-15-input-text-wrap m error" b-if="less<0">               <input type="text" class="tc-15-input-text" b-model="snapshotAlias" maxlength="60" id="snapshotAlias">               <div class="tc-15-input-tips" b-if="isShowLess">你已超出{{Math.abs(less)}}个字符</div>               <div class="tc-15-input-tips" b-if="isShowError">{{errorMsg}}</div>           </div>        </div>    </li>    <li>        <div class="form-label"><label>参考快照费用</label></div>        <div class="form-input">            <span class="price">                <span data-field="cost">{{snapshotPrice}}</span><em>元/月</em>            </span>        </div>    </li></ul></div>',h='<div class="confirm-text"><strong>当前磁盘关联主机处于运行中，请注意以下几点：</strong></div><div class="tc-15-msg"><ul>    <li><strong>1. 快照只会包含任务开始时刻已写入磁盘的数据，不包含缓存中的数据</strong></li>    <li><strong>2. 为保证快照数据的完整性，请在制作过程暂停所有磁盘写入操作。强烈建议您先关闭云主机后制作快照</strong></li></ul></div>',v='<div class="confirm-text">云硬盘关联的云主机(<a data-event="nav" href="/cvm/detail/<%=regionId%>/<%=uInstanceId%>"><%=uInstanceId%></a>)正在执行任务（<%=statusDesc%>），请稍候。</div>',r={create:function(n,r){var o=this,d=new s({$tpl:m,$data:a.extend(!0,{snapshotAlias:"",less:60,warp:{color:""},isShowError:!1,isShowLess:!0,errorMsg:""},n)});d.$watch("snapshotAlias",function(e){d.$set("less",60-e.length),d.$set("isShowError",!1),d.$set("isShowLess",!0),d.$set("attr",{"class":"tc-15-input-text-wrap m"}),d.$set("errorMsg","")}),n.uInstanceId?(r.uInstanceId=n.uInstanceId,a.when(this.queryCvm(r),this.querySnapshotPrice(n)).done(function(e,t){var i=e[1];n.snapshotPrice=(t||0)/100,d.$set("snapshotPrice",n.snapshotPrice);var a={uInstanceId:i,runflag:4};if(a.uInstanceId==i){if(2==a.runflag)return c.create(h,480,"",{title:"提示",button:{"继续":function(){o.updateSnapshotDialog(d,$btn),l.click("yunzhuji.CBS.goaheadCreateSnapshot")}}}),void l.click("yunzhuji.CBS.cvmPownerWarning");if(2!=a.runflag&&4!=a.runflag){var s=p.tmpl(v,{regionId:r.regionId?r.regionId:1,uInstanceId:a.uInstanceId,statusDesc:a.statusDesc});return c.create(s,480,"",{title:"提示",defaultCancelBtn:!1,button:{"关闭":function(){c.hide(),l.click("yunzhuji.CBS.goaheadCreateSnapshot")}}}),void l.click("yunzhuji.CBS.cvmPownerWarning")}o.updateSnapshotDialog(d,n,r)}else u.error("网络错误，请稍后再试。",3e3)}),l.click("yunzhuji.CBS.createSnapshot")):this.querySnapshotPrice(n).then(function(e){n.snapshotPrice=(e||0)/100,d.$set("snapshotPrice",n.snapshotPrice),o.updateSnapshotDialog(d,n,r)})},queryCvm:function(e){var t=e.uInstanceId,i=a.Deferred();return n.getCvmList({projectId:e.projectId,regionId:e.regionId,instanceIds:[e.uInstanceId],method:"get",orderField:"addTimeStamp",offset:0,limit:20}).done(function(e){i.resolve([e.instanceSet[0],t])}).fail(function(){i.resolve(null)}),i},querySnapshotPrice:function(e){var t=a.Deferred();return n.querySnapshotPrice({projectId:e.projectId,zoneId:e.regionId,period:1,method:"get",storageSize:e.storageSize}).done(function(e){t.resolve(e.price)}).fail(function(){t.resolve(null)}),t},updateSnapshotDialog:function(e,t,i){c.create(e.$el,480,"",{title:"创建快照",preventResubmit:!0,button:{"确定":function(){if(60<e.$data.snapshotAlias.length)return u.error("名称不能超过60个字符",3e3),void c.toggleBtnDisable();n.createSnapshot({storageId:t.storageId,snapshotName:e.$data.snapshotAlias,snapshotPrice:t.snapshotPrice,regionId:i.regionId,projectId:i.projectId}).done(function(){c.hide(),i&&i.callback&&i.callback(),u.success("快照创建中！",3e3)}),l.click("yunzhuji.CBS.createSnapshotBtn")}}}),l.click("yunzhuji.CBS.createSnapshotDialog")}};i.exports={init:function(e,t){r.create(e[0],t)}}}),define("modules/cvm/cbs/event/exports",function(e,t,i){var a=e("$"),s=(e("manager"),e("util")),n=e("appUtil");i.exports=function(e){var t={t:(new Date).getTime(),uin:s.getUin(),csrfCode:s.getACSRFToken(),projectId:n.getProjectId(),regionId:n.getRegionId()};t=a.extend(t,e);var i=s.objectToParams(t);location.href="/cgi/cbs?action=exportCbs&"+i}}),define("modules/cvm/cbs/event/modifyalias",function(e,t,i){var n=e("$"),r=(e("router"),e("pageManager"),e("reporter")),o=(e("manager"),e("models/api"),e("dialog")),d=e("lengthlimiter"),c=e("util"),l=e("tips"),p=e("modules/cvm/cbs/cbs/data"),u='    <div class="edit_form_wrap">        <ul class="edit_psword">            <li>                <label class="txt" for="">新云硬盘名称:</label>                <input class="tc-15-input-text m" type="text" data-lenLimit="20" maxlength="20" relTipId="cbsNameTip" placeholder="请输入新名称">                <p class="tip" id="cbsNameTip"></p>            </li>        </ul>    </div>',a=function(e,a){var s=[];if(n(e).each(function(e,t){s.push(t.storageId)}),0==s.length)return l.error("请选择一个云硬盘"),!1;o.create(c.tmpl(u,{itemList:e}),480,"",{title:"改名",preventResubmit:!1,button:{"确定":function(){var e,t,i;e=s,t=a,i=o.el.find('input[type="text"]').eq(0),n.trim(i.val())?20<i.val().length?l.error("名称不能超过20个字符"):p.modifyStorageAttr({storageId:e[0],storageName:i.val()}).done(function(e){o.hide(),l.success("更改名称成功"),t&&t.callback&&t.callback()}):l.error("请输入新名称")}}}),r.click("yunzhuji.CBS.rename"),d.trigger()};i.exports={init:function(e,t){a(e,t)}}}),define("modules/cvm/cbs/event/renew",function(e,t,i){e("$"),e("router"),e("pageManager"),e("constants"),e("reporter");var a=e("manager"),s=(e("models/api"),e("dialog")),n=(e("lengthlimiter"),e("modules/cvm/cbs/cbs/data")),r=(e("appUtil"),e("widget/range/range"),e("widget/pills/pills")),o=e("util"),d=(e("tips"),e("modules/cvm/cbs/cbsutil")),c='    <div class="dialog_layer_cont renew-form">    <ul class="form-list">        <li>            <div class="form-label">                <label for="">续费时长</label>            </div>            <div class="form-input">            <div class="tc-15-rich-radio timetype" role="radiogroup"></div>            </div>        </li>         <li>            <div class="form-label">                <label for="">新到期时间</label>            </div>            <div class="form-input deadlinetime" >            </div>        </li>        <li>            <div class="form-label pt20">                <label for="">费用</label>            </div>            <div class="form-input pt20">                <span class="price"><span data-field="cost"></span><em>元</em></span>            </div>        </li>    </ul></div>  ',l=[{name:"1个月",value:"1"},{name:"2个月",value:"2"},{name:"3个月",value:"3"},{name:"半年",value:"6"},{name:"1年",value:"12",active:!0,ico:"ico ico_join"},{name:"2年",value:"24",ico:"ico ico_join"},{name:"3年",value:"36",ico:"ico ico_join"}];function p(){var e=u.timeTypePills.val(),t=function i(e,t){return t-=0,e?a.getNextDate(e,parseInt(t)):""}(u.item.deadlineTime,e);s.el.find(".deadlinetime").html(t),n.querryStoragePrice({inquiryType:"renew",storageId:u.item.storageId,period:e}).done(function(e){e&&s.el.find("[data-field=cost]").text(e.price/100)})}var u={};i.exports={init:function(e,t){u={},function(t,i){u.item=t=t[0];var a=d.getCbsMetaByValue(t.storageType);s.create(o.tmpl(c,i),720,"",{title:"云硬盘续费",preventResubmit:!1,button:{"确定":function(){var e=u.timeTypePills.val();n.toPay2({goodsCategoryId:100059,regionId:t.regionId,zoneId:t.zoneId,projectId:t.projectId,payMode:1,goodsDetail:{zoneId:t.zoneId,productInfo:[{name:"容量",value:t.storageSize+"GB"}],resourceId:t.storageId,cbsSize:t.storageSize,pid:a&&a.id,timeSpan:e,timeUnit:"m",curDeadline:t.deadlineTime,mediumType:"cbs"},goodsNum:"1"}),s.hide(),i&&i.callback&&i.callback()}}}),u.timeTypePills=new r({renderTo:s.el.find(".timetype"),data:l,newMode:!0,change:function(){p()}}),u.timeTypePills.val(l[0].value),p()}(e,t)}}}),define("modules/cvm/cbs/event/selectedShow",function(e,t,i){var a=e("$"),s=e("util"),n=e("event"),r=e("dialog"),o='<div class="act-outline" id="selectedShowWrap">    <div class="act-summary">您已选<strong><%-hasPermItems.length%>台<%=insName%></strong>，    <a href="javascript:;" data-event="s_show_detail">查看详情<i id="selectedShowIconArr" class="icon-arrow-down"></i></a></div>    <div class="act-details" style="display:none" id="selectedShowDetail">        <table class="act-details-tb">            <tbody>            <% for (var i = 0, item; item = hasPermItems[i]; i++) { %><tr><td><%=i+1%></td><td><span class="entity-name" title="<%=item.storageId%>"><%=item.storageId%></span><span class="act-result"><%=item.errorMsg? item.errorMsg : ("可"+actionName)%></span>                    </td></tr><% } %>            </tbody>        </table>    </div></div>',d={render:function(e){var t=e.hasPermItems||[],i=s.tmpl(o,{actionName:e.actionName||"",hasPermItems:t,insName:e.insName||"云硬盘"});return t.length||r.toggleBtnDisable(1),e.renderTo?a(e.renderTo).html(i):r.el.find(".dialog_layer_cont").prepend(i),r.center(),this.bindEvt(),this},bindEvt:function(){var e=this;n.addCommonEvent("click",{s_show_detail:function(){e._toggleBox()}})},_toggleBox:function(){var e=a("#selectedShowDetail"),t=a("#selectedShowIconArr");e.toggle(),e.is(":visible")?t.removeClass("icon-arrow-down").addClass("icon-arrow-up"):t.removeClass("icon-arrow-up").addClass("icon-arrow-down"),r.center()}};i.exports=d}),define("modules/cvm/cbs/event/upgradedisk",function(e,t,i){var r,a=e("$"),s=(e("router"),e("pageManager"),e("constants")),n=e("util"),o=(e("tips"),e("reporter"),e("manager")),d=e("models/api"),p=e("dialog"),c=e("modules/cvm/cbs/cbs/data"),l=e("appUtil"),u=e("widget/range/range"),m=e("modules/cvm/cbs/cbsutil"),h={},v=s.CBS_DISK_CONFIG,f=s.SSD_CBS_DISK_CONFIG,g=s.PREMIUM_CBS_DISK_CONFIG,b={main:'<div id="upgradeConfigWrap"><div class="tc-15-msg" style="margin-bottom:20px"><div style="color:#f00">重要提示：</div><ul><li>为了防止数据丢失，磁盘只可扩容不可缩</li>        <li>磁盘扩容后需要登录虚拟机手动修改文件系统配置，把新增部分容量使用起来，请见详细说明：<a href="https://'+QCMAIN_HOST+'/document/product/362/6737" target="_blank" class="guide-link">扩容Windows文件系统<b class="external-link-icon"></b> </a>和<a href="https://'+QCMAIN_HOST+'/document/product/362/6738" target="_blank" class="guide-link">扩容Linux文件系统<b class="external-link-icon"></b></a></li>    </ul></div><ul class="form-list">    <li>        <div class="form-label"><label>当前容量</label></div>        <div class="form-input">            <p class="normal-txt">            <span><%-cbsSize%>GB</span>            </p>        </div>    </li>    <li>        <div class="form-label"><label>目标容量</label></div>        <div class="form-input">        <div id="storagesizerange" style="width:450px"></div>        </div>    </li>    <% if (!isSecondPay) { %>    <li>        <div class="form-label">        <label data-field="pricetitle">        需支付费用        </label>        </div>        <div class="form-input">            <span class="cost" ><strong data-field="cost"></strong>元</span>        </div>    </li>    <% } %></ul></div>'};var I=function(e,t){this.item=e,this.param=t};I.prototype={exec:function(){var i=this,a=this.item;this.getProjectName().done(function(e){a.projectName=a.projectName||e;var t=n.tmpl(b.main,{isSecondPay:"postPay"==a.payMode,cbsSize:a.storageSize});p.create(t,"570","",{title:"调整磁盘",preventResubmit:!0,button:{"确定":function(){i.toUpgrade(),p.hide()}}}),i.renderStorageSize()})},getProjectName:function(s){var n=a.Deferred();return r?n.resolve(r[s]||"已停用项目"):o.getProjects(function(e){var t=e.data;r={};for(var i,a=0;i=t[a];a++)r[i.projectId]=i.name;n.resolve(r[s]||"已停用项目")}),n.promise()},renderStorageSize:function(){var e=this,t=this.item,i=t.storageType,a=t.zoneId,s=t.storageSize,n=function c(e,t){var i=null;if("cloudBasic"==e){var a=v[t];if(!a)return i;i=h.cbs_16TB&&h.cbs_16TB.length?{diskMin:a.diskMin,diskMax:a.diskMax}:{diskMin:a.diskMin,diskMax:a.disk}}else"cloudSSD"==e?i=f:"cloudPremium"==e&&(i=g);return i}(i,a);if(n){var r=n.diskMax,o=n.diskMin;o=r<(o=s+10<o?o:s+10)?r:o;var d=function l(e){var t=[];return 250==e?t=[50,100,250]:400==e?t=[100,200,400]:500==e?t=[100,300,500]:800==e?t=[160,480,800]:1e3==e?t=[200,500,1e3]:1200==e?t=[200,500,1200]:1500<=e&&(t=[200,500,1e3,e]),t}(r)||[];d=d.map(function(e,t){return{value:e,width:300/d.length*(t+1)}}),this.storageSizeRange=new u({renderTo:p.el.find("#storagesizerange"),unit:"GB",value:s,min:o,max:r,width:300,step:10,section:d,change:function(){e.setPrice()}}),this.setPrice()}},toUpgrade:function(){var t=this,e=this.item,i=this.storageSizeRange.val();m.getCbsMetaByValue(e.storageType);if("postPay"==e.payMode){if(i==e.storageSize)return this.tipsError("配置未变更!");d.request({serviceType:"cvm",cmd:"ResizeInstanceHour",regionId:e.regionId,data:{instanceId:e.uInstanceId,storageSize:i}}).then(function(e){p.hide(),t.param&&t.param.callback&&t.param.callback()})}else{var a=this.collectData();c.toPay2(a)}},setPrice:function(){var e=this.item,t=this.storageSizeRange.val();if(1==e.portable)c.querryStoragePrice({inquiryType:"resize",storageId:e.storageId,storageSize:t}).done(function(e){e&&(p.el.find("#costWrap").show(),p.el.find("[data-field=cost]").text(e.price/100))});else if("prePay"==e.payMode){var i=this.collectData();o.getPrice({goodsDetail:i},function(e){p.el.find('[data-field="cost"]').text(e[0].realTotalCost/100)})}},collectData:function(){var e=this.item,t=e.storageSize,i=this.storageSizeRange.val(),a=m.getCbsMetaByValue(e.storageType);if(1==e.portable)return[{goodsCategoryId:100060,regionId:e.regionId,zoneId:e.zoneId,projectId:e.projectId,payMode:1,goodsDetail:{zoneId:e.zoneId,productInfo:[{name:"容量",value:t+"GB→"+i+"GB"}],resourceId:e.storageId,curDeadline:e.deadlineTime,oldConfig:{cbsSize:t,pid:a&&a.id,mediumType:"cbs"},newConfig:{cbsSize:i,pid:a&&a.id,mediumType:"cbs"}},goodsNum:"1"}];var s={diskInfo:{data:[{target:"xvde",type:a&&a.type,size:i}]},modifyMode:"disk"};return s[a.priceConfig.data]=i,[{goodsCategoryId:100021,appId:l.getAppId(),projectId:e.projectId,zoneId:e.zoneId,regionId:e.regionId,payMode:1,goodsNum:1,goodsDetail:{productInfo:[{name:"项目",value:e.projectName},{name:"主机名",value:e.uInstanceId},{name:"可用区",value:e.zoneName},{name:"磁盘",value:t+"=>"+i}],newConfig:s,curDeadline:e.deadlineTime,resourceId:e.uInstanceId}}]}},i.exports={init:function(e,t){(function i(){var t=a.Deferred();return a.isEmptyObject(h)?o.queryWhiteList({whiteKey:["cbs_16TB"]},function(e){h=e,t.resolve(h)},function(){t.resolve()}):t.resolve(h),t.promise()})().done(function(){new I(e,t).exec()})}}}),define("modules/cvm/cbs/monitor",function(e,t,i){e("manager"),e("appUtil");var n={namespace:"qce/cvm",periods:[300,60],policyViewName:"CBS_CBS",metrics:[{metricCName:"磁盘读流量",metricName:"disk_read_traffic",dimensions:["unInstanceId","disk"],unit:"KB/s"},{metricCName:"磁盘写流量",metricName:"disk_write_traffic",dimensions:["unInstanceId","disk"],unit:"KB/s"},{metricCName:"磁盘读IOPS",metricName:"disk_read_iops",dimensions:["unInstanceId","disk"],unit:"个"},{metricCName:"磁盘写IOPS",metricName:"disk_write_iops",dimensions:["unInstanceId","disk"],unit:"个"},{metricCName:"IO Await",metricName:"disk_await",dimensions:["unInstanceId","disk"],unit:"ms"},{metricCName:"IO Svctm",metricName:"disk_svctm",dimensions:["unInstanceId","disk"],unit:"ms"},{metricCName:"IO %util",metricName:"disk_util",dimensions:["unInstanceId","disk"],unit:"%"}]},r=function(e){var t={unInstanceId:e.uInstanceId,storageId:e.storageId,storageName:e.storageName},i=e.storageId;e.portable||(i=e.diskType),t.disk=i;var a={title:t.storageId,subTitle:t.storageName,instance:t};return e.uInstanceId||(a.nodataMsg="该云硬盘未被挂载，暂无数据"),a};i.exports.showList=function(a,i,s){e("lib/monitor-sdk-importer").ready().then(function(e){var t=$.extend({pagination:{range:{from:0,to:a.length},index:i},getData:function(i){return i=i||0,new Promise(function(e){var t=r(a[i]);s&&s(t.instance.storageId),e(t)})}},n);e.MonitorPanelBuilder.build(t)})},i.exports.showDetail=function(i,a){e("lib/monitor-sdk-importer").ready().then(function(e){var t=$.extend({getData:function(){return new Promise(function(e){e(r(i))})}},n);e.MonitorDetailBuilder.build(t,a)})}}),define("modules/cvm/cbs/operate_auth",function(e,t,i){var a=function(e){this.options=e};a.prototype={getAuth:function(){var e=this.options,t=e.dataItems,i=e.operAction;i=i||[];for(var a,s={},n=0;a=i[n];n++){var r=this.judgment[a];s[a]=r?r.call(this,t):{code:0}}return s},judgment:{renew:function(e){var t;return 0<e.length?1==e.length?(t=e[0]).isRenew?this.enable():"root"==t.diskType&&"prePay"==t.payMode?this.disable("CVM续费时，该服务器CPU、内存，系统盘一并续费，请到CVM控制台进行续费"):"postPay"==t.payMode?this.disable("按量计费的云硬盘，无需续费，请保持账户余额充足"):this.disable(""):this.disable("请选择续费的唯一云硬盘"):this.disable("请选择你需要续费的云硬盘")},createsnapshot:function(e){return 0<e.length?1==e.length?e[0].isSnapAbility?this.enable():this.disable("无法创建快照，请重新选择"):this.disable("请选择创建快照的唯一云硬盘"):this.disable("请选择你需要创建快照的云硬盘")},upgradedisk:function(e){return 0<e.length?1==e.length?e[0].isUpgrade?this.enable():("已挂载到云服务器的云硬盘，当服务器处于关机状态时，数据盘支持磁盘扩容。（系统盘暂时不支持扩容）",this.disable("已挂载到云服务器的云硬盘，当服务器处于关机状态时，数据盘支持磁盘扩容。（系统盘暂时不支持扩容）")):this.disable("请选择扩容的唯一云硬盘"):this.disable("请选择你需要扩容的云硬盘")},attach:function(e){var t=[];if(0<e.length){for(var i,a=0;i=e[a];a++)i.isAttach||t.push(i);return t.length?this.disable("选择的云硬盘无法挂载，请重新选择"):this.enable()}return this.disable("请选择你需要挂载的云硬盘")},changeproject:function(e){return 0<e.length?1==e.length?e[0].isChangeProject?this.enable():this.disable("无法分配至项目，请重新选择"):this.disable("请选择分配至项目的唯一云硬盘"):this.disable("请选择你需要分配至项目的云硬盘")},modifyalias:function(e){return 0<e.length?1==e.length?e[0].isAlias?this.enable():this.disable("无法改名，请重新选择"):this.disable("请选择改名的唯一云硬盘"):this.disable("请选择你需要改名的云硬盘")},cancelattach:function(e){var t=[];if(0<e.length){for(var i,a=0;i=e[a];a++)i.isCancelAttach||t.push(i);return t.length?this.disable("选择的云硬盘无法卸载，请重新选择"):this.enable()}return this.disable("请选择你需要卸载的云硬盘")},exports:function(e){return 0<e.length?this.enable():this.disable("请选择你需要导出信息的云硬盘")}},enable:function(){return{code:0}},disable:function(e){return{code:e.code?e.code:1,tip:e.tip?e.tip:e}}},i.exports=a}),define("modules/cvm/cdh/basechart",function(e,t,i){e("Highcharts");var l=e("$"),p=(e("pageManager"),e("appUtil")),a=e("qccomponent"),u={loading:{style:{backgroundColor:"white"},labelStyle:{color:"silver"}},chart:{zoomType:"x"},title:{text:""},yAxis:[{title:{text:""},lineWidth:1,tickPixelInterval:45,min:0,labels:{style:{fontSize:"12px"}}}],plotOptions:{line:{marker:{enabled:!0,lineWidth:2,lineColor:"#ff7a22",fillColor:"#FFFFFF",radius:3,states:{hover:{enabled:!0}}},lineWidth:1,color:"#ff7a22"},spline:{marker:{enabled:!1,radius:3,states:{hover:{enabled:!0}}},lineWidth:1,color:"#ff7a22"}},credits:{enabled:!1},legend:{enabled:!1},tooltip:{shared:!0}};i.exports=a.extend({$tpl:'<div class="chart-cell">    <h4 class="chart-title">{{chartTitle}}<span class="text-unit">{{chartUnit ? \'(单位：\'+chartUnit+\')\' : \'\'}}</span></h4>    <div b-if="!noData" data-mod="chart" style="height: 150px;width: 350px">    </div>    <div b-if="noData" style="height: 150px;width: 350px">        <span >{{loading ? \'加载中...\' : \'没有数据\'}}</span>    </div></div>',$valuekey:"data",$afterInit:function(){var t=this;t.$chart=l(t.$el).find('[data-mod="chart"]');t.$watch("data",function(){if(t.data)t.data.multi?t.showMultiChart():t.showChart();else{var e=t.$chart.highcharts();e||(t.$chart.highcharts(u),e=t.$chart.highcharts()),e.showLoading()}},!0)},showChart:function(){var e,t=this,i=t.data,a=i.dayView,s=!0,n=t.$chart,r={xAxis:{type:"datetime",dateTimeLabelFormats:{hour:"%H:%M"},tickPixelInterval:80,title:{text:""}}};if(i.y&&i.y.length){l.extend(r,u);var o=i.yUnit||"",d=i.unit||"";r.yAxis=[{title:{text:""},lineWidth:1,tickPixelInterval:45,min:0,labels:{format:"{value}"+o,style:{fontSize:"12px"}}}],e=p.cgwTimeParse(i.x[0]),r.series=[{pointStart:e.getTime()-6e4*e.getTimezoneOffset(),data:i.y}],r.tooltip.formatter=a?(r.series[0].pointInterval=864e5,r.xAxis.dateTimeLabelFormats.day="%m-%d",r.xAxis.dateTimeLabelFormats.week="%m-%d",function(){var e=new Date(this.x);return e=new Date(e.getTime()+6e4*e.getTimezoneOffset()),[p.formatDate(e,"MM-dd")," ","<b>",this.y,d,"</b>"].join("")}):(r.series[0].pointInterval=3e5,r.series[0].type="spline",r.xAxis.dateTimeLabelFormats.day="%H:%M",r.xAxis.maxZoom=36e5,function(){var e=new Date(this.x);return e=new Date(e.getTime()+6e4*e.getTimezoneOffset()),[p.formatDate(e,"hh:mm")," ","<b>",this.y,d,"</b>"].join("")}),n.highcharts(r),s=!1}var c=t.data.loading;t.$set("loading",c),t.$set("noData",s),t.$chart.highcharts()&&!c&&t.$chart.highcharts().hideLoading()},showMultiChart:function(){var e,t=this,i=t.data,a=i.dayView,s=!0,n=t.$chart,r={xAxis:{type:"datetime",dateTimeLabelFormats:{hour:"%H:%M"},tickPixelInterval:80,title:{text:""}}};if(i.list&&i.list.length){l.extend(r,u);var o=(e=p.cgwTimeParse(i.x[0])).getTime()-6e4*e.getTimezoneOffset(),d=i.yUnit||"";r.yAxis=[{title:{text:""},lineWidth:1,tickPixelInterval:45,min:0,labels:{format:"{value}"+d,style:{fontSize:"12px"}}}],r.legend={layout:"vertical",align:"left",x:120,verticalAlign:"top",y:100,floating:!0,backgroundColor:"#FFFFFF"},r.series=[],i.list.forEach(function(e,t){e.y&&e.y.length&&(r.series.push({pointStart:o,data:e.y}),r.tooltip.formatter=a?(r.series[t].pointInterval=864e5,r.series[t].name=i.chartOpt.name[t],r.series[t].color=i.chartOpt.color[t],r.xAxis.dateTimeLabelFormats.day="%m-%d",r.xAxis.dateTimeLabelFormats.week="%m-%d",function(){var e=new Date(this.x);return e=new Date(e.getTime()+6e4*e.getTimezoneOffset()),[p.formatDate(e,"yyyy-MM-dd")," <br>",this.points[0].series.name,"  ","<b>",this.points[0].y,i.chartOpt.units[0],"</b>","<br>",this.points[1].series.name,"  ","<b>",this.points[1].y,i.chartOpt.units[1],"</b>"].join("")}):(r.series[t].pointInterval=3e5,r.series[t].type="spline",r.series[t].name=i.chartOpt.name[t],r.series[t].color=i.chartOpt.color[t],r.xAxis.dateTimeLabelFormats.day="%H:%M",r.xAxis.maxZoom=36e5,function(){var e=new Date(this.x);return e=new Date(e.getTime()+6e4*e.getTimezoneOffset()),[p.formatDate(e,"yyyy-MM-dd")," <br>",this.points[0].series.name,"  ","<b>",this.points[0].y,i.chartOpt.units[0],"</b>","<br>",this.points[1].series.name,"  ","<b>",this.points[1].y,i.chartOpt.units[1],"</b>"].join("")}),s=!1)}),n.highcharts(r)}t.$set("noData",s),t.$chart.highcharts()&&t.$chart.highcharts().hideLoading()}})}),define("modules/cvm/cdh/basetab",function(e,t,i){e("$");var a=e("qccomponent"),s=e("router"),n='    <div>        \x3c!--添加窗体模块--\x3e        {{> headerTpl }}        <qc-detail-tabs b-if="tabData" active-index="{{activeIndex}}" b-with="tabData" b-ref="tabs"></qc-detail-tabs>        {{> content }}    </div>',r='<div class="manage-area-main secondary-main"><div class="tc-15-tab-alt ">    <ul class="tc-15-tablist" b-if="list.length > 1">        <li b-repeat="tab in list" title="{{tab.label}}" class="{{$index == activeIndex ? \'tc-cur\': \'\'}}" >            <a b-on-click="$set(\'activeIndex\', $index)" href="javascript:;">{{tab.label}}</a>        </li>    </ul></div><div data-role="qc-tabs" class="manage-area-main secondary-main">        \x3c!--        <div class="tab-switch" b-if="list.length > 1">            <a b-on-click="$set(\'activeIndex\', $index)" class="{{$index == activeIndex ? \'cur\': \'\'}}"               b-repeat="tab in list" title="{{tab.label}}" href="javascript:;">{{tab.label}}</a>        </div>        --\x3e        <div data-tab-pane class="tab-panel param-panel" b-repeat="tab in list" b-style="{display: $index == activeIndex ? \'block\': \'none\'}">            {{> tab.content }}        </div></div></div>',o=a.getComponent("qc-tabs").extend({$tpl:r});a.tag("qc-detail-tabs",o);var d=a.extend({$tpl:n,backUrl:"",$afterInit:function(){var t=this;this.$refs.tabs&&this.$refs.tabs.$watch("activeIndex",function(e){t.loadTabs(e||0)},!0)},loadTabs:function(e){},back:function(){this.backUrl?(this.$beforeDestroy(),s.navigate(this.backUrl)):this.$destroy()}},{defaults:{headerTpl:'<div class="manage-area-title secondary-title">    <a href="javascript:;" b-on-click="back()" class="back-link">        <i class="btn-back-icon"></i>        <span> 返回</span>    </a>    <i class="line-icon"></i>    <h2>{{title || id}}</h2></div>'}});i.exports=d}),define("modules/cvm/cdh/cdh/useless",function(s,e,t){var a,o=s("$"),i=s("qccomponent"),r=s("pageManager"),n=s("panel"),d=s("dialog"),c=s("modules/cvm/cdh/dialog/rename"),l=s("modules/cvm/cdh/dialog/renew"),p=(s("modules/cvm/cdh/detail"),s("modules/cvm/cdh/dialog/export")),u=s("event"),m=s("widget/fieldsManager/gridView"),h=s("nmc/widget/dropdown"),v=s("modules/cvm/cdh/detail/monitorpanel"),f=i.getComponent("grid-view"),g=s("models/cdh"),b=s("manager"),I=(s("tips"),s("modules/cvm/cdh/util"),s("widget/pubsubhub/pubsubhub")),y=s("appUtil"),w=s("modules/cvm/cdh/detail/cdhdetail"),x=s("modules/cvm/cdh/cdhconfig"),k=(s("widget/popover/popConfirm"),s("models/api"),s("router")),C={},T=s("models/iaas");s("widget/region/regionPills"),s("widget/projects/projectSelector");var D='    <div class="manage-area">        \x3c!--添加窗体模块--\x3e        <div class="manage-area-title">            <h2 >专用宿主机</h2>            <project-selector b-ref="projectSelector" b-model="projectId"></project-selector>            <region-pill b-ref="regionPill" b-model="regionId" short="{{true}}" global="{{true}}" reset="{{true}}"                             get-white-list="{{getRegionWhiteList}}"                    ></region-pill>            \x3c!-- 等产品把wiki链接给到后  再开放            <div class="help-doc" style="float:right;padding-top:20px;font-size:14px;"><i class="links-icon"></i><a target="_blank" >如何管理宿主机</a></div>            --\x3e        </div>        <div class="manage-area-main">            <div class="tc-15-msg elastic-network-msg" style="margin-bottom: 15px;" b-style="{display: supportCbs ? \'block\' : \'none\'}">                <p class="tip-info">                云硬盘采用按量计费的计费方式。当账户欠费时，若系统盘被隔离，子机不可用；若系统盘被清除，子机将一同被清除。如需屏蔽此逻辑，请联系大客户经理开通欠费不停服服务。                </p>            </div>            <div class="tc-15-action-panel" id="operArea">                <button type="button" class="tc-15-btn m " data-event="addCdhHost" data-title=""><b class="icon-add"></b>新建宿主机</button>                <button type="button" class="tc-15-btn m weak {{disableAdd ? \' disabled\' : \'\' }}" data-event="addCdhCvm" data-title="{{disableAdd}}">分配云主机</button>                <div class="tc-15-dropdown tc-15-dropdown-btn-style" id="more_oper">                    <a href="javascript:;" class="tc-15-dropdown-link">更多操作<i class="caret"></i></a>                    <ul class="tc-15-dropdown-menu">                        <li class=\'disabled\' data-event="oper_renew" data-name="renew" data-title="请先选择专用宿主机"><a href="javascript:;">续费</a></li>                        <li class=\'disabled\' data-event="oper_rename" data-name="rename" data-title="请先选择专用宿主机"><a href="javascript:;">改名</a></li>                        <li class=\'disabled\' data-event="oper_manageCvm" data-name="manageCvm" data-title="请先选择专用宿主机"><a href="javascript:;">批量管理云主机</a></li>                    </ul>                </div>                <button class="tc-15-btn weak m download" data-event="exportCdh" title="下载" ></button>                <button b-ref="setting" class="tc-15-btn weak m setting" data-grid-setting title="设置列表显示字段"></button>                <qc-search b-ref="search" placeholder="请输入宿主机名称/ID进行搜索"></qc-search>            </div>            <div class="tc-15-action-panel">                \x3c!--                <cdh-grid b-ref="grid" ></cdh-grid>--\x3e                <div id="cdhList" class="tc-table-grid tc-table-grid-cvm"></div>            </div>        </div>    </div>',P='<a href="javascript:;" b-on-click="showMonitor(item)" title="查看监控概览"><i class="dosage-icon"></i></a>',S='<div class="id-name-cell">    \x3c!--    <p>        <span b-if="item.$loading" class="text-overflow m-width" >{{item.uHostId}}</span>        <a b-if="!item.$loading" href="/cvm/cdh/detail/{{item.regionId}}/{{item.uHostId}}">{{item.uHostId}}</a>    </p>    --\x3e    <p>        <span b-if="item.$loading" class="text-overflow m-width" >{{item.uHostId}}</span>        <a b-if="!item.$loading" href="javascript:;" b-on-click="navDetail(item)" >{{item.uHostId}}</a>    </p>    <div>        <span class="text-overflow m-width" title=""  > {{item.hostAlias ? item.hostAlias : \'未命名\'}}    </span>        <i b-if="!item.$loading" data-event="editName" class="pencil-icon hover-icon"></i>    </div></div>',_=["按量计费","包年包月"],E=[{name:"ID/宿主机名",key:"idAndName",width:250,minWidth:250,required:!0},{name:"监控",key:"monitor",width:50},{name:"状态",key:"status",width:90,minWidth:90},{name:"机型",key:"externalHostType",minWidth:80},{cageIdOnly:!0,name:"所属围笼",key:"cageId",width:150,minWidth:150},{name:"云主机",key:"cvmNumber",width:90},{name:"可用/总CPU",key:"cpuInfo",width:100,minWidth:100},{name:"可用/总内存",key:"memInfo",width:100,minWidth:100},{name:"可用/总硬盘",key:"diskInfo",width:100,minWidth:100},{name:"到期时间",key:"deadline",width:180,minWidth:180},{name:"计费模式",key:"payMode",width:100,minWidth:100},{name:"创建时间",key:"addTimeStamp",hide:!0,width:180,minWidth:180},{name:"所属项目",key:"projectName",hide:!0,width:100,minWidth:100},{name:"可用区域",key:"zoneName",width:100,minWidth:100},{name:"操作",required:!0,width:100,key:"_action"}],L=i.extend({}),N={title:"专用宿主机-控制台",renderGrid:function(e){var t=f.extend({$mixins:f.prototype.$mixins.concat([m("cdh_page_grid_fields")]),getData:function(a,t){var s=this;(C=a=a||{}).sliceRefresh||(s.setData({list:[],totalNum:0}),s.showLoading("加载中..."));var e=(a.page-1)*a.count||0,i=a.count||20;t=function(e,t,i){e||(t.hostList&&(t.hostList.forEach(function(e){i&&(e.regionId=i),0==e.status&&(e.$loading=!0)}),s.setData({list:t.hostList,totalNum:t.totalNum,searchKey:a.searchKey||!1,page:a.page||1,count:a.count||20}),s.checkTask()),t.cageIdList&&t.cageIdList.length&&s.cageFilter&&s.cageFilter.$set("filterOptions",t.cageIdList)),s.hideLoading()};var n={startNum:e,endNum:e+i-1,regionId:y.getRegionId()};0<=a.projectId?n.projectId=a.projectId:a.projectId<0||y.getProjectId()<0||(n.projectId=y.getProjectId()),a.searchKey&&(0==a.searchKey.indexOf("host-")?n.uHostIdList=[a.searchKey]:n.hostAlias=a.searchKey),a.cageId&&(n.cageIdList=decodeURIComponent(a.cageId).split(",")),g.request({name:"getVpsHostList",data:n,global:!a.sliceRefresh,success:function(e){s.hideLoading(),t(null,e,n.regionId)},fail:function(){}})},setTrAttr:function(e,t){return{"data-uHostId":t.uHostId,"data-name":t.hostAlias}},navDetail:function(e,t){var i="/cvm/cdh/detail/"+e.regionId+"/"+e.uHostId;1==t&&(i+="/1"),k.navigate(i)},userIsDoing:function(){return 0<this.getSelected().length},clearCheckTask:function(){clearTimeout(this.watingTime)},checkTask:function(){var t=this;t.isWating=!1,t.list.forEach(function(e){e.$loading&&(t.isWating=!0)}),t.clearCheckTask(),t.isWating?this.watingTime=setTimeout(function(){t.userIsDoing()?t.checkTask():a&&(a--,N.refreshList(C,!0))},5e3):t.setmaxReqNum()},setmaxReqNum:function(){a=200},showMonitor:function(e){var i=this;if(!i.showingHostId||i.showingHostId!=e.uHostId){var t=o(i.$el).find('tr[data-uHostId="'+e.uHostId+'"]'),a=t.attr("data-index");i.$refs.list.forEach(function(e,t){i.$refs.list[t].$set({$selected:a==t})}),N.refreshMenu(),t.addClass("current"),i.showingHostId=e.uHostId,n.show({onAfterHide:function(){i.showingHostId=null},module:v,data:e})}},getHeadContent:function(e){if("cageId"===e.key)return'<grid-view-header-filter b-ref="cageFilter" b-with="{ ready: cageFilterReady.bind(this.$root),filterOptions: cagelist, col: col, change: cageChange.bind(this.$root) }"></grid-view-header-filter>'},cageFilterReady:function(e){this.cageFilter=e},cageChange:function(e){var t;e&&0<e.length&&(t=e.join(",")),this.getData({cageId:t?encodeURIComponent(t):""})},getCellContent:function(e,t,i){var a;switch(i.key){case"idAndName":a=S;break;case"status":a='<span class="text-overflow '+(1==e?"succeed":0==e?"restart":"warning")+'">'+t.statusDes+"</span>";break;case"cvmNumber":var s=!t.$loading&&0<=e?e:"-";a=!t.$loading&&0<e?'<a href="javascript:;" b-on-click="navDetail(item,1)">'+s+"</a>":'<span class="text-overflow">'+s+"</span>";break;case"cageId":a=t.cageId?"<div><p>"+(e||"-")+'</p><p><span class="text-overflow restart">'+(t.cageAlias||"未命名")+"</span></p></div>":'<span class="text-overflow">-</span>';break;case"monitor":a=P;break;case"cpuInfo":a='<span class="text-overflow">'+t.cpuAvailable+"/"+t.cpuTotal+"</span>";break;case"memInfo":a='<span class="text-overflow">'+t.memAvailable+"/"+t.memTotal+"</span>";break;case"diskInfo":a='<span class="text-overflow">'+t.diskAvailable+"/"+t.diskTotal+"</span>";break;case"payMode":a='<span class="text-overflow">'+(_[e]||"-")+"</span>";break;case"deadline":var n=null;return 0!=t.status&&(n=this.getDeadLineStr(t.deadline,t.serverTimestamp)),"<div>"+(n||"-")+"</div>";case"_action":a=t.$loading?"-":'<a href="javascript:;" data-event="renewVps">续费</a>';break;default:a='<span class="text-overflow">'+(e||"-")+"</span>"}return a},getDeadLineStr:function(e,t){var i=new Date(e.replace(/\-/g,"/")),a=0,s=t&&!isNaN(t)?t:(new Date).getTime();if(6048e5<(a=i.getTime()-s))return r=(n=i).getFullYear(),o=n.getMonth()+1,d=n.getDate(),[r,(o<10?"0":"")+o,(d<10?"0":"")+d].join("-");if(a<=0)return"";var n,r,o,d,c=((a=a.toFixed(2)-0)/864e5).toFixed(2).split("."),l="";return c[1]&&(l=0<(l=(c[1]/100*24).toFixed(0)-0)?l+"小时":""),'<span class="text-overflow text-danger">'+c[0]+"天"+l+"后到期</span>"}},{defaults:{emptyTips:'您选择的该地区的专用宿主机列表为空，您可以<a href="javascript:;" data-event="addCdhHost">新建一台专用宿主机</a>，或切换到其他地域',initGetData:!1,hasFirst:!0,colums:e}}),i=this;i.grid=new t,i.grid.$set("colums",e),i.cdhListEl=o("#cdhList"),i.cdhListEl.append(i.grid.$el),i.grid.setmaxReqNum(),i.moreDropdown=new h(o("#operArea").find(".tc-15-dropdown"),{newMode:!0}),i.bindEvents()},queryHostListInfo:function(t){var i=o.Deferred();return g.request({name:"getVpsHostList",data:{regionId:y.getRegionId()},success:function(e){i.resolve(e),t&&t(e)},fail:function(){i.resolve(),t&&t()}}),i},render:function(e){var i=this,a=arguments;b.getAllWhiteList(function(t){t.CVM_APIv3_BlackList&&t.CVM_APIv3_BlackList.length?i._render.call(i,a):s.async("cvm/cdh/cdh",function(e){(i=e).whiteListMap=t,i._render.call(i,a)})})},_render:function(a){var t=a,n=this;b.getAllWhiteList(function(s){if("detail"==t[0])return w.render(t[1],t[2],t[3]);a=a||{},n.$appArea=o("#appArea");var e=n.bee=new L(D,{getRegionWhiteList:function(){var a=o.Deferred();return b.queryRegion(function(e){var t=[];for(name in e){var i=x.CDH_REGION_LIST[name];i&&(i.whiteKey?s[i.whiteKey]&&t.push(name):t.push(name))}a.resolve(t)},function(e){a.reject(e)}),a.promise()},$data:{supportCbs:!1}});r.appArea.html(e.$el);var i=function(t){var e=E.filter(function(e){return!e.cageIdOnly||t});n.renderGrid(e),n.refreshList({cageId:a.cageId})};Promise.all([T.apiRequest({cmd:"GetProductUsageInfo",serviceType:"cage",regionId:y.getRegionId(),data:{}}),new Promise(function(t,e){b.getAllWhiteList(function(e){t(!!e&&(e.CDH_CBS_white&&e.CDH_CBS_white.length))})})]).then(function(e){var t=e[0].data;n.bee.$set("supportCbs",!!e[1]),t&&t.isOpen?i(!0):i(!1)})["catch"](function(e){i(!1)})})},showRenewDia:function(e){var t=new l({selectedItem:e});d.create(t.$el,"700","",{title:"续费","class":"dialog_layer_v2 tc-15-rich-dialog new-gateway",preventResubmit:!0,button:{"确定":function(e){t.doAction(d)}}})},refreshList:function(e,t){t?(C.sliceRefresh=!0,this.grid.getData(C)):this.grid.getData(e)},renameHost:function(e){var t=this,i=new c({newName:e[0].hostAlias||"未命名",selectedItem:e});d.create(i.$el,"600","",{title:"改名","class":"dialog_layer_v2 tc-15-rich-dialog new-gateway",preventResubmit:!0,button:{"确定":function(e){i.doAction(d,function(){t.refreshList(C,!0)})}}})},updateAddCvmBtn:function(e){var t={mixCage:!1};if(e&&0<e.length){var i=[],a=[],s=[],n=[];e.forEach(function(e){var t=e.cageId||"common";a.indexOf(t)<0&&a.push(t),i.indexOf(e.externalHostType)<0&&i.push(e.externalHostType),s.indexOf(e.zoneId)<0&&s.push(e.zoneId),n.indexOf(e.projectId)<0&&n.push(e.projectId)}),1<a.length?(this.bee.$set("disableAdd","不支持不同围笼内主机同时分配"),t.mixCage=!0):1<i.length?this.bee.$set("disableAdd","不支持不同机型主机同时分配"):1<s.length?this.bee.$set("disableAdd","不支持不同可用地域内主机同时分配"):1<n.length?this.bee.$set("disableAdd","不支持不同项目内主机同时分配"):this.bee.$set("disableAdd","")}else this.bee.$set("disableAdd","");return t},refreshMenu:function(){var e=this.grid.getSelected(),i=this.updateAddCvmBtn(e),a=e.length;["renew","rename","manageCvm"].forEach(function(e){var t=o("#more_oper").find('[data-name="'+e+'"]');0==a?t.addClass("disabled").attr("data-title","请先选择专用宿主机"):i.mixCage?t.addClass("disabled").attr("data-title","不支持不同围笼内主机同时操作"):t.removeClass("disabled").attr("data-title","")})},bindEvents:function(){var r=this;r.lockChange=!1,o(r.grid.$el).on("click",'input[type="checkbox"]',function(e){setTimeout(function(){r.refreshMenu()},0)}),r.bee.$watch("regionId",function(e){r.refreshList()}),r.bee.$watch("projectId",function(e){r.inited?r.refreshList({projectId:+e}):r.inited=!0}),o(r.bee.$refs.setting).click(function(){r.grid.showFieldsManager()}),r.bee.$refs.search.$on("search",function(e){r.grid.getData({searchKey:e})}),I.off(".cdh").on("hostAliasChange.cdh",function(e,t){r.refreshList()}),u.bindCommonEvent(this.$appArea.children()[0],"click",{addCdhHost:function(e){var t=x.CDH_BUY_PAGE+"?regionId="+y.getRegionId();0<=y.getProjectId()&&(t+="&projectId="+y.getProjectId()),window.open(t)},exportCdh:function(e){p.exportCdhList()},addCdhCvm:function(e){if(!o(e.target).hasClass("disabled")){var t="?buyMode=1&regionId="+y.getRegionId(),i=r.grid.getSelected();if(i&&0<i.length){var a=[];i.forEach(function(e){e.uHostId&&a.push(e.uHostId)});var s=i[0],n=a.join(",");t=t+"&zoneId="+s.zoneId+"&projectId="+s.projectId+"&hostType="+s.externalHostType+"&uHostId="+encodeURIComponent(n)}window.open(x.CDH_CVM_CREATE_PAGE+t)}},renewVps:function(e){var t=o(e.target).closest("tr").attr("data-index");r.showRenewDia([r.grid.list[t]])},editName:function(e){var t=o(e.target).closest("tr").attr("data-index");r.grid.$refs.list[t].$set({$selected:!0}),r.refreshMenu();var i=r.grid.$refs.list[t].$data;r.renameHost([i])},oper_renew:function(){if(!o(this).hasClass("disabled")){var e=r.grid.getSelected();r.showRenewDia(e)}},oper_manageCvm:function(){if(!o(this).hasClass("disabled")){var e=r.grid.getSelected(),t=[];e.forEach(function(e){e.uHostId&&t.push(e.uHostId)}),k.navigate("/cvm?uHostIds="+encodeURIComponent(t.join(",")))}},oper_rename:function(){o(this).hasClass("disabled")||r.renameHost(r.grid.getSelected())}})},destroy:function(){this.grid&&this.grid.clearCheckTask(),a=0,I.off(".cdh")}};t.exports=N}),define("modules/cvm/cdh/cdhconfig",function(e,t,i){var a=0<=window.location.host.indexOf("cloud.tencent.com")?"https://buy.cloud.tencent.com":"https://"+QCBUY_HOST;i.exports={CDH_REGION_LIST:{1:{name:"广州",value:1,area:"华南地区"},11:{name:"深圳金融",value:11,area:"华南地区"},4:{name:"上海",value:4,area:"华东地区"},7:{name:"上海金融",value:7,area:"华东地区"},8:{name:"北京",value:8,area:"华北地区"},16:{name:"成都",value:16,area:"西南地区"},5:{name:"香港",value:5,area:"东南亚地区",whiteKey:"CDH_HK"},9:{name:"新加坡",value:9,area:"东南亚地区",tip:"新加坡节点覆盖东南亚地区用户，带宽主要面向海外，大陆访问延时较高",icon:'<i class="shop-new-icon"></i>'},15:{name:"硅谷",value:15,area:"美国西部",tip:"欢迎选购全新海外数据中心",icon:'<i class="shop-new-icon"></i>'},17:{name:"法兰克福",value:17,area:"欧洲地区",tip:"欢迎选购全新海外数据中心",icon:'<i class="shop-new-icon"></i>'}},CDH_BUY_PAGE:a+"/cdh",CDH_CVM_CREATE_PAGE:a+"/cdhcvm",NEW_PAY_URL:a+"/order/check",CVM_PAGE:"/cvm",CVM_DETAIL_PAGE:"/cvm/detail/"}}),define("modules/cz/index/czconfig",function(e,t,i){i.exports={czRegion:["7","11"]}}),define("modules/cz/index/index",function(e,t,i){var a=e("$"),s=e("qccomponent"),n=e("event"),o=e("pageManager"),d=e("manager"),c=e("appUtil"),r=(e("models/api"),e("widget/fieldsManager/gridView")),l=s.getComponent("grid-view"),p=e("dialog"),u=e("lengthlimiter"),m=e("tips"),h=e("router"),v=e("modules/cz/index/czconfig");e("widget/region/regionPills");var f='    <div>        <div class="manage-area">            <div class="manage-area-title">                <h2>专用围笼</h2>                <region-pill b-if="!noRegion" b-ref="regionPill" b-model="regionId" short="{{true}}" global="{{true}}" reset="{{true}}"                             get-white-list="{{getRegionWhiteList}}"                        ></region-pill>            </div>            <div class="manage-area-main">                <div class="tc-15-action-panel">\x3c!-- "新购围笼、围笼内配置修改走工单流程 --\x3e                    <button class="tc-15-btn m disabled" data-event="addCage" title="专用围笼购买请工单申请"><b class="icon-add"></b>新增</button>                    <button b-ref="setting" class="tc-15-btn weak m setting" data-grid-setting title="设置列表显示字段"></button>                    <qc-search b-ref="search" placeholder="请输入围笼名称搜索"></qc-search>                </div>            </div>            <cage-grid region-id="{{regionId}}" b-ref="grid"></cage-grid>        </div>    </div>',g='<div class="id-name-cell">    <span  class="text-overflow m-width" style="font-weight:bold;">{{item.cage_id || "-"}}</span>    <div>        <span class="text-overflow m-width weak" style="max-width: 200px;color: #a2a2a2;">{{item.cage_alias || "未命名"}}</span>        <i class="pencil-icon hover-icon" data-name="cage_alias" data-event="rename" style="cursor: pointer;" data-title="{{item.cage_alias || \'\'}}" b-on-click="rename(item)"></i>    </div></div>',b='<div class="param-box dialog-box">    <div class="param-bd ">        <ul class="item-descr-list">            <li class="{{errorTips ? \'is-error\' : \'\'}}">                <span class="item-descr-tit">名称：</span>               <span class="item-descr-txt">                   <input type="text" b-model="cage_alias" class="tc-15-input-text m" placeholder="请输入新的名称" data-validate="cage_alias" maxlength="25">                   <p class="form-input-help">还能输入{{25 - cage_alias.length}}个字符，英文、汉字、数字、连接线"-"或下划线"_"、小数点</p>               </span>            </li>        </ul>    </div></div>',I=e("models/iaas"),y=l.extend({$mixins:l.prototype.$mixins.concat([r("cz_page_grid_fields")]),$afterInit:function(){var t=this;y.__super__.$afterInit.call(this),this.$watch("regionId",function(e){t.refresh()})},getData:function(i,a){var s=this,n=(i=i||{}).count||20,e=(i.page-1)*i.count||0,t=i.searchKey||"";s.showLoading("加载中..."),a=function(e,t){e||s.setData({list:t.list,totalNum:t.total,searchKey:i.searchKey||!1,page:i.page||1,count:n}),s.hideLoading()};var r={index:e,count:n};t&&(r.cageAlias=t),I.apiRequest({cmd:"DescribeCages",serviceType:"cage",regionId:c.getRegionId(),data:r},{secure:!0}).then(function(e){var t={total:(e=e.data||{}).total,list:e.cage_array};a(null,t)})},getCellContent:function(e,t,i){var a;switch(i.key){case"cageIdName":a=g;break;case"cage_rack_type":a='<span  class="text-overflow m-width">{{item.cage_rack_type || "--"}}</span>';break;case"cageNumInfo":var s=0;isNaN(t.cage_pos_num)||isNaN(t.cage_pos_used)||(s=t.cage_pos_num-t.cage_pos_used),a='<span  class="text-overflow m-width">'+s+"台/{{item.cage_pos_num || 0}}台</span>";break;case"cdh":var n=t.cdh||0;a=0<n?'<span  class="text-overflow m-width"><a href="javascript:;" b-on-click="jumpToCdh(item)">'+n+"台</a></span>":'<span class="text-overflow m-width">'+n+"台</span>";break;case"tdsql":a='<span  class="text-overflow m-width">{{item.tdsql || 0}}台</span>';break;case"colocation":a='<span  class="text-overflow m-width">{{item.colocation || 0}}台</span>';break;default:a=e||"-"}return a},jumpToCdh:function(e){e&&e.cage_id&&h.navigate("/cvm/cdh?cageId="+e.cage_id)},validaAlias:function(e,t,i){var a=this;/^[\w\-.\u4e00-\u9fa5]{1,25}$/.test(t)?(i(!1),e&&e.cage_alias!=t?I.apiRequest({cmd:"ModifyCageAlias",serviceType:"cage",regionId:c.getRegionId(),data:{cageId:e.cage_id,cageAlias:t}},{secure:!0}).then(function(e){0==e.code?(a.refreshList(),p.hide()):m.error("更改名称失败！")}):p.hide()):i(!0)},rename:function(e){var t=this,i=e.cage_alias,a=new s(b,{$data:{cage_alias:i}});p.create(a.$el,560,"",{title:"更改名称",defaultCancelBtn:!1,button:{"确定":function(){t.validaAlias(e,a.cage_alias,function(e){a.$set("errorTips",e)})},"关闭":function(){p.hide()}}}),p.el.find('input[type="text"]').focus(),u.trigger()},refreshList:function(){this.refresh()}},{defaults:{emptyTips:"专用围笼列表为空",initGetData:!1,hasFirst:!1,colums:[{name:"ID/围笼名",key:"cageIdName",minWidth:250,required:!0},{name:"规格",key:"cage_rack_type"},{name:"可用/总机位数",key:"cageNumInfo"},{name:"专用宿主机数量",key:"cdh"},{name:"专用数据库数量",key:"tdsql"},{name:"托管数量",key:"colocation"}]}});s.tag("cage-grid",y);var w={render:function(e){var n=this;n.$appArea=a("#appArea");var r=function(e){n.bee.$set("noRegion",e),e?n.grid.setData({list:[],totalNum:0,searchKey:!1}):n.grid.refreshList(),n.bee.$set("noRegion",e)},t=n.bee=new s(f,{getRegionWhiteList:function(){var s=a.Deferred();return setTimeout(function(){d.queryRegion(function(e){var t=[],i=c.getRegionId(),a=!0;for(name in e)-1<v.czRegion.indexOf(name)&&(i==name&&(a=!1),t.push(name));a&&0<t.length&&(c.setRegionId(t[0]),n.bee.$refs.regionPill.$set("regionId",t[0])),0==t.length?r(!0):r(!1),s.resolve(t)},function(e){r(!0),s.reject(e)})},10),s.promise()}});n.grid=t.$refs.grid,o.appArea.html(t.$el),n.bindEvents()},bindEvents:function(){var t=this;t.bee.$refs.search.$on("search",function(e){t.bee.noRegion||t.grid.getData({searchKey:e})}),a(t.bee.$refs.setting).click(function(){t.grid.showFieldsManager()}),n.bindCommonEvent(t.$appArea.children()[0],"click",{addCage:function(){}})}};i.exports=w}),define("modules/cvm/cdh/detail",function(e,t,i){var a=e("modules/cvm/cdh/basetab"),s=e("modules/cvm/cdh/detail/configdetail"),n=e("modules/cvm/cdh/detail/childlist"),r=e("modules/cvm/cdh/detail/monitordetail"),o=(e("appUtil"),e("tips"),a.extend({detailData:null,backUrl:"/cvm/cdh",$beforeInit:function(){o.__super__.$beforeInit.call(this),this._tabs=[]},$afterInit:function(){o.__super__.$afterInit.call(this),this.$set({}),this.bindEvent()},$beforeDestroy:function(){this._tabs.forEach(function(e){e.$destroy(!0)})},loadTabs:function(e){var t=this.$refs.tabs,i=this._tabs[e];if(!i){switch(e){case 0:i=new s({$data:{item:this.item}});break;case 1:i=new n({$data:{item:this.item,hostId:this.title}});break;case 2:i=new r({$data:{name:""}})}this._tabs[e]||(this._tabs[e]=i)}1<this._tabs.length&&this._tabs[1]&&this._tabs[1].setCurentActive(e),t.list.$set(e,{content:i.$el})},bindEvent:function(){}},{defaults:{title:"",tabData:{list:[{label:"配置详情"},{label:"子机列表"},{label:"监控指标"}]}}}));i.exports=o}),define("modules/cvm/cdh/detail/cdhdetail",function(e,t,i){var s=e("pageManager"),r=e("$"),o=e("models/cdh"),a=e("modules/cvm/cdh/detail/configdetail"),n=e("modules/cvm/cdh/detail/childlist"),d=e("modules/cvm/cdh/detail/monitordetail"),c=e("config/constants"),l=e("manager"),p=e("tips"),u=e("appUtil"),m=e("router"),h={render:function(i,a,s){var n=this;if(1<(s=+s||0)||!i||!a)return s=0,void n.renderDetailNoData();(n=this).$appArea=r("#appArea"),Promise.all([new Promise(function(e,t){o.request({name:"getVpsHostList",data:{regionId:i,uHostIdList:[a],recycleFlag:0},success:e,fail:t})}),new Promise(function(t,e){l.getAllWhiteList(function(e){t(!!e&&(e.CDH_CBS_white&&e.CDH_CBS_white.length))})})]).then(function(e){var t=e[0].hostList;if(n.supportCbs=!!e[1],t&&t.length){var i=t[0];n.renderPage(i,a,s)}else p.error("信息有误，没有该宿主机的信息！"),n.renderDetailNoData()})["catch"](function(e){p.error("信息有误，没有该宿主机的信息！"),n.renderDetailNoData()})},renderDetailNoData:function(){u.renderDetailNoData("专用宿主机","/cvm/cdh")},renderPage:function(e,t,i){var a=new v({$beforeInit:function(){},$afterDestroy:function(){},$data:{activeIndex:i,hostId:t,hostData:e,supportCbs:this.supportCbs}});s.appArea.html(a.$el)}},v=Bee.extend({$tpl:'    <div class="cdh-panel">        <div class="manage-area">            <div class="manage-area-title secondary-title">                <a href="javascript:;" b-on-click="back()" class="back-link"  >返回</a>                <span class="line-icon">|</span>                <h2>{{hostData.uHostId}}</h2>                <div class="cvm-more-opt manage-area-title-right"></div>            </div>            <div class="manage-area-main secondary-main keyboard-focus-obj" id="detailScrollWrap">                \x3c!-- tab --\x3e                <div class="tc-15-tab tc-15-tab-alt">                    <ul role="tablist" class="tc-15-tablist" id="cvmDetailNav" style="z-index:99">                        <li class="{{0 == activeIndex ? \'tc-cur\': \'\'}}"><a b-on-click="$set(\'activeIndex\', 0)" href="javascript:;" role="tab">配置详情</a></li>                        <li class="{{1 == activeIndex ? \'tc-cur\': \'\'}}"><a b-on-click="$set(\'activeIndex\', 1)" href="javascript:;" role="tab">云主机列表</a></li>                        <li class="{{2 == activeIndex ? \'tc-cur\': \'\'}}"><a b-on-click="$set(\'activeIndex\', 2)" href="javascript:;" role="tab">监控指标</a></li>                    </ul>                    <div >                        {{> contentHtml }}                    </div>                </div>            </div>        </div>    </div>',$beforeInit:function(){this._tabs=[]},$afterInit:function(){var t=this;t.contentArea=r("#detailContent"),this.$watch("activeIndex",function(e){t.loadTabs(e)},!0)},loadTabs:function(e){var t=this._tabs[e];if(!t){switch(e){case 0:t=new a({$data:{item:this.hostData,hostId:this.hostId,regionName:c.REGIONNAMES[u.getRegionId()]}});break;case 1:t=new n({$data:{item:this.hostData,hostId:this.hostId,supportCbs:this.supportCbs}});break;case 2:t=new d({$data:{item:this.hostData,hostId:this.hostId}})}this._tabs[e]||(this._tabs[e]=t)}1<this._tabs.length&&this._tabs[1]&&this._tabs[1].setCurentActive(e),this.$set("contentHtml",t.$el)},back:function(){1<this._tabs.length&&this._tabs[1]&&this._tabs[1].clearTask(),this.$destroy(),m.navigate("/cvm/cdh")}},{defaults:{}});i.exports=h}),define("modules/cvm/cdh/detail/childlist",function(e,t,i){var a,o=e("$"),s=e("dialog"),n=(e("pageManager"),e("qccomponent")),r=e("util"),d=e("event"),c=e("tips"),l=e("modules/cvm/cdh/dialog/shutdown"),p=e("modules/cvm/cdh/dialog/boot"),u=e("widget/fieldsManager/gridView"),m=e("modules/cvm/cdh/dialog/reboot"),h=e("modules/cvm/cdh/dialog/destroy"),v=e("nmc/widget/dropdown"),f=e("modules/cvm/cdh/cdhconfig"),g=e("widget/pubsubhub/pubsubhub"),b=e("modules/cvm/cdh/dialog/export"),I=n.getComponent("grid-view"),y=e("widget/cvmList/data_package"),w=e("appUtil"),x=e("manager"),k=null,C={},T='    <div class="param-box">    <div class="manage-area" >        \x3c!--添加窗体模块--\x3e        <div class="tc-15-action-panel" id="zjOperArea">            <div class="tc-15-msg" style="margin-bottom: 15px;">                <p>要对云主机进行日常监控维护、配置升级、其他更多操作，请 <a href="/cvm"> 前往[云主机]管理</a></p>                <p class="tip-info" b-style="{display: supportCbs ? \'block\' : \'none\'}">                云硬盘采用按量计费的计费方式。当账户欠费时，若系统盘被隔离，子机不可用；若系统盘被清除，子机将一同被清除。如需屏蔽此逻辑，请联系大客户经理开通欠费不停服服务。                </p>            </div>            <button type="button" class="tc-15-btn m " data-event="oper_create" data-title="">+分配云主机</button>            <div class="tc-15-dropdown tc-15-dropdown-btn-style" id="zjmore_oper">                <a href="javascript:;" class="tc-15-dropdown-link">更多操作<i class="caret"></i></a>                <ul class="tc-15-dropdown-menu">                    <li class=\'disabled\' data-event="oper_reboot" data-name="reboot" data-title="请先选择云主机"><a href="javascript:;">重启</a></li>                    <li class=\'disabled\' data-event="oper_poweron" data-name="poweron" data-title="请先选择云主机"><a href="javascript:;">开机</a></li>                    <li class=\'disabled\' data-event="oper_poweroff" data-name="poweroff" data-title="请先选择云主机"><a href="javascript:;">关机</a></li>                    <li class=\'disabled\' data-event="oper_destroy" data-name="destroy" data-title="请先选择云主机"><a href="javascript:;">销毁</a></li>                </ul>            </div>            <button class="tc-15-btn weak m download" data-event="oper_export"  title="下载"></button>            <button b-ref="setting" class="tc-15-btn weak m setting" data-grid-setting title="设置列表显示字段"></button>            <qc-search b-ref="search" placeholder="请输入主机名/主机ID/IP进行搜索"></qc-search>        </div>            <div class="tc-15-action-panel" id="cdhCvmList">                <child-grid b-ref="grid" ></child-grid>            </div>    </div>    </div>',D='<div class="id-name-cell">    <p>        <a href="javascript:;" b-on-click="showVpsDetail(item)" >{{item.uInstanceId}}</a>    </p>    <div>        <span class="text-overflow m-width" title=""  > {{item.alias}}    </span>    </div></div>',P="<div class=\"cvm-oper-cell\" style=\"white-space:nowrap\">    <a b-if=\"item['opsAvailable']['BOOT']\" class=\"{{item.$loading ? 'disable' : ''}}\" href=\"javascript:;\" b-on-click=\"operExec('boot',item)\">开机</a>    <a b-if=\"item['opsAvailable']['SHUTDOWN']\" class=\"{{item.$loading ? 'disable' : ''}}\" href=\"javascript:;\" b-on-click=\"operExec('shutdown',item)\">关机</a>    <a b-if=\"item['opsAvailable']['REBOOT']\" class=\"{{item.$loading ? 'disable' : ''}}\"  href=\"javascript:;\" b-on-click=\"operExec('reboot',item)\">重启</a>    <a href=\"javascript:;\" class=\"{{item.$loading ? 'disable' : ''}}\" b-on-click=\"operExec('destroy',item)\">销毁</a></div>",S=r.tmpl('<div class="ip-cell">    <p><span class="text-overflow m-width" title="<%if(eipInfo){%>弹性<%}%>公网IP: <%= deviceWanIp %>"><%= deviceWanIp %><% if (deviceWanIp && deviceWanIp!="-") { %><i class="net-type">(<% if(eipInfo){ %>弹性<% }else{ %>公<% } %>)</i><% } %></span>        \x3c!--        <i class="copy-icon" data-clipboard-text="<%=deviceWanIp%>" style="display:none; cursor:pointer;" title="复制<%if(eipInfo){%>弹性<%}%>公网IP"></i> --\x3e    </p>    <p><span class="text-overflow m-width" title="内网IP: <%= deviceLanIp %>"><%= deviceLanIp %><% if (deviceLanIp && deviceLanIp!="-") { %><i class="net-type">(内)</i><% } %></span>        \x3c!--        <i class="copy-icon" data-clipboard-text="<%=deviceLanIp%>" style="display:none; cursor:pointer;" title="复制内网IP"></i> --\x3e    </p></div>',null),_=n.extend({$tpl:T,$afterInit:function(){_.__super__.$afterInit.call(this);_.hostItem=this.item,_.hostId=this.hostId,this.moreDropdown=new v(o(this.$el).find(".tc-15-dropdown"),{newMode:!0}),(k=this).bindEvents(),this.refresh(),this.grid.setmaxReqNum()},setCurentActive:function(e){this.grid.userLeave=1!=e},clearTask:function(){this.grid&&this.grid.clearCheckTask(),a=0},$destroy:function(){this.clearTask()},refresh:function(e){this.grid.getData(e),e&&e.refreshParent&&g.trigger("hostAliasChange","")},getSelectedItemData:function(e){e=parseInt(e);var t={},i=this.grid.list;return i&&(t=i[e]),t},rebootDialog:function(e){var t=this,i=new m({selectedItems:e?[e]:t.grid.getSelected()});s.create(i.$el,"600","",{title:"重启","class":"dialog_layer_v2 tc-15-rich-dialog",preventResubmit:!0,button:{"确定":function(e){i.doAction(s,t)}}})},bootDialog:function(e){var t=this,i=new p({selectedItems:e?[e]:t.grid.getSelected()});s.create(i.$el,"600","",{title:"开机","class":"dialog_layer_v2 tc-15-rich-dialog",preventResubmit:!0,button:{"确定":function(e){i.doAction(s,t)}}})},destroyDialog:function(e){var t=this,i=new h({selectedItems:e?[e]:t.grid.getSelected()});s.create(i.$el,"600","",{title:"销毁","class":"dialog_layer_v2 tc-15-rich-dialog",preventResubmit:!0,button:{"确定":function(e){i.doAction(s,t)}}})},shutdownDialog:function(e){var t=this,i=new l({selectedItems:e?[e]:t.grid.getSelected()});s.create(i.$el,"600","",{title:"关机","class":"dialog_layer_v2 tc-15-rich-dialog",preventResubmit:!0,button:{"确定":function(e){i.doAction(s,t)}}})},bindEvents:function(){var r=this;r.lockChange=!1;var t=["reboot","poweron","poweroff","destroy"];r.grid=r.$refs.grid;var e=o(r.$refs.grid.$el);(r.listEl=e).on("click",'input[type="checkbox"]',function(e){setTimeout(function(){var i=r.$refs.grid.getSelected().length;r.listEl=o("#cdhCvmList");var e=r.listEl.find('input[type="checkbox"]').not("[data-check-all]").not("[disabled]").filter(":checked").closest("tr"),a=r.$refs.grid.getSelected();o(e).each(function(e){var t=o(this);a[e].el=t});var s={reboot:!1,poweron:!1,poweroff:!1,destroy:!1};a.forEach(function(e){var t=e.opsAvailable;t.REBOOT&&(s.reboot=!0),t.BOOT&&(s.poweron=!0),t.SHUTDOWN&&(s.poweroff=!0),e.uHostId&&(s.destroy=!0)});var n={reboot:"运行中的云主机才可以重启",poweron:"关机状态的云主机才可以开机",poweroff:"运行中的云主机才可以关机",destroy:"当前状态不允许进行该操作"};t.forEach(function(e){var t=o(r.$el).find(".tc-15-dropdown").find('[data-name="'+e+'"]');0!=i&&s[e]?t.removeClass("disabled").attr("data-title",""):t.addClass("disabled").attr("data-title",0==i?"请先选择云主机":n[e])})},0)}),r.$refs.search.$on("search",function(e){r.grid.getData({searchKey:e})}),o(r.$refs.setting).click(function(){r.grid.showFieldsManager()}),d.bindCommonEvent(r.$el,"click",{oper_export:function(){var e=r.grid.list;b.exportChildList(e)},oper_create:function(){var e=f.CDH_CVM_CREATE_PAGE+"?buyMode=1&regionId="+w.getRegionId()+"&zoneId="+_.hostItem.zoneId+"&projectId="+_.hostItem.projectId+"&hostType="+_.hostItem.externalHostType+"&uHostId="+_.hostItem.uHostId;window.open(e)},oper_reboot:function(){o(this).hasClass("disabled")||r.rebootDialog()},oper_poweron:function(){o(this).hasClass("disabled")||r.bootDialog()},oper_poweroff:function(){o(this).hasClass("disabled")||r.shutdownDialog()},oper_destroy:function(){o(this).hasClass("disabled")||r.destroyDialog()}})}});_.tag("child-grid",I.extend({$mixins:I.prototype.$mixins.concat([u("cdh_subpage_grid_fields")]),getData:function(i,a){var s=this;(C=i=i||{}).sliceRefresh||(s.setData({list:[],totalNum:0}),s.showLoading("加载中..."));var e=(i.page-1)*i.count||0,t=i.count||20;a=function(e,t){e||t&&t.deviceList&&(0==t.deviceList.length&&0<t.totalNum?s.getData():(s.setData({list:t.deviceList,totalNum:t.totalNum,searchKey:i.searchKey||!1,page:i.page||1,count:i.count||20}),s.checkTask())),s.hideLoading()};var n={offset:e,count:t,projectId:w.getProjectId(),regionId:w.getRegionId(),uHostIdList:[_.hostItem.uHostId||_.hostId]};i.searchKey&&(s.checkIfIp(i.searchKey)?n.vagueIp=i.searchKey:0==i.searchKey.indexOf("ins-")?n.uInstanceIdList=[i.searchKey]:n.alias=i.searchKey),x.getCvmList(n,function(e){var t=new y({data:e.deviceList,isPrepaidUser:e.isPrepaidUser,isBandwidthPackageUser:e.isBandWidthPackageUser,serverTimestamp:e.serverTimestamp});e.deviceList=t,a(null,e)},function(){c.error("查询云主机列表信息失败！")},!i.sliceRefresh)},checkIfIp:function(e){return/^\d{1,3}((\.(\d{1,3})?)?){0,3}$/.test(e)},setTrAttr:function(e,t){return{"data-id":t.uInstanceId,"data-uuid":t.uuid}},userIsDoing:function(){return!!(0<this.getSelected().length||this.userLeave)},clearCheckTask:function(){clearTimeout(this.watingTime)},checkTask:function(){var t=this;t.isWating=!1,t.list.forEach(function(e){e.$loading&&(t.isWating=!0)}),t.clearCheckTask(),t.isWating?this.watingTime=setTimeout(function(){t.userIsDoing()?t.checkTask():a&&(a--,C.sliceRefresh=!0,t.getData(C))},5e3):t.setmaxReqNum()},setmaxReqNum:function(){a=200},showVpsDetail:function(e){window.location.href=f.CVM_DETAIL_PAGE+w.getRegionId()+"/"+e.uInstanceId},getCellContent:function(e,t,i){var a;switch(i.key){case"idAndName":a=D;break;case"cpuInfo":return t.cpu,t.cpu+"核";case"memInfo":return t.mem,t.mem+"GB";case"statusDesc":return'<span class="status-col">'+(e||"-")+"</span>";case"ipAddress":var s=t.deviceLanIp||"-",n=t.deviceWanIp||"-",r=t.eipInfo;return S({deviceLanIp:s,deviceWanIp:n,eipInfo:r});case"_action":a=P;break;default:a='<span class="text-overflow">'+(e||"-")+"</span>"}return a},operExec:function(e,t){if(!t.$loading)switch(t.el=o("#cdhCvmList").find('tr[data-uuid="'+t.uuid+'"]'),"reboot"==e&&k.rebootDialog(t),e){case"boot":k.bootDialog(t);break;case"shutdown":k.shutdownDialog(t);break;case"reboot":k.rebootDialog(t);break;case"destroy":k.destroyDialog(t)}}},{defaults:{initGetData:!0,hasFirst:!0,colums:[{name:"ID/主机名",key:"idAndName",width:200,required:!0},{name:"状态",key:"statusDesc",width:90},{name:"所属网络",key:"netName",width:80},{name:"所在子网",key:"subnetName",width:90},{name:"IP地址",key:"ipAddress",minWidth:200},{name:"CPU",key:"cpuInfo",width:100},{name:"内存",key:"memInfo",width:100},{name:"系统盘",key:"sysDiskInfo",minWidth:150},{name:"数据盘",key:"diskInfo",minWidth:150},{name:"可用区",key:"zoneName"},{name:"公网带宽",key:"bandwidthInfo",hide:!0},{name:"镜像ID",key:"unImgIdInfo",hide:!0},{name:"操作系统",key:"osName",hide:!0},{name:"网络计费模式",key:"networkPayModeDesc",hide:!0},{name:"所属项目",key:"projectName",hide:!0},{name:"创建时间",key:"addTimeStamp",hide:!0},{name:"操作",required:!0,width:100,key:"_action"}]}})),i.exports=_}),define("modules/cvm/cdh/detail/configdetail",function(e,t,i){e("$");var a=e("dialog"),s=e("modules/cvm/cdh/dialog/renew"),n=e("modules/cvm/cdh/dialog/rename"),r=e("widget/pubsubhub/pubsubhub"),o=e("qccomponent").extend({$tpl:'    <div class="param-box" >        <div class="param-hd">            <h3>基本信息</h3>        </div>        <div class="param-bd">            <ul class="item-descr-list">                <li data-devicelanip="<%=deviceLanIp%>" data-uuid="<%=uuid%>">                    <span class="item-descr-tit">宿主机名</span>                    <span class="item-descr-txt hostname">{{item.hostAlias ? item.hostAlias : \'未命名\'}} <a href="javascript:;" class="pencil-icon" b-on-click="rename()"></a></span>                </li>                <li>                    <span class="item-descr-tit">宿主机ID</span>                    <span class="item-descr-txt">{{item.uHostId}}</span>                </li>                <li b-if="item.cageId">                    <span class="item-descr-tit">所属围笼ID</span>                    <span class="item-descr-txt">{{item.cageId}}</span>                </li>                <li b-if="item.cageId">                    <span class="item-descr-tit">所属围笼名称</span>                    <span class="item-descr-txt">{{item.cageAlias || \'未命名\'}}</span>                </li>                <li>                    <span class="item-descr-tit">状态</span>                    <span class="item-descr-txt status-tips">{{item.status ? \'运行中\' : \'待付款\'}}</span>                </li>                <li>                    <span class="item-descr-tit">机型</span>                    <span class="item-descr-txt">{{item.externalHostType}}</span>                </li>                <li>                    <span class="item-descr-tit">CPU</span>                    <span class="item-descr-txt">{{item.cpuTotal}}核</span>                </li>                <li>                    <span class="item-descr-tit">内存</span>                    <span class="item-descr-txt">{{item.memTotal}}G</span>                </li>                <li>                    <span class="item-descr-tit">硬盘容量</span>                    <span class="item-descr-txt">{{item.diskTotal}}G</span>                </li>                <li>                    <span class="item-descr-tit">地域</span>                    <span class="item-descr-txt">{{regionName}}</span>                </li>                <li>                    <span class="item-descr-tit">可用区</span>                    <span class="item-descr-txt">{{item.zoneName}}</span>                </li>                <li>                    <span class="item-descr-tit">宿主机计费模式</span>                    <span class="item-descr-txt">包年包月</span>                </li>                <li>                    <span class="item-descr-tit">创建时间</span>                    <span class="item-descr-txt">{{item.modTimeStamp}}</span>                </li>                <li>                    <span class="item-descr-tit">到期时间</span>                    <span class="item-descr-txt">{{item.deadline}}</span>                    <a href="javascrpt:;" b-on-click="renew()">续费</a>                </li>            </ul>        </div>    </div>',$afterInit:function(){o.__super__.$afterInit.call(this)},$beforeDestroy:function(){},setCurentActive:function(e){},rename:function(){var t=this,i=new n({newName:t.item.hostAlias||"未命名",selectedItem:[t.item]});a.create(i.$el,"600","",{title:"改名","class":"dialog_layer_v2 tc-15-rich-dialog new-gateway",preventResubmit:!0,button:{"确定":function(e){i.doAction(a,function(e){t.item.hostAlias=e,t.$set("item",t.item),r.trigger("hostAliasChange",e)})}}})},renew:function(){var t=new s({newName:"testNewName",selectedItem:[this.item]});a.create(t.$el,"700","",{title:"续费","class":"dialog_layer_v2 tc-15-rich-dialog new-gateway",preventResubmit:!0,button:{"确定":function(e){t.doAction(a)}}})}});i.exports=o}),define("modules/cvm/cdh/detail/monitordetail",function(e,t,i){e("Highcharts");e("$"),e("dialog"),e("util");var d,c=e("appUtil"),a=e("qccomponent"),l=e("manager"),s=(a.getComponent("grid-view"),e("modules/cvm/cdh/dialog/cdhchart")),p={cpu:[{viewName:"host_cpu",metricName:"logic_cpu_usage",statistics:"max",cpu_name:"cpu"}],mem:[{viewName:"host_detail",metricName:"mem_total",statistics:"max"},{viewName:"host_detail",metricName:"mem_available",statistics:"max"}],lan:[{viewName:"host_detail",metricName:"eth0_intraffic",statistics:"max"},{viewName:"host_detail",metricName:"eth0_outtraffic",statistics:"max"}],disk:[{viewName:"host_detail",metricName:"disk_read_traffic",statistics:"max"},{viewName:"host_detail",metricName:"disk_write_traffic",statistics:"max"},{viewName:"host_detail",metricName:"disk_await",statistics:"max"}]},u=[{name:["cpu利用率"],color:["#ff7a22"],units:["%"]},{name:["总内存","可用内存"],color:["#ff7a22","#1C86EE"],units:["GB","GB"],yUnit:"GB"},{name:["内网入带宽","内网出带宽"],color:["#ff7a22","#1C86EE"],units:["Mbps","Mbps"],yUnit:""},{name:["磁盘读流量","磁盘写流量"],color:["#ff7a22","#1C86EE"],units:["kb/s","kb/s"],yUnit:"kb/s"}],m=["cpu","mem","lan","disk"],h=function(e){if("REALTIME"==e)return new Date;var t=e.split("-"),i=new Date(0);return i.setFullYear(+t[0],+t[1]-1,+t[2]),i},n=a.extend({$tpl:'            <div class="tab-panel param-panel" >                <div class="cdh-data-box monitor-list mb20">                    <ul>                        <li>                            <p class="text">当前CPU使用率</p>                            <h3>{{realTimeData.cpuUsage ? realTimeData.cpuUsage : \'-\' }}<em class="percent-text">%</em></h3>                        </li>                        <li>                            <p class="text">当前内存使用率</p>                            <h3>{{realTimeData.memUsage ? realTimeData.memUsage : \'-\' }}<em class="percent-text">%</em></h3>                        </li>                        <li>                            <p class="text">可用磁盘空间</p>                            <h3 class="warning-text">{{realTimeData.diskAvail ? realTimeData.diskAvail : \'-\' }}<em class="percent-text">GB</em></h3>                        </li>                        <li>                            <p class="text">当前带宽流量</p>                            <h3 class="warning-text">{{realTimeData.outTraffic ? realTimeData.outTraffic : \'-\' }}<em class="percent-text">Mbps</em></h3>                        </li>                    </ul>                </div>                \x3c!-- 统计数据 E--\x3e                <div class="monitor-data">                    \x3c!-- 统计数据头部 E--\x3e                    <div class="monitor-data-head">                        <div class="tc-15-calendar-select-wrap tc-15-calendar2-hook mb20">                            <qc-date-picker b-ref="datePicker" tabs="{{tabs}}" showCalendar="{{showCalendar}}" selected="{{selected}}" range="{{range}}" id="logDatePicker"></qc-date-picker>                        </div>                        \x3c!--                        <button type="button" class="tc-15-btn m weak ml10">添加时间对比</button>                        <div class="monitor-data-tool ml10">                            <ul class="monitor-data-toggle">                                <li class="data-check">                                    <i class="monitor-view-list" b-on-click="toggleChartMode(false)"></i>                                </li>                                <li>                                    <i class="monitor-view-img" b-on-click="toggleChartMode(true)"></i>                                </li>                            </ul>                            <button type="button" class="tc-15-btn weak m download">下载</button>                        </div>                        --\x3e                        <div class="monitor-data-tab"  b-if="!fullChartMode">                            <ul role="tablist" class="tc-15-tablist">                                <li b-repeat="tab in tabsList" class="{{activeIndex == tab.index ? \'tc-cur\' : \'\'}}"><a href="javascript:;" b-on-click="tabSelect(tab.index)" title="" role="tab">{{tab.title}}</a></li>                                \x3c!--                                <li><a href="#" title="" role="tab">CPU使用情况</a></li>                                <li><a href="#" title="" role="tab">内存监控</a></li>                                <li><a href="#" title="" role="tab">内网流量</a></li>                                <li><a href="#" title="" role="tab">公网流量</a></li>                                <li class="tc-cur"><a href="#" title="" role="tab">CPU磁盘监控</a></li>                                --\x3e                            </ul>                        </div>                    </div>                    \x3c!-- 统计数据头部 S--\x3e                    \x3c!-- 统计数据内容 E--\x3e                    <div class="monitor-data-body"  b-if="!fullChartMode">                        \x3c!-- 统计数据内容1 E--\x3e                        <div class="finance-chart-box">                            <div b-tag="chart" b-ref="chart1"></div>                            <div b-if="secondChart" b-tag="chart" b-ref="chart2"></div>                            \x3c!--                                                        <div b-if="thirdChart" b-tag="chart" b-ref="chart3"></div>                                                        <div ="fourthChart" b-tag="chart" b-ref="chart4"></div>                                                        \x3c!--                                                        <h3 class="mb20">数据报表</h3>                                                        <monitor-data-grid b-ref="grid" ></monitor-data-grid>                                                         --\x3e                        </div>                        \x3c!-- 统计数据内容详情1 S--\x3e                    </div>                    <div  b-if="fullChartMode" id="monitorDetail">\x3c!--                        <div class="chart-row">                            <div b-tag="chart" b-ref="test1"></div>                            <div class="chart-cell gap-cell"></div>                            <div b-tag="chart" b-ref="test2"></div>                        </div> --\x3e                    </div>                    \x3c!-- 统计数据内容 S--\x3e                </div>                \x3c!-- 统计数据 S--\x3e            </div>',activeIndex:0,tabsList:[{index:0,title:"CPU使用情况"},{index:1,title:"内存监控"},{index:2,title:"内网流量"},{index:3,title:"磁盘监控"}],$afterInit:function(){n.__super__.$afterInit.call(this);var e=this;e.initDatePicker(),e.tabSelect(0),e.chartRefs=[e.$refs.chart1,e.$refs.chart2],setTimeout(function(){e.condChange()},200),e.refresh()},setCurentActive:function(e){},initDatePicker:function(){var t=this;(d=t.$refs.datePicker).setAllowRange(null,"%TODAY"),d.$on("datepick",function(e){t.condChange()})},$beforeDestroy:function(){},refresh:function(e){this.refreshRealTimeData()},refreshRealTimeData:function(){var t=this;l.getRealTimeCdhData({regionId:c.getRegionId(),lanip:t.item.hostIp},function(e){t.$set("realTimeData",e)})},tabSelect:function(e){this.activeIndex!=e&&(this.$set("activeIndex",e),this.condChange())},toggleChartMode:function(e){this.$set("fullChartMode",e),this.condChange()},showIndexChart:function(e){3==this.activeIndex?this.$set("secondChart",!0):this.$set("secondChart",!1),this.chartRefs=[this.$refs.chart1,this.$refs.chart2]},setChartTitles:function(){var e=this;e.chart1=e.$refs.chart1,0==e.activeIndex?(e.$refs.chart1.$set("chartTitle","CPU使用率"),e.$refs.chart1.$set("chartUnit","")):1==e.activeIndex?(e.$refs.chart1.$set("chartTitle","内存"),e.$refs.chart1.$set("chartUnit","GB")):2==e.activeIndex?(e.$refs.chart1.$set("chartTitle","内网带宽"),e.$refs.chart1.$set("chartUnit","Mbps")):3==e.activeIndex&&(e.$refs.chart1.$set("chartTitle","磁盘读写流量"),e.$refs.chart1.$set("chartUnit","kb/s"),e.$refs.chart2.$set("chartTitle","磁盘IO await"),e.$refs.chart2.$set("chartUnit","ms"))},condChange:function(){var s=this,e=d.selected;if(!s.fullChartMode){var t=p[m[s.activeIndex]];s.showIndexChart(t.length),s.setChartTitles();var i=h(e.from),a=h(e.to),n=[],r=u[s.activeIndex];t.forEach(function(e,t){n.push(e.metricName)});var o={chartOnly:!0,colums:n,startDate:Math.round(i.getTime()/1e3),endDate:Math.round(a.getTime()/1e3),lanip:s.item.hostIp,regionId:c.getRegionId()};s.chartRefs[0].$set("data",{loading:!0}),s.chartRefs[1]&&s.chartRefs[1].$set("data",{loading:!0}),l.getCdhMonitorChartData(o,function(a){if(1==n.length){var e=a[n[0]];"logic_cpu_usage"==n[0]&&(e.unit="%",e.yUnit="%"),s.chartRefs[0].$set("data",e)}else if(1!=s.activeIndex&&2!=s.activeIndex&&3!=s.activeIndex)n.forEach(function(e,t){var i=a[n[t]];"mem_total"==e&&(i.unit="%",i.yUnit="%"),"mem_available"==e&&(i.unit="GB",i.yUnit="GB"),s.chartRefs[t].$set("data",i)});else{e={multi:!0,yUnit:r.yUnit,dayView:a[n[0]].dayView,x:a[n[0]].x,chartOpt:r};var t=[];if(t.push(a[n[0]]),t.push(a[n[1]]),e.list=t,s.chartRefs[0].$set("data",e),3==s.activeIndex){var i=a[n[2]];i.unit="ms",i.yUnit="ms",s.chartRefs[1].$set("data",i)}}})}},loadCharts:function(){}},{defaults:{tabs:[{label:"近24h",from:"REALTIME",to:"REALTIME",display:"近24h"},{label:"近7天",from:"%TODAY-7",to:"%TODAY"},{label:"近14天",from:"%TODAY-14",to:"%TODAY"}],showCalendar:!0,selected:{from:"REALTIME",to:"REALTIME"},range:{min:"%TODAY-30",max:"%TODAY",maxLength:"30"}}});n.tag("chart",s.extend({})),i.exports=n}),define("modules/cvm/cdh/detail/monitorflow",function(e,t,i){e("$");var n=e("manager"),r=(e("util"),e("appUtil")),a=e("qccomponent"),s=e("modules/cvm/cdh/basechart"),o='    <div class="chart-wrap">        <div class="chart-grid">            <div class="chart-row">                <div b-tag="chart" b-ref="cpuUsage"></div>                <div class="chart-cell gap-cell"></div>            </div>            <div class="chart-row">                <div b-tag="chart" b-ref="memAvail"></div>                <div class="chart-cell gap-cell"></div>                <div b-tag="chart" b-ref="memTotal"></div>            </div>            <div class="chart-row">                <div b-tag="chart" b-ref="inTraffic"></div>                <div class="chart-cell gap-cell"></div>                <div b-tag="chart" b-ref="outTraffic"></div>            </div>            <div class="chart-row">                <div b-tag="chart" b-ref="diskAvail"></div>                <div class="chart-cell gap-cell"></div>                <div b-tag="chart" b-ref="diskAwait"></div>            </div>            <div class="chart-row">                <div b-tag="chart" b-ref="diskRead"></div>                <div class="chart-cell gap-cell"></div>                <div b-tag="chart" b-ref="diskWrite"></div>            </div>            \x3c!--            <div class="chart-row">                <chart-row b-ref="chart1"></chart-row>                <div class="chart-cell gap-cell"></div>                <chart-row2 b-ref="chart2"></chart-row2>            </div>            --\x3e        </div>        <div style="height: 50px">        </div>    </div>',d=[{chartName:"memAvail",viewName:"mem_available",chartTitle:"可用内存",chartUnit:"GB",yUnit:"G"},{chartName:"memTotal",viewName:"mem_total",chartTitle:"总内存",chartUnit:"GB",yUnit:"G"},{chartName:"inTraffic",viewName:"eth0_intraffic",chartTitle:"内网入带宽",chartUnit:"Mbps",yUnit:"Mbps"},{chartName:"outTraffic",viewName:"eth0_outtraffic",chartTitle:"内网出带宽",chartUnit:"Mbps",yUnit:"Mbps"},{chartName:"diskAvail",viewName:"disk_available",chartTitle:"可用磁盘空间",chartUnit:"GB",yUnit:"G"},{chartName:"diskAwait",viewName:"disk_await",chartTitle:"磁盘IO Await",chartUnit:"ms",yUnit:"ms"},{chartName:"diskRead",viewName:"disk_read_traffic",chartTitle:"磁盘读流量",chartUnit:"KB/s",yUnit:"KB/s"},{chartName:"diskWrite",viewName:"disk_write_traffic",chartTitle:"磁盘写流量",chartUnit:"KB/s",yUnit:"KB/s"}],c=a.extend({});c.tag("chart",s.extend({}));var l=function(e){if("REALTIME"==e)return new Date;var t=e.split("-"),i=new Date(0);return i.setFullYear(+t[0],+t[1]-1,+t[2]),i};i.exports={render:function(e,t){var i=this,a=i.bee=new c(o,{$data:{}});i.hostData=t,i.cpuUsage=a.$refs.cpuUsage,i.cpuUsage.$set("chartTitle","CPU使用率"),i.chartRefs=[],d.forEach(function(e){var t=a.$refs[e.chartName];t.$set("chartTitle",e.chartTitle),t.$set("chartUnit",e.chartUnit),i.chartRefs.push({yUnit:e.yUnit,unit:e.chartUnit,viewName:e.viewName,chartRef:t})}),e.html(a.$el)},dateSelected:function(e){this.loadChartData(e)},setChartDatas:function(t){t=t||{};var i={y:[]};this.chartRefs.forEach(function(e){t.empty?e.chartRef.$set("data",i):t.data?t.data[e.viewName]?e.chartRef.$set("data",t.data[e.viewName]):e.chartRef.$set("data",i):e.chartRef.$set("data",null)})},loadChartData:function(e){var t=this,i=l(e.from),a=l(e.to),s={statistics:"max",startDate:Math.round(i.getTime()/1e3),endDate:Math.round(a.getTime()/1e3),lanip:t.hostData.hostIp,regionId:r.getRegionId(),viewName:"host_cpu",metricName:"logic_cpu_usage"};t.cpuUsage.$set("data",{loading:!0}),n.getCdhChartData(s,function(e){e.yUnit="%",e.unit="%",t.cpuUsage.$set("data",e)},function(){t.cpuUsage.$set("data",{y:[]})}),t.loadChartDatas(s)},loadChartDatas:function(e){e.viewName="host_detail",this.chartRefs.forEach(function(t){e.metricName=t.viewName,t.chartRef.$set("data",{loading:!0}),n.getCdhChartData(e,function(e){e.yUnit=t.yUnit,e.unit=t.unit,t.chartRef.$set("data",e)},function(){t.chartRef.$set("data",{y:[]})})})},loadChartDataBatch:function(e){var t=this;t.setChartDatas(),t.cpuUsage.$set("data",null),n.getCdhChartDataBatch(e,function(e){e&&t.setChartDatas({data:e})},function(){t.setChartDatas({empty:!0})})}}}),define("modules/cvm/cdh/detail/monitorpanel",function(e,t,i){var a,s=e("$"),n=e("manager"),r=(e("util"),e("appUtil")),o=e("qccomponent"),d=e("modules/cvm/cdh/detail/monitorflow"),c=(e("reporter"),'    <div class="sidebar-panel-container">        <div class="sidebar-panel-hd">            <h3>{{hostData.uHostId}}  监控</h3>            <span class="details-hd-meta">{{hostData.hostAlias}}</span>            \x3c!--            <a href="#" class="details-hd-a">查看数据明细</a> --\x3e        </div>    <div class="sidebar-panel-bd cdh-panel">        <div class="tc-15-rich-tab col4 cdh-data-panel">            <ul role="tablist">                <li class="tc-cur">                    <div role="tab" class="tab">                        <div class="tc-15-rich-tab-title">当前CPU使用率</div>                        <div class="tc-15-rich-tab-value">{{realTimeData.cpuUsage ? realTimeData.cpuUsage : \'--\' }}<span class="tc-15-rich-tab-unit">%</span></div>                    </div>                </li>                <li class="tc-cur">                    <div role="tab" class="tab">                        <div class="tc-15-rich-tab-title">                            当前内存使用率                        </div>                        <div class="tc-15-rich-tab-value">{{realTimeData.memUsage ? realTimeData.memUsage : \'--\' }}<span class="tc-15-rich-tab-unit">%</span></div>                    </div>                </li>                <li class="tc-cur">                    <div role="tab" class="tab">                        <div class="tc-15-rich-tab-title">可用磁盘空间</div>                        <div class="tc-15-rich-tab-value">{{realTimeData.diskAvail ? realTimeData.diskAvail : \'--\' }}<span class="tc-15-rich-tab-unit">GB</span></div>                    </div>                </li>                <li class="tc-cur">                    <div role="tab" class="tab" style="border-right: none;">                        <div class="tc-15-rich-tab-title">当前宽带流量</div>                        <div class="tc-15-rich-tab-value">{{realTimeData.outTraffic ? realTimeData.outTraffic : \'-\' }}<span class="tc-15-rich-tab-unit">Mbps</span></div>                    </div>                </li>            </ul>        </div>        <div class="charts-panel">                <qc-date-picker b-ref="datePicker" tabs="{{tabs}}" showCalendar="{{showCalendar}}" selected="{{selected}}" range="{{range}}" id="chartDatePicker"></qc-date-picker>            <div id="monitorFlowWrap"></div>        </div>    </div>    </div>'),l=o.extend({$afterInit:function(){l.__super__.$afterInit.call(this);this.initDatePicker(),this.refreshRealTimeData()},initDatePicker:function(){var t=this;(a=t.$refs.datePicker).setAllowRange(null,"%TODAY"),a.$on("datepick",function(e){t.dateChange(e)}),setTimeout(function(){t.dateChange(a.selected)},500)},dateChange:function(e){d.dateSelected(e)},refreshRealTimeData:function(){var t=this;n.getRealTimeCdhData({regionId:r.getRegionId(),lanip:t.hostData.hostIp},function(e){t.$set("realTimeData",e)})}},{defaults:{tabs:[{label:"近24h",from:"REALTIME",to:"REALTIME",display:"近24h"},{label:"近7天",from:"%TODAY-7",to:"%TODAY"},{label:"近14天",from:"%TODAY-14",to:"%TODAY"}],showCalendar:!0,selected:{from:"REALTIME",to:"REALTIME"},range:{min:"%TODAY-30",max:"%TODAY",maxLength:"30"}}});i.exports={render:function(e,t){var i=new l(c,{hostData:t});e.html(i.$el),d.render(s("#monitorFlowWrap"),t)},destroy:function(){}}}),define("modules/cvm/cdh/dialog/boot",function(e,t,i){var a=e("$"),s=e("qccomponent"),o=e("manager"),n=e("dialog"),d=e("modules/cvm/cdh/taskchecker"),r=s.extend({$tpl:'    <div>        <div class="act-outline" id="selectedShowWrap">            <div class="act-summary">您已选<strong class="cdh-color-org">{{selectedItems.length}}台云主机</strong>                <span b-if="unAbleNum">，其中<strong class="cdh-color-org">{{unAbleNum}}台云主机</strong>将不能</span>            执行开机操作，                <a href="javascript:;" b-on-click="toggleList()">{{toggleTip ? toggleTip : \'收起列表\'}}<i id="selectedShowIconArr" class="icon-arrow-down"></i></a></div>            <div class="act-details" style="display:block" id="listDetail">                <table class="act-details-tb">                    <tbody>                    <tr b-repeat="item in selectedItems">                        <td>{{selectedItems.indexOf(item)+1}}</td>                        <td>                            <span class="entity-name" title="{{item.uInstanceId}}">{{item.uInstanceId}}</span><span class="{{item[\'opsAvailable\'][\'BOOT\'] ? \'act-result\' : \'act-result cdh-color-org\'}}">{{item[\'opsAvailable\'][\'BOOT\'] ? \'可开机\' : \'关机状态的主机才可开机\'}} </span>                        </td>                    </tr>                    </tbody>                </table>            </div>        </div>        <div class="coin-alert">            <table class="ui-popmsg">                <tbody>                <tr>                    <td height="72" class="t">                                    <span class="info">                                        <span class="tit">确定选中主机进行开机？</span><br>                                        </span>                    </td>                </tr>                </tbody>            </table>        </div>    </div>',$beforeInit:function(){var t=[],i=[],a={actionName:"开机",hasPermItems:[],noPermItems:[]};this.selectedItems.forEach(function(e){e.opsAvailable.BOOT?(t.push(e),a.hasPermItems.push({name:e.alias})):(i.push(e),a.noPermItems.push({name:e.alias,reason:"关闭中的主机才可以执行开机操作"}))});var e={hasPermItems:t,noPermItems:i,selectedShowOptions:a};this.permResult=e,this.ableList=t;var s=this.selectedItems.length-t.length;0<s&&this.$set("unAbleNum",s)},$afterInit:function(){},doAction:function(e,i){for(var t,a=this,s=[],n=[],r=0;t=a.ableList[r];r++)s.push(t.deviceLanIp),n.push(t.uuid);n.length&&o.cvmAction({actionType:1,deviceInfo:s,uuidList:n},function(e){var t={permResult:a.permResult,selectedItems:a.selectedItems,listIns:i,gridView:i.grid,cvmListEl:i.listEl};d.checkTask(e,"开机中",t)}),e.hide()},toggleList:function(){var e=a("#listDetail"),t=a("#selectedShowIconArr");e.toggle(),e.is(":visible")?(t.removeClass("icon-arrow-down").addClass("icon-arrow-up"),this.$set("toggleTip","收起列表")):(t.removeClass("icon-arrow-up").addClass("icon-arrow-down"),this.$set("toggleTip","展开列表")),n.center()}});i.exports=r}),define("modules/cvm/cdh/dialog/cdhchart",function(e,t,i){e("Highcharts");var c=e("$"),l=(e("pageManager"),e("appUtil")),a=e("qccomponent"),p={loading:{style:{backgroundColor:"white"},labelStyle:{color:"silver"}},chart:{zoomType:"x"},title:{text:""},yAxis:[{title:{text:""},lineWidth:1,tickPixelInterval:45,min:0,labels:{style:{fontSize:"12px"}}}],plotOptions:{},credits:{enabled:!1},legend:{enabled:!1},tooltip:{shared:!0}};i.exports=a.extend({$tpl:'    <div class="mb20 chart-grid">        <h4 class="chart-title">{{chartTitle}}<span class="text-unit">{{chartUnit ? \'(单位：\'+chartUnit+\')\' : \'\'}}</span></h4>        <div b-if="!noData" data-mod="chart" style="height: 250px">        </div>        <div class="mb20 chart-grid" b-if="noData" style="height: 250px;">            <span >{{loading ? \'加载中...\' : \'没有数据\'}}</span>        </div>    </div>',$valuekey:"data",$afterInit:function(){var t=this;t.$chart=c(t.$el).find('[data-mod="chart"]');t.$watch("data",function(){if(t.data)t.data.multi?t.showMultiChart():t.showChart();else{var e=t.$chart.highcharts();e||(t.$chart.highcharts(p),e=t.$chart.highcharts()),e.showLoading()}},!0)},showChart:function(){var e,t=this.data,i=t.dayView,a=!0,s=this.$chart,n={xAxis:{type:"datetime",dateTimeLabelFormats:{hour:"%H:%M"},tickPixelInterval:80,title:{text:""}}};if(t.y&&t.y.length){c.extend(n,p);var r=t.yUnit||"",o=t.unit||"";n.yAxis=[{title:{text:""},lineWidth:1,tickPixelInterval:45,min:0,labels:{format:"{value}"+r,style:{fontSize:"12px"}}}],e=l.cgwTimeParse(t.x[0]),n.series=[{pointStart:e.getTime()-6e4*e.getTimezoneOffset(),data:t.y}],n.tooltip.formatter=i?(n.series[0].pointInterval=864e5,n.series[0].color="#ff7a22",n.xAxis.dateTimeLabelFormats.day="%m-%d",n.xAxis.dateTimeLabelFormats.week="%m-%d",function(){var e=new Date(this.x);return e=new Date(e.getTime()+6e4*e.getTimezoneOffset()),[l.formatDate(e,"MM-dd")," ","<b>",this.y,o,"</b>"].join("")}):(n.series[0].pointInterval=3e5,n.series[0].type="spline",n.series[0].color="#ff7a22",n.xAxis.dateTimeLabelFormats.day="%H:%M",n.xAxis.maxZoom=36e5,function(){var e=new Date(this.x);return e=new Date(e.getTime()+6e4*e.getTimezoneOffset()),[l.formatDate(e,"hh:mm")," ","<b>",this.y,o,"</b>"].join("")}),s.highcharts(n),a=!1}var d=this.data.loading;this.$set("loading",d),this.$set("noData",a),this.$chart.highcharts()&&!d&&this.$chart.highcharts().hideLoading(),c(window).resize()},showMultiChart:function(){var e,i=this.data,a=i.dayView,s=!0,t=this.$chart,n={xAxis:{type:"datetime",dateTimeLabelFormats:{hour:"%H:%M"},tickPixelInterval:80,title:{text:""}}};if(i.list&&i.list.length){c.extend(n,p);var r=(e=l.cgwTimeParse(i.x[0])).getTime()-6e4*e.getTimezoneOffset(),o=i.yUnit||"";n.yAxis=[{title:{text:""},lineWidth:1,tickPixelInterval:45,min:0,labels:{format:"{value}"+o,style:{fontSize:"12px"}}}],n.legend={layout:"vertical",align:"left",x:100,verticalAlign:"top",y:20,floating:!0,backgroundColor:"#FFFFFF"},n.series=[],i.list.forEach(function(e,t){e.y&&e.y.length&&(n.series.push({pointStart:r,data:e.y}),n.tooltip.formatter=a?(n.series[t].pointInterval=864e5,n.series[t].name=i.chartOpt.name[t],n.series[t].color=i.chartOpt.color[t],n.xAxis.dateTimeLabelFormats.day="%m-%d",n.xAxis.dateTimeLabelFormats.week="%m-%d",function(){var e=new Date(this.x);return e=new Date(e.getTime()+6e4*e.getTimezoneOffset()),[l.formatDate(e,"yyyy-MM-dd")," <br>",this.points[0].series.name,"  ","<b>",this.points[0].y,i.chartOpt.units[0],"</b>","<br>",this.points[1].series.name,"  ","<b>",this.points[1].y,i.chartOpt.units[1],"</b>"].join("")}):(n.series[t].pointInterval=3e5,n.series[t].type="spline",n.series[t].name=i.chartOpt.name[t],n.series[t].color=i.chartOpt.color[t],n.xAxis.dateTimeLabelFormats.day="%H:%M",n.xAxis.maxZoom=36e5,function(){var e=new Date(this.x);return e=new Date(e.getTime()+6e4*e.getTimezoneOffset()),[l.formatDate(e,"hh:mm")," <br>",this.points[0].series.name,"  ","<b>",this.points[0].y,i.chartOpt.units[0],"</b>","<br>",this.points[1].series.name,"  ","<b>",this.points[1].y,i.chartOpt.units[1],"</b>"].join("")}),s=!1)}),t.highcharts(n)}this.$set("noData",s),this.$chart.highcharts()&&this.$chart.highcharts().hideLoading(),c(window).resize()}})}),define("modules/cvm/cdh/dialog/destroy",function(e,t,i){var o=e("$"),a=e("qccomponent"),s=(e("widget/pills/pills"),e("dialog")),d=e("manager"),c=e("modules/cvm/cdh/taskchecker"),l=e("appUtil"),n='    <div>        <div class="act-outline" id="selectedShowWrap">            <div class="act-summary">您已选<strong class="cdh-color-org">{{selectedItems.length}}台云主机</strong>                <span b-if="unAbleNum">，其中<strong class="cdh-color-org">{{unAbleNum}}台云主机</strong>将不能</span>                执行销毁操作，                <a href="javascript:;" b-on-click="toggleList()">{{toggleTip ? toggleTip : \'收起列表\'}}<i id="selectedShowIconArr" class="icon-arrow-down"></i></a></div>            <div class="act-details" style="display:block" id="listDetail">                <table class="act-details-tb">                    <tbody>                    <tr b-repeat="item in selectedItems">                        <td>{{selectedItems.indexOf(item)+1}}</td>                        <td>                            <span class="entity-name" title="{{item.uInstanceId}}">{{item.uInstanceId}}</span><span class="{{item.uHostId ? \'act-result\' : \'act-result cdh-color-org\'}}">{{item.uHostId ? \'可销毁\' : \'独享型的机器才可以执行销毁操作\'}} </span>                        </td>                    </tr>                    </tbody>                </table>            </div>        </div>        <div class="coin-alert">            <table class="ui-popmsg">                <tbody>                <tr>                    <td height="72" class="t">                                    <span class="info">                                        <span class="tit">确定选中主机进行销毁？</span><br>                                            \x3c!--<label>                                                重启期间，主机将无法正常提供服务，请您做好准备，以免造成影响                                            </label> --\x3e                                            <label class="confirm-it">                                                <input type="checkbox" class="tc-15-checkbox" id="retryConfirmCheck">销毁失败时进行重试                                            </label>                                            <div class="tc-15-msg mt15">                                                销毁后所有数据将被清除且不可恢复，请慎重处理,请提前备份数据                                            </div>                                        </span>                    </td>                </tr>                </tbody>            </table>        </div>    </div>',r='<div>    <div class="coin-alert">        <table class="ui-popmsg">            <tbody>            <tr>                <td height="72" class="t">                                    <span class="info">                                        <span class="tit">无法销毁您选择的机器!</span><br>                                            <div class="tc-15-msg mt15">                                                销毁前需要解绑该机器上的lb负载均衡，否则不能进行销毁。请解绑要销毁设备上的lb负载均衡再执行销毁操作。                                            </div>                                        </span>                </td>            </tr>            </tbody>        </table>    </div></div>',p='<div>    <div class="coin-alert">        <table class="ui-popmsg">            <tbody>            <tr>                <td height="72" class="t">                                    <span class="info">                                        <span class="tit">操作失败!</span><br>                                            <div class="tc-15-msg mt15">                                                销毁云主机失败，请稍后重试。                                            </div>                                        </span>                </td>            </tr>            </tbody>        </table>    </div></div>',u=a.extend({$tpl:n,$afterInit:function(){var t=[],i=[],a={actionName:"销毁",hasPermItems:[],noPermItems:[]};this.selectedItems.forEach(function(e){e.uHostId?(t.push(e),a.hasPermItems.push({name:e.alias})):(i.push(e),a.noPermItems.push({name:e.alias,reason:"独享型的云主机才可以执行销毁操作"}))});var e={hasPermItems:t,noPermItems:i,selectedShowOptions:a};this.permResult=e,this.ableList=t;var s=this.selectedItems.length-t.length;0<s&&this.$set("unAbleNum",s)},doAction:function(e,i,a){for(var t,s=[],n=this,r=(o("#retryConfirmCheck").prop("checked"),0);t=n.ableList[r];r++)s.push(t.uuid);0<s.length&&d.returnCvmInTime({regionId:l.getRegionId(),uuidList:s},function(e){if(e.errorCode&&9825==e.errorCode)n.showIsolateLb();else if(e.taskId)if(i){var t={permResult:n.permResult,selectedItems:n.selectedItems,listIns:i,gridView:i.grid,cvmListEl:i.listEl,refreshParent:!0};c.checkTask(e,"销毁中",t)}else a&&a(e);else;},function(){n.showCommonError()}),e.hide()},showIsolateLb:function(){s.create(r,"600","",{title:"销毁主机失败","class":"dialog_layer_v2 tc-15-rich-dialog",preventResubmit:!0,button:{"确定":function(e){s.hide()}}})},showCommonError:function(){s.create(p,"600","",{title:"销毁主机失败","class":"dialog_layer_v2 tc-15-rich-dialog",preventResubmit:!0,button:{"确定":function(e){s.hide()}}})},toggleList:function(){var e=o("#listDetail"),t=o("#selectedShowIconArr");e.toggle(),e.is(":visible")?(t.removeClass("icon-arrow-down").addClass("icon-arrow-up"),this.$set("toggleTip","收起列表")):(t.removeClass("icon-arrow-up").addClass("icon-arrow-down"),this.$set("toggleTip","展开列表")),s.center()}});i.exports=u}),define("modules/cvm/cdh/dialog/export",function(e,t,i){e("$");var o=e("util"),d=e("appUtil");i.exports={exportChildList:function(e){for(var t,i=[],a=[],s=0;t=e[s];s++)i.push(t.deviceLanIp),a.push(t.uuid);var n={t:(new Date).getTime(),uin:o.getUin(),csrfCode:o.getACSRFToken(),count:100,offset:0,projectId:d.getProjectId(),regionId:d.getRegionId(),ipList:i,uuidList:a},r=o.objectToParams(n);location.href="/cgi/cvm?action=exportCvm&"+r},exportCdhList:function(){var e=d.getProjectId();e<0&&(e=0);var t={t:(new Date).getTime(),uin:o.getUin(),csrfCode:o.getACSRFToken(),projectId:e,regionId:d.getRegionId()},i=o.objectToParams(t);location.href="/cgi/cdh?action=exportCdh&"+i}}}),define("modules/cvm/cdh/dialog/reboot",function(e,t,i){var r=e("$"),a=e("qccomponent"),s=(e("widget/pills/pills"),e("dialog")),o=e("manager"),d=e("modules/cvm/cdh/taskchecker"),n=a.extend({$tpl:'    <div>        <div class="act-outline" id="selectedShowWrap">            <div class="act-summary">您已选<strong class="cdh-color-org">{{selectedItems.length}}台云主机</strong>                <span b-if="unAbleNum">，其中<strong class="cdh-color-org">{{unAbleNum}}台云主机</strong>将不能</span>                执行重启操作，                <a href="javascript:;" b-on-click="toggleList()">{{toggleTip ? toggleTip : \'收起列表\'}}<i id="selectedShowIconArr" class="icon-arrow-down"></i></a></div>            <div class="act-details" style="display:block" id="listDetail">                <table class="act-details-tb">                    <tbody>                    <tr b-repeat="item in selectedItems">                        <td>{{selectedItems.indexOf(item)+1}}</td>                        <td>                            <span class="entity-name" title="{{item.uInstanceId}}">{{item.uInstanceId}}</span><span class="{{item[\'opsAvailable\'][\'REBOOT\'] ? \'act-result\' : \'act-result cdh-color-org\'}}">{{item[\'opsAvailable\'][\'REBOOT\'] ? \'可重启\' : \'运行中的主机才可重启\'}} </span>                        </td>                    </tr>                    </tbody>                </table>            </div>        </div>        <div class="coin-alert">            <table class="ui-popmsg">                <tbody>                <tr>                    <td height="72" class="t">                                    <span class="info">                                        <span class="tit">确定选中主机进行重启？</span><br>                                            <label>                                                重启期间，主机将无法正常提供服务，请您做好准备，以免造成影响                                            </label>                                            <label class="confirm-it">                                                <input type="checkbox" class="tc-15-checkbox" id="rebootConfirmCheck">重启失败时将<a href="javascript:;" >强制关机再开机</a>                                            </label>                                        </span>                    </td>                </tr>                </tbody>            </table>        </div>    </div>',$beforeInit:function(){var t=[],i=[],a={actionName:"重启",hasPermItems:[],noPermItems:[]};this.selectedItems.forEach(function(e){e.opsAvailable.REBOOT?(t.push(e),a.hasPermItems.push({name:e.alias})):(i.push(e),a.noPermItems.push({name:e.alias,reason:"运行中的主机才可以执行重启操作"}))});var e={hasPermItems:t,noPermItems:i,selectedShowOptions:a};this.permResult=e,this.ableList=t;var s=this.selectedItems.length-t.length;0<s&&this.$set("unAbleNum",s)},$afterInit:function(){},doAction:function(e,i){for(var t,a=[],s=this,n=0;t=s.ableList[n];n++)a.push(t.uuid);a.length&&o.rebootCvm({uuidList:a,hardPowerOffFlag:r("#rebootConfirmCheck").prop("checked")?1:0},function(e){var t={permResult:s.permResult,selectedItems:s.selectedItems,listIns:i,gridView:i.grid,cvmListEl:i.listEl};d.checkTask(e,"重启中",t)}),e.hide()},toggleList:function(){var e=r("#listDetail"),t=r("#selectedShowIconArr");e.toggle(),e.is(":visible")?(t.removeClass("icon-arrow-down").addClass("icon-arrow-up"),this.$set("toggleTip","收起列表")):(t.removeClass("icon-arrow-up").addClass("icon-arrow-down"),this.$set("toggleTip","展开列表")),s.center()}});i.exports=n}),define("modules/cvm/cdh/dialog/rename",function(e,t,i){var a=e("$"),s=e("qccomponent"),n=e("models/cdh"),r=e("dialog"),o=e("appUtil"),d=s.extend({$tpl:'    <div>        <div class="act-outline" id="selectedShowWrap">            <div class="act-summary">下列实例<strong class="cdh-color-org">（共{{selectedItem.length}}台）</strong>将进行改名操作，<a href="javascript:;" b-on-click="toggleList()">{{toggleTip ? toggleTip : \'收起列表\'}}<i id="selectedShowIconArr" class="icon-arrow-down"></i></a></div>            <div class="tc-15-table-panel mt15" style="display:block" id="listDetail">                <div class="tc-15-table-fixed-head">                    <table class="tc-15-table-box">                        <colgroup>                            <col>                            <col>                        </colgroup>                        <thead>                        <tr>                            <th>                                <div><span>ID</span></div>                            </th>                            <th>                                <div><span>宿主机名</span></div>                            </th>                        </tr>                        </thead>                    </table>                </div>                <div class="tc-15-table-fixed-body" style="min-width:inherit;max-height:225px;">                    <table class="tc-15-table-box tc-15-table-rowhover">                        <colgroup>                            <col>                            <col>                        </colgroup>                        <tbody>                        <tr b-repeat="item in selectedItem">                            <td><div>{{item.uHostId}}</div></td>                            <td><div>{{item.hostAlias ? item.hostAlias : \'未命名\'}}</div></td>                        </tr>                        </tbody>                    </table>                </div>            </div>        </div>        <div class="form-wrap">            <ul class="form-list">                <li>                    <div class="form-label"><label>新宿主机名称:</label></div>                    <div class="form-input">                        <div class="tc-15-input-text-wrap m">                            <input maxlength="60" type="text" class="tc-15-input-text" b-model="newName">                            <div class="tc-15-input-tips">你还可以输入{{60-newName.length}}个字符</div>                        </div>                    </div>                </li>            </ul>            \x3c!--             <ul class="edit_psword">            <li>                <label class="txt">新母机名称:</label>                <input class="txt_input" style="width:260px" id="aliasIpt2" data-lenLimit="60" maxlength="60" relTipId="nameTip" type="text"/>                <p class="tip" id="nameTip2"></p>            </li>        </ul>             --\x3e        </div>    </div>',$afterInit:function(){},doAction:function(t,i){var a=this,s=[];if(this.selectedItem.forEach(function(e){a.newName!=e.hostAlias&&s.push(e.uHostId)}),s&&0!=s.length){var e={alias:a.newName,uHostIdList:s,regionId:o.getRegionId()};n.request({name:"updateAlias",data:e,success:function(e){i&&i(a.newName),t.hide()},fail:function(){}})}else t.hide()},toggleList:function(){var e=a("#listDetail"),t=a("#selectedShowIconArr");e.toggle(),e.is(":visible")?(t.removeClass("icon-arrow-down").addClass("icon-arrow-up"),this.$set("toggleTip","收起列表")):(t.removeClass("icon-arrow-up").addClass("icon-arrow-down"),this.$set("toggleTip","展开列表")),r.center()}});i.exports=d}),define("modules/cvm/cdh/dialog/renew",function(e,t,i){var n=e("$"),a=e("qccomponent"),s=(e("widget/pills/pills"),e("models/cdh")),r=e("appUtil"),o=e("dialog"),d=e("constants"),c=e("modules/cvm/cdh/cdhconfig"),l=[{text:"1",full:"1个月",value:"1"},{text:"2",full:"2个月",value:"2"},{text:"3",full:"3个月",value:"3"},{text:"半年",full:"半年",value:"6"},{text:"1年",full:"1年",value:"12",ico:"ico ico_join"},{text:"2年",full:"2年",value:"24",ico:"ico ico_join"},{text:"3年",full:"3年",value:"36",ico:"ico ico_join"}],p=a.extend({$tpl:'    <div>        <div class="act-outline" id="selectedShowWrap">            <div class="act-summary">下列实例<strong class="cdh-color-org">（共{{selectedItem.length}}台）</strong>将进行续费操作，<a href="javascript:;" b-on-click="toggleList()">{{toggleTip ? toggleTip : \'收起列表\'}}<i id="selectedShowIconArr" class="icon-arrow-down"></i></a></div>            <div class="tc-15-table-panel mt15" style="display:block" id="listDetail">                <div class="tc-15-table-fixed-head">                    <table class="tc-15-table-box">                        <colgroup>                            <col>                            <col>                            <col>                        </colgroup>                        <thead>                        <tr>                            <th>                                <div><span>ID/宿主名</span></div>                            </th>                            <th>                                <div><span>到期时间</span></div>                            </th>                            <th>                                <div><span>续费后到期时间</span></div>                            </th>                        </tr>                        </thead>                    </table>                </div>                <div class="tc-15-table-fixed-body" style="min-width:inherit;max-height:225px;">                    <table class="tc-15-table-box tc-15-table-rowhover">                        <colgroup>                            <col>                            <col>                            <col>                        </colgroup>                        <tbody>                        <tr b-repeat="item in selectedItem">                            <td class="text-left">                                <div>                                    <div class="id-name-cell">                                        <p> {{item.uHostId}}</p>                                        <div>                                                  <span class="text-overflow m-width" title="">                                                  {{item.hostAlias ? item.hostAlias : \'未命名\'}}                                                  </span>                                        </div>                                    </div>                                </div>                            </td>                            <td>                                <div>{{item.deadline}}</div>                            </td>                            <td>                                <div class="cdh-color-org">{{newDeadlines ? newDeadlines[selectedItem.indexOf(item)] : \'--\'}}</div>                            </td>                        </tr>                        </tbody>                    </table>                </div>            </div>        </div>        <div class="form-wrap">            <ul class="form-list">                <li>                    <div class="form-label"><label>续费时长</label></div>                    <div class="form-input">                                <span class="item-descr-txt">                                    <ul>                                        <li>                                            <div class="tc-15-rich-radio" role="radiogroup">                                                <button b-repeat="time in timeList" class="{{time.value == curSelected ?                                                       time.value == timeList[0].value ? \'tc-15-btn first checked m\' :                                                       time.value == timeList[timeList.length - 1].value ? \'tc-15-btn last checked m\' :                                                       \'tc-15-btn checked m\'                                                       :                                                       time.value == timeList[0].value ? \'tc-15-btn first m\' :                                                       time.value == timeList[timeList.length - 1].value ? \'tc-15-btn last m\' :                                                       \'tc-15-btn m\'}}" role="radio" b-on-click="setCurrent(time.value)">{{time.value == curSelected ? time.full : time.text}}</button>                                            </div>                                        </li>                                    </ul>                                </span>                    </div>                </li>                <li>                    <div class="form-label"><label>需支付费用</label></div>                    <div class="form-input">                        <div class="cost">  <strong>{{totalPrice > 0 ? totalPrice : \'-\'}}</strong> 元 </div>                        <div class="mt15">                            <input type="checkbox" class="tc-15-checkbox" id="renew_checkbox" checked="true" ><span class="finance-buy-info">账户余额足够时，到期后按月自动续费</span>                        </div>                    </div>                </li>            </ul>        </div>    </div>',$beforeInit:function(){this.$set("timeList",l),this.$set("curSelected",l[0].value)},$afterInit:function(){var e=this;setTimeout(function(){e.queryPrice()},50)},setCurrent:function(e){e!=this.curSelected&&(this.$set("curSelected",e),this.queryPrice())},queryPrice:function(){var i=this;i.changeNewDeadDate();var t=[];i.selectedItem.forEach(function(e){t.push(e.uHostId)});var e={uHostIdList:t,timeSpan:i.curSelected,regionId:r.getRegionId(),projectId:r.getProjectId()};"undefined"!=typeof i.recycleFlag&&(e.recycleFlag=i.recycleFlag),i.$set("totalPrice",0),s.request({name:"getPrice",data:e,success:function(e){if(e&&0<e.length){var t=0;e.forEach(function(e){t+=Number(e.realTotalCost)}),i.$set("totalPrice",Number(t/100))}},fail:function(){}})},changeNewDeadDate:function(){var t=this,i=[];t.selectedItem.forEach(function(e){i.push(t.getNewExpires(Number(t.curSelected),e.deadline))}),t.$set("newDeadlines",i)},getNewExpires:function(e,t){if(!t)return"";t=t.replace(/\-/g,"/");var i=isNaN(new Date(t))?new Date:new Date(t),a=i.getMonth();return i.setMonth(a+e),r.formatDate(i,"yyyy-MM-dd")},setFullTime:function(){l[5].text="6",l[5].full="6个月",this.$set("timeList",l)},doAction:function(e){var i=this,a=n("#renew_checkbox").prop("checked");e.hide();var s=[];i.selectedItem.forEach(function(e){var t=[{name:"项目",value:e.projectName},{name:"地域",value:d.REGIONNAMES[r.getRegionId()]},{name:"可用区",value:e.zoneName},{name:"机型",value:e.externalHostType}];e.cageId&&t.push({name:"所属围笼",value:e.cageId});e.externalHostType,t.push({name:"配置",value:e.cpuTotal+"核cpu、"+e.memTotal+"G内存、"+e.diskTotal+"G本地硬盘"}),t.push({name:"内网IP",value:e.hostIp}),s.push({goodsCategoryId:"100046",regionId:r.getRegionId(),projectId:e.projectId,appId:r.getAppId(),zoneId:e.zoneId,goodsDetail:{autoRenewFlag:a?1:0,pid:e.pid,timeSpan:Number(i.curSelected),timeUnit:"m",resourceId:e.uHostId,curDeadline:e.deadline,productInfo:t},goodsNum:"1",payMode:"1"})}),this.toPay(s)},toPay:function(e){var t=c.NEW_PAY_URL,i={itemDetails:{raw_goodsData:e}};r.submitForm(t,i)},toggleList:function(){var e=n("#listDetail"),t=n("#selectedShowIconArr");e.toggle(),e.is(":visible")?(t.removeClass("icon-arrow-down").addClass("icon-arrow-up"),this.$set("toggleTip","收起列表")):(t.removeClass("icon-arrow-up").addClass("icon-arrow-down"),this.$set("toggleTip","展开列表")),o.center()}});i.exports=p}),define("modules/cvm/cdh/dialog/shutdown",function(e,t,i){var o=e("$"),a=e("qccomponent"),s=(e("widget/pills/pills"),e("dialog")),d=e("manager"),c=e("modules/cvm/cdh/taskchecker"),n=a.extend({$tpl:'    <div>        <div class="act-outline" id="selectedShowWrap">            <div class="act-summary">您已选<strong class="cdh-color-org">{{selectedItems.length}}台云主机</strong>                <span b-if="unAbleNum">，其中<strong class="cdh-color-org">{{unAbleNum}}台云主机</strong>将不能</span>                执行关机操作，                <a href="javascript:;" b-on-click="toggleList()">{{toggleTip ? toggleTip : \'收起列表\'}}<i id="selectedShowIconArr" class="icon-arrow-down"></i></a></div>            <div class="act-details" style="display:block" id="listDetail">                <table class="act-details-tb">                    <tbody>                    <tr b-repeat="item in selectedItems">                        <td>{{selectedItems.indexOf(item)+1}}</td>                        <td>                            <span class="entity-name" title="{{item.uInstanceId}}">{{item.uInstanceId}}</span><span class="{{item[\'opsAvailable\'][\'SHUTDOWN\'] ? \'act-result\' : \'act-result cdh-color-org\'}}">{{item[\'opsAvailable\'][\'SHUTDOWN\'] ? \'可关机\' : \'运行中的主机才可关机\'}} </span>                        </td>                    </tr>                    </tbody>                </table>            </div>        </div>        <div class="coin-alert">            <table class="ui-popmsg">                <tbody>                <tr>                    <td height="72" class="t">                                    <span class="info">                                        <span class="tit">确定选中主机进行关机？</span><br>                                            \x3c!--<label>                                                重启期间，主机将无法正常提供服务，请您做好准备，以免造成影响                                            </label> --\x3e                                            <label class="confirm-it">                                                <input type="checkbox" class="tc-15-checkbox" id="shutdownConfirmCheck">关机失败时进行<a href="javascript:;" >强制关机</a>                                            </label>                                            <div class="tc-15-msg mt15">                                                强制关机的效果等同于关闭物理计算机的电源开关。强制关机可能会导致数据丢失或文件系统损坏，请仅在服务器不能正常关机时使用。                                            </div>                                        </span>                    </td>                </tr>                </tbody>            </table>        </div>    </div>',$beforeInit:function(){var t=[],i=[],a={actionName:"关机",hasPermItems:[],noPermItems:[]};this.selectedItems.forEach(function(e){e.opsAvailable.SHUTDOWN?(t.push(e),a.hasPermItems.push({name:e.alias})):(i.push(e),a.noPermItems.push({name:e.alias,reason:"运行中的主机才可以执行关机操作"}))});var e={hasPermItems:t,noPermItems:i,selectedShowOptions:a};this.permResult=e,this.ableList=t;var s=this.selectedItems.length-t.length;0<s&&this.$set("unAbleNum",s)},$afterInit:function(){},doAction:function(e,i){for(var t,a=this,s=[],n=[],r=0;t=a.ableList[r];r++)s.push(t.deviceLanIp),n.push(t.uuid);n.length&&d.cvmAction({actionType:2,deviceInfo:s,hardPowerOffFlag:o("#shutdownConfirmCheck").prop("checked")?1:0,uuidList:n},function(e){var t={permResult:a.permResult,selectedItems:a.selectedItems,listIns:i,gridView:i.grid,cvmListEl:i.listEl};c.checkTask(e,"关机中",t)}),e.hide()},checkTask:function(e,t){},toggleList:function(){var e=o("#listDetail"),t=o("#selectedShowIconArr");e.toggle(),e.is(":visible")?(t.removeClass("icon-arrow-down").addClass("icon-arrow-up"),this.$set("toggleTip","收起列表")):(t.removeClass("icon-arrow-up").addClass("icon-arrow-down"),this.$set("toggleTip","展开列表")),s.center()}});i.exports=n}),define("modules/cvm/cdh/taskchecker",function(e,t,i){var y=e("$"),w=e("manager"),x=e("tips"),k=(e("util"),e("appUtil"),e("widget/msg/msg")),C=e("widget/operatelog/floattips"),a={checkTask:function(e,t,i){var a=this,s=e.taskId,n=i.listIns,r=i.gridView,o=i.cvmListEl,d=i.refreshParent;s&&C.showTaskProcessTip({msg:t,business_id:1,task_id:s});var c=function(i){n.userIsDoing&&n.userIsDoing()?a.timeOut=setTimeout(function(){c(i)},3e3):w.getFlowCscResult({taskId:i},function(e){var t=e.status;0===t?(n.refresh({sliceRefresh:!0,refreshParent:d}),k.echo()):2===t?a.timeOut=setTimeout(function(){c(i)},3e3):(!y("#getFlowCscResultErrTip").length&&x.error("操作执行失败"),n.refresh({sliceRefresh:!0,refreshParent:d}),k.echo())},null,null)};if(s){var l='<span class="text-overflow restart">'+t+"</span>";o.find("[data-check-all]").prop("checked",!1);for(var p,u=i.permResult,m=u?u.hasPermItems:i.selectedItems,h=u?u.noPermItems:[],v=0;p=m[v];v++){if(I=p.el){var f=I.attr("data-index");r.$refs.list[f].$set({$loading:!0,$selected:!1}),I.find(".status-col").html(l),n.getSelectedItemData(f).statusDesc=l}else y(".status-tips").html(l);if(I)o.find('tr[data-index="'+f+'"]').find(".cvm-oper-cell").find("> a").addClass("disable").attr("data-title","正在执行任务")}for(var g,b=0;g=h[b];b++){var I;f=(I=g.el).attr("data-index");r.$refs.list[f].$set({$selected:!1})}c(s)}}};i.exports=a}),define("modules/cvm/cdh/util",function(e,t,i){e("manager");var a=e("util");i.exports={setDataKey:function(e,t){window.localStorage&&(window.localStorage[[a.getUin(),"cvmCdhJump",e].join("_")]=t)},getDataKey:function(e){return window.localStorage&&window.localStorage[[a.getUin(),"cvmCdhJump",e].join("_")]||""},updateCheckBox:function(t){if(t){var i,a=this,s=[],n={},e=t.getSelected();if(e&&0<e.length&&e.forEach(function(e){var t=e.cageId||"common";n[t]?n[t]=n[t]+1:(n[t]=1,s.push(t))}),s&&0<s.length)s.forEach(function(e){(!i||n[e]>n[i])&&(i=e)}),i&&t&&t.$refs.list.forEach(function(e){e.$loading||"common"==i&&!e.cageId||e.cageId==i||(e.$set({$selected:!1,$disable:!0}),a.updateCheckBoxTitle(t,e.uHostId,"不能围笼内、围笼外跨类选择宿主机"))});else t&&t.$refs.list.forEach(function(e){e.$loading||(e.$set({$disable:!1}),a.updateCheckBoxTitle(t,e.uHostId,""))})}},updateCheckBoxTitle:function(e,t,i){var a=$(e.$el).find('tr[data-uHostId="'+t+'"]').find(".tc-15-first-checkbox");a&&a.attr("title",i)}}}),define("modules/cvm/diskUtil",function(e,s,t){var i=e("constants"),a=e("manager");s.TYPE={Local:1,CBS:2,SSD:3,CBS_SSD:5,CBS_PREMIUM:6},s.TYPE_NAMES=i.DISKTYPE,s.DISK_META_LIST=i.CBS_META_LIST.concat([{type:s.TYPE.Local,priceConfig:{root:"rootDisk",data:"disk"}},{type:s.TYPE.SSD,priceConfig:{root:"rootSsd",data:"ssd"}}]),s.ROOT_ORDER_PROPERTY_MAP={},s.DATA_ORDER_PROPERTY_MAP={},s.DISK_META_LIST.forEach(function(e){s.ROOT_ORDER_PROPERTY_MAP[e.type]=e.priceConfig.root,s.DATA_ORDER_PROPERTY_MAP[e.type]=e.priceConfig.data}),s.parseFromCvm=function(e,t){var i={size:(e=e||{rootSize:0,rootType:s.TYPE.Local,disk:0,diskType:s.TYPE.Local}).rootSize,type:e.rootType,target:"xvda"},a={size:e.disk,type:e.diskType,target:"xvde"};return(t||e.cbsList||[]).forEach(function(e){"root"===e.diskType&&(i.target=e.target,i.size=e.diskSize),"data"!==e.diskType&&e.diskType||e.portable||(a.target=e.target,a.size+=e.diskSize)}),{root:i,data:a}},s.generateOrderParams=function(e){var t={root:e.root};return t.root.target||(t.root.target="xvda"),0<e.data.size&&(t.data=[e.data],t.data.target||(t.data.target="xvde")),t},s.generatePriceParams=function(e,t,i){t=t||0;var a={};return i||s.DISK_META_LIST.forEach(function(e){e.type!==s.TYPE.CBS_SSD&&e.type!==s.TYPE.CBS_PREMIUM&&(a[e.priceConfig.root]=0),a[e.priceConfig.data]=0}),a[s.ROOT_ORDER_PROPERTY_MAP[e.root.type]]=Math.max(0,e.root.size-t),e.data.size&&(a[s.DATA_ORDER_PROPERTY_MAP[e.data.type]]=e.data.size),a},s.FREE_ROOT_SIZE=50,s.FLOW_NO_FREE=!0,s.getFlowPid=function(e,t,i){return i=+i||0,s.getFlowPidConfig(e,t).then(function(e){var t;return e.some(function(e){if(!(i<e.start||i>=e.end))return t=e,!0}),(t=t||e[0]).pid})};var n,r={VSELF_2:10694,VSHIO_2:10700,VSLMEM_2:10697,VSHCAL_2:10703,VSHGPU_2:10992};s.getFlowPidConfig=(n={},function(i,t){var e=[i=+i||1,t].join("_");return n[e]||(n[e]=new Promise(function(e,t){a.getQuotiesChargeItem({regionId:i},e,t,"",!1)}).then(function(e){return e},function(){return n[e]=null})),n[e].then(function(e){return e&&t in e&&e[t][0]&&e[t][0].pid?e[t]:[{start:0,end:"96",pid:i in{9:1,15:1}?10622:r[t]||10578}]})})}),define("modules/cvm/eip/GridView",function(e,t,i){var a=e("qccomponent"),s=e("widget/fieldsManager/gridView"),n={0:{text:"申请中",disTip:"暂不能执行相关操作"},1:{text:"绑定中",disTip:"正在绑定资源中"},2:{text:"已绑定",clsName:"text-success",disTip:"已绑定云资源，请先解绑",payModeDesc:"计费停止"},3:{text:"解绑中",disTip:"正在解绑资源中"},4:{text:"未绑定",clsName:"text-danger",disTip:"未绑定云资源",payModeDesc:"按小时计费"},6:{text:"下线中",disTip:"不能执行该操作"},9:{text:"申请失败",clsName:"text-danger",disTip:"不能执行该操作"},10:{text:"已绑定",clsName:"text-success",disTip:"已绑定云资源，请先解绑",payModeDesc:'按小时计费 <i class="n-error-icon" data-title="弹性网卡未绑定云主机时，网卡上绑定的弹性公网IP按小时计费"></i>'},"-99":{text:"欠费中",clsName:"text-danger",disTip:"已欠费，不能执行该操作",payModeDesc:"按小时计费"}},o={bind:{statusArr:[4],arrearsArr:[0],act:"bindEip",text:"绑定"},unBind:{statusArr:[2],arrearsArr:[0],act:"unbindEip",text:"解绑"},release:{statusArr:[4,9],act:"releaseEip",text:"释放"}},r=a.getComponent("grid-view").extend({$mixins:[s("eip_grid_fields","#appArea [data-grid-setting]")],getStatus:d,getCellContent:function(e,t,i){var a="";switch(i.key){case"eipId":a+="<div>"+t[i.key]+"</div>",a+='<span class="text-overflow m-width"><span>'+(t.eipName||"未命名")+'</span></span><i data-event="editEipName" class="pencil-icon hover-icon"></i>';break;case"status":t._extraTips&&2==t.type&&(t._extraTips=undefined),a=undefined;break;case"jfms":var s=d(t);10!=t.status&&4!=t.status&&2!=t.status||2!=t.type?2==t.status||4==t.status?a+='<span class="'+(s.clsName||"")+'">'+s.payModeDesc+"</span>":a+="<span>小时计费模式</span>":a+='<span class="text-danger">按小时计费 <i class="n-error-icon" data-title="弹性网卡未绑定云主机时，网卡上绑定的弹性公网IP按小时计费"></i></span>';break;case"unInstanceId":case"type":break;case"createdAt":a+="<span>"+t[i.key]+"</span>";break;case"op":a+='<div class="eip-oper-cell">'+function r(e){var t=[];for(var i in o)if(o.hasOwnProperty(i)){var a=o[i],s='class="disabled"',n=d(e);a.statusArr&&!(-1<c(e.status,a.statusArr))||a.arrearsArr&&!(-1<c(e.arrears,a.arrearsArr))||e.ipBlocked||(s=""),4!=e.status&&10!=e.status||2!=e.type||"unbindEip"!=a.act?4!=e.status&&10!=e.status||2!=e.type||"bindEip"!=a.act&&"releaseEip"!=a.act||(s='class="disabled"'):s="",s&&(s+=' data-title="'+((e.ipBlocked?"IP已被安全隔离":n.disTip)||"")+'" '),t.push('<span style="position: relative;"><a data-action="'+a.act+'" '+s+' href="javascript:;">'+a.text+"</a></span>")}return t.join('<i class="black-seperate-line-icon"></i>')}(t)+"</div>";break;default:a+="<span>"+t[i.key]+"</span>"}return a||undefined},setTrAttr:function(e,t){var i=!(e={"data-eipid":t.eipId,"data-eipname":t.eipName||""}),a=t.status;return 0!==a&&1!==a&&3!==a&&6!==a||(i=!0),i&&(e["data-isLoading"]=!0),e},events:{}},{defaults:{TYPES:e("./types").TYPES,colums:[{name:"ID/名称",key:"eipId",widths:250,order:!0,required:!0,defaults:!0},{name:"状态",key:"status",widths:200,order:!1,defaults:!0,hide:!0,tdTpl:'    <span data-title?="item._extraTips" class="{{item.ipBlocked ? \'text-danger\' : getStatus(item).clsName}}">{{getStatus(item).text}}</span>    <i b-if="item.ipBlocked" class="icon-alarm" qc-popover="{{ipBlockedTip}}" qc-popover-style="width:350px;"></i>'},{name:"弹性IP地址",key:"eip",width:150,minWidth:150,widths:300,order:!1,defaults:!0,tdTpl:'    <span class="text-overflow m-width">{{item.eip || \'-\'}}</span>    <i data-clipboard-text="{{item.eip}}" class="copy-icon" style="display:none;"></i>'},{name:"计费模式",key:"jfms",widths:300,order:!1,defaults:!0},{name:"绑定资源",key:"unInstanceId",tdTpl:'    <div b-template b-if="!item.unInstanceId && !item.networkInterfaceId">        <span>-</span>    </div>    <div b-template b-if="item.unInstanceId || item.networkInterfaceId">        <p>            <a href="{{TYPES[item.type].getLink(regionId, item)}}" title="{{TYPES[item.type].getName(item)}}" data-event="nav">{{item.unInstanceId || item.networkInterfaceId}}</a>        </p>        <span b-if="item.insInfo" class="text-overflow">{{TYPES[item.type].getDetailName(item.insInfo)}}</span>    </div>',widths:300,order:!1,defaults:!0},{name:"资源类型",key:"type",tdTpl:"    <span>{{(item.unInstanceId || item.networkInterfaceId) ? TYPES[item.type].name : '-'}}</span>",width:100},{name:"申请时间",key:"createdAt",width:200,order:!0,defaults:!0},{name:"操作",key:"op",width:250,order:!1,defaults:!0}],trAttr:{},ipBlockedTip:'    此IP关联服务器由于有安全风险外网已被隔离，请尽快处理安全风险，解除风险后<a data-event="nav" href="/workorder/create?level1_id=6&level2_id=7&level1_name=计算与网络&level2_name=云服务器%20CVM">提交工单</a>给我们确认执行结果；&#10;具体安全风险：安全隔离',emptyTips:"当前过滤条件下没有相应的记录",searchItemName:"弹性公网IP"}});function d(e){if(1==e.arrears)return n[-99];if(2==e.type&&(4==e.status||10==e.status))return n[2];var t=""+e.status;return n[t]?n[t]:{text:t}}function c(e,t){for(var i=0,a=t.length;i<a;i++)if(e==t[i])return i;return-1}i.exports=r}),define("modules/cvm/eip/bind",function(e,t,i){var a=e("qccomponent"),c=(e("appUtil"),e("dialog")),s=e("widget/selectors/CvmSelector"),n=e("widget/selectors/NatSelector"),r=e("widget/selectors/EniSelector"),l=new(e("widget/baseInfo/validator")),o=e("models/api"),p=(e("manager"),e("tips")),u=e("./types").TYPES,m=e("./common"),h=a.extend({$tpl:'    <div>        <div class="tc-15-option-hd mb10" style="margin-bottom: 10px;">            <h4>请选择"弹性公网IP:{{eip.eip}}"要绑定的实例</h4>            <div class="tc-15-list-det-wrap">                <span class="tc-15-list-det" style="float:none;">                    <span b-repeat="res in resources">                        <label class="tc-15-radio-wrap">                            <input type="radio" class="tc-15-radio" b-model="resType" value="{{res.type}}" />                            {{res.label}}                        </label>                    </span>                </span>            </div>        </div>        <div>            <cvm-selector b-ref="cvm" region-id="{{regionId}}" search-placeholder="请输入名称, ID或IP" b-if="resType == \'cvm\'"></cvm-selector>            <nat-selector b-ref="nat" region-id="{{regionId}}" search-placeholder="请输入名称或ID" b-if="resType == \'nat\'"></nat-selector>            <eni-selector b-ref="eni" region-id="{{regionId}}" search-placeholder="请输入名称或ID" b-if="resType == \'eni\'"></eni-selector>        </div>    </div>',$afterInit:function(){}},{defaults:{resType:"cvm",resources:[{label:"云服务器",type:"cvm"},{label:"NAT网关",type:"nat"},{label:"弹性网卡",type:"eni"}]}});h.tag("cvm-selector",s.extend({$beforeInit:function(){var e=this,t=this.getData,a=[0,2,4,6,8,9,13,14,15,17,19,21,23,25,27,29,31,33,35,37,39,41,43,45];this.getData=function(){return t.apply(e,arguments).then(function(t){return o.request({serviceType:"eip",cmd:"DescribeEip",data:{eips:t.list.map(function(e){return e.deviceWanIp}).filter(function(e){return e})}}).then(function(e){var i=(e=e.data).eipSet||[];return t.list.forEach(function(t,e){t.$index=e,i.some(function(e){return e.eip&&t.deviceWanIp==e.eip})?(t.$disable=!0,t.$disableTips="请先解绑此云服务器上现有的 EIP 再进行绑定"):a.indexOf(t.runflag)<0&&(t.$disable=!0,t.$disableTips="当前处于无法绑定状态")}),t})})}},parseData:function(e){return e.list.forEach(function(e){}),e}},{defaults:$.extend({},s.defaults,{colums:[{name:"主机ID/名称",key:"uInstanceId",tdTpl:'    <p class="text-overflow">{{item.uInstanceId}}</p>    <p class="text-overflow" title="{{item.alias}}">{{item.alias}}</p>'},{name:"当前带宽",key:"bandwidth",width:"100px",tdTpl:"    <p>{{(item.bandwidth || 0) + \"Mbps\"}}</p>    <div b-if=\"item[checkKey]===$checked && !item.bandwidth\" class=\"tc-15-bubble\" b-class=\"{'tc-15-bubble-bottom': 'item.$index', 'tc-15-bubble-top': '!item.$index'}\" style=\"margin:15px 5px;width:395px;left:-50px;\" b-style=\"'top:' + (item.$index ? '-60px': '10px')\">        <div class=\"tc-15-bubble-inner\">            您所绑定的实例外网带宽为0Mbps，将导致无法对外访问，请调整带宽        </div>    </div>"},{name:"内网IP",key:"deviceLanIp"},{name:"已绑定公网IP",key:"deviceWanIp"}]})})),h.tag("nat-selector",n.extend({parseData:function(e){return e.list.forEach(function(e){e.eips="<p>"+e.eipSet.join("</p></p>")+"</p>"}),e}},{defaults:$.extend({},n.defaults,{colums:[{name:"NAT网关ID/名称",key:"natId",tdTpl:'    <p class="text-overflow">{{item.natId}}</p>    <p class="text-overflow" title="{{item.natName}}">{{item.natName}}</p>'},{name:"已绑定弹性IP",key:"eips"}]})})),h.tag("eni-selector",r.extend({parseData:function(e){var a=[];return e.list.forEach(function(i){i.privateIpAddressesSet.forEach(function(e){var t=$.extend({},i,e);t._key=i.networkInterfaceId+"-"+e.privateIpAddress,a.push(t),t.eipId&&(t.$disable=!0,t.$disableTips="请先解绑此弹性网卡上现有的 EIP 再进行绑定")})}),e.list=a,e}},{defaults:$.extend({},r.defaults,{checkKey:"_key",colums:[{name:"弹性网卡ID/名称",key:"networkInterfaceId",tdTpl:'    <p class="text-overflow">{{item.networkInterfaceId}}</p>    <p class="text-overflow" title="{{item.eniName}}">{{item.eniName}}</p>'},{name:"内网IP",key:"privateIpAddress"},{name:"已绑定公网IP",key:"wanIp"}]})})),t.render=function(o,e){var d=new h({$data:{eip:o,regionId:e}});return new Promise(function(r,e){c.create(d.$el,720,"",{preventResubmit:!0,title:"绑定资源",defaultCancelCb:function(){d.$destroy(),e()},button:{"确定":function(e){var a,s,t,i=d.$refs[d.resType],n=i.currentItem;if(!n)return l.btn=e,l.showTips($(i.$el).find(".tc-15-table-panel")[0],"请选择一个资源"),void c.toggleBtnDisable(!1);switch(d.resType){case"cvm":t=u[0],s=n.deviceWanIp?[n.deviceWanIp]:[];break;case"nat":t=u[1];break;case"eni":t=u[2]}a="请确认弹性公网IP："+o.eip+" 的绑定操作。",new Promise(function(i,e){s&&s.length?t.getIpList(s).then(function(t){var e=s.filter(function(e){return-1==t.indexOf(e)});e.length&&(a+="<br>绑定后，原来的公网IP："+e.join("，")+' 将被释放回腾讯云，<span style="color: red;">无法找回！</span>'),i()},i):i()}).then(function(){m.getConfirm({title:"绑定弹性公网IP",content:a},function(){t.bind(d.regionId,o,n).progress(function(){c.hide(),p.success("绑定中...")}).then(r,r)})})}}})})}}),define("modules/cvm/eip/cacher",function(e,t,i){var a=e("widget/cacher/Cacher"),s=e("manager"),n=e("constants"),r={getEipLimit:function(e,t,i){s.delegateCApi(e,"vpc","DescribeVpcLimit",{type:[n.VPC_LIMIT.IP_PER_NAT_LIMIT_TYPE]},function(e){t(e.data.limit[n.VPC_LIMIT.IP_PER_NAT_LIMIT_TYPE])},i)},getIgwMap:function(e,i,t){s.delegateCApi(e,"vpc","DescribeNatGateway",{offset:0,limit:999},function(e){var t={};(e.data||[]).forEach(function(e){t[e.natId]=e}),i(t)},t)}};i.exports=new a([[r,"getEipLimit"],{host:r,fnName:"getIgwMap",lifetime:3e5}])}),define("modules/cvm/eip/common",function(e,t,i){var s,n=e("$"),r=(e("pageManager"),e("manager")),o=(e("util"),e("appUtil")),d=(e("router"),e("search"),e("panel"),e("pagination"),e("tips")),c=e("dialog"),a=(e("event"),e("widget/validator/validatorV2"),e("lengthlimiter"),e("reporter"),e("qccomponent"),e("models/eip")),l=e("./data"),p={bindEip:function(e){var t=n.Deferred();return a.request({name:"bindEip",data:e,success:function(e){0==e.code?t.resolve(e.data):t.reject(e.message)},fail:function(e){t.reject("操作失败，请重试！")}}),t},unBindEip:function(e){var t=n.Deferred();return a.request({name:"unBindEip",data:e,success:function(e){0==e.code?t.resolve(e.data):t.reject(e.message)},fail:function(e){t.reject("操作失败，请重试！")}}),t},releaseEip:function(e){var t=n.Deferred();return a.request({name:"deleteEip",data:e,success:function(e){0==e.code?t.resolve(e.data):t.reject(e.message)},fail:function(e){t.reject("操作失败，请重试！")}}),t},createEip:function(e){var t=n.Deferred();return a.request({name:"createEip",data:e,success:function(e){0==e.code?t.resolve(e.data):t.reject(e.message)},fail:function(e){t.reject("操作失败，请重试！")}}),t},wipToEip:function(e){var t=n.Deferred();return a.request({name:"wipToEip",data:e,success:function(e){0==e.code?t.resolve(e.data):t.reject(e.message)},fail:function(e){t.reject("操作失败，请重试！")}}),t},getCvmList:function(e){var t=n.Deferred();return a.request({name:"queryCvmList",data:e,success:function(e){t.resolve(e)},fail:function(e){t.reject("操作失败，请重试！")}}),t},getRegionList:function(){var i=n.Deferred();return s?setTimeout(function(){i.resolve(s)},0):r.queryRegion(function(e){var t=o.getRegionOrderHackObj(e),a=[];n.each(t,function(e,t){var i=e.replace("_","");a.push({regionId:i,regionName:t,regionPrice:l.regionPrice[i]||{}})}),s=a,i.resolve(s)},function(){}),i},getEipList:function(e){e=e||{};var t=n.Deferred();return a.request({name:"queryEipList",data:e,success:function(e){0==e.code?t.resolve(e):t.reject()},fail:function(e){t.reject("操作失败，请重试！")}}),t},getEipQuota:function(e,t){e=e||{};var i=n.Deferred();return a.request(n.extend({name:"queryEipQuota",data:e,success:function(e){0==e.code?i.resolve(e.data):i.reject()},fail:function(e){i.reject("操作失败，请重试！")}},t)),i},getConfirm:function(e,t){var i=(e=e||{}).content||"确认执行该操作吗？",a=e.title||"操作确认";c.create('<i class="ico ico-warn"></i><div style="width: 350px; margin-left: 10px; vertical-align: middle; display: inline-block;">'+i+"</div>",480,"",{title:a,preventResubmit:!0,button:{"确定":function(){t&&t()}}});c.center()},getEipFlowCscResult:function(e,t,i){e=e||{},a.request({name:"getEipFlowCscResult",data:e,success:t,fail:i})},refreshList:function(){this.listIns&&this.listIns.refresh()},checkTask:function(e,t,a){var s=this,i=e.taskId,n=function(i){r.getFlowCscResult({taskId:i},function(e){var t=e.status;0===t?s.refreshList():2===t?s.timeOut=setTimeout(function(){n(i)},3e3):(d.error("操作执行失败！"),s.refreshList())},null,a)};i&&n(i),setTimeout(function(){s.refreshList()},50)},clearCheckTask:function(){clearTimeout(this.timeOut)}};i.exports=p}),define("modules/cvm/eip/data",function(e,t,i){var a={regionPrice:e("constants").EIP_REGION_PRICE};i.exports=a}),define("modules/cvm/eip/eip_back",function(r,e,t){var a,d=r("$"),i=r("pageManager"),o=r("manager"),c=r("util"),l=r("appUtil"),s=(r("router"),r("projectsSelector"),r("widget/region/region2")),p=(r("search"),r("panel"),r("pagination"),r("tips")),u=r("dialog"),n=r("event"),m=r("widget/validator/validatorV2"),h=(r("lengthlimiter"),r("reporter"),r("widget/copy/copy")),v=r("qccomponent"),f=r("models/eip"),g=r("./common"),b=r("./GridView"),I=r("./data"),y=r("widget/popover/popConfirm"),w=r("./types"),x=r("./bind"),k=r("./cacher"),C=(r("models/api"),r("models/iaas")),T={main:'<div>    <style>        .eip-oper-cell a.disabled, .eip-oper-cell a.disabled:hover{color: #999; cursor: default;}        .eip-oper-cell a.disabled:hover{text-decoration: none;}    </style>    <div class="manage-area-title">        <h2>弹性公网IP</h2>        <div class="tc-select-box" id="regionWrapper"></div>        <div class="manage-area-title-right"><a href="http://'+QCMAIN_HOST+'/doc/product/213/%E5%BC%B9%E6%80%A7%E5%85%AC%E7%BD%91IP%EF%BC%88EIP%EF%BC%89" target="_blank"><b class="links-icon"></b>弹性公网IP帮助文档</a></div>    </div>    <p class="tc-15-msg elastic-network-msg" style="margin-bottom: 15px;">        弹性公网 IP（Elastic IP）是专为动态云计算设计的静态 IP 地址，在 腾讯云 系统中 EIP 地址与您的账户而非特定的资源（CVM实例）关联。<br>        弹性公网IP 地址同时适用于 基础网络 和 私有网络 的 CVM 实例，随时可以解绑、再分配到其他 CVM 实例，从而快速切换屏蔽实例故障。<br>    </p>    <div class="tc-15-action-panel">        <button data-event="createEip" class="tc-15-btn m mr10">+申请</button>        <button class="tc-15-btn weak m download" data-event="exportEip" title="下载"></button>        <button class="tc-15-btn weak m setting" data-grid-setting title="设置列表显示字段"></button>        <qc-search placeholder="请输入EIP名称或ID" multiple="true" b-with="{search: search}"></qc-search>    </div>    <div class="elastic-network-wrap" id="eipList"></div></div>',editEipName:'<div>    <input name="eipName" type="text" class="input-txt" b-model="eipName" maxlength="{{maxLength}}">    <p class="ash" style="white-space: normal">还能输入{{maxLength - eipName.length}}个字符，英文、汉字、数字、连接线"-"或下划线"_"</p></div>',createEip:'<div class="coin-alert" data-bee-root>    <ul class="form-list">        <li>            <div class="form-label">                <label for="">选择地域</label>            </div>            <div class="form-input">                <div class="tc-15-rich-radio cont-regionlist" role="radiogroup">                <% for(var i=0,len=regionList.length,item; item=regionList[i]; i++){ %>                    <button class="tc-15-btn m <%if(i==0){%>first<%}%> <%if(i>0 && i==len-1){%>last<%}%> <%if(item.regionId == curRegionId){%>checked<%}%>" style="width: 140px; padding: 0px 5px;" role="radio" data-rid="<%=item.regionId%>" data-price="<%=item.regionPrice.price%>" aria-checked="true"><%=item.regionName%></button>                <% } %>                </div>                <div class="form-unit is-success">                    <p class="form-input-help">弹性公网IP只支持该地域的腾讯云资源</p>                </div>            </div>        </li>        <li>            <div class="form-label required">                <label for="">数量</label>            </div>            <div class="form-input cont-numselect">                <div class="form-unit is-success">                    <span class="tc-15-input-num m">                        <span class="minus" tabindex="0" role="button">-</span>                        <input tyep="text" class="num" value="0" id="selectEipNum">                        <span class="plus" tabindex="0" role="button">+</span>个                    </span>                    <p class="form-input-help field-quota-desc">最多可开通<%=quotaData.eipNumQuota%>个弹性公网IP，已开通<%=quotaData.currentEipNum%>个</p>                </div>            </div>        </li>        <li style="">            <div class="form-label required">                <label for="">费用</label>            </div>            <div class="form-input">                <div class="form-unit is-success">                    <span class="cost">                        <money value="{{price}}"></money>/小时</span>                    <p class="form-input-help">空置时收费，绑定资源后不收费</p>                </div>            </div>        </li>    </ul></div>',bindCvm:'<ul class="form-list">    <li>        <div class="form-label required">            <label for="">资源类型</label>        </div>        <div class="form-input">            <div class="tc-15-dropdown tc-15-dropdown-btn-style" style=""> \x3c!--tc-15-menu-active--\x3e                <a href="javascript:;" class="tc-15-dropdown-link btn-pop-trigger" style="width: 150px;" data-insid=""><span>请选择</span><i class="caret"></i></a>                <div class="dropdown-list-wrap">                    <div class="search-box search-box-simple m">                        <div class="search-input-wrap">                            <textarea class="tc-15-input-text search-input" placeholder="输入名称搜索"></textarea>                        </div>                        <input class="search-btn btn-act-search" type="button" value="搜索">                    </div>                    <ul class="tc-15-dropdown-menu cont-ins-list" role="menu" style="display: block;">                    </ul>                </div>            </div>        </div>    </li>    <li>        <div class="form-label required">            <label for="">资源</label>        </div>        <div class="form-input">            <div class="tc-15-dropdown tc-15-dropdown-btn-style" style=""> \x3c!--tc-15-menu-active--\x3e                <a href="javascript:;" class="tc-15-dropdown-link btn-pop-trigger" style="width: 150px;" data-insid=""><span>请选择</span><i class="caret"></i></a>                <div class="dropdown-list-wrap">                    <div class="search-box search-box-simple m">                        <div class="search-input-wrap">                            <textarea class="tc-15-input-text search-input" placeholder="输入名称搜索"></textarea>                        </div>                        <input class="search-btn btn-act-search" type="button" value="搜索">                    </div>                    <ul class="tc-15-dropdown-menu cont-ins-list" role="menu" style="display: block;">                    </ul>                </div>            </div>        </div>    </li>    <li>        <div class="form-label required">            <label for="">所在网络</label>        </div>        <div class="form-input">            <p class="field-netname">--</p>        </div>    </li>    <li>        <div class="form-label required">            <label for="">当前IP</label>        </div>        <div class="form-input">            <p class="field-wanip">--</p>        </div>    </li>        <li>        <div class="form-label required">            <label for="">新IP</label>        </div>        <div class="form-input">            <p>{{item.eip}}<span class="text-label" style="margin-left: 15px;">(弹性IP)</span></p>        </div>    </li></ul>',unBindEip:'<div class="unwrap-ip">    <p class="tc-15-msg">        <strong>确定将该弹性公网IP与绑定的            {{TYPE.getName(item)}}            <span b-template b-if="item.insInfo">({{TYPE.getDetailName(item.insInfo)}})</span>            解绑？        </strong>        <br>解绑后，可能会影响您的业务，请提前做好准备。    </p>    <ul class="form-list">        <li>            <div class="form-label required">                <label for="">费用</label>            </div>            <div class="form-input">                <span class="price">                    <money value="{{regionPrice.price}}"></money>                    <em class="">/小时</em>                    <em class="tit">解绑后，空置EIP将开始收费</em>                </span>            </div>        </li>    </ul>    <label b-if="TYPE.unbindAutoAlloc" class="form-ctrl-label-stacked"><input type="checkbox" id="allocWanIp" class="tc-15-checkbox" b-model="autoAlloc">解绑后免费分配公网IP（注意，该公网IP随机分配，且无法解绑）</label></div>',deleteEip:'<div class="tc-15-confirm-popout tc-15-confirm-popout-top align-end"  style="position:absolute; top:30px; left:-300px;">    \x3c!--请js修改定位坐标--\x3e    <div class="tc-15-confirm-popout-bd">        <p class="tc-15-msg"><strong><%- content %></strong>            <br>        </p>    </div>    <div class="tc-15-confirm-popout-ft">        <button data-confirm class="tc-15-btn m">释放</button>        <button data-cancel class="tc-15-btn m weak">取消</button>    </div></div>'},D=new m({rules:{eipName:function(e){return!/^[\w\-.\u4e00-\u9fa5]{1,20}$/.test(e)&&"请输入符合规则的名称"}}}),P={title:"弹性公网IP-控制台",pageClass:"netword-ip",render:function(n){entry=this,o.getAllWhiteList(function(e){var t=e.CVM_ApiToMc&&e.CVM_ApiToMc.length,i=e.PrepaidForCVM&&e.PrepaidForCVM.length,a=(e.CVM_bandwidtd&&e.CVM_bandwidtd.length,e.network_shift_up&&e.network_shift_up.length),s=e.directconnection&&e.directconnection.length;t&&i?r.async("cvm/eip2/eip",function(e){entry=e,entry.isNetworkShiftUpUser=!!a,entry.isDirectConnectionUser=!!s,entry._render.call(entry,n)}):entry._render.apply(entry,n)})},_render:function(e){var t=this;this.queryStr=e||{},this.lastParams={page:1,count:20},this.$appArea=i.appArea,this.$appArea.html(T.main),this.bee=v.mount(this.$appArea[0],{search:function(e){t.renderList({searchKey:e,orderBy:"",orderType:0,page:1})}}),this.regionWrapperEl=d("#regionWrapper"),this.$listEl=this.$appArea.find("#eipList"),this.renderCommHead(),this.initGridView(),this.bindEvents(),setTimeout(function(){t._needOpenCreate&&(t._needOpenCreate=!1,t.createEip())},100),this.renderList(),(g.listIns=this).setmaxReqNum()},renderCommHead:function(){var e=this,t=this.queryStr;this.regionSelector=new s({renderTo:e.regionWrapperEl,selectedId:e.getRegionId(t),change:function(){e.renderList()}})},renderList:function(e,t){var s=this,n=s.getRegionId();e=e||{};var r=d.extend({},this.lastParams,{regionId:n},e);this.lastParams=r,f.request({name:"queryEipList",data:r,success:function(e){if(0==e.code&&e.data){var t=e.data,i=t.eipSet;i.forEach(function(e){e.networkInterfaceId&&!e.unInstanceId&&(e.type=2,e._extraTips="弹性公网IP绑定的弹性网卡未关联云主机")}),s.logicData(t),s.gridView.setData({regionId:n,list:i,totalNum:e.totalCount,page:r.page,count:r.count,orderField:r.orderBy,order:r.orderType,searchKey:"undefined"==typeof r.searchKey?"":r.searchKey}),new h({handle:d(s.gridView.$el).find("[data-clipboard-text]"),container:d(s.gridView.$el).find("[data-clipboard-text]").closest("td")}),s.checkEipTask(),k.getIgwMap(n).done(function(a){i.forEach(function(e,t){if(e.type===w.TYPE.IGW){var i=a[e.unInstanceId];i&&s.gridView.list.$set(t,{insInfo:i})}})});var a=i.map(function(e){return e.eip}).filter(function(e){return e});a.length&&(o.delegateCApi(n,"eip","CheckDdos",{viplist:a},function(e){var a=e.data;i.forEach(function(e,t){var i=a[e.eip];i&&s.gridView.list.$set(t,{ipBlocked:i})})}),C.apiRequest({serviceType:"eip",regionId:n,action:"CheckDdos",data:{viplist:a}},{global:!1,tipErr:!1}))}},fail:function(e){},global:t})},logicData:function(e){var i=this.getRegionId();d.each(e.eipSet,function(e,t){t.regionId=i})},createEip:function(n){var r=this;void 0===n&&(n=r.getRegionId()),g.getRegionList().then(function(s){g.getEipQuota({regionId:n}).then(function(i){var e=I.regionPrice[n]||{},t=c.tmpl(T.createEip,{curRegionId:n,regionList:s,quotaData:i,regionPrice:e}),a=u.create(t,580,"",{title:"申请弹性公网IP",button:{"确定":function(){var t=a.find(".cont-regionlist .checked[data-rid]").attr("data-rid"),e=a.find("#selectEipNum").val()||0;(e=isNaN(e)?0:parseInt(e,10))<=0?i.eipNumQuota<=i.currentEipNum?p.error("该地域开通数量已达上限，如需更多，请提交工单申请"):p.error("数量不能为0"):g.createEip({regionId:t,goodsNum:e}).done(function(e){u.hide(),p.success("申请中"),l.setRegionId(t),r.regionSelector.val(t),g.checkTask({taskId:e.requestId},"申请中")}).fail(function(e){})}}});r.bee=v.mount(a.find("[data-bee-root]")[0],{price:e&&e.price}),u.center(),r.initCreatePopEvent(a,i)})})},initCreatePopEvent:function(i,e){var a=this;i.find(".cont-regionlist").on("click","button[data-rid]",function(e){var t=d(this);t.addClass("checked").siblings().removeClass("checked"),g.getEipQuota({regionId:t.attr("data-rid")}).then(function(e){var t="最多可开通"+e.eipNumQuota+"个弹性公网IP，已开通"+e.currentEipNum+"个";i.find(".field-quota-desc").html(t),n(1),s()})});var t=e.eipNumQuota-e.currentEipNum;function s(){var e=i.find("#selectEipNum").val()||0;e=parseInt(e,10);var t=i.find(".cont-regionlist").find("button[data-rid].checked").attr("data-price");t=parseFloat(t,10),i.find(".field-regionprice").text((e*t).toFixed(2)),a.bee.$set("price",(e*t).toFixed(2))}function n(e){e=e||0,isNaN(e)&&(e=0),(e=parseInt(e,10))<0&&(e=0),t<e&&(e=t),i.find("#selectEipNum").val(e),s(),0==e?i.find(".cont-numselect .minus").addClass("disabled"):i.find(".cont-numselect .minus").removeClass("disabled"),e==t?i.find(".cont-numselect .plus").addClass("disabled"):i.find(".cont-numselect .plus").removeClass("disabled")}n(1),i.find("#selectEipNum").keyup(function(){n(d(this).val())}),i.find(".cont-numselect .minus").click(function(){var e=i.find("#selectEipNum").val();e=e||0,isNaN(e)&&(e=0),n((e=parseInt(e,10))-1)}),i.find(".cont-numselect .plus").click(function(){var e=i.find("#selectEipNum").val();e=e||0,isNaN(e)&&(e=0),n((e=parseInt(e,10))+1)})},bindEip:function(e){var t=this;x.render(e,t.getRegionId()).then(function(){t.refresh()})},initPopBindEip:function(e,a){var s=this,n=a.$refs.resourceList;n.$on("search",function(){d=-(o=1),t(!0)}),n.$on("reachBottom",function i(){if(-1<d&&d<=o)return;o++,t()});var r=[],o=1,d=-1,c=10;function t(t){!function i(e,t){a.TYPE.getList(s.getRegionId(),n.keyword,e,c).done(t)}(o,function(e){-1==d&&(d=Math.ceil(e.totalNum/c)),function i(e,t){t&&(r=[]);r=r.concat(e.list),n.$set("list",r)}(e,t)})}a.$watch("[TYPE, regionId]",function(){a.TYPE&&a.regionId&&(n.$set("list",[]),t(!0))},!0)},unbindEip:function(e){var t=this,i=I.regionPrice[e.regionId]||{},a=new v({$tpl:T.unBindEip,$data:{item:e,allocFlag:0,regionPrice:i,TYPE:w.TYPES[e.type]}});u.create(a.$el,520,"",{title:"解绑弹性公网IP",button:{"确定":function(){g.getConfirm({title:"解绑弹性公网IP",content:"请确认弹性公网IP："+e.eip+' 的解绑操作。<br>为保证资源有效利用，弹性公网IP空置状态将开始计费。<a href="http://'+QCMAIN_HOST+'/doc/product/213/%E5%BC%B9%E6%80%A7%E5%85%AC%E7%BD%91IP%EF%BC%88EIP%EF%BC%89#6.-弹性公网ip的计费"target="_blank">费用情况说明</a>。</strong><br>解绑后，您的服务可能会受影响，请提前做好准备！'},function(){a.TYPE.unbind(t.getRegionId(),e,{autoAlloc:a.autoAlloc}).progress(function(){u.hide(),p.success("解绑中...")}).done(function(){t.refresh()}).fail(function(e){var t=e&&"string"==typeof e?e:e&&e.data&&e.data.message;t=t||"解绑弹性公网IP失败",p.error(t)})})}}}).find(".dialog_layer_main").addClass("netword-ip"),u.center()},releaseEip:function(e,t,i,a){var s,n=this;i.offset().top+210>a.offset().top+a.height()&&(s=-175);y({content:"<span>确定释放该弹性公网IP？</span>",el:t.get(0),confirm:function(){g.releaseEip({regionId:n.getRegionId(),eipIds:[e.eipId]}).done(function(e){u.hide(),p.success("释放中..."),g.checkTask({taskId:e.requestId},"释放中")}).fail(function(e){})}},{style:{width:360,top:s},tpl:T.deleteEip,position:"buttom",auto:!1});-175==s&&i.find(".tc-15-confirm-popout").removeClass("tc-15-confirm-popout-top").addClass("tc-15-confirm-popout-bottom")},initGridView:function(){var r=this,e={events:{"click tr:not(.disable) [data-action]":function(e){var t=d(e.target),i=t.closest("tr"),a=d(this.$el).find("[data-grid-body]");if(!t.hasClass("disabled")){var s=this.list[i[0].$index],n=t.attr("data-action");if(r[n])r[n].call(r,s,t,i,a);else alert("action not exists")}}},$data:{hasFirst:!1,initGetData:!1,canResizeColum:!0,selectedHighlight:!1,list:[],canSelectTotal:!1,autoMaxHeight:!0,maxHeightOffset:10,autoCheckWidth:!1,showState:!0,showPagination:!0,totalNum:0,trackKey:"id"},getData:function(e,t){r.renderList({orderBy:e.orderField,orderType:e.order,page:e.page,count:e.count})},backList:function(){r.renderList({searchKey:""})}};this.gridView=new b(e),this.$listEl.append(this.gridView.$el)},refresh:function(){this.renderList()},checkEipTask:function(e){var i=this,t=this.$listEl.find("tr");this.isWating=!1,t.each(function(e,t){if(d(t).attr("data-isLoading"))return!(i.isWating=!0)}),this.clearCheckTask(),e||this.isWating?this.watingTime=setTimeout(function(){i.userIsDoing()?i.checkEipTask():a&&(i.refresh(),a--)},e?200:5e3):this.setmaxReqNum()},clearCheckTask:function(){clearTimeout(this.watingTime)},setmaxReqNum:function(){a=200},userIsDoing:function(){return!1},reset:function(){this.queryStr={}},bindEvents:function(){var o=this;n.bindCommonEvent(this.$appArea.children()[0],"click",{createEip:function(){o.createEip()},exportEip:function(){var e=d.extend(o.lastParams,{t:Date.now(),uin:c.getUin(),csrfCode:c.getACSRFToken(),regionId:l.getRegionId()});window.open("/cgi/eip?action=exportEipList&"+d.param(e))},editEipName:function(e){var t,i=d(e.target).closest("tr"),a=i.attr("data-eipid"),s=i.attr("data-eipname")||"",n=d(o.gridView.$el).find("[data-grid-body]"),r=new v(T.editEipName,{$data:{eipName:s,maxLength:20}});i.offset().top+140>n.offset().top+n.height()&&(t=-140),y({content:r.$el,el:d(e.target).prev("span")[0],confirm:function(){if(!D.validate(this.$el.find("input")[0]))return!1;f.request({name:"updateEip",data:{regionId:o.getRegionId(),eipId:a,eipName:r.eipName},success:function(e){0==e.code?(p.success("更新成功"),o.renderList()):p.error(e.message)}})}},{position:"none",style:{width:300,top:t}}),d(r.$el).find("input")[0].select()}})},getRegionId:function(e){return(e=e||{}).rid!==undefined?e.rid:l.getRegionId()},destroy:function(){entry._destroy.apply(entry)},_destroy:function(){g.clearCheckTask(),this.clearCheckTask(),this.setmaxReqNum()}};t.exports=P}),define("modules/cvm/eip/types",function(e,t,i){e("./cacher");var a=e("models/api"),s={isVisible:function(e,t){return!0},getName:function(e){return this.name+": "+(e.unInstanceId||e.networkInterfaceId)},getLink:$.noop,getDetailName:$.noop,getIpList:function(e){return e=e||[],a.request({serviceType:"eip",cmd:"DescribeEip",data:{eips:e}}).then(function(e){return(e=e.data).eipSet})},getVpcName:$.noop,bind:$.noop,unbind:$.noop,getList:$.noop},n=e("./common"),r=e("manager"),o=e("constants"),d={CVM:0,IGW:1,ENI:2},c=[{type:d.CVM,name:"云服务器",unbindAutoAlloc:!0,replaceOldIp:!0,getLink:function(e,t){return"/cvm/detail/"+e+"/"+t.unInstanceId},getDetailName:function(e){return e&&(e.alias||"未命名")},getVpcName:function(e){return e.netName},bind:function(t,e,i,a){var s=$.Deferred();return n.bindEip({regionId:t,eipId:e.eipId,unInstanceId:i.uInstanceId}).then(function(e){s.notify("task inited"),r.checkTask({taskId:e.requestId,regionId:t}).then(s.resolve,s.reject)},s.reject),s},unbind:function(t,e,i){var a=$.Deferred();return n.unBindEip({regionId:t,eipId:e.eipId,unInstanceId:e.unInstanceId,allocWanIp:i.autoAlloc?1:0}).then(function(e){a.notify("task inited"),r.checkTask({taskId:e.requestId,regionId:t}).then(a.resolve,a.reject)},a.reject),a}},{type:d.IGW,name:"NAT网关",isVisible:function(e,t){return 0<=o.NAT_GW_REGION.indexOf(""+e)&&t&&t.VPC_NAT_GW},getLink:function(e,t){return"/vpc/nat?rid="+e+"&detailId="+t.unInstanceId},getDetailName:function(e){return e&&(e.natName||"未命名")},getVpcName:function(e){return e.vpcName},bind:function(t,e,i,a){var s=$.Deferred();return r.delegateCApi(t,"vpc","EipBindNatGateway",{natId:i.natId,vpcId:i.vpcId,assignedEipSet:[e.eip],autoAllocEipNum:0},function(e){s.notify("task inited"),r.checkTask({taskId:e.taskId||e.data&&e.data.taskId,regionId:t}).then(s.resolve,s.reject)},s.reject),s},unbind:function(i,a,e){var s=$.Deferred();return r.delegateCApi(i,"vpc","DescribeNatGateway",{natId:a.unInstanceId,offset:0,limit:1},function(e){var t=e.data&&e.data[0];t?r.delegateCApi(i,"vpc","EipUnBindNatGateway",{natId:a.unInstanceId,vpcId:t.vpcId,assignedEipSet:[a.eip]},function(e){s.notify("task inited"),r.checkTask({taskId:e.taskId||e.data&&e.data.taskId,regionId:i}).then(s.resolve,s.reject)},s.reject):s.reject("找不到关联的NAT网关")},s.reject),s}},{type:d.ENI,name:"弹性网卡",getLink:function(e,t){return"/vpc/eni/detail?rid="+e+"&id="+t.networkInterfaceId+"&tab=1"},getDetailName:function(e){return""},bind:function(t,e,i){var a=$.Deferred();return n.bindEip({regionId:t,eipId:e.eipId,networkInterfaceId:i.networkInterfaceId,privateIpAddress:i.privateIpAddress}).then(function(e){a.notify("task inited"),r.checkTask({taskId:e.requestId,regionId:t}).then(a.resolve,a.reject)},a.reject),a},unbind:function(t,e){var i=$.Deferred();return a.request({cmd:"EipUnBindInstance",serviceType:"eip",data:{eipId:e.eipId,networkInterfaceId:e.networkInterfaceId,privateIpAddress:e.privateIpAddress}}).then(function(e){i.notify("task inited"),e=e.data||{},r.checkTask({taskId:e.requestId,regionId:t}).then(i.resolve,i.reject)}),i}}],l={};c=c.map(function(e){return l[e.type]=$.extend({},s,e)}),i.exports={TYPE:d,TYPES:l,TYPE_LIST:c,NOP_TYPE:s}}),define("modules/cvm/firewall/firewall",function(e,t,i){var a=e("router");t.render=function(){a.navigate("/cvm/securitygroup",!1,!0)}}),define("modules/cvm/image/cacher",function(e,t,i){var a=e("widget/cacher/Cacher"),s=e("./hub");i.exports=new a([{host:s,fnName:"shareImage",isModify:!0,ns:"image-share.$0.$1.$2"},{host:s,fnName:"cancelShareImage",isModify:!0,ns:"image-share.$0.$1.$2"},{host:s,fnName:"getImageShare",ns:"image-share.$0.$1.ALL"}])}),define("modules/cvm/image/copy",function(e,t,i){var c=e("$"),p=(e("pageManager"),e("manager")),u=e("util"),m=e("appUtil"),h=(e("event"),e("dialog")),l=e("tips"),v=e("reporter"),a=e("qccomponent"),f=(e("models/api"),e("constants")),g=f.NOTSUPPORT_IMAGECOPY_REGION,b=f.SUPPORT_REGIONAL_IMAGECOPY,I=e("models/iaas"),s=function(e){this.options=e;var n=this,r=e.imgIds,a=e.imgMap,o=e.listObj.getRegionId(),d=!1;-1<g.indexOf(o+"")?this.showNotSupport(o):(-1<b.indexOf(o+"")&&(d=!0),p.queryRegion(function(e){var t=[];for(var i in e)i!=o&&g.indexOf(i+"")<0&&(d?-1<b.indexOf(i+"")&&t.push(i):t.push(i));if(t.length){var s=0;r.forEach(function(e){var t=a[e];"xvda"==t.target&&(s+=parseInt(t.size,10))});new Date;I.apiRequest({serviceType:"image",cmd:"GetImageOpLog",data:{offset:0,len:999}}).then(function(e){e=e.data;var t=[];(e.result||[]).forEach(function(e){t.indexOf(e.taskId)<0&&t.push(e.taskId)});var i=e.maxSync-t.length;if(i<0&&(i=0),0==i)return l.error("每日每地域操作次数限制为"+e.maxSync+"次，您已超出限制!");var a=u.tmpl('    <style type="text/css">    .mirror-list .tc-15-page{display: none}    .mirror-list .tc-15-table-fixed-head {      position: absolute;      top: 108px;      width: 480px!important;    }    </style>    <div class="mirror-list">        <div class="mirror-clear">            <div class="mirror-copy-title">复制<%=num%>个镜像（共<%=allsize%>GB）到：</div>             <% if (remainingTime <= 3) { %>                <div class="mirror-copy-date mirror-gray-text">今日剩余操作次数:<span class="mirror-red-text"> <%=remainingTime%>次</span></div>            <% } %>        </div>        <div id="copyTable"></div>    </div>',{num:r.length,allsize:s,remainingTime:i});h.create(a,520,"",{title:"跨地域复制镜像",preventResubmit:!0,button:{"确定":function(){n.sendCopyReq()}}}),n.$copyTable=c("#copyTable"),n.initCopyTable()}),v.click("jingxiang.copy")}else n.showNotSupport(o)}))};s.prototype={sendCopyReq:function(){var i=this,e=this.options,a=e.imgIds,s=e.imgMap,n=e.listObj,t=n.getRegionId(),r=f.REGIONMAP[t+""],o=this.gridView.getSelected(),d=[];if(!o.length)return m.restoreDialogBtn(),l.error("请选择地域!");o.forEach(function(e){d.push(f.REGIONMAP[e.rid+""])}),h.hide(),I.apiRequest({serviceType:"image",cmd:"SyncCvmImage",data:{imgIdList:a,srcRegion:r,dstRegion:d}}).then(function(e){if((e=e.data).taskId){h.hide(),a.forEach(function(e){var t=c("#imageList").find('tr[data-imgid="'+e+'"]').attr("data-index");n.gridView.$refs.list[t].$set({$loading:!0,$selected:!1,statusDesc:"正在同步至其他地域"}),s[e].statusDesc="正在同步至其他地域"});var t=function(){p.getFlowCscResult({taskId:e.taskId},function(e){0==e.status?(n.getList(),l.success("复制镜像成功")):1==e.status?(n.getList(),setTimeout(function(){l.error("复制镜像失败")},0)):i.timeOut=setTimeout(t,5e3)})};t(),n.selectedChange()}})},initCopyTable:function(){var i=this,e={$data:{selectedHighlight:!1,colums:[{key:"rName",name:"地域",width:150},{key:"imgShowNum",name:"已有镜像",width:""}],minHeight:0,showState:!1,showPagination:!1},getData:function(e,t){i.getCopyTable()},setTrAttr:function(e,t){}},t=a.getComponent("grid-view");i.gridView=new t(e),i.$copyTable.append(i.gridView.$el)},getCopyTable:function(){var o=this,d=this.options,t=d.listObj.getRegionId(),i=[],a=[],c=[],l=0,s=!1;-1<b.indexOf(t+"")&&(s=!0),I.apiRequest({serviceType:"image",cmd:"GetImageQuota"}).then(function(e){e=e.data,l=e.cvmImageQuota,p.queryRegion(function(r){for(var e in r)e!=t&&g.indexOf(e+"")<0&&(s?-1<b.indexOf(e+"")&&i.push(e):i.push(e));i.forEach(function(i){a.push(function(t){I.apiRequest({serviceType:"image",cmd:"DescribeImages",regionId:i,data:{status:0,imageType:1,limit:200}}).then(function(e){e.rid=i,e.rName=r[i],t(e)})})}),m.parallel(a,function(e){if(e&&e.length){e.forEach(function(e){c.push({rid:e.rid,rName:e.rName,imgNum:e.totalCount,imgShowNum:e.totalCount+"/"+l,$disable:d.imgIds.length+e.totalCount>l})}),o.gridView.setData({list:c});var i=o.$copyTable,a=!1;c.forEach(function(e,t){e.$disable?i.find('tr[data-index="'+t+'"]').find("td").eq(2).find("span").append('<i class="mirror-gray-text"> (每个地域暂只支持'+l+"个镜像)</i>"):a=!0}),a||h.toggleBtnDisable(!0);for(var t=0,s=g.length;t<s;t++){var n=g[t];r[n]&&i.find("tbody").append(u.tmpl('    <tr>        <td>            <div class="tc-15-first-checkbox">                <input type="checkbox" class="tc-15-checkbox" disabled>            </div>        </td>        <td colspan="2"><div class="mirror-gray-text"><%= regionName %>地区<i>(暂不支持复制到<%= regionName %>地区)</i></div>        </td>    </tr>',{regionName:f.REGIONNAMES[n]}))}o.gridView.resize(),h.center()}})})})},showNotSupport:function(e){h.confirm(u.tmpl('    <strong style="font-size:18px">暂不支持将<%= regionName %>地区的镜像复制到其它地域</strong>',{regionName:f.REGIONNAMES[e]}),function(){h.hide()},null,"","","确定",!1)},destroy:function(){clearTimeout(this.timeOut)}},i.exports=s}),define("modules/cvm/image/data_package",function(e,t,i){var a=e("./util"),s=e("widget/getOsName/getOsName").getOsName,n={1:"创建中",2:"正常",3:"被使用中",4:"正在从其他地域同步",5:"正在同步至其他地域",6:"导入中"},r=function(e){var t=e.data;this.options=e;for(var i,a=0;i=t[a];a++)this.statusDesc(i),this.diskInfo(i),i.descOsName=s(i.osName);return t};r.prototype={statusDesc:function(e){e.statusDesc=n[e.status]?n[e.status]:"未知",4==e.status&&(e.$loading=!0,e.statusDesc=n[e.status]+", 已完成"+e.syncPercent+"%"),5==e.status&&(e.$loading=!0),6==e.status&&(e.$loading=!0),e.imageType===a.TYPES.SHARED&&(e.$readonly=!0)},diskInfo:function(e){"xvda"==e.target?e.disksize=e.size||"-":e.disksize="-"}},i.exports=r}),define("modules/cvm/image/detail",function(e,t,i){var a,s,n=e("$"),r=(e("manager"),e("util"),e("appUtil")),c=e("pageManager"),l=e("modules/cvm/image/data_package"),p=e("dataManager"),u=(e("models/api"),e("widget/getOsName/getOsName")),m=e("models/iaas"),o=e("qccomponent"),d=e("dialog"),h=e("widget/fieldsManager/gridView"),v=e("widget/grid/Action"),f=e("widget/grid/LocalGrid"),g=e("./share"),b=e("./cacher"),I=e("./util");a=o.extend({$tpl:'    <div class="manage-area">    <div class="manage-area-title secondary-title">        <a href="javascript:history.go(-1);" class="back-link"><i class="btn-back-icon"></i>返回</a>        <span class="line-icon">|</span>            <h2>{{image.unImgId}}(<span class="ellipsis cvm-entry-name">{{image.imageName}}</span>)详情</h2>    </div>    <div class="manage-area-main secondary-main">            <div class="mirror-param">\x3c!-- 参数列表 开始 --\x3e                <div class="param-box">                    <div class="param-hd">                        <h3>镜像信息</h3>                    </div>                    <div class="param-bd">                        <ul class="item-descr-list">                            <li>                                <span class="item-descr-tit">名称</span>                                <span class="item-descr-txt">{{image.imageName}}</span>                            </li>                            <li>                                <span class="item-descr-tit">镜像ID</span>                                <span class="item-descr-txt">{{image.unImgId}}</span>                            </li>                            <li>                                <span class="item-descr-tit">状态</span>                                <span class="item-descr-txt" data-title="{{image.statusDesc}}">{{image.statusDesc}}</span>                            </li>                            <li>                                <span class="item-descr-tit">镜像类型</span>                                <span class="item-descr-txt">{{TYPE_NAMES[image.imageType] || \'未知#\'+image.imageType}}</span>                            </li>                            <li>                                <span class="item-descr-tit">操作系统</span>                                <span class="item-descr-txt">{{image.descOsName}}</span>                            </li>                            <li>                                <span class="item-descr-tit">创建者</span>                                <span class="item-descr-txt">{{image.creator}}</span>                            </li>                            <li b-if="image.imageType !== TYPES.PUBLIC">                                <span class="item-descr-tit">Disk</span>                                <span class="item-descr-txt">{{image.target}}</span>                            </li>                            <li b-if="image.imageType !== TYPES.PUBLIC">                                <span class="item-descr-tit">镜像包含数据</span>                                <span class="item-descr-txt">{{image.content}}</span>                            </li>                            <li b-if="image.imageType !== TYPES.PUBLIC">                                <span class="item-descr-tit">镜像磁盘大小</span>                                <span class="item-descr-txt">{{image.size}}</span>                            </li>                            <li b-if="image.imageType !== TYPES.PUBLIC">                                <span class="item-descr-tit">{{image.imageType === TYPES.SHARED ? \'共享时间\' : \'创建时间\' }}</span>                                <span class="item-descr-txt">{{image.createTime}}</span>                            </li>                            <li>                                <span class="item-descr-tit">镜像描述</span>                                <span class="item-descr-txt" style="white-space: pre-wrap;">{{image.imageDescription||"无"}}</span>                            </li>                        </ul>                    </div>                </div>                \x3c!-- 参数列表  --\x3e                <div class="param-box" data-mod="share" b-if="canShare">                    <div class="param-hd">                        <h3>镜像共享</h3>            </div>                    <div class="param-bd">                        <div class="tc-15-action-panel">                            <qc-action-button label="共享镜像" disabled="{{!canShareMore}}" b-with="{action:share.bind(this)}"></qc-action-button>                            <qc-action-button label="取消共享" disabled="{{!hasSelected}}" b-with="{action:cancel.bind(this)}" attr="{{{\'data-title\':hasSelected?\'\':\'请选择要取消共享的帐号\'}}}"></qc-action-button>                            \x3c!--<qc-action-button float="right" class-name="weak setting" b-with="{action:setColumns.bind(this)}"></qc-action-button>--\x3e                            \x3c!--<qc-search float="right" placeholder="搜索关键词" multiline="false" b-with="{search:search.bind(this)}" keyword="{{keyword}}"></qc-search>--\x3e    </div>                        <share-grid b-ref="grid" b-with="gridCfg" region-id="{{regionId}}" un-img-id="{{image.unImgId}}"></share-grid>                    </div>                </div>            </div>        </div>    </div>',$beforeInit:function(){var t=this;t.gridCfg={_watchGrid:function(e){r.beeBind(e,t,"selectedNum"),r.beeBind(e,t,"totalNum")},doCancel:t.doCancel.bind(t)},a.__super__.$beforeInit.apply(t,arguments),r.beeBind(t,t,"image.imageType===TYPES.PRIVATE","canShare"),r.beeBind(t,t,"selectedNum>0","hasSelected"),r.beeBind(t,t,"totalNum<MAX_COUNT","canShareMore")},share:function(){var e=this;g({regionId:e.regionId,image:e.image}).done(function(){e.$refs.grid.bufferReload()})},cancel:function(e){var t=this.$refs.grid;this.doCancel(t.getSelected(),e.$el,this.$el)},doCancel:function(e,t,i){var a=this,s=a.$refs.grid;d.create('    <div class="coin-alert">        <table class="ui-popmsg"><tbody><tr>            <td height="72" class="i">                <i class="ico ico-warn mr10"></i>            </td>            <td height="72" class="t">                <span class="info">                    <span class="tit">确定取消共享？</span><br>                </span>            </td>        </tr></tbody></table>    </div>',480,"",{title:"取消共享",button:{"确定":function(){d.hide(),b.cancelShareImage(a.regionId,a.image.unImgId,e.map(function(e){return e.uin||e})).done(function(){s.bufferReload()})}}})}},{defaults:{MAX_COUNT:20,TYPES:I.TYPES,TYPE_NAMES:I.TYPE_NAMES}}),(s=f.extend({$mixins:[h("cvm_image_share_columns_v20151215")],$afterInit:function(){var t,i=this;s.__super__.$afterInit.apply(i,arguments),i._watchGrid(i),t=i.bufferReload.bind(i),["regionId","unImgId"].forEach(function(e){i.$watch(e,t)}),t()},onRowCancel:function(e,t,i){this.doCancel([e],n(i.currentTarget),this.$gridBody)},getData:function(){var i=this,e=i.regionId,t=i.unImgId;i.showLoading("加载中..."),b.getImageShare(e,t).done(function(e){var t=(e.data.imageList[0]||{}).shareUinInfo;i.setData({totalNum:t.length,list:t}),i.hideLoading()})}},{defaults:{colums:[{key:"uin",name:"对端账号唯一ID",required:!0},{key:"email",name:"邮箱",tdTpl:"{{item.uin}}@qq.com"},{key:"shareTimeStamp",name:"共享时间"},{key:"_action",name:"操作",tdTpl:'    <cell-action text="取消共享" act="cancel"></cell-action>',minWidth:100,required:!0}],outerPaging:!1,showPagination:!1,hasFirst:!0,emptyTips:"此镜像还没有共享给其它用户"}})).tag("cell-action",v),a.tag("share-grid",s),i.exports={title:"镜像-控制台",pageClass:"",render:function(e,t,a,s){(arguments.length<=2||3===arguments.length&&"object"==typeof a)&&(s=a,a=t,t=I.TYPES.PRIVATE),c.appArea.html("");var n=this;n.regionId=e;var r,i=p.get("imagePackData");if(i)for(var o,d=0;o=i[d];d++)if(o.unImgId==a){r=o;break}r?n.renderUi(r,s):m.apiRequest({serviceType:"image",cmd:"DescribeImages",data:{status:[2,3,4,5],imageType:t,limit:200}}).then(function(i){u.promise.then(function(){new l({data:i.imageSet});for(var e,t=0;e=i.imageSet[t];t++)if(e.unImgId==a){r=e;break}r?n.renderUi(r,s):n.renderDetailNoData()})},function(){n.renderDetailNoData()})},renderUi:function(e,t){e.unImgId=e.unImgId||"";var i;this.bee=new a({$data:{regionId:this.regionId,image:e}}),this.$el=n(this.bee.$el).appendTo(c.appArea.html("")),t&&"unshare"in t&&(i=this.$el.find('[data-mod="share"]'))[0]&&i[0].scrollIntoView({behavior:"smooth",block:"start"})},renderDetailNoData:function(){r.renderDetailNoData("镜像","/cvm/image")},destroy:function(){this.$el&&this.$el.remove()}}}),define("modules/cvm/image/hub",function(e,t,i){var n=e("manager");i.exports={shareImage:function(e,t,i,a,s){n.delegateCApi(e,"image","ShareImage",{imageId:t,uinList:[].concat(i)},a,s)},cancelShareImage:function(e,t,i,a,s){n.delegateCApi(e,"image","CancelShareImage",{imageId:t,uinList:[].concat(i)},a,s)},getImageShare:function(e,t,i,a){n.delegateCApi(e,"image","GetImageShareUinInfo",{imageIds:[t]},i,a)}}}),define("modules/cvm/image/image/useless",function(r,e,t){var u=r("$"),s=r("pageManager"),m=r("manager"),a=r("util"),h=r("appUtil"),i=r("event"),v=r("router"),n=r("widget/region/region2"),o=r("panel"),d=r("./detail"),f=r("dialog"),g=r("tips"),b=r("lengthlimiter"),I=r("validator"),c=r("contextmenu"),y=r("reporter"),l=r("./operate_auth"),w=r("./copy"),p=r("modules/cvm/image/data_package"),x=r("dataManager"),k=(r("models/api"),r("widget/getOsName/getOsName")),C=r("models/iaas"),T=r("widget/grid/Action"),D=r("qccomponent"),P=r("widget/grid/LocalGrid"),S=r("./share"),_=r("./util"),E=r("widget/detail/detail"),L=r("widget/step/steps"),N=new(r("widget/baseInfo/validator"))({errClass:"is-error",rules:{name:function(e){var t;return 0==e.length?t="镜像名称不能为空":20<e.length?t="镜像名称不能超过20个字符":/^[0-9a-zA-Z-]{1,25}$/.test(e)||(t="镜像名称仅能包含字母数字字符"),t},version:function(e){return!/\S+/.test(e)&&"系统版本不能为空"},regionId:function(e){var t;return""==e&&(t="请选择地域"),t},osBits:function(e){var t;return""==e&&(t="请选择系统架构"),t},osName:function(e){var t;return""==e&&(t="请选择系统平台"),t}}}),$={1:"华南地区(广州)",4:"华东地区(上海)",8:"华北地区(北京)"},A={0:"非导入",1:"导入"},R=null,M={},j=null,O={main:'    <div class="manage-area" id="imgAllWrap">        <style>            .oper-cell .tc-15-dropdown{                font-size: 12px;            }            .oper-cell .tc-15-dropdown .tc-15-dropdown-link{                height: 19px;                line-height: 19px;            }        </style>        <div class="manage-area-title">            <h2>镜像</h2>            <div id="regionWrapper" class="tc-select-box"></div>        </div>        <div class="manage-area-main">            <div class="tc-15-tab tc-15-tab-alt trash-tab">                <ul role="tablist" class="tc-15-tablist" style="border-top:1px solid #ccc">                    <li b-repeat="tab in imageTypeTabs" class="{{imageType == tab.type ? \'tc-cur\' : \'\'}}"><a href="cvm/image?rid={{regionId}}&imageType={{tab.type}}" data-event="nav" role="tab">{{tab.name}}</a></li>                </ul>                <div class="tab-panel">                    <div class="tc-15-action-panel" id="imgOperWrap">                        <button b-if="imageType == TYPES.PRIVATE" class="tc-15-btn m disabled" data-name="del" data-event="img_oper">删除</button>                        <button b-if="imageType == TYPES.PRIVATE" class="tc-15-btn m disabled" data-name="mod" data-event="img_oper">修改</button>                        <button b-if="imageType == TYPES.PRIVATE && isImportVisible" class="tc-15-btn m" data-name="import" data-event="img_oper">导入镜像</button>                        <button b-if="imageType == TYPES.PRIVATE" class="tc-15-btn m disabled" data-name="copy" data-event="img_oper">跨地域复制</button>                        <button class="tc-15-btn m disabled" data-name="add" data-event="img_oper">创建云主机</button>                    </div>                    <div id="imageList"></div>                </div>            </div>        </div>    </div>',delDialog:'    <div class="coin-alert">        <table class="ui-popmsg"><tbody><tr>            <td height="72" class="i">                <i class="ico ico-warn mr10"></i>            </td>            <td height="72" class="t">                <span class="info">                    <span class="tit">确定删除选中的镜像？</span><br>                </span>            </td>        </tr></tbody></table>    </div>',modDialog:'    <div class="edit_form_wrap">        <ul class="edit_psword">            <li>                <label class="txt" for="">镜像ID:</label>                <span id="imageId"></span>            </li>            <li>                <label class="txt" for="">镜像名称:</label>                <input type="text" id="imageName" data-lenLimit=\'20\' relTipId=\'imageNameTip\' maxlength=\'20\' class="tc-15-input-text m">                <p class="tip" id="imageNameTip"></p>            </li>            <li>                <label class="txt" for="">镜像描述:</label>                <textarea id="imageDesc" class="tc-15-input-textarea"></textarea>            </li>        </ul>    </div>',importDialogHeader:'    <div class="manage-area-title secondary-title">        <a href="javascript:;" b-on-click="back()" class="back-link"><i class="btn-back-icon"></i>镜像</a>        <span class="line-icon">|</span>        <h2>导入镜像</h2>    </div>',importDialogContent:'    <div class="manage-area-main secondary-main mirror-import-wrap">        <add-steps options="{{options}}" steps="{{steps}}" b-ref="steps" back="{{back.bind(this)}}" confirm="{{confirm.bind(this)}}" _download-cfg="{{_downloadCfg.bind(this)}}" cancel="{{cancel.bind(this)}}"></add-steps>    </div>',importDialogFOOTER:'    <div class="create-2-btn-ground" b-if="showBtns" style="margin-bottom: 1.5em;overflow:hidden">        <button b-ref="prev" b-if="curStep" type="button" class="tc-15-btn weak {{disable ? \'disabled\' : \'\'}}"                disabled?="disable" b-on-click="prev()">{{prevBtn}}</button>        <button b-ref="next" type="button" class="tc-15-btn {{disable ? \'disabled\' : \'\'}}"                disabled?="disable" b-on-click="next()">{{curStep == steps.length -1 ? confirmBtn : nextBtn}}</button>        <button b-ref="cancel" b-if="cancel" type="button"                class="tc-15-btn weak" b-on-click="_cancel()">{{cancelBtn}}</button>    </div>',importDialogSTEP1:'   <div class="system-select-wrap">        <div class="system-select">            <span>您准备导入的镜像操作系统</span>            <select name="osType" class="tc-15-select m">                <option value="linux" <% if(osType=="Linux"){ %>selected="selected"<%}%> >Linux</option>                <option value="windows" <% if(osType=="Windows"){ %>selected="selected"<%}%> >Windows</option>            </select>        </div>        <div class="mirroring-inf">            <ul class="mirroring-inf-ul">                <li>                    <i class="num">1</i>                    <strong>准备镜像文件</strong>                    <p class="limit-txt text-label">您制作的镜像必须符合镜像导入限制：</p>                    <table class="import-limit">                      <tbody><tr>                        <td class="tit"><strong>操作系统</strong></td>                       <td>                        <ul>                                            <% for (var item in osName) { %>                                <li><%= osName[item] %></li>                            <% } %>                        </ul>                       </td>                      </tr>                      <tr>                       <td class="tit"><strong>镜像格式</strong></td>                       <td><ul>                            <li>RAW格式</li>                            <li>QCOW2格式</li>                            <li>VHD格式</li>                            <li>VMDK格式</li>                       </ul></td>                      </tr>                      <tr>                       <td class="tit"><strong>文件系统</strong></td>                        <td><%= fs %></td>                      </tr>                      <tr>                         <td class="tit"><strong>限制</strong></td>                        <td><ul>                            <% for (var i=0, item; item = limit[i]; i++) { %>                                <li><%= item %></li>                            <% } %>                            <li>其他，<a href="https://'+QCMAIN_HOST+'/doc/product/213/%E9%95%9C%E5%83%8F#7.-.E5.AF.BC.E5.85.A5.E9.95.9C.E5.83.8F" target="_blank">网络等相关配置<i class="external-link-icon"></i></a></li>                       </ul></td>                      </tr>                    </tbody></table>                </li>                <li>                    <i class="num">2</i>                    <strong>开通<a href="https://console.qcloud.com/cos" target="_blank">对象存储服务<i class="external-link-icon"></i></a></strong>                </li>                <li>                    <i class="num">3</i>                    <strong>创建<a href="https://'+QCMAIN_HOST+'/document/product/436/6244" target="_blank">bucket<i class="external-link-icon"></i></a></strong>                </li>                <li>                    <i class="num">4</i>                    <strong>上传镜像文件到bucket，并获取<a href="https://'+QCMAIN_HOST+'/document/product/436/6260" target="_blank">镜像文件URL<i class="external-link-icon"></i></a></strong>                </li>            </ul>            <div class="ok-select">                <input id="ready" name="ready" type="checkbox" class="tc-15-checkbox">                <label for="ready">我已做好以上准备</label>            </div>                                    </div>    </div>    <div class="line-partition"></div>',importDialogSTEP2:'    <div class="system-select-wrap">        <ul class="form-list">              <li>                  <div class="form-label required">                      <label for="">镜像文件URL</label>                  </div>                  <div class="form-input">                      <div class="form-unit">                          <input id="imgCosUrl" type="text" class="tc-15-input-text m" placeholder="镜像所在COS的对象地址URL">                          <b class="icon-valid-flag"></b>                          <span id="validLoadingTip" class="valid-result"></span>                          <p class="form-input-help">请输入正确的URL地址</p>                      </div>                  </div>              </li>              <li>                  <div class="form-label required">                      <label for="">镜像名称</label>                  </div>                  <div class="form-input">                      <div class="form-unit">                          <input id="imgName" type="text" class="tc-15-input-text m" maxlength=\'20\' data-validate="name" placeholder="导入镜像后显示的名称">                          <b class="icon-valid-flag"></b>                      </div>                  </div>              </li>              <li>                  <div class="form-label">                      <label for="">地域</label>                  </div>                  <div class="form-input">                      <div class="form-unit">                          <select id="regionId" class="tc-15-select m"  data-validate="regionId">                            <option value="">请选择地域</option>                            <% for(var item in region){ %>                                <option value="<%= item%>"><%= region[item]%></option>                            <% } %>                          </select>                          <b class="icon-valid-flag"></b>                      </div>                  </div>              </li>              <li>                  <div class="form-label required">                      <label for="">操作系统</label>                  </div>                  <div class="form-input">                      <p><%= osType %></p>                  </div>              </li>              <li>                  <div class="form-label">                      <label for="">系统架构</label>                  </div>                  <div class="form-input">                      <div class="form-unit">                          <select id="osBits" class="tc-15-select m"  data-validate="osBits">                              <option value="">请选择系统架构</option>                              <option value="64">64位</option>                              <option value="32">32位</option>                          </select>                          <b class="icon-valid-flag"></b>                      </div>                  </div>              </li>              <li>                  <div class="form-label">                      <label for="">系统平台</label>                  </div>                  <div class="form-input">                      <div class="form-unit">                          <select id="osName" class="tc-15-select m" data-validate="osName">                            <option value="">请选择系统平台</option>                            <% for(var item in osName) {%>                                <option value="<%= item %>"><%= osName[item] %></option>                            <% } %>                          </select>                          <b class="icon-valid-flag"></b>                      </div>                  </div>              </li>             <li>                  <div class="form-label required">                      <label for="">系统版本</label>                  </div>                  <div class="form-input">                      <div class="form-unit">                        <input id="osVersion" type="text" data-validate="version" class="tc-15-input-text m">                        <b class="icon-valid-flag"></b>                      </div>                  </div>              </li>              <li>                  <div class="form-label">                      <label for="">镜像描述(选填)</label>                  </div>                  <div class="form-input">                    <textarea id="imgDesc" class="mirror-txt" ></textarea>                    <b class="icon-valid-flag"></b>                  </div>              </li>        </ul>    </div>    <div class="line-partition"></div>',importTip:'<div class="dialog_layer_cont">  <div class="coin-alert">    <table class="ui-popmsg"><tbody>      <tr>        <td height="72" class="i"><i class="ico ico-warn mr10"></i></td>        <td height="72" class="t"><span class="info">导入镜像任务已发起，需要您耐心等待，请关注目标地域导入镜像的进度，导入完成或失败，我们会短信通知您。</span>        </td></tr>      </tbody>    </table>  </div></div>',creDialog:'    <div class="coin-alert">        <table class="ui-popmsg"><tbody><tr>            <td height="72" class="i">                <i class="ico ico-warn mr10"></i>            </td>            <td height="72" class="t">                <span class="info">                    <span class="tit">确定使用选择的镜像创建云主机？</span><br>                </span>            </td>        </tr></tbody></table>    </div>'},B=_.TYPES,V=[B.PUBLIC,B.PRIVATE,B.SHARED].map(function(e){return{type:e,name:_.TYPE_NAMES[e]}}),z=a.tmpl('    <p><a data-event="nav" href="/cvm/image/detail/<%- regionId %>/<%- item.imageType %>/<%- item.unImgId %>"><%= item.unImgId || "" %></a></p>    <p><span class="text-overflow m-width"><%=item.imageName%></span></p>',null),F=["del","add","mod","import","copy","share","unshare"],U=function(){var e=v.fragment;0<e.indexOf("rid=")?e=e.replace(/rid=[^&]*(?=$|&)/,"rid="+R.val()):0<e.indexOf("?")?e+="&rid="+R.val():e+="?rid="+R.val(),o.hide(),v.navigate(e)},q=E.extend({$afterInit:function(){q.__super__.$afterInit.call(this);var t=this.$refs.steps;t.$watch("curStep",function(e){t.$set({confirmBtn:"开始导入",cancel:!1,nextBtn:1==e?"完成":"下一步"})}),u(t.$refs.next).prop("disabled",!0).addClass("disabled"),u(document).on("change",'[name="ready"]',function(){u(this).prop("checked")?u(t.$refs.next).removeAttr("disabled").removeClass("disabled"):u(t.$refs.next).attr("disabled","disabled").addClass("disabled")})},back:function(e){var t=this;e?(t.$refs.steps.$set({curStep:0}),history.back()):f.confirm("配置内容尚未完成，你要离开此页吗？",function(){t.$refs.steps.$set({curStep:0}),history.back()},function(){},"配置未完成","","离开此页")}},{defaults:{title:"导入镜像",headerTpl:O.importDialogHeader,content:O.importDialogContent}}),W=L.extend({footerTpl:O.importDialogFOOTER});q.tag("add-steps",W);var H=function(){this.$importImgEl=s.appArea,this.data={linux:{osType:"Linux",osName:{},fs:"MBR分区的ext3或ext4文件系统，不支持GPT分区",limit:["磁盘大小不超过50G","最好是原生内核，如果有修改可能会导致虚拟机无法导入"],region:$},windows:{osType:"Windows",osName:{},fs:"MBR分区的ntfs 文件系统，不支持GPT分区",limit:["磁盘大小不超过50G"],region:$}};var t=this;this.GetExternalImageOs().done(function(e){0==e.code&&e.data&&(t.data.linux.osName=e.data.linux,t.data.windows.osName=e.data.windows),t.render(),t.bindEvt()})};H.prototype.render=function(){var n=this;this.importVm=new q({steps:[{title:"导入镜像前准备",content:a.tmpl(O.importDialogSTEP1,n.data.linux)},{title:"导入镜像",content:a.tmpl(O.importDialogSTEP2,n.data.linux),confirm:function(e,t){var i=+u("#regionId").val(),a={imgCosUrl:u.trim(u("#imgCosUrl").val()),imgName:u.trim(u("#imgName").val()).toLowerCase(),osBits:+u("#osBits").val(),osType:u("#osName").val(),osVersion:u.trim(u("#osVersion").val()),imgDesc:u.trim(u("#imgDesc").val())},s=this.$refs.next;n.checkAll(s,function(){n.exec(i,a)})}}]}),this.$importImgEl.html(this.importVm.$el)},H.prototype.bindEvt=function(){var i=this;this.$importImgEl.off("change.importimg").on("change.importimg",'[name="osType"]',function(e){var t=u(this).val();i.selectedChange(t)}),this.$importImgEl.off("blur.imgCosUrl").on("blur.imgCosUrl","#imgCosUrl",function(e){i.checkCosUrl()}),this.$importImgEl.off("blur.imgName").on("blur.imgName","#imgName",function(e){N.validate(this,{noTips:!0})||setTimeout(function(){N.showErr(u("#imgName")[0],"镜像名称仅能包含字母数字字符")},100)}),this.$importImgEl.on("change","#regionId",function(e){var t=u(this).val();h.setRegionId(t)})},H.prototype.selectedChange=function(e){var t=this.importVm.$refs.steps.$refs,i=t.steps;u(i[0].$el).html(a.tmpl(O.importDialogSTEP1,this.data[e])),u(i[1].$el).html(a.tmpl(O.importDialogSTEP2,this.data[e])),u(t.next).prop("disabled",!0).addClass("disabled")},H.prototype.GetExternalImageOs=function(e){var t=u.Deferred();return C.apiRequest({cmd:"GetExternalImageOs",serviceType:"image",data:e}).then(function(e){t.resolve(e)},function(e){t.reject(e)}),t},H.prototype.checkAll=function(e,t){var i=this;this.checkCosUrl(function(){N.btn=e,N.validateAll(i.$importImgEl[0])&&t&&t()})},H.prototype.checkCosUrl=function(e){var t=u.trim(u("#imgCosUrl").val());/^((http|https|ftp):\/\/)?(\w(\:\w)?@)?([0-9a-z_-]+\.)*?([a-z0-9-]+\.[a-z]{2,6}(\.[a-z]{2})?(\:[0-9]{2,6})?)((\/[^?#<>\/\\*":]*)+(\?[^#]*)?(#.*)?)?$/i.test(t)?(u("#imgCosUrl").addClass("loading"),u("#validLoadingTip").html("URL验证中...").show(),C.apiRequest({serviceType:"image",cmd:"CheckCosUrl",data:{cosUrl:t}},{tipErr:!1}).then(function(){N.hideErr(u("#imgCosUrl")[0]),u("#imgCosUrl").removeClass("loading"),u("#validLoadingTip").html("URL验证成功！").fadeOut(),e&&e()},function(e){12121==(e=e.data).cgwerrorCode&&N.showErr(u("#imgCosUrl")[0],"镜像文件URL错误"),u("#imgCosUrl").removeClass("loading"),u("#validLoadingTip").hide()})):setTimeout(function(){N.showErr(u("#imgCosUrl")[0],"输入的镜像文件URL不合法")},100)},H.prototype.exec=function(a,s){C.apiRequest({serviceType:"image",cmd:"DescribeImages",data:{status:0,imageType:1,limit:200}}).then(function(e){for(var t,i=0;t=e.imageSet[i];i++)if(s.imgName==t.imageName.toLowerCase())return void N.showErr(u("#imgName")[0],"输入的名称已经存在");C.apiRequest({regionId:a,serviceType:"image",cmd:"ImportImage",data:s}).then(function(e){f.create(O.importTip,"550","",{title:"导入镜像",preventResubmit:!1,defaultCancelBtn:!1,button:{"确定":function(e){v.navigate("/cvm/image")}}})})})};var G={title:"镜像-控制台",render:function(){var s=arguments,n=this;m.getAllWhiteList(function(e){var t=e.CVM_APIv3_BlackList;if(t&&0<t.length)n.renderCVM1.apply(n,s);else{var i=e.CVM_ApiToMc,a=e.PrepaidForCVM;i&&i.length&&a&&a.length?r.async("cvm/image/image",function(e){e.pageActive=!0,n.destroy=e.destroy,e.render.apply(e,s)}):n.renderCVM1.apply(n,s)}})},renderCVM1:function(){var i=!1;if("detail"===arguments[0])return d.render.apply(d,[].slice.call(arguments,1));if("import"===arguments[0])return new H;this.queryStr=arguments[0];var a=new D(O.main,{regionId:this.getRegionId(),imageType:this.getImageType(),imageTypeTabs:V,TYPES:B,isImportVisible:i});s.appArea.html("").append(a.$el),this.imgListEl=u("#imageList"),this.needSpeedReport=!0,this.initWidget(),this.bindEvt(),m.queryWhiteList({whiteKey:["import-image"]},function(e){var t=e["import-image"];t&&0<t.length&&(i=!0),a.$set({isImportVisible:i})})},initWidget:function(){var a=this,e=this.getRegionId();R=new n({renderTo:u("#regionWrapper"),selectedId:e,change:U}),this.initGridView();var t=[{del:{name:"删除",callback:this.execContextMenu},mod:{name:"修改",callback:this.execContextMenu},copy:{name:"跨地域复制",callback:this.execContextMenu},share:{name:"共享镜像",callback:this.execContextMenu},unshare:{name:"取消共享",callback:this.execContextMenu},add:{name:"创建云主机",callback:this.execContextMenu}}];new c({object:this.imgListEl,selector:"tbody tr",data:t,onShow:function(e,t,i){T.hideMenu(a.imgListEl),a.displayOperMenu(t,i)}})},bindEvt:function(){var t=this;this.imgListEl.on("click",'input[type="checkbox"]',function(e){setTimeout(function(){t.selectedChange()},0)}),i.bindCommonEvent(u("#imgAllWrap")[0],"click",{img_oper:function(){var e=u(this);e.hasClass("disabled")||t.exec(e.attr("data-name"))}})},exec:function(e,t){var i,a,s,n,r,o,d,c,l,p;t||(t=[],j.getSelected().forEach(function(e){t.push(e.unImgId)}));switch(e){case"del":p=t,f.create(O.delDialog,480,"",{title:"删除镜像",button:{"确定":function(){f.hide();for(var e=0;e<p.length;e++)G.setLoading(u("tr[data-imgid="+p[e]+"]"),"删除中");C.apiRequest({serviceType:"image",cmd:"DeleteCVMImages",data:{imageIds:p}}).then(function(e){e=e.data;var t=function(){m.getFlowCscResult({taskId:e.taskId},function(e){0==e.status?(G.refresh(),g.success("删除镜像成功")):1==e.status?(G.refresh(),g.error("删除镜像失败")):setTimeout(t,1e3)})};t()},function(){G.refresh()})}}}),y.click("jingxiang.delete");break;case"mod":l=M[(o=t)[0]],f.create(O.modDialog,550,"",{title:"修改镜像",preventResubmit:!0,button:{"确定":function(){var a=d.val(),s=c.val(),n=function(e,t){var i={tip:e};return I.showErr(t,i)};if(0==a.length||25<a.length||60<s.length){if(0==a.length)return n("镜像名称不能为空",d);if(20<a.length)return n("镜像名称不能超过25个字符",d);if(60<s.length)return n("镜像描述不能超过60个字符",c)}else{if(!/^[0-9a-zA-Z-]{1,25}$/.test(a))return n("镜像名称仅能包含字母数字字符",d);C.apiRequest({serviceType:"image",cmd:"DescribeImages",data:{status:0,imageType:1,limit:200}}).then(function(e){for(var t,i=0;t=e.imageSet[i];i++)if(u.trim(a).toLowerCase()==t.imageName.toLowerCase()&&o[0]!==t.unImgId)return n("输入的名称已经存在",d);C.apiRequest({serviceType:"image",cmd:"ModifyImageAttributes",data:{imageId:o[0],imageName:a,imageDescription:s}}).then(function(){f.hide(),G.refresh()})})}}}}),d=u("#imageName").val(l.imageName),c=u("#imageDesc").val(l.imageDescription),u("#imageId").text(l.unImgId),b.trigger(),y.click("jingxiang.revise");break;case"import":v.navigate("/cvm/image/import"),y.click("jingxiang.import");break;case"add":r=t,f.create(O.creDialog,480,"",{title:"创建云主机",button:{"确定":function(){f.hide();var e=M[r[0]],t={osfrom:e.external&&1===e.external?"externalimg":{1:"osimg",2:"system",3:"marketimg",4:"shareimg"}[e.imageType],regionId:h.getRegionId()};e.imageType===B.PUBLIC?(t.osName=e.osName,t.osDesc=e.descOsName):t.imgId=e.imageId,window.open("https://"+QCBUY_HOST+"/cvm?"+Object.keys(t).map(function(e){return encodeURIComponent(e)+"="+encodeURIComponent(t[e])}).join("&"))}}}),y.click("jingxiang.new");break;case"share":a=t,s=this.getRegionId(),n=M[a[0]],S({regionId:s,image:n});break;case"unshare":(i=M[t[0]])&&v.navigate("/cvm/image/detail/"+this.getRegionId()+"/"+i.imageType+"/"+i.unImgId+"?unshare");break;case"copy":this.copyImg=new w({imgIds:t,imgMap:M,listObj:this})}},selectedChange:function(){var e=j.getSelected();this.toggleBtnStatus(e,u("#imgOperWrap"))},displayOperMenu:function(e,t){this.toggleBtnStatus([M[u(t).attr("data-imgid")]],e)},toggleBtnStatus:function(e,i){var a=new l({dataItems:e,operAction:F}).getAuth();F.forEach(function(e){var t=i.find('[data-name="'+e+'"]');0==a[e].code?h.enableBtn(t):h.disableBtn(t,a[e].tip)})},execContextMenu:function(e,t){G.execRowMenuItem(e,t)},execRowMenuItem:function(e,t){for(var i=u(e).attr("data-index"),a=0,s=j.list.length;a<s;a++)j.$refs.list[a].$set({$selected:!1});j.$refs.list[i].$set({$selected:!0}),this.selectedChange(),this.exec(t.attr("data-name"))},getRegionId:function(){return this.queryStr&&this.queryStr.rid?this.queryStr.rid:h.getRegionId()},getImageType:function(){return this.queryStr&&this.queryStr.imageType?parseInt(this.queryStr.imageType,10):B.PRIVATE},getList:function(e,t){M={},t=u.extend({page:j.page,count:j.count},t);this.getRegionId();var s=this;C.apiRequest({serviceType:"image",cmd:"DescribeImages",data:{status:[2,3,4,5,6],imageType:s.getImageType()||B.PRIVATE,offset:(t.page-1)*(t.count||20),limit:t.count||20}},{global:e}).then(function(a){k.promise.then(function(){var e,t=a.imageSet,i=a.totalCount;s.pageActive&&(s.imgList=new p({data:t}),u.each(s.imgList,function(e,t){M[t.unImgId]=t}),x.set("imagePackData",s.imgList),j.setData({list:s.imgList,totalNum:i}),s.needSpeedReport&&(h.speedReport("image"),s.needSpeedReport=!1),s.detailImgId&&(e=u("#imageList").find('tr[data-imgid="'+s.detailImgId+'"]'),u("#imageList").find(".current").removeClass("current"),u(e).addClass("current")),s.checkTask(),s.selectedChange())})})},refresh:function(){this.gridView.refresh()},checkTask:function(){var i=this,e=this.imgListEl.find("tr");this.isWating=!1,e.each(function(e,t){if(u(t).attr("data-isLoading"))return!(i.isWating=!0)}),this.clearCheckTask(),this.isWating&&(this.watingTime=setTimeout(function(){e.find(":checkbox:checked").length||h.isContextMenuShow()||T.isMenuActivated(i.imgListEl)?i.checkTask():i.refresh()},5e3))},clearCheckTask:function(){clearTimeout(this.watingTime)},setLoading:function(e,t){var i=e.attr("data-index");j.$refs.list[i].$set({$loading:!0,loadingText:t,$selected:!1}),this.selectedChange()},initGridView:function(){var e,s=this,t={handleAction:function(e,t){s.exec(e,[t.unImgId])},$data:{initGetData:!0,hasFirst:!0,outerPaging:!1,TYPE_NAMES:_.TYPE_NAMES,EXTERNALMAP:A,electedHighlight:!1,colums:(e=s.getImageType(),[{key:"idName",name:"ID/名称",width:"",minWidth:200},{key:"statusDesc",name:"状态",width:"",tdTpl:"{{item.$loading&&item.loadingText || item.statusDesc}}"},{key:"imageType",name:"类型",tdTpl:'{{TYPE_NAMES[item.imageType]}} {{item.external==1? "[" + EXTERNALMAP[item.external] + "]" :""}}'},{key:"disksize",name:"容量",width:80,minWidth:80},{key:"descOsName",name:"操作系统",width:""},{key:"createTime",name:e===B.SHARED?"共享时间":"创建时间",width:"",tdTpl:'{{item.createTime || "-"}}'},{key:"_action",name:"操作",width:200,tdTpl:'    <div class="oper-cell">        <div b-template b-repeat="action in getActions(item, $parent.$index, $parent.$parent.list.length)">            <cell-action b-with="action"></cell-action>        </div>    </div>'}]),trackKey:"unImgId",emptyTips:"<span>暂无相关数据！</span>",searchItemName:"镜像"},getData:function(e,t){s.getList(undefined,e)},getCellContent:function(e,t,i){return function(e,t,i){if("idName"==i.key)return z({item:t,regionId:h.getRegionId()})}(0,t,i)},setTrAttr:function(e,t){return i=e,i={"data-imgId":(a=t).unImgId},a.$loading&&(i["data-isLoading"]=!0),i;var i,a},getActions:function(e,t,i){s.getRegionId();var a=new l({dataItems:[e],operAction:F}).getAuth();return[{text:"创建云主机",act:"add",hidden:a.add.code},{text:"共享",act:"share",hidden:a.share.code},{text:"更多",hidden:a.copy.code&&a.share.code&&a.mod.code,up:3<t&&i-t<3,menu:[{text:"跨地域复制",act:"copy",disabled:a.copy.code,title:a.copy.tip||""},{text:"取消共享",act:"unshare",hidden:a.unshare.code},{text:"修改",act:"mod",hidden:a.mod.code},{text:"删除",act:"del",hidden:a.del.code}]}]}},i=P.extend();i.tag("cell-action",T),this.gridView=j=new i(t),this.imgListEl.append(j.$el)},destroy:function(){o.hide(),M={},j=R=null,this.copyImg&&this.copyImg.destroy&&this.copyImg.destroy(),this.clearCheckTask()}};t.exports=G}),define("modules/cvm/image/operate_auth",function(e,t,i){var n=e("./util"),r="0x0004",a=function(e){this.options=e};a.prototype={getAuth:function(){var e=this.options,t=e.dataItems,i=e.operAction;i=i||[];for(var a,s={},n=0;a=i[n];n++){var r=this.judgment[a];s[a]=r?r.call(this,t):{code:0}}return s},judgment:{del:function(e){return 0<e.length?this.isReadOnly(e)?this.disable("只能删除自定义镜像"):this.isOperable(e,"0x0001")?this.enable():this.disable("选择的镜像无法删除，请重新选择"):this.disable("请选择你需要删除的镜像")},add:function(e){return 0<e.length?1==e.length?this.isOperable(e,r)?this.enable():this.disable("选择镜像无法用于创建主机，请重新选择"):this.disable("请选择创建主机的唯一镜像"):this.disable("请选择你需要创建主机的镜像")},mod:function(e){return 0<e.length?1==e.length?this.isReadOnly(e)?this.disable("只能修改自定义镜像"):this.isOperable(e,"0x0002")?this.enable():this.disable("选择镜像无法修改，请重新选择"):this.disable("请选择需要修改的唯一镜像"):this.disable("请选择你需要修改的镜像")},"import":function(){return this.enable()},copy:function(e){return 0<e.length?this.isReadOnly(e)?this.disable("共享镜像无法复制"):this.isOverSize(e,50)?this.disable("大于50GB的自定义镜像暂不支持跨地域复制"):this.isOperable(e,r)||this.isOperable(e,"0x0002")||this.isOperable(e,"0x0001")?this.enable():this.disable("镜像无法复制, 请重新选择"):this.disable("请选择你需要复制的镜像")},share:function(e){return 0<e.length?1==e.length?this.isOperable(e,r)&&e[0].imageType===n.TYPES.PRIVATE?this.enable():this.disable("选择镜像无法共享，请重新选择"):this.disable("请选择需要共享的唯一镜像"):this.disable("请选择你需要共享的镜像")},unshare:function(e){return 0<e.length?1==e.length?this.isOperable(e,r)&&e[0].imageType===n.TYPES.PRIVATE?this.enable():this.disable("选择镜像无法共享，请重新选择"):this.disable("请选择需要取消共享的唯一镜像"):this.disable("请选择你需要取消共享的镜像")}},enable:function(){return{code:0}},disable:function(e){return{code:e.code?e.code:1,tip:e.tip?e.tip:e}},isOperable:function(e,t){for(var i,a=[],s=0;i=e[s];s++)i&&(i.operateAuth&t||t===r&&i.imageType===n.TYPES.PUBLIC)||a.push(i);return!a.length},isReadOnly:function(e){return e.some(function(e){return e.imageType===n.TYPES.SHARED||e.imageType===n.TYPES.PUBLIC})},isOverSize:function(e,t){return e.some(function(e){return(parseInt(e.size)||0)>t})}},i.exports=a}),define("modules/cvm/image/share",function(e,t,i){var a,s=e("qccomponent"),n=e("appUtil"),r=e("./cacher"),o=e("dialog"),d=e("widget/popover/HelpTips");(a=s.extend({$tpl:'    <div>        <div class="tc-15-msg">            您可以通过对端账号唯一ID将此镜像共享给其他用户，每个自定义镜像最多可以共享给{{maxCount}}个帐号。        </div>        <ul class="form-list mirror-sharing">            <li>                <div class="form-label">                    <label for="">对端账号唯一ID</label>                </div>                <div class="form-input">                    <div class="form-unit {{initialized && !accountFocused && accountInvalid && \'is-error\'}}">                        <input                                b-on-focus="$set({initialized:true, accountFocused:true})"                                b-on-blur="$set(\'accountFocused\', false)"                               type="text" b-model="account" class="tc-15-input-text m" placeholder="请输入对方对端账号唯一ID">                       <help-tips>在用户中心的个人信息中查看,                           <a target="_blank" href="https://'+QCMAIN_HOST+'/doc/product/213/4944#.E8.8E.B7.E5.8F.96.E5.AF.B9.E7.AB.AF.E5.B8.90.E5.8F.B7.E5.94.AF.E4.B8.80id">点击查看操作指南</a>                       </help-tips>                        <div b-if="initialized && !accountFocused && accountInvalid" class="tc-15-bubble tc-15-bubble-top valid-bubble">                            <div class="tc-15-bubble-inner">{{accountInvalid}}</div>                        </div>                    </div>                </div>            </li>            <li>                <div class="form-label">                    <span class="label">已用限额</span>                </div>                <div class="form-input">                    <div class="share-counter" b-if="loaded">{{usedCount}} / {{maxCount}}</div>                </div>            </li>        </ul>    </div>',$beforeInit:function(){var i=this;a.__super__.$beforeInit.apply(i,arguments);var e=i._validAccount=function(e){i.$set("accountInvalid",i.validAccount(e))};i.$watch("account",n.bufferFn(e,500)),e(i.account),n.beeBind(i,i,"accountInvalid || usedCount>maxCount || !loaded","invalid"),i.$watch("image.unImgId",function(e){i.$set("loaded",!1),r.getImageShare(i.regionId,e).done(function(e){var t=e.data.imageList[0]||{};i.$set({usedCount:(t.shareUinInfo||[]).length,maxCount:e.maxImgShareNum,loaded:!0})})},!0)},validAccount:function(e){return(e=$.trim(e))?/^\d{5,12}$/.test(e)?void 0:"QQ号码格式不正确":"不能为空"},isValid:function(){return this._validAccount(this.account),!this.invalid}},{defaults:{loaded:!1,maxCount:50,usedCount:0,initialized:!1}})).tag("help-tips",d),i.exports=function(e){var t,i=$.Deferred();return t=new a(e),o.create(t.$el,"600","",{title:"共享镜像",preventResubmit:!0,onload:function(){t.$watch("invalid",function(e){o.toggleBtnDisable(!!e)},!0)},defaultCancelCb:function(){t.$destroy(),i.reject()},button:{"共享":function(e){t.isValid()&&(o.freeze(!0).toggleBtnLoading(!0),r.shareImage(t.regionId,t.image.unImgId,t.account).done(function(){o.hide(),t.$destroy()}).always(function(){o.freeze(!1).toggleBtnLoading(!1).toggleBtnDisable(!1)}).then(i.resolve,i.reject))}}}),i}}),define("modules/cvm/image/util",function(e,t,i){var a={PRIVATE:1,PUBLIC:2,MARKET:3,SHARED:4},s={};[[a.PRIVATE,"自定义镜像"],[a.PUBLIC,"公共镜像"],[a.MARKET,"服务市场"],[a.SHARED,"共享镜像"]].forEach(function(e){s[e[0]]=e[1]}),i.exports={TYPES:a,TYPE_NAMES:s}}),define("modules/cvm/index/index/useless",function(o,e,t){o("$"),o("pageManager"),o("panel");var d=o("router"),i=o("manager"),a=o("appUtil"),c=o("reporter"),l=o("util"),p=o("modules/cvm/main"),s={title:"实例-控制台",pageClass:"",beforeContentRender:function(){return!0===a.isVerifiedOverseas()?(a.setVerifiedOverseasHtml(),!1):!1===a.isVerified()?(a.setUnverifiedHtml(),!1):!a.checkBizWhitelist()||(a.setNoFakeUinHtml(),!1)},render:function(e){var r=arguments;i.getAllWhiteList(function(e){if(e.CVM_REACT_OVERVIEW){if("/cvm"==d.fragment){if(!/^\/cvm/.test(d.referrer)){var t=window.localStorage.getItem("cvm_homepage"+l.getUin())||"index";-1===["overview","index","cbs","image","cdh"].indexOf(t)&&(t="index");var i=d.fragment.replace(/^\/cvm/,"/cvm/"+t);return void d.navigate(i,!1,!0)}if(0!==d.fragment.indexOf("/cvm/index")){i=d.fragment.replace(/^\/cvm/,"/cvm/index");return void d.navigate(i,!1,!0)}}}else if(0!==d.fragment.indexOf("/cvm/index")){i=d.fragment.replace(/^\/cvm/,"/cvm/index");return void d.navigate(i,!1,!0)}var a=e.CVM_APIv3_BlackList;if(a&&0<a.length)p.render.apply(p,r),c.click("yunzhuji.cvm_entry.old");else{var s=e.CVM_ApiToMc,n=e.PrepaidForCVM;s&&s.length&&n&&n.length?(o.async("cvm/index/index",function(e){(p=e).render.apply(p,r)}),c.click("yunzhuji.cvm_entry.apiv3")):(p.render.apply(p,r),c.click("yunzhuji.cvm_entry.old"))}})},destroy:function(){var e=d.fragment;"/cvm"===e||/\/cvm\/index/.test(e)||(this.cvmList&&this.cvmList.destroy&&this.cvmList.destroy(),p&&p.destroy())}};t.exports=s}),define("modules/cvm/overview/cvmstate",function(e,t,i){var a=e("$"),s=e("util"),n=(e("Highcharts"),'    <div class="mod-console">        <div class="mod-console-hd">            <h3>云服务器状态</h3>        </div>        <div class="mod-console-bd">            <div class="dashboard">                <div class="dashboard-chart">                    <div id="statechart" style="width:200px;height:200px;"></div>                </div>                <div class="dashboard-text">                    <div class="status-box">                        <% if(data.safeIsolateNum) {%>                        <div class="status-item">                            <i class="flag-danger"></i> <span data-title="存在主机安全风险的实例">安全隐患实例</span><br><strong class="text-danger num-font"><%= data.safeIsolateNum %></strong> 台                        </div>                        <% } %>                        <% if(data.toRenewNum) {%>                        <div class="status-item">                            <i class="flag-warning"></i> <span data-title="7天内到期实例">7天内到期实例</span><br><strong class="text-warning num-font"><%= data.toRenewNum %></strong> 台                        </div>                        <% } %>                        <% if(data.recycleNum) {%>                        <div class="status-item">                            <i class="flag-warning"></i> <span data-title="回收站实例">回收站实例</span><br><strong class="text-warning num-font"><%= data.recycleNum %></strong> 台                        </div>                        <% } %>                        <div class="status-item">                            <i class="flag-success"></i> <span>正常实例</span><br><strong class="text-success num-font"><%= data.normalNum %></strong> 台                        </div>                    </div>                </div>                            </div>        </div>    </div>');i.exports={render:function(e){var t=this.data=e.cvmData;this.$container=e.container;var i=t.safeIsolateNum+t.toRenewNum+t.normalNum+t.recycleNum;this.$container.html(s.tmpl(n,{data:t})),this.renderChart({id:"statechart",total:i,recyclePrc:t.recycleNum/i,safeIsolatePrc:t.safeIsolateNum/i,toRenewPrc:t.toRenewNum/i,normalPrc:t.normalNum/i})},renderChart:function(e){var t={chart:{plotBackgroundColor:null,plotBorderWidth:0,plotShadow:!1},title:{text:1==e.normalPrc?'<div class="graph-txt"><span class="graph-txt-span"><span class="text-success">正常</span></span></div>':'<div class="graph-txt"><span class="graph-txt-span">您共有<br><strong>'+e.total+"</strong> 台服务器</span></div>",useHTML:!0,floating:!0,style:{display:"block",position:"static",fontFamily:'"Hiragino Sans GB",Tahoma,"microsoft yahei",simsun'}},tooltip:{pointFormat:"",enabled:!1},plotOptions:{pie:{dataLabels:{enabled:!1,style:{fontWeight:"bold",color:"white",textShadow:"0px 1px 2px black"}},size:"120%",startAngle:0,endAngle:360,center:["50%","50%"]}},series:[{type:"pie",name:"cvmstate",innerSize:"83%",data:[{name:"安全故障类",color:"#e1504a",y:e.safeIsolatePrc},{name:"回收站实例",color:"#e1101a",y:e.safeIsolatePrc},{name:"待续费",color:"#ffb800",y:e.toRenewPrc},{name:"正常",color:"#06c290",y:e.normalPrc}]}],credits:{enabled:!1}};a("#"+e.id).highcharts(t)}}}),define("modules/cvm/overview/globalSearch",function(e,t,i){var c=e("$"),a=e("qccomponent"),l=e("constants"),s=(e("appUtil"),e("router")),r=e("models/iaas"),n=e("reporter"),o=a.extend({$tpl:'    <div class="search-box m" b-on="{keydown:onKeyDown}">        <style>            .global-search-current {                background-color:#EAF3FD            }            .global-search-li strong em {                font-weight: inherit            }        </style>        <div class="search-input-wrap" data-title="{{hoverTips}}" >            <textarea b-if="multipleSearch" b-model="keyword" class="tc-15-input-text search-input" placeholder="{{placeholder}}"></textarea>            <input b-if="!multipleSearch" b-model="keyword" b-ref="input" b-on-click="reporterClick(\'yunzhuji.overallsearch.printtimes\')" type="text" class="tc-15-input-text search-input" style="padding-left:10px" maxLength="{{maxInputLength}}" placeholder="{{placeholder}}" />            <a href="javascript:;" b-on-click="clearSearch()" b-if="keyword" role="button" class="btn-rm-txt" title="清空">清空</a>        </div>        <input class="search-btn" type="button" b-on-click="search(keyword)" value="搜索">        <div b-if="showDrop" class="dropdown-menu">            <ul class="dropdown-menu-list" b-style="ulStyle" b-ref="ul" b-on="{scroll:onScroll}">                <li b-repeat="item in list" data-index="{{$index}}" class="global-search-li {{$index == currentIndex ? \'global-search-current\': \'\'}}">                    <a href="javascript:(0)" b-on-click="jumpToDetail(item)">                        <i class="{{item.icon}}"></i>{{>item.desc}}                    </a>                </li>            </ul>            <div class="links">                <a b-if="showMore" href="javascript:;" b-on-click="searchMore()">查看更多结果</a>                <div b-if="isSearching"><i class="n-loading-icon"></i><span class="text">正在搜索</span></div>                <div b-if="isLoading"><i class="n-loading-icon"></i><span class="text">正在加载</span></div>                <div b-if="noResource"><span class="text">没有相关资源！</span></div>                <div b-if="isAll"><span class="text">以上共 <strong>{{totalCount}} </strong> 条搜索结果</span></div>            </div>        </div>    </div>',$afterInit:function(){var i=this;i.$watch("keyword",function(e,t){e=e.trim(),t=t&&t.trim(),e!=t&&(clearTimeout(i.timer),i.timer=setTimeout(function(){i.search(e)},i.searchDelay))})},formatList:function(e){var d=this;return e.forEach(function(e,t){var i,a,s,n,r,o;e.regionId=(i=e,c.each(l.REGIONIDMAP,function(e,t){t==i.region&&(a=e)}),a),e.regionName=(s=e,l.REGIONNAMES[s.regionId]),e.resourceType=e.resourceId.substring(0,3),e.icon={ins:"pd-cloud",eip:"pd-eip",img:"pd-monitor",sg:"pd-safe",skey:"pd-ssh",vpc:"pd-vpc",disk:"pd-cbs"}[e.resourceType],e.link=function(e){var t="/cvm/overview";switch(e.resourceType){case"ins":t="/cvm/detail/"+e.regionId+"/"+e.resourceId;break;case"eip":t="/cvm/eip?rid="+e.regionId+"&eipId="+e.resourceId;break;case"img":t="/cvm/image/detail/"+e.regionId+"/"+e.resourceId;break;case"skey":t="/cvm/sshkey/detail/"+e.resourceId;break;case"sg":t="/cvm/securitygroup/detail/"+e.resourceId+"?rid="+e.regionId;break;case"disk":t="/cvm/cbs/detail?storageId="+e.resourceId+"&rid="+e.regionId;break;case"vpc":t="/vpc/vpc?rid="+e.regionId+"&unVpcId="+e.resourceId}return t}(e),e.desc=(r=("<strong>"+("skey"==(n=e).resourceType?"":n.regionName+"/")+n.resourceId+"</strong>").replace(d.keyword,"<em>"+d.keyword+"</em>"),o=n.searchWord.replace(d.keyword,"<em>"+d.keyword+"</em>"),r+" - "+({ins:"云主机",eip:"弹性公网IP已绑定云主机",img:"镜像所生成云主机",sg:"安全组内实例",skey:"密钥已绑定云主机",vpc:"私有网络内云主机",disk:"云硬盘挂载云主机"}[n.resourceType]+o)+" - "+{ins:"云主机",eip:"弹性公网IP",img:"镜像",sg:"安全组",skey:"密钥",vpc:"私有网络",disk:"云硬盘"}[n.resourceType]+"(<strong>"+n.resourceId+"</strong>)详情")}),e},getList:function(i){var a=this,s=1==i.page?0:(i.page-1)*i.count-a.firstCount,n=i.count;return new Promise(function(t,e){r.apiRequest({regionId:a.regionId,serviceType:"cvm",action:"SearchUserInstance",data:{keyword:i.keyword,offset:s,limit:n},keyword:i.keyword},{v3:!0,camTipsType:"dialog"}).then(function(e){e=e&&e.response||{},t(e)},function(){t({resourceSet:[],totalCount:0,remain:!1})})})},renderList:function(e,s){var n=this;n.page=e.page,n.count=e.count,n.getList(e).then(function(e){var t=n.formatList(e.resourceSet),i=e.totalCount,a=e.remain;n.hideAllTips(),!i||s.replace&&!t.length?n.showNoResource():(s.replace?n.$set("list",t):n.list.splice.apply(n.list,[n.list.length,0].concat(t)),n.$set("totalCount",n.list.length),a&&t.length==n.count?n.showMoreResult():n.showIsAll())})},search:function(e){this.hideAllTips(),e?(this.showDropDown(),this.$set("list",[]),this.showIsSearching(),this.keyword=e,this.renderList({page:this.defaultPage,count:this.firstCount,keyword:e},{replace:!0})):this.clearSearch()},searchMore:function(){this.hideAllTips(),this.showIsLoading(),this.renderList({page:this.page+1,count:this.defaultCount,keyword:this.keyword},{replace:!1})},onScroll:function(e){var t=c(this.$refs.ul);t[0].scrollHeight-t.height()==t[0].scrollTop&&!this.isLoading&&this.$get("showMore")&&this.searchMore()},onKeyDown:function(e){var t=e.keyCode;38!=t&&40!=t||(38==t&&0<this.currentIndex?this.$set("currentIndex",this.currentIndex-1):40==t&&this.currentIndex<this.list.length-1&&this.$set("currentIndex",this.currentIndex+1)),13==t&&s.navigate(this.list[this.currentIndex].link)},jumpToDetail:function(e){this.reporterClick("yunzhuji.overallsearch."+e.resourceType),window.open(e.link)},reporterClick:function(e){n.click(e)},clearSearch:function(){this.$set("keyword",""),this.$set("list",[]),this.$set("totalCount",0),this.$set("page",this.defaultPage),this.$set("pageCount",this.firstCount),this.$set("currentIndex",0),this.hideAllTips(),this.hideDropDown()},showDropDown:function(){this.$set("showDrop",!0)},showIsLoading:function(){this.$set("isLoading",!0)},showIsSearching:function(){this.$set("isSearching",!0)},showMoreResult:function(){this.$set("showMore",!0)},showNoResource:function(){this.$set("noResource",!0)},showIsAll:function(){this.$set("isAll",!0)},hideDropDown:function(){this.$set("showDrop",!1)},hideAllTips:function(){this.$set("isLoading",!1),this.$set("isSearching",!1),this.$set("showMore",!1),this.$set("noResource",!1),this.$set("isAll",!1)},_events:{},$data:{currentClass:"global-search-current",ulStyle:{"max-height":"300px",overflow:"auto"},regionId:1,searchDelay:500,currentIndex:0,defaultPage:1,firstCount:5,defaultCount:10,maxInputLength:60,placeholder:"可跨地域搜索云资源，支持搜索实例ID、IP或名称"}});a.tag("global-search",o),i.exports=o}),define("modules/cvm/overview/overview/useless",function(i,e,t){i("$");var a=i("manager"),s=i("cvm/common/components/SmartHelper"),n=i("modules/cvm/overview/main"),r=i("reporter");t.exports={title:"概览-控制台",pageClass:"",$container:null,render:function(){var t=arguments;a.getAllWhiteList(function(e){e.CVM_APIv3_BlackList||!e.CVM_REACT_OVERVIEW?(n.render.apply(n,t),r.click("yunzhuji.overview.old")):(i.async("cvm/overview/overview",function(e){(n=e).render.apply(n,t)}),r.click("yunzhuji.overview.react"))}),s.show()},destroy:function(){s.destroy()}}}),define("modules/cvm/overview/main",function(e,t,i){var r=e("$"),n=e("util"),a=e("appUtil"),o=e("pageManager"),d=e("manager"),c=(e("models/api"),e("./cvmstate")),l=e("./netflow"),p=e("./unnormal"),u=e("./resourcequota"),m=(e("router"),e("cvm/common/components/SmartHelper")),s=e("cvm/common/model"),h=e("models/iaas"),v={main:'  <div id="cvmDashboardWrapper" class="manage-area console">      <div class="manage-area-title">          <h2>云服务器概览</h2>      </div>      <div class="manage-area-main">      </div>  </div>',list:'  <div>      <div class="tc-g">        \x3c!-- 云服务器状态 --\x3e          <div id="cvmstate" class="tc-g-u-1-2">          </div>         \x3c!-- 公网流量监控 --\x3e          <div id="netflow" class="tc-g-u-1-2">          </div>      </div>      \x3c!-- 安全故障 和 待续费 --\x3e      <div id="unnormal" class="tc-g">      </div>      \x3c!-- 资源数量与配额 --\x3e      <div id="resourceQuota" class="tc-g">      </div>      \x3c!-- 产品动态和帮助 --\x3e      <div id="productNews" class="tc-g">          <div class="tc-g-u-2-3">              <div class="mod-console">                  <div class="mod-console-hd">                      <h3>产品动态</h3>                      <div class="more-info" style="display: none;">                          <a href="">更多</a>                      </div>                  </div>                  <div class="mod-console-bd">                      <ul class="mod-text-list file-list">                            <li>                                    <div class="item-title"><a href="//cloud.tencent.com/act/southwest?from=consolecvm1" target="_blank"> 云服务器3折特惠，最新机型全行业计算提速，高性价比首选</a></div>                                    <div class="item-meta">2018-06-22</div>                                </li>                        <li>                            <div class="item-title"><a href="https://cloud.tencent.com/act/event/CVMPriceCut.html" target="_blank">云服务器全系列降价，最高降幅达 40 %</a></div>                            <div class="item-meta">2017-11-29</div>                        </li>                                \x3c!-- <li>                                    <div class="item-title"><a href="https://cloud.tencent.com/act/event/cloud-first-purchase.html" target="_blank">云服务器新购特惠，超值活动价 0.73元/天起</a></div>                                    <div class="item-meta">2017-11-27</div>                                </li> --\x3e                                <li>                                    <div class="item-title"><a href="https://cloud.tencent.com/act/event/25g-network-card.html" target="_blank">25G网卡云服务器震撼发布</a></div>                                    <div class="item-meta">2017-06-20</div>                                </li>                          <li>                              <div class="item-title"><a href=" https://'+QCMAIN_HOST+'/act/event/meixi.html" target="_blank">硅谷数据中心重磅开服，全球化布局助力企业出海</a></div>                              <div class="item-meta">2017-03-13</div>                          </li>                      </ul>                  </div>              </div>          </div>          <div class="tc-g-u-1-3">              <div class="mod-console">                  <div class="mod-console-hd">                      <h3>云服务器相关指引</h3>                      <div class="more-info" style="display: none;">                          <a href="">更多</a>                      </div>                  </div>                  <div class="mod-console-bd">                      <ul class="mod-text-list file-list">                          <li>                              <div class="item-title"><a href="http://manage.qcloud.com/recommended/index.php" target="_blank">如何选择适合我的云服务器？</a></div>                          </li>                          <li>                              <div class="item-title"><a href="https://'+QCMAIN_HOST+'/act/event/recommand.html" target="_blank">买服务器听大家的，80%的云上用户首选</a></div>                          </li>                          <li>                              <div class="item-title"><a href="https://'+QCBUY_HOST+'/calculator/cvm" target="_blank">云服务器价格计算器，资源预算清单一目了然</a></div>                          </li>                          <li>                              <div class="item-title"><a href="https://'+QCMAIN_HOST+'/document/product/213/8044" target="_blank">教您轻松搭建WordPress个人站点</a></div>                          </li>                      </ul>                  </div>               </div>          </div>      </div>  </div>',empty:'  <div class="console-empty">      <div class="product-intro-img">          <img src="https://imgcache.qq.com/open_proj/proj_qcloud_v2/mc_2014/server/css/img/empty.png" alt="">      </div>      <div class="empty-text">         <div><strong>您目前还没有云服务器</strong></div>         <div class="product-intro-text">             <p>云服务器是高性能高稳定的云虚拟机，可在云中提供大小可调的计算容量，降低对计算规模预估的难度；<br> 您可轻松购买自定义配置机型，并根据您的需要使用镜像进行快速的扩容</p>         </div>         <div class="call-to-action">             <button type="button" id="buy" class="tc-15-btn">购买云服务器</button>             <p style="margin-top:10px">云服务器3折特惠，最新机型全行业计算提速，高性价比首选 <a href="//cloud.tencent.com/act/southwest?from=consolecvm1"> 立即抢购 <i class="external-link-icon"></i></a></p>         </div>      </div>  </div>',notice:'    <% if(data.length){ %>      <div id="noticeBox" class="tc-15-msg mb20">          <div class="tc-15-msg-txt">              <% for(var i=0,item; item=data[i]; i++){ %>                <p class="notice-item" data-ntime="<%=item.addTime%>"><%= (i+1)+"." %><%= item.content %><% if (item.globalUrl) { %><a href="<%=item.globalUrl%>" class="guide-link" target="_blank">查看详情<b class="external-link-icon"></b></a><% } %></p>              <% } %>          </div>          <a class="notice-btn-close" href="javascript:;" title="关闭">关闭</a>      </div>    <% } %>'};i.exports={title:"概览-控制台",pageClass:"",$container:null,render:function(){var s,n=this;o.appArea.html(v.main),this.$container=r("#cvmDashboardWrapper"),this.getData().then(function(e){if(s=n.$container.find(".manage-area-main"),data=e[0].data,data){var t=e[1],i=t&&t.response&&t.response.instanceStatisticsSet||[],a=0;i.forEach(function(e){0<e.expiredInstanceCount&&(a+=e.expiredInstanceCount)}),data.recycleNum=a,data.safeIsolateNum||data.toRenewNum||data.normalNum||a?(s.html(v.list),c.render({container:s.find("#cvmstate"),cvmData:data}),l.render({container:s.find("#netflow")}),p.render({container:s.find("#unnormal"),cvmData:data,page:1,count:5}),u.render({container:s.find("#resourceQuota")}),setTimeout(function(){n.renderNotice()},1e3)):s.html(v.empty)}}),this.bindEvent(),m.show()},bindEvent:function(){this.$container.on("click","#buy",function(e){var t="https://"+QCBUY_HOST+"/cvm";location.href=t})},getData:function(){return Promise.all([h.apiRequest({serviceType:"cvm",cmd:"GetAppCvmOverviewStatistics",data:{appId:a.getAppId()},regionId:1}),s.apiRequest({serviceType:"cvm",cmd:"DescribeInstanceStatistics",regionId:1})])},renderNotice:function(){var i=this,t="",a=null,s=this.$container.find(".manage-area-main");d.getCVMNotice(function(e){i.pageActive&&e.length&&!r("#noticeBox").length&&(e=i.filterNoticeData(e),t=n.tmpl(v.notice,{data:e}),s.prepend(t),(a=r("#noticeBox")).on("click",".notice-btn-close",function(e){a.find(".notice-item").each(function(e,t){i.setIgnoreNoticeData(r(t).attr("data-ntime"))}),a.remove()}))})},filterNoticeData:function(e){e=e||[];var t=this.getIgnoreNoticeData();return e.filter(function(e){return!t[e.addTime]})},getIgnoreNoticeData:function(){var e=localStorage.getItem("CVM_NOTICE_IGNORE")||"{}";return r.parseJSON(e)},setIgnoreNoticeData:function(e){var t=this.getIgnoreNoticeData();t[e]=1,localStorage.setItem("CVM_NOTICE_IGNORE",JSON.stringify(t))},destroy:function(){m.destroy()}}}),define("modules/cvm/overview/netflow",function(e,t,i){var d=e("$"),a=e("util"),s=e("manager"),n=e("router"),r='    <div class="mod-console">        <div class="mod-console-hd">            <h3>公网流量监控</h3>        </div>        <div class="mod-console-bd">            <div id="netflowchart" class="flow-monitor">              \x3c!--   <p>2016-05-24 20:30实时数据:</p>                <p><strong class="num-font text-primary">6.053</strong> <span class="text-weak">Mbps</span></p>                <div class="chart-box">                    <img src="css/img/line-chart.png" alt="" style="height:100%; width:100%;">                </div> --\x3e            </div>        </div>    </div>',c='  <style>  .netflow-legend{    position: absolute;    font-size: 12px;    color:#454a51;    right: 0;    top:5px;  }  .legend-item{    float: left;    margin-right:10px;  }  .legend-item div{    width:20px;    height:2px;    float: left;    margin-right:4px;    margin-top:3px;  }  </style>  <div class="netflow-legend">    <div class="legend-item">      <div style="background-color:#0272CE"></div>      实时    </div>    <div class="legend-item">      <div style="background-color:#BCDAF2"></div>      上周同天    </div>  </div>';i.exports={render:function(e){var t=this;t.$container=e.container,t.$container.html(a.tmpl(r,{})),function i(){var t=d.Deferred();return s.getNetworkFlow(function(e){e.peakFlow,t.resolve(e)},function(){t.resolve(null)}),t}().then(function(e){e?t.renderChart({data:e,id:"netflowchart",click:function(){n.navigate("/monitor/flow")}}):d("#netflowchart").html('<div style="margin: auto; width: 200px; padding-top: 50px;">暂无数据</div>')})},renderChart:function(e){var t=e.data,i=t.category||[],a=t.data1||{},s=t.data2||{},n=e.click,r={chart:{backgroundColor:"rgba(0,0,0,0)",events:{click:function(){n&&n()}},style:{cursor:"pointer"}},credits:{enabled:!1},title:{text:"",align:"center",y:16,style:{color:"#454a51",fontSize:"14px",fontWeight:"bold",fontFamily:"Hiragino Sans GB,Tahoma,microsoft yahei,simsun"}},subtitle:{text:"subtitle",style:{color:"#fff"}},xAxis:{lineWidth:1,gridLineWidth:1,gridLineColor:"#E2E5EB",lineColor:"#E2E5EB",tickInterval:48,tickColor:"#fff",categories:i,labels:{style:{color:"#7f90a0",textOverflow:"none"},formatter:function(){return this.value}}},yAxis:{title:{text:""},lineWidth:1,gridLineWidth:0,gridLineColor:"#e6e8ed",lineColor:"#fff",tickPixelInterval:30,min:0,labels:{enabled:!1,style:{color:"#7f90a0"}}},tooltip:{enabled:!0,crosshairs:{width:1,color:"#333"},formatter:function(){var i="<b>"+this.x+"</b>";return d.each(this.points,function(e,t){i+='<br/><span style="color:'+t.series.color+'">●</span> '+t.series.name.substr(5)+': <span style="color:#e1504a">'+t.y+"Mbps</span>"}),i},positioner:function(e,t,i){var a=d("#contChartNetflow").width(),s=i.plotX;return s<=e?s+=20:a-e<=s?s-=e:s+=20,{x:s,y:i.plotY}},borderColor:"#aaa",shadow:!1,shared:!0},legend:{enabled:!1},plotOptions:{spline:{states:{hover:{enabled:!1,lineWidth:1}},marker:{enabled:!1,states:{hover:{enabled:!1}}}},areaspline:{states:{hover:{enabled:!1,lineWidth:1}},marker:{enabled:!1,states:{hover:{enabled:!1}}}}},series:[{name:s.name,data:s.data,type:"spline",color:"#BCDAF2",lineWidth:1.4},{name:a.name,data:a.data,type:"spline",lineColor:"#0272CE",lineWidth:1.4}]},o=d("#"+e.id);o.highcharts(r),o.append(c)}}}),define("modules/cvm/overview/resourcequota",function(e,t,i){var p=e("$"),a=e("util"),s=e("appUtil"),n=e("models/iaas"),c=e("constants"),u=e("config/regionconfig"),r=e("./globalSearch"),o=e("widget/popover/popTips"),d='    <div class="tc-g-u-1">        <div class="mod-console">            <div class="mod-console-hd">                <h3><span data-title="本模块展示资源数量与配额均为主账号下的总数量与配额">资源数量与配额</span></h3>                <div class="more-info">                    <a href="https://console.qcloud.com/workorder/category/create?level1_id=6&level2_id=7&level1_name=%E8%AE%A1%E7%AE%97%E4%B8%8E%E7%BD%91%E7%BB%9C&level2_name=%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8%20CVM" data-title="如需更高配额，请点击申请<br>目前仅支持包年包月云服务器配额提升，其他产品配额申请请等待官方通知">申请配额</a>                </div>            </div>            <div class="mod-console-bd">                <div id="globalSearch" style="position:relative"></div>                <div class="tc-g mod-bar-graph">                <% for(var i=0; i < data.length; i++) {%>                    <div class="tc-g-u-1-2">                        <div class="mod-graph">                            <div class="mod-graph-hd">                                <h4> <a href="/cvm?rid=<%- data[i].regionId%>" target="_blank"><%= data[i].regionName%></a></h4>                            </div>                            <div class="mod-graph-bd">                                <table class="mod-graph-list">                                  <tbody>                                    <% if(data[i].prepayQuotaList){                                         var prepayQuotaList = data[i].prepayQuotaList;                                        for(var j = 0,len = prepayQuotaList.length; j<len; j++ ){                                    %>                                    <tr class="span-row">                                        <% if(j==0) { %>                                        <td class="item-dt" rowspan="<%= prepayQuotaList.length%>">云服务器(包年包月) <i class="icon-question" data-title="云服务器包年包月配额为每月固定配额，仅计算当月该可用区新购云服务器台数"></i></td>                                        <% } %>                                        <% if(prepayQuotaList[j].cvmQuota) {%>                                        <td class="item-dd-bar">                                            <div class="item-dt-subtitle"><%= prepayQuotaList[j].zoneName %></div>                                            <div class="mod-progress"><span class="mod-bar" style="width:<%=prepayQuotaList[j].ratio*100 %>%;"></span></div>                                        </td>                                        <td class="item-dd">                                            <div class="cell-box"><%=prepayQuotaList[j].currentNum %>/<%=prepayQuotaList[j].cvmQuota %> 台 </div>                                        </td>                                        <% } %>                                    </tr>                                    <% } } %>                                                                        <% if(data[i].quotiesQuotaList){                                         var quotiesQuotaList = data[i].quotiesQuotaList;                                        for(var j = 0,len = quotiesQuotaList.length; j<len; j++ ){                                    %>                                    <tr class="span-row">                                        <% if(j==0) { %>                                        <td class="item-dt" rowspan="<%= quotiesQuotaList.length%>">云服务器(按量计费) <i class="icon-question" data-title="云服务器按量计费配额为用户固定配额，计算该可用区云服务器总台数"></i></td>                                        <% } %>                                        <% if(quotiesQuotaList[j].cvmQuota) {%>                                        <td class="item-dd-bar">                                            <div class="item-dt-subtitle"><%= quotiesQuotaList[j].zoneName %></div>                                            <div class="mod-progress"><span class="mod-bar" style="width:<%=quotiesQuotaList[j].ratio*100 %>%;"></span></div>                                        </td>                                        <td class="item-dd">                                            <div class="cell-box"><%=quotiesQuotaList[j].currentNum %>/<%=quotiesQuotaList[j].cvmQuota %> 台 </div>                                        </td>                                        <% } %>                                    </tr>                                    <% } } %>                                    <% if(data[i].imageQuotaList && data[i].imageQuotaList.quotaNum){ %>                                    <tr>                                        <td class="item-dt">自定义镜像</td>                                        <td class="item-dd-bar">                                            <div class="mod-progress"><span class="mod-bar" style="width:<%=data[i].imageQuotaList.ratio*100 %>%;"></span></div>                                        </td>                                        <td class="item-dd">                                            <div class="cell-box"><%=data[i].imageQuotaList.currentNum %>/<%=data[i].imageQuotaList.quotaNum %> 个</div>                                        </td>                                    </tr>                                    <% } %>                                    <% if(data[i].snapQuotaList && data[i].snapQuotaList.quotaNum){ %>                                    <tr>                                        <td class="item-dt">快照 <i class="icon-question" data-title="目前快照功能处于免费试用期。最多可创建 （云硬盘数 ×7）个快照"></i></td>                                        <td class="item-dd-bar">                                            <div class="mod-progress"><span class="mod-bar" style="width:<%=data[i].snapQuotaList.ratio*100 %>%;"></span></div>                                        </td>                                        <td class="item-dd">                                            <div class="cell-box"><%=data[i].snapQuotaList.currentNum %>/<%=data[i].snapQuotaList.quotaNum %> 个</div>                                        </td>                                    </tr>                                    <% } %>                                </tbody>                              </table>                            </div>                        </div>                    </div>                <% } %>                </div>            </div>        </div>    </div>',l="    <div>        <ul>            <li>1.支持实例ID 、IP地址、名称的精确/模糊搜索</li>            <li>2.支持跨地域精确/模糊搜索与实例相关联的镜像和弹性公网IP</li>            <li>3.更多关联资源，请期待功能升级</li>        </ul>    </div>",m=function(e,t){var i,a=u.getData()[t].zone,s={};for(var n in e){for(var r=0,o=(i=e[n]).length;r<o;r++)i[r].regionId!=t||i[r].zoneId?i[r].zoneId&&a[i[r].zoneId]&&(s[n]=s[n]||[],s[n].push(p.extend({zoneName:a[i[r].zoneId].name},i[r]))):s[n]=i[r];if(s[n]&&s[n].sort&&s[n].length){var d=[];for(var c in a)for(var l=0;l<s[n].length;l++)s[n][l].zoneId==c&&d.push(s[n][l]);s[n]=d}}return s};i.exports={render:function(e){var t=this;t.$container=e.container,t.getData().done(function(e){e=function(i){var a,s=u.getData(),n=[];p.each(c.REGIONORDER,function(e,t){s[t]&&(a=m(i,t),p.isEmptyObject(a)||n.push(p.extend({regionId:t,regionName:s[t].name},a)))});for(var e=0;e<n.length;e++){var t,r=n[e];if(r.imageQuotaList&&(0<(t=r.imageQuotaList).quotaNum?t.ratio=t.currentNum>t.quotaNum?1:t.currentNum/t.quotaNum:t.ratio=0),r.prepayQuotaList&&0<r.prepayQuotaList.length){t=r.prepayQuotaList;for(var o=0;o<t.length;o++)0<t[o].cvmQuota?t[o].ratio=t[o].currentNum>t[o].cvmQuota?1:t[o].currentNum/t[o].cvmQuota:t[o].ratio=0}if(r.quotiesQuotaList&&0<r.quotiesQuotaList.length){t=r.quotiesQuotaList;for(var d=0;d<t.length;d++)0<t[d].cvmQuota?t[d].ratio=t[d].currentNum>t[d].cvmQuota?1:t[d].currentNum/t[d].cvmQuota:t[d].ratio=0}r.snapQuotaList&&(0<(t=r.snapQuotaList).quotaNum?t.ratio=t.currentNum>t.quotaNum?1:t.currentNum/t.quotaNum:t.ratio=0),n[e]=r}return n}(e=e.data),t.$container.html(a.tmpl(d,{data:e})),t.renderGlobalSearch()})},getData:function(){var t=p.Deferred();return n.apiRequest({serviceType:"cvm",cmd:"GetAppCvmQuotaOverview",data:{appId:s.getAppId()}}).then(function(e){t.resolve(e)},function(e){t.reject(e)}),t},renderGlobalSearch:function(){var e=new r;this.globalSearch=e,this.$container.find("#globalSearch").html(e.$el),this.renderGlobalSearchTips(e)},renderGlobalSearchTips:function(e){var t=parseInt(localStorage.getItem("showGlobalSearchCount"));if(t=isNaN(t)?10:t,e&&0<t){var i=p(e.$el);this.getGlobalSearchPopTips({target:i,defaultShow:!0,hideCloseIcon:!1,onHide:function(){var e=parseInt(localStorage.getItem("showGlobalSearchCount"));e=isNaN(e)?10:e,localStorage.setItem("showGlobalSearchCount",--e)}})}},getGlobalSearchPopTips:function(e){return o({target:e.target,title:"跨地域搜索云资源，现在上线！",content:l,defaultShow:e.options,hideDelay:e.hideDelay||5e3,hideCloseIcon:e.hideCloseIcon,persist:!0,onHide:e.onHide},{style:{"max-width":450,width:450,top:-155,left:300},position:"auto"})}}}),define("modules/cvm/overview/unnormal",function(e,t,i){var n=e("$"),a=e("util"),d=e("appUtil"),s=e("constants"),r=e("manager"),o=e("models/iaas"),c='    <% if(unsafe && renew){ %>     <div class="tc-g-u-1-3">        <div class="mod-console">            <div class="mod-console-hd">                <h3><span data-title="存在主机安全风险的实例">安全风险隐患云服务器</span></h3>                <div class="more-info">                    <a href="https://console.qcloud.com/workorder/category" target="_blank" data-title="云服务器由于安全风险外网已被隔离，请尽快处理安全风险<br>解除风险后提交工单给我们确认执行结果。">提交工单</a> <a href="javascript:void(0);" data-title="电话联系：95716">联系客服</a>                </div>            </div>            <div id="unsafeCvmList" class="mod-console-bd">            </div>        </div>    </div>    <div class="tc-g-u-2-3">        <div class="mod-console">            <div class="mod-console-hd">                <h3><span data-title="7天内到期实例">待续费云服务器</span></h3>                <div class="more-info">                    <a href="https://console.qcloud.com/account/renewal" target="_blank">续费管理</a>                </div>            </div>            <div id="renewCvmList" class="mod-console-bd">            </div>        </div>    </div>    <% }else if(unsafe){ %>      <div class="tc-g-u-1">          <div class="mod-console">              <div class="mod-console-hd">                  <h3><span data-title="存在主机安全风险的实例">安全风险隐患云服务器</span></h3>                  <div class="more-info">                      <a href="https://console.qcloud.com/workorder/category" target="_blank" data-title="云服务器由于安全风险外网已被隔离，请尽快处理安全风险<br>解除风险后提交工单给我们确认执行结果。">提交工单</a> <a href="javascript:void(0);" data-title="电话联系：95716">联系客服</a>                  </div>              </div>              <div id="unsafeCvmList" class="mod-console-bd">              </div>          </div>      </div>    <% }else if(renew){ %>      <div class="tc-g-u-1">        <div class="mod-console">            <div class="mod-console-hd">                <h3><span data-title="7天内到期实例">待续费云服务器</span></h3>                <div class="more-info">                    <a href="https://console.qcloud.com/account/renewal" target="_blank">续费管理</a>                </div>            </div>            <div id="renewCvmList" class="mod-console-bd">            </div>        </div>      </div>    <% } %>',l={renew:{main:e("modules/cvm2/event/renew/renew"),name:"续费"}},p=a.tmpl('    <div class="id-name-cell">        <p>            <% if (item.uInstanceId) { %>                <a data-event="nav" href="/cvm/index?rid=<%- item.regionId %>&instanceId=<%- item.uInstanceId %>"><%- item.uInstanceId%></a>            <% } %>        </p>        <p>            <span class="text-overflow" title="<%= item.alias%>">                <%= item.alias %>            </span>        </p>    </div>',null),u=a.tmpl('    <div class="cvm-oper-cell" style="white-space:nowrap">        <a data-name="renew" data-event="cvm_oper_action" href="/cvm/index?rid=<%- item.regionId %>&instanceId=<%- item.uInstanceId %>">续费</a>    </div>',null);i.exports={render:function(e){this.$container=e.container,this.initGridView(),this.bindEvent(),this.renderList(e)},renderList:function(e){var t=e.cvmData.safeIsolateNum||0,i=e.cvmData.toRenewNum||0;this.$container.html(a.tmpl(c,{unsafe:0<t,renew:0<i})),0<t&&(this.unsafeCvmListEl=n("#unsafeCvmList"),this.renderUnsafeList(e)),0<i&&(this.renewCvmListEl=n("#renewCvmList"),this.renderRenewList(e))},renderUnsafeList:function(a){var s=this;n.when(s.getData({appId:d.getAppId(),deviceType:"safeIsolate",count:+a.count,page:+a.page}),s.getCvmWhiteList(["PrepaidForCVM","CVM_bandwidtd"])).done(function(e,t){var i=t.PrepaidForCVM&&0<t.PrepaidForCVM.length;e=e.data,s.isPrepaidUser=i,s.unsafeListData=s.dataformat(e.deviceList),s.unsafeCvmListEl.append(s.unsafeGridView.$el),s.unsafeGridView.checkCellWidth(),s.unsafeGridView.setData({list:s.unsafeListData,totalNum:e.totalNum,page:+a.page,count:+a.count,orderField:a.orderField||"addTimeStamp",order:a.order}),s.unsafePromise.resolve()})},renderRenewList:function(a){var s=this;n.when(s.getData({appId:d.getAppId(),deviceType:"toRenew",count:+a.count,page:+a.page}),s.getCvmWhiteList(["PrepaidForCVM","CVM_bandwidtd"])).done(function(e,t){var i=t.PrepaidForCVM&&0<t.PrepaidForCVM.length;e=e.data,s.isPrepaidUser=i,s.renewListData=s.dataformat(e.deviceList),s.renewCvmListEl.append(s.renewGridView.$el),s.renewGridView.checkCellWidth(),s.renewGridView.setData({list:s.renewListData,totalNum:e.totalNum,page:+a.page,count:+a.count,orderField:a.orderField||"addTimeStamp",order:a.order}),s.renewPromise.resolve()})},getData:function(e){var t=+e.count,i=t*(+e.page-1),a=n.Deferred();return o.apiRequest({serviceType:"cvm",cmd:"GetAppCvmOverviewDeviceList",data:{appId:d.getAppId(),deviceType:e.deviceType,startNum:i,endNum:i+t-1}}).then(function(e){a.resolve(e)},function(e){a.reject(e)}),a},getCvmWhiteList:function(e){var t=n.Deferred();return r.getAllWhiteList(function(e){t.resolve(e)},function(e){t.reject(e)}),t},exec:function(e){new l[e].main({listIns:this})},initGridView:function(){var e=Bee.getComponent("grid-view");this.unsafeGridView=new e(this.getGridViewOPtions("unsafe")),this.unsafePromise=n.Deferred(),this.renewGridView=new e(this.getGridViewOPtions("renew")),this.renewPromise=n.Deferred()},getGridViewOPtions:function(i){var a=this;return{$data:{hasFirst:!1,order:1,initGetData:!1,minHeight:"auto",autoMaxHeight:!1,colums:this.getColumns(i)},getCellContent:function(e,t,i){return a.getCellContent(e,t,i)},getData:function(e,t){("unsafe"==i?a.renderUnsafeList:a.renderRenewList).call(a,e)}}},getColumns:function(e){var t,i=[];for(var a in t="unsafe"==e?{idName:{name:"ID/主机名",minWidth:200,required:!0},regionName:{name:"地域",required:!0}}:{idName:{name:"ID/主机名",minWidth:200,required:!0},regionName:{name:"地域",required:!0},cvmPayModeDesc:{name:"主机计费模式",defaults:!0},_operCol:{name:"操作",required:!0}}){var s=t[a],n={key:a,name:s.name,width:s.width,order:s.sort,orderField:s.orderField,locked:s.locked,hide:!s.defaults&&!s.required,required:s.required,minWidth:s.minWidth};i.push(n)}return i},getCellContent:function(e,t,i){switch(i.key){case"idName":return p({item:t});case"regionName":return s.REGIONNAMES[t.regionId];case"cvmPayModeDesc":return"<div><p>"+t.cvmPayModeDesc+"</p><p>"+t.cvmPayModeTimeDesc+"</p></div>";case"_operCol":return u({item:t});default:return'<span class="text-overflow" title="'+e+'">'+(e||"")+"</span>"}},dataformat:function(e){var i=this;return n(e).each(function(e,t){i.cvmPayModeDesc(t)}),e},cvmPayModeDesc:function(e){var t="包年包月",i=[];if(e.cvmPayMode===s.CVMPAYMODE.CDHPAID)t="不计费",i.push('<p><span class="text-overflow" >到期时间: 无</span></p>');else if(e.cvmPayMode===s.CVMPAYMODE.SECOND)t="按量计费",e.addTimeStamp&&i.push("<p>"+d.formatDate(d.getDate(e.addTimeStamp),"yyyy-MM-dd")+"创建</p>");else if(this.isPrepaidUser){var a=this.deadlineInfoAndStatus(e);"-"!=a&&(0==e.deadlineStatus?i.push(a+"到期"):i.push(a))}else t="后付费";e.cvmPayModeDesc=t,e.cvmPayModeTimeDesc=i.join("")},deadlineInfoAndStatus:function(e,t){var i,a=e.deadline||"0000-00-00 00:00:00",s=new Date(a.replace(/\-/g,"/")),n="";i=(t&&!isNaN(t)?t:(new Date).getTime())-s.getTime();var r,o=0;"0000-00-00 00:00:00"==a?(n="-",o=3):o=0<i?(n=(r=Math.floor(i/864e5))<1?'<span class="text-overflow status-recover error">已过期1天</span>':'<span class="text-overflow status-recover error">已过期'+r+"天</span>",1):i<-6048e5?(n=d.formatDate(d.getDate(a),"yyyy-MM-dd"),0):(n=(r=Math.floor(Math.abs(i/864e5)))<1?'<span class="text-overflow warning">小于1天到期</span>':'<span class="text-overflow warning">'+r+"天后到期</span>",2);return e.deadlineStatus=o,e.deadlineInfo=n},setEqualHeight:function(){var i=this,a=0;n.when(i.unsafePromise,i.renewPromise).done(function(){if(i.unsafeCvmListEl.length&&i.renewCvmListEl.length){var e=i.unsafeGridView.$gridBody,t=i.renewGridView.$gridBody;(a=Math.max(e.height(),t.height()))&&(e.height(a),t.height(a))}})},bindEvent:function(){this.setEqualHeight()}}}),define("modules/cvm/recycle/cbs/cbs",function(e,t,i){var r=e("$"),s=e("pageManager"),a=(e("manager"),e("util")),n=e("appUtil"),o=(e("event"),e("projectsSelector")),d=e("widget/region/region2"),c=e("widget/fieldsManager/gridView"),l=e("modules/cvm/cbs/cbs/data"),p=(e("tips"),e("modules/cvm/recycle/renew_cbs")),u=e("modules/cvm/cbs/cbsutil"),m=(e("models/api"),e("search"),e("router"),e("reporter"),e("qccomponent"));var h={param:{},title:"云硬盘-控制台",pageClass:"",render:function(e,t){var i=this;s.appArea.html(' <div>        <div class="manage-area">            <div class="manage-area-title with-bottom-border">                <h2>云硬盘</h2>                <div id="projectsWrapper" class="tc-select-box"></div>                <div id="regionWrapper" class="tc-select-box"></div>            </div>            <div class="manage-area-main">                <div class="tc-15-tab tc-15-tab-alt trash-tab">                    <div class="tab-panel"><div class="tc-15-msg with-margin">到期7天后仍未续费的云硬盘，会在回收站中保留7天，这期间您可以续费进行恢复。7天后，这些云硬盘会被彻底销毁，不可恢复。</div><div id="operArea"><div class="tc-15-action-panel">    <button class="tc-15-btn weak m setting" data-event="set_Fields" title="设置列表显示字段" data-hot="yunzhuji.setfields" data-grid-setting="true">    </button>    <div id="searchArea" class="pull-right"></div></div><div id="cbsList" style="position:relative"></div></div></div>                </div>            </div>        </div>    </div>'),this.getProjectId=n.getProjectId.bind(n),this.getRegionId=n.getRegionId.bind(n),t&&t.storageIds&&(t.storageIds=t.storageIds.split(",")),this.param=r.extend(function a(){return r.extend({page:1,count:20,projectId:null,regionId:null,storageIds:""},!0)}(),t,!0),this.projectsAreaEl=r("#projectsArea"),this.searchAreaEl=r("#searchArea"),this.projectsWrapperEl=r("#projectsWrapper"),this.regionWrapperEl=r("#regionWrapper"),this.cbsListEl=r("#cbsList"),this.projectsSelector=new o({renderTo:this.projectsWrapperEl,selectedId:n.getProjectId(),change:function(){i.renderList()}}),this.regionSelector=new d({renderTo:this.regionWrapperEl,selectedId:n.getRegionId(),change:function(){i.renderList()}}),this.bindEvent(),this.renderBtnGroup(),this.initGridView(),this.renderList(this.param)},bindEvent:function(){var e=this;r("#operArea").find("[data-event=set_Fields]").click(function(){e.gridView.showFieldsManager()})},initGridView:function(){var a=this,e={$data:{hasFirst:!1,orderField:"addTimeStamp",order:1,initGetData:!1,canResizeColum:!0,selectedHighlight:!1,colums:a.getColumns(),list:[],canSelectTotal:!1,autoMaxHeight:!0,maxHeightOffset:10,autoCheckWidth:!1,showState:!0,showPagination:!0,totalNum:0,trackKey:"uuid",searchItemName:"云主机"},$mixins:[c("recycle_cbs_fields")],getCellContent:function(e,t,i){return a.getCellContent(e,t,i)},setTrAttr:function(e,t){return{"data-storageId":t.storageId}},getSlectItem:function(t){var s=[];if(r(a.gridView.list).each(function(e,a){r(t).each(function(e,t){var i=r(t).closest("tr").data("storageid");a.storageId==i&&s.push(a)})}),0<s.length)return s},events:{"click tr [data-event=renew]":function(e){var t=a.gridView.getSlectItem(e.target);p.init(t,{projectId:a.getProjectId(),regionId:a.getRegionId()})}},getData:function(e,t){this.page=e.page,this.count=e.count,a.renderList()}},t=m.getComponent("grid-view");a.gridView=new t(e),this.param.storageIds&&this.search.$set("keyword",this.param.storageIds.join("\n"))},renderBtnGroup:function(){var e=this;this.searchAreaEl=r("#searchArea");var t=m.components["qc-search"],i=this.search=new t({$data:{keyword:"",searchEmpty:!0,multiple:!0,placeholder:"请输云硬盘ID(换行分隔)"},search:function(){e.gridView.page=1,e.gridView.count=20,e.renderList()}});this.searchAreaEl.html("").append(i.$el)},getFilter:function(e){var t=this.search.getKeyword().replace(/\s+/,"\n").split("\n"),i=[];t=r(t).each(function(e,t){t&&i.push(t)}),0==i.length&&(i=null);var a=e&&0<e.page?e.page:this.gridView.page,s=e&&0<e.count?e.count:this.gridView.count;e={offset:(a-1)*s,limit:s,projectId:this.getProjectId(),regionId:this.getRegionId(),storageIds:i};for(var n in e)null==e[n]&&delete e[n];return-1==e.projectId&&delete e.projectId,e},renderList:function(a){var s=this;a=this.getFilter(a);r.when(l.queryCbsStoragesForRecycle(a),l.queryZone(this.getRegionId({}))).done(function(e,t){var i=s.formateData(e.storageSet,t);s.cbsListEl.append(s.gridView.$el),s.gridView.checkCellWidth(),s.gridView.setData({list:i,totalNum:e.totalCount,page:Math.floor(a.offset/a.limit)+1,count:a.limit}),i&&0<i.length||s.gridView.showTips('<span class="text"></span>您查看的对象已不存在或没有权限查看')}).fail(function(){s.gridView.setData({list:[],totalNum:0,page:a.page,count:a.count}),s.gridView.checkCellWidth(),s.gridView.showTips("系统繁忙，请稍后重试。")})},formateData:function(e,t){var s=h,n={};return t.forEach(function(e){n[e.zoneId]=e.zoneName}),r(e).each(function(e,t){var i=u.getCbsMetaByValue(t.storageType);t.diskTypeDesc="root"==t.diskType?"系统盘":"数据盘",t.storageTypeDesc=i.name,t.payModeDesc="prePay"==t.payMode?"包年包月":"按小时计费",t.isRenew=!1,1==t.portable&&(t.isRenew=!0),t.storageSizeDesc=t.storageSize+"G";var a=t.zoneId;t.zoneName=n[a]||a,t.deadlineTimeDesc=function d(e,t){var i=new Date(e.replace(/\-/g,"/")),a=0,s="-",n=t&&!isNaN(t)?t:(new Date).getTime();if(a=n-i.getTime(),"0000-00-00 00:00:00"!=e)if(a<12096e5&&6048e5<=a){var r=(14-(a=a.toFixed(2)-0)/864e5).toFixed(2).split("."),o="";if(r[1]){var o=(r[1]/100*24).toFixed(0)-0;o=0<o?o+"小时":""}s='<span class="text-overflow text-danger">'+r[0]+"天"+o+"后销毁</span>"}else s='<span class="text-overflow status-recover">已销毁</span>';return s}(t.deadlineTime),t.regionId=s.getRegionId(),t.statusDesc="已隔离",t.statusDesClass="danger",t.attachedDesc=1==t.portable?"支持":"不支持"}),e},getCellContent:function(e,t,i){return"storageId"==i.key?a.tmpl('<div><p><%=storageId%></p><p><span class="text-overflow m-width"><%=storageName%></span></p></div>',t):"storageStatus"==i.key?'<div><span class="text-overflow m-width text-'+t.statusDesClass+'">'+t.statusDesc+"</span></div>":"uInstanceId"==i.key?t.uInstanceId?'<div><a href="/cvm/detail/'+n.getRegionId()+"/"+t.uInstanceId+'">'+t.uInstanceId+"</a></div>":"<div>-</div>":"_operCol"==i.key?a.tmpl('<div><a href="javascript:void(0);"  data-event="renew" >恢复</a>    </div>',t):"<div>"+(e||"")+"</div>"},getColumns:function(){return[{key:"storageId",name:"ID/名称",width:"",minWidth:150,required:!0,orderField:"alias"},{key:"storageStatus",name:"状态",width:120,required:!0},{key:"storageSizeDesc",name:"容量",width:100,required:!0},{key:"zoneName",name:"可用区",width:90,required:!0},{key:"storageTypeDesc",name:"磁盘种类",width:150},{key:"diskTypeDesc",name:"磁盘属性",width:150,minWidth:150},{key:"uInstanceId",name:"隔离前挂载的云主机",width:150},{key:"payModeDesc",name:"计费模式",width:160},{key:"deadlineTimeDesc",name:"销毁倒计时",width:60},{key:"_operCol",name:"操作",required:!0,width:100,minWidth:100,locked:!0,hide:!0}]}};i.exports=h}),define("modules/cvm/recycle/cdh/cdh",function(e,t,i){var r=e("$"),n=e("pageManager"),a=(e("manager"),e("util")),o=(e("modules/cvm/cdh/util"),e("appUtil")),d=e("projectsSelector"),c=e("widget/region/region2"),s=e("widget/fieldsManager/gridView"),l=(e("tips"),e("models/cdh")),p=e("qccomponent"),u=e("dialog"),m=e("modules/cvm/cdh/dialog/renew"),h=(e("models/api"),e("validator"),e("models/iaas")),v='    <div>        <div class="manage-area">            <div class="manage-area-title with-bottom-border">                <h2>专用宿主机</h2>                <div id="projectsWrapper" class="tc-select-box"></div>                <div id="regionWrapper" class="tc-select-box"></div>            </div>            <div class="manage-area-main">                <div class="tc-15-tab tc-15-tab-alt trash-tab">                     <div class="tab-panel">                        <div class="tc-15-msg with-margin">                            到期仍未续费的专用宿主机，会在回收站中保留7天，这期间您可以续费进行恢复。7天后，这些宿主机会被彻底销毁，不可恢复。                        </div>                        <div id="operArea">                            <div class="tc-15-action-panel">                                <button type="button" class="tc-15-btn m " id="cdhRenewBtn" data-event="cvm_oper_action">批量恢复</button>                                <button class="tc-15-btn weak m setting" data-event="set_Fields" title="设置列表显示字段" data-hot="yunzhuji.setfields" data-grid-setting="true">                                </button>                                <div id="searchArea" class="pull-right"></div>                            </div>                            <div id="cdhList" style="position:relative"></div>                        </div>                    </div>                </div>            </div>        </div>    </div>',f='<div class="id-name-cell">    <span class="text-overflow m-width" >{{item.uHostId}}</span>    <div>        <span class="text-overflow m-width" title=""  > {{item.hostAlias ? item.hostAlias : \'未命名\'}}    </span>    </div></div>',g={title:"专用宿主机-控制台",pageClass:"",render:function(e,i){var t=this;n.appArea.html(v),this.projectsAreaEl=r("#projectsArea"),this.searchAreaEl=r("#searchArea"),this.projectsWrapperEl=r("#projectsWrapper"),this.regionWrapperEl=r("#regionWrapper"),this.cdhListEl=r("#cdhList"),this.searchAreaEl=r("#searchArea"),this.projectsSelector=new d({renderTo:this.projectsWrapperEl,selectedId:o.getProjectId(),change:function(){t.renderList()}}),this.regionSelector=new c({renderTo:this.regionWrapperEl,selectedId:o.getRegionId(),change:function(){t.renderList()}}),this.bindEvent(),this.renderBtnGroup();var a=this,s=function(t){var e=a.getColumns().filter(function(e){return!e.cageIdOnly||t});a.initGridView(e),a.renderList(i)};h.apiRequest({cmd:"GetProductUsageInfo",serviceType:"cage",regionId:o.getRegionId(),data:{}}).then(function(e){e&&e.data&&e.data.isOpen?s(!0):s(!1)},function(e){s(!1)})},bindEvent:function(){var i=this;i.cdhListEl.on("click",'input[type="checkbox"]',function(e){setTimeout(function(){i.updateRenewBtn(i.gridView.getSelected())},0)}),r("#operArea").find("[data-event=cvm_oper_action]").click(function(e){if(!r("#cdhRenewBtn").hasClass("disabled")){var t=i.gridView.getSelected();0<t.length&&i.showRenewDia(t)}}),r("#operArea").find("[data-event=set_Fields]").click(function(){i.gridView.showFieldsManager()})},initGridView:function(e){var a=this,t={$data:{hasFirst:!0,orderField:"addTimeStamp",order:1,initGetData:!1,canResizeColum:!0,selectedHighlight:!1,colums:e,list:[],canSelectTotal:!1,autoMaxHeight:!0,maxHeightOffset:10,autoCheckWidth:!1,showState:!0,showPagination:!0,totalNum:0,trackKey:"uHostId",searchItemName:"专用宿主机",trAttr:{"data-uHostId":"uHostId"}},$mixins:[s("recycle_cdh_fields")],getCellContent:function(e,t,i){return a.getCellContent(e,t,i)},getHeadContent:function(e){if("cageId"===e.key)return'<grid-view-header-filter b-ref="cageFilter" b-with="{ ready: cageFilterReady.bind(this.$root),filterOptions: cagelist, col: col, change: cageChange.bind(this.$root) }"></grid-view-header-filter>'},cageFilterReady:function(e){a.cageFilter=e},cageChange:function(e){var t;e&&0<e.length&&(t=e.join(",")),a.gridView.getData({cageId:t?encodeURIComponent(t):""})},events:{"click tr [data-event=renew]":function(e){var t=r(e.target).closest("tr").attr("data-index");a.showRenewDia([a.gridView.list[t]])}},getData:function(e,t){a.renderList(e)}},i=p.getComponent("grid-view");a.gridView=new i(t)},renderBtnGroup:function(){var t=this;this.searchAreaEl=r("#searchArea");var e=p.components["qc-search"],i=this.search=new e({$data:{keyword:"",searchEmpty:!0,multiple:!1,placeholder:"请输独立宿主机ID搜索"},search:function(e){t.renderList({searchKey:e})}});this.searchAreaEl.html("").append(i.$el)},updateRenewBtn:function(e){if(e&&0<e.length){var i=[],a=[],s=[],n=[];e.forEach(function(e){var t=e.cageId||"common";a.indexOf(t)<0&&a.push(t),i.indexOf(e.externalHostType)<0&&i.push(e.externalHostType),s.indexOf(e.zoneId)<0&&s.push(e.zoneId),n.indexOf(e.projectId)<0&&n.push(e.projectId)}),1<a.length?(r("#cdhRenewBtn").addClass(" disabled"),r("#cdhRenewBtn").attr("title","不支持不同围笼内主机同时恢复")):(r("#cdhRenewBtn").attr("title",""),r("#cdhRenewBtn").removeClass(" disabled"))}else r("#cdhRenewBtn").attr("title",""),r("#cdhRenewBtn").removeClass(" disabled")},showRenewDia:function(e){var t=new m({selectedItem:e,recycleFlag:1});u.create(t.$el,"700","",{title:"续费","class":"dialog_layer_v2 tc-15-rich-dialog new-gateway",preventResubmit:!0,button:{"确定":function(e){t.doAction(u)}}})},renderList:function(t){var i=this,e=((t=r.extend({},{pid:o.getProjectId(),rid:o.getRegionId()},t)).page-1)*t.count||0,a={startNum:e,endNum:e+(t.count||20)-1,regionId:t.rid,orderField:t.orderField||"addTimeStamp",order:t.order,recycleFlag:1};0<=o.getProjectId()&&(a.projectId=o.getProjectId()),t.searchKey&&(0==t.searchKey.indexOf("host-")?a.uHostIdList=[t.searchKey]:a.hostAlias=t.searchKey),t.cageId&&(a.cageIdList=decodeURIComponent(t.cageId).split(",")),l.request({name:"getVpsHostList",data:a,success:function(e){i.cdhListEl.append(i.gridView.$el),i.gridView.checkCellWidth(),i.gridView.setData({list:e.hostList,totalNum:e.totalNum,searchKey:t.searchKey||!1,page:t.page||1,count:t.count||20}),e.hostList&&0<e.hostList.length||t.searchKey||i.gridView.showTips('<span class="text"></span>列表为空'),e.cageIdList&&e.cageIdList.length&&i.cageFilter&&i.cageFilter.$set("filterOptions",e.cageIdList)},fail:function(){i.gridView.setData({list:[],totalNum:0}),i.gridView.checkCellWidth(),i.gridView.showTips("系统繁忙，请稍后重试。")}})},getCellContent:function(e,t,i){switch(i.key){case"cpuTotal":return e+"核";case"memTotal":return e+"G";case"cageId":return t.cageId?"<div><p>"+(e||"-")+'</p><p><span class="text-overflow restart">'+(t.cageAlias||"未命名")+"</span></p></div>":'<span class="text-overflow">-</span>';case"diskTotal":return e+"G";case"idAndName":return f;case"cvmNumber":return isNaN(e)?"-":e;case"_operCol":return a.tmpl('<div>    <a href="javascript:void(0);"  data-event="renew" >恢复</a></div>',t);case"deadlineTimeDesc":return"<div>"+(function d(e,t){var i=new Date(e.replace(/\-/g,"/")),a=0,s="-",n=t&&!isNaN(t)?t:(new Date).getTime();if(a=n-i.getTime(),"0000-00-00 00:00:00"!=e)if(a<6048e5){var r=(7-(a=a.toFixed(2)-0)/864e5).toFixed(2).split("."),o="";if(r[1]){var o=(r[1]/100*24).toFixed(0)-0;24<=o&&(r[o=0]=parseInt(r[0])+1),o=0<o?o+"小时":""}s='<span class="text-overflow text-danger">'+r[0]+"天"+o+"后销毁</span>"}else s='<span class="text-overflow status-recover">已销毁</span>';return s}(t.deadline,t.serverTimestamp)||"-")+"</div>";default:return"<div>"+(e||"")+"</div>"}},getColumns:function(){return[{key:"idAndName",name:"ID/宿主机名",minWidth:200,required:!0,orderField:"hostAlias"},{name:"机型",key:"externalHostType",required:!0},{cageIdOnly:!0,name:"所属围笼",key:"cageId",width:150,minWidth:150},{name:"云主机",key:"cvmNumber",width:50,required:!0},{key:"cpuTotal",name:"总CPU",required:!0},{key:"memTotal",name:"总内存"},{key:"diskTotal",name:"总硬盘容量",minWidth:150},{key:"deadlineTimeDesc",name:"销毁倒计时",required:!0,orderField:"deadline",order:!0,minWidth:150},{key:"_operCol",name:"操作",required:!0,width:100,minWidth:100,locked:!0,hide:!0}]}};i.exports=g}),define("modules/cvm/recycle/cvm/cvm",function(e,t,i){var o=e("$"),a=e("pageManager"),d=e("manager"),s=e("util"),c=e("appUtil"),n=(e("event"),e("projectsSelector")),r=e("widget/region/region2"),l=e("widget/fieldsManager/gridView"),p=s.tmpl('    <div class="id-name-cell">        <p>        <% if (item.uuid && item.uInstanceId) { %>        <%- item.uInstanceId%>        <% } %>        </p>        <div><span class="text-overflow m-width" title="<%= item.alias%>" <% if (item.canUpgradeToKvm || item.autoRenewFlag) { %> style="max-width: 70%;" <% } %> ><%= item.alias %></span>         </div>    </div>',null),u=s.tmpl('<div class="ip-cell"><p><span class="text-overflow m-width" title="公网IP: <%= deviceWanIp %>"><%= deviceWanIp %> <% if (deviceWanIp && deviceWanIp!="-") { %> <i class="net-type">(公)</i><% } %></span> <i class="copy-icon" data-clipboard-text="<%=deviceWanIp%>" style="display:none; cursor:pointer;" title="复制公网IP"></i></p><p><span class="text-overflow m-width" title="内网IP: <%= deviceLanIp %>"><%= deviceLanIp %> <% if (deviceLanIp && deviceLanIp!="-") { %><i class="net-type">(内)</i><% } %></span> <i class="copy-icon" data-clipboard-text="<%=deviceLanIp%>" style="display:none; cursor:pointer;" title="复制内网IP"></i></p>    </div>',null),m=s.tmpl('<div><span class="status-col"><span class="text-overflow text-danger">已关机</span></span></div>',null),h=s.tmpl('<span class="text-overflow" title="<%- item.deadline %>"><%- item.deadlineInfo %></span>',null),v=s.tmpl('<span class="text-overflow" title="<%- item.addTimeStamp %>"><%- item.addTimeStampFormated %></span>',null),f=s.tmpl('<div class="cvm-oper-cell" style="white-space:nowrap">        <a href="javascript:;" data-name="renew" data-event="cvm_oper_renew">恢复</a>        <a href="javascript:;" data-name="destroy" data-event="cvm_oper_destroy">销毁</a></div>',null),g=(e("search"),e("reporter")),b=e("qccomponent"),I=e("modules/cvm/recycle/data_package"),y={renew:{main:e("modules/cvm/recycle/renew_cvm"),name:"续费",hotTag:"yunzhuji.recyle.xufei"},destroy:{main:e("widget/cvmList/destroycvm/destroycvm"),name:"销毁"}},w='<div><style type="text/css">.cvm-oper-cell .disabled{    color: #999;    cursor: default;    text-decoration: none !important}</style><div class="manage-area"><div class="manage-area-title with-bottom-border"><h2>云主机</h2><div id="projectsWrapper" class="tc-select-box"></div><div id="regionWrapper" class="tc-select-box"></div></div><div class="manage-area-main"><div class="tc-15-tab tc-15-tab-alt trash-tab"><div class="tab-panel"> <div class="tc-15-msg with-margin">到期后仍未续费的云主机，会在回收站中保留7天，这期间您可以续费进行恢复。7天后，这些云主机会被彻底销毁，不可恢复。云服务器进入回收站后将被强制解除与负载均衡、弹性云盘、基础网络互通的挂载关系。续费恢复后，其挂载关系不恢复，需要您重新配置。</div><div id="operArea"><div class="tc-15-action-panel"><button type="button" class="tc-15-btn m disabled" data-event="renew" data-hot="yunzhuji.recyle.renew_more">批量恢复</button><button type="button" class="tc-15-btn m weak disabled" data-event="destroy">批量销毁</button>    <button class="tc-15-btn weak m setting" data-event="set_Fields" title="设置列表显示字段" data-hot="yunzhuji.setfields" data-grid-setting="true">    </button>    <div id="searchArea" class="pull-right"></div></div></div><div id="cvmList" style="position:relative"></div></div></div></div></div></div>',x={title:"云主机",pageClass:"",render:function(e,t){var i=this;!(0<c.getRegionId())&&c.setRegionId(1),a.appArea.html(w),this.projectsAreaEl=o("#projectsArea"),this.searchAreaEl=o("#searchArea"),this.projectsWrapperEl=o("#projectsWrapper"),this.regionWrapperEl=o("#regionWrapper"),this.cvmListEl=o("#cvmList"),this.projectsSelector=new n({renderTo:this.projectsWrapperEl,selectedId:c.getProjectId(),change:function(){i.renderList()}}),this.regionSelector=new r({renderTo:this.regionWrapperEl,selectedId:c.getRegionId(),change:function(){i.renderList()}}),this.renderBtnGroup(),this.initGridView(),this.bindEvent(),this.renderList(t)},resetTr:function(e){for(var t=o(e).attr("data-index"),i=this.gridView,a=0,s=i.list.length;a<s;a++)i.$refs.list[a].$set({$selected:!1});i.$refs.list[t].$set({$selected:!0})},getSelectItem:function(){var a=this,e=this.gridView.getSelected()||[];return o.each(e,function(e,t){var i=o(a.gridView.$el).find('[data-id="'+t.uInstanceId+'"]');t.el=i}),e},getSelectedItemData:function(e){e=parseInt(e);var t={},i=this.listData;return i&&(t=i[e]),t},exec:function(e,t){var i=new y[e].main({listIns:this}),a=y[e].name;if(i){t=o.extend(!0,[],this.getSelectItem());o(t).each(function(e,t){t.$selected=!1}),i.hasPermItems=t;var s=i.resolvePerm(t,e,a);i.permResult=s,i.selectedItems=s.hasPermItems,i.selectedShowOptions=s.selectedShowOptions,i.noReturn=!0,i.exec&&i.exec()}},bindEvent:function(){var i=this;this.cvmListEl;o("#operArea").on("click","[data-event]",function(){var e=i.gridView.getSelected(),t=o(this).data("event");0<e.length&&i.exec(t,o(this).closest("tr"))}),o("#operArea").find("[data-event=set_Fields]").click(function(){i.gridView.showFieldsManager()})},checkEvent:function(){o.extend(!0,[],this.gridView.getSelected()).length?(o('#operArea [data-event="renew"]').removeClass("disabled"),o('#operArea [data-event="destroy"]').removeClass("disabled")):(o('#operArea [data-event="renew"]').addClass("disabled"),o('#operArea [data-event="destroy"]').addClass("disabled"))},initGridView:function(){var a=this,e={$data:{hasFirst:!0,orderField:"addTimeStamp",order:1,initGetData:!1,canResizeColum:!0,selectedHighlight:!1,colums:a.getColumns(),list:[],canSelectTotal:!1,autoMaxHeight:!0,maxHeightOffset:10,autoCheckWidth:!1,showState:!0,showPagination:!0,totalNum:0,trackKey:"uuid",searchItemName:"云主机"},$mixins:[l("recycle_fields")],getCellContent:function(e,t,i){return a.getCellContent(e,t,i)},events:{"click tr [data-event=cvm_oper_renew]":function(e){o(e.target).hasClass("disabled")||(a.resetTr(o(e.target).parents("tr")),g.click("yunzhuji.recyle.renew_single"),a.exec("renew"))},"click tr [data-event=cvm_oper_destroy]":function(e){o(e.target).hasClass("disabled")||(a.resetTr(o(e.target).parents("tr")),a.exec("destroy"))},"click tr :checkbox:eq(0)":function(e){setTimeout(function(){a.checkEvent()},0)},"click tr[data-id] input[type=checkbox]":function(e){setTimeout(function(){a.checkEvent()},0)}},getData:function(e,t){a.renderList(e)},setTrAttr:function(e,t){return{"data-id":t.uInstanceId}}},t=b.getComponent("grid-view");a.gridView=new t(e)},renderBtnGroup:function(){var e=this,t=b.components["qc-search"],i=this.search=new t({$data:{keyword:"",searchEmpty:!0,multiple:!0,placeholder:"请输IP(换行分隔)或主机名"},search:function(){e.renderList()}});this.searchAreaEl.html("").append(i.$el)},getCvmAnalyseValue:function(e){var t=/^(?:(?:[1-9]?[0-9]|1[0-9]{2}|2(?:[0-4][0-9]|5[0-5]))\.){3}(?:[1-9]?[0-9]|1[0-9]{2}|2(?:[0-4][0-9]|5[0-5]))$/,i=null;if(e)if(i={},/\n/.test(e)){for(var a,s=e.replace(/\s+/,"\n").split("\n"),n=[],r=0;a=s[r];r++){if(!t.test(a))return tips.error("暂不支持批量模糊搜索,请检查输入");n.push(a)}i.ipList=n}else/^\d{1,3}((\.(\d{1,3})?)?){0,3}$/.test(e)?i.vagueIp=e:i.alias=e;return i},renderList:function(t){var i=this,e=(this.cvmListEl,this.search.getKeyword()),a=this.getCvmAnalyseValue(e)||{},s=(t=o.extend({},{pid:c.getProjectId(),rid:c.getRegionId()},t)).page===undefined?1:t.page,n=t.count||20,r=n*(s-1);d.getCvmList({count:n,projectId:t.pid,regionId:t.rid,offset:r,method:"get",orderField:t.orderField||"addTimeStamp",order:t.order,alias:a.alias||undefined,vagueIp:a.vagueIp||undefined,ipList:a.ipList&&0<a.ipList.length?a.ipList:undefined,vpcId:t.vpcId||undefined,subnetIdList:t.subnetIds?[t.subnetIds]:[],cmd:"recycled"},function(e){d.getProjects(function(){i.originalData=e,i.listData=new I({data:e.deviceList,isPrepaidUser:e.isPrepaidUser,isBandwidthPackageUser:e.isBandWidthPackageUser,serverTimestamp:e.serverTimestamp}),i.isBandwidthPackageUser=e.isBandWidthPackageUser,i.isPrepaidUser=e.isPrepaidUser,i.cvmListEl.append(i.gridView.$el),i.gridView.checkCellWidth(),i.aliasIndex=0,i.gridView.setData({list:i.listData,totalNum:e.totalNum,page:s,count:n,orderField:t.orderField,order:t.order}),i.listData&&0<i.listData.length||i.gridView.showTips('<span class="text">当前项目下回收站列表为空或您没有权限查看</span>'),i.isBandwidthPackageUser&&i.cvmListEl.find('[data-orderfield="bandwidthInfo"]').find(".text-overflow").text("带宽上限")})})},refresh:function(){this.renderList()},getCellContent:function(e,t,i){switch(i.key){case"idName":return p({item:t});case"statusDesc":return m({item:t});case"ip":var a=t.deviceLanIp||"-",s=t.deviceWanIp||"-";return u({deviceLanIp:a,deviceWanIp:s});case"deadlineInfo":return h({item:t});case"addTimeStamp":return t.addTimeStampFormated=c.formatDate(c.getDate(t.addTimeStamp),"yyyy-MM-dd"),v({item:t});case"_operCol":return f({});default:return'<span class="text-overflow" title="'+e+'">'+(e||"")+"</span>"}},getColumns:function(){return[{key:"idName",name:"ID/主机名",width:"",minWidth:150,required:!0,order:!0,orderField:"alias"},{key:"statusDesc",name:"状态",width:120,required:!0},{key:"projectName",name:"所属项目",width:100,required:!0},{key:"netName",name:"所属网络",width:90,required:!0},{key:"ip",name:"IP地址",width:180,minWidth:180,required:!0},{key:"zoneName",name:"可用区",width:90,hide:!0},{key:"cvmPayModeDesc",name:"主机计费模式",width:150,minWidth:150,orderField:"cvmPayMode",hide:!0},{key:"networkPayModeDesc",name:"网络计费模式",width:150,hide:!0},{key:"osName",name:"操作系统",width:160,hide:!0},{key:"cpuInfo",name:"CPU",width:60,hide:!0},{key:"memInfo",name:"内存",width:60,hide:!0},{key:"sysDiskInfo",name:"系统盘",width:110,hide:!0},{key:"diskInfo",name:"数据盘",width:120,hide:!0},{key:"bandwidthInfo",name:"公网带宽",width:70,hide:!0},{key:"unImgIdInfo",name:"镜像ID",width:80,hide:!0},{key:"addTimeStamp",name:"创建时间",order:!0,orderField:"addTimeStamp",width:100,hide:!0},{key:"deadlineInfo",name:"销毁倒计时",width:140,order:!0,orderField:"deadline",required:!0,locked:!0,hide:!0},{key:"_operCol",name:"操作",required:!0,width:100,minWidth:100,locked:!0,hide:!0}]}};i.exports=x}),define("modules/cvm/recycle/data_package",function(e,t,i){var s=e("constants"),n=e("appUtil"),a=e("manager"),r=null,o={1:"本地盘",2:"云硬盘",3:"本地SSD盘"},d=function(e){var t=this,i=e.data;this.options=e;for(var a,s=0;a=i[s];s++)a.operateAuth=a.operateAuth||0,a.opsAvailable=n.getOperationTag(a.operateAuth,a.runflag),t.statusDesc(a),t.cvmPayModeDesc(a),t.networkPayModeDesc(a),t.deadlineInfo(a),t.diskInfo(a),t.cpuInfo(a),t.memInfo(a),t.canUpgradeToKvm(a),t.projectName(a),t.bandwidthInfo(a),t.deviceImageIdInfo(a);return i};d.prototype={statusDesc:function(e){var t=e.statusDesc;e.$loading=!1,"故障"!==t&&"运行中"!==t&&"已退还"!==t&&"已关机"!==t&&"待回收"!==t&&(e.$loading=!0);var i="";i="运行中"===t||"已关机"===t?"succeed":"故障"===t?"warning":"待回收"===t?"error":"restart",e.statusDesc='<span class="text-overflow '+i+'">'+t,1==e.isSafeIsolated&&(e.statusDesc='<span class="text-overflow warning">'+t,e.statusDesc+='<i class="ico-warning" title="服务器由于有安全风险外网已被隔离，请尽快处理安全风险，解除风险后提交工单给我们确认执行结果；&#10;具体安全风险：'+e.safeIsolatedInfo+'"></i>'),e.statusDesc+="</span>"},cvmPayModeDesc:function(e){var t="包年包月";e.cvmPayMode===s.CVMPAYMODE.SECOND?t="按量计费":this.options.isPrepaidUser||(t="后付费"),e.cvmPayModeDesc=t},networkPayModeDesc:function(e){var t="按带宽包年包月计费";e.networkPayMode===s.NETWORKPAYMODE.FLOW?t="按流量计费":e.networkPayMode===s.NETWORKPAYMODE.SECOND?t="按带宽使用时长计费":this.options.isBandwidthPackageUser||e.networkPayMode===s.NETWORKPAYMODE.PACKAGE?t="共享带宽包":this.options.isPrepaidUser||(t="按带宽后付费月结"),e.networkPayModeDesc=t},deadlineInfo:function(e){e.deadlineInfo=function(e,t){var i=e.isolateTime,a=(e.deadline,new Date(i.replace(/\-/g,"/"))),s=0,n="-";if(s=(t&&!isNaN(t)?t:(new Date).getTime())-a.getTime(),"0000-00-00 00:00:00"!=i)if(s<6048e5){var r=(7-(s=s.toFixed(2)-0)/864e5).toFixed(2).split("."),o="";r[1]&&(o=0<(o=(r[1]/100*24).toFixed(0)-0)?o+"小时":""),n=0==r[0]&&0==o?'<span class="text-overflow text-danger">小于1小时销毁</span>':'<span class="text-overflow text-danger">'+r[0]+"天"+o+"后销毁</span>"}else n='<span class="text-overflow status-recover">已销毁</span>';return n}(e,this.options.serverTimestamp)},canUpgradeToKvm:function(e){var t=s.HYPERVISOR,i=s.ZONEID.GZ1,a=!1;this.options.isPrepaidUser&&t&&t.ENABLE&&e.opsAvailable.XENTOKVM&&(e.zoneId!=i||!e.cbsList.length)&&(a=!0,t.ENABLE_WINDOWS||"windows"!==e.osType?!t.ENABLE_CBS&&e.cbsList&&e.cbsList.length&&(a=!1):a=!1),e.canUpgradeToKvm=a},diskInfo:function(e){var t=o[e.rootType];e.sysDiskInfo=e.rootSize+"GB",t&&e.rootSize&&(e.sysDiskInfo+="("+t+")");var i=o[e.diskType];if(2==e.diskType){var a=0;if(e.cbsList&&0<e.cbsList.length)for(var s=0;s<e.cbsList.length;s++)e.cbsList[s].diskType&&"data"!==e.cbsList[s].diskType||(a+=e.cbsList[s].diskSize);e.diskInfo=a+"GB",i&&a&&(e.diskInfo+="("+i+")")}else e.diskInfo=e.disk+"GB",i&&e.disk&&(e.diskInfo+="("+i+")")},cpuInfo:function(e){e.cpuInfo=!e.deviceClass||"v1.0.5"!=e.deviceClass.toLowerCase()&&"v1.1"!=e.deviceClass.toLowerCase()?e.cpu+"核":"共享核"},memInfo:function(e){e.memInfo=e.deviceClass&&"v1.0.5"==e.deviceClass.toLowerCase()?e.mem+"MB":e.mem+"GB"},projectName:function(s){r?s.projectName=r[s.projectId]||"已停用项目":a.getProjects(function(e){var t=e.data;r={};for(var i,a=0;i=t[a];a++)r[i.projectId]=i.name;s.projectName=r[s.projectId]||"已停用项目"})},bandwidthInfo:function(e){e.bandwidthInfo=e.bandwidth+"Mbps",this.options.isBandwidthPackageUser&&65535==e.bandwidth&&(e.bandwidthInfo="无限制")},deviceImageIdInfo:function(e){e.deviceImageIdInfo=e.deviceImageId,e.unImgIdInfo=e.unImgId,0==e.deviceImageId&&(e.deviceImageIdInfo="-"),e.unImgId||(e.unImgIdInfo="-")}},i.exports=d}),define("modules/cvm/recycle/recycle/useless",function(n,e,t){n("$");var r,o=n("router"),d=n("manager"),c={cvm:n("modules/cvm/recycle/cvm/cvm"),cdh:n("modules/cvm/recycle/cdh/cdh"),cbs:n("modules/cvm/recycle/cbs/cbs")},i={title:"回收站-控制台",render:function(i,a){if(1==arguments.length&&"object"==typeof i&&(a=i,i=""),i){["cvm","cdh","eip"].indexOf(i)<0&&(i="cbs");var s=arguments;d.getAllWhiteList(function(e){var t=e.CVM_APIv3_BlackList;t&&0<t.length?c[i].render(i,a):(t=e.CVM_ApiToMc)&&0<t.length?n.async("cvm/recycle/recycle",function(e){(r=e).render.apply(e,s)}):(r=c[i],c[i].render(i,a))})}else o.navigate("/cvm/recycle/cvm")},destroy:function(){r&&r.destroy()}};t.exports=i}),define("modules/cvm/recycle/recycle_cbs",function(e,t,i){var r=e("$"),a=(e("pageManager"),e("manager"),e("util")),s=e("appUtil"),n=(e("event"),e("projectsSelector"),e("regionSelector"),e("widget/fieldsManager/gridView")),o=e("modules/cvm/cbs/cbs/data"),d=(e("tips"),e("modules/cvm/recycle/renew_cbs")),c=e("modules/cvm/cbs/cbsutil"),l=(e("models/api"),e("search"),e("router"),e("reporter"),e("qccomponent"));var p={param:{},title:"云硬盘-控制台",pageClass:"",init:function(e,t,i){this.getProjectId=i.getProjectId,this.getRegionId=i.getRegionId,t&&t.storageIds&&(t.storageIds=t.storageIds.split(",")),this.param=r.extend(function a(){return r.extend({page:1,count:20,projectId:null,regionId:null,storageIds:""},!0)}(),t,!0),this.render()},render:function(){r(".tab-panel").html('<div><div class="tc-15-msg with-margin">到期7天后仍未续费的云硬盘，会在回收站中保留7天，这期间您可以续费进行恢复。7天后，这些云硬盘会被彻底销毁，不可恢复。</div><div id="operArea"><div class="tc-15-action-panel">    <button class="tc-15-btn weak m setting" data-event="set_Fields" title="设置列表显示字段" data-hot="yunzhuji.setfields" data-grid-setting="true">    </button>    <div id="searchArea" class="pull-right"></div></div><div id="cbsList" style="position:relative"></div></div></div>'),this.cbsListEl=r("#cbsList"),this.searchAreaEl=r("#searchArea"),this.bindEvent(),this.renderBtnGroup(),this.initGridView(),this.renderList(this.param)},bindEvent:function(){var e=this;r("#operArea").find("[data-event=set_Fields]").click(function(){e.gridView.showFieldsManager()})},initGridView:function(){var a=this,e={$data:{hasFirst:!1,orderField:"addTimeStamp",order:1,initGetData:!1,canResizeColum:!0,selectedHighlight:!1,colums:a.getColumns(),list:[],canSelectTotal:!1,autoMaxHeight:!0,maxHeightOffset:10,autoCheckWidth:!1,showState:!0,showPagination:!0,totalNum:0,trackKey:"uuid",searchItemName:"云主机"},$mixins:[n("recycle_cbs_fields")],getCellContent:function(e,t,i){return a.getCellContent(e,t,i)},setTrAttr:function(e,t){return{"data-storageId":t.storageId}},getSlectItem:function(t){var s=[];if(r(a.gridView.list).each(function(e,a){r(t).each(function(e,t){var i=r(t).closest("tr").data("storageid");a.storageId==i&&s.push(a)})}),0<s.length)return s},events:{"click tr [data-event=renew]":function(e){var t=a.gridView.getSlectItem(e.target);d.init(t,{projectId:a.getProjectId(),regionId:a.getRegionId()})}},getData:function(e,t){this.page=e.page,this.count=e.count,a.renderList()}},t=l.getComponent("grid-view");a.gridView=new t(e),this.param.storageIds&&this.search.$set("keyword",this.param.storageIds.join("\n"))},renderBtnGroup:function(){var e=this;this.searchAreaEl=r("#searchArea");var t=l.components["qc-search"],i=this.search=new t({$data:{keyword:"",searchEmpty:!0,multiple:!0,placeholder:"请输云硬盘ID(换行分隔)"},search:function(){e.gridView.page=1,e.gridView.count=20,e.renderList()}});this.searchAreaEl.html("").append(i.$el)},getFilter:function(e){var t=this.search.getKeyword().replace(/\s+/,"\n").split("\n"),i=[];t=r(t).each(function(e,t){t&&i.push(t)}),0==i.length&&(i=null);var a=e&&0<e.page?e.page:this.gridView.page,s=e&&0<e.count?e.count:this.gridView.count;e={offset:(a-1)*s,limit:s,projectId:this.getProjectId(),regionId:this.getRegionId(),storageIds:i};for(var n in e)null==e[n]&&delete e[n];return-1==e.projectId&&delete e.projectId,e},renderList:function(a){var s=this;a=this.getFilter(a);r.when(o.queryCbsStoragesForRecycle(a),o.queryZone(this.getRegionId({}))).done(function(e,t){var i=s.formateData(e.storageSet,t);s.cbsListEl.append(s.gridView.$el),s.gridView.checkCellWidth(),s.gridView.setData({list:i,totalNum:e.totalCount,page:Math.floor(a.offset/a.limit)+1,count:a.limit}),i&&0<i.length||s.gridView.showTips('<span class="text"></span>您查看的对象已不存在或没有权限查看')}).fail(function(){s.gridView.setData({list:[],totalNum:0,page:a.page,count:a.count}),s.gridView.checkCellWidth(),s.gridView.showTips("系统繁忙，请稍后重试。")})},formateData:function(e,t){var s=p,n={};return t.forEach(function(e){n[e.zoneId]=e.zoneName}),r(e).each(function(e,t){var i=c.getCbsMetaByValue(t.storageType);t.diskTypeDesc="root"==t.diskType?"系统盘":"数据盘",t.storageTypeDesc=i.name,t.payModeDesc="prePay"==t.payMode?"包年包月":"按小时计费",t.isRenew=!1,1==t.portable&&(t.isRenew=!0),t.storageSizeDesc=t.storageSize+"G";var a=t.zoneId;t.zoneName=n[a]||a,t.deadlineTimeDesc=function d(e,t){var i=new Date(e.replace(/\-/g,"/")),a=0,s="-",n=t&&!isNaN(t)?t:(new Date).getTime();if(a=n-i.getTime(),"0000-00-00 00:00:00"!=e)if(a<12096e5&&6048e5<=a){var r=(14-(a=a.toFixed(2)-0)/864e5).toFixed(2).split("."),o="";if(r[1]){var o=(r[1]/100*24).toFixed(0)-0;o=0<o?o+"小时":""}s='<span class="text-overflow text-danger">'+r[0]+"天"+o+"后销毁</span>"}else s='<span class="text-overflow status-recover">已销毁</span>';return s}(t.deadlineTime),t.regionId=s.getRegionId(),t.statusDesc="已隔离",t.statusDesClass="danger",t.attachedDesc=1==t.portable?"支持":"不支持"}),e},getCellContent:function(e,t,i){return"storageId"==i.key?a.tmpl('<div><p><%=storageId%></p><p><span class="text-overflow m-width"><%=storageName%></span></p></div>',t):"storageStatus"==i.key?'<div><span class="text-overflow m-width text-'+t.statusDesClass+'">'+t.statusDesc+"</span></div>":"uInstanceId"==i.key?t.uInstanceId?'<div><a href="/cvm/detail/'+s.getRegionId()+"/"+t.uInstanceId+'">'+t.uInstanceId+"</a></div>":"<div>-</div>":"_operCol"==i.key?a.tmpl('<div><a href="javascript:void(0);"  data-event="renew" >恢复</a>    </div>',t):"<div>"+(e||"")+"</div>"},getColumns:function(){return[{key:"storageId",name:"ID/名称",width:"",minWidth:150,required:!0,orderField:"alias"},{key:"storageStatus",name:"状态",width:120,required:!0},{key:"storageSizeDesc",name:"容量",width:100,required:!0},{key:"zoneName",name:"可用区",width:90,required:!0},{key:"storageTypeDesc",name:"磁盘种类",width:150},{key:"diskTypeDesc",name:"磁盘属性",width:150,minWidth:150},{key:"uInstanceId",name:"隔离前挂载的云主机",width:150},{key:"payModeDesc",name:"计费模式",width:160},{key:"deadlineTimeDesc",name:"销毁倒计时",width:60},{key:"_operCol",name:"操作",required:!0,width:100,minWidth:100,locked:!0,hide:!0}]}};i.exports=p}),define("modules/cvm/recycle/recycle_cdh",function(e,t,i){var r=e("$"),a=(e("pageManager"),e("manager"),e("util")),s=(e("modules/cvm/cdh/util"),e("appUtil")),n=(e("projectsSelector"),e("regionSelector"),e("widget/fieldsManager/gridView")),o=(e("tips"),e("models/cdh")),d=e("qccomponent"),c=e("dialog"),l=e("modules/cvm/cdh/dialog/renew"),p=(e("models/api"),e("models/iaas")),u='<div class="id-name-cell">    <span class="text-overflow m-width" >{{item.uHostId}}</span>    <div>        <span class="text-overflow m-width" title=""  > {{item.hostAlias ? item.hostAlias : \'未命名\'}}    </span>    </div></div>',m={title:"专用宿主机-控制台",pageClass:"",init:function(e,t,i){this.render()},render:function(){r(".tab-panel").html('    <div class="cdh-panel">        <div class="tc-15-msg with-margin">            到期仍未续费的专用宿主机，会在回收站中保留7天，这期间您可以续费进行恢复。7天后，这些宿主机会被彻底销毁，不可恢复。        </div>        <div id="operArea">            <div class="tc-15-action-panel">                <button type="button" class="tc-15-btn m " id="cdhRenewBtn" data-event="cvm_oper_action">批量恢复</button>                <button class="tc-15-btn weak m setting" data-event="set_Fields" title="设置列表显示字段" data-hot="yunzhuji.setfields" data-grid-setting="true">                </button>                <div id="searchArea" class="pull-right"></div>            </div>            <div id="cdhList" style="position:relative"></div>        </div>    </div>'),this.cdhListEl=r("#cdhList"),this.searchAreaEl=r("#searchArea"),this.bindEvent(),this.renderBtnGroup();var i=this,t=function(t){var e=i.getColumns().filter(function(e){return!e.cageIdOnly||t});i.initGridView(e),i.renderList()};p.apiRequest({cmd:"GetProductUsageInfo",serviceType:"cage",regionId:s.getRegionId(),data:{}}).then(function(e){e&&e.data&&e.data.isOpen?t(!0):t(!1)},function(e){t(!1)})},bindEvent:function(){var i=this;i.cdhListEl.on("click",'input[type="checkbox"]',function(e){setTimeout(function(){i.updateRenewBtn(i.gridView.getSelected())},0)}),r("#operArea").find("[data-event=cvm_oper_action]").click(function(e){if(!r("#cdhRenewBtn").hasClass("disabled")){var t=i.gridView.getSelected();0<t.length&&i.showRenewDia(t)}}),r("#operArea").find("[data-event=set_Fields]").click(function(){i.gridView.showFieldsManager()})},initGridView:function(e){var a=this,t={$data:{hasFirst:!0,orderField:"addTimeStamp",order:1,initGetData:!1,canResizeColum:!0,selectedHighlight:!1,colums:e,list:[],canSelectTotal:!1,autoMaxHeight:!0,maxHeightOffset:10,autoCheckWidth:!1,showState:!0,showPagination:!0,totalNum:0,trackKey:"uHostId",searchItemName:"专用宿主机",trAttr:{"data-uHostId":"uHostId"}},$mixins:[n("recycle_cdh_fields")],getCellContent:function(e,t,i){return a.getCellContent(e,t,i)},getHeadContent:function(e){if("cageId"===e.key)return'<grid-view-header-filter b-ref="cageFilter" b-with="{ ready: cageFilterReady.bind(this.$root),filterOptions: cagelist, col: col, change: cageChange.bind(this.$root) }"></grid-view-header-filter>'},cageFilterReady:function(e){a.cageFilter=e},cageChange:function(e){var t;e&&0<e.length&&(t=e.join(",")),a.gridView.getData({cageId:t?encodeURIComponent(t):""})},events:{"click tr [data-event=renew]":function(e){var t=r(e.target).closest("tr").attr("data-index");a.showRenewDia([a.gridView.list[t]])}},getData:function(e,t){a.renderList(e)}},i=d.getComponent("grid-view");a.gridView=new i(t)},renderBtnGroup:function(){var t=this;this.searchAreaEl=r("#searchArea");var e=d.components["qc-search"],i=this.search=new e({$data:{keyword:"",searchEmpty:!0,multiple:!1,placeholder:"请输独立宿主机ID搜索"},search:function(e){t.renderList({searchKey:e})}});this.searchAreaEl.html("").append(i.$el)},updateRenewBtn:function(e){if(e&&0<e.length){var i=[],a=[],s=[],n=[];e.forEach(function(e){var t=e.cageId||"common";a.indexOf(t)<0&&a.push(t),i.indexOf(e.externalHostType)<0&&i.push(e.externalHostType),s.indexOf(e.zoneId)<0&&s.push(e.zoneId),n.indexOf(e.projectId)<0&&n.push(e.projectId)}),1<a.length?(r("#cdhRenewBtn").addClass(" disabled"),r("#cdhRenewBtn").attr("title","不支持不同围笼内主机同时恢复")):(r("#cdhRenewBtn").attr("title",""),r("#cdhRenewBtn").removeClass(" disabled"))}else r("#cdhRenewBtn").attr("title",""),r("#cdhRenewBtn").removeClass(" disabled")},showRenewDia:function(e){var t=new l({selectedItem:e});c.create(t.$el,"700","",{title:"续费","class":"dialog_layer_v2 tc-15-rich-dialog new-gateway",preventResubmit:!0,button:{"确定":function(e){t.doAction(c)}}})},renderList:function(t){var i=this,e=((t=t||{}).page-1)*t.count||0,a={startNum:e,endNum:e+(t.count||20)-1,regionId:s.getRegionId(),orderField:t.orderField||"addTimeStamp",order:t.order,recycleFlag:1};0<=s.getProjectId()&&(a.projectId=s.getProjectId()),t.searchKey&&(0==t.searchKey.indexOf("host-")?a.uHostIdList=[t.searchKey]:a.hostAlias=t.searchKey),t.cageId&&(a.cageIdList=decodeURIComponent(t.cageId).split(",")),o.request({name:"getVpsHostList",data:a,success:function(e){i.cdhListEl.append(i.gridView.$el),i.gridView.checkCellWidth(),i.gridView.setData({list:e.hostList,totalNum:e.totalNum,searchKey:t.searchKey||!1,page:t.page||1,count:t.count||20}),e.hostList&&0<e.hostList.length||t.searchKey||i.gridView.showTips('<span class="text"></span>列表为空'),e.cageIdList&&e.cageIdList.length&&i.cageFilter&&i.cageFilter.$set("filterOptions",e.cageIdList)},fail:function(){i.gridView.setData({list:[],totalNum:0}),i.gridView.checkCellWidth(),i.gridView.showTips("系统繁忙，请稍后重试。")}})},getCellContent:function(e,t,i){switch(i.key){case"cpuTotal":return e+"核";case"memTotal":return e+"G";case"cageId":return t.cageId?"<div><p>"+(e||"-")+'</p><p><span class="text-overflow restart">'+(t.cageAlias||"未命名")+"</span></p></div>":'<span class="text-overflow">-</span>';case"diskTotal":return e+"G";case"idAndName":return u;case"cvmNumber":return isNaN(e)?"-":e;case"_operCol":return a.tmpl('<div>    <a href="javascript:void(0);"  data-event="renew" >恢复</a></div>',t);case"deadlineTimeDesc":return"<div>"+(function d(e,t){var i=new Date(e.replace(/\-/g,"/")),a=0,s="-",n=t&&!isNaN(t)?t:(new Date).getTime();if(a=n-i.getTime(),"0000-00-00 00:00:00"!=e)if(a<6048e5){var r=(7-(a=a.toFixed(2)-0)/864e5).toFixed(2).split("."),o="";if(r[1]){var o=(r[1]/100*24).toFixed(0)-0;24<=o&&(r[o=0]=parseInt(r[0])+1),o=0<o?o+"小时":""}s='<span class="text-overflow text-danger">'+r[0]+"天"+o+"后销毁</span>"}else s='<span class="text-overflow status-recover">已销毁</span>';return s}(t.deadline,t.serverTimestamp)||"-")+"</div>";default:return"<div>"+(e||"")+"</div>"}},getColumns:function(){return[{key:"idAndName",name:"ID/宿主机名",minWidth:200,required:!0,orderField:"hostAlias"},{name:"机型",key:"externalHostType",required:!0},{cageIdOnly:!0,name:"所属围笼",key:"cageId",width:150,minWidth:150},{name:"云主机",key:"cvmNumber",width:50,required:!0},{key:"cpuTotal",name:"总CPU",required:!0},{key:"memTotal",name:"总内存"},{key:"diskTotal",name:"总硬盘容量",minWidth:150},{key:"deadlineTimeDesc",name:"销毁倒计时",required:!0,orderField:"deadline",order:!0,minWidth:150},{key:"_operCol",name:"操作",required:!0,width:100,minWidth:100,locked:!0,hide:!0}]}};i.exports=m}),define("modules/cvm/recycle/recycle_cvm",function(e,t,i){var n=e("$"),o=(e("pageManager"),e("manager")),a=e("util"),r=e("appUtil"),s=(e("event"),e("projectsSelector"),e("regionSelector"),e("widget/fieldsManager/gridView")),d=a.tmpl('    <div class="id-name-cell">        <p>        <% if (item.uuid && item.uInstanceId) { %>        <%- item.uInstanceId%>        <% } %>        </p>        <div><span class="text-overflow m-width" title="<%= item.alias%>" <% if (item.canUpgradeToKvm || item.autoRenewFlag) { %> style="max-width: 70%;" <% } %> ><%= item.alias %></span>         </div>    </div>',null),c=a.tmpl('<div class="ip-cell"><p><span class="text-overflow m-width" title="公网IP: <%= deviceWanIp %>"><%= deviceWanIp %> <% if (deviceWanIp && deviceWanIp!="-") { %> <i class="net-type">(公)</i><% } %></span> <i class="copy-icon" data-clipboard-text="<%=deviceWanIp%>" style="display:none; cursor:pointer;" title="复制公网IP"></i></p><p><span class="text-overflow m-width" title="内网IP: <%= deviceLanIp %>"><%= deviceLanIp %> <% if (deviceLanIp && deviceLanIp!="-") { %><i class="net-type">(内)</i><% } %></span> <i class="copy-icon" data-clipboard-text="<%=deviceLanIp%>" style="display:none; cursor:pointer;" title="复制内网IP"></i></p>    </div>',null),l=a.tmpl('<div><span class="status-col"><span class="text-overflow text-danger">已关机</span></span></div>',null),p=a.tmpl('<span class="text-overflow" title="<%- item.deadline %>"><%- item.deadlineInfo %></span>',null),u=a.tmpl('<span class="text-overflow" title="<%- item.addTimeStamp %>"><%- item.addTimeStampFormated %></span>',null),m=a.tmpl('<div class="cvm-oper-cell" style="white-space:nowrap">        <a href="javascript:;" data-name="renew" data-event="cvm_oper_action">恢复</a></div>',null),h=(e("search"),e("router"),e("reporter")),v=e("qccomponent"),f=e("modules/cvm/recycle/data_package"),g={renew:{main:e("modules/cvm/recycle/renew_cvm"),name:"续费",hotTag:"yunzhuji.recyle.xufei"}},b='<div><div class="tc-15-msg with-margin">到期后仍未续费的云主机，会在回收站中保留7天，这期间您可以续费进行恢复。7天后，这些云主机会被彻底销毁，不可恢复。</div><div id="operArea"><div class="tc-15-action-panel"><button type="button" class="tc-15-btn m" data-event="cvm_oper_action">批量恢复</button>    <button class="tc-15-btn weak m setting" data-event="set_Fields" title="设置列表显示字段" data-hot="yunzhuji.setfields" data-grid-setting="true">    </button>    <div id="searchArea" class="pull-right"></div></div><div id="cvmList" style="position:relative"></div></div></div>',I={init:function(e,t,i){n(".tab-panel").html(b),this.cvmListEl=n("#cvmList"),this.bindEvent(),this.renderBtnGroup(),this.initGridView(),this.parent=i,this.renderList()},resetTr:function(e){for(var t=n(e).attr("data-index"),i=this.gridView,a=0,s=i.list.length;a<s;a++)i.$refs.list[a].$set({$selected:!1});i.$refs.list[t].$set({$selected:!0}),n(i.$refs.list[t].$el).find("input[disabled=true]").removeAttr("checked")},exec:function(e,t){var i=new g[e].main({listIns:this});g[e].name,g[e].hotTag;if(i){t=n.extend(!0,[],this.gridView.getSelected());n(t).each(function(e,t){t.$selected=!1}),i.hasPermItems=t,i.exec&&i.exec()}},bindEvent:function(){var t=this;this.cvmListEl;n("#operArea").find("[data-event=cvm_oper_action]").click(function(e){0<t.gridView.getSelected().length&&(h.click("yunzhuji.recyle.renew_more"),t.exec("renew",n(this).closest("tr")))}),n("#operArea").find("[data-event=set_Fields]").click(function(){t.gridView.showFieldsManager()})},initGridView:function(){var a=this,e={$data:{hasFirst:!0,orderField:"addTimeStamp",order:1,initGetData:!1,canResizeColum:!0,selectedHighlight:!1,colums:a.getColumns(),list:[],canSelectTotal:!1,autoMaxHeight:!0,maxHeightOffset:10,autoCheckWidth:!1,showState:!0,showPagination:!0,totalNum:0,trackKey:"uuid",searchItemName:"云主机"},$mixins:[s("recycle_fields")],getCellContent:function(e,t,i){return a.getCellContent(e,t,i)},events:{"click tr [data-event=cvm_oper_action]":function(e){a.resetTr(n(e.target).parents("tr")),h.click("yunzhuji.recyle.renew_single"),a.exec("renew")}},getData:function(e,t){a.renderList(e)},setTrAttr:function(e,t){return{"data-id":t.key_id}}},t=v.getComponent("grid-view");a.gridView=new t(e)},renderBtnGroup:function(){var e=this;this.searchAreaEl=n("#searchArea");var t=v.components["qc-search"],i=this.search=new t({$data:{keyword:"",searchEmpty:!0,multiple:!0,placeholder:"请输IP(换行分隔)或主机名"},search:function(){e.renderList()}});this.searchAreaEl.html("").append(i.$el)},getCvmAnalyseValue:function(e){var t=/^(?:(?:[1-9]?[0-9]|1[0-9]{2}|2(?:[0-4][0-9]|5[0-5]))\.){3}(?:[1-9]?[0-9]|1[0-9]{2}|2(?:[0-4][0-9]|5[0-5]))$/,i=null;if(e)if(i={},/\n/.test(e)){for(var a,s=e.replace(/\s+/,"\n").split("\n"),n=[],r=0;a=s[r];r++){if(!t.test(a))return tips.error("暂不支持批量模糊搜索,请检查输入");n.push(a)}i.ipList=n}else/^\d{1,3}((\.(\d{1,3})?)?){0,3}$/.test(e)?i.vagueIp=e:i.alias=e;return i},renderList:function(t){var i=(t=t||{}).page===undefined?1:t.page,a=t.count||20,e=a*(i-1),s=this,n=(this.cvmListEl,this.search.getKeyword()),r=this.getCvmAnalyseValue(n)||{};t.pid=this.parent.getProjectId(t),t.rid=this.parent.getRegionId(t),o.getCvmList({count:a,projectId:t.pid,regionId:t.rid,offset:e,method:"get",orderField:t.orderField||"addTimeStamp",order:t.order,alias:r.alias||undefined,vagueIp:r.vagueIp||undefined,ipList:r.ipList&&0<r.ipList.length?r.ipList:undefined,cmd:"recycled"},function(e){o.getProjects(function(){(s.originalData=e).deviceList&&0<e.deviceList.length&&e.deviceList.forEach(function(e){0==e.deviceClass.indexOf("VSHGPU")&&(e.$disableCheckbox=!0)}),s.listData=new f({data:e.deviceList,isPrepaidUser:e.isPrepaidUser,isBandwidthPackageUser:e.isBandWidthPackageUser,serverTimestamp:e.serverTimestamp}),s.isBandwidthPackageUser=e.isBandWidthPackageUser,s.isPrepaidUser=e.isPrepaidUser,s.cvmListEl.append(s.gridView.$el),s.gridView.checkCellWidth(),s.aliasIndex=0,s.gridView.setData({list:s.listData,totalNum:e.totalNum,page:i,count:a,orderField:t.orderField,order:t.order}),s.listData&&0<s.listData.length||s.gridView.showTips('<span class="text"></span>您查看的对象已不存在或没有权限查看'),s.cvmListEl.find("input[disabled=true]").parent().attr("data-title","GPU型实例不支持批量续费"),s.isBandwidthPackageUser&&s.cvmListEl.find('[data-orderfield="bandwidthInfo"]').find(".text-overflow").text("带宽上限")})})},getCellContent:function(e,t,i){switch(i.key){case"idName":return d({item:t});case"statusDesc":return l({item:t});case"ip":var a=t.deviceLanIp||"-",s=t.deviceWanIp||"-";return c({deviceLanIp:a,deviceWanIp:s});case"deadlineInfo":return p({item:t});case"addTimeStamp":return t.addTimeStampFormated=r.formatDate(r.getDate(t.addTimeStamp),"yyyy-MM-dd"),u({item:t});case"_operCol":return m({});default:return'<span class="text-overflow" title="'+e+'">'+(e||"")+"</span>"}},getColumns:function(){return[{key:"idName",name:"ID/主机名",width:"",minWidth:150,required:!0,order:!0,orderField:"alias"},{key:"statusDesc",name:"状态",width:120,required:!0},{key:"projectName",name:"所属项目",width:100,required:!0},{key:"netName",name:"所属网络",width:90,required:!0},{key:"ip",name:"IP地址",width:180,minWidth:180,required:!0},{key:"zoneName",name:"可用区",width:90,hide:!0},{key:"cvmPayModeDesc",name:"主机计费模式",width:150,minWidth:150,orderField:"cvmPayMode",hide:!0},{key:"networkPayModeDesc",name:"网络计费模式",width:150,hide:!0},{key:"osName",name:"操作系统",width:160,hide:!0},{key:"cpuInfo",name:"CPU",width:60,hide:!0},{key:"memInfo",name:"内存",width:60,hide:!0},{key:"sysDiskInfo",name:"系统盘",width:110,hide:!0},{key:"diskInfo",name:"数据盘",width:120,hide:!0},{key:"bandwidthInfo",name:"公网带宽",width:70,hide:!0},{key:"unImgIdInfo",name:"镜像ID",width:80,hide:!0},{key:"addTimeStamp",name:"创建时间",order:!0,orderField:"addTimeStamp",width:100,hide:!0},{key:"deadlineInfo",name:"销毁倒计时",width:140,order:!0,orderField:"deadline",required:!0,locked:!0,hide:!0},{key:"_operCol",name:"操作",required:!0,width:100,minWidth:100,locked:!0,hide:!0}]}};i.exports=I}),define("modules/cvm/recycle/renew_cbs",function(e,t,i){e("$"),e("router"),e("pageManager"),e("constants"),e("reporter");var a=e("manager"),s=(e("models/api"),e("dialog")),n=(e("lengthlimiter"),e("modules/cvm/cbs/cbs/data")),r=(e("appUtil"),e("widget/range/range"),e("widget/pills/pills")),o=e("util"),d=(e("tips"),e("modules/cvm/cbs/cbsutil")),c='    <div class="dialog_layer_cont renew-form">    <ul class="form-list">        <li>            <div class="form-label">                <label for="">续费时长</label>            </div>            <div class="form-input">            <div class="tc-15-rich-radio timetype" role="radiogroup"></div>            </div>        </li>         <li>            <div class="form-label">                <label for="">新到期时间</label>            </div>            <div class="form-input deadlinetime" >            </div>        </li>        <li>            <div class="form-label pt20">                <label for="">费用</label>            </div>            <div class="form-input pt20">                <span class="price"><span data-field="cost"></span><em>元</em></span>            </div>        </li>    </ul></div>  ',l=[{name:"1个月",value:"1"},{name:"2个月",value:"2"},{name:"3个月",value:"3"},{name:"半年",value:"6"},{name:"1年",value:"12",active:!0,ico:"ico ico_join"},{name:"2年",value:"24",ico:"ico ico_join"},{name:"3年",value:"36",ico:"ico ico_join"}];function p(){var e=u.timeTypePills.val(),t=function i(e,t){return t-=0,e?a.getNextDate(e,parseInt(t)):""}(u.item.deadlineTime,e);s.el.find(".deadlinetime").html(t),n.querryStoragePrice({inquiryType:"renew",storageId:u.item.storageId,period:e}).done(function(e){e&&s.el.find("[data-field=cost]").text(e.price/100)})}var u={};i.exports={init:function(e,t){var i,a;a=t,(u={}).item=i=(i=e)[0],s.create(o.tmpl(c,a),720,"",{title:"恢复云硬盘",preventResubmit:!1,button:{"确定":function(){var e=u.timeTypePills.val(),t=d.getCbsMetaByValue(i.storageType);n.toPay2({goodsCategoryId:100059,regionId:i.regionId,zoneId:i.zoneId,projectId:i.projectId,payMode:1,goodsDetail:{zoneId:i.zoneId,productInfo:[{name:"容量",value:i.storageSize+"GB"}],resourceId:i.storageId,cbsSize:i.storageSize,pid:t.id,timeSpan:e,timeUnit:"m",curDeadline:i.deadlineTime,mediumType:"cbs"},goodsNum:"1"}),s.hide(),a&&a.callback&&a.callback()}}}),u.timeTypePills=new r({renderTo:s.el.find(".timetype"),data:l,newMode:!0,change:function(){p()}}),u.timeTypePills.val(l[0].value),p()}}}),define("modules/cvm/recycle/renew_cvm",function(e,t,i){var s=e("$"),n=e("manager"),a=e("widget/cvmList/renew/renew_base"),r=e("dialog"),o=e("util"),d=e("appUtil"),c=e("widget/range/range"),l=e("widget/pills/pills"),p=(e("constants"),e("qccomponent")),u='    <p class="tc-15-msg"> 您需要通过续费来恢复云主机，恢复后将保持原配置。<br>续费恢复后，与云服务器关联的负载均衡、弹性云盘、基础网络互通将不恢复，需要您重新配置。<br>    支付成功后，以上设备将恢复到左侧【云主机】栏目    </p>    <div class="renewal-wrap" style="margin-top: 20px;"><% if(!cdhOnly){ %>    <ul class="form-list renewal-form"><li><div class="form-label"><span class="label">购买时长</span></div><div class="form-input"><span class="renewals"></span></div></li>    </ul>    <% if (canUpgradeBandwidth) { %><ul class="form-list renewal-form"><li><div class="form-label"><span class="label">调整带宽</span></div><div class="form-input rerange-ctrl"><a href="javascript:;" class=\'label set-bandwidth\'>调整带宽</a></div><div class="form-input rerange-wrapper" style="display:none"><div class="rerange-inner-wrapper"></div></div>            <p class="tip"></p></li></ul><% } %><% } %>        <div class="renewal-hints">            <p><strong>下列设备（共<%=len%>项）将进行续费操作</strong></p>        </div>        <div id="renewList" style="position:relative;"></div>\x3c!-- 总价 --\x3e<% if(!cdhOnly){ %>        <div class="justify-grid">          <div class="col" style="">                    <label class="form-ctrl-label"></label>     </div>            <div class="col">                <div class="total-price-wrap">                <span class="total-price-label">总计费用</span>                <span class="state-caculating" id="ctips"  style="display:none;">正在计算价格...</span>                <span class="cost">¥<strong id="realcost"></strong></span>                </div>            </div>        </div><% } %>    </div>',m=(QCMAIN_HOST,QCMAIN_HOST,[{name:"1个月",value:"1"},{name:"2个月",value:"2"},{name:"3个月",value:"3"},{name:"半年",value:"6"},{name:"1年",value:"12",active:!0,ico:"ico ico_join"},{name:"2年",value:"24",ico:"ico ico_join"},{name:"3年",value:"36",ico:"ico ico_join"}]),h=function(e){a.call(this,e)},v=function(){};v.prototype=a.prototype,((h.prototype=new v).constructor=h).prototype.superclass=a,h.prototype.exec=function(){var i=this;i.cdhOnly=!0,i.canUpgradeBandwidth=!i.listIns.isBandwidthPackageUser,i.hasPermItems.forEach(function(e){e.uHostId||(i.cdhOnly=!1),1!=e.networkPayMode&&(i.canUpgradeBandwidth=!1)});var e=o.tmpl(u,{cdhOnly:i.cdhOnly,canUpgradeBandwidth:i.canUpgradeBandwidth,bandwidth:i.hasPermItems[0].bandwidth,len:this.hasPermItems.length});if(r.create(e,"800","",{title:"恢复云主机",preventResubmit:!0,button:{"确定":function(){if(i.cdhOnly){var t=[];i.hasPermItems.forEach(function(e){e.uHostId&&t.push(e.uuid)}),0<t.length&&n.restoreCdhCvm({regionId:d.getRegionId(),uuidList:t},function(e){})}else{var e=i.getInputData();r.create("在您完成支付后，可以在控制台导航栏目【云主机】列表找到恢复的CVM。",402,"",{title:" 恢复云服务器",defaultCancelBtn:!1,preventResubmit:!0,button:{"我知道了，去支付":function(){r.hide(),i.toRenew(i.collectData(e))}}})}}}}),this.wrapper=r.el.find(".renewal-wrap"),this.renewals=this.wrapper.find(".renewals"),!i.cdhOnly){var t=m;if(1==i.hasPermItems.length&&0==i.hasPermItems[0].deviceClass.indexOf("VSHGPU")){for(var a=[],s=1;s<6;s++)a.push({name:s+"个月",value:s});a[2].active=!0,t=a}i.timePills=new l({renderTo:i.renewals,data:t,change:function(){i.refreshDevice()}})}this.bindEvt(),this.renderDeviceList()},h.prototype.renderDeviceList=function(){var a=this,e={$data:{showPagination:!1,showState:!1,canSelectTotal:!1,hasFirst:!1,maxHeight:150,minHeight:"auto",colums:[{key:"alias",name:"待续费项",minWidth:200,tdTpl:'<div><div><p class="text-overflow">云服务器：{{item.alias}}</p><p class="text-overflow text-weak">所属网络：{{item.netName}}，内网IP：{{item.deviceLanIp}}</p></div></div>'},{key:"deadline",name:"到期时间",width:150},{key:"nextLine",name:"续费后到期时间",width:200,minWidth:150}],autoMaxHeight:!1,maxHeightOffset:10},getCellContent:function(e,t,i){return"deadline"==i.key?t.uHostId?"<div>不计费</div>":"<div>"+d.formatDate(new Date(t.deadline.replace(/\-/g,"/")),"yyyy-MM-dd")+"</div>":"nextLine"==i.key?t.uHostId?"<div>不计费</div>":'<div class="text-warning">'+a.getExpires(t.deadline,a.getInputData().timespan)+"</div>":void 0},events:{},getData:function(e){}},t=p.getComponent("grid-view");this.gridView=new t(e),s("#renewList").append(this.gridView.$el),this.refreshDevice()},h.prototype.refreshDevice=function(){this.gridView.setData({list:this.hasPermItems}),this.cdhOnly||this.setPrice(),r&&r.center()},h.prototype.bindEvt=function(){var i=this;if(this.canUpgradeBandwidth){var a=i.wrapper.find(".rerange-ctrl");a.find(".set-bandwidth").on("click",function(){var e=i.wrapper.find(".rerange-wrapper"),t=e.find(".rerange-inner-wrapper");i.bandWidthRange=new c({renderTo:t,value:i.hasPermItems[0].bandwidth,min:0,max:200,unit:"Mbps",section:[{value:20,width:75},{value:50,width:150},{value:100,width:225},{value:200,width:300}],step:1,change:function(){i.setPrice()}}),a.hide(),e.show()})}else this.bandWidthRange=null},h.prototype.setPrice=function(){var e=this.collectData();this.superclass.prototype.setPrice({goodsDetail:e},function(e){s("#ctips").hide();var i=0;s(e).each(function(e,t){i+=t.realTotalCost-0}),s("#realcost").text(i/100).parent().show()})},i.exports=h}),define("modules/cvm/securitygroup/InstanceSelector",function(e,t,i){var a=e("widget/selectors/ListSelector"),r=e("models/api"),s=(e("appUtil"),a.extend({getData:function(i){var e=(i=i||{}).count||this.count,t=i.page||this.page,a=this,s=i.searchKey,n=$.extend({},this.extraParam,{limit:e,offset:e*(t-1),projectId:a.projectId,usgId:a.sgId});return s&&(/^(ins|eni)-\w{8}$/.test(s)?n.instanceId=s:n.alias=s),a.sgId&&(n.usgId=a.sgId),r.request({regionId:this.regionId,cmd:"DescribeAvailableObject",data:n,serviceType:"dfw"}).then(function(e){var t=(e=e.data).data||[];return t.forEach(function(e){1==e.available&&(e.$disable=!0,e.$disableTips="该实例已绑定这个安全组或状态不可用")}),$.extend({},i,a.parseData({list:t,totalNum:e.totalNum}))})},parseData:function(e){return e}},{defaults:{multipleSearch:!1,checkKey:"uInstanceId",colums:[{name:"云主机ID/名称",key:"uInstanceId",tdTpl:'<span b-if="item.instanceId"><p>{{item.instanceId}}</p><p class="text-overflow">{{item.name}}</p></span><span b-if="!item.instanceId">-</span>'},{name:"弹性网卡ID/名称",key:"networkInterfaceId",tdTpl:'<span b-if="item.networkInterfaceId"><p>{{item.networkInterfaceId}}</p><p class="text-overflow">{{item.eniName}}</p></span><span b-if=!item.networkInterfaceId>-</span>'}]}}));i.exports=s}),define("modules/cvm/securitygroup/add/add",function(e,t,i){var n=e("appUtil"),r=e("dialog"),o=(e("constants"),e("models/api")),d=e("pageManager"),a=e("widget/detail/detail"),s=e("qccomponent"),c=e("../components/boundInfo"),l=e("../components/templateSelector"),p=new(e("widget/baseInfo/validator"))({typeAttr:"data-validate",errClass:"is-error",rules:{remark:function(e){if(e&&100<e.length)return"备注长度已超出限制"},name:function(e){return e?60<e.length?"名称长度已超出限制":void 0:"请输入安全组名称"}}}),u=a.extend({}),m=s.extend({});m.tag("rule-list",c),m.tag("template-selector",l),i.exports={render:function(e){var a=(e=e||{}).pid||n.getProjectId(!0),t=e.rid||n.getRegionId(),i=new m('    <div>        <div class="tc-15-list-wrap" b-ref="baseinfo">            <div class="tc-15-list-content">                <ul class="form-list">                    \x3c!--<li>--\x3e                        \x3c!--<div class="form-label required">--\x3e                            \x3c!--<label for="">新建方式</label>--\x3e                        \x3c!--</div>--\x3e                        \x3c!--<div class="form-input">--\x3e                            \x3c!--<div class="form-unit">--\x3e                                \x3c!--<label class="form-ctrl-label"><input type="radio" name="rd-demo1" class="tc-15-radio" checked="checked">使用模板新建</label>--\x3e                                \x3c!--<label class="form-ctrl-label"><input type="radio" name="rd-demo1" class="tc-15-radio" checked="checked">自定义新建</label>--\x3e                            \x3c!--</div>--\x3e                        \x3c!--</div>--\x3e                    \x3c!--</li>--\x3e                    <li>                        <div class="form-label required">                            <label for="">模板</label>                        </div>                        <div class="form-input">                            <div class="form-unit">                                <template-selector region-id="{{regionId}}" b-model="tplIndex" b-ref="templateSelector" on-change="{{onTemplateChange.bind(this)}}"></template-selector>                                \x3c!--<button type="button" class="tc-15-btn m">导入</button>--\x3e                            </div>                        </div>                    </li>                    <li>                        <div class="form-label required">                            <label for="">名称</label>                        </div>                        <div class="form-input">                            <div class="form-unit is-success">                                <input title="{{sg.sgName}}" type="text" maxlength="60" class="tc-15-input-text m" data-validate="name" placeholder="请输入安全组名称" b-model="sg.sgName">                                <p class="form-input-help">还能输入{{60-sg.sgName.length}}个字符</p>                            </div>                        </div>                    </li>                    <li>                        <div class="form-label">                            <label for="">备注</label>                        </div>                        <div class="form-input">                            <div class="form-unit">                                <div class="form-unit is-success">                                    <textarea title="{{sg.sgRemark}}" class="tc-15-input-textarea m" b-model="sg.sgRemark" data-validate="remark"></textarea>                                    <p class="form-input-help" b-if="sg.sgRemark.length <= 100">还能输入{{100 - sg.sgRemark.length}}个字符</p>                                    <p class="form-input-help" b-if="sg.sgRemark.length > 100">已超出{{sg.sgRemark.length-100}}个字符</p>                                </div>                            </div>                        </div>                    </li>                </ul>            </div>        </div>        <rule-list b-ref="ingress" project-id="{{projectId}}" region-id="{{regionId}}" type="ingress" is-edit="true" hide-save-cancel="true"></rule-list>        <rule-list b-ref="egress" project-id="{{projectId}}" region-id="{{regionId}}" type="egress" is-edit="true" hide-save-cancel="true"></rule-list>        <div class="ft-buttons mt30">            <button type="button" b-ref="save" class="tc-15-btn" b-on-click="save()">新建</button>            <button type="button" class="tc-15-btn weak" b-on-click=cancel()>取消</button>        </div>    </div>',{$data:{projectId:a,regionId:t},$afterInit:function(){var t=this;p.btn=this.$refs.save,this.ingress=this.$refs.ingress,this.egress=this.$refs.egress,$(this.$el).on("change",function(e){$(t.$refs.templateSelector.$el).find(e.target).length||t.$set("changed",!0)})},validate:function(){return p.validateAll(this.$refs.baseinfo)&&this.ingress.validate({btn:p.btn})&&this.egress.validate({btn:p.btn})},save:function(){var i=this,e=i.sg||{},t=$(this.$refs.save);this.validate()&&(t.hasClass("disabled")||(t.addClass("disabled"),o.request({serviceType:"dfw",cmd:"CreateSecurityGroup",data:{projectId:a,sgName:e.sgName,sgRemark:e.sgRemark}}).then(function(e){var t=e.data.sgId;return i.ingress.editor.list.length||i.egress.editor.list.length?(i.ingress.editor.removePreRemove(),i.egress.editor.removePreRemove(),o.request({serviceType:"dfw",cmd:"ModifySecurityGroupPolicys",data:{sgId:t,ingress:i.ingress.pureRules(i.ingress.editor.list),egress:i.egress.pureRules(i.egress.editor.list)}})):e}).then(function(){t.removeClass("disabled"),s.back()},function(){t.removeClass("disabled")})))},cancel:function(){s.back()},onTemplateChange:function(e,t){var i=n.clone(e.sg),a=this;a._revert||("自定义"==i.sgName?i.sgName="":i.sgName=i.sgName+"-"+n.formatDate(new Date,"yyyyMMddhhmmssS")+(Math.random().toFixed(3)+"").slice(3),i.ingress=i.ingress.map(function(e){return a.ingress.formatRawRule(e)}),i.egress=i.egress.map(function(e){return a.egress.formatRawRule(e)}),(this.isChanged(i)?new Promise(function(e,t){r.create("更换模板后您当前所做的改动将不会保存，是否继续？",560,"",{title:"更换模板",defaultCancelCb:function(){t()},button:{"确定":function(){e(),r.hide()}}})}):Promise.resolve()).then(function(){a.ingress.editor.setData({list:i.ingress,totalNum:i.ingress.length}),a.egress.editor.setData({list:i.egress,totalNum:i.egress.length}),a.$set("changed",!1),a.$set("sg",i)},function(){a._revert=!0,a.$set("tplIndex",a.$refs.templateSelector.list.indexOf(t)),a._revert=!1}))},isChanged:function(){return this.changed}}),s=new u({$data:{title:"新建安全组",backUrl:"/cvm/securitygroup",content:i.$el}});d.appArea.html(s.$el)}}}),define("modules/cvm/securitygroup/bindCvm",function(e,t,i){var o=e("dialog"),d=e("tips"),a=(e("appUtil"),e("$")),s=e("qccomponent"),c=e("models/api"),n=e("widget/selectors/CvmSelector"),r=e("widget/selectors/EniSelector"),l=e("widget/popover/HelpTips"),p=e("reporter"),u={main:'    <div>        <form action="javascript:;">            <div class="tip_box">                <p>当实例绑定多个安全组时，新绑定的安全组将自动设为最高优先级。</p>                <p>安全组绑定私有网络云主机时，默认绑定在云主机的主网卡上。</p>            </div>            <div class="tc-15-list-det-wrap mb10">                <h4>请选择"安全组:{{sg.sgName}}"要绑定的实例</h4>                <span class="tc-15-list-det" style="float:none;">                    <span>                        <label class="tc-15-radio-wrap">                            <input type="radio" class="tc-15-radio" b-model="resType" name="type" value="cvm" />                            云主机                        </label>                    </span>                    <span>                        <label class="tc-15-radio-wrap">                            <input type="radio" class="tc-15-radio" b-model="resType" name="type" value="eni" />                            辅助弹性网卡                        </label>                        <help-tips>                            弹性网卡有主辅之分，安全组绑定云主机 即 绑定该云主机的主网卡，                            <a href="https://'+QCMAIN_HOST+'/document/product/215/6513" target="_black">点击查看主网卡、辅助网卡说明。</a>                        </help-tips>                    </span>                </span>            </div>            <div>                <cvm-selector b-ref="cvm" region-id="{{regionId}}" sg-id="{{sgId}}" project-id="{{projectId}}" search-placeholder="请输入名称/ID/IP" b-if="resType == \'cvm\'"></cvm-selector>                <eni-selector b-ref="eni" region-id="{{regionId}}" sg-id="{{sgId}}" search-placeholder="请输入名称或ID" b-if="resType == \'eni\'"></eni-selector>            </div>        </form>    </div>'},m=s.extend({$tpl:u.main});m.tag("help-tips",l);var h=n.extend({parseData:function(a){var s=this;a.list.forEach(function(e){2!=e.runflag&&4!=e.runflag&&(e.$disable=!0,e.$disableTips="运行中或者关机状态的云主机才能绑定安全组")});var e=a.list.filter(function(e){return 0!=e.vpcId&&-1!=e.vpcId}).map(function(e){return e.vpcId}),t=a.list.filter(function(e){return e.uuid}).map(function(e){return e.uInstanceId});return Promise.all([e.length?c.request({cmd:"BatchGetVpcInfo",regionId:this.regionId,data:{vpcId:e},serviceType:"vpc"}):Promise.resolve({data:[]}),t.length?c.request({cmd:"DescribeSecurityGroupsOfInstance",serviceType:"dfw",regionId:this.regionId,data:{instanceIds:t}})["catch"](function(e){return{data:[]}}):Promise.resolve({data:[]})]).then(function(e){var t=e[0].data,i=e[1].data;return t.forEach(function(t){a.list.forEach(function(e){e.vpcId==t.vpcId&&(e.unVpcId=t.unVpcId,e.vpcName=t.vpcName)})}),i.forEach(function(t){(t.sgInfo||[]).some(function(e){return e.sgId==s.sgId})&&a.list.forEach(function(e){e.uInstanceId==t.instanceId&&(e.$disable=!0,e.$disableTips="该实例已绑定这个安全组")})}),a})}},{defaults:a.extend({},n.defaults,{checkType:"checkbox",colums:[{name:"云主机ID/名称",key:"networkInterfaceId",tdTpl:'    <p class="text-overflow">        <a href="/cvm/detail/{{regionId}}/{{item.uInstanceId}}" target="_blank">            {{item.uInstanceId}}        </a>    </p>    <p class="text-overflow" title="{{item.alias}}">{{item.alias}}</p>'},{name:"所属网络",key:"vpcId",tdTpl:'    <div b-if="item.vpcId != 0 && item.vpcId != -1">        <p class="text-overflow">            <a href="/vpc/vpc?rid={{regionId}}&vpcId={{item.vpcId}}" target="_blank">                {{item.unVpcId}}            </a>        </p>        <p class="text-overflow" title="{{item.eniName}}">{{item.vpcName}}</p>    </div>    <div b-if="item.vpcId == 0 || item.vpcId == -1">        基础网络    </div>'},{name:"主 IP 地址",key:"deviceLanIp",tdTpl:'    <p b-if="item.deviceLanIp">{{item.deviceLanIp}}(内)</p>    <p b-if="!item.deviceLanIp">-</p>    <p b-if="item.deviceWanIp">{{item.deviceWanIp}}(外)</p>    <p b-if="item.deviceLanIp && !item.deviceWanIp">-</p>'}]})});h.defaults.colums.splice(3),m.tag("cvm-selector",h),m.tag("eni-selector",r.extend({parseData:function(i){var t=this.sgId,a=[];return i.list.forEach(function(e){e.groupSet.some(function(e){return e.sgId==t})&&(e.$disable=!0,e.$disableTips="该实例已绑定这个安全组"),e.instanceSet.instanceId&&a.push(e.instanceSet.instanceId),e.privateIpAddressesSet.sort(function(e,t){return e.primary?-1:1})}),a.length?c.request({regionId:this.regionId,cmd:"DescribeInstanceMainInfo",data:{uInstanceIds:a},serviceType:"cvm"}).then(function(e){return e.data&&e.data.deviceList&&e.data.deviceList.forEach(function(t){i.list.forEach(function(e){t.uInstanceId==e.instanceSet.instanceId&&(e.instanceSet.alias=t.alias,e.instanceSet.projectId=t.projectId)})}),i}):i}},{defaults:a.extend({},r.defaults,{checkType:"checkbox",extraParam:{eniType:0},colums:[{name:"弹性网卡ID/名称",key:"networkInterfaceId",tdTpl:'    <p class="text-overflow">        <a href="/vpc/eni/detail?rid={{regionId}}&id={{item.networkInterfaceId}}" target="_blank">            {{item.networkInterfaceId}}        </a>    </p>    <p class="text-overflow" title="{{item.eniName}}">{{item.eniName}}</p>'},{name:"所属网络",key:"networkInterfaceId",tdTpl:'    <div>        <p class="text-overflow">            <a href="/vpc/vpc?rid={{regionId}}&unVpcId={{item.vpcId}}" target="_blank">                {{item.vpcId}}            </a>        </p>        <p class="text-overflow" title="{{item.eniName}}">{{item.vpcName}}</p>    </div>'},{name:"IP 地址",key:"privateIpAddressesSet",tdTpl:'    <p>{{item.privateIpAddressesSet[0].privateIpAddress}} <span>（主）</span></p>    <p b-if="item.privateIpAddressesSet[1].privateIpAddress">        {{item.privateIpAddressesSet[1].privateIpAddress}}        <a target="_blank" href="/vpc/eni/detail?rid={{regionId}}&id={{item.networkInterfaceId}}&tab=1">更多</a>    </p>'}]})})),i.exports.render=function(t){var s=t.sgId,n=t.projectId,r=t.regionId;return new Promise(function(i,e){var a=new m({$data:{regionId:r,projectId:n,sg:t,sgId:s,resType:"cvm"}});o.create(a.$el,640,"",{title:"新增实例关联",defaultCancelCb:e,preventResubmit:!0,button:{"确定":function(){var t=[];return a.$refs[a.resType].list.forEach(function(e){e.$checked&&t.push(e)}),t.length?c.request({cmd:"AddObjectsToSecurityGroup",serviceType:"dfw",regionId:r,data:{sgId:s,projectId:n,objects:t.map(function(e){var t={};return(e.instanceId||e.uInstanceId)&&(t.instanceId=e.instanceId||e.uInstanceId),e.networkInterfaceId&&(t.networkInterfaceId=e.networkInterfaceId),t})}}).then(function(e){return o.hide(),d.success("操作成功"),i(),e},e):(o.hide(),e(),!1)}}}),p.click("SecurityGroup.sgAttachCVM")})}}),define("modules/cvm/securitygroup/components/baseInfo",function(e,t,i){e("appUtil");var a=e("dialog"),s=e("qccomponent"),n=e("es6-promise"),r=e("widget/pubsubhub/pubsubhub"),o=e("widget/baseInfo/validator"),d=e("models/api"),c=e("../bindCvm"),l=e("./bindCvmGrid"),p=new o({typeAttr:"data-validate",rules:{sgName:function(e){var t="安全组名称";return t=t||"",(e=$.trim(e)||"")?60<e.length?t+"不能超过60个字符":void 0:t+"不能为空"},remark:function(e){if(e&&100<e.length)return"备注长度已超出限制"},name:function(e){return e?60<e.length?"名称长度已超出限制":void 0:"请输入安全组名称"}}}),u=s.extend({$tpl:'    <div>        <div class="tc-15-list-wrap acl-inf">            <div class="head-top-title">                <h3>基本信息</h3>                <a href="javascript:;" b-on-click="edit(true)" b-if="!isEdit && !usg.sys">                    <i class="pencil-icon "></i>编辑                </a>            </div>            <form action="javascript:;" b-on-submit="save()">                <div class="tc-15-list-content bottom-line">                    <ul>                        <li>                            <em class="tc-15-list-tit">名称</em>                            <span b-if="!isEdit" class="tc-15-list-det text-truncate" style="max-width:20em;" title="{{usg.sgName}}">{{usg.sgName}}</span>                            <div class="tc-15-input-text-wrap" b-if="isEdit" data-name-field b-class="{error:\'rest<0\'}">                                <input type="text" data-validate="sgName" b-ref="input" class="tc-15-input-text" b-model="name" maxlength="{{NAME_MAX_LEN}}">                                <div class="tc-15-input-tips">{{nameTip}}</div>                            </div>                        </li>                        <li><em class="tc-15-list-tit">ID</em><span class="tc-15-list-det">{{usg.sgId}}</span>                        <li>                            <em class="tc-15-list-tit">备注</em>                            <span b-if="!isEdit" class="tc-15-list-det txt-remark" style="white-space: pre-line">{{usg.sgRemark||\'-\'}}</span>                            <span b-if="isEdit" class="tc-15-list-det">                                <textarea class="tc-15-input-textarea" style="height:auto" data-validate="remark"                                          cols="30" rows="3" value="{{usg.sgRemark}}" b-model="sgRemark"></textarea>                                <div class="tc-15-input-tips" b-if="sgRemark.length <= 100">还能输入{{100 - sgRemark.length}}个字符</div>                                <div class="tc-15-input-tips" b-if="sgRemark.length > 100">已超出{{sgRemark.length-100}}个字符</div>                            </span>                        </li>                        <li><em class="tc-15-list-tit">创建时间</em><span class="tc-15-list-det">{{usg.createTime}}</span>                        </li>                    </ul>                </div>                <div class="tc-15-page tc-15-table-panel-edit" style="margin-left: 95px;" b-if="isEdit">                    <button class="tc-15-btn" b-ref="saveBtn" type="submit">保存</button>                    <button class="tc-15-btn weak" b-on-click="cancel()">取消</button>                </div>            </form>        </div>        <div style="width: 90%;">            <div class="manage-area-title"><h3>安全组内实例</h3></div>            <div class="tc-15-action-panel">                <button class="tc-15-btn m" b-on-click="bindCvm(usg.sgId)">新增关联</button>                <button data-report="SecurityGroup.deleteInstanceEx" class="tc-15-btn weak m {{disabledUnBindBtn ? \'disabled\' : \'\'}}" b-on-click="unBind()">批量移出</button>                <qc-search search="{{search.bind(this)}}" placeholder="请输入实例ID"></qc-search>            </div>            <firewall-bind-cvm-grid project-id="{{projectId}}" region-id="{{regionId}}" b-ref="grid" count="10" usg-id="{{usg.sgId}}"></firewall-bind-cvm-grid>        </div>    </div>',NAME_MAX_LEN:60,$afterInit:function(){this.bindEvent(),this.$watch("name",function(e){var t=e.length||0;this.$set("rest",this.NAME_MAX_LEN-t)},!0),this.$watch("rest",function(e){0<=e?this.$set("nameTip","您还可以输入"+e+"个字符"):this.$set("nameTip","您输入的字符超出"+-e+"个")},!0)},$afterDestroy:function(){r.off(".baseInfo")},edit:function(e){this.$set("isEdit",e),this.$nameField=$(this.$el).find("[data-name-field]"),e&&this.$refs.input.select()},save:function(){var a=this,s=$(this.$refs.saveBtn);if(this.$set("name",$.trim(this.name)),a.name!==a.usg.sgName||a.sgRemark!==a.usg.sgRemark){if(!s.hasClass("disabled"))return!!p.validateAll(a.$el)&&(s.addClass("disabled"),new n(function(t,i){d.req({cmd:"ModifySecurityGroupAttributes",serviceType:"dfw",data:{sgId:a.usg.sgId,sgRemark:a.sgRemark,sgName:$.trim(a.name)}}).then(function(e){r.trigger("baseInfoUpdated",[a.name,a.sgRemark]),a.edit(!1),s.removeClass("disabled"),t(e.data)},function(e){s.removeClass("disabled"),i(e)})}))}else a.edit(!1)},cancel:function(){this.edit(!1),this.$set({name:this.usg.sgName,sgRemark:this.usg.sgRemark})},unBind:function(){if(!this.disabledUnBindBtn){var e=this;a.create("确认要移出所选实例?",480,"",{title:"移出实例",preventResubmit:!0,button:{"确定":function(){e.$refs.grid.unBind(e.$refs.grid.getSelected()).then(function(){a.hide(),r.trigger("dfwBindingUpdate")})}}})}},refresh:function(){this.$refs.grid.refresh()},search:function(e){this.$refs.grid.listFn({searchKey:e})},bindEvent:function(){var a=this;r.off(".baseInfo").on("baseInfoUpdated.baseInfo",function(e,t,i){a.$set("usg.sgName",t),a.$set("usg.sgRemark",i)}).on("dfwBindingUpdate.baseInfo",function(){a.refresh()}),this.$refs.grid.$watch("list",function(e){var t=this.getSelected();a.$set("disabledUnBindBtn",!t.length)},!0)},bindCvm:function(e){var t=this;c.render({sgId:e,sgName:t.name,regionId:t.regionId,projectId:t.usg.projectId}).then(function(){t.refresh()},function(){})}});u.tag("firewall-bind-cvm-grid",l),i.exports=u}),define("modules/cvm/securitygroup/components/bindCvmGrid",function(e,t,i){var s=e("qccomponent"),a=(e("appUtil"),e("es6-promise")),n=e("widget/pubsubhub/pubsubhub"),r=e("models/api"),o=(e("manager"),s.getComponent("grid-view").extend({getCellContent:function(e,t,i){var a;return"_action"===i.key?a='<a class="links {{item.$disableRemove ? \'disable\' : \'\'}}" data-title?="item.$disableRemove ? \'每个实例至少需要加入一个安全组\' : false"b-on="{click: confirmUnBind(item)}" data-report="SecurityGroup.deleteInstance" href="javascript:;">移出安全组</a>':"deviceWanIp"==i.key&&(a=e||"-"),a},getData:function(e,a){var s=this,t=e.count,i=(e.page-1)*e.count,n={sgId:this.usgId,count:t,limit:t,offset:i};e.searchKey&&(n.instanceId=e.searchKey),r.req({cmd:"DescribeObjectOfSecurityGroup",serviceType:"dfw",data:n}).then(function(e){return{list:e.data||[],totalNum:e.totalCount||0}}).then(function(t){var i=t.list;s.checkAction(i).then(function(e){a(null,{list:i,totalNum:t.totalNum})},function(){a(null,{list:i,totalNum:t.totalNum})})},a)},checkAction:function(e){var t=[],i=[];return e.forEach(function(e){e.networkInterfaceId&&0==e.eniType?i.push(e):e.instanceId&&t.push(e)}),(t.length?r.req({cmd:"DescribeSecurityGroupsOfInstance",serviceType:"dfw",data:{instanceIds:t.map(function(e){return e.instanceId})}}):a.resolve({data:[]})).then(function(e){var i=e.data;t.forEach(function(t){(i.filter(function(e){return e.instanceId==t.instanceId})[0].sgInfo||[]).length<=1&&(t.$disableCheckbox=!0,t.$disableRemove=!0)})})},confirmUnBind:function(a){return function(e){if(!a.$disableRemove){var t=$(e.target),i=this.$root;(t.data("qc-popover")||new(s.getComponent("popup-confirm"))({$data:{title:"确认要将该实例移出安全组? ",style:"width: 310px;"},handler:e.target,onConfirm:function(){var e=t.closest("tr[data-index]").attr("data-index");i.unBind([i.list[e]]).then(function(){n.trigger("dfwBindingUpdate")})}})).show()}}},unBind:function(i){var a=this;return a.list.forEach(function(t,e){i.some(function(e){return e===t})&&a.updateItem(e,{$loading:!0,$disable:!0})}),r.req({cmd:"DelObjectsToSecurityGroup",serviceType:"dfw",data:{sgId:this.usgId,objects:i.map(function(e){var t={};return e.instanceId&&(t.instanceId=e.instanceId),e.networkInterfaceId&&(t.networkInterfaceId=e.networkInterfaceId),t})}})}},{defaults:{autoMaxHeight:!1,maxCount:30,colums:[{name:"实例ID/名称",key:"instaceId",tdTpl:'    <div b-if="item.eniType != 0">        <a data-event=nav href="/cvm/detail/{{regionId}}/{{item.instanceId}}">{{item.instanceId}}</a>        <p class="text-overflow">{{item.alias}}</p>    </div>    <div b-if="item.eniType == 0">        <a data-event=nav href="/vpc/eni/detail?rid={{regionId}}&id={{item.networkInterfaceId}}">{{item.networkInterfaceId}}</a>        <p class="text-overflow">{{item.eniName}}</p>    </div>    <div b-if="!item.instanceId && !item.networkInterfaceId">        无    </div>'},{name:"实例类型",key:"_type",thTpl:'    <span>        {{col.name}}    </span>    <div class="tc-15-bubble-icon tc-15-triangle-align-center">        <i class="tc-icon icon-what"></i>        <div class="tc-15-bubble tc-15-bubble-top">            <div class="tc-15-bubble-inner">安全组可绑定云主机和弹性网卡，绑定私有网络内的云主机即绑定该云主机上的主网卡。</div>        </div>    </div>',tdTpl:"{{item.eniType == 0 ? '辅助弹性网卡' : '云主机'}}"},{name:"所属网络",key:"vpcId",tdTpl:'    <div b-if="item.vpcId">        <a data-event=nav href="/vpc/vpc?rid={{regionId}}&unVpcId={{item.vpcId}}">{{item.vpcId}}</a>        <p class="text-overflow">{{item.vpcName}}</p>    </div>    <div b-if="!item.vpcId">基础网络</div>'},{name:"操作",key:"_action",width:200}]}}));i.exports=o}),define("modules/cvm/securitygroup/components/boundInfo",function(e,t,i){var a=e("qccomponent"),d=e("$"),n=e("appUtil"),s=e("util"),r=e("constants"),o=e("es6-promise"),c=e("widget/pubsubhub/pubsubhub"),l=e("./ruleValidator"),p=e("dialog"),u=e("models/api"),m=e("./import/import"),h=e("../createLimitsMixin"),v=e("reporter"),f=e("./protos"),g='<div b-style="{width:isEdit ? \'\' : \'90%\'}">    <div class="manage-area-title">        <div class="head-top-title">            <h3>{{type == \'ingress\' ? \'入站\' : \'出站\'}}规则列表</h3>            <a b-if="!isEdit" href="javascript:;" b-on-click="edit()"><i class="pencil-icon "></i>编辑</a>        </div>        <p class="explain-inf">            \x3c!--规则说明--\x3e        </p>    </div>    <div class="firewall-out-btn-wrap" b-if="isEdit" style="padding-top:10px;">        <button type="button" class="tc-15-btn m {{supportImport ? \'\' : \'disabled\'}}"                data-title?="supportImport ? false : \'该功能需要IE10+或chrome支持, 请升级您的浏览器\'"                b-on-click="importRule()">批量导入</button>        <button type="button" b-if="usg" class="tc-15-btn m" b-on-click="exportRule()">导出规则</button>        <button type="button" b-if="type == \'ingress\'" data-report="SecurityGroup.modifyRule.oneKeyFix" class="tc-15-btn m pay" b-on-click="bugfix()">封堵安全漏洞</button>    </div>    <div b-if="!isEdit">        <firewall-rules-grid type="{{type}}" b-ref="grid" get-list="{{getList.bind(this)}}"></firewall-rules-grid>    </div>    <div>        <div b-style="{display: isEdit ? \'block\' : \'none\'}">            <firewall-rules-editor type="{{type}}" b-ref="editor"                                   max-size="{{maxSize}}"                                   region-id="{{regionId}}"                                   sg-id="{{usg.sgId}}"                                   get-list="{{getList.bind(this)}}"></firewall-rules-editor>            <div class="tc-15-table-panel" title="默认规则不可编辑" style="position: static">                <div class="tc-15-table-fixed-body">                    <table class="tc-15-table-box tc-15-table-rowhover">                        <colgroup>                            <col style="width:50px;"/>                            <col style="width: 170px; ">                            <col style="width: 150px; ">                            <col style="width: 350px; ">                            <col style="width: 100px; ">                            <col style="width: auto; ">                            <col style="width:100px;"/>                        </colgroup>                        <tbody>                        <tr>                            <td></td>                            <td>                                <div>                                    <span class="text-overflow">All traffic</span>                                </div>                            </td>                            <td>                                <div>                                    <span class="text-overflow" title="ALL">ALL</span>                                </div>                            </td>                            <td>                                <div>                                    <span class="text-overflow" title="0.0.0.0/0">0.0.0.0/0</span>                                </div>                            </td>                            <td>                                <div>                                    <span class="text-overflow">拒绝</span>                                </div>                            </td>                            <td></td>                            <td></td>                        </tr>                        </tbody>                    </table>                </div>            </div>            <div b-if="isEdit && !overSize" style="margin: 13px ">                <a href="javascript:;" b-on-click="addRule()">                    + 新增一行                </a>            </div>            <div class=\'tc-15-page tc-15-table-panel-edit\' b-if="!hideSaveCancel">                <button class="tc-15-btn" data-save b-on-click="save()">保存</button>                <button class="tc-15-btn weak" b-on-click="cancel()">取消</button>            </div>        </div>    </div></div>',b='    <span class="text-overflow">{{col.name}}</span>    <div class="tc-15-bubble-icon tc-15-triangle-align-center">        <i class="tc-icon icon-what"></i>        <div class="tc-15-bubble tc-15-bubble-top">            <div class="tc-15-bubble-inner">请输入端口号或端口范围，例如1 或 2,3 或 3-6</div>        </div>    </div>',I='    <span class="text-overflow tc-15-input-text-wrap">        <input type="text" disabled?="item._remove || item._disablePortEdit"               style="width: 100px"               data-validate="port"               placeholder="1 或 2,3 或 3-6"               data-port-input               b-model="item.portRange" class="tc-15-input-text {{item._remove || item._disablePortEdit ? \'disabled\' : \'\'}}" />    </span>',y='    <span class="text-overflow">{{type=="ingress" ? "来源" : "目标"}}</span>    <div class="tc-15-bubble-icon tc-15-triangle-align-center">        <i class="tc-icon icon-what"></i>        <div class="tc-15-bubble tc-15-bubble-top">            <div class="tc-15-bubble-inner">请选择安全组ID 或者输入IP/网段，不填表示所有IP，示例：10.0.0.1或10.0.0.0/16</div>        </div>    </div>',w='    <div class="tc-15-select-wrap m">        <select b-on="{change: preSetRule}" b-model="item._proto"                class="tc-15-select {{item._remove ? \'disabled\' : \'\'}}" disabled?="item._remove">            <option b-repeat="p in protos" selected?="item._proto === p.name"                    data-proto="{{p.proto}}" data-port="{{p.port}}" data-port-edit?="p.portEdit"                    value="{{p.name}}">{{p.name}}</option>        </select>    </div>',x='    <span class="text-overflow">        <input type="text" b-model="item.desc" maxlength="100" style=""               class="tc-15-input-text tc-15-input-text-wrap l">    </span>',k='    <select style="min-width: 65px" class="tc-15-select m {{item._remove ? \'disabled\' : \'\'}}" b-model="item.action" disabled?="item._remove">        <option value="ACCEPT">允许</option>        <option value="DROP">拒绝</option>    </select>',C={action:"DROP",cidrIp:"0.0.0.0/0",portRange:"ALL"};function T(e){for(var t,i=0;t=f[i];i++)if(t.proto===e)return t.name}var D,P=a.extend({$tpl:g,$mixins:[h({maxSize:h.Limit.Rule})],$afterInit:function(){var e=this;P.__super__.$afterInit.call(this),this.editor=this.$refs.editor,this.refresh(),this.bindEvent(),this.isEdit&&this.getList().then(function(){e.edit()})},edit:function(){var e=n.clone(this.list),t=this.editor;this.$set("isEdit",!0),t.resize(),l.btn=d(this.$el).find("[data-save]")[0],t.setData({list:e,totalNum:e.length}),e.length||t.showTips(t.emptyTips)},validate:function(e){return(e=e||{}).btn&&(l.btn=e.btn),l.validateAll(this.$el)},pureRules:function(e){return e=e.map(function(e){var t={};for(var i in e)0!==i.indexOf("_")&&(t[i]=e[i]);return t.portRange&&t.portRange.trim&&(t.portRange=t.portRange.trim()),"-"!==t.portRange&&"ALL"!==t.portRange||(t.portRange=""),"ip"==e._idType?delete t.sgId:"id"==e._idType&&delete t.cidrIp,t})},save:function(){var e;this.validate()&&(this.editor.removePreRemove(),this.list=this.editor.list,(e=d.extend({projectId:n.getProjectId(!0),sgId:this.usg.sgId},this._rules))[this.type]=this.list,e.ingress=this.pureRules(e.ingress),e.egress=this.pureRules(e.egress),e.ingress.length||(e.ingress=[""]),e.egress.length||(e.egress=[""]),u.req({cmd:"ModifySecurityGroupPolicys",serviceType:"dfw",data:e}).then(function(){c.trigger("updated.detail")}))},cancel:function(){this.$set("isEdit",!1)},getList:(D={},function(){var a=this;if(a.usg){var s=a.usg.sgId;return D[s]=D[s]||u.req({cmd:"DescribeSecurityGroupPolicys",serviceType:"dfw",data:{sgId:a.usg.sgId}}),D[s].then(function(e){delete D[s];var t=e.data;a._rules=n.clone(t);var i=t[a.type];return i.forEach(function(e){a.formatRawRule(e)}),a.list=i},function(e){throw delete D[s],e})}var e=[];return a.list=e,o.resolve(e)}),formatRawRule:function(e){return e.sgId?e._idType="id":(e.cidrIp=e.cidrIp||"0.0.0.0/0",e._idType="ip"),e.portRange=e.portRange||"ALL","icmp"==e.ipProtocol&&(e.portRange="-"),e._disablePortEdit="icmp"===e.ipProtocol||!e.ipProtocol,e._proto=T(e.ipProtocol),e},refresh:function(){this.editor.refresh(),this.$refs.grid&&this.$refs.grid.refresh()},importRule:function(){this.supportImport&&m.render({rules:this.list,type:"ingress"===this.type?"input":"output",sgs:this.editor.sgs,maxSize:this.maxSize})},exportRule:function(e){var t=this.usg&&this.usg.sgId,i={t:Date.now(),uin:s.getUin(),csrfCode:s.getACSRFToken(),usgId:t,regionId:n.getRegionId(),dir:"ingress"===this.type?"input":"output",isTemplate:e};window.open("/cgi/firewall?action=exportUSGPolicy&"+d.param(i))},downloadTpl:function(){this.exportRule(!0)},addRule:function(){this.isEdit&&this.editor.insert(this.editor.list.length)},bugfix:function(){var e=this;p.create('    <div class="tc-15-rich-dialog confirm">    <p class="tc-15-msg">        您好，我们发现Windows系统有<a href="/announce/detail?regionId=-1&announceId=13" target="_blank">SMB\\RDP远程命令执行漏洞</a>。微软已经发出通告，        强烈建议您<b style="font-weight: bold">更新最新补丁</b>，或<b style="font-weight: bold">修改安全组规则</b>    </p>    <br />    <p class="tc-15-msg"> 为了保证系统的安全性，我们建议您关闭安全组的<b style="font-weight: bold">【TCP协议下 137、139、445端口全部入网规则】和【UDP协议下 137、445端口全部入网规则】</b>，点击【增加规则】即为该安全组添加该封堵规则。    </p>    <br />    <p class="tc-15-msg"> 如果当前安全组下仅为<b style="font-weight: bold">Linux系统可以忽略</b>这个功能。     </p>    <br />    <p class="tc-15-msg"> 在执行之前请您确认这些端口没有业务。如果您的业务受影响，可以删除相应的拒绝规则。     </p>    <br />    <p class="tc-15-msg">         同时，建议您使用安全组公网入策略限制<b style="font-weight: bold">远程登录源IP地址</b>，一般端口默认为：3389。    </p>    </div>',650,"",{title:"封堵 Windows 高危漏洞端口",struct:"rich",button:{"增加规则":function(){e.isEdit&&(e.editor.insert(0,{_proto:"TCP",ipProtocol:"tcp",action:"DROP",cidrIp:"0.0.0.0/0",portRange:"137,139,445",desc:"封堵Windows系统SMB远程命令执行漏洞的端口"}),e.editor.insert(1,{_proto:"UDP",ipProtocol:"udp",action:"DROP",cidrIp:"0.0.0.0/0",portRange:"137,445",desc:"封堵Windows系统SMB远程命令执行漏洞的端口"})),p.hide(),v.click("SecurityGroup.modifyRule.oneKeyFix.confirm")}}})},bindEvent:function(){var s=this;this.editor.$watch("overMaxSize",function(e){s.$set("overSize",e)}),c.off(".dwf."+this.type).on("import.dwf."+this.type,function(e,t){var i=s.editor;s.isEdit&&(t=t.map(function(e,t){var i;t>=s.maxSize&&(e._remove=!0);var a=e.proto&&e.proto.toLowerCase();return"all"==a&&(a=undefined),i=function n(e){for(var t,i=e&&e.toUpperCase(),a=e&&e.toLowerCase(),s=0;t=f[s];s++)if(i==t.name||a==t.proto)return t}(a),d.extend({_disablePortEdit:"icmp"===a||!a,_proto:i.name},e,{ipProtocol:i.proto})}),i.setData({list:t,totalNum:t.length}),i.checkSize())}).on("export.dwf."+this.type,function(){s.exportRule()}).on("downloadTpl.dwf."+this.type,function(){s.downloadTpl(!0)})},$afterDestroy:function(){c.off(".dwf")}},{defaults:{supportImport:!!window.FileReader,maxSize:r.MAX_FIREWALL_RULE_SIZE}});P.tag("firewall-rules-grid",a.getComponent("grid-view").extend({getData:function(e,t){this.getList().then(function(e){(e=e.slice()).push(C),t(null,{list:e,totalNum:e.length})},t)},getCellContent:function(e,t,i){var a,s='<span class="text-overflow">';switch(i.key){case"ipProtocol":for(var n=0,r=f.length;n<r;n++)if(f[n].proto===e){a=f[n].name;break}s+=a;break;case"action":s+="ACCEPT"==e?"允许":"拒绝";break;default:s=""}return s&&(s+="</span>"),s}},{defaults:{hasFirst:!1,showPagination:!1,showState:!1,colums:[{name:"规则协议",key:"ipProtocol"},{name:"端口",key:"portRange",width:120},{name:"IP",key:"cidrIp",tdTpl:'    <span class="text-overflow">        {{item.cidrIp}}        <a href="/cvm/securitygroup/detail/{{item.sgId}}" data-event="nav" b-if="item.sgId">{{item.sgId}}</a>    </span>',thTpl:'<span class="text-overflow">{{type=="ingress" ? "来源" : "目标"}}</span>'},{name:"策略",key:"action"},{name:"备注",key:"desc",tdTpl:'<span class="text-overflow" title="{{item.desc}}">{{item.desc?item.desc:"-"}}</span>'}]}}));var S,_=a.getComponent("grid-editor");P.tag("firewall-rules-editor",_.extend({$afterInit:function(){this.$watch("maxSize",function(){this.checkSize()}),this.$on("sizeChange",function(){this.overMaxSize?(this.overSizeTips||this.showTips("配额达到上限，最多只能创建 "+this.maxSize+" 条"+("output"===this.type?"出站":"入站")+"规则，请提工单申请更多配额"),this.overSizeTips=!0):(this.overSizeTips&&this.hideTips(),this.overSizeTips=!1),d(this.$el).trigger("change")}),_.prototype.$afterInit.call(this),this.checkWidth()},actionTpl:'<span class="text-overflow"><a href="javascript:;" class="links" b-on-click="(item._remove ? restore : preRemove)($parent.$index)">{{item._remove ? "恢复" : "删除"}}</a></span>',preSetRule:function(e){var t=this.$root,i=d(e.target),a=i.children("option:selected");i.find("option").removeAttr("selected"),a.prop("selected","selected");var s=a.data(),n=i.closest("tr").attr("data-index"),r=t.list[n],o={_disablePortEdit:!s.portEdit,ipProtocol:s.proto};(s.port||"-"===r.port||"ALL"===r.port)&&(o.portRange=s.port),t.updateItem(n,o)},getSgs:function(){var e=n.getProjectId(!0);return(S=S||u.req({cmd:"DescribeSecurityGroups",serviceType:"dfw",data:{projectId:-1==e?"0":e}})).then(function(e){return S=null,e},function(e){throw S=null,e})},getData:function(e,s){var n=this;o.all([this.getList(),this.getSgs()]).then(function(e){var t=e[0],i=e[1].data,a=t.map(function(e){return d.extend({_disablePortEdit:"icmp"===e.ipProtocol||!e.ipProtocol,_proto:T(e.ipProtocol)},e)});n.$set("sgs",i),s(null,{list:a,totalNum:a.length}),n.checkSize()},s)},events:{"keydown [data-validate]":function(e){setTimeout(function(){d(e.target).parent().hasClass(l.errClass)&&l.validate(e.target,{noTips:!0})},0)}},onReorder:function(){d(this.$el).trigger("change")}},{defaults:{protos:f,canResizeColum:!1,maxSize:r.MAX_FIREWALL_RULE_SIZE,emptyTips:'没有自定义规则 <a b-on-click="insert(0)" href="javascript:;">+新增</a>',newData:{ipProtocol:"tcp",portRange:"",cidrIp:"",action:"ACCEPT"},sgs:[],colums:[{name:"规则协议",key:"ipProtocol",tdTpl:w,width:170},{name:"端口",key:"portRange",thTpl:b,tdTpl:I,width:150},{name:"IP",key:"cidrIp",thTpl:y,tdTpl:'    <span class="text-overflow tc-15-input-text-wrap">        <div class="tc-15-select-wrap s">            <select class="tc-15-select" name="idType" b-model="item._idType">                <option value="ip">IP或CIDR</option>                <option value="id">安全组ID</option>            </select>        </div>        <input type="text" data-validate="ip"  b-if="item._idType == \'ip\'"               placeholder="例如10.0.0.1或10.0.0.0/16"               disabled?="item._remove" b-model="item.cidrIp" class="tc-15-input-text" />        \x3c!--<div b-if="item._idType == \'id\'" class="tc-15-select-wrap m">--\x3e            \x3c!--<select class="tc-15-select" name="id" b-model="item.sgId">--\x3e                \x3c!--<option value="{{sg.sgId}}" b-repeat="sg in sgs"--\x3e                        \x3c!--title="{{sg.sgId}}/{{sg.sgName}}">{{sg.sgId}}/{{sg.sgName}}</option>--\x3e            \x3c!--</select>--\x3e        \x3c!--</div>--\x3e    </span>    <sg-selector b-if="item._idType == \'id\'" sgs="{{sgs.slice()}}" b-model="item.sgId"></sg-selector>',width:380},{name:"策略",key:"action",tdTpl:k,width:100},{name:"备注",key:"desc",tdTpl:x,minWidth:200},{name:"操作",key:"_action",width:100}]}}));var E=a.getComponent("qc-select").extend({$valuekey:"sgId",$afterInit:function(){E.__super__.$afterInit.call(this),this.$set("list",this.sgs.map(function(e){return{label:e.sgId+"/"+e.sgName,value:e.sgId}})),this.$watch("selected",function(e){this.$set("sgId",e.value)}),this.$watch("sgId",function(t){this.$set("selected",this.list.filter(function(e){return e.value==t})[0])})},onSelect:function(){d(this.$el).trigger("change")}},{defaults:{styleType:1,filter:!0,sgs:[]}});P.tag("sg-selector",E),i.exports=P}),define("modules/cvm/securitygroup/components/copy/copy",function(e,t){var a=e("dialog"),i=(e("widget/region/regionPills"),e("qccomponent")),d=e("manager"),c=e("appUtil"),l=e("$"),s=e("widget/baseInfo/validator"),n=e("models/firewall"),r=e("models/api"),o=new s({errClass:"is-error",rules:{name:function(e){return e?60<e.length?"名称超过60字符限制。":void 0:"请输入安全组名称"}}}),p=i.extend({$afterInit:function(){p.__super__.$afterInit.call(this),this.getRegionList(),this.getProjectList(),this.checkSgIdLink()},checkSgIdLink:function(){var t=this;r.req({serviceType:"dfw",cmd:"DescribeSecurityGroupPolicys",data:{sgId:this.src.sgId}}).then(function(e){var t=!1;for(var i in e=e.data)t=t||e[i]&&e[i].some&&e[i].some(function(e){return e.sgId});return t||!1}).then(function(e){t.$set("hasSgIdLink",e)})},getRegionList:function(){var s,e,t,n=this,r=this.whiteList||[],o=this.destRegionId||c.getRegionId();t="function"==typeof this.getWhiteList?this.getWhiteList():l.Deferred().resolve(r),e=l.Deferred(),d.queryRegion(e.resolve,e.reject),l.when(t.done(function(e){r=e}),e.done(function(e){s=c.clone(e)})).done(function(){var t,e=[],i=c.getRegionOrderHackObj(s);for(var a in i)a=a.replace("_",""),r.length&&r.indexOf(a)<0?delete s[a]:e.push({regionName:s[a],regionId:a});e.forEach(function(e){e.regionId===o&&(t=e)}),setTimeout(function(){n.$set({regionList:e,destRegionId:(t||e[0]).regionId})},0)})},getProjectList:function(){var i=this;return new Promise(function(t,e){d.getProjects(function(e){i.$set("projectList",e.data),t(e.data)},e)})}});t.render=function(e,t){var i=new p('    <form action="javascript:;">        <style>            .form-input {                line-height: 27px;            }        </style>        <p class="tc-msg common row" style="margin-bottom: 20px;">克隆过程，只将原安全组出入口规则克隆，云主机需另行关联。</p>        <ul class="form-list">            <li b-if="projectList.length">                <div class="form-label">                    <label for="">目标项目</label>                </div>                <div class="form-input">                    <div class="tc-15-select-wrap m" style="position: relative"                         data-title?="hasSgIdLink && \'当前安全组引用了本项目下其他安全组的ID，暂不支持克隆到其他项目\'">                        <div b-if="hasSgIdLink" style="position: absolute;width: 100%;height: 100%;top:0">                        </div>                        <select name="projectId" b-model="destProjectId"                                disabled?="hasSgIdLink!==false" class="tc-15-select" style="width: 280px;">                            <option b-repeat="project in projectList"                                    selected?="project.projectId == projectId"                                    value="{{project.projectId}}">{{project.name}}                            </option>                        </select>                    </div>                    <input type="hidden" name="destProjectId" value="{{destProjectId}}">                </div>            </li>            <li>                <div class="form-label">                    <label for="">目标地域</label>                </div>                <div class="form-input">                    <div class="tc-15-select-wrap m" style="position: relative"                         data-title?="hasSgIdLink && \'当前安全组引用了本地域下其他安全组的ID，暂不支持克隆到其他地域\'">                        <select b-model="destRegionId" class="tc-15-select" disabled?="hasSgIdLink!==false" style="width: 280px;">                            <option b-repeat="item in regionList" value="{{item.regionId}}">{{item.regionName}}</option>                        </select>                    </div>                    <input type="hidden" name="destRegionId" value="{{destRegionId}}">                </div>            </li>            <li>                <div class="form-label">                    <label for="">原名称</label>                </div>                <div class="form-input">                    <p>{{src.sgName}}</p>                </div>                <input type="hidden" name="srcSgId" value="{{src.sgId}}">            </li>            <li>                <div class="form-label">                    <label for="">新名称</label>                </div>                <div class="form-input form-unit">                    <input type="text" b-model="sgName" data-validate="name"                           placeholder="请输入安全组的名称" class="tc-15-input-text">                    \x3c!--<div class="form-input-help">还能输入{{60-(sgName.length||0)}}个字符</div>--\x3e                </div>            </li>        </ul>    </form>',{$data:{src:t,projectId:t.projectId||c.getProjectId(!0)}});a.create(i.$el,520,"",{title:"克隆安全组",preventResubmit:!0,button:{"确定":function(){o.btn=a.getBtn(0),o.validateAll(i.$el)?n.request({name:"copy",data:{srcSgId:t.sgId,destRegionId:i.destRegionId,destProjectId:i.destProjectId||"0",sgName:i.sgName},success:function(){a.hide(),e.refreshList()}}):a.toggleBtnDisable(!1,0)}}}),l(i.$el).find("input:visible").focus()}}),define("modules/cvm/securitygroup/components/delete/delete",function(e,t,i){e("$");var a=e("util"),s=(e("appUtil"),e("dialog")),n=e("tips"),r=e("models/api"),o="    确认删除当前所选安全组",d={render:function(e,t){var i=this;s.create('<i class="ico ico-warn mr10"></i>'+a.tmpl(o,{}),450,null,{title:"删除安全组",preventResubmit:!0,button:{"确定":function(){i.del(t,0,e)}}})},del:function(e,t,i){var a=this;r.req({cmd:"DeleteSecurityGroup",serviceType:"dfw",data:{forced:t,sgId:e}}).then(function(){i.refreshList(),n.success("删除成功"),a.destroy()})},destroy:function(){s.hide()}};i.exports=d}),define("modules/cvm/securitygroup/components/import/import",function(a,e,t){var p=a("dialog"),s=a("qccomponent"),u=a("widget/csvToArray/csvToArray"),n=a("widget/pubsubhub/pubsubhub"),m=a("../ruleValidator"),r=(a("appUtil"),a("constants")),h={input:{proto:"规则协议",port:"端口",ip:"来源",id:"来源",action:"策略",desc:"备注"},output:{proto:"规则协议",port:"端口",ip:"目标",id:"目标",action:"策略",desc:"备注"}};function v(e){return btoa(function a(e){for(var t="",i=0;i<e.byteLength/10240;++i)t+=String.fromCharCode.apply(null,new Uint8Array(e.slice(10240*i,10240*i+10240)));return t+=String.fromCharCode.apply(null,new Uint8Array(e.slice(10240*i)))}(e))}t.exports={render:function(e){var c=this,t=(e=e||{}).rules,i=e.type,o=e.sgs,d=e.maxSize||r.MAX_FIREWALL_RULE_SIZE,l=this.bee=new s('    <div class="form-wrap adjust-band-max">        <div class="form-input form-input-file" style="display: block">            <div class="tc-15-msg psw-edit-msg firewall-out-msg ">                <p b-if="hasRule">                    <span>注意：批量导入将以覆盖方式导入规则，请注意提前</span><a href="javascript:;" b-on-click="exportRule()">导出现有规则</a>                </p>                <p b-if="!hasRule">                    <span>您可以先下载规则模板修改后导入</span>                    <a href="javascript:;" b-on-click="downloadTpl()">下载模板</a>                </p>            </div>        </div>        <ul class="form-list">            <li>                <div class="form-label form-input-file-label">                    <label>选择文件</label>                </div>                <div class="form-input form-input-file">                    <div class="tc-15-input-text-wrap m">                        <input value="{{fileName}}" type="tetx" class="tc-15-input-text">                        <button type="button" class="tc-15-btn m weak">选择文件...</button>                    </div>                    <div class="form-input-file-hide-wrap">                        <input type="file" class="form-input-file-hide" b-on="{change: _handleFile}"                               accept=".csv, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, application/vnd.ms-excel">                    </div>                </div>            </li>            <li b-if="fileName">                <div class="form-label form-input-file-label">                    <label></label>                </div>                <div class="form-input form-input-file">                    <div class="firewall-out-tips">                        <span b-if="fileError" style="color: red">                            导入的规则文件的格式错误，请重新选择您要导入的规则文件！                        </span>                        <span b-if="!fileError">                            <i b-class="(valid && !overSize) ? \'n-success-icon\' : \'n-error-icon\'"></i>                            <span b-if="overSize">导入的规则数量超出 {{maxSize}} 条的限制!</span>                            <span b-if="!overSize">                                <span b-if="valid">共{{rules.length}}条规则，将以覆盖方式全部导入。</span>                                <span b-if="!valid">                                    共{{rules.length}}条规则, 其中 {{inValidNum}} 条出错, 请重新选择文件                                </span>                            </span>                            <a href="javascript:;" b-on-click="toggleRule()">查看数据</a><i b-class="_unfold ? \'blue-up-icon\' : \'blue-down-icon\'"></i>                        </span>                    </div>                    <div class="table-wrap" b-if="_unfold && !fileError">                        \x3c!----\x3e                        <div class="tc-15-table-panel">                            <div class="tc-15-table-fixed-head">                                <table class="tc-15-table-box">                                    <colgroup>                                        <col class="tc-15-table-col1">                                        <col class="tc-15-table-col2">                                        <col class="tc-15-table-col3">                                        <col class="tc-15-table-col4">                                        <col class="tc-15-table-col5">                                        <col class="tc-15-table-col6">                                        <col class="tc-15-table-col7">                                    </colgroup>                                    <thead>                                    <tr tabindex="0">                                        <th class="first-td">                                            <div></div>                                        </th>                                        <th>                                            <div>                                                <span>协议</span>                                            </div>                                        </th>                                        <th>                                            <div>                                                <span>端口</span>                                            </div>                                        </th>                                        <th>                                            <div>                                                <span>{{type === \'input\' ? \'来源\' : \'目标\'}}</span>                                            </div>                                        </th>                                        <th>                                            <div>                                                <span>策略</span>                                            </div>                                        </th>                                        <th>                                            <div>                                                <span>备注</span>                                            </div>                                        </th>                                        <th>                                            <div class="text-center">                                                <span>校验</span>                                            </div>                                        </th>                                    </tr>                                    </thead>                                </table>                            </div>                            <div class="tc-15-table-fixed-body" style="max-height:330px;">                                <table class="tc-15-table-box tc-15-table-rowhover">                                    <colgroup>                                        <col class="tc-15-table-col1">                                        <col class="tc-15-table-col2">                                        <col class="tc-15-table-col3">                                        <col class="tc-15-table-col4">                                        <col class="tc-15-table-col5">                                        <col class="tc-15-table-col6">                                        <col class="tc-15-table-col7">                                    </colgroup>                                    <tbody>                                    <tr tabindex="0" b-repeat="rule in rules">                                        <td class="first-td">                                            <div>{{$index + 1}}</div>                                        </td>                                        <td>                                            <div>{{rule.proto}}</div>                                        </td>                                        <td>                                            <div>{{rule.port}}</div>                                        </td>                                        <td>                                            <div>{{rule.ip || rule.id}}</div>                                        </td>                                        <td>                                            <div>{{rule._action}}</div>                                        </td>                                        <td>                                            <div>{{rule.desc}}</div>                                        </td>                                        <td>                                            <div class="text-center">                                                <i data-title?="rule._isValid ? false : \'该条规则不符合导入规则, 请修改后重试\'" b-class="rule._isValid ? \'n-success-icon\' : \'n-error-icon\'"></i>                                            </div>                                        </td>                                    </tr>                                    </tbody>                                </table>                            </div>                        </div>                        \x3c!----\x3e                    </div>                </div>            </li>        </ul>    </div>',{$data:{hasRule:!!t.length,type:i,keys:h[i],_unfold:!0},$afterInit:function(){this._type="input"==this.type?"ingress":"egress",this.$watch("valid && !fileError",function(e){c.dialog.find(".btn:first")[e?"removeClass":"addClass"]("btn_unclick")})},_handleFile:function(e){var t=e.target.files[0],i=new FileReader,o=/\.csv/i.test(t.name),d=!!i.readAsBinaryString;l.$set("fileName",t.name),i.onload=function(e){var t,i,s,a,n=e.target.result,r=!1;try{t=o?(a=u(n.trim(),","),s=a.shift(),a.map(function(i){var a={};return s.forEach(function(e,t){a[e]=i[t]}),a})):(d||(n=v(n)),i=c.xlsx.read(n,{type:d?"binary":"base64"}),c.xlsx.utils.make_json(i.Sheets[i.SheetNames[0]]))}catch(e){t=[],r=!0}t=l.parseRule(t),l.$set({rules:t,fileError:r}),p.center()},o?i.readAsText(t):i[d?"readAsBinaryString":"readAsArrayBuffer"](t)},importRule:function(){this.rules&&this.rules.length&&n.trigger("import.dwf."+this._type,[this.rules.slice()]),c.destroy()},exportRule:function(){n.trigger("export.dwf."+this._type)},downloadTpl:function(){n.trigger("downloadTpl.dwf."+this._type)},parseRule:function(e){var a=this.keys,s=!0,n=0,r=m.rules,t=e.map(function(e){var t={proto:e[a.proto],port:e[a.port]||"ALL",_action:e[a.action],desc:e[a.desc]},i=e[a.ip];return i&&m.rules.ip(i)?(t.id=e[a.id],t._idType="id"):(t.ip=i||"0.0.0.0/0",t._idType="ip"),"允许"===e[a.action]?t.action="ACCEPT":"拒绝"===e[a.action]&&(t.action="DROP"),!(t.port&&r.port(t.port)||r.proto(t.proto)||r.action(t.action))&&a.proto in e&&a.port in e&&a.ip in e&&a.action in e&&(!t.id||o.some(function(e){return t.id==e.sgId}))?t._isValid=!0:(s=!1,n++),t.portRange=t.port,"ALL"!==t.proto.toUpperCase()&&(t.ipProtocol=t.proto),t.cidrIp=t.ip,t.sgId=t.id,t}),i=t.length>d;return this.$set({valid:s,inValidNum:n,overSize:i,maxSize:d}),p.toggleBtnDisable(i||!s,0),t},toggleRule:function(){this.$set("_unfold",!this._unfold),p.center()}});return nmcLoad("xlsx.js",function(){a.async("xlsx.js",function(e){c.xlsx=e,c.dialog=p.create(l.$el,720,"",{title:"批量导入-"+("input"==i?"入站":"出站")+"规则",button:{"开始导入":function(){l.importRule()}}})})}),this},destroy:function(){p.hide()}}}),define("modules/cvm/securitygroup/components/protos",function(e,t,i){return[{name:"TCP",proto:"tcp",portEdit:!0},{name:"UDP",proto:"udp",portEdit:!0},{name:"All traffic",port:"ALL"},{name:"All TCP",proto:"tcp",port:"ALL"},{name:"All UDP",proto:"udp",port:"ALL"},{name:"ICMP",proto:"icmp",port:"-"},{name:"TCP SSH(22)",proto:"tcp",port:22},{name:"TCP SMTP(25)",proto:"tcp",port:25},{name:"DNS",proto:"udp",port:53},{name:"HTTP",proto:"tcp",port:80},{name:"POP3",proto:"tcp",port:110},{name:"IMAP",proto:"tcp",port:143},{name:"LDAP",proto:"tcp",port:389},{name:"HTTPS",proto:"tcp",port:443},{name:"SMTPS",proto:"tcp",port:465},{name:"IMAPS",proto:"tcp",port:993},{name:"POP3S",proto:"tcp",port:995},{name:"MS SQL",proto:"tcp",port:1433},{name:"MYSQL",proto:"tcp",port:3306}]}),define("modules/cvm/securitygroup/components/rename/rename",function(e,t,i){var s=e("$"),n=(e("util"),e("appUtil")),r=e("dialog"),o=e("tips"),d=e("lengthlimiter"),a=e("widget/baseInfo/validator"),c=e("qccomponent"),l=e("models/api"),p='    <div class="tc-15-list-wrap" style="padding: 0;">        <form action="javascript:;">            <div class="form-wrap">                <ul class="form-list">                    <li>                        <div aria-required="false" class="form-label">                            <label for="">名称</label>                        </div>                        <span class="form-input">                             <div class="tc-15-input-text-wrap" data-name b-class="{\'is-error\':\'rest<0\'}">                                 <input type="text" b-model="name" data-validate="sgName" placeholder="请输入安全组的名称" class="tc-15-input-text m" maxlength="{{NAME_MAX_LEN}}">                                 <div class="tc-15-input-tips">{{nameTip}}</div>                             </div>                        </span>                    </li>                    <li>                        <div class="form-label">                            <label for="">备注</label></div>                        <span class="form-input">                            <textarea cols="30" rows="3" style="height:auto"                                      data-validate="remark" b-model="sgRemark" class="tc-15-input-textarea"></textarea>                            <div class="tc-15-input-tips" b-if="sgRemark.length <= 100">还能输入{{100 - sgRemark.length}}个字符</div>                            <div class="tc-15-input-tips" b-if="sgRemark.length > 100">已超出{{sgRemark.length-100}}个字符</div>                        </span>                    </li>                </ul>            </div>        </form>    </div>',u=new a({typeAttr:"data-validate",errClass:"is-error",rules:{sgName:function(e){var t="安全组名称";return t=t||"",(e=s.trim(e)||"")?60<e.length?t+"不能超过60个字符":void 0:t+"不能为空"},remark:function(e){if(e&&100<e.length)return"备注长度已超出限制"}}}),m={render:function(e,t){var i=this,a=this.bee=new c(p,{$data:{name:t?t.sgName:"",sgRemark:t&&t.sgRemark||"",NAME_MAX_LEN:60},$afterInit:function(){this.$watch("name",function(e){var t=e.length||0;this.$set("rest",this.NAME_MAX_LEN-t)},!0),this.$watch("rest",function(e){0<=e?this.$set("nameTip","您还可以输入"+e+"个字符"):this.$set("nameTip","您输入的字符超出"+-e+"个")},!0)}});this.operEntry=e,this.isEdit=!!t&&(this.usgId=t.sgId,!0),r.create(a.$el,540,"",{title:this.isEdit?"编辑安全组":"新建安全组",button:{"确定":function(){i.sendReq()}},preventResubmit:!0}),r.el.find('input[type="text"]').focus(),d.trigger()},sendReq:function(){var e=this,t=r.el.find('input[type="text"]'),i=s.trim(t.val()),a=s.trim(r.el.find("textarea").val());u.btn=r.getBtn(0),u.validateAll(r.el)?l.req({cmd:e.isEdit?"ModifySecurityGroupAttributes":"CreateSecurityGroup",serviceType:"dfw",data:{projectId:n.getProjectId(!0),sgId:e.usgId,sgName:i,sgRemark:a}}).then(function(){e.operEntry.refreshList(),o.success(e.isEdit?"修改成功":"新建成功"),e.destroy()}):r.toggleBtnDisable()},valiName:function(e){return/^[\u4e00-\u9fa5\da-zA-Z\-\_\.]{1,25}$/.test(e)},destroy:function(){r.hide()}};i.exports=m}),define("modules/cvm/securitygroup/components/ruleValidator",function(e,t,i){var a=e("qccomponent"),s=e("widget/validator/validatorV2"),n=e("appUtil"),r=e("./protos");return new s({typeAttr:"data-validate",rules:{port:function(e){var t,i="请输入端口号或端口范围，例如1 或 2,3 或 3-6";if(!(e=$.trim(e)))return i;var a=/-/.test(e),s=/,/.test(e);if(a&&s)return"端口格式设置错误。";if(a){if(2!==(n=e.split("-")).length||!/^[1-9]\d*$/.test(n[0])||!/^[1-9]\d*$/.test(n[1]))return"端口格式设置错误。";if(!(1<=1*n[0]&&1*n[0]<=65535&&1<=1*n[1]&&1*n[1]<=65535&&1*n[1]>1*n[0]))return"您的端口设置超过了范围：0-65535";t=!0}else if(s){for(var n,r={},o=0,d=(n=e.split(",")).length;o<d;o++){var c=n[o];if(r[c])return"您的端口设置有重复。";if(!/^[1-9]\d*$/.test(c))return"端口格式设置错误。";if(r[c]=!0,!(1<=1*c&&1*c<=65535))return"您的端口设置超过了范围：0-65535"}if(15<n.length)return"同一规则内不连续端口的数量上限是 15 个";t=!0}else{if(!(/^[1-9]\d*$/.test(e)&&1<=1*e&&1*e<=65535||"ALL"===e))return"您的端口设置超过了范围：0-65535";t=!0}return!t&&i},ip:function(e){var t,i=e.split("/");return!e||"0.0.0.0"!==e&&n.isValidIp(i[0])?2===i.length?i[1]&&0<=1*i[1]&&1*i[1]<=32||(t="请输入IP或网段，不填表示所有IP，示例：10.0.0.1或10.0.0.0/16"):2<i.length&&(t="请输入IP或网段，不填表示所有IP，示例：10.0.0.1或10.0.0.0/16"):t="请输入IP或网段，不填表示所有IP，示例：10.0.0.1或10.0.0.0/16",t},proto:function(t){var e=!1;return t&&"all"!==t.toLowerCase()&&!r.some(function(e){return t.toUpperCase()==e.name||t.toLowerCase()==e.proto})&&(e="不支持该协议"),e},action:function(e){return(!e||"ACCEPT"!==e.toUpperCase()&&"DROP"!==e.toUpperCase()&&"允许"!==e&&"拒绝"!==e)&&"请选择正确的策略"}},showErr:function(e,t,i){(i=i||{}).silence||(i.noTips||this.showTips(e,t),$(e).parent().addClass(this.errClass))},hideErr:function(e){this.hideTips(e),$(e).parent().removeClass(this.errClass)},showTips:function(e,t){new(a.getComponent("qc-popover"))({$data:{trigger:"",hideDestroy:!0,content:t},target:e,handler:this.btn}).show()},hideTips:function(e){var t=$(e).data("qc-popover");t&&t.hide()}})}),define("modules/cvm/securitygroup/components/templateSelector",function(e,t,i){var a=e("qccomponent"),s=e("models/api"),n=e("util"),r=e("reporter"),o={0:"SecurityGroup.createSG.custom",1:"securityGroup.createSG.all",2:"securityGroup.createSG.linux",3:"SecurityGroup.createSG.win"},d=a.extend({$tpl:'    <span>        <select b-model="value" class="tc-15-select m">            <option value="{{item.value}}" attr="{{item.attr}}" disabled?="item.$disabled" b-repeat="item in list" title="{{item.title}}">{{item.text}}</option>        </select>    </span>',$valuekey:"value",$afterInit:function(){var i=this;s.request({serviceType:"dfw",cmd:"DescribeSecurityGroupTemplates",regionId:this.regionId,data:{language:n.cookie.get("language")}}).then(function(e){var t=e.data||[];t.unshift({sgName:"自定义",sgRemark:"",ingress:[],egress:[]}),t=t.map(function(e,t){return e.ingress.forEach(function(e){e.action=e.action.toUpperCase()}),e.egress.forEach(function(e){e.action=e.action.toUpperCase()}),{title:e.sgRemark,text:e.sgName,value:t,sg:e}}),i.$set("list",t),i.$set("value","0")}),i.$watch("value",function(e,t){e&&(i.onChange(i.list[e],i.list[t]),r.click(o[e]))},!0)},opnChange:function(e){}});i.exports=d}),define("modules/cvm/securitygroup/createLimitsMixin",function(e,t,i){var a=e("models/api"),r={};i.exports=function(n){return{$beforeInit:function(){var s=this;s.$watch("regionId",function(e){e&&(r[e]||(r[e]=a.req({cmd:"DescribeDfwLimit",serviceType:"dfw",regionId:e}))).then(function(e){var a=e.data||{};Object.keys(n).forEach(function(e){var t=n[e],i=a[t];0<=i&&s.$set(e,i)})})},!0)}}},i.exports.Limit={SecurityGroup:"sgCount",Rule:"policyCount"}}),define("modules/cvm/securitygroup/details",function(e,t,i){var a,n=e("widget/detail/detail"),r=e("pageManager"),o=(e("dialog"),e("appUtil")),d=e("./components/baseInfo"),c=e("./components/boundInfo"),s=e("models/api"),l=e("widget/pubsubhub/pubsubhub");i.exports={render:function(e,s){var t=this,i=(s=s||{}).pid||o.getProjectId(!0);this.getData(e,i).then(function(a){if(a){var e=t.detail=new n({$beforeInit:function(){this._tabs=[],this.bindEvent()},$data:{title:a.sgId+" ("+a.sgName+") 详情",tabData:{list:[{label:"基本配置"},{label:"入站规则"},{label:"出站规则"}]},activeIndex:1*s.tab||0},$beforeDestroy:function(){this._tabs.forEach(function(e){e.$destroy(!0)}),l.off(".detail")},back:function(){history.back()},loadTabs:function(e){var t=this.$refs.tabs,i=this._tabs[e];if(!i){switch(e){case 0:i=new d({$data:{usg:a,name:a.sgName,regionId:o.getRegionId(),projectId:o.getProjectId(!0)}});break;case 1:i=new c({$data:{usg:a,type:"ingress",regionId:o.getRegionId(),isEdit:"true"==s.edit}});break;case 2:i=new c({$data:{usg:a,type:"egress",regionId:o.getRegionId(),isEdit:"true"==s.edit}})}this._tabs[e]||(this._tabs[e]=i),t.list.$set(e,{content:i.$el})}},bindEvent:function(){var i=this;l.off(".detail").on("baseInfoUpdated.detail",function(e,t){i.$set({title:a.sgId+" ("+t+") 详情"})}),l.on("updated.detail",function(){i._tabs.forEach(function(e){e.isEdit&&e.$set("isEdit",!1),e.refresh&&e.refresh()})})}});r.appArea.html(e.$el)}else r.render404()})},getData:function(e){return a=a||new Promise(function(t,i){s.req({cmd:"DescribeSecurityGroups",serviceType:"dfw",data:{sgId:e}}).then(function(e){a=null,t(e.data[0])},function(e){a=null,i(e)})})},destroy:function(){this.detail.$destroy()}}}),define("modules/cvm/securitygroup/oper",function(e,t,i){var a=e("$"),s=(e("event"),e("tips")),n=(e("util"),e("appUtil"),e("dialog")),d=e("contextmenu"),c=e("reporter"),r=e("./bindCvm"),o=e("./components/delete/delete"),l=e("./components/rename/rename"),p=(e("config/constants"),e("./components/copy/copy")),u={init:function(e){this.listMod=e,this.bindEvent(),this.selectedIds=[]},reset:function(){this.selectedIds=[]},bindEvent:function(){var i=this,e=this.listMod,t=this.grid=e.grid;i.selectedIds=t.getSelected().map(function(e){return e.sgId});var a={"加入云主机":function(e){i.execContextMenu("bindServer",e),c.click("firewall.bind")},"克隆":function(e){i.execContextMenu("copy",e),c.click("firewall.copy")},"编辑":{exec:function(e){i.execContextMenu("rename",e),c.click("firewall.rename")}},"删除":{exec:function(e){i.execContextMenu("del",e),c.click("firewall.delete")},invalid:function(e){return e.deviceNum?"无法删除关联有实例的安全组":e.sgNum?"无法删除被其它安全组规则引用的安全组":void 0}}},s={},r={},o=Object.keys(a);o.forEach(function(e,t){var i=a[e];s[e]=i.exec||i,r[e]=i.invalid}),new d({object:t.$el,selector:"tbody tr[data-id]",data:[s],onShow:function(e,s,t){var n=i.listMod.getCurData(t.attr("data-id"));o.forEach(function(e,t){var i,a=r[e];a&&(i=a(n),s.find("li:eq("+t+")").toggleClass("disabled",!!i).attr("data-title",i||""))})}})},execContextMenu:function(e,t){t.attr("data-id")?(this.selectedIds=[t.attr("data-id")],this[e]&&this[e]()):s.flash("无法执行操作")},refreshList:function(e){n.hide(),this.listMod.refreshList()},bindServer:function(){var e=this;1==this.selectedIds.length?r.render(this.selectedIds[0]).then(function(){e.refreshList()}):s.error("请选择需要加入主机的单条安全组")},del:function(){if(1==this.selectedIds.length){var e=this.selectedIds[0],t=this.listMod.getCurData(e).num;o.render(this,e,t)}else s.error("请选择需要删除的单条安全组")},rename:function(){if(1==this.selectedIds.length){var e=this.selectedIds[0],t=this.listMod.getCurData(e);l.render(this,a.extend({},t))}else s.error("请选择需要修改的单条安全组")},copy:function(){p.render(this,this.listMod.getCurData(this.selectedIds[0]))},destroy:function(){}};i.exports=u}),define("modules/cvm/securitygroupold/securitygroupold",function(e,t,i){var r=e("$"),o=e("pageManager"),d=(e("util"),e("appUtil")),c=(e("search"),e("router")),l=e("./oper"),p=e("./details"),a=e("widget/pubsubhub/pubsubhub"),u=e("models/api"),m=e("models/iaas"),s=e("dialog"),n=e("./components/delete/delete"),h=e("./components/rename/rename"),v=e("./bindCvm"),f=e("./components/copy/copy"),g=e("./add/add"),b=e("./createLimitsMixin"),I=e("qccomponent"),y=I.getComponent("grid-view");e("widget/region/regionPills"),e("widget/projects/projectSelector");var w=y.extend({$afterInit:function(){w.__super__.$afterInit.call(this),this.$watch("regionId",function(e,t){isNaN(t)?this.refresh():c.navigate("/cvm/securitygroup")}),this.$watch("projectId",function(e,t){isNaN(t)?this.refresh():c.navigate("/cvm/securitygroup")})},setTrAttr:function(e,t){return{"data-id":t.sgId}},searchList:function(e,t){var i=t,a=[],s=new RegExp(e);if(i&&e)for(var n,r=0;n=i[r];r++)(s.test(n.sgId)||s.test(n.sgName))&&a.push(n);return a},getData:function(e,a){var s=this,n=s.keyword;a=function(e,t){if(s.setData(t),s.refId){var i=new I('<div>规则中引用了 {{sgId}} 的安全组, 找到 {{totalNum}} 条结果,<a href="javascript:;" b-on-click="backToList()">返回</a></div>',{$data:r.extend({sgId:s.refId},t),backToList:function(){c.navigate("/cvm/securitygroup")}});s.showTips(i.$el)}},Promise.all([u.req({cmd:"DescribeSecurityGroups",serviceType:"dfw",data:{projectId:d.getProjectId(!0)}}),new Promise(function(t,e){s.refId?u.req({cmd:"DescribeAssociateSecurityGroups",serviceType:"dfw",data:{sgIds:[s.refId]}}).then(function(e){t(e.data[s.refId])},e):t()})]).then(function(e){var t=e[0].data,i=e[1];s.$set("sgCount",t.length),i&&(t=t.filter(function(e){return-1<i.indexOf(e.sgId)})),n&&(n=n,t=s.searchList(n,t)),a(0,{list:t,totalNum:t.length,searchKey:n}),l.reset()}),m.apiRequest({serviceType:"dfw",action:"DescribeSecurityGroups",data:{projectId:d.getProjectId(!0)}},{global:!1,tipErr:!1})},backList:function(){c.navigate("/cvm/securitygroup")},del:function(a){return function(e){var t=this.$root;if(!a.deviceNum)if(a.sgNum){var i=new I('<div><p>注意：</p><p style="text-indent: 2em" b-if="sgNum">该安全组正在被其他安全组的【规则】以安全组ID形式引用，请先进入其他安全组的【规则】编辑列表，删除对该安全组ID的引用。<a href="/cvm/securitygroup?rid={{regionId}}&refId={{sgId}}" data-event="nav">查看引用的安全组</a></p>\x3c!--<p style="text-indent: 2em; margin-top: 1em" b-if="deviceNum">--\x3e\x3c!--该安全组内有一个或多个实例，请将这些实例与其他安全组关联，与该安全组解除关联。--\x3e\x3c!--<a href="/cvm/securitygroup/detail/{{sgId}}?rid={{regionId}}" data-event="nav">查看安全组内实例</a>--\x3e\x3c!--</p>--\x3e</div>',{$data:a,regionId:t.regionId});s.create(i.$el,560,"",{title:"无法删除安全组",defaultCancelBtn:!1,button:{"关闭":function(){s.hide()}}})}else{new(I.getComponent("popup-confirm"))({$data:{trigger:"",title:"确认要删除该安全组? ",style:"width: 310px;",hideDestroy:!0},handler:e.target,onConfirm:function(){n.render(t,a.sgId)}}).show()}}},rename:function(e){h.render(this,e)},refreshList:function(){this.refresh()},bindCvm:function(e){var t=this;v.render({sgName:e.sgName,sgId:e.sgId,regionId:t.regionId,projectId:t.projectId}).then(function(){t.refreshList()})},copy:function(e){f.render(this,e)}},{defaults:{sgCount:0,hasFirst:!1,showPagination:!1,colums:[{name:"ID/名称",key:"sgId",tdTpl:'<p><a data-event="nav" href="/cvm/securitygroup/detail/{{item.sgId}}?rid={{regionId}}">{{item.sgId}}</a></p><p><span class="text-overflow m-width text-mod" title="{{item.sgName}}">{{item.sgName}}</span><i class="pencil-icon hover-icon" b-on-click="rename(item)"></i></p>'},{name:"关联实例数",key:"deviceNum",width:120,tdTpl:'<a data-event="nav" href="/cvm/securitygroup/detail/{{item.sgId}}?rid={{regionId}}"><span class="text-overflow">{{item.deviceNum}}</span></a>'},{name:"备注",key:"sgRemark"},{name:"创建时间",key:"createTime",width:200},{name:"操作",key:"_action",minWidth:150,width:200,tdTpl:'<p class="text-overflow" style="margin: 3px 0"><a href="javascript:;" data-bind-cvm b-on-click="bindCvm(item)">加入实例</a><i class="black-seperate-line-icon"></i><a href="/cvm/securitygroup/detail/{{item.sgId}}?rid={{regionId}}" data-event="nav">移出实例</a></p><p class="text-overflow" style="margin: 3px 0"><a href="javascript:;" b-on-click="copy(item)" data-report="SecurityGroup.cloneSG">克隆</a><i class="black-seperate-line-icon"></i><a href="{{\'/cvm/securitygroup/detail/\' + item.sgId + \'?rid=\' + regionId + \'&tab=1&edit=true\'}}"   data-event="nav" class="links">编辑规则</a><i class="black-seperate-line-icon"></i><a href="javascript:;" b-on="{click: del(item)}" class="links {{item.deviceNum ? \'disable\': \'\'}}"   data-title?="item.deviceNum && \'无法删除关联有实例的安全组，请解绑安全组关联实例。\' || false">删除</a></p>'}]}}),x=I.extend({$mixins:[b({MAX_SG:b.Limit.SecurityGroup})]});x.tag("dfw-grid",w);var k={title:"安全组-控制台",pageClass:"safety",render:function(e,t,i){if("detail"==e)t?(this.isDetail=!0,p.render(t,i)):(this.isDetail=!1,o.render404());else if("add"==e)g.render(t);else{var a=e&&e.refId,s=e&&e.keyword;try{s=s&&decodeURIComponent(s)}catch(r){}var n=this.page=new x('<div class="manage-area"><style type="text/css">#firewallList .host-table-panel{top: 145px}</style><div class="manage-area-title"><h2>安全组</h2><project-selector b-model="projectId" need-all="{{false}}"></project-selector><region-pill b-model="regionId" b-ref="regionPill" short="{{true}}" global="{{true}}" reset="{{true}}"></region-pill><div style="right: 20px;" class="manage-area-title-right"><a href="http://'+QCMAIN_HOST+'/doc/product/213/%E5%AE%89%E5%85%A8%E7%BB%84" target="_blank"><b class="links-icon"></b>安全组帮助文档</a></div></div><div class="manage-area-main"><div style="margin: 0 20px"><p class="tc-msg common row">在这里用户可以设定安全组策略，对绑定的云主机进行内、外网访问权限控制，提高公有云的安全性</p></div><div><div class="tc-15-action-panel"><button type="button" class="tc-15-btn m {{reachMax ? \'disabled\' : \'\'}}" data-title?="reachMax && \'配额达到上限，请提工单申请更多配额\'" data-add b-on-click="add()" data-event="firewall_add" data-report="securityGroup.createSG">+ 新建</button><qc-search keyword="{{keyword}}" placeholder="搜索安全组名或 ID" on-search="{{search}}"></qc-search></div></div><dfw-grid b-ref="grid" project-id="{{projectId}}"  ref-id="{{refId}}"  keyword="{{keyword}}"  region-id="{{regionId}}"></dfw-grid></div></div>',{refId:a,keyword:s,search:function(e){c.navigate("/cvm/securitygroup?keyword="+encodeURIComponent(e))},add:function(){n.reachMax||c.navigate("/cvm/securitygroup/add?rid="+this.regionId+"&pid="+this.projectId)},regionId:this.regionId||d.getRegionId()});this.grid=n.$refs.grid,d.beeBind(this.grid,n,"sgCount"),d.beeBind(n,n,"sgCount>=MAX_SG","reachMax"),o.appArea.html(n.$el),l.init(this),this.bindEvent(),this.isDetail=!1}},refreshList:function(){this.grid.refreshList()},bindEvent:function(){var e=this;a.off(".dfw").on("baseInfoUpdated.dfw dfwBindingUpdate.dfw",function(){e.grid.refreshList()})},getCurData:function(e){for(var t,i={},a=0;t=this.grid.list[a];a++)if(e==t.sgId){i=t;break}return i},destroy:function(){p.$destroy&&p.$destroy(),l.destroy&&l.destroy(),a.off(".dfw"),this.isDetail&&p.destroy()}};i.exports=k}),define("modules/cvm/sshkey/detail",function(e,t,i){var o=e("$"),d=e("manager"),a=e("appUtil"),r=e("util"),c=e("qccomponent"),l=e("dialog"),p=(e("dataManager"),e("pageManager")),s=c.getComponent("grid-view"),u=e("modules/cvm/sshkey/oper"),m='    <style type="text/css">    .tc-15-table-rowhover tr.disable td a.id-link{        color: #0071ce;        cursor: pointer;    }    </style>    <div class="manage-area" id="sshDetailWrap">        <div class="manage-area-title secondary-title">            <a href="javascript:history.go(-1);" class="back-link"><i class="btn-back-icon"></i>返回</a>            <span class="line-icon">|</span>            <h2><%= data.display_id %>(<span class="ellipsis cvm-entry-name"><%= data.key_name %></span>)详情</h2>        </div>        <div class="manage-area-main secondary-main">            <div class="ssh-param">                <div class="param-box">                    <div class="param-hd">                        <h3>SSH密钥信息</h3>                    </div>                    <div class="param-bd">                        <ul class="item-descr-list">                            <li>                                <span class="item-descr-tit">名称</span>                                <span class="item-descr-txt"><%= data.key_name %></span>                            </li>                            <li>                                <span class="item-descr-tit">密钥ID</span>                                <span class="item-descr-txt"><%= data.display_id %></span>                            </li>                            <li>                                <span class="item-descr-tit">密钥描述</span>                                <span class="item-descr-txt"><%= data.description %></span>                            </li>                            <li>                                <span class="item-descr-tit">公钥内容</span>                                <span class="item-descr-txt"><%= data.pubkey %></span>                            </li>                            <li>                                <span class="item-descr-tit">创建时间</span>                                <span class="item-descr-txt"><%= data.create_time %></span>                            </li>                        </ul>                    </div>                </div>                <div class="param-box">                    <div class="param-hd">                        <h3>已绑定云主机</h3>                    </div>                    <div class="param-bd" style="width: 90%"><qc-tabs></qc-tabs></div>                </div>            </div>        </div>    </div>',h='    <div>    <div class="d-tb assign-status-row">        <div class="d-tbc"><button disabled="disabled" data-multiunlink class="tc-15-btn disabled m">批量解绑</button></div>        <div class="d-tbc right-cell">            <span class="assign-status">已绑定云主机&nbsp;<strong></strong>&nbsp;台</span>        </div>    </div>    </div>',n={render:function(e){if(!e)return this.renderDetailNoData();p.appArea.html("");var t=this;d.detailKeypair({displayIdList:[e]},function(e){(e=e.detail_list)&&e.length?t.renderUi(e[0]):t.renderDetailNoData()},function(){t.renderDetailNoData()})},renderUi:function(s){var t,i,n=this;o.when((i=o.Deferred(),d.queryRegion(function(a){var e=Object.keys(a).map(function(e){var t=n.getGrid(e,s.key_id),i=o(h);return{label:a[e],grid:t,content:i.append(t.$el)[0]}});i.resolve(e)},i.reject),i.promise())).done(function(e){var i=s;p.appArea.html(r.tmpl(m,{data:i})),(t=o("#sshDetailWrap")).on("click","button[data-multiunlink]",function(){var e=o(this);if(!e.hasClass("disabled")){var t=e.closest("[data-tab-pane]").find("[data-role=grid-view]")[0].bee;l.create('<h3 class="til">确定要解绑选中的云主机?</h3>',480,"",{title:"解绑云主机",button:{"确定":function(){t.unLink(t.getSelected(),s.key_id),l.hide()}}})}}),c.mount(t.find("qc-tabs")[0],{$data:{list:e},$afterInit:function(){this.$watch("activeIndex",function(e){var t=this.list[e].grid;t.loaded||(t.ipList=i.bind_iplist,t.uuidList=i.bind_uuidlist,t.getData({page:1}).done(function(){t.loaded=!0}))},!0)}}),t.find(".assign-status strong").text(i.bind_uuidlist.length)})},renderDetailNoData:function(){a.renderDetailNoData("SSH密钥","/cvm/sshkey")},getGrid:function(r,e){return new s({$data:{initGetData:!1,rid:r,keyId:e,maxHeightOffset:2,colums:[{name:"云主机ID",key:"uInstanceId",cellTemplate:'<a class="id-link" data-event="nav" href="/cvm/detail/'+r+'/{{item.uInstanceId}}">{{item.uInstanceId}}</a>'},{name:"云主机名称",key:"alias"},{name:"状态",key:"statusDesc",width:100},{name:"所属网络",key:"netName"},{name:"内网IP",key:"deviceLanIp"},{name:"操作",key:"_action",width:"100",cellTemplate:'<a href="javascript:;" data-title="{{item.$disable ? \'关机状态才可解绑密钥\' : \'\'}}" b-on="{click: getunLink([item], keyId)}">解绑</a>'}]},unLink:function(e,t){var i=this,a=[],s=[],n=[{keyId:t,unbindIpList:a,unbindUuidList:s}];e.forEach(function(e){var t=i.list.indexOf(e);i.updateItem(t,{$loading:!0,$selected:!1,statusDesc:"解绑中..."}),a.push(e.deviceLanIp),s.push(e.uuid)}),u.sendBindServerReq(n,r).done(function(){u.refreshList(),i.refresh()}).fail(function(){i.refresh()})},events:{"change .tc-15-first-checkbox> input.tc-15-checkbox":function(){var e=this.getSelected(),t=o(this.$el).parent().find("button[data-multiunlink]");e.length?t.removeAttr("disabled").removeClass("disabled"):t.attr("disabled","disabled").addClass("disabled")}},getunLink:function(t,i){var a=this;return function(e){this.$get("item.$disable")||(o(e.target).data("qcPopover")||new(c.getComponent("popup-confirm"))({handler:e.target,box:a.$gridBody[0],$data:{title:"确定解绑该密钥？",style:"width: 185px"},onConfirm:function(){a.unLink(t,i)}})).show()}},getData:function(e,t){var i=o.Deferred(),a=this;return t=function(e,t){t.deviceList.forEach(function(e){e.$disable=4!==e.runflag}),a.setData({totalNum:t.totalNum,list:t.deviceList})},a.uuidList.length?d.getCvmList({count:e.count||20,offset:20*(e.page-1),projectId:-1,uuidList:a.uuidList?a.uuidList:undefined,regionId:r},function(e){t(0,e),i.resolve(e)},i.reject):t(0,{deviceList:[],totalNum:0}),i.promise()},getCellContent:function(e,t,i){return i.cellTemplate}})},destroy:function(){}};i.exports=n}),define("modules/cvm/sshkey/oper",function(e,t,i){var l=e("$"),s=e("event"),p=e("tips"),u=e("util"),c=e("appUtil"),m=e("dialog"),h=e("manager"),a=e("validator"),n=(e("regionSelector"),e("contextmenu")),r=e("reporter"),v=e("constants"),f=e("qccomponent"),g=e("widget/cvmList/cvmList");e("widget/region/regionSelector");var o='<div class="edit_form_wrap">        <ul class="edit_psword">            <li>                <label class="txt" for="">创建方式:</label>                <div class="mode">                    <input type="radio" id="rdio-c-ssh-type1" class="radio" name="ssh_create_type" value="create" checked/> <label for="rdio-c-ssh-type1">创建新密钥对</label>        <input type="radio" id="rdio-c-ssh-type2" class="radio" name="ssh_create_type" value="import"/> <label for="rdio-c-ssh-type2">使用已有公钥</label>                </div>            </li>            <li>                <label class="txt" for="">密钥名称:</label>                <input type="text" class="txt_input">                <p class="tip">只支持英文大小写、数字和下划线</p>            </li>            \x3c!--<li>                <label class="txt" for="">密钥描述:</label>                <textarea class="textarea"></textarea>            </li>--\x3e            <li class="public-key-input" style="display:none">                <label class="txt" for="">输入公钥:</label>                <textarea style="width:345px" class="textarea" placeholder="格式：ssh-rsa AAAKedvs...."></textarea>            </li>        </ul>    </div>',d='<div class="edit_form_wrap">        <ul class="edit_psword">            <li>                <label class="txt" for="">密钥名称:</label>                <input type="text" class="txt_input" value="<%= keyName %>">                <p class="tip">只支持英文大小写、数字和下划线</p>            </li>            <li>                <label class="txt" for="">密钥描述:</label>                <textarea class="textarea" style="width:345px" value="<%= keyDesc %>"><%= keyDesc %></textarea>            </li>        </ul>    </div>',b='<div>    我们不会保管您的私钥信息，请您在10分钟内点击"下载"按钮获取私钥 </div>',I='<div class="act-outline" id="selectedShowWrap">    <div class="act-summary">您已选<strong><%=detailList.length%>个密钥</strong>，<% if (errorCnt > 0) {%>其中<strong><%=errorCnt%>个密钥</strong>不能执行删除操作，<% }%>    <a href="javascript:;" id="viewDetail">查看详情<i id="arrowIcon" class="icon-arrow-down"></i></a>    </div>    <div class="act-details" id="selectedShowDetail">        <table class="act-details-tb">            <tbody>                <% for (var i = 0, item; item = detailList[i]; i++) { %>                    <tr>                        <td><%=i+1%></td>                        <td>                            <span class="entity-name" style="width:12em;" title="<%=item.name%>"><%=item.name%></span>                            <span <% if (item.status == 1) { %> style="color:red;" <% } %>><%=item.statusDesc%></span>                        </td>                    </tr>                <% } %>            </tbody>        </table>    </div></div><strong class="tit" id="deleteConfirm" style="font-size:1.2em;">确定对选中密钥进行删除?</strong>',y='    <div>    <div id="bindServerWrapper">        <div class="tc-15-mod-selector-area">            <h4 class="run-in">选择地域</h4>            <region-selector b-model="regionId"></region-selector>        </div>    </div>    <device-selector init-get-data="{{false}}" scroll-pager="true" multiple-search="true"                     list-tpl="{{listTpl}}" selected-tpl="{{selectedTpl}}"                     b-ref="ds" title="选择云主机" device-name="云主机" get-data="{{getData}}"></device-selector>    </div>',w='    <input type="checkbox" disabled?="item.disabled" class="tc-15-checkbox" b-model="item.selected">    <span class="opt-txt">      <span class="opt-txt-inner">        <span class="item-name" style="max-width: 16em;">{{item[alias.name]}}</span>        <span class="item-descr" style="max-width: 16em;">{{item[alias.network]}} | {{item[alias.ip]}}</span>      </span>        <span b-if="item.disabled" style="font-size: 12px;float:right; margin:18px 1em 0 0;color:#999">            {{item.osType === \'windows\' ? \'暂不支持Windows\' : \'关机状态才可加载\'}}        </span>    </span>',x='    <span class="opt-txt">      <span class="opt-txt-inner">        <span class="item-name">{{item[alias.name]}}</span>        <span class="item-descr">{{item[alias.network]}} | {{item[alias.ip]}}</span>      </span>        <span b-if="item.disabled" style="font-size: 12px;float:right; margin:18px 1em 0 0;color:#999">            关机状态才可解绑        </span>    </span>    <a role="button" class="opt-act" href="javascript:;" b-if="!item.disabled">        <i b-on="{click: _delSelected}" class="icon-del">取消</i>    </a>',k=/^[\da-zA-Z\_]{1,25}$/,C={init:function(e){this.listMod=e,this.bindEvent(),this.selectedIds=[]},reset:function(){this.selectedIds=[]},bindEvent:function(){var t=this,e=this.listMod,i=e.sshListEl,a=e.operAreaEl;l(e.gridView.$el).on("change","input:checkbox",function(){t.selectedIds=e.gridView.getSelected().map(function(e){return e.key_id})}),s.bindCommonEvent(a[0],"click",{ssh_add:function(){t.create()},ssh_bind_server:function(){t.bindServer()},ssh_modify:function(){t.modify()},ssh_del:function(){t.del()}}),s.bindCommonEvent(i[0],"click",{ssh_add:function(){t.create()}}),new n({object:i,selector:"tbody tr",data:[{"创建密钥":function(e){t.execContextMenu("create",e),r.click("SSH.new")},"绑定/解绑云主机":function(e){t.execContextMenu("bindServer",e),r.click("SSH.bangding")},"修改":function(e){t.execContextMenu("modify",e),r.click("SSH.revise")},"删除":function(e){t.execContextMenu("del",e),r.click("SSH.delete")}}]})},errTip:function(e,t){var i={tip:e};return a.showErr(t,i)},execContextMenu:function(e,t){var i=this.listMod.sshListEl;t.attr("data-id")?(i.find('input[type="checkbox"]').prop("checked",!1),t.find('input[type="checkbox"]').prop("checked",!0),this.selectedIds=[t.attr("data-id")],this[e]&&this[e]()):p.flash("无法执行操作")},create:function(){var a=this;m.create(o,"540","",{title:"创建SSH密钥",preventResubmit:!0,button:{"确定":function(){t()}}});var s=m.el.find('input[type="text"]').eq(0),n=m.el.find('input[name="ssh_create_type"]'),e=m.el.find(".public-key-input"),r=e.find("textarea");n.change(function(){"import"===n.filter(":checked").val()?e.show():e.hide()});var t=function(){var e=l.trim(s.val()),t=n.filter(":checked").val(),i=l.trim(r.val());return""===e?a.errTip("请输入密钥名称",s):25<e.length?a.errTip("密钥名称不能超过25个字符",s):k.test(e)?"import"===t&&""===i?a.errTip("请输入公钥",r):void("import"===t?a.sendImportReq(e,i):m.create(b,"500","",{title:"SSH密钥对已创建",preventResubmit:!0,button:{"下载":function(){a.sendCreateReq(e)}}})):a.errTip("密钥名称不符合规则",s)}},sendCreateReq:function(t){var i=this;h.createKeypair({keyName:t,projectId:c.getProjectId()},function(e){i.refreshList(function(){i.downLoadKey(t,e.secretkey)})})},downLoadKey:function(e,t){var i={t:(new Date).getTime(),uin:u.getUin(),csrfCode:u.getACSRFToken()},a="/cgi/sshkey?action=downloadKeypair&"+u.objectToParams(i);c.submitForm(a,{keyName:e,secretKey:t})},sendImportReq:function(e,t){var i=this;h.loadKeypair({keyName:e,projectId:c.getProjectId(),publicKey:t},function(e){p.success("导入密钥成功"),i.refreshList()})},refreshList:function(e){m.hide(),this.listMod.renderList(1,undefined,function(){e&&e()})},modify:function(){var n=this;if(0==this.selectedIds.length)return p.error("请选择一个密钥"),!1;if(1<this.selectedIds.length)return p.error("请选择单个密钥"),!1;var r=this.selectedIds[0];h.detailKeypair({keyIdList:[r]},function(e){e=e.detail_list?e.detail_list[0]:[{}],m.create(u.tmpl(d,{keyName:e.key_name,keyDesc:e.description}),"540","",{title:"修改密钥",preventResubmit:!0,button:{"确定":function(){t(e.key_name)}}})});var t=function(e){var t=m.el.find('input[type="text"]').eq(0),i=m.el.find("textarea"),a=l.trim(t.val()),s=l.trim(i.val());return""===a?n.errTip("请输入密钥名称",t):25<a.length?n.errTip("密钥名称不能超过25个字符",t):k.test(a)?s&&60<s.length?n.errTip("描述长度不能超过60个字符",i):void n.modifyReq(r,a,s):n.errTip("密钥名称不符合规则",t)}},modifyReq:function(e,t,i){var a=this;h.modifyKeypair({keyId:e,keyName:t,keyDesc:i},function(e){p.success("修改密钥成功"),a.refreshList()})},del:function(){var e=this;if(!this.selectedIds.length)return p.error("请选择密钥"),!1;for(var t,i=[],a=[],s=0,n=0;t=this.selectedIds[n];n++){var r=this.listMod.getCurData(t),o={id:t,name:r.display_id,statusDesc:"可删除"};0==r.bind_count&&0==r.image_count?a.push(t):(s++,o.status=1,o.statusDesc="未绑定云服务器或自定义镜像的密钥才可删除"),i.push(o)}var d=u.tmpl(I,{detailList:i,errorCnt:s});m.create(d,"580","",{title:"删除密钥","class":"dialog_layer_v2",preventResubmit:!0,button:{"确定":function(){h.deleteKeypair({keyIdList:a},function(){p.success("删除密钥成功"),e.refreshList()})}}}),0==a.length&&(m.getBtn(0).hide(),l("#deleteConfirm").hide());var c=l("#selectedShowDetail");l("#viewDetail").on("click",function(){c.toggle(),c.is(":visible")?l("#arrowIcon").removeClass("icon-arrow-down").addClass("icon-arrow-up"):l("#arrowIcon").removeClass("icon-arrow-up").addClass("icon-arrow-down"),m.center()})},bindServer:function(){var n=this;if(0==this.selectedIds.length)return p.error("请选择一个密钥"),!1;if(1<this.selectedIds.length)return p.error("请选择单个密钥"),!1;var r=this.selectedIds[0],o=new f(y,{listTpl:w,selectedTpl:x,$afterInit:function(){var i=this;i.$watch("regionId",function(e){i.loadSelected();var t=i.$refs.ds;t.$set({searchKey:"",keyword:""}),t._getData({page:1,count:20,regionId:e})},!0)},getData:function(e,i){var t=e.searchKey,a=g.prototype.getCvmAnalyseValue(t);h.getCvmList(l.extend({},a,{count:e.count,offset:(e.page-1)*e.count,projectId:c.getProjectId(),regionId:e.regionId||c.getRegionId()}),function(e){var t=e.deviceList.filter(function(e){return"windows"!==e.osType&&e.runflag===v.DEVICE_RUNFLAGS.SHUTOFF.code||(e.disabled=!0),v.SSHKEY_VPC||!(0<e.vpcId)});i(null,{list:t,size:e.totalNum})},i)},initSelected:[],loadSelected:function(){var i=this;i.$refs.ds.$set("selectedEmptyTips","加载中..."),h.detailKeypair({keyIdList:[r]},function(e){var t=(e=e.detail_list?e.detail_list[0]:[{}]).bind_iplist||[];t.length?h.getCvmList({count:50,offset:0,ipList:t},function(e){i.$refs.ds.$set("selectedEmptyTips",""),e.deviceList.forEach(function(e){e.runflag!==v.DEVICE_RUNFLAGS.SHUTOFF.code&&(e.disabled=!0)}),i.initSelected=e.deviceList.slice(),i.$refs.ds.replaceSelected(e.deviceList)}):i.$refs.ds.$set("selectedEmptyTips","")})}}),d=o.$refs.ds;m.create(o.$el,"800","",{title:"绑定/解绑云主机",preventResubmit:!0,button:{"确定":function(){e()}}});var e=function(){var e=[],a=[];if(o.initSelected.forEach(function(t){var i=!0;d.selected.forEach(function(e){e.uuid==t.uuid&&(i=!1)}),i&&a.push(t)}),d.selected.forEach(function(t){var i=!0;o.initSelected.forEach(function(e){t.uuid==e.uuid&&(i=!1)}),i&&e.push(t)}),!e.length&&!a.length)return p.flash("无任何变更"),c.restoreDialogBtn(),m.hide(),!1;var t=[],i={};t.push(i),i.keyId=r,i.bindUuidList=e.map(function(e){return e.uuid}),i.unbindUuidList=a.map(function(e){return e.uuid}),i.bindIpList=e.map(function(e){return e.deviceLanIp}),i.unbindIpList=a.map(function(e){return e.deviceLanIp}),n.sendBindServerReq(t).done(function(){n.refreshList(),p.success("操作成功")}).fail(function(){l("#getFlowCscResultErrTip").length||(p.error("操作执行失败"),n.refreshList())});var s=m.el.find(".dialog_layer_ft").find(".btn:eq(0)");s.length&&s.html('<i class="ico ico_loading"></i><span>处理中...</span>')}},sendBindServerReq:function(e,t){var a=this,s=l.Deferred(),i={actionType:1,reqList:e,regionId:t},n=function(i){h.getFlowCscResult({taskId:i,regionId:t},function(e){var t=e.status;0===t?s.resolve():2===t?a.timeOut=setTimeout(function(){n(i)},3e3):s.reject()},s.reject,"sshkey")};return h.manageCvmKey(i,function(e){n(e.taskId)},s.reject),s.promise()},destroy:function(){}};i.exports=C}),define("modules/cvm/sshkey/sshkey/useless",function(r,e,t){var o,i=r("$"),a=r("pageManager"),d=r("manager"),s=r("util"),c=r("appUtil"),n=(r("event"),r("projectsSelector")),l=r("search"),p=(r("router"),r("modules/cvm/sshkey/detail")),u=r("modules/cvm/sshkey/oper"),m=(r("reporter"),r("dataManager"),r("qccomponent")),h='<style type="text/css">.table-panel td a:hover{text-decoration: underline;}</style><div class="manage-area"><div class="manage-area-title">            <h2>SSH密钥</h2>            <div id="projectsArea" class="tc-select-box"></div></div><div class="manage-area-main"><div id="operArea"><div class="tc-15-action-panel">  <button type="button" class="tc-15-btn m" data-event="ssh_add" data-hot="SSH.new">创建密钥</button>  <button type="button" class="tc-15-btn m" data-event="ssh_bind_server" data-hot="SSH.bangding">绑定/解绑云主机</button>  <button type="button" class="tc-15-btn m" data-event="ssh_modify" data-hot="SSH.revise">修改</button>  <button type="button" class="tc-15-btn m" data-event="ssh_del" data-hot="SSH.delete">删除</button>  <div id="searchArea" class="pull-right"></div></div></div><div id="sshList"></div></div></div>',v='当前过滤条件下没有SSH密钥，<a href="javascript:void(0);" data-event="ssh_add">点击新建</a>',f='<p><a class="id-link" href="/cvm/sshkey/detail/{{item.display_id}}" data-event="nav">{{item.display_id}}</a></p><p><span class="text-overflow m-width">{{item.key_name}}</span></p>',g={title:"SSH密钥-控制台",pageClass:"",render:function(){var s=arguments,n=this;d.getAllWhiteList(function(e){var t=e.CVM_APIv3_BlackList;if(t&&0<t.length)n._render.apply(n,s);else{var i=e.CVM_ApiToMc,a=e.PrepaidForCVM;i&&i.length&&a&&a.length?r.async("cvm/sshkey/sshkey",function(e){(n=o=e).render.apply(n,s)}):n._render.apply(n,s)}})},_render:function(){if("detail"==arguments[0])return p.render(arguments[1],arguments[2]);a.appArea.html(s.tmpl(h,{})),this.sshListEl=i("#sshList"),this.projectsAreaEl=i("#projectsArea"),this.searchAreaEl=i("#searchArea"),this.operAreaEl=i("#operArea"),this.needSpeedReport=!0,this.renderWidget(),this.bindEvent()},renderWidget:function(){var t=this;this.projectsSelector=new n({renderTo:this.projectsAreaEl,change:function(){t.renderList(1)}}),this.search=new l({placeholder:"请输入密钥名",renderTo:this.searchAreaEl,listFun:function(e){t.renderList(1,e)}}),this.initGridView(),u.init(this)},initGridView:function(){var i=this,e={$data:{colums:[{key:"idName",name:"ID/名称",cellTemplate:f},{key:"bind_count",name:"服务器绑定情况"},{key:"image_count",name:"自定义镜像绑定情况"},{key:"create_time",name:"创建时间"}],trackKey:"display_id",emptyTips:v,searchItemName:"SSH密钥"},getCellContent:function(e,t,i){return i.cellTemplate},getData:function(e,t){i.renderList(e.page,e.searchKey,null,e)},setTrAttr:function(e,t){return{"data-id":t.key_id}},backList:function(){i.renderList(1)}},t=m.getComponent("grid-view");i.gridView=new t(e),i.sshListEl.append(i.gridView.$el)},renderList:function(i,a,s,e){i=i===undefined?1:i;var n=this,r=e&&e.count?e.count:20,t=r*(i-1);d.queryKeypair({keyName:a,count:r,offset:t,projectId:c.getProjectId()},function(e){n.operAreaEl.show();var t=e.key_list||[];n.listData=t,n.gridView.setData({list:n.listData,totalNum:e.key_total,page:i,count:r,searchKey:a}),u.reset(),s&&s(),n.needSpeedReport&&(c.speedReport("sshkey"),n.needSpeedReport=!1)})},bindEvent:function(){},getCurData:function(e){for(var t,i={},a=0;t=this.listData[a];a++)if(e==t.key_id){i=t;break}return i},destroy:function(){p.destroy&&p.destroy(),u.destroy&&u.destroy(),o&&o.destroy()}};t.exports=g}),define("modules/cvm/detail/detail/useless",function(v,e,s){var l=v("$"),f=v("manager"),t=v("pageManager"),p=v("util"),i=v("appUtil"),n=v("modules/cvm/view/monitor"),r=v("modules/cvm/view/paramdetail"),o=v("modules/cvm/view/oplogdetail"),d=v("modules/cvm/view/healthdetail"),c=v("modules/cvm/view/dfwdetail"),u=v("reporter"),g=v("widget/cvmList/data_package"),b=v("dataManager"),m=v("widget/cvmList/operate_entry"),h=v("widget/cvmList/operate_auth"),I=v("tips"),a=v("config/constants"),y=v("dropdown"),w=v("router"),x=(v("modules/cvm/index/index/useless"),v("modules/cvm/eip/common"),v("modules/cvm/view/enidetail")),k=null,C=null,T='<style>   #monitorDetail, #healthDetail, #paramDetail, #opLogDetail{margin: 0}    .tc-15-table-rowhover tr.disable td a.id-link{        color: #0071ce;        cursor: pointer;    }    .convert-ip-icon, .convert-ip-ash-icon {display: none; cursor: pointer;}    .item-wip-hover .convert-ip-icon, .item-wip-hover .convert-ip-ash-icon {display: inline-block;}    /*.cvm-more-opt{width: 251px;}*/</style><div class="manage-area">    <div class="manage-area-title secondary-title">        <a href="<%=curNav.url%>" class="back-link" data-event="nav"><i class="btn-back-icon"></i><%=curNav.alias%></a>        <span class="line-icon">|</span>        <h2><%=uInstanceId%></h2>        <div class="cvm-more-opt manage-area-title-right"></div>    </div>    <div class="manage-area-main secondary-main keyboard-focus-obj" id="detailScrollWrap">        \x3c!-- tab --\x3e        <div class="tc-15-tab tc-15-tab-alt fixed-tab">            <ul role="tablist" class="tc-15-tablist" id="cvmDetailNav">                <li class="tc-cur" id="paramNav"><a href="javascript:void(0)" role="tab">参数</a></li>                <li id="eni"><a href="javascript:void(0)" role="tab">弹性网卡</a></li>                <li id="monitorNav"><a href="javascript:void(0)" role="tab">监控</a></li>                <li id="healthNav"><a href="javascript:void(0)" role="tab">健康检查</a></li>                <li id="dfwNav"><a href="javascript:void(0)" role="tab">安全组</a></li>                <li id="opLogNav"><a href="javascript:void(0)" role="tab">操作日志</a></li>            </ul>            \x3c!-- 参数 --\x3e            <div class="tab-panel param-panel" id="paramDetail" data-detail-type=\'param\'></div>            \x3c!--弹性网卡--\x3e            <div class="tab-panel param-panel" id="eniDetail" data-detail-type=\'eni\'></div>            \x3c!-- 监控 --\x3e            <div class="tab-panel" id="monitorDetail" style="display:none" data-detail-type=\'monitor\'></div>            \x3c!-- 健康度 --\x3e            <div class="tab-panel health-panel" id="healthDetail" style="display:none" data-detail-type=\'health\'></div>            \x3c!-- 安全防火墙 --\x3e            <div class="tab-panel dfw-panel" id="dfwDetail" style="display:none" data-detail-type=\'dfw\'></div>            \x3c!-- 操作日志 --\x3e            <div class="tab-panel log-panel" id="opLogDetail" style="min-height:320px;display:none;" data-detail-type=\'opLog\'></div>        </div>          </div></div>',D=p.tmpl('    \x3c!-- <div class="cvm-oper-cell" style="white-space:nowrap"> --\x3e        <button class="tc-15-btn weak m" data-name="vnc" data-event="web_ssh" data-hot="yunzhuji.web">登录</button>        <% if (isPrepaidUser && !isSecondPayMode) { %>        <button class="tc-15-btn weak m" data-name="renew" data-event="cvm_oper_action">续费</button>        <% } %>       \x3c!--  <div class="tc-15-dropdown tc-15-dropdown-btn-style tc-15-menu-active">            <a href="javascript:;" class="tc-15-dropdown-link">更多操作<i class="caret"></i></a>        </div> --\x3e    \x3c!-- </div> --\x3e',null),P=p.tmpl('    <div class="tc-15-dropdown tc-15-dropdown-btn-style tc-15-menu-active" id="cvmRowDropdown">        <a href="javascript:;" class="tc-15-dropdown-link">更多操作<i class="caret"></i></a>        <ul class="tc-15-dropdown-menu" role="menu">            <li data-name="reboot" data-event="cvm_oper_action" role="presentation" ><a href="javascript:;" role="menuitem">重启</a></li>            <li data-name="boot" data-event="cvm_oper_action" role="presentation" ><a href="javascript:;" role="menuitem">开机</a></li>            <li data-name="shutdown" data-event="cvm_oper_action" role="presentation" ><a href="javascript:;" role="menuitem">关机</a></li>                <li role="presentation" class="sep-line"></li>            <li data-name="resetpwd" data-event="cvm_oper_action" role="presentation" ><a href="javascript:;" role="menuitem">重置密码</a></li>            <li data-name="bindkeypair" data-event="cvm_oper_action" role="presentation" ><a href="javascript:;" role="menuitem">加载密钥</a></li>            <% if (!notShow_firewall) { %>                <li data-control="firewall" data-name="firewall" data-event="cvm_oper_action" role="presentation" ><a href="javascript:;" role="menuitem">配置安全组</a></li>            <% } %>            <% if (isPrepaidUser) { %>                <li data-name="upgradeconfig" data-event="cvm_oper_action" role="presentation" ><a href="javascript:;" role="menuitem">调整配置</a></li>                <li data-name="upgradedisk" data-event="cvm_oper_action" role="presentation" ><a href="javascript:;" role="menuitem">调整磁盘</a></li>            <% } %>            <li data-name="upgradebandwidth" data-event="cvm_oper_action" role="presentation" ><a href="javascript:;" role="menuitem">调整网络</a></li>            <li data-name="createimg" data-event="cvm_oper_action" role="presentation" ><a href="javascript:;" role="menuitem">制作镜像</a></li>            <li data-name="resetos" data-event="cvm_oper_action" role="presentation" ><a href="javascript:;" role="menuitem">重装系统</a></li>            <% if(isSnapAbility){ %>            <li data-name="snapshot" data-event="cvm_oper_action"><a href="javascript:;">创建快照</a></li>            <% } %>            <% if (!isPrepaidUser) { %>                <li data-event="cvm_oper_action" role="presentation"  data-name="returncvm"><a href="javascript:;" role="menuitem">退还服务器</a></li>            <% } else { %>                <li data-event="cvm_oper_action" role="presentation"  data-name="destroycvm"><a href="javascript:;" role="menuitem">销毁</a></li>            <% } %>            <% if (!notShow_changeproject) { %>                <li data-control="changeproject" data-name="changeproject" data-event="cvm_oper_action" role="presentation" ><a href="javascript:;" role="menuitem">分配至项目</a></li>            <% } %>            <li data-name="alias" data-event="cvm_oper_action" role="presentation" ><a href="javascript:;" role="menuitem">改名</a></li>            <li data-name="export" data-event="cvm_oper_action" role="presentation" ><a href="javascript:;" role="menuitem">导出信息</a></li>            <li data-name="bindEip" data-event="cvm_oper_action" role="presentation" ><a href="javascript:;" role="menuitem">绑定弹性IP</a></li>            <li data-name="unbindEip" data-event="cvm_oper_action" role="presentation" ><a href="javascript:;" role="menuitem">解绑弹性IP</a></li>        </ul>    </div>',null),S={},_={},E=m.modules,L=function(e){l("#detailScrollWrap").scrollTop(0);var t=l(this).attr("id");if(t){l("#cvmDetailNav li").removeClass("tc-cur"),l(e.target).parent().addClass("tc-cur"),l("[data-detail-type]").hide();var i=t.replace("Nav","");l("[data-detail-type="+i+"]").show();S[i];if(!S[i])switch(S[i]=!0,i){case"monitor":n.showDetail(C,document.getElementById("monitorDetail")),u.collect({operId:18,operType:2,from:"detail"});break;case"health":d.render(l("#healthDetail"),C);break;case"param":r.render(l("#paramDetail"),C,s.exports);break;case"opLog":o.render(l("#opLogDetail"),C);break;case"dfw":c.renderEniGroup(l("#dfwDetail"),l.extend({mustBindDfw:!0},C));break;case"eni":x.render(l("#eniDetail"),C)}var a="monitor"===i?"jiankong":"param"===i?"canshu":"rizhi";"health"==i&&(a="health"),u.click("yunzhuji."+a)}};s.exports={title:"实例-控制台",pageClass:"",render:function(l,p,u){var m=this,h=arguments;m.lastParams={rid:l,insId:p},S={},(k=t.appArea).html(""),f.getAllWhiteList(function(e){var t=!1,i=e.CVM_APIv3_BlackList;i&&0<i.length&&(t=!0);var a=e.CVM_ApiToMc,s=e.PrepaidForCVM;if(!t&&a&&a.length&&s&&s.length)v.async("cvm/detail/detail",function(e){m.destroy=e.destroy,e.render.apply(e,h)});else{var n,r=b.get("cvmPackData");if(r){var o=r[r.length-1];m.isPrepaidUser=o.isPrepaidUser,m.isBandWidthPackageUser=o.isBandwidthPackageUser;for(var d,c=0;d=r[c];c++)if(d.uInstanceId==p){(n=d).isPrepaidUser=m.isPrepaidUser;break}}!n||m.forceUpdate||u?(m.forceUpdate=!1,f.getCvmList({count:1,offset:0,regionId:l,uInstanceIdList:[p]},function(e){if(!e.deviceList||!e.deviceList.length)return m.renderDetailNoData();m.isPrepaidUser=e.isPrepaidUser,m.isBandWidthPackageUser=e.isBandWidthPackageUser;var t=new g({data:e.deviceList,isPrepaidUser:m.isPrepaidUser,isBandwidthPackageUser:m.isBandWidthPackageUser,serverTimestamp:e.serverTimestamp});t[0].isPrepaidUser=e.isPrepaidUser;var i=t[0];i.regionId=l,m.renderUi(i)},function(){m.renderDetailNoData()})):(n.regionId=l,m.renderUi(n))}})},renderUi:function(o){(C=o).defaultUser=o.defaultUser||"",o.uInstanceId=o.uInstanceId||"","0000-00-00 00:00:00"==o.deadline&&(o.deadline="-");for(var e=l(".menu-list").find("a"),t={},i=0;i<e.length;i++)if(e.eq(i).hasClass("act")){t.alias=e.eq(i).find("span").html(),t.url=e.eq(i).attr("href");break}o.curNav=t;var a=p.tmpl(T,o);k.html(a);var s=o.isPrepaidUser,n=this.isSecondPayMode(o),r=D({isPrepaidUser:s,isSecondPayMode:n});l(".cvm-more-opt").html(r),l(".cvm-more-opt").on("click","button",function(e){var t=(e=e||window.event).target||e.srcElement,i=l(t).attr("data-event");if(!l(this).attr("data-disabled")){if("web_ssh"==i){if(l(this).hasClass("disabled"))return;d.showVnc(l(".cvm-more-opt"))}else if("cvm_oper_action"==i){var a=l(this);if(a.hasClass("disabled"))return;if(l(".cvm-more-opt").attr("data-isloading"))return void I.flash("正在执行任务");var s=a.attr("data-name"),n=[];n.push(o);var r=m.refresh(n,!0);m.exec(s,n,r)}return!1}I.error(l(this).attr("data-title"))});var d=this;f.getProjects(function(e){o.projectData=e.data}),this.setAttr(o),this.initOper(o),l("#cvmDetailNav li").bind("click",L),l("#paramNav a").trigger("click"),l(".param-panel").on("click",'[data-action="editAlias"]',function(){if(!l(".cvm-more-opt").attr("data-isloading")){var e=[];return e.push(o),m.exec(l(this).attr("data-name"),e),!1}I.flash("正在执行任务")}),l(".param-panel").on("click",'[data-action="hostDetail"]',function(){var e="/cvm/cdh/detail/"+d.lastParams.rid+"/"+o.uHostId;w.navigate(e)});var c={cvmListEl:l("#paramDetail"),projectData:o.projectData,isPrepaidUser:this.isPrepaidUser,isBandwidthPackageUser:this.isBandWidthPackageUser,refresh:function(){d.render(d.lastParams.rid,d.lastParams.insId,!0)}};d.listIns=m.listIns=c},showVnc:function(e){var t="https://vnc.qcloud.com/?";t+="innerIp="+e.attr("data-deviceLanIp"),t+="&uuid="+e.attr("data-uuid"),t+="&regionId="+this.lastParams.rid,window.open(t,"","width=830,height=630,location=no");var i="yunzhuji.showvnc",a=e.attr("data-osType");a&&(i+="linux"==a?"_linux":"_windows"),u.click(i)},setAttr:function(e){var t={"data-deviceLanIp":e.deviceLanIp,"data-uuid":e.uuid,"data-osType":e.osType};for(var i in e.$loading&&(t["data-isLoading"]=!0),t)l(".cvm-more-opt").attr(i,t[i])},initOper:function(e){l(".tc-15-dropdown-link");if(l(".cvm-more-opt").attr("data-isloading")){var t=l(".cvm-more-opt");return t.find(">button").addClass("disabled").attr("data-title","正在执行任务"),void t.find(".tc-15-dropdown-link").addClass("disabled").attr("data-title","正在执行任务")}for(var i,a=l(".cvm-more-opt"),s=["vnc","renew"],n=new h({dataItems:[e],operAction:s,listIns:this}).getAuth(),r=0;i=s[r];r++){var o=a.find('[data-name="'+i+'"]');n[i]&&o.length&&(0===n[i].code?o.removeClass("disabled").attr("data-title",""):o.addClass("disabled").attr("data-title",n[i].tip))}},showRowDropDown:function(e,t){l(e);var i=l(".cvm-more-opt");if(!(a=l("#cvmRowDropdown")).length){var a=l(P({isPrepaidUser:this.isPrepaidUser,isBandWidthPackageUser:this.isBandWidthPackageUser,notShow_changeproject:this.notShow_changeproject,notShow_firewall:this.notShow_firewall,isSnapAbility:t.isSnapAbility})).hide();i.append(a);var s=new y(a,{newMode:!0});a.data("dropdown",s)}a.data("onTr",i);var n=t.isPrepaidUser,r=this.isSecondPayMode(t);-1!=navigator.userAgent.indexOf("Firefox")?!n||r?a.css({right:-72,top:-44}):a.css({right:-144,top:-44}):!n||r?a.css({right:10,top:0}):a.css({right:-132,top:-44}),a.show().data("dropdown").show(),this.displayOperMenu(a,i,t)},displayOperMenu:function(e,t,i){for(var a in E){var s=E[a];_[a]=new s.module({listIns:this.listIns,button:l(".cvm-more-opt").find('[data-name="'+a+'"]'),selectedItem:[]})}var n=new h({dataItems:[i],operAction:m.getModuleArr(),listIns:this.listIns}).getAuth();for(var a in _){var r=e.find('[data-name="'+a+'"]');n[a]&&r.length&&(0===n[a].code?r.removeClass("disabled").attr("data-title",""):r.addClass("disabled").attr("data-title",n[a].tip))}l(".tc-15-dropdown").on("click","li",function(){if(!l(this).hasClass("disabled")){var e=[];e.push(i);var t=m.refresh(e,!0);m.exec(l(this).attr("data-name"),e,t)}})},renderDetailNoData:function(){i.renderDetailNoData("云主机","/cvm")},isSecondPayMode:function(e){return e.cvmPayMode===a.CVMPAYMODE.SECOND},destroy:function(){l("#cvmDetailNav li").unbind("click",L),k=C=null,S={},r.destroy&&r.destroy(),d.destroy&&d.destroy(),x.destroy()}}}),define("modules/cvm/view/dfwdetail",function(o,e,t){var d=o("$"),s=o("appUtil"),r=(o("models/api"),o("models/iaas")),c=o("models/manager"),i=o("./model"),n=o("qccomponent"),l=n.getComponent("qc-popover"),a=n.getComponent("grid-view"),p=n.getComponent("grid-editor"),u=(o("widget/cvmList/firewall/firewall"),o("widget/popover/HelpTips")),m=o("widget/tabGroup/tabGroup"),h='    <div class="scroll-area security-group">        <div style="margin: 10px 0" b-if="hasEni">            <p class="tc-15-msg">此页面仅展示云服务器主网卡绑定的安全组规则，辅助网卡的安全组规则请到辅助网卡的详情页中查看。                <a href="/vpc/eni?instanceId={{uInstanceId}}" data-event="nav"> 立即前往</a>            </p>        </div>        <div class="tc-g main-card">            <div class="tc-g-u-1-3">                <div class="sg-box">                    <div class="renewals-cont">                        <div class="renewals-detail">                            <p class="renewals-detail-tip">                                <a href="javascript:;" b-if="hasFirewall && !isEdit" b-on-click="editFirewall()">排序</a>                                <a class="{{canBindDfw ? \'\' : \'text-weak\' }}" data-title?="!canBindDfw && disableBindTips" href="javascript:;" b-on-click="addFirewall()"                                    style="margin-left: 10px;">绑定</a>                                <strong>已绑定安全组</strong>                            </p>                            <firewall-grid must-bind-dfw={{mustBindDfw}} del-dfw="{{saveFirewall.bind(this)}}" b-if="!isEdit" region-id="{{regionId}}" add-firewall="{{addFirewall.bind(this)}}"                                get-list="{{getFirewall.bind(this)}}"></firewall-grid>                            <div b-style="{display: isEdit ? \'block\' : \'none\'}">                                <firewall-edtor type="{{type}}" b-ref="editor" add-firewall="{{addFirewall.bind(this)}}" get-list="{{getFirewall.bind(this)}}"></firewall-edtor>                                <div class=\'tc-15-page tc-15-table-panel-edit\'>                                    <button class="tc-15-btn {{saving ? \'disabled\': \'\'}}" data-save b-on-click="saveFirewall()">保存</button>                                    <button class="tc-15-btn weak" b-on-click="cancelEditFirewall()">取消</button>                                </div>                            </div>                        </div>                    </div>                </div>            </div>            <div class="tc-g-u-2-3">                <div class="sg-box">                    <div class="renewals-cont">                        <div class="renewals-detail">                            <p class="renewals-detail-tip">                                <strong>规则预览</strong>                            </p>                            <qc-tabs list="{{list}}" region-id="{{regionId}}" class-name="tc-15-tab-alt" get-list="{{getFirewall.bind(this)}}"></qc-tabs>                        </div>                    </div>                </div>            </div>        </div>    </div>',v='    <div class="param-bd">        <div class="tc-15-table-panel tc-15-table-panel-edit">            <div b-repeat="item in list">                <div class="tc-15-table-fixed-body table-fold" style="border:none">                    <table class="tc-15-table-box tc-15-table-rowhover">                        <colgroup>                            <col class="tc-15-table-col1">                            <col class="tc-15-table-col2">                            <col class="tc-15-table-col3">                        </colgroup>                        <tbody>                            <tr tabindex="0" b-on="events" style="cursor: pointer" class="{{item._state ? \'open\' : \'\'}}">                                <td colspan="4">                                    <div class="selection-task-name">                                        <i class="icon"></i><span>{{item.sgName}}</span>                                    </div>                                </td>                                \x3c!--<th>                                    <div>{{$index + 1}}</div>                                </th>                                <th colspan="2">                                    <div><i class="folder-icon"></i>{{item.sgName}}</div>                                </th>                                <th>                                    <div><a class="sort-{{item._state ? \'up\' : \'down\'}}-icon" href="javascript:;"></a></div>                                </th>--\x3e                            </tr>                        </tbody>                    </table>                </div>                <div style="display: none" data-rules>                    <div class="tc-15-table-fixed-head" style="border-top:none">                        <table class="tc-15-table-box">                            <colgroup>                                <col class="tc-15-table-col">                                <col class="tc-15-table-col">                                <col class="tc-15-table-col">                                <col class="tc-15-table-col">                            </colgroup>                            <thead>                                <tr tabindex="0">                                    <th>                                        <div>{{type == \'ingress\' ? \'来源\' : \'目标\'}}</div>                                    </th>                                    <th>                                        <div>端口协议</div>                                    </th>                                    <th>                                        <div>策略</div>                                    </th>                                    <th>                                        <div>备注</div>                                    </th>                                </tr>                            </thead>                        </table>                    </div>                    <div class="tc-15-table-fixed-body">                        <table class="tc-15-table-box ">                            <colgroup>                                <col class="tc-15-table-col1">                                <col class="tc-15-table-col2">                            </colgroup>                            <tbody>                                <tr b-if="!item._loaded">                                    <td class="text-center" colspan="4">                                        <div><i class="n-loading-icon"></i> <span class="text">加载中</span></div>                                    </td>                                </tr>                                <tr b-repeat="rule in item.rules">                                    <td>                                        <div>                                            <span class="text-overflow" b-if="!rule.addressModule && !rule.sgId">{{rule.cidrIp || \'ALL\'}}</span>                                            <a href="{{rule.sgUrl}}" data-event="nav" b-if="rule.sgId">{{rule.sgId}}</a>                                            <a b-on="{mouseover: hoverHandler(rule.addressModuleItemList)}" href="{{rule.ipUrl}}" data-event="nav" b-if="rule.addressModule">{{rule.addressModule}}</a>                                        </div>                                    </td>                                    <td>                                        <div>                                            <span class="text-overflow" b-if="!rule.serviceModule">{{rule.protoPort}}</span>                                            <a b-on="{mouseover: hoverHandler(rule.serviceModuleItemList)}" href="{{rule.protoUrl}}" data-event="nav" b-if="rule.serviceModule">{{rule.serviceModule}}</a>                                        </div>                                    </td>                                    <td>                                        <div>                                            <span class="text-overflow">{{rule.action == \'ACCEPT\' ? \'允许\' : \'拒绝\'}}</span>                                        </div>                                    </td>                                    <td>                                        <div>                                            <span class="text-overflow" title="{{rule.desc}}">                                        {{rule.desc || \'-\'}}                                    </span>                                        </div>                                    </td>                                </tr>                                <tr b-if="item.rules.length === 0">                                    <td colspan="4" class="text-center">                                        <div>空</div>                                    </td>                                </tr>                            </tbody>                        </table>                    </div>                </div>            </div>            <div class="tc-15-table-fixed-body table-fold" b-if="list && !list.length">                <table class="tc-15-table-box">                    <tbody>                        <tr>                            <td class="text-center" colspan="4">                                <div><span class="text">当前无{{type === \'ingress\' ? \'入站\' : \'出站\'}}规则</span>                                </div>                            </td>                        </tr>                    </tbody>                </table>            </div>        </div>    </div>',f='    <div class="rich-textarea simple-mod" style="margin: 15px">        <div class="rich-content">            <p b-repeat="item in list" key="{{$index}}" class="rich-text">{{item}}</p>        </div>      </div>',g={action:"DROP",ip:"0.0.0.0/0",port:"ALL",proto:"ALL Traffic",protoPort:"ALL"},b=n.extend({},{defaults:{type:"cvm",canBindDfw:!0}});b.tag("help-tips",u),t.exports={render:function(e,t){var i=this,a=new b(h,{$afterInit:function(){var i=this;i.vpcId&&nmcLoad("vpc2.js",function(){o.async("modules/vpc/eni/model",function(e){e.DescribeNetworkInterfaces({instanceId:i.uInstanceId}).then(function(e){var t=e&&e.data||[];i.$set("hasEni",t.length)})})})},$data:d.extend({},t),editFirewall:function(){this.$set("isEdit",!0)},saveFirewall:function(e){var t=this,i=this.$refs.editor;if(!this.saving){this.$set("saving",!0),this.$refs.editor.removePreRemove(),e||(e=i.list.map(function(e){return e.sgId}));var a={instanceId:t.uInstanceId,networkInterfaceId:t.networkInterfaceId};0===e.length?a["sgIds.0"]="":a.sgIds=e,(this.isEni?r.apiRequest({cmd:"ModifySecurityGroupsOfNetworkInterface",regionId:this.regionId,serviceType:"dfw",data:{networkInterfaceSet:[a]}},{camTipsType:"dialog"}):r.apiRequest({cmd:"ModifySecurityGroupsOfInstance",serviceType:"dfw",regionId:this.regionId,data:{instanceSet:[a]}},{camTipsType:"dialog"})).then(function(){t.$set({saving:!1,isEdit:!1}),d("#dfwDetail").trigger("firewallFieldRefresh")})}},cancelEditFirewall:function(){this.$set("isEdit",!1);var e=s.clone(this.firwalls);this.$refs.editor.setData({list:e,totalNum:e.length})},list:[{label:"入站规则",content:'<rules-grid region-id={{regionId}} get-list="{{getList}}" type="ingress"></rules-grid>'},{label:"出站规则",content:'<rules-grid region-id={{regionId}} get-list="{{getList}}" type="egress"></rules-grid>'}],refresh:function(){i.render(e,t)},getFirewall:function(){var n=this;return(this.firewalls?Promise.resolve(s.clone(this.firewalls)):r.apiRequest({regionId:n.regionId,cmd:"DescribeSecurityGroupsOfInstance",serviceType:"dfw",data:{instanceIds:[n.uInstanceId]}}).then(function(s){return s=s.data,new Promise(function(a,e){c.getProjects(function(e){var t=e.data.map(function(e){return e.projectId}),i=s.filter(function(e){return e.instanceId==n.uInstanceId})[0].sgInfo||[];i.forEach(function(e){-1==t.indexOf(1*e.projectId)&&(e.noPermission=!0)}),a(i)},e)})})).then(function(e){return e.forEach(function(e,t){e._priority=t+1}),n.$set("hasFirewall",e.length),n.firwalls=s.clone(e),n.firwalls})},addFirewall:function(){if(this.canBindDfw){var e=this,i=this.$data;nmcLoad("vpc2.js",function(){o.async("modules/vpc/eni/detail/Sg",function(t){e.getFirewall().then(function(e){t.addFirewall({regionId:i.regionId,sgs:e,primary:!0,projectId:i.projectId,bindFn:function(e){return r.apiRequest({action:"ModifySecurityGroupsOfInstance",serviceType:"dfw",data:{instanceSet:[{sgIds:e,instanceId:i.uInstanceId}]}},{camTipsType:"dialog"})}})})})})}}});d(e).html(a.$el),d("#dfwDetail").off("firewallFieldRefresh").on("firewallFieldRefresh",function(){a.refresh()})},destroy:function(){d("#dfwDetail").off("firewallFieldRefresh")},renderEniGroup:function(a,s,e){var n=this,r=d("<div></div>");(e?Promise.resolve(e):this.getEniList(s.regionId,s.uInstanceId)).then(function(e){var t=!1;if(0!==e.length){1===e.length&&(t=!0);var i=new m({$data:{selected:s.currentItem,list:e.map(function(e,t){return d.extend({label:e.networkInterfaceId+(e.primary?"(主网卡)":"(辅助网卡)"),id:e.networkInterfaceId+t},e)})},onChange:function(t){n.render(r,{firewalls:t.groupSet,regionId:s.regionId,type:t.primary?"cvm":"eni",mustBindDfw:t.primary,isEni:!t.primary,uInstanceId:s.uInstanceId,alias:s.alias,networkInterfaceId:t.networkInterfaceId,addFirewall:function(){nmcLoad("vpc2.js",function(){o.async("modules/vpc/eni/detail/Sg",function(e){e.addFirewall({regionId:s.regionId,id:t.networkInterfaceId,sgs:t.groupSet,primary:t.primary,projectId:s.projectId,showProjectSelector:!t.primary})})})},refresh:function(){n.renderEniGroup(a,d.extend({},s,{currentItem:t}))}})}});t&&d(i.$el).hide(),d(a).html(i.$el).append(r)}else n.render(a,s)})},getEniList:function(e,t){return r.apiRequest({serviceType:"vpc",cmd:"DescribeNetworkInterfaces",regionId:e,data:{instanceId:t}}).then(function(e){return(e=e.data).data.sort(function(e,t){return e.primary?-1:t.primary?1:0})})}},b.tag("firewall-grid",a.extend({getData:function(e,i){var a=this;return this.showLoading(),this.getList().then(function(e){a.hideLoading();var t={list:e.slice(),totalNum:e.length};return i(null,t),t},i)},remove:function(i){return function(e){var t=this.$root;(1<t.list.length||!t.mustBindDfw)&&new(n.getComponent("popup-confirm"))({$data:{trigger:"",title:"确认要删除该安全组? ",style:"width: 310px;",hideDestroy:!0},handler:e.target,attachEl:t.$el,onConfirm:function(){t.delDfw(t.list.filter(function(e){return i.sgId!==e.sgId}).map(function(e){return e.sgId}))}}).show()}}},{defaults:{hasFirst:!1,showPagination:!1,showState:!1,autoMaxHeight:!1,minHeight:"auto",emptyTips:'<span class="text">您还没配置安全组</span>',colums:[{name:"优先级",key:"_priority",tdTpl:"<span>{{$parent.$index + 1}}</span>",width:60,minWidth:60},{name:"安全组ID/名称",key:"sgName",tdTpl:'    <div>        <p>            <a b-if="!item.noPermission" data-event="nav" href="/cvm/securitygroup/detail/{{item.sgId}}?rid={{regionId}}">{{item.sgId}}</a>            <a b-if="item.noPermission" class="text-weak" data-title="您的账号没有该资源权限，可请求主账号为您开通该资源的权限" href="javascript:;">{{item.sgId}}</a>        </p>        <p>            <span class="text-overflow m-width">{{item.sgName}}</span>        </p>    </div>'},{name:"操作",width:100,key:"_action",tdTpl:'<span class="text-overflow"><a href="javascript:;" data-title?="list.length==1 && mustBindDfw ? \'必须绑定一个安全组\' : \'\'" b-on="{click: remove(item)}" class="links {{list.length==1 && mustBindDfw ? \'text-weak\'  : \'\'}}">删除</a></span>'}]}})),b.tag("firewall-edtor",p.extend({getData:function(e,t){var i=this;this.showLoading(),this.getList().then(function(e){i.hideLoading(),t(null,{list:e.slice(),totalNum:e.length})},t)}},{defaults:{dragable:!0,insertBtn:!1,autoMaxHeight:!1,minHeight:"auto",emptyTips:'您还没配置安全组, <a href="javascript:;" b-on-click="addFirewall()">立即配置</a>',colums:[{name:"安全组ID/名称",key:"sgName",tdTpl:'    <div>        <p>            <a b-if="!item.noPermission" data-event="nav" href="/cvm/securitygroup/detail/{{item.sgId}}?rid={{regionId}}">{{item.sgId}}</a>            <a b-if="item.noPermission" class="text-weak" data-title="您的账号没有该资源权限，可请求主账号为您开通该资源的权限" href="javascript:;">{{item.sgId}}</a>        </p>        <p>            <span class="text-overflow m-width">{{item.sgName}}</span>        </p>    </div>'}]}})),b.tag("rules-grid",n.extend({$tpl:v,$afterInit:function(){var t=this;this.getList().then(function(e){t.$set("list",e),d(t.$el).find("tr").click()})},hoverHandler:function(e){var a=new(n.extend({$tpl:f,list:e}));return function(e){var t=e.target,i=new l({handler:t,attachEl:document.body,$data:{hideDestroy:!0,content:a.$el,trigger:""}});l.hideExcept(i),i.show()}},getRules:function(e){function t(e){var t=e[0];return t.filter(function(e){return e}).forEach(function(e){var t=(e.ipProtocol||"all").toUpperCase(),i=e.portRange?e.portRange:"ALL";"ALL:ALL"==(t="ICMP"===t?t:t+":"+i).toUpperCase()&&(t="ALL"),e.sgId?e.sgUrl="/cvm/securitygroup/detail/"+e.sgId:e.addressModule&&(/^ipmg/.test(e.addressModule)?e.ipUrl="/vpc/tpl?tab=ipgroup&keyword="+e.addressModule:e.ipUrl="/vpc/tpl?tab=ip&keyword="+e.addressModule),e.serviceModule&&(/^ppmg/.test(e.serviceModule)?e.protoUrl="/vpc/tpl?tab=protoportgroup&keyword="+e.serviceModule:e.protoUrl="/vpc/tpl?tab=protoport&keyword="+e.serviceModule),e.protoPort=t}),t}return"ingress"==this.type?i.fetchSecurityGroupIngressPolicys(this.regionId,e.sgId).then(function(e){return t(e)}):"egress"==this.type?i.fetchSecurityGroupEgressPolicys(this.regionId,e.sgId).then(function(e){return t(e)}):void 0},events:{click:function(e){var t=this,i=this.$root;d(this.$el).find("[data-rules]").slideToggle("fast"),this.$set({_state:!this._state}),this._state&&!this._appendDefault&&i.getRules(this).then(function(e){t.$index==i.list.length-1&&(e.push(g),t._appendDefault=!0),t.rules||t.$set({rules:e,_loaded:!0})})}}}))}),define("modules/cvm/view/enidetail",function(e,t,i){var o=e("qccomponent"),d=e("constants"),c=e("manager"),l=e("dialog"),p=e("tips"),u=e("util"),a=e("appUtil"),m=e("modules/cvm2/event/bindEni/bindEni"),n=e("modules/cvm2/event/unbindEni/unbindEni"),h=o.extend({$tpl:'    <div class="eni">        <div b-on-click="toggle()" class="tc-15-table-panel tc-15-table-panel-edit">            <div class="tc-15-table-fixed-body">                <table class="tc-15-table-box tc-15-table-rowhover">                    <colgroup>                        <col class="tc-15-table-col1" style="width:6%">                        <col class="tc-15-table-col2">                        <col class="tc-15-table-col3">                        <col class="tc-15-table-col4">                        <col class="tc-15-table-col5" style="width:15%">                    </colgroup>                    <tbody>                        <tr tabindex="0" b-class="open ? \'selection-summary open\': \'selection-summary\'">                            <td colspan="4">                                <div class="selection-task-name">                                    <i class="icon"></i>                                    <span class="text-overflow">{{item.eniName}}</span>                                    <i class="resize-line-icon"></i>                                    <a href="/vpc/eni/detail?rid={{regionId}}&id={{item.networkInterfaceId}}" data-event="nav">{{item.networkInterfaceId}}</a>                                    <span class="text-label">{{item.primary?"（主网卡）":"（辅助网卡）"}}</span>                                </div>                            </td>                            <td>                                <div class="mod-handle"><a b-class="canAdd ? \'\' : \'text-weak\'" b-on="{click: assignIp()}" href="javascript:;">分配内网IP</a> <a b-on="{click: unbindEni()}" href="javascript:;" class="{{!item.primary ? \'\': \'text-weak\'}}" data-title="{{item.primary ? \'云主机的主网卡不能解绑\': \'\'}}" >解绑</a></div>                            </td>                                                           </tr>                                         </tbody>                </table>            </div>        </div>        <ip-manager b-ref="ipManager" id="{{item.networkInterfaceId}}" hidden-ip-operate="{{hiddenIpOperate}}" instance-id="{{instanceId}}" region-id="{{regionId}}"></ip-manager>    </div>',$afterInit:function(){a.beeBind(this.$refs.ipManager,this,"canAdd")},unbindEni:function(){var s=this;return function(e){var t=new n,i=(d.REGIONMAP[s.regionId]||"")+"_vpc_"+s.vpcId,a=s.item.networkInterfaceId;e.stopPropagation(),s.item.primary||l.confirm("确认解绑弹性网卡？",function(){t.sendReq({networkInterfaceId:a,instanceId:s.instanceId,zoneId:s.zoneId,vpcId:i}).then(function(e){if((e=(e||{}).data)&&e.taskId)return c.checkTask({regionId:s.regionId,taskId:e.taskId,tips:"正在解挂中..."})}).then(function(e){p.stopLoading(),l.hide(),l.create(u.tmpl('    <div class="dialog-confirm-box">        <p class="dialog-confirm-title"><i class="<%= iconClassName %>"></i><strong><%= text %></strong></p>        <p class="dialog-confirm-text"><%= desc %></p>      </div>',{text:"解绑成功",desc:"您的弹性网卡已经解绑成功。",iconClassName:"m-success-icon"}),500,"",{struct:"rich",closeIcon:!1,defaultCancelBtn:!1,button:{"确定":function(){l.hide(),s.refreshCb&&s.refreshCb()}}})},function(){p.stopLoading(),l.toggleBtnDisable(!1)})})}},assignIp:function(e){var t=this;return function(e){e.stopPropagation(),t.$refs.ipManager.assignIp()}},toggle:function(){var e=this;$(e.$refs.ipManager.$el).slideToggle(function(){e.$set("open",!e.$get("open"))})}},{defaults:{open:!0}});i.exports={render:function(s,n){var r=this;nmcLoad("vpc2.js",function(){e.async(["modules/vpc/eni/detail/IPManager","modules/vpc/eni/model"],function(e,t){var i=o.extend({$tpl:'    <div>        <div class="tc-15-msg" style="margin: 10px 0;" b-if="cvm.vpcId">            <div class="tip-info">                云主机绑定弹性网卡后，您需登录云主机配置IP及路由，点击                <a href="//'+QCMAIN_HOST+'/document/product/215/6513#.E4.BA.91.E4.B8.BB.E6.9C.BA.E5.86.85.E5.BC.B9.E6.80.A7.E7.BD.91.E5.8D.A1.E7.9A.84.E9.85.8D.E7.BD.AE.EF.BC.88.E4.BB.A5centos-7.2.E4.B8.BA.E4.BE.8B.EF.BC.89" target="_blank">                    查看操作指南</a>            </div>        </div>        <div class="param-box">            <div b-if="cvm.vpcId">                <div class="top-title">                    <h3>弹性网卡</h3>                    <span><a b-on-click="bindEni()" href="javascript:void(0);">绑定网卡</a></span>                </div>                <div b-repeat="item in eni" b-ref="eniItem" class="elastic-network-table">                    <eni item="{{item}}" instance-id="{{instanceId}}" region-id="{{regionId}}" zone-id="{{zoneId}}"  vpc-id="{{vpcId}}" hidden-ip-operate="{{hiddenIpOperate}}"></eni>                </div>            </div>            <div style="padding: 100px; text-align: center" b-if="!cvm.vpcId">                <div class="tc-15-list-legend" style="border: none">基础网络云主机不支持弹性网卡</div>                <div class="tc-15-list-content">                    弹性网卡仅支持私有网络云主机                </div>            </div>        </div>    </div>',$afterInit:function(){var i=this;n.vpcId&&t.DescribeNetworkInterfaces({instanceId:this.instanceId,hideSecondary:0}).then(function(e){var t=e&&e.data||[];t=t.sort(function(e,t){return e.primary&&!t.primary?-1:!e.primary&&t.primary?1:0}),i.$set("eni",t)})},bindEni:function(){var t=this,e=new m,i=(d.REGIONMAP[n.regionId]||"")+"_vpc_"+n.vpcId;e.doAction({instanceId:n.uInstanceId,regionId:n.regionId,zoneId:n.zoneId,zoneName:n.zoneName,vpcId:i,netName:n.netName}).then(function(e){return(e=(e||{}).data)&&e.taskId?c.checkTask({regionId:n.regionId,taskId:e.taskId,tips:"正在挂载中..."}):new Promise(function(e,t){t()})}).then(function(e){p.stopLoading(),l.hide(),l.create(u.tmpl('    <div class="dialog-confirm-box">        <p class="dialog-confirm-title"><i class="<%= iconClassName %>"></i><strong><%= text %></strong></p>        <p class="dialog-confirm-text"><%= desc %></p>      </div>',{text:"绑定成功",desc:"您的弹性网卡已经绑定成功。",iconClassName:"m-success-icon"}),500,"",{struct:"rich",closeIcon:!1,defaultCancelBtn:!1,button:{"确定":function(){l.hide(),t.refresh()}}})},function(){p.stopLoading(),l.toggleBtnDisable(!1)})},refresh:function(){r.render(s,n)}},{defaults:{cvm:n}});h.tag("ip-manager",e),i.tag("eni",h.extend({refreshCb:function(){r.render(s,n)}}));var a=new i({$data:{instanceId:n.uInstanceId,regionId:n.regionId,zoneId:n.zoneId,vpcId:n.vpcId,hiddenIpOperate:!0}});s.html(a.$el),this.page=a})})},destroy:function(){this.page&&this.page.$destroy()}}}),define("modules/cvm/view/healthdetail",function(e,t,i){var a,o=e("$"),s=e("manager"),c=(e("pageManager"),e("util")),l=e("appUtil"),n=e("event"),r=e("tips"),d=function(e,t,i,a){return-i*((e=e/a-1)*e*e*e-1)+t},p={linux:22,windows:3389},u={main:'    <div id="cvmHealthCheckContainer">        <div class="health-state">            <strong class="tit">                <% if (mode==0) { %>                    您的服务器不在运行中,不能进行健康状态检查                <% } else if (mode==1) { %>                    您还没有进行健康状态检查                <% } else if (mode==2) { %>                    正在进行健康状态检查...                <% } else { %>                    发现<%-warnNum%>个问题                <% } %>            </strong>            <p class="txt">健康状态检查帮助您检测云服务器可能存在的问题，<br>并给出建议的解决方法，以确保您业务的正常运行</p>            <a class="tc-btn xl <% if (mode==0 || mode==2) { %> disable <% } %>"                href="javascript:;" data-event="check_cvm_health">                <% if (mode==3) { %>                 重新检查                <% } else if (mode==2) { %>                检查中...                <% } else { %>                开始检查                <% } %>            </a>            <i class="ico-health             <% if (mode==0 || mode==1) { %>             health-mod             <% } else if (mode==2) { %>            health-loading            <% } else if (mode==3 && warnNum==0) { %>            health-normal            <% } else if (mode==3 && warnNum>0) { %>            <% } %>            ">                <% if (mode==2) { %>                 <i class="num" id="healthLoading"></i>                <% } %>            </i>        </div>        <ul class="health-data-list">            <li>                <em class="tit">云服务器状态</em>                <span class="txt"><%-statusDesc%></span>            </li>            <li>                <em class="tit">检查时间</em>                <span class="txt"><%=time%></span>            </li>            <li>                <em class="tit">检查结果</em>                <%-result%>                        </li>        </ul>    </div>',checking:'    <p><i class="loading-icon"></i><span>正在检查内网IP地址是否可达...</span></p>    <p><i class="loading-icon"></i><span>正在检查内网登录端口是否可达...</span></p>    <% if (deviceWanIp) { %>    <p><i class="loading-icon"></i><span>正在检查外网IP地址是否可达...</span></p>    <p><i class="loading-icon"></i><span>正在检查外网登录端口是否可达...</span></p>    <% } %>    \x3c!--<p><i class="loading-icon"></i><span>正在检查虚拟化驱动是否正常...</span></p>--\x3e',sucIp:'<p><i class="success-icon"></i><span class="success-txt"><%-netType%>网IP地址可达</span></p>',sucDrive:'    <p><i class="success-icon"></i><span class="success-txt">虚拟化驱动运行正常</span></p>',sucPort:'    <p><i class="success-icon"></i><span class="success-txt"><%-netType%>网登录端口(<%-port%>)可达</span></p>',failIp:'    <p><i class="error-icon"></i><span class="wrong-txt"><%-netType%>网IP地址不可达...</span></p>    <dl class="suggest-list">        <dt>处理建议:</dt>        <dd>            <em class="num">1.</em><span class="txt">请检查您的云服务器<%-netType%>网IP是否已禁止ping，如果禁ping属于您的主动使用行为，请忽略此<br>            提示</span> <a href="http://wiki.qcloud.com/wiki/%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%8A%B6%E6%80%81%E6%A3%80%E6%B5%8B#.E5.A6.82.E4.BD.95.E6.89.8B.E5.B7.A5.E4.BF.AE.E5.A4.8D.E5.86.85.E7.BD.91IP.E9.85.8D.E7.BD.AE" target="_blank">如何关闭禁ping功能？</a>        </dd>        <dd><em class="num">2.</em><span class="txt">其他问题请通过<a data-event="nav" href="/workorder">工单系统</a>反馈检查问题</span></dd>    </dl>',failPort:'    <p><i class="error-icon"></i><span class="wrong-txt"><%-netType%>网登录端口(<%-port%>)不可达...</span></p>    <dl class="suggest-list">        <dt>处理建议:</dt>        <dd>            <em class="num">1.</em><span class="txt">请检查您的云服务器<%-netType%>网登录端口(<%-port%>)是否已禁止，如果禁止<%-port%>端口属于您的主动使用行为，请忽略此提示 </span>        </dd>        <dd><em class="num">2.</em><span class="txt">其他问题请通过<a data-event="nav" href="/workorder">工单系统</a>反馈检查问题</span></dd>    </dl>',failDrive:'    <p><i class="warning-icon"></i><span class="warning-txt">虚拟化驱动运行未安装</span></p>    <dl class="suggest-list">        <dt>处理建议:</dt>        <dd><span class="txt">建议安装，</span><a href="javascript:;">如何安装虚拟化驱动？</a></dd>    </dl>'};i.exports={model:e("models/cvmHealth"),render:function(e,t){this.container=e,this.data=t,this.statusDesc=o(t.statusDesc).text(),this.isCheckable()?this.getLasthealthCheck():this.renderContent({statusDesc:this.statusDesc,mode:0,warnNum:0,time:"-",result:"无结果"}),this.bindEvent(e)},renderContent:function(e){var t=c.tmpl(u.main,{statusDesc:e.statusDesc,mode:e.mode,warnNum:e.warnNum,time:e.time,result:e.result});this.container.html(t),a=o("#cvmHealthCheckContainer")},bindEvent:function(){var e=this;n.bindCommonEvent(this.container[0],"click",{check_cvm_health:function(){o(this).hasClass("disable")||e.checkHealth()}})},isCheckable:function(){return 4!=this.data.runflag},getLasthealthCheck:function(){var t=this;this.model.request({name:"getConfigHealth",data:{deviceList:[this.data.deviceId]},success:function(e){t.displayResult(e.result)}})},checkHealth:function(){var t=this;this.renderContent({statusDesc:this.statusDesc,mode:2,warnNum:0,time:"-",result:c.tmpl(u.checking,{deviceWanIp:this.data.deviceWanIp})}),this.loadingStart(),this.model.request({name:"checkCvmConfig",data:{uuidList:[this.data.uuid]},success:function(e){e&&e.taskId&&t.getFlowCscResult(e.taskId)}})},loadingStart:function(){this.isLoadingEnd=!1;var t=this,i=o("#healthLoading"),a=0,s=function(){var e=d(a,0,90,1e3);i.text(parseInt(e)),90===e||t.isLoadingEnd||(a++,c.requestAnimationFrame(s))};s()},loadingEnd:function(t){this.isLoadingEnd=!0;var i=o("#healthLoading"),a=0,s=parseInt(i.text()),n=1e3/(100-s)*10;isNaN(n)&&(n=1e3);var r=function(){var e=d(a,s,100,n);i.text(parseInt(e)),100<e&&(e=100),e<100?(a++,c.requestAnimationFrame(r)):t&&t()};r()},getFlowCscResult:function(i){var a=this;s.getFlowCscResult({taskId:i},function(e){var t=e.status;0===t?e.output&&e.output.resultDetail&&e.output.resultDetail.result?a.loadingEnd(function(){a.displayResult(e.output.resultDetail.result)}):(r.error("检查失败，请重试"),a.toggleBtn(1)):2===t?a.timeOut=setTimeout(function(){a.getFlowCscResult(i)},3e3):(r.error("状态查询失败，请重试"),a.toggleBtn(1))})},toggleBtn:function(e){var t=a.find(".tc-btn");e?t.html("重新检查").removeClass("disable"):t.html("检查中...").addClass("disable")},displayResult:function(e){var a=this,t="-",i=0,s=1,n="",r=function(e,t){t=1==t?"外":"内";var i=p[a.data.osType];return c.tmpl(u[e],{port:i,netType:t})};if(e&&e.length)for(var o,d=0;o=e[d];d++)0==o.checkLanIp?n+=r("sucIp",0):(n+=r("failIp",0),i++),o.checkLanPort!=undefined&&(0==o.checkLanPort?n+=r("sucPort",0):(n+=r("failPort",0),i++)),this.data.deviceWanIp&&(0==o.checkWanIp?n+=r("sucIp",1):(n+=r("failIp",1),i++),o.checkWanPort!=undefined&&(0==o.checkWanPort?n+=r("sucPort",1):(n+=r("failPort",1),i++))),s=3,t=l.formatDate(new Date(1e3*o.opTime),"yyyy-MM-dd hh:mm:ss");else n="无结果";this.renderContent({statusDesc:this.statusDesc,mode:s,warnNum:i,time:t,result:n})},destroy:function(){clearTimeout(this.timeOut)}}}),define("modules/cvm/view/listmonitor",function(e,t,i){var a=e("$"),s=(e("manager"),e("util")),n=(e("appUtil"),e("./monitordetail")),r=e("reporter"),o='    <div class="sidebar-panel-hd">        <h3><%=uInstanceId%><span class="entry-name-txt"></span>监控</h3>        <span class="details-hd-meta"><%=alias%></span>    </div>    <div class="sidebar-panel-bd" id="monitorDetailWrap"></div>';i.exports={render:function(e,t){t.uInstanceId=t.uInstanceId||"";var i=s.tmpl(o,t);e.html(i),n.render(a("#monitorDetailWrap"),t),r.click("yunzhuji.jiankong")},destroy:function(){}}}),define("modules/cvm/view/model",function(e,t,i){var a=e("models/iaas");t.fetchSecurityGroupIngressPolicys=function(e,t){return a.gqlRequest({regionId:e,variables:{sgIdList:[t]},query:"query fetchSecurityGroupIngressPolicys ($sgIdList: [String]){ \nresource { \nsecuritygroups (idList: $sgIdList) { \nnodes { \npolicy { \ningress { \ncidrIp \naction \nsgId \nsgName \naddressModule \naddressModuleName \naddressModuleItemList \nserviceModule \nserviceModuleName \nserviceModuleItemList \ndesc \nindex \nipProtocol \nportRange \n} \n} \n} \n} \n} \n} \n"}).then(function(e){return e.data.resource.securitygroups.nodes.map(function(e){return e.policy.ingress})})},t.fetchSecurityGroupEgressPolicys=function(e,t){return a.gqlRequest({regionId:e,variables:{sgIdList:[t]},query:"query fetchSecurityGroupIngressPolicys ($sgIdList: [String]){ \nresource { \nsecuritygroups (idList: $sgIdList) { \nnodes { \npolicy{ \negress { \ncidrIp \naction \nsgId \nsgName \naddressModule \naddressModuleName \naddressModuleItemList \nserviceModule \nserviceModuleName \nserviceModuleItemList \ndesc \nindex \nipProtocol \nportRange \n} \n} \n} \n} \n} \n} \n"}).then(function(e){return e.data.resource.securitygroups.nodes.map(function(e){return e.policy.egress})})}}),define("modules/cvm/view/monitor",function(e,t,i){var s=e("manager"),n=e("appUtil"),r={namespace:"qce/cvm",policyViewName:"cvm_device",metrics:[{category:"CPU监控",metrics:[{metricName:"cpu_usage",metricCName:"CPU利用率",dimensions:["unInstanceId"],unit:"%",min:0,max:100},{metricName:"cpu_loadavg",metricCName:"CPU平均负载",dimensions:["unInstanceId"],unit:"",min:0,checkIfVisible:function(e){for(var t=!1,i=0;i<e.length;i++)if("linux"===e[i].osType){t=!0;break}return t}}]},{category:"内存监控",metrics:[{metricName:"mem_used",metricCName:"内存使用量",dimensions:["unInstanceId"],unit:"MB",min:0},{metricName:"mem_usage",metricCName:"内存利用率",dimensions:["unInstanceId"],unit:"%",min:0}]},{category:"内网带宽监控",metrics:[{metricName:"lan_outtraffic",metricCName:"内网出带宽",dimensions:["unInstanceId"],unit:"Mbps",min:0},{metricName:"lan_intraffic",metricCName:"内网入带宽",dimensions:["unInstanceId"],unit:"Mbps",min:0},{metricName:"lan_outpkg",metricCName:"内网出包量",dimensions:["unInstanceId"],unit:"个/秒",min:0},{metricName:"lan_inpkg",metricCName:"内网入包量",dimensions:["unInstanceId"],unit:"个/秒",min:0}]},{category:"外网带宽监控",metrics:[{metricName:"wan_outtraffic",metricCName:"外网出带宽",dimensions:["unInstanceId"],unit:"Mbps",min:0},{metricName:"wan_intraffic",metricCName:"外网入带宽",dimensions:["unInstanceId"],unit:"Mbps",min:0},{metricName:"wan_outpkg",metricCName:"外网出包量",dimensions:["unInstanceId"],unit:"个/秒",min:0},{metricName:"wan_inpkg",metricCName:"外网入包量",dimensions:["unInstanceId"],unit:"个/秒",min:0},{metricName:"acc_outtraffic",metricCName:"外网出流量",unit:"MB",dimensions:["unInstanceId"],min:0}]},{category:"磁盘使用及监控",metrics:[{metricCName:"分区使用情况",type:"column",rollup:{name:"磁盘总容量",metric:"total",unit:"GB"},getData:function(e){return new Promise(function(i,a){s.loadChartDataV2({chartInfos:["disk_usage"],date:"1h",area:n.getRegionId(),uuid:e.uuid,vpcId:e.vpcId,ip:e.deviceLanIp,appId:n.getAppId(),namespace:"Cvm"},function(e){if(e.length){var t=e[0].chartData.partition;i(t)}else a({msg:""})},function(){a({msg:""})},e.unInstanceId)})}},{metricCName:"磁盘监控",showInNav:!1,type:"select",options:function(d){return new Promise(function(e,t){var i,a={},s=[];if(d.rootSize&&(a.diskType="root",a.label=d.unInstanceId+"的系统盘("+d.rootSize+"GB)",s.push(a)),a={},!d.disk||1!=d.rootType&&3!=d.rootType||(a.diskType="data",a.label=d.unInstanceId+"的数据盘("+d.disk+"GB)",s.push(a)),d.cbsList.length)for(var n=0,r=d.cbsList.length;n<r;n++)if(a={},1==d.cbsList[n].portable){i="root"==d.cbsList[n].diskType?"系统盘":"数据盘";var o=d.unInstanceId+"的"+i+d.cbsList[n].cbsInstanceId+"("+d.cbsList[n].diskSize+"GB)";a.diskType=d.cbsList[n].cbsInstanceId,a.label=o,s.push(a)}else"data"==d.cbsList[n].diskType&&(a.diskType="data",a.label=d.unInstanceId+"的数据盘("+d.cbsList[n].diskSize+"GB)",s.push(a));e(s)})},onChange:function(e,t){t.updateDimensions({disk:e.diskType})}},{metricCName:"磁盘读流量",metricName:"disk_read_traffic",dimensions:["unInstanceId","disk"],unit:"KB/s"},{metricCName:"磁盘写流量",metricName:"disk_write_traffic",dimensions:["unInstanceId","disk"],unit:"KB/s"},{metricCName:"磁盘读IOPS",metricName:"disk_read_iops",dimensions:["unInstanceId","disk"],unit:"个"},{metricCName:"磁盘写IOPS",metricName:"disk_write_iops",dimensions:["unInstanceId","disk"],unit:"个"},{metricCName:"IO Await",metricName:"disk_await",dimensions:["unInstanceId","disk"],unit:"ms"},{metricCName:"IO Svctm",metricName:"disk_svctm",dimensions:["unInstanceId","disk"],unit:"ms"},{metricCName:"IO %util",metricName:"disk_util",dimensions:["unInstanceId","disk"],unit:"%"}]}]},o=function(e){return e.unInstanceId=e.uInstanceId,{title:e.uInstanceId,subTitle:e.alias||e.name,instance:e}};i.exports.showList=function(a,i,s){e("lib/monitor-sdk-importer").ready().then(function(e){var t=$.extend({pagination:{range:{from:0,to:a.length},index:i},getData:function(i){return i=i||0,new Promise(function(e){var t=o(a[i]);s&&s(t.instance.uInstanceId),e(t)})}},r);e.MonitorPanelBuilder.build(t)})},i.exports.showDetail=function(i,a){e("lib/monitor-sdk-importer").ready().then(function(e){var t=$.extend({getData:function(){return new Promise(function(e){e(o(i))})}},r);e.MonitorDetailBuilder.build(t,a)})}}),define("modules/cvm/view/monitordetail",function(e,t,i){e("$"),e("manager"),e("util"),e("appUtil"),e("Highcharts");var o=e("monitorchart"),d=e("reporter"),c=[{type:"cpu",name:"CPU监控",charts:[{type:"cpu_usage",name:"CPU利用率",unit:"%",tName:"利用率",tip:"云服务器五分钟平均CPU利用率"},{type:"cpu_loadavg",name:"CPU平均负载",unit:"&nbsp;",tName:"负载",tip:"云服务器五分钟平均负载"}]},{type:"memory",name:"内存监控",charts:[{type:"mem_used",name:"内存使用量",unit:"M",tName:"内存",tip:"云服务器当前已使用内存"},{type:"mem_usage",name:"内存利用率",unit:"%",tName:"利用率",tip:"云服务器内存利用率"}]},{type:"traffic",name:"内网带宽监控",charts:[{type:"lan_outtraffic",name:"内网出带宽",unit:"Mbps",tName:"带宽",tip:"云服务器内网网卡每秒出带宽"},{type:"lan_intraffic",name:"内网入带宽",unit:"Mbps",tName:"带宽",tip:"云服务器内网网卡每秒入带宽"},{type:"lan_outpkg",name:"内网出包量",unit:"个/秒",tName:"包量",tip:"云服务器内网网卡每秒出包量"},{type:"lan_inpkg",name:"内网入包量",unit:"个/秒",tName:"包量",tip:"云服务器内网网卡每秒入包量"}]},{type:"wlanTraffic",name:"外网带宽监控",charts:[{type:"wan_outtraffic",name:"外网出带宽",unit:"Mbps",tName:"流量",tip:"云服务器公网出带宽",alone:1},{type:"wan_intraffic",name:"外网入带宽",unit:"Mbps",tName:"流量",tip:"云服务器公网入带宽",alone:1},{type:"wan_outpkg",name:"外网出包量",unit:"个/秒",tName:"包量",tip:"云服务器公网出包量",alone:1},{type:"wan_inpkg",name:"外网入包量",unit:"个/秒",tName:"包量",tip:"云服务器公网入包量",alone:1},{type:"wan_outflux",name:"外网出流量",unit:"MB",tName:"流量",tip:"云服务器公网出流量",alone:1}]},{type:"disk",name:"磁盘监控",charts:[{type:"disk_read_traffic",name:"磁盘读流量",unit:"KB/s",tName:"流量",tip:"云服务器磁盘每秒的读取量"},{type:"disk_write_traffic",name:"磁盘写流量",unit:"KB/s",tName:"流量",tip:"云服务器磁盘每秒的写入量"},{type:"disk_read_iops",name:"磁盘读IOPS",unit:"count",tName:"disk_read_iops",tip:"磁盘读IOPS"},{type:"disk_write_iops",name:"磁盘写IOPS",unit:"count",tName:"disk_write_iops",tip:"磁盘写IOPS"},{type:"disk_await",name:"IO Await",unit:"ms",tName:"IOAwait",tip:"平均每次设备I/O操作的等待时间 (毫秒)，等同于iostat 命令输出的await指标"},{type:"disk_svctm",name:"IO Svctm",unit:"ms",tName:"disk_svctm",tip:"平均每次设备I/O操作的服务时间"},{type:"disk_util",name:"IO %util",unit:"%",tName:"disk_util",tip:"在统计时间内处理所有IO时间，除以总共统计时间"}]}],l={cpu_loadavg:function(e){return e&&Math.round(e)/100}};i.exports={title:"实例-控制台",pageClass:"",render:function(e,t,i){for(var a=JSON.parse(JSON.stringify(c))||[],s=[],n=0;n<a.length;n++){var r=a[n];r&&"cpu"==r.type&&"windows"==t.osType&&r.charts[1]&&(r.charts[1].hidden=!0),r&&("wlanTraffic"!=r.type||t.deviceWanIp)&&s.push(r)}t.osType,o.render(e,"Cvm",t.uInstanceId,s,l,{ip:t.deviceLanIp,vpcId:t.vpcId,uuid:t.uuid},i),d.collect({operId:19,operType:1})},tryLoadCharts:o.tryLoadCharts,destroy:function(){o.destroy()}}}),define("modules/cvm/view/oplogdetail",function(e,t,i){var r=e("$"),o=e("manager"),d=e("util"),a=e("appUtil"),c=e("pagination"),l=null,s=e("qccomponent"),p='        <div class="date-wrap">        <a class="link" href="javascript:void(0);" id="exportLogBtn">导出列表</a>        <qc-date-picker id="logDateInput"></qc-date-picker>    </div>    <div id="logTableWrap"></div>    ',u='    <div class="table-panel host-table-panel">        <div class="tc-table-fixed">            <div class="tc-table-fixed-head">                <table class="tc-table tc-table-headcolor">                    <colgroup>                    <col class="tc-table-col2">                    <col class="tc-table-col3">                    <col class="tc-table-col4">                    <col class="tc-table-col5">                    </colgroup>                    <thead>                        <tr tabindex="0">                            <th><span>操作时间</span></th>                            <th><span>操作内容</span></th>                            <th><span>操作人帐号名称</span></th>                            <th><span>操作结果</span></th>                        </tr>                    </thead>                </table>            </div>            <div class="tc-table-fixed-body def-scroll">                <table class="tc-table tc-table-rowhover">                    <colgroup>                    <col class="tc-table-col2">                    <col class="tc-table-col3">                    <col class="tc-table-col4">                    <col class="tc-table-col5">                    </colgroup>                    <tbody>                        <% if (opLogs.length > 0) { %>                            <% for (var j=0;j<opLogs.length; j++ ) { %>                                <% var opLog = opLogs[j]; %>                                <tr tabindex="0">                                    <td><span><%=opLog.time%></span></td>                                    <td><span><%=opLog.actionCName%></span></td>                                    <td><span><%=opLog.uin%></span></td>                                    <td><span><% if (opLog.result == 1) { %>成功<% } else { %>失败<% } %></span></td>                                </tr>                            <% } %>                        <% } else { %>                            <tr tabindex="0" class="searc-res-tips">                                <td colspan="4"><span>抱歉，暂无相关日志！</span></td>                            </tr>                        <% } %>                    </tbody>                </table>            </div>        </div>    </div>    <div id="pageContainer"></div>',n=null,m=null,h=0,v=0,f=20,g=function(e,a,s,n){o.queryCvmOpLogs([e],a,s,20*(n-1),20,function(t){var e=function(){h=a,v=s,f=n;var e=d.tmpl(u,{opLogs:t.opLogs,startTime:new Date(a).getTime(),endTime:new Date(s).getTime()});r("#logTableWrap").html(e),l&&l.destroy&&l.destroy(),20<t.totalNum&&(l=new c({renderTo:r("#pageContainer"),page:n,perPageCount:20,totalNum:t.totalNum,listFun:I}))};if(0<t.opLogs.length){var i=[];t.opLogs.forEach(function(e){i.push(e.uin)}),o.getAccounts({uins:i},function(i){t.opLogs.forEach(function(e){for(var t=0;t<i.length;t++)if(i[t][e.uin]){e.uin=i[t][e.uin];break}}),e()},function(){e()})}else e()},function(){var e=d.tmpl(p,{opLogs:[],startTime:new Date(a).getTime(),endTime:new Date(s).getTime()});r("#logTableWrap").html(e)})},b=function(e){window.open("/cgi/cvm?action=queryCvmOpLogs&t="+(new Date).getTime()+"&uin="+d.getUin()+"&csrfCode="+d.getACSRFToken()+"&regionId="+a.getRegionId()+"&deviceIds="+m.deviceId+"&startTime="+h+"&endTime="+v+"&offset=0&count=1000&exportEnable=1"),e.preventDefault?e.preventDefault():e.returnValue=!1},I=function(e){g(m.deviceId,h,v,e)};i.exports={title:"实例-控制台",pageClass:"",render:function(e,t){m=t,l=null,e.html(p),(n=s.mount("logDateInput",{$data:{tabs:[]}})).setAllowRange(null,"%TODAY"),n.setSelectedRange("%TODAY-7","%TODAY"),n.$on("datepick",function(e){var t,i;t=n.selected.from,i=n.selected.to,g(m.deviceId,t,i,f)});var i=n.selected.from,a=n.selected.to;g(m.deviceId,i,a,1),r("#exportLogBtn").click(b)},destroy:function(){r(container).unbind("click",onContainerClick),m=null}}}),define("modules/cvm/view/paramdetail",function(e,t,i){var o=e("$"),d=e("manager"),r=(e("pageManager"),e("util")),u=e("appUtil"),m=e("constants"),h=e("models/api"),s=e("dialog"),n=e("tips"),a=(e("models/firewall"),e("widget/copy/copy")),c=e("modules/cvm/sshkey/oper"),l=e("router"),p=e("modules/cvm/detail/viewUtil"),v=e("modules/cvm/eip/common"),f=e("modules/cvm/cbs/cbsutil"),g='    \x3c!--<ul class="tc-list-data line">--\x3e        \x3c!--<li><em class="tc-list-tit">状态</em><span class="tc-list-det"><%-statusDesc%></span></li>--\x3e    \x3c!--</ul>--\x3e    <div class="scroll-area">        <div class="param-box">            <div class="param-hd">                <h3>主机信息</h3>            </div>            <div class="param-bd">                <ul class="item-descr-list">                    <li data-devicelanip="<%=deviceLanIp%>" data-uuid="<%=uuid%>">                        <span class="item-descr-tit">名称</span>                        <span class="item-descr-txt hostname"><%=alias%> <a href="javascript:;" class="pencil-icon" data-name="alias" data-action="editAlias" style="visibility:hidden;"></a></span>                                            </li>                    <li>                        <span class="item-descr-tit">服务器ID</span>                        <span class="item-descr-txt"><%=uuid%></span>                    </li>                    <li>                        <span class="item-descr-tit">状态</span>                        <span class="item-descr-txt status-tips"><%-statusDesc%></span>                    </li>                    <% if(uHostId){ %>                    <li>                        <span class="item-descr-tit">类型</span>                        <span class="item-descr-txt">独享型</span>                    </li>                    <% } %>                    <li class="item-wip">                        <span class="item-descr-tit"><% if(eipInfo){ %>弹性<% } %>公网IP</span>                        <span class="item-descr-txt viewIpCopyWrap"><%=deviceWanIp || "-"%> <a href="javascript:;" data-clipboard-text="<%=deviceWanIp%>" style="display:none">复制</a>                        <% if(deviceWanIp && !eipInfo && eipQuotaData){ %>                            <% if(eipQuotaData.currentEipNum < eipQuotaData.eipNumQuota){ %>                            <i class="convert-ip-icon" data-name="wipToEip" data-action="wipToEip" data-title="IP保持不变，转为弹性公网IP，您最多可开通<%=eipQuotaData.eipNumQuota%>个弹性公网IP，已开通<%=eipQuotaData.currentEipNum%>个。"></i>                            <% }else{ %>                            <i class="convert-ip-ash-icon" data-title="转为弹性公网IP，您的弹性公网IP已达到<%=eipQuotaData.eipNumQuota%>个上限。"></i>                            <% } %>                        <% } %>                        </span>                    </li>                    <li>                        <span class="item-descr-tit">内网IP</span>                        <span class="item-descr-txt viewIpCopyWrap"><%=deviceLanIp || "-"%> <a href="javascript:;" data-clipboard-text="<%=deviceLanIp%>" style="display:none">复制</a></span>                    </li>                    <li>                        <span class="item-descr-tit">创建时间</span>                        <span class="item-descr-txt"><%=addTimeStamp%></span>                    </li>                    <% if(!uHostId){ %>                        <li>                            <span class="item-descr-tit">到期时间</span>                            <span class="item-descr-txt"><%=deadline%></span>                        </li>                    <% }else{ %>                        <li>                            <span class="item-descr-tit">到期时间</span>                            <span class="item-descr-txt">无</span>                        </li>                    <% } %>                    <li>                        <span class="item-descr-tit">地域</span>                        <span class="item-descr-txt"><%-region[rid]%></span>                    </li>                    <li>                        <span class="item-descr-tit">可用区</span>                        <span class="item-descr-txt"><%-zoneName%></span>                    </li>                    <% if(!uHostId){ %>                        <li>                            <span class="item-descr-tit">主机计费模式</span>                            <span class="item-descr-txt"><%=cvmPayModeDesc%></span>                        </li>                    <% }else{ %>                        <li>                            <span class="item-descr-tit">主机计费模式</span>                            <span class="item-descr-txt">不计费</span>                        </li>                    <% } %>                    <li>                        <span class="item-descr-tit">网络计费模式</span>                        <span class="item-descr-txt"><%=networkPayModeDesc%></span>                    </li>                    <li>                        <span class="item-descr-tit">所属网络</span>                        <% if( vpcId <= 0 ){ %>                        <span class="item-descr-txt"><%=netName%></span>                        <% }else{ %>                        <span class="item-descr-txt">                            <a href="https://console.qcloud.com//vpc/vpc?rid=<%=rid%>&unVpcId=<%=unVpcId%>"><%=unVpcId%></a>                            (<span class="text-truncate text-max text-mod" title="<%=vpcName%>"><%=vpcName%></span> | <%=cidrBlock%>)                        </span>                        <% } %>                    </li>                    <li>                        <span class="item-descr-tit">用作公网网关</span>                        <span class="item-descr-txt"><%=isVpcGateway?"是":"否"%></span>                    </li>                    <li>                        <span class="item-descr-tit">所在子网</span>                        <span class="item-descr-txt"><%=subnetName%></span>                    </li>                    <% if(uHostId){ %>                    <li>                        <span class="item-descr-tit">所属宿主机</span>                        <span class="item-descr-txt">                        <div class="id-name-cell">                            <p>                                <a href="javascript:;"  data-action="hostDetail" ><%=uHostId%></a>                            </p>                            <div>                                <span class="text-overflow m-width" title="" ><%=hostAlias%></span>                            </div>                        </div>                        </span>                    </li>                    <% } %>\x3c!--                     <li>                        <span class="item-descr-tit">最近操作</span>                        <span class="item-descr-txt" id="lastOperation" style="white-space:normal">...</span>                    </li> --\x3e                </ul>            </div>        </div>        <div class="param-box">            <div class="param-hd">                <h3>机器配置</h3>            </div>            <div class="param-bd">                <ul class="item-descr-list">                    <li>                        <span class="item-descr-tit">操作系统</span>                        <span class="item-descr-txt"><%=osName%></span>                    </li>                    <li>                        <span class="item-descr-tit">CPU</span>                        <span class="item-descr-txt"><%=cpuInfo%></span>                    </li>                    <li>                        <span class="item-descr-tit">内存</span>                        <span class="item-descr-txt"><%=memInfo%></span>                    </li>                    <% if(_diskRoot.length > 0){ %>                        <li>                            <span class="item-descr-tit">系统盘</span>                            <span class="item-descr-txt"><%=sysDiskInfo%></span>                            <% if(_diskRoot[0].cbsInstanceId){ %>                                <span class="item-descr-txt"><a href="https://console.qcloud.com/cvm/cbs/detail?storageId=<%=_diskRoot[0].cbsInstanceId%>"><%=_diskRoot[0].cbsInstanceId%></a></span>                            <% } %>                        </li>                    <% }else{ %>                        <li>                            <span class="item-descr-tit">系统盘</span>                            <span class="item-descr-txt"><%=sysDiskInfo%></span>                        </li>                    <% } %>                    <% if(_diskData.length > 0){ %>                        <% for(var i = 0; i < _diskData.length; i++){ %>                            <li>                                <% if(i == 0){ %>                                    <span class="item-descr-tit">数据盘</span>                                <% } else{%>                                    <span class="item-descr-tit"></span>                                <% } %>                                 <span class="item-descr-txt"><%=_diskData[i].diskSize%>GB(<%= _diskData[i].diskType%>)</span> <% if(_diskData[i].cbsInstanceId){ %>                                                         <span class="item-descr-txt"><a href="https://console.qcloud.com/cvm/cbs/detail?storageId=<%=_diskData[i].cbsInstanceId%>"> <%=_diskData[i].cbsInstanceId%></a></span>                                                            <% } %>                                                     </li>                        <% } %>                      <% }%>                    <li>                        <span class="item-descr-tit">公网带宽</span>                        <span class="item-descr-txt"><%=bandwidthInfo%></span>                    </li>                </ul>            </div>        </div>        <div class="param-box">            <div class="param-hd">                <h3>系统镜像</h3>            </div>            <div class="param-bd">                <ul class="item-descr-list">                    <li>                        <span class="item-descr-tit">镜像名称</span>                        <span class="item-descr-txt osField" id="paramOsField"><%=osName%></span>                    </li>                    <li>                        <span class="item-descr-tit">类型</span>                        <span class="item-descr-txt"><%=imageType%></span>                    </li>                    <li>                        <span class="item-descr-tit">镜像ID</span>                        <span class="item-descr-txt" id="paramUnImgId">                            <% if (unImgId && deviceImageId > 0) { %>                                <a href="/cvm/image/detail/<%- rid %>/<%- unImgId %>" data-event="nav"><%=unImgIdInfo%></a>                            <% } else { %>                                <%=unImgIdInfo%>                            <% } %>                        </span>                    </li>                </ul>            </div>        </div>        <% if(showSSHKey){ %>        <div class="param-box" data-sshkey>            <div class="param-hd">                <h3>SSH密钥</h3>            </div>            <div class="param-bd">                <grid-view></grid-view>            </div>        </div>        <% } %>    </div>',b='<div class="tc-15-msg">    <p class="txt">特性：IP将保持不变，直接转为弹性公网IP保持绑定，且不中断您的服务！</p>    <p class="txt">配额：您最多可开通 <%=eipQuotaData.eipNumQuota%> 个EIP，已开通 <%=eipQuotaData.currentEipNum%> 个。</p>    <p class="txt">计费：为保证IP资源有效利用，未绑定实例的EIP，将按小时收取少量费用。</p>    <strong>确定将公网IP转换为弹性公网IP？</strong></div>';i.exports={title:"实例-控制台",pageClass:"",render:function(s,n,e){var r=this;n.showSSHKey=m.SSHKEY_VPC||!(0<n.vpcId),n.unImgId=n.unImgId||"",n.imageType=n.imageType||"",n.rid=u.getRegionId(),n.region=m.REGIONNAMES;var t,i,a=[],o=[];if(1!=n.diskType&&3!=n.diskType||!n.disk||o.push({diskSize:n.disk,diskType:(t=n.diskType,m.DISKTYPE[t])}),0<n.cbsList.length)for(var d,c=0;d=n.cbsList[c];c++)if("root"==d.diskType)a.push({cbsInstanceId:d.cbsInstanceId||"",diskSize:d.diskSize});else if(!d.diskType||"data"==d.diskType){var l=f.getCbsMetaByMedium(d.volumeType);o.push({cbsInstanceId:d.cbsInstanceId||"",diskSize:d.diskSize,diskType:l.name})}n._diskRoot=a,n._diskData=o,r.module_detail=e,i=0<n.vpcId?h.request({serviceType:"vpc",cmd:"DescribeVpcEx",data:{vpcId:n.vpcId,limit:1}}):Promise.resolve(null);var p=this.getEipQuotaData();Promise.all([p,i]).then(function(e){var t=e[0],i=e[1];if(i&&!i.code&&i.data&&i.data[0]){var a=i.data[0];n.unVpcId=a.unVpcId,n.vpcName=a.vpcName,n.cidrBlock=a.cidrBlock}n.eipInfo=n.eipInfo||"",n.eipQuotaData=t,n.hostAlias=n.hostAlias||"未命名",r.renderContent(s,n)},function(){})},renderContent:function(e,t){this.container=e;var i=r.tmpl(g,t);e.html(i),o(".item-descr-list").on("mouseenter","li",function(e){o(this).find(".pencil-icon").css("visibility","visible")}).on("mouseleave","li",function(e){o(this).find(".pencil-icon").css("visibility","hidden")}),this.initCopy(e),this.initEvents(e,t);var n="无";t.showSSHKey?Bee.mount(o("[data-sshkey] grid-view")[0],{$data:{minHeight:"auto",hasFirst:!1,showState:!1,showPagination:!1,canResizeColum:!1,autoMaxHeight:!1,emptyTips:"无",disabled:t.runflag!==m.DEVICE_RUNFLAGS.SHUTOFF.code,colums:[{key:"display_id",name:"密钥ID",cellTemplate:'<a class="id-link" data-event="nav" href="/cvm/sshkey/detail/{{item.display_id}}">{{item.display_id}}</a>'},{key:"key_name",name:"密钥名称"},{key:"_action",name:"操作"}]},attachEl:o("[data-sshkey]"),getunLink:function(a,s,n){var r=this;return function(e){if(!a.$disable){var t=o(e.target),i=t.closest("tr").attr("data-index");(t.data("qcPopover")||new(Bee.getComponent("popup-confirm"))({handler:e.target,box:r.$gridBody[0],attachEl:r.attachEl,$data:{trigger:"",title:"确定解绑该密钥？"},onConfirm:function(){r.updateItem(i,{$disable:!0}),c.sendBindServerReq([{keyId:a.key_id,unbindIpList:[s],unbindUuidList:[n]}]).done(function(){r.refresh()}).always(function(){r.updateItem(i,{$disable:!1})})}})).show()}}},getCellContent:function(e,t,i){return"_action"==i.key?'<a data-title="{{disabled ? \'关机状态才可解绑密钥\' : \'\'}}" href="javascript:;" b-on="{click: getunLink(item, ip, uuid)}">解绑</a>':i.cellTemplate},getData:function(e,a){var s=this;d.queryKeyByIps({device_list:[{uuid:t.uuid,ip:t.deviceLanIp}]},function(e){var t=e&&e[0]?e[0].key_list:[];if(t.length)for(var i=0;i<e[0].key_list.length;i++)0==i?n=e[0].key_list[i].key_name:n+=","+e[0].key_list[i].key_name;t.forEach(function(e){e.$disable=s.disabled}),a(null,{totalNum:t.length,list:t,ip:e[0].ip,uuid:e[0].uuid}),o("#cvmKey").html(n)})}}):o("#cvmKey").html(n);var a=u.formatDate(new Date((new Date).getTime()-1728e5),"yyyy-MM-dd"),s=u.formatDate(new Date,"yyyy-MM-dd");d.queryCvmOpLogs([t.deviceId],a,s,0,1,function(e){if(e.opLogs&&e.opLogs.length){var t=e.opLogs[0];o("#lastOperation").html(t.time+" "+t.actionCName+" "+(1==t.result?"成功":"失败"))}else o("#lastOperation").html("无")}),t.itemId&&0!==t.itemId&&this.getImagesDetail(t)},initCopy:function(e){var t=e.find(".viewIpCopyWrap"),i=t.find("[data-clipboard-text]");new a({handle:i,container:t})},initEvents:function(e,t){var i=this,a=t;i.container.on("click.eip",'[data-action="wipToEip"]',function(e){s.create(r.tmpl(b,t),540,"",{title:"转换为弹性公网IP",button:{"确定":function(){v.wipToEip({regionId:u.getRegionId(),unInstanceId:t.uInstanceId}).done(function(e){s.hide(),n.success("转换中..."),p.checkTask(e.requestId,function(){i.module_detail.forceUpdate=!0,l.navigate("/cvm/detail/"+a.regionId+"/"+a.uInstanceId)})}).fail(function(e){n.error(e)})}},onload:function(e){}})}),i.container.find(".item-wip").mouseenter(function(){o(this).addClass("item-wip-hover")}).mouseleave(function(){o(this).removeClass("item-wip-hover")})},getImagesDetail:function(e){var r=o("#paramOsField").html("...");d.getImagesDetail({itemId:[e.itemId]},function(e){if(e&&e.length){var t=e&&e[0],i=t.productName,a=t.productId,s=t.unImgId||"-",n="http://market.qcloud.com/detail.php?productId="+a;r.html('<a href="'+n+'" target="_blank" title="'+i+'">'+i+"</a>"),o("#paramUnImgId").text(s)}else r.html(e.osName)})},getEipQuotaData:function(){return v.getEipQuota({regionId:u.getRegionId()})},destroy:function(){this.container&&this.container.off("click.eip")}}}),define("modules/cvm/detail/viewUtil",function(e,t,i){e("appUtil");var n=e("models/loadbalance"),r=e("tips");i.exports={checkTask:function(t,i){return i=i||function(){},o[t]={},function s(i,a){n.request({name:"getFlowCscResult",global:!1,data:{taskId:i},success:function(e){var t=e.status;if(0===t)a();else if(2===t)o[i].timeOut=setTimeout(function(){s(i,a)},3e3);else{r.error("操作状态查询失败"),a("操作状态查询失败")}},fail:function(e){r.error("操作状态查询失败"),a(e)}})}(t,function(e){delete o[t],i(e)}),{clear:function(){clearTimeout(o[t]&&o[t].timeOut)}}}};var o={}});